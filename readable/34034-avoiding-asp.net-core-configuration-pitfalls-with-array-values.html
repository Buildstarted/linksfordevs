<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Avoiding ASP.Net Core Configuration Pitfalls With Array Values -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Avoiding ASP.Net Core Configuration Pitfalls With Array Values</h1>
    <div><article> <p class="freshness"> <i class="icon heartbeat freshness-icon-js"></i> <em>This post is <span class="freshness-days-old-js"></span> days old.</em> </p> <p>ASP.NET Core continues to improve on the legacy of the .NET Framework. Our team is impressed with its performance and excited about future possibilities, but change is seldom a smooth transition. In this post, I&#x2019;ll explain a pitfall you may run into using the newest configuration model in .NET Core and options to mitigate the issue.</p> <h2 id="example">Example</h2> <p>Look at the two following configurations for <code class="highlighter-rouge">appSettings.json</code> and its production environment copy of <code class="highlighter-rouge">appSettings.Production.json</code>.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// appSettings.json</span>
<span class="p">{</span> <span class="s2">&quot;Logging&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;LogLevel&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Warning&quot;</span> <span class="p">}</span> <span class="p">},</span> <span class="s2">&quot;AllowedHosts&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;AppSettings&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Features&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Normal Feature&quot;</span><span class="p">,</span> <span class="s2">&quot;Super Secret Feature&quot;</span> <span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// appSettings.Production.json</span>
<span class="p">{</span> <span class="s2">&quot;Logging&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;LogLevel&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="s2">&quot;System&quot;</span><span class="p">:</span> <span class="s2">&quot;Information&quot;</span><span class="p">,</span> <span class="s2">&quot;Microsoft&quot;</span><span class="p">:</span> <span class="s2">&quot;Information&quot;</span> <span class="p">}</span> <span class="p">},</span> <span class="s2">&quot;AppSettings&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Features&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Normal Feature&quot;</span> <span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>What would you expect the <code class="highlighter-rouge">Production</code> configuration and values for <code class="highlighter-rouge">AppSettings:Features</code> to be when run through the configuration builder? What if I told you it was the following?</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hosting Environment: Production
Features Include: Normal Feature, Super Secret Feature
</code></pre></div></div> <p>Well, it is! How did this happen?</p> <h2 id="explanation">Explanation</h2> <p>ASP.NET Core&#x2019;s configuration is based on keys, not file structure. In the example, each array item generates a unique key.</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hosting Environment: Production
Features Include: Normal Feature, Super Secret Feature

Keys:
AppSettings:Features:0
AppSettings:Features:1
</code></pre></div></div> <p>Since configurations build on each other, they are additive and not destructive. Any key not overwritten remains from the previously loaded configuration. In our case, <code class="highlighter-rouge">appSettings.json</code> array values are not completely overwritten by the array values in <code class="highlighter-rouge">appSettings.Production.json</code>, just each unique key.</p> <p>Read more at the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.2">docs sites</a>.</p> <h2 id="workarounds">Workarounds</h2> <p>There are a few &#x201C;solutions&#x201D; but I&#x2019;m not sure I love any of them.</p> <h3 id="configuration-solution-1">Configuration Solution #1</h3> <p>The most natural solution to this problem is <strong>never</strong> store array values in your base configuration. By doing so, you force each environment to set up any necessary settings. The solution works, but it could mean that the development team requires a bit more ceremony to get started or keeping up with configuration changes.</p> <h3 id="configuration-solution-2">Configuration Solution #2</h3> <p>Include every position in the array, and make sure your primitive type is nullable. When you get your app setting, you can filter out all null values, and you will have fulfilled the key requirements. In the example above, our configuration would look like this.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="s2">&quot;Logging&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;LogLevel&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Default&quot;</span><span class="p">:</span> <span class="s2">&quot;Warning&quot;</span> <span class="p">}</span> <span class="p">},</span> <span class="s2">&quot;AllowedHosts&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;AppSettings&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;Features&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;Normal Feature&quot;</span><span class="p">,</span> <span class="kc">null</span> <span class="p">]</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Not great, but it works.</p> <h3 id="style-solution">Style Solution</h3> <p>Just don&#x2019;t use arrays. It&#x2019;s a bummer, but since indexes won&#x2019;t create numeric keys, you&#x2019;ll be able to predict what all the keys will be. Maybe consider a comma-delimited string, as it may work just as well.</p> <h3 id="code-solution">Code Solution</h3> <p>Just don&#x2019;t use the <code class="highlighter-rouge">IConfiguration</code> construct in the instance you need arrays and build a different configuration mechanism entirely. The code solution is likely the best answer, as you can determine the outcome every single time with little chance of user error.</p> <h2 id="conclusion">Conclusion</h2> <p>Configuration is a communication tool for developers to express intent to each other and into our environments. The way ASP.NET Core&#x2019;s configuration ultimately works with arrays is not intuitive, but understandable after reading the documentation. We&#x2019;d love to hear from you if you&#x2019;ve run into this problem, or have a different solution. Thank you, and I hope you found this post informative and helpful.</p> <div class="articles-footer"> <time class="ui horizontal divider center aligned">Published Aug 21, 2019 by</time> </div> </article></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>