<!DOCTYPE html>
<html lang="en">
<head>
    <title>
[WIP] Remove tailcall limitations on unix64 and arm64 by jakobbotsch &#xB7; Pull Request #25932 &#xB7; dotnet/coreclr - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="[WIP] Remove tailcall limitations on unix64 and arm64 by jakobbotsch &#xB7; Pull Request #25932 &#xB7; dotnet/coreclr - linksfor.dev(s)"/>
    <meta property="article:author" content="jakobbotsch"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/coreclr/pull/25932"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - [WIP] Remove tailcall limitations on unix64 and arm64 by jakobbotsch &#xB7; Pull Request #25932 &#xB7; dotnet/coreclr</title>
<div class="readable">
        <h1>[WIP] Remove tailcall limitations on unix64 and arm64 by jakobbotsch &#xB7; Pull Request #25932 &#xB7; dotnet/coreclr</h1>
            <div>by jakobbotsch</div>
            <div>Reading time: 3 minutes</div>
        <div>Posted here: 31 Jul 2019</div>
        <p><a href="https://github.com/dotnet/coreclr/pull/25932">https://github.com/dotnet/coreclr/pull/25932</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-channel="marked-as-read:pull-request:302312199">

        



        

  


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0MzAyMzEyMTk5OjgzMDY3OWY0YTMzNTc5NTBmMDhlN2M3MjJmNzJiYjIwZDY2ZTU0ZjM=">
  
      <div>
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:830679f4a3357950f08e7c722f72bb20d66e54f3" data-url="/dotnet/coreclr/pull/25932/commits/830679f4a3357950f08e7c722f72bb20d66e54f3/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  
<div data-gid="MDIzOkhlYWRSZWZGb3JjZVB1c2hlZEV2ZW50MjUxODQ4NTc1Mg==">
  
        


  <div data-team-hovercards-enabled="" id="event-2520418561">
  
  <div>

    

        <p><a data-hovercard-type="user" data-hovercard-url="/users/jashook/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jashook"><img height="20" width="20" alt="@jashook" src="https://avatars1.githubusercontent.com/u/2723327?s=60&amp;v=4"></a>
  <a data-hovercard-type="user" data-hovercard-url="/users/jashook/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jashook">jashook</a>
  


      
changed the title
<del>Remove tailcall limitations on unix64 and arm64</del>

<ins>[WIP] Remove tailcall limitations on unix64 and arm64</ins></p><a href="#event-2520418561"><relative-time datetime="2019-07-30T16:23:27Z" title="Jul 30, 2019, 9:23 AM PDT">on Jul 30, 2019</relative-time></a>

  </div>
</div>




</div>

  
  



  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0MzAyMzEyMTk5OjA1MmI0MTc0NDc3ZWFkZDgzMjRiYmY4OWI1NTFmZTNiZjgwMzE0NWQ=">
  
      <div>
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:052b4174477eadd8324bbf89b551fe3bf803145d" data-url="/dotnet/coreclr/pull/25932/commits/052b4174477eadd8324bbf89b551fe3bf803145d/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>Set the stack offset during init of args so that we can use this info
to determine whether it is necessary to introduce temps for fast
tailcalls. Optimize the logic to use these to determine if PUTARG_STK
nodes will override incoming args.</pre>
    </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  



  
  



  
  



  
  



  
  


  
  



  
  



  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0MzAyMzEyMTk5OjMxOWM5NmFkN2IwOTk2NzE1NjAyMjI1ODJhOTYxMzU3NTM5MTQyZTc=">
  
      <div>
    
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:319c96ad7b099671560222582a961357539142e7" data-url="/dotnet/coreclr/pull/25932/commits/319c96ad7b099671560222582a961357539142e7/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>On Unix64 it is possible for us to get into cases where we need to move
an argument but where we previously did not introduce a temp. This is a
problem because codegen cannot handle overlapping disjoint struct
copies. The case observed was (with all args on the stack):
caller(S32 erStack1) -&gt; callee(S16 eeStack1, S32 eeStack2)
caller passing erStack1 as eeStack2, so it is needed to be moved 16
bytes ahead in the arg list. Additionally, the PUTARG_STK node for this
argument ends up as the _first_ arg. Since there are no additional uses
no temp was introduced before.

Fix this by detecting the disjoint overlapping case and looking for uses
of the arg from the current PUTARG_STK node's operand.</pre>
    </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:5684995e5c94ab5344bd0e6b94dcec2cb43b6ed4" data-url="/dotnet/coreclr/pull/25932/commits/5684995e5c94ab5344bd0e6b94dcec2cb43b6ed4/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>On Windows we can use the arg positions to much more simply find the
args being overwritten.</pre>
    </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:385fc9525fba9e17ebcf5d0b54d4b6a1e6bc025f" data-url="/dotnet/coreclr/pull/25932/commits/385fc9525fba9e17ebcf5d0b54d4b6a1e6bc025f/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:2557b16713813ea6beff52b8f9872aa3618bc29c" data-url="/dotnet/coreclr/pull/25932/commits/2557b16713813ea6beff52b8f9872aa3618bc29c/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This gives us access to the number of slots in PUTARG_STK</pre>
    </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:1ddea41ff8220e3f026a1771847a2e9099f4ffa7" data-url="/dotnet/coreclr/pull/25932/commits/1ddea41ff8220e3f026a1771847a2e9099f4ffa7/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/jakobbotsch/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jakobbotsch">
          <img height="20" width="20" alt="@jakobbotsch" src="https://avatars1.githubusercontent.com/u/7887810?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  


  
  



  
  



  
  



  
  



  
  



  
  


  
  



  
  







<!-- Rendered timeline since 2019-08-20 09:13:56 -->



      </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>