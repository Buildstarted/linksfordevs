<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Org Mode - Organize Your Life In Plain Text! - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Org Mode - Organize Your Life In Plain Text! - linksfor.dev(s)"/>
    <meta property="article:author" content="Bernt Hansen (IRC: BerntH on freenode)"/>
    <meta property="og:description" content="A description of how I currently use org-mode"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://doc.norang.ca/org-mode.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Org Mode - Organize Your Life In Plain Text!</title>
<div class="readable">
        <h1>Org Mode - Organize Your Life In Plain Text!</h1>
            <div>by Bernt Hansen (IRC: BerntH on freenode)</div>
            <div>Reading time: 120-153 minutes</div>
        <div>Posted here: 25 May 2020</div>
        <p><a href="http://doc.norang.ca/org-mode.html">http://doc.norang.ca/org-mode.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="content">


<p>
Org-mode is a fabulous organizational tool originally built by Carsten
Dominik that operates on plain text files.  Org-mode is part of Emacs.
</p>

<div id="outline-container-HowToUseThisDocument">
<h2 id="HowToUseThisDocument"><a id="sec-1" name="sec-1"></a><span>1</span> How To Use This Document</h2>
<div id="text-HowToUseThisDocument">


<p>
This document assumes you've had some exposure to org-mode already so
concepts like the agenda, capture mode, etc.  won't be completely
foreign to you.  More information about org-mode can be found in the
<a href="http://orgmode.org/index.html#sec-4.1">Org-Mode Manual</a> and on the <a href="http://orgmode.org/worg/">Worg Site</a>.
</p>

<p>
I have been using org-mode as my personal information manager for
years now.  I started small with just the default <code>TODO</code> and <code>DONE</code>
keywords.  I added small changes to my workflow and over time it
evolved into what is described by this document.
</p>

<p>
I still change my workflow and try new things regularly.  This
document describes mature workflows in my current org-mode setup.  I
tend to document changes to my workflow 30 days after implementing
them (assuming they are still around at that point) so that the new
workflow has a chance to mature.
</p>

<p>
Some of the customized Emacs settings described in this document are
set at their default values.  This explicitly shows the setting for
important org-mode variables used in my workflow and to keep my
workflow behaviour stable in the event that the default value changes
in the future.
</p>

<p>
This document is available as an <a href="http://doc.norang.ca/org-mode.org">org file</a> which you can load in Emacs
and tangle with <code>C-c C-v C-t</code> which will create org-mode.el in the
same directory as the org-mode.org file.  This will extract all of the
elisp examples in this document into a file you can include in your
.emacs file.
</p>
</div>
</div>
<div id="outline-container-License">
<h2 id="License"><a id="sec-2" name="sec-2"></a><span>2</span> License</h2>
<div id="text-License">


<pre>Copyright (C)  2013  Bernt Hansen.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
  
Code in this document is free software: you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation, either
version 3 of the License, or (at your option) any later version.
  
This code is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
</pre>

<p>
This document <a href="http://doc.norang.ca/org-mode.html">http://doc.norang.ca/org-mode.html</a> (either in its
<a href="http://doc.norang.ca/org-mode.html">HTML format</a> or in its <a href="http://doc.norang.ca/org-mode.org">Org format</a>) is licensed under the GNU Free
Documentation License version 1.3 or later
(<a href="http://www.gnu.org/copyleft/fdl.html">http://www.gnu.org/copyleft/fdl.html</a>).
</p>

<p>
The code examples and CSS stylesheets are licensed under the GNU
General Public License v3 or later
(<a href="http://www.gnu.org/licenses/gpl.html">http://www.gnu.org/licenses/gpl.html</a>).
</p>
</div>
</div>
<div id="outline-container-ChangeHistory">
<h2 id="ChangeHistory"><a id="sec-3" name="sec-3"></a><span>3</span> Change History - What's new</h2>
<div id="text-ChangeHistory">

<p>
This is version <code>2015.06-5-gf5bb</code> of this document.  This
document is created using the publishing features of <code>org-mode</code> git
version <code>release_8.2.10-42-g2e1bc42</code>.
</p>

<p>
The source for this document can be found as a <a href="http://doc.norang.ca/org-mode.org">plain text org file</a>.  I
try to update this document about once a month.
</p>

<p>
The change history for this document can be found at
<a href="http://git.norang.ca/?p=org-mode-doc.git;a=summary">git://git.norang.ca/org-mode-doc.git</a>.
</p>
</div>
</div>
<div id="outline-container-GettingStarted">
<h2 id="GettingStarted"><a id="sec-4" name="sec-4"></a><span>4</span> Getting Started</h2>
<p>
Getting started with <code>org-mode</code> is really easy.  You only need a few lines in your
emacs startup to use the latest version of org-mode from the <code>git</code> repository.
</p>
<div id="outline-container-GettingOrgModeWithGit">
<h3 id="GettingOrgModeWithGit"><a id="sec-4-1" name="sec-4-1"></a><span>4.1</span> Getting org-mode with Git</h3>
<div id="text-GettingOrgModeWithGit">


<p>
I keep a copy of the org-mode <code>git</code> repository in <code>~/git/org-mode/</code>.  This clone
was created with
</p>
<div>

<pre><span>cd</span> ~/git
git clone git://orgmode.org/org-mode.git
</pre>
</div>

<p>
To update and get new commits from the org-mode developers you can use 
</p>
<div>

<pre><span>cd</span> ~/git/org-mode
git pull
make uncompiled
</pre>
</div>

<p>
I run uncompiled source files in my setup so the uncompiled <code>make</code> target is all you need.
</p>

<p>
I normally track the <code>master</code> branch in the org-mode repository.
</p>
</div>
</div>
<div id="outline-container-Setup">
<h3 id="Setup"><a id="sec-4-2" name="sec-4-2"></a><span>4.2</span> Org-Mode Setup</h3>
<div id="text-Setup">

<p>
The following setup in my .emacs enables <code>org-mode</code> for most buffers.
<code>org-mode</code> is the default mode for <code>.org</code>, <code>.org_archive</code>, and <code>.txt</code>
files.
</p>

<div>

<pre><span>;;;</span>
<span>;;; </span><span>Org Mode</span>
<span>;;;</span>
(add-to-list 'load-path (expand-file-name <span>"~/git/org-mode/lisp"</span>))
(add-to-list 'auto-mode-alist '(<span>"\\.</span><span>\\</span><span>(</span><span>org</span><span>\\</span><span>|</span><span>org_archive</span><span>\\</span><span>|</span><span>txt</span><span>\\</span><span>)</span><span>$"</span> . org-mode))
(<span>require</span> '<span>org</span>)
<span>;;</span>
<span>;; </span><span>Standard key bindings</span>
(global-set-key <span>"\C-cl"</span> 'org-store-link)
(global-set-key <span>"\C-ca"</span> 'org-agenda)
(global-set-key <span>"\C-cb"</span> 'org-iswitchb)
</pre>
</div>

<p>
That's all you need to get started using headlines and lists in org-mode.
</p>

<p>
The rest of this document describes customizations I use in my setup,
how I structure org-mode files, and other changes to fit the way I
want org-mode to work.
</p>
</div>
</div>
<div id="outline-container-OrgFiles">
<h3 id="OrgFiles"><a id="sec-4-3" name="sec-4-3"></a><span>4.3</span> Organizing Your Life Into Org Files</h3>
<div id="text-OrgFiles">

<p>
Tasks are separated into logical groupings or projects.  
Use separate org files for large task groupings and 
subdirectories for collections of files for multiple
projects that belong together.
</p>

<p>
Here are sample files that I use.
</p>

<p>
The following org files collect non-work related tasks:
</p>

<table>


<colgroup>
<col>

<col>
</colgroup>
<thead>
<tr>
<th scope="col">Filename</th>
<th scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>todo.org</td>
<td>Personal tasks and things to keep track of</td>
</tr>

<tr>
<td>gsoc2009.org</td>
<td>Google Summer of Code stuff for 2009</td>
</tr>

<tr>
<td>farm.org</td>
<td>Farm related tasks</td>
</tr>

<tr>
<td>mark.org</td>
<td>Tasks related to my son Mark</td>
</tr>

<tr>
<td>org.org</td>
<td>Org-mode related tasks</td>
</tr>

<tr>
<td>git.org</td>
<td>Git related tasks</td>
</tr>
</tbody>
</table>

<p>
The following org-file collects org capture notes and tasks:
</p>

<table>


<colgroup>
<col>

<col>
</colgroup>
<thead>
<tr>
<th scope="col">Filename</th>
<th scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>refile.org</td>
<td>Capture task bucket</td>
</tr>
</tbody>
</table>

<p>
The following work-related org-files keep my business notes (using
fictitious client names)
</p>

<table>


<colgroup>
<col>

<col>
</colgroup>
<thead>
<tr>
<th scope="col">Filename</th>
<th scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>norang.org</td>
<td>Norang tasks and notes</td>
</tr>

<tr>
<td>XYZ.org</td>
<td>XYZ Corp tasks and notes</td>
</tr>

<tr>
<td>ABC.org</td>
<td>ABC Ltd tasks</td>
</tr>

<tr>
<td>ABC-DEF.org</td>
<td>ABC Ltd tasks for their client DEF Corp</td>
</tr>

<tr>
<td>ABC-KKK.org</td>
<td>ABC Ltd tasks for their client KKK Inc</td>
</tr>

<tr>
<td>YYY.org</td>
<td>YYY Inc tasks</td>
</tr>
</tbody>
</table>

<p>
Org-mode is great for dealing with multiple clients and client
projects.  An org file becomes the collection of projects, notes,
etc. for a single client or client-project.
</p>

<p>
Client ABC Ltd. has multiple customer systems that I work on.
Separating the tasks for each client-customer into separate org files
helps keep things logically grouped and since clients come and go this
allows entire org files to be added or dropped from my agenda to keep
only what is important visible in agenda views.
</p>

<p>
Other org files are used for publishing only and do not contribute to the agenda.
See <a href="#Publishing">Publishing and Exporting</a> for more details.
</p>
</div>
</div>
<div id="outline-container-AgendaSetup">
<h3 id="AgendaSetup"><a id="sec-4-4" name="sec-4-4"></a><span>4.4</span> Agenda Setup</h3>
<div id="text-AgendaSetup">

<p>
Here is my current <code>org-agenda-files</code> setup.
</p>
<div>

<pre>(setq org-agenda-files (quote (<span>"~/git/org"</span>
                               <span>"~/git/org/client1"</span>
                               <span>"~/git/client2"</span>)))
</pre>
</div>

<p>
<code>org-mode</code> manages the <code>org-agenda-files</code> variable automatically using
<code>C-c [</code> and <code>C-c ]</code> to add and remove files respectively.  However,
this replaces my directory list with a list of explicit filenames
instead and is not what I want.  If this occurs then adding a new org
file to any of the above directories will not contribute to my agenda
and I will probably miss something important.
</p>

<p>
I have disabled the <code>C-c [</code> and <code>C-c ]</code> keys in <code>org-mode-hook</code> to
prevent messing up my list of directories in the <code>org-agenda-files</code>
variable.  I just add and remove directories manually in my <code>.emacs</code>
file.  Changing the list of directories in <code>org-agenda-files</code> happens
very rarely since new files in existing directories are automatically
picked up.
</p>

<p>
I also disable the comment function <code>C-c ;</code> since I never use those.
I kept accidentally hitting this key sequence when doing <code>C-c
singlequote</code> for editing source blocks.
</p>

<p>
In the example above I have <code>~/git/client2</code> in a separate git
repository from ~/git/org.  This gives me the flexibility of leaving
confidential information at the client site and having all of my
personal information available everywhere I use org-mode.  I
synchronize my personal repositories on multiple machines and skip the
confidential info on the non-client laptop I travel with.
<code>org-agenda-files</code> on this laptop does not include the <code>~/git/client2</code>
directory.
</p>
</div>
</div>
<div id="outline-container-OrgFileStructure">
<h3 id="OrgFileStructure"><a id="sec-4-5" name="sec-4-5"></a><span>4.5</span> Org File Structure</h3>
<div id="text-OrgFileStructure">

<p>
Most of my org files are set up with level 1 headings as main
categories only.  Tasks and projects normally start as level 2.
</p>

<p>
Here are some examples of my level 1 headings in
</p>

<p>
<code>todo.org</code>:
</p>

<ul>
<li>Special Dates

<p>
Includes level 2 headings for
</p>

<ul>
<li>Birthdays
</li>
<li>Anniversaries
</li>
<li>Holidays
</li>
</ul>
</li>

<li>Finances
</li>
<li>Health and Recreation
</li>
<li>House Maintenance
</li>
<li>Lawn and Garden Maintenance
</li>
<li>Notes
</li>
<li>Tasks
</li>
<li>Vehicle Maintenance
</li>
<li>Passwords
</li>
</ul>


<p>
<code>norang.org</code>:
</p>

<ul>
<li>System Maintenance
</li>
<li>Payroll
</li>
<li>Accounting
</li>
<li>Finances
</li>
<li>Hardware Maintenance
</li>
<li>Tasks
</li>
<li>Research and Development
</li>
<li>Notes
</li>
<li>Purchase Order Tracking
</li>
<li>Passwords
</li>
</ul>

<p>
Each of these level 1 tasks normally has a <code>property drawer</code>
specifying the category for any tasks in that tree.  Level 1 headings
are set up like this:
</p>

<div>

<pre><span>* Health and Recreation</span>
<span>  :PROPERTIES:</span>
  <span>:CATEGORY:</span> Health
<span>  :END:</span>
  ...
<span>* House Maintenance</span>
<span>  :PROPERTIES:</span>
  <span>:CATEGORY:</span> House
<span>  :END:</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-KeyBindings">
<h3 id="KeyBindings"><a id="sec-4-6" name="sec-4-6"></a><span>4.6</span> Key bindings</h3>
<div id="text-KeyBindings">

<p>
I live in the agenda.  To make getting to the agenda faster I mapped
<code>F12</code> to the sequence <code>C-c a</code> since I'm using it hundreds of times a
day.
</p>

<p>
I have the following custom key bindings set up for my emacs (sorted by frequency).
</p>

<table>


<colgroup>
<col>

<col>

<col>
</colgroup>
<thead>
<tr>
<th scope="col">Key</th>
<th scope="col">For</th>
<th scope="col">Used</th>
</tr>
</thead>
<tbody>
<tr>
<td>F12</td>
<td>Agenda (1 key less than C-c a)</td>
<td>Very Often</td>
</tr>

<tr>
<td>C-c b</td>
<td>Switch to org file</td>
<td>Very Often</td>
</tr>

<tr>
<td>F11</td>
<td>Goto currently clocked item</td>
<td>Very Often</td>
</tr>

<tr>
<td>C-c c</td>
<td>Capture a task</td>
<td>Very Often</td>
</tr>

<tr>
<td>C-F11</td>
<td>Clock in a task (show menu with prefix)</td>
<td>Often</td>
</tr>

<tr>
<td>f9 g</td>
<td>Gnus - I check mail regularly</td>
<td>Often</td>
</tr>

<tr>
<td>f5</td>
<td>Show todo items for this subtree</td>
<td>Often</td>
</tr>

<tr>
<td>S-f5</td>
<td>Widen</td>
<td>Often</td>
</tr>

<tr>
<td>f9 b</td>
<td>Quick access to bbdb data</td>
<td>Often</td>
</tr>

<tr>
<td>f9 c</td>
<td>Calendar access</td>
<td>Often</td>
</tr>

<tr>
<td>C-S-f12</td>
<td>Save buffers and publish current project</td>
<td>Often</td>
</tr>

<tr>
<td>C-c l</td>
<td>Store a link for retrieval with C-c C-l</td>
<td>Often</td>
</tr>

<tr>
<td>f8</td>
<td>Go to next org file in org-agenda-files</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 r</td>
<td>Boxquote selected region</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 t</td>
<td>Insert inactive timestamp</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 v</td>
<td>Toggle visible mode (for showing/editing links)</td>
<td>Sometimes</td>
</tr>

<tr>
<td>C-f9</td>
<td>Previous buffer</td>
<td>Sometimes</td>
</tr>

<tr>
<td>C-f10</td>
<td>Next buffer</td>
<td>Sometimes</td>
</tr>

<tr>
<td>C-x n r</td>
<td>Narrow to region</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 f</td>
<td>Boxquote insert a file</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 i</td>
<td>Info manual</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 I</td>
<td>Punch Clock In</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 O</td>
<td>Punch Clock Out</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 o</td>
<td>Switch to org scratch buffer</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 s</td>
<td>Switch to scratch buffer</td>
<td>Sometimes</td>
</tr>

<tr>
<td>f9 h</td>
<td>Hide other tasks</td>
<td>Rare</td>
</tr>

<tr>
<td>f7</td>
<td>Toggle line truncation/wrap</td>
<td>Rare</td>
</tr>

<tr>
<td>f9 T</td>
<td>Toggle insert inactive timestamp</td>
<td>Rare</td>
</tr>

<tr>
<td>C-c a</td>
<td>Enter Agenda (minimal emacs testing)</td>
<td>Rare</td>
</tr>
</tbody>
</table>

<p>
Here is the keybinding setup in lisp:
</p>
<div>

<pre><span>;; </span><span>Custom Key Bindings</span>
(global-set-key (kbd <span>"&lt;f12&gt;"</span>) 'org-agenda)
(global-set-key (kbd <span>"&lt;f5&gt;"</span>) 'bh/org-todo)
(global-set-key (kbd <span>"&lt;S-f5&gt;"</span>) 'bh/widen)
(global-set-key (kbd <span>"&lt;f7&gt;"</span>) 'bh/set-truncate-lines)
(global-set-key (kbd <span>"&lt;f8&gt;"</span>) 'org-cycle-agenda-files)
(global-set-key (kbd <span>"&lt;f9&gt; &lt;f9&gt;"</span>) 'bh/show-org-agenda)
(global-set-key (kbd <span>"&lt;f9&gt; b"</span>) 'bbdb)
(global-set-key (kbd <span>"&lt;f9&gt; c"</span>) 'calendar)
(global-set-key (kbd <span>"&lt;f9&gt; f"</span>) 'boxquote-insert-file)
(global-set-key (kbd <span>"&lt;f9&gt; g"</span>) 'gnus)
(global-set-key (kbd <span>"&lt;f9&gt; h"</span>) 'bh/hide-other)
(global-set-key (kbd <span>"&lt;f9&gt; n"</span>) 'bh/toggle-next-task-display)

(global-set-key (kbd <span>"&lt;f9&gt; I"</span>) 'bh/punch-in)
(global-set-key (kbd <span>"&lt;f9&gt; O"</span>) 'bh/punch-out)

(global-set-key (kbd <span>"&lt;f9&gt; o"</span>) 'bh/make-org-scratch)

(global-set-key (kbd <span>"&lt;f9&gt; r"</span>) 'boxquote-region)
(global-set-key (kbd <span>"&lt;f9&gt; s"</span>) 'bh/switch-to-scratch)

(global-set-key (kbd <span>"&lt;f9&gt; t"</span>) 'bh/insert-inactive-timestamp)
(global-set-key (kbd <span>"&lt;f9&gt; T"</span>) 'bh/toggle-insert-inactive-timestamp)

(global-set-key (kbd <span>"&lt;f9&gt; v"</span>) 'visible-mode)
(global-set-key (kbd <span>"&lt;f9&gt; l"</span>) 'org-toggle-link-display)
(global-set-key (kbd <span>"&lt;f9&gt; SPC"</span>) 'bh/clock-in-last-task)
(global-set-key (kbd <span>"C-&lt;f9&gt;"</span>) 'previous-buffer)
(global-set-key (kbd <span>"M-&lt;f9&gt;"</span>) 'org-toggle-inline-images)
(global-set-key (kbd <span>"C-x n r"</span>) 'narrow-to-region)
(global-set-key (kbd <span>"C-&lt;f10&gt;"</span>) 'next-buffer)
(global-set-key (kbd <span>"&lt;f11&gt;"</span>) 'org-clock-goto)
(global-set-key (kbd <span>"C-&lt;f11&gt;"</span>) 'org-clock-in)
(global-set-key (kbd <span>"C-s-&lt;f12&gt;"</span>) 'bh/save-then-publish)
(global-set-key (kbd <span>"C-c c"</span>) 'org-capture)

(<span>defun</span> <span>bh/hide-other</span> ()
  (interactive)
  (<span>save-excursion</span>
    (org-back-to-heading 'invisible-ok)
    (hide-other)
    (org-cycle)
    (org-cycle)
    (org-cycle)))

(<span>defun</span> <span>bh/set-truncate-lines</span> ()
  <span>"Toggle value of truncate-lines and refresh window display."</span>
  (interactive)
  (setq truncate-lines (not truncate-lines))
  <span>;; </span><span>now refresh window display (an idiom from simple.el):</span>
  (<span>save-excursion</span>
    (set-window-start (selected-window)
                      (window-start (selected-window)))))

(<span>defun</span> <span>bh/make-org-scratch</span> ()
  (interactive)
  (find-file <span>"/tmp/publish/scratch.org"</span>)
  (gnus-make-directory <span>"/tmp/publish"</span>))

(<span>defun</span> <span>bh/switch-to-scratch</span> ()
  (interactive)
  (switch-to-buffer <span>"*scratch*"</span>))
</pre>
</div>

<p>
The main reason I have special key bindings (like <code>F11</code>, and <code>F12</code>) is
so that the keys work in any mode.  If I'm in the Gnus summary buffer
then <code>C-u C-c C-x C-i</code> doesn't work, but the <code>C-F11</code> key combination
does and this saves me time since I don't have to visit an org-mode
buffer first just to clock in a recent task.
</p>
</div>
</div>
</div>
<div id="outline-container-TasksAndStates">
<h2 id="TasksAndStates"><a id="sec-5" name="sec-5"></a><span>5</span> Tasks and States</h2>
<div id="text-TasksAndStates">

<p>
I use one set of TODO keywords for all of my org files.  Org-mode lets
you define TODO keywords per file but I find it's easier to have a
standard set of TODO keywords globally so I can use the same setup in
any org file I'm working with.
</p>

<p>
The only exception to this is this document :) since I don't want
<code>org-mode</code> hiding the <code>TODO</code> keyword when it appears in headlines.
I've set up a dummy <code>#+SEQ_TODO: FIXME FIXED</code> entry at the top of this
file just to leave my <code>TODO</code> keyword untouched in this document.
</p>
</div>
<div id="outline-container-TodoKeywords">
<h3 id="TodoKeywords"><a id="sec-5-1" name="sec-5-1"></a><span>5.1</span> TODO keywords</h3>
<div id="text-TodoKeywords">

<p>
I use a light colour theme in emacs.  I find this easier to read on bright sunny days.
</p>

<p>
Here are my <code>TODO</code> state keywords and colour settings:
</p>

<div>

<pre>(setq org-todo-keywords
      (quote ((sequence <span>"TODO(t)"</span> <span>"NEXT(n)"</span> <span>"|"</span> <span>"DONE(d)"</span>)
              (sequence <span>"WAITING(w@/!)"</span> <span>"HOLD(h@/!)"</span> <span>"|"</span> <span>"CANCELLED(c@/!)"</span> <span>"PHONE"</span> <span>"MEETING"</span>))))

(setq org-todo-keyword-faces
      (quote ((<span>"TODO"</span> <span>:foreground</span> <span>"red"</span> <span>:weight</span> bold)
              (<span>"NEXT"</span> <span>:foreground</span> <span>"blue"</span> <span>:weight</span> bold)
              (<span>"DONE"</span> <span>:foreground</span> <span>"forest green"</span> <span>:weight</span> bold)
              (<span>"WAITING"</span> <span>:foreground</span> <span>"orange"</span> <span>:weight</span> bold)
              (<span>"HOLD"</span> <span>:foreground</span> <span>"magenta"</span> <span>:weight</span> bold)
              (<span>"CANCELLED"</span> <span>:foreground</span> <span>"forest green"</span> <span>:weight</span> bold)
              (<span>"MEETING"</span> <span>:foreground</span> <span>"forest green"</span> <span>:weight</span> bold)
              (<span>"PHONE"</span> <span>:foreground</span> <span>"forest green"</span> <span>:weight</span> bold))))
</pre>
</div>
</div>
<div id="outline-container-TodoKeywordTaskStates">
<h4 id="TodoKeywordTaskStates"><a id="sec-5-1-1" name="sec-5-1-1"></a><span>5.1.1</span> Task States</h4>
<div id="text-TodoKeywordTaskStates">

<p>
Tasks go through the sequence <code>TODO</code> -&gt; <code>DONE</code>.
</p>

<p>
The following diagram shows the possible state transitions for a task.
</p>


<p><img src="http://doc.norang.ca/normal_task_states.png" alt="normal_task_states.png">
</p>
</div>
</div>

<div id="outline-container-TodoKeywordProjectTaskStates">
<h4 id="TodoKeywordProjectTaskStates"><a id="sec-5-1-2" name="sec-5-1-2"></a><span>5.1.2</span> Project Task States</h4>
<div id="text-TodoKeywordProjectTaskStates">

<p>
I use a lazy project definition.  I don't like to bother with manually
stating 'this is a project' and 'that is not a project'.  For me a project
definition is really simple.  If a task has subtasks with a todo keyword
then it's a project.  That's it.
</p>

<p>
Projects can be defined at any level - just create a task with a todo
state keyword that has at least one subtask also with a todo state
keyword and you have a project.  Projects use the same todo keywords
as regular tasks.  One subtask of a project needs to be marked <code>NEXT</code>
so the project is not on the stuck projects list.
</p>
</div>
</div>
<div id="outline-container-TodoKeywordPhoneCalls">
<h4 id="TodoKeywordPhoneCalls"><a id="sec-5-1-3" name="sec-5-1-3"></a><span>5.1.3</span> Phone Calls</h4>
<div id="text-TodoKeywordPhoneCalls">

<p>
Telephone calls are special.  They are created in a done state by a capture task.
The time of the call is recorded for as long as the capture task is active.  If I need 
to look up other details and want to close the capture task early I can just 
<code>C-c C-c</code> to close the capture task (stopping the clock) and then <code>f9 SPC</code> to resume
the clock in the phone call while I do other things.
</p>

<p><img src="http://doc.norang.ca/phone_states.png" alt="phone_states.png">
</p>
</div>
</div>

<div id="outline-container-TodoKeywordMeetings">
<h4 id="TodoKeywordMeetings"><a id="sec-5-1-4" name="sec-5-1-4"></a><span>5.1.4</span> Meetings</h4>
<div id="text-TodoKeywordMeetings">

<p>
Meetings are special.  They are created in a done state by a capture
task.  I use the MEETING capture template when someone interrupts what
I'm doing with a question or discussion.  This is handled similarly to
phone calls where I clock the amount of time spent with whomever it is
and record some notes of what was discussed (either during or after
the meeting) depending on content, length, and complexity of the
discussion.
</p>

<p>
The time of the meeting is recorded for as long as the capture task is
active.  If I need to look up other details and want to close the
capture task early I can just <code>C-c C-c</code> to close the capture task
(stopping the clock) and then <code>f9 SPC</code> to resume the clock in the
meeting task while I do other things.
</p>

<p><img src="http://doc.norang.ca/meeting_states.png" alt="meeting_states.png">
</p>
</div>
</div>
</div>

<div id="outline-container-FastTodoSelection">
<h3 id="FastTodoSelection"><a id="sec-5-2" name="sec-5-2"></a><span>5.2</span> Fast Todo Selection</h3>
<div id="text-FastTodoSelection">

<p>
Fast todo selection allows changing from any task todo state to any
other state directly by selecting the appropriate key from the fast
todo selection key menu.  This is a great feature!
</p>

<div>

<pre>(setq org-use-fast-todo-selection t)
</pre>
</div>

<p>
Changing a task state is done with <code>C-c C-t KEY</code>
</p>

<p>
where <code>KEY</code> is the appropriate fast todo state selection key as defined in <code>org-todo-keywords</code>.
</p>

<p>
The setting
</p>
<div>

<pre>(setq org-treat-S-cursor-todo-selection-as-state-change nil)
</pre>
</div>
<p>
allows changing todo states with S-left and S-right skipping all of
the normal processing when entering or leaving a todo state.  This
cycles through the todo states but skips setting timestamps and
entering notes which is very convenient when all you want to do is fix
up the status of an entry.
</p>
</div>
</div>
<div id="outline-container-ToDoStateTriggers">
<h3 id="ToDoStateTriggers"><a id="sec-5-3" name="sec-5-3"></a><span>5.3</span> TODO state triggers</h3>
<div id="text-ToDoStateTriggers">

<p>
I have a few triggers that automatically assign tags to tasks based on
state changes.  If a task moves to <code>CANCELLED</code> state then it gets a
<code>CANCELLED</code> tag.  Moving a <code>CANCELLED</code> task back to <code>TODO</code> removes the
<code>CANCELLED</code> tag.  These are used for filtering tasks in agenda views
which I'll talk about later.
</p>

<p>
The triggers break down to the following rules:
</p>

<ul>
<li>Moving a task to <code>CANCELLED</code> adds a <code>CANCELLED</code> tag
</li>
<li>Moving a task to <code>WAITING</code> adds a <code>WAITING</code> tag
</li>
<li>Moving a task to <code>HOLD</code> adds <code>WAITING</code> and <code>HOLD</code> tags
</li>
<li>Moving a task to a done state removes <code>WAITING</code> and <code>HOLD</code> tags
</li>
<li>Moving a task to <code>TODO</code> removes <code>WAITING</code>, <code>CANCELLED</code>, and <code>HOLD</code> tags
</li>
<li>Moving a task to <code>NEXT</code> removes <code>WAITING</code>, <code>CANCELLED</code>, and <code>HOLD</code> tags
</li>
<li>Moving a task to <code>DONE</code> removes <code>WAITING</code>, <code>CANCELLED</code>, and <code>HOLD</code> tags
</li>
</ul>

<p>
The tags are used to filter tasks in the agenda views conveniently.
</p>

<div>

<pre>(setq org-todo-state-tags-triggers
      (quote ((<span>"CANCELLED"</span> (<span>"CANCELLED"</span> . t))
              (<span>"WAITING"</span> (<span>"WAITING"</span> . t))
              (<span>"HOLD"</span> (<span>"WAITING"</span>) (<span>"HOLD"</span> . t))
              (done (<span>"WAITING"</span>) (<span>"HOLD"</span>))
              (<span>"TODO"</span> (<span>"WAITING"</span>) (<span>"CANCELLED"</span>) (<span>"HOLD"</span>))
              (<span>"NEXT"</span> (<span>"WAITING"</span>) (<span>"CANCELLED"</span>) (<span>"HOLD"</span>))
              (<span>"DONE"</span> (<span>"WAITING"</span>) (<span>"CANCELLED"</span>) (<span>"HOLD"</span>)))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-Capture">
<h2 id="Capture"><a id="sec-6" name="sec-6"></a><span>6</span> Adding New Tasks Quickly with Org Capture</h2>
<div id="text-Capture">

<p>
Org Capture mode replaces remember mode for capturing tasks and notes.
</p>

<p>
To add new tasks efficiently I use a minimal number of capture
templates.  I used to have lots of capture templates, one for each
org-file.  I'd start org-capture with <code>C-c c</code> and then pick a template
that filed the task under <code>* Tasks</code> in the appropriate file.
</p>

<p>
I found I still needed to refile these capture tasks again to the
correct location within the org-file so all of these different capture
templates weren't really helping at all.  Since then I've changed my
workflow to use a minimal number of capture templates – I create the
new task quickly and refile it once.  This also saves me from
maintaining my org-capture templates when I add a new org file.
</p>
</div>
<div id="outline-container-CaptureTemplates">
<h3 id="CaptureTemplates"><a id="sec-6-1" name="sec-6-1"></a><span>6.1</span> Capture Templates</h3>
<div id="text-CaptureTemplates">

<p>
When a new task needs to be added I categorize it into one of a few
things:
</p>

<ul>
<li>A phone call (p)
</li>
<li>A meeting (m)
</li>
<li>An email I need to respond to (r)
</li>
<li>A new task (t)
</li>
<li>A new note (n)
</li>
<li>An interruption (j)
</li>
<li>A new habit (h)
</li>
</ul>

<p>
and pick the appropriate capture task.
</p>

<p>
Here is my setup for org-capture
</p>

<div>

<pre>(setq org-directory <span>"~/git/org"</span>)
(setq org-default-notes-file <span>"~/git/org/refile.org"</span>)

<span>;; </span><span>I use C-c c to start capture mode</span>
(global-set-key (kbd <span>"C-c c"</span>) 'org-capture)

<span>;; </span><span>Capture templates for: TODO tasks, Notes, appointments, phone calls, meetings, and org-protocol</span>
(setq org-capture-templates
      (quote ((<span>"t"</span> <span>"todo"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* TODO %?\n%U\n%a\n"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              (<span>"r"</span> <span>"respond"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* NEXT Respond to %:from on %:subject\nSCHEDULED: %t\n%U\n%a\n"</span> <span>:clock-in</span> t <span>:clock-resume</span> t <span>:immediate-finish</span> t)
              (<span>"n"</span> <span>"note"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* %? :NOTE:\n%U\n%a\n"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              (<span>"j"</span> <span>"Journal"</span> entry (file+datetree <span>"~/git/org/diary.org"</span>)
               <span>"* %?\n%U\n"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              (<span>"w"</span> <span>"org-protocol"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* TODO Review %c\n%U\n"</span> <span>:immediate-finish</span> t)
              (<span>"m"</span> <span>"Meeting"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* MEETING with %? :MEETING:\n%U"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              (<span>"p"</span> <span>"Phone call"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* PHONE %? :PHONE:\n%U"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              (<span>"h"</span> <span>"Habit"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* NEXT %?\n%U\n%a\nSCHEDULED: %(format-time-string \"%&lt;&lt;%Y-%m-%d %a .+1d/3d&gt;&gt;\")\n:PROPERTIES:\n:STYLE: habit\n:REPEAT_TO_STATE: NEXT\n:END:\n"</span>))))
</pre>
</div>

<p>
Capture mode now handles automatically clocking in and out of a
capture task.  This all works out of the box now without special hooks.
When I start a capture mode task the task is clocked in as specified
by <code>:clock-in t</code> and when the task is filed with <code>C-c C-c</code> the clock 
resumes on the original clocking task.
</p>

<p>
The quick clocking in and out of capture mode tasks (often it takes
less than a minute to capture some new task details) can leave
empty clock drawers in my tasks which aren't really useful.  Since I
remove clocking lines with 0:00 length I end up with a clock drawer
like this:
</p>

<div>

<pre><span>* </span><span>TODO</span><span> New Capture Task</span>
<span>  :LOGBOOK:</span>
<span>  :END:</span>
  <span>[2010-05-08 Sat 13:53]</span>
</pre>
</div>
<p>
I have the following setup to remove these empty <code>LOGBOOK</code> drawers if
they occur.
</p>

<div>

<pre><span>;; </span><span>Remove empty LOGBOOK drawers on clock out</span>
(<span>defun</span> <span>bh/remove-empty-drawer-on-clock-out</span> ()
  (interactive)
  (<span>save-excursion</span>
    (beginning-of-line 0)
    (org-remove-empty-drawer-at <span>"LOGBOOK"</span> (point))))

(add-hook 'org-clock-out-hook 'bh/remove-empty-drawer-on-clock-out 'append)
</pre>
</div>
</div>
</div>

<div id="outline-container-CaptureRefileOrg">
<h3 id="CaptureRefileOrg"><a id="sec-6-2" name="sec-6-2"></a><span>6.2</span> Separate file for Capture Tasks</h3>
<div id="text-CaptureRefileOrg">

<p>
I have a single org file which is the target for my capture templates.
</p>

<p>
I store notes, tasks, phone calls, and org-protocol tasks in
<code>refile.org</code>.  I used to use multiple files but found that didn't
really have any advantage over a single file.
</p>

<p>
Normally this file is empty except for a single line at the top which
creates a <code>REFILE</code> tag for anything in the file.
</p>

<p>
The file has a single permanent line at the top like this
</p>

</div>
</div>
<div id="outline-container-CaptureTasksAreFast">
<h3 id="CaptureTasksAreFast"><a id="sec-6-3" name="sec-6-3"></a><span>6.3</span> Capture Tasks is all about being FAST</h3>
<div id="text-CaptureTasksAreFast">

<p>
Okay I'm in the middle of something and oh yeah - I have to remember
to do that.  I don't stop what I'm doing.  I'm probably clocking a
project I'm working on and I don't want to lose my focus on that but I
can't afford to forget this little thing that just came up.
</p>

<p>
So what do I do?  Hit <code>C-c c</code> to start capture mode and select <code>t</code>
since it's a new task and I get a buffer like this:
</p>



<p>
Enter the details of the TODO item and <code>C-c C-c</code> to file it away in
refile.org and go right back to what I'm really working on secure in
the knowledge that that item isn't going to get lost and I don't have
to think about it anymore at all now.
</p>

<p>
The amount of time I spend entering the captured note is clocked.  The
capture templates are set to automatically clock in and out of the
capture task.  This is great for interruptions and telephone calls
too.
</p>
</div>
</div>
</div>
<div id="outline-container-Refiling">
<h2 id="Refiling"><a id="sec-7" name="sec-7"></a><span>7</span> Refiling Tasks</h2>
<div id="text-Refiling">

<p>
Refiling tasks is easy.  After collecting a bunch of new tasks in my
refile.org file using capture mode I need to move these to the
correct org file and topic.  All of my active org-files are in my
<code>org-agenda-files</code> variable and contribute to the agenda.
</p>

<p>
I collect capture tasks in refile.org for up to a week.  These now
stand out daily on my block agenda and I usually refile them during
the day.  I like to keep my refile task list empty.
</p>
</div>
<div id="outline-container-RefileSetup">
<h3 id="RefileSetup"><a id="sec-7-1" name="sec-7-1"></a><span>7.1</span> Refile Setup</h3>
<div id="text-RefileSetup">

<p>
To refile tasks in org you need to tell it where you want to refile things.
</p>

<p>
In my setup I let any file in <code>org-agenda-files</code> and the current file
contribute to the list of valid refile targets.  
</p>

<p>
I've recently moved to using IDO to complete targets directly.  I find
this to be faster than my previous complete in steps setup.  At first
I didn't like IDO but after reviewing the documentation again and
learning about <code>C-SPC</code> to limit target searches I find it is much
better than my previous complete-in-steps setup.  Now when I want to
refile something I do <code>C-c C-w</code> to start the refile process, then type
something to get some matching targets, then <code>C-SPC</code> to restrict the
matches to the current list, then continue searching with some other
text to find the target I need.  <code>C-j</code> also selects the current
completion as the final target.  I like this a lot.  I show full
outline paths in the targets so I can have the same heading in
multiple subtrees or projects and still tell them apart while
refiling.
</p>

<p>
I now exclude <code>DONE</code> state tasks as valid refile targets.  This helps to keep the
refile target list to a reasonable size.
</p>

<p>
Here is my refile configuration:
</p>
<div>

<pre><span>; </span><span>Targets include this file and any file contributing to the agenda - up to 9 levels deep</span>
(setq org-refile-targets (quote ((nil <span>:maxlevel</span> . 9)
                                 (org-agenda-files <span>:maxlevel</span> . 9))))

<span>; </span><span>Use full outline paths for refile targets - we file directly with IDO</span>
(setq org-refile-use-outline-path t)

<span>; </span><span>Targets complete directly with IDO</span>
(setq org-outline-path-complete-in-steps nil)

<span>; </span><span>Allow refile to create parent tasks with confirmation</span>
(setq org-refile-allow-creating-parent-nodes (quote confirm))

<span>; </span><span>Use IDO for both buffer and file completion and ido-everywhere to t</span>
(setq org-completion-use-ido t)
(setq ido-everywhere t)
(setq ido-max-directory-size 100000)
(ido-mode (quote both))
<span>; </span><span>Use the current window when visiting files and buffers with ido</span>
(setq ido-default-file-method 'selected-window)
(setq ido-default-buffer-method 'selected-window)
<span>; </span><span>Use the current window for indirect buffer display</span>
(setq org-indirect-buffer-display 'current-window)

<span>;;;; </span><span>Refile settings</span>
<span>; </span><span>Exclude DONE state tasks from refile targets</span>
(<span>defun</span> <span>bh/verify-refile-target</span> ()
  <span>"Exclude todo keywords with a done state from refile targets"</span>
  (not (member (nth 2 (org-heading-components)) org-done-keywords)))

(setq org-refile-target-verify-function 'bh/verify-refile-target)
</pre>
</div>

<p>
To refile a task to my <code>norang.org</code> file under <code>System Maintenance</code> I
just put the cursor on the task and hit <code>C-c C-w</code> and enter <code>nor C-SPC
sys RET</code> and it's done.  IDO completion makes locating targets a snap.
</p>
</div>
</div>
<div id="outline-container-RefilingTasks">
<h3 id="RefilingTasks"><a id="sec-7-2" name="sec-7-2"></a><span>7.2</span> Refiling Tasks</h3>
<div id="text-RefilingTasks">

<p>
Tasks to refile are in their own section of the block agenda.  To find
tasks to refile I run my agenda view with <code>F12 SPC</code> and scroll down to
second section of the block agenda: <code>Tasks to Refile</code>.  This view
shows all tasks (even ones marked in a <code>done</code> state).
</p>

<p>
Bulk refiling in the agenda works very well for multiple tasks going
to the same place.  Just mark the tasks with <code>m</code> and then <code>B r</code> to
refile all of them to a new location.  Occasionally I'll also refile
tasks as subtasks of the current clocking task using <code>C-2 C-c C-w</code>
from the <code>refile.org</code> file.
</p>

<p>
Refiling all of my tasks tends to take less than a minute so I
normally do this a couple of times a day.
</p>
</div>
</div>
<div id="outline-container-RefilingNotes">
<h3 id="RefilingNotes"><a id="sec-7-3" name="sec-7-3"></a><span>7.3</span> Refiling Notes</h3>
<div id="text-RefilingNotes">

<p>
I keep a <code>* Notes</code> headline in most of my org-mode files.  Notes have
a <code>NOTE</code> tag which is created by the capture template for notes.  This
allows finding notes across multiple files easily using the agenda
search functions.
</p>

<p>
Notes created by capture tasks go first to <code>refile.org</code> and are later
refiled to the appropriate project file.  Some notes that are project
related get filed to the appropriate project instead of under the
catchall <code>* NOTES</code> task.  Generally these types of notes are specific
to the project and not generally useful – so removing them from the
notes list when the project is archived makes sense.
</p>
</div>
</div>
<div id="outline-container-RefilingPhoneCalls">
<h3 id="RefilingPhoneCalls"><a id="sec-7-4" name="sec-7-4"></a><span>7.4</span> Refiling Phone Calls and Meetings</h3>
<div id="text-RefilingPhoneCalls">

<p>
Phone calls and meetings are handled using capture mode.  I time my
calls and meetings using the capture mode template settings to clock
in and out the capture task while the phone call or meeting is in
progress.
</p>

<p>
Phone call and meeting tasks collect in <code>refile.org</code> and are later
refiled to the appropriate location.  Some phone calls are billable
and we want these tracked in the appropriate category.  I refile my
phone call and meeting tasks under the appropriate project so time
tracking and reports are as accurate as possible.
</p>
</div>
</div>
</div>
<div id="outline-container-CustomAgendaViews">
<h2 id="CustomAgendaViews"><a id="sec-8" name="sec-8"></a><span>8</span> Custom agenda views</h2>
<div id="text-CustomAgendaViews">

<p>
I now have one block agenda view that has everything on it.  I also
keep separate single view agenda commands for use on my slower Eee
PC - since it takes prohibitively long to generate my block agenda on
that slow machine.  I'm striving to simplify my layout with everything
at my fingertips in a single agenda on my workstation which is where I
spend the bulk of my time.
</p>

<p>
Most of my old custom agenda views were rendered obsolete when
filtering functionality was added to the agenda in newer versions of
<code>org-mode</code> and now with block agenda functionality I can combine
everything into a single view.
</p>

<p>
Custom agenda views are used for:
</p>
<ul>
<li>Single block agenda shows the following
<ul>
<li>overview of today
</li>
<li>Finding tasks to be refiled
</li>
<li>Finding stuck projects
</li>
<li>Finding NEXT tasks to work on
</li>
<li>Show all related tasks
</li>
<li>Reviewing projects
</li>
<li>Finding tasks waiting on something
</li>
<li>Findings tasks to be archived
</li>
</ul>
</li>
<li>Finding notes
</li>
<li>Viewing habits
</li>
</ul>

<p>
If I want just today's calendar view then <code>F12 a</code> is still faster than
generating the block agenda - especially if I want to view a week or
month's worth of information, or check my clocking data.  In that case
the extra detail on the block agenda view is never really needed and I
don't want to spend time waiting for it to be generated.
</p>
</div>
<div id="outline-container-CustomAgendaViewSetup">
<h3 id="CustomAgendaViewSetup"><a id="sec-8-1" name="sec-8-1"></a><span>8.1</span> Setup</h3>
<div id="text-CustomAgendaViewSetup">

<div>

<pre><span>;; </span><span>Do not dim blocked tasks</span>
(setq org-agenda-dim-blocked-tasks nil)

<span>;; </span><span>Compact the block agenda view</span>
(setq org-agenda-compact-blocks t)

<span>;; </span><span>Custom agenda command definitions</span>
(setq org-agenda-custom-commands
      (quote ((<span>"N"</span> <span>"Notes"</span> tags <span>"NOTE"</span>
               ((org-agenda-overriding-header <span>"Notes"</span>)
                (org-tags-match-list-sublevels t)))
              (<span>"h"</span> <span>"Habits"</span> tags-todo <span>"STYLE=\"habit\""</span>
               ((org-agenda-overriding-header <span>"Habits"</span>)
                (org-agenda-sorting-strategy
                 '(todo-state-down effort-up category-keep))))
              (<span>" "</span> <span>"Agenda"</span>
               ((agenda <span>""</span> nil)
                (tags <span>"REFILE"</span>
                      ((org-agenda-overriding-header <span>"Tasks to Refile"</span>)
                       (org-tags-match-list-sublevels nil)))
                (tags-todo <span>"-CANCELLED/!"</span>
                           ((org-agenda-overriding-header <span>"Stuck Projects"</span>)
                            (org-agenda-skip-function 'bh/skip-non-stuck-projects)
                            (org-agenda-sorting-strategy
                             '(category-keep))))
                (tags-todo <span>"-HOLD-CANCELLED/!"</span>
                           ((org-agenda-overriding-header <span>"Projects"</span>)
                            (org-agenda-skip-function 'bh/skip-non-projects)
                            (org-tags-match-list-sublevels 'indented)
                            (org-agenda-sorting-strategy
                             '(category-keep))))
                (tags-todo <span>"-CANCELLED/!NEXT"</span>
                           ((org-agenda-overriding-header (concat <span>"Project Next Tasks"</span>
                                                                  (<span>if</span> bh/hide-scheduled-and-waiting-next-tasks
                                                                      <span>""</span>
                                                                    <span>" (including WAITING and SCHEDULED tasks)"</span>)))
                            (org-agenda-skip-function 'bh/skip-projects-and-habits-and-single-tasks)
                            (org-tags-match-list-sublevels t)
                            (org-agenda-todo-ignore-scheduled bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-deadlines bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-with-date bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-sorting-strategy
                             '(todo-state-down effort-up category-keep))))
                (tags-todo <span>"-REFILE-CANCELLED-WAITING-HOLD/!"</span>
                           ((org-agenda-overriding-header (concat <span>"Project Subtasks"</span>
                                                                  (<span>if</span> bh/hide-scheduled-and-waiting-next-tasks
                                                                      <span>""</span>
                                                                    <span>" (including WAITING and SCHEDULED tasks)"</span>)))
                            (org-agenda-skip-function 'bh/skip-non-project-tasks)
                            (org-agenda-todo-ignore-scheduled bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-deadlines bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-with-date bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-sorting-strategy
                             '(category-keep))))
                (tags-todo <span>"-REFILE-CANCELLED-WAITING-HOLD/!"</span>
                           ((org-agenda-overriding-header (concat <span>"Standalone Tasks"</span>
                                                                  (<span>if</span> bh/hide-scheduled-and-waiting-next-tasks
                                                                      <span>""</span>
                                                                    <span>" (including WAITING and SCHEDULED tasks)"</span>)))
                            (org-agenda-skip-function 'bh/skip-project-tasks)
                            (org-agenda-todo-ignore-scheduled bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-deadlines bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-with-date bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-sorting-strategy
                             '(category-keep))))
                (tags-todo <span>"-CANCELLED+WAITING|HOLD/!"</span>
                           ((org-agenda-overriding-header (concat <span>"Waiting and Postponed Tasks"</span>
                                                                  (<span>if</span> bh/hide-scheduled-and-waiting-next-tasks
                                                                      <span>""</span>
                                                                    <span>" (including WAITING and SCHEDULED tasks)"</span>)))
                            (org-agenda-skip-function 'bh/skip-non-tasks)
                            (org-tags-match-list-sublevels nil)
                            (org-agenda-todo-ignore-scheduled bh/hide-scheduled-and-waiting-next-tasks)
                            (org-agenda-todo-ignore-deadlines bh/hide-scheduled-and-waiting-next-tasks)))
                (tags <span>"-REFILE/"</span>
                      ((org-agenda-overriding-header <span>"Tasks to Archive"</span>)
                       (org-agenda-skip-function 'bh/skip-non-archivable-tasks)
                       (org-tags-match-list-sublevels nil))))
               nil))))
</pre>
</div>

<p>
My block agenda view looks like this when not narrowed to a project.
This shows top-level projects and <code>NEXT</code> tasks but hides the project details since
we are not focused on any particular project.
</p>

<p>
<b>NOTE:</b> This agenda screen shot is out of date and does not currently match the agenda setup in this document.
This will be fixed soon.
</p>


<p><img src="http://doc.norang.ca/block-agenda-nonproject.png" alt="block-agenda-nonproject.png">
</p>

<p>
After selecting a project (with <code>P</code> on any task in the agenda) the block agenda changes to show the project and
any subprojects in the Projects section.  Tasks show project-related tasks that are hidden when not
narrowed to a project.
</p>

<p>
This makes it easy to focus on the task at hand.
</p>

<p>
<b>NOTE:</b> This agenda screen shot is out of date and does not currently match the agenda setup in this document.
This will be fixed soon.
</p>



<p><img src="http://doc.norang.ca/block-agenda-project.png" alt="block-agenda-project.png">
</p>

<p>
I generally work top-down on the agenda.  Things with deadlines and
scheduled dates (planned to work on today or earlier) show up in the
agenda at the top.
</p>

<p>
My day goes generally like this:
</p>

<ul>
<li>Punch in (this starts the clock on the default task)
</li>
<li>Look at the agenda and make a mental note of anything important to deal with today
</li>
<li>Read email and news
<ul>
<li>create notes, and tasks for things that need responses with org-capture
</li>
</ul>
</li>
<li>Check refile tasks and respond to emails
</li>
<li>Look at my agenda and work on important tasks for today
<ul>
<li>Clock it in
</li>
<li>Work on it until it is <code>DONE</code> or it gets interrupted
</li>
</ul>
</li>
<li>Work on tasks
</li>
<li>Make journal entries (<code>C-c c j</code>) for interruptions
</li>
<li>Punch out for lunch and punch back in after lunch
</li>
<li>work on more tasks
</li>
<li>Refile tasks to empty the list
<ul>
<li>Tag tasks to be refiled with <code>m</code> collecting all tasks for the same target
</li>
<li>Bulk refile the tasks to the target location with <code>B r</code>
</li>
<li>Repeat (or refile individually with <code>C-c C-w</code>) until all refile tasks are gone
</li>
</ul>
</li>
<li>Mark habits done today as DONE
</li>
<li>Punch out at the end of the work day
</li>
</ul>
</div>
</div>
<div id="outline-container-WhatDoIWorkOnNext">
<h3 id="WhatDoIWorkOnNext"><a id="sec-8-2" name="sec-8-2"></a><span>8.2</span> What do I work on next?</h3>
<div id="text-WhatDoIWorkOnNext">

<p>
Start with deadlines and tasks scheduled today or earlier from the
daily agenda view.  Then move on to tasks in the <code>Next Tasks</code> list in
the block agenda view.  I tend to schedule current projects to 'today'
when I start work on them and they sit on my daily agenda reminding me
that they need to be completed.  I normally only schedule one or two
projects to the daily agenda and unschedule things that are no longer
important and don't deserve my attention today.
</p>

<p>
When I look for a new task to work on I generally hit <code>F12 SPC</code> to get
the block agenda and follow this order:
</p>

<ul>
<li>Pick something off today's agenda
<ul>
<li>deadline for today (do this first - it's not late yet)
</li>
<li>deadline in the past (it's already late)
</li>
<li>a scheduled task for today (it's supposed to be done today)
</li>
<li>a scheduled task that is still on the agenda
</li>
<li>deadline that is coming up soon
</li>
</ul>
</li>
<li>pick a NEXT task
</li>
<li>If you run out of items to work on look for a NEXT task in the current context
pick a task from the Tasks list of the current project.
</li>
</ul>
</div>
<div id="outline-container-CustomAgendaViewsNextList">
<h4 id="CustomAgendaViewsNextList"><a id="sec-8-2-1" name="sec-8-2-1"></a><span>8.2.1</span> Why keep it all on the <code>NEXT</code> list?</h4>
<div id="text-CustomAgendaViewsNextList">

<p>
I've moved to a more GTD way of doing things.  Now I just use a <code>NEXT</code>
list.  Only projects get tasks with <code>NEXT</code> keywords since stuck projects
initiate the need for marking or creating <code>NEXT</code> tasks.  A <code>NEXT</code> task
is something that is available to work on <i>now</i>, it is the next
logical step in some project.
</p>

<p>
I used to have a special keyword <code>ONGOING</code> for things that I do a lot
and want to clock but never really start/end.  I had a special agenda
view for <code>ONGOING</code> tasks that I would pull up to easily find the thing
I want to clock.
</p>

<p>
Since then I've moved away from using the <code>ONGOING</code> todo keyword.
Having an agenda view that shows <code>NEXT</code> tasks makes it easy to pick
the thing to clock - and I don't have to remember if I need to look in
the <code>ONGOING</code> list or the <code>NEXT</code> list when looking for the task to
clock-in.  The <code>NEXT</code> list is basically 'what is current' - any task
that moves a project forward.  I want to find the thing to work on as
fast as I can and actually do work on it - not spend time hunting
through my org files for the task that needs to be clocked-in.
</p>

<p>
To drop a task off the <code>NEXT</code> list simply move it back to the <code>TODO</code>
state.
</p>
</div>
</div>
</div>
<div id="outline-container-ReadingMailNewsIRC">
<h3 id="ReadingMailNewsIRC"><a id="sec-8-3" name="sec-8-3"></a><span>8.3</span> Reading email, newsgroups, and conversations on IRC</h3>
<div id="text-ReadingMailNewsIRC">

<p>
When reading email, newsgroups, and conversations on IRC I just let
the default task (normally <code>** Organization</code>) clock the time I spend on
these tasks.  To read email I go to Gnus and read everything in my
inboxes.  If there are emails that require a response I use
org-capture to create a new task with a heading of 'Respond to &lt;user&gt;'
for each one.  This automatically links to the email in the task and
makes it easy to find later.  Some emails are quick to respond to and
some take research and a significant amount of time to complete.  I
clock each one in it's own task just in case I need that clocked time
later.  The capture template for Repond To tasks is now scheduled for
today so I can refile the task to the appropriate org file without
losing the task for a week.
</p>

<p>
Next, I go to my newly created tasks to be refiled from the block
agenda with <code>F12 a</code> and clock in an email task and deal with it.
Repeat this until all of the 'Respond to &lt;user&gt;' tasks are marked
<code>DONE</code>.
</p>

<p>
I read email and newgroups in Gnus so I don't separate clocked time
for quickly looking at things.  If an article has a useful piece of
information I want to remember I create a note for it with <code>C-c c n</code>
and enter the topic and file it.  This takes practically no time at
all and I know the note is safely filed for later retrieval.  The time
I spend in the capture buffer is clocked with that capture note.
</p>
</div>
</div>
<div id="outline-container-CustomAgendaViewFiltering">
<h3 id="CustomAgendaViewFiltering"><a id="sec-8-4" name="sec-8-4"></a><span>8.4</span> Filtering</h3>
<div id="text-CustomAgendaViewFiltering">

<p>
So many tasks, so little time.  I have hundreds of tasks at any given
time (373 right now).  There is so much stuff to look at it can be
daunting.  This is where agenda filtering saves the day.
</p>

<p>
It's 11:53AM and I'm in work mode just before lunch.  I don't want to
see tasks that are not work related right now.  I also don't want to
work on a big project just before lunch… so I need to find small
tasks that I can knock off the list.
</p>

<p>
How do we do this?  Get a list of NEXT tasks from the block agenda and
then narrow it down with filtering.  Tasks are ordered in the NEXT
agenda view by estimated effort so the short tasks are first – just
start at the top and work your way down.  I can limit the displayed
agenda tasks to those estimates of 10 minutes or less with <code>/ + 1</code> and
I can pick something that fits the minutes I have left before I take
off for lunch.
</p>
</div>
<div id="outline-container-CustomAgendaViewFilteringContext">
<h4 id="CustomAgendaViewFilteringContext"><a id="sec-8-4-1" name="sec-8-4-1"></a><span>8.4.1</span> Automatically removing context based tasks with / RET</h4>
<div id="text-CustomAgendaViewFilteringContext">

<p>
<code>/ RET</code> in the agenda is really useful.  This awesome feature was
added to org-mode by John Wiegley.  It removes tasks automatically by
filtering based on a user-provided function.
</p>

<p>
At work I have projects I'm working on which are assigned by my
manager.  Sometimes priorities changes and projects are delayed to
sometime in the future.  This means I need to stop working on these
immediately.  I put the project task on <code>HOLD</code> and work on something
else.  The <code>/ RET</code> filter removes <code>HOLD</code> tasks and subtasks (because
of tag inheritance).
</p>

<p>
At home I have some tasks tagged with <code>farm</code> since these need to be
performed when I am physically at our family farm.  Since I am there
infrequently I have added <code>farm</code> to the list of auto-excluded tags on
my system.  I can always explicitly filter to just <code>farm</code> tasks with
<code>/ TAB farm RET</code> when I am physically there.
</p>

<p>
I have the following setup to allow <code>/ RET</code> to filter tasks based on
the description above.
</p>

<div>

<pre>(<span>defun</span> <span>bh/org-auto-exclude-function</span> (tag)
  <span>"Automatic task exclusion in the agenda with / RET"</span>
  (and (<span>cond</span>
        ((string= tag <span>"hold"</span>)
         t)
        ((string= tag <span>"farm"</span>)
         t))
       (concat <span>"-"</span> tag)))

(setq org-agenda-auto-exclude-function 'bh/org-auto-exclude-function)
</pre>
</div>

<p>
This lets me filter tasks with just <code>/ RET</code> on the agenda which removes tasks I'm not
supposed to be working on now from the list of returned results.
</p>

<p>
This helps to keep my agenda clutter-free.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-Clocking">
<h2 id="Clocking"><a id="sec-9" name="sec-9"></a><span>9</span> Time Clocking</h2>
<div id="text-Clocking">

<p>
Okay, I admit it.  I'm a clocking fanatic.
</p>

<p>
I clock everything at work.  Org-mode makes this really easy.  I'd
rather clock too much stuff than not enough so I find it's easier to
get in the habit of clocking everything.
</p>

<p>
This makes it possible to look back at the day and see where I'm
spending too much time, or not enough time on specific projects.  This
also helps a lot when you need to estimate how long something is going
to take to do – you can use your clocking data from similar tasks to
help tune your estimates so they are more accurate.
</p>

<p>
Without clocking data it's hard to tell how long something took to do
after the fact.
</p>

<p>
I now use the concept of <code>punching in</code> and <code>punching out</code> at the start
and end of my work day.  I punch in when I arrive at work, punch out
for lunch, punch in after lunch, and punch out at the end of the day.
Every minute is clocked between punch-in and punch-out times.
</p>

<p>
Punching in defines a default task to clock time on whenever the clock
would normally stop.  I found that with the default org-mode setup I
would lose clocked minutes during the day, a minute here, a minute
there, and that all adds up.  This is especially true if you write
notes when moving to a DONE state - in this case the clock normally
stops before you have composed the note – and good notes take a few
minutes to write.
</p>

<p>
My clocking setup basically works like this:
</p>

<ul>
<li>Punch in (start the clock)
<ul>
<li>This clocks in a predefined task by <code>org-id</code> that is the default
task to clock in whenever the clock normally stops
</li>
</ul>
</li>
<li>Clock in tasks normally, and let moving to a DONE state clock out
<ul>
<li>clocking out automatically clocks time on a parent task or moves
back to the predefined default task if no parent exists.
</li>
</ul>
</li>
<li>Continue clocking whatever tasks you work on
</li>
<li>Punch out (stop the clock)
</li>
</ul>

<p>
I'm free to change the default task multiple times during the day but 
with the clock moving up the project tree on clock out I no longer 
need to do this.  I simply have a single task that gets clocked in
when I punch-in.
</p>

<p>
If I punch-in with a prefix on a task in <code>Project X</code> then that task
automatically becomes the default task and all clocked time goes on
that project until I either punch out or punch in some other task.
</p>

<p>
My org files look like this:
</p>

<p>
<code>todo.org</code>:
</p>
<div>

<pre><span>#+FILETAGS: PERSONAL</span>
...
<span>* Tasks</span>
<span>** Organization</span>
<span>   :PROPERTIES:</span>
   <span>:CLOCK_MODELINE_TOTAL:</span> today
   <span>:ID:</span>       eb155a82-92b2-4f25-a3c6-0304591af2f9
<span>   :END:</span>
   ...
</pre>
</div>

<p>
If I am working on some task, then I simply clock in on the task.
Clocking out moves the clock up to a parent task with a todo keyword
(if any) which keeps the clock time in the same subtree.  If there
is no parent task with a todo keyword then the clock moves back to
the default clocking task until I punch out or clock in some other
task.  When an interruption occurs I start a capture task which
keeps clocked time on the interruption task until I close it with
C-c C-c.
</p>

<p>
This works really well for me.
</p>

<p>
For example, consider the following org file:
</p>

<div>

<pre><span>* </span><span>TODO</span><span> Project A</span>
<span>** </span><span>NEXT</span><span> TASK 1</span>
<span>** </span><span>TODO</span><span> TASK 2</span>
<span>** </span><span>TODO</span><span> TASK 3</span>
<span>* Tasks</span>
<span>** </span><span>TODO</span><span> Some miscellaneous task</span>
</pre>
</div>

<p>
I'll work on this file in the following sequence:
</p>

<ol>
<li>I punch in with <code>F9-I</code> at the start of my day

<p>
That clocks in the <code>Organization</code> task by id in my <code>todo.org</code> file.
</p>
</li>

<li><code>F12-SPC</code> to review my block agenda

<p>
Pick 'TODO Some miscellaneous task' to work on next and clock that in with <code>I</code>
The clock is now on 'TODO Some miscellaneous task'
</p>
</li>

<li>I complete that task and mark it done with <code>C-c C-t d</code>

<p>
This stops the clock and moves it back to the <code>Organization</code> task.
</p>
</li>

<li>Now I want to work on <code>Project A</code> so I clock in <code>Task 1</code>

<p>
I work on Task 1 and mark it <code>DONE</code>.  This clocks out <code>Task 1</code> and moves
the clock to <code>Project A</code>.  Now I work on <code>Task 2</code> and clock that in.
</p>
</li>
</ol>

<p>
The entire time I'm working on and clocking some subtask of <code>Project A</code>
all of the clock time in the interval is applied somewhere to the <code>Project A</code>
tree.  When I eventually mark <code>Project A</code> done then the clock will move
back to the default organization task.
</p>
</div>
<div id="outline-container-ClockSetup">
<h3 id="ClockSetup"><a id="sec-9-1" name="sec-9-1"></a><span>9.1</span> Clock Setup</h3>
<div id="text-ClockSetup">

<p>
To get started we need to punch in which clocks in the default
task and keeps the clock running.  This is now simply a matter of
punching in the clock with <code>F9 I</code>.  You can do this anywhere.
Clocking out will now clock in the parent task (if there is one
with a todo keyword) or clock in the default task if not parent
exists.
</p>

<p>
Keeping the clock running when moving a subtask to a <code>DONE</code> state
means clocking continues to apply to the project task.  I can pick the
next task from the parent and clock that in without losing a minute or
two while I'm deciding what to work on next.
</p>

<p>
I keep clock times, state changes, and other notes in the <code>:LOGBOOK:</code>
drawer.
</p>

<p>
I have the following org-mode settings for clocking:
</p>

<div>

<pre><span>;;</span>
<span>;; </span><span>Resume clocking task when emacs is restarted</span>
(org-clock-persistence-insinuate)
<span>;;</span>
<span>;; </span><span>Show lot of clocking history so it's easy to pick items off the C-F11 list</span>
(setq org-clock-history-length 23)
<span>;; </span><span>Resume clocking task on clock-in if the clock is open</span>
(setq org-clock-in-resume t)
<span>;; </span><span>Change tasks to NEXT when clocking in</span>
(setq org-clock-in-switch-to-state 'bh/clock-in-to-next)
<span>;; </span><span>Separate drawers for clocking and logs</span>
(setq org-drawers (quote (<span>"PROPERTIES"</span> <span>"LOGBOOK"</span>)))
<span>;; </span><span>Save clock data and state changes and notes in the LOGBOOK drawer</span>
(setq org-clock-into-drawer t)
<span>;; </span><span>Sometimes I change tasks I'm clocking quickly - this removes clocked tasks with 0:00 duration</span>
(setq org-clock-out-remove-zero-time-clocks t)
<span>;; </span><span>Clock out when moving task to a done state</span>
(setq org-clock-out-when-done t)
<span>;; </span><span>Save the running clock and all clock history when exiting Emacs, load it on startup</span>
(setq org-clock-persist t)
<span>;; </span><span>Do not prompt to resume an active clock</span>
(setq org-clock-persist-query-resume nil)
<span>;; </span><span>Enable auto clock resolution for finding open clocks</span>
(setq org-clock-auto-clock-resolution (quote when-no-clock-is-running))
<span>;; </span><span>Include current clocking task in clock reports</span>
(setq org-clock-report-include-clocking-task t)

(setq bh/keep-clock-running nil)

(<span>defun</span> <span>bh/clock-in-to-next</span> (kw)
  <span>"Switch a task from TODO to NEXT when clocking in.</span>
<span>Skips capture tasks, projects, and subprojects.</span>
<span>Switch projects and subprojects from NEXT back to TODO"</span>
  (<span>when</span> (not (and (boundp 'org-capture-mode) org-capture-mode))
    (<span>cond</span>
     ((and (member (org-get-todo-state) (list <span>"TODO"</span>))
           (bh/is-task-p))
      <span>"NEXT"</span>)
     ((and (member (org-get-todo-state) (list <span>"NEXT"</span>))
           (bh/is-project-p))
      <span>"TODO"</span>))))

(<span>defun</span> <span>bh/find-project-task</span> ()
  <span>"Move point to the parent (project) task if any"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((parent-task (<span>save-excursion</span> (org-back-to-heading 'invisible-ok) (point))))
      (<span>while</span> (org-up-heading-safe)
        (<span>when</span> (member (nth 2 (org-heading-components)) org-todo-keywords-1)
          (setq parent-task (point))))
      (goto-char parent-task)
      parent-task)))

(<span>defun</span> <span>bh/punch-in</span> (arg)
  <span>"Start continuous clocking and set the default task to the</span>
<span>selected task.  If no task is selected set the Organization task</span>
<span>as the default task."</span>
  (interactive <span>"p"</span>)
  (setq bh/keep-clock-running t)
  (<span>if</span> (equal major-mode 'org-agenda-mode)
      <span>;;</span>
      <span>;; </span><span>We're in the agenda</span>
      <span>;;</span>
      (<span>let*</span> ((marker (org-get-at-bol 'org-hd-marker))
             (tags (org-with-point-at marker (org-get-tags-at))))
        (<span>if</span> (and (eq arg 4) tags)
            (org-agenda-clock-in '(16))
          (bh/clock-in-organization-task-as-default)))
    <span>;;</span>
    <span>;; </span><span>We are not in the agenda</span>
    <span>;;</span>
    (<span>save-restriction</span>
      (widen)
      <span>; </span><span>Find the tags on the current task</span>
      (<span>if</span> (and (equal major-mode 'org-mode) (not (org-before-first-heading-p)) (eq arg 4))
          (org-clock-in '(16))
        (bh/clock-in-organization-task-as-default)))))

(<span>defun</span> <span>bh/punch-out</span> ()
  (interactive)
  (setq bh/keep-clock-running nil)
  (<span>when</span> (org-clock-is-active)
    (org-clock-out))
  (org-agenda-remove-restriction-lock))

(<span>defun</span> <span>bh/clock-in-default-task</span> ()
  (<span>save-excursion</span>
    (org-with-point-at org-clock-default-task
      (org-clock-in))))

(<span>defun</span> <span>bh/clock-in-parent-task</span> ()
  <span>"Move point to the parent (project) task if any and clock in"</span>
  (<span>let</span> ((parent-task))
    (<span>save-excursion</span>
      (<span>save-restriction</span>
        (widen)
        (<span>while</span> (and (not parent-task) (org-up-heading-safe))
          (<span>when</span> (member (nth 2 (org-heading-components)) org-todo-keywords-1)
            (setq parent-task (point))))
        (<span>if</span> parent-task
            (org-with-point-at parent-task
              (org-clock-in))
          (<span>when</span> bh/keep-clock-running
            (bh/clock-in-default-task)))))))

(<span>defvar</span> <span>bh/organization-task-id</span> <span>"eb155a82-92b2-4f25-a3c6-0304591af2f9"</span>)

(<span>defun</span> <span>bh/clock-in-organization-task-as-default</span> ()
  (interactive)
  (org-with-point-at (org-id-find bh/organization-task-id 'marker)
    (org-clock-in '(16))))

(<span>defun</span> <span>bh/clock-out-maybe</span> ()
  (<span>when</span> (and bh/keep-clock-running
             (not org-clock-clocking-in)
             (marker-buffer org-clock-default-task)
             (not org-clock-resolving-clocks-due-to-idleness))
    (bh/clock-in-parent-task)))

(add-hook 'org-clock-out-hook 'bh/clock-out-maybe 'append)
</pre>
</div>

<p>
I used to clock in tasks by ID using the following function but with
the new punch-in and punch-out I don't need these as much anymore.
<code>f9-SPC</code> calls <code>bh/clock-in-last-task</code> which switches the clock back
to the previously clocked task.
</p>

<div>

<pre>(<span>require</span> '<span>org-id</span>)
(<span>defun</span> <span>bh/clock-in-task-by-id</span> (id)
  <span>"Clock in a task by id"</span>
  (org-with-point-at (org-id-find id 'marker)
    (org-clock-in nil)))

(<span>defun</span> <span>bh/clock-in-last-task</span> (arg)
  <span>"Clock in the interrupted task if there is one</span>
<span>Skip the default task and get the next one.</span>
<span>A prefix arg forces clock in of the default task."</span>
  (interactive <span>"p"</span>)
  (<span>let</span> ((clock-in-to-task
         (<span>cond</span>
          ((eq arg 4) org-clock-default-task)
          ((and (org-clock-is-active)
                (equal org-clock-default-task (cadr org-clock-history)))
           (caddr org-clock-history))
          ((org-clock-is-active) (cadr org-clock-history))
          ((equal org-clock-default-task (car org-clock-history)) (cadr org-clock-history))
          (t (car org-clock-history)))))
    (widen)
    (org-with-point-at clock-in-to-task
      (org-clock-in nil))))
</pre>
</div>
</div>
</div>
<div id="outline-container-ClockingIn">
<h3 id="ClockingIn"><a id="sec-9-2" name="sec-9-2"></a><span>9.2</span> Clocking in</h3>
<div id="text-ClockingIn">

<p>
When I start or continue working on a task I clock it in with any of the following:
</p>

<ul>
<li><code>C-c C-x C-i</code> 
</li>
<li><code>I</code> in the agenda
</li>
<li><code>I</code> speed key on the first character of the heading line
</li>
<li><code>f9 I</code> while on the task in the agenda
</li>
<li><code>f9 I</code> while in the task in an org file
</li>
</ul>
</div>
<div id="outline-container-ClockingInDefaultTask">
<h4 id="ClockingInDefaultTask"><a id="sec-9-2-1" name="sec-9-2-1"></a><span>9.2.1</span> Setting a default clock task</h4>
<div id="text-ClockingInDefaultTask">

<p>
I have a default <code>** Organization</code> task in my todo.org file that
I tend to put miscellaneous clock time on.  This is the task I
clock in on when I punch in at the start of my work day with
<code>F9-I</code>.  While reorganizing my org-files, reading email,
clearing my inbox, and doing other planning work that isn't for
a specific project I'll clock in this task.  Punching-in
anywhere clocks in this Organization task as the default task.
</p>

<p>
If I want to change the default clocking task I just visit the
new task in any org buffer and clock it in with <code>C-u C-u C-c C-x
C-i</code>.  Now this new task that collects miscellaneous clock
minutes when the clock would normally stop.
</p>

<p>
You can quickly clock in the default clocking task with <code>C-u C-c
C-x C-i d</code>.  Another option is to repeatedly clock out so the
clock moves up the project tree until you clock out the
top-level task and the clock moves to the default task.
</p>
</div>
</div>
<div id="outline-container-ClockingInByClockHistory">
<h4 id="ClockingInByClockHistory"><a id="sec-9-2-2" name="sec-9-2-2"></a><span>9.2.2</span> Using the clock history to clock in old tasks</h4>
<div id="text-ClockingInByClockHistory">

<p>
You can use the clock history to restart clocks on old tasks you've
clocked or to jump directly to a task you have clocked previously.  I
use this mainly to clock in whatever got interrupted by something.
</p>

<p>
Consider the following scenario:
</p>

<ul>
<li>You are working on and clocking <code>Task A</code> (Organization)
</li>
<li>You get interrupted and switch to <code>Task B</code> (Document my use of org-mode)
</li>
<li>You complete <code>Task B</code> (Document my use of org-mode)
</li>
<li>Now you want to go back to <code>Task A</code> (Organization) again to continue
</li>
</ul>

<p>
This is easy to deal with.  
</p>

<ol>
<li>Clock in <code>Task A</code>, work on it
</li>
<li>Go to <code>Task B</code> (or create a new task) and clock it in
</li>
<li>When you are finished with <code>Task B</code> hit <code>C-u C-c C-x C-i i</code>
</li>
</ol>

<p>
This displays a clock history selection window like the following and
selects the interrupted <code>[i]</code> entry.
</p>

<p>
<b>Clock history selection buffer for C-u C-c C-x C-i</b>
</p>
<pre>Default Task
[d] norang          Organization                          &lt;-- Task B
The task interrupted by starting the last one
[i] norang          Organization                          &lt;-- Task B
Current Clocking Task
[c] org             NEXT Document my use of org-mode      &lt;-- Task A
Recent Tasks
[1] org             NEXT Document my use of org-mode      &lt;-- Task A
[2] norang          Organization                          &lt;-- Task B
...
[Z] org             DONE Fix default section links        &lt;-- 35 clock task entries ago
</pre>
</div>
</div>
</div>
<div id="outline-container-ClockEverythingWithNewTasks">
<h3 id="ClockEverythingWithNewTasks"><a id="sec-9-3" name="sec-9-3"></a><span>9.3</span> Clock Everything - Create New Tasks</h3>
<div id="text-ClockEverythingWithNewTasks">

<p>
In order to clock everything you need a task for everything.  That's
fine for planned projects but interruptions inevitably occur and you
need some place to record whatever time you spend on that
interruption.
</p>

<p>
To deal with this we create a new capture task to record the thing we
are about to do.  The workflow goes something like this:
</p>

<ul>
<li>You are clocking some task and an interruption occurs
</li>
<li>Create a quick capture task journal entry <code>C-c c j</code>
</li>
<li>Type the heading
</li>
<li>go do that thing (eat lunch, whatever)
</li>
<li>file it <code>C-c C-c</code>, this restores the clock back to the previous clocking task
</li>
<li>clock something else in or continue with the current clocking task
</li>
</ul>

<p>
This means you can ignore the details like where this task really
belongs in your org file layout and just get on with completing the
thing.  Refiling a bunch of tasks later in a group when it is
convenient to refile the tasks saves time in the long run.
</p>

<p>
If it's a one-shot uninteresting task (like a coffee break) I create
a capture journal entry for it that goes to the diary.org date tree.
If it's a task that actually needs to be tracked and marked done, and 
applied to some project then I create a capture task instead which files it in 
refile.org.
</p>
</div>
</div>
<div id="outline-container-FindTasksToClockIn">
<h3 id="FindTasksToClockIn"><a id="sec-9-4" name="sec-9-4"></a><span>9.4</span> Finding tasks to clock in</h3>
<div id="text-FindTasksToClockIn">

<p>
To find a task to work on I use one of the following options
(generally listed most frequently used first)
</p>

<ul>
<li>Use the clock history C-u C-c C-x C-i
Go back to something I was clocking that is not finished
</li>
<li>Pick something off today's block agenda
<code>SCHEDULED</code> or <code>DEADLINE</code> items that need to be done soon
</li>
<li>Pick something off the <code>NEXT</code> tasks agenda view
Work on some unfinished task to move to completion
</li>
<li>Pick something off the other task list 
</li>
<li>Use an agenda view with filtering to pick something to work on
</li>
</ul>

<p>
Punching in on the task you select will restrict the agenda view to that project
so you can focus on just that thing for some period of time.
</p>
</div>
</div>
<div id="outline-container-EditingClockEntries">
<h3 id="EditingClockEntries"><a id="sec-9-5" name="sec-9-5"></a><span>9.5</span> Editing clock entries</h3>
<div id="text-EditingClockEntries">

<p>
Sometimes it is necessary to edit clock entries so they reflect
reality.  I find I do this for maybe 2-3 entries in a week.
</p>

<p>
Occassionally I cannot clock in a task on time because I'm away from
my computer.  In this case the previous clocked task is still running
and counts time for both tasks which is wrong.
</p>

<p>
I make a note of the time and then when I get back to my computer I
clock in the right task and edit the start and end times to correct
the clock history.
</p>

<p>
To visit the clock line for an entry quickly use the agenda log mode.
<code>F12 a l</code> shows all clock lines for today.  I use this to navigate to
the appropriate clock lines quickly.  F11 goes to the current clocked
task but the agenda log mode is better for finding and visiting older
clock entries.
</p>

<p>
Use <code>F12 a l</code> to open the agenda in log mode and show only logged
clock times.  Move the cursor down to the clock line you need to edit
and hit <code>TAB</code> and you're there.
</p>

<p>
To edit a clock entry just put the cursor on the part of the date you
want to edit (use the keyboard not the mouse - since the clicking on
the timestamp with the mouse goes back to the agenda for that day) and
hit the <code>S-&lt;up arrow&gt;</code> or <code>S-&lt;down arrow&gt;</code> keys to change the time.
</p>

<p>
The following setting makes time editing use discrete minute intervals (no rounding)
increments:
</p>
<div>

<pre>(setq org-time-stamp-rounding-minutes (quote (1 1)))
</pre>
</div>

<p>
Editing the time with the shift arrow combination also updates the
total for the clock line which is a nice convenience.
</p>

<p>
I always check that I haven't created task overlaps when fixing time
clock entries by viewing them with log mode on in the agenda.  There
is a new view in the agenda for this – just hit <code>v c</code> in the daily 
agenda and clock gaps and overlaps are identified.
</p>

<p>
I want my clock entries to be as accurate as possible.
</p>

<p>
The following setting shows 1 minute clocking gaps.
</p>
<div>

<pre>(setq org-agenda-clock-consistency-checks
      (quote (<span>:max-duration</span> <span>"4:00"</span>
              <span>:min-duration</span> 0
              <span>:max-gap</span> 0
              <span>:gap-ok-around</span> (<span>"4:00"</span>))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-TimeReportingAndTracking">
<h2 id="TimeReportingAndTracking"><a id="sec-10" name="sec-10"></a><span>10</span> Time reporting and tracking</h2>

<div id="outline-container-BillingClientsForClockedTime">
<h3 id="BillingClientsForClockedTime"><a id="sec-10-1" name="sec-10-1"></a><span>10.1</span> Billing clients based on clocked time</h3>
<div id="text-BillingClientsForClockedTime">

<p>
At the beginning of the month I invoice my clients for work done last
month.  This is where I review my clocking data for correctness before
billing for the clocked time.
</p>

<p>
Billing for clocked time basically boils down to the following steps:
</p>

<ol>
<li>Verify that the clock data is complete and correct
</li>
<li>Use clock reports to summarize time spent
</li>
<li>Create an invoice based on the clock data

<p>
I currently create invoices in an external software package
based on the org-mode clock data.
</p>
</li>

<li>Archive complete tasks so they are out of the way.

<p>
See <a href="#Archiving">Archiving</a> for more details.
</p>
</li>
</ol>
</div>
<div id="outline-container-VerifyingClockData">
<h4 id="VerifyingClockData"><a id="sec-10-1-1" name="sec-10-1-1"></a><span>10.1.1</span> Verify that the clock data is complete and correct</h4>
<div id="text-VerifyingClockData">

<p>
Since I change tasks often (sometimes more than once in a minute) I
use the following setting to remove clock entries with a zero
duration.
</p>
<div>

<pre><span>;; </span><span>Sometimes I change tasks I'm clocking quickly - this removes clocked tasks with 0:00 duration</span>
(setq org-clock-out-remove-zero-time-clocks t)
</pre>
</div>

<p>
This setting just keeps my clocked log entries clean - only keeping
clock entries that contribute to the clock report.
</p>

<p>
Before invoicing for clocked time it is important to make sure your
clocked time data is correct.  If you have a clocked time with an
entry that is not closed (ie. it has no end time) then that is a hole
in your clocked day and it gets counted as zero (0) for time spent on
the task when generating clock reports.  Counting it as zero is almost
certainly wrong.
</p>

<p>
To check for unclosed clock times I use the agenda-view clock check
(<code>v c</code> in the agenda).  This view shows clocking gaps and overlaps in
the agenda.
</p>

<p>
To check the last month's clock data I use <code>F12 a v m b v c</code>
which shows a full month in the agenda, moves to the previous
month, and shows the clocked times only.  It's important to
remove any agenda restriction locks and filters when checking
the logs for gaps and overlaps.
</p>

<p>
The clocked-time only display in the agenda makes it easy to quickly
scan down the list to see if an entry is missing an end time.  If an
entry is not closed you can manually fix the clock entry based on
other clock info around that time.
</p>
</div>
</div>
<div id="outline-container-ClockReports">
<h4 id="ClockReports"><a id="sec-10-1-2" name="sec-10-1-2"></a><span>10.1.2</span> Using clock reports to summarize time spent</h4>
<div id="text-ClockReports">

<p>
Billable time for clients are kept in separate org files.
</p>

<p>
To get a report of time spent on tasks for <code>XYZ.org</code> you simply visit
the <code>XYZ.org</code> file and run an agenda clock report for the last month
with <code>F12 &lt; a v m b R</code>.  This limits the agenda to this one file,
shows the agenda for a full month, moves to last month, and generates
a clock report.
</p>

<p>
My agenda org clock report settings show 5 levels of detail with links
to the tasks.  I like wider reports than the default compact setting
so I override the <code>:narrow</code> value.
</p>
<div>

<pre><span>;; </span><span>Agenda clock report parameters</span>
(setq org-agenda-clockreport-parameter-plist
      (quote (<span>:link</span> t <span>:maxlevel</span> 5 <span>:fileskip0</span> t <span>:compact</span> t <span>:narrow</span> 80)))
</pre>
</div>

<p>
I used to have a monthly clock report dynamic block in each project
org file and manually updated them at the end of my billing cycle.  I
used this as the basis for billing my clients for time spent on their
projects.  I found updating the dynamic blocks fairly tedious when you
have more than a couple of files for the month.
</p>

<p>
I have since moved to using agenda clock reports shortly after that
feature was added.  I find this much more convenient.  The data isn't
normally for consumption by anyone else so the format of the agenda
clock report format is great for my use-case.
</p>
</div>
</div>
</div>
<div id="outline-container-TaskEstimates">
<h3 id="TaskEstimates"><a id="sec-10-2" name="sec-10-2"></a><span>10.2</span> Task Estimates and column view</h3>
<div id="text-TaskEstimates">

<p>
Estimating how long tasks take to complete is a difficult skill to
master.  Org-mode makes it easy to practice creating estimates for
tasks and then clock the actual time it takes to complete.
</p>

<p>
By repeatedly estimating tasks and reviewing how your estimate relates
to the actual time clocked you can tune your estimating skills.
</p>
</div>
<div id="outline-container-CreatingTaskEstimates">
<h4 id="CreatingTaskEstimates"><a id="sec-10-2-1" name="sec-10-2-1"></a><span>10.2.1</span> Creating a task estimate with column mode</h4>
<div id="text-CreatingTaskEstimates">

<p>
I use <code>properties</code> and <code>column view</code> to do project estimates.
</p>

<p>
I set up column view globally with the following headlines
</p>
<div>

<pre><span>; </span><span>Set default column view headings: Task Effort Clock_Summary</span>
(setq org-columns-default-format <span>"%80ITEM(Task) %10Effort(Effort){:} %10CLOCKSUM"</span>)
</pre>
</div>

<p>
This makes column view show estimated task effort and clocked times
side-by-side which is great for reviewing your project estimates.
</p>

<p>
A property called <code>Effort</code> records the estimated amount of time a
given task will take to complete.  The estimate times I use are one
of:
</p>

<ul>
<li>10 minutes
</li>
<li>30 minutes
</li>
<li>1 hour
</li>
<li>2 hours
</li>
<li>3 hours
</li>
<li>4 hours
</li>
<li>5 hours
</li>
<li>6 hours
</li>
<li>7 hours
</li>
<li>8 hours
</li>
</ul>

<p>
These are stored for easy use in <code>column mode</code> in the global property
<code>Effort_ALL</code>.
</p>
<div>

<pre><span>; </span><span>global Effort estimate values</span>
<span>; </span><span>global STYLE property values for completion</span>
(setq org-global-properties (quote ((<span>"Effort_ALL"</span> . <span>"0:15 0:30 0:45 1:00 2:00 3:00 4:00 5:00 6:00 0:00"</span>)
                                    (<span>"STYLE_ALL"</span> . <span>"habit"</span>))))
</pre>
</div>

<p>
To create an estimate for a task or subtree start column mode with
<code>C-c C-x C-c</code> and collapse the tree with <code>c</code>.  This shows a table
overlayed on top of the headlines with the task name, effort estimate,
and clocked time in columns.
</p>

<p>
With the cursor in the <code>Effort</code> column for a task you can easily set
the estimated effort value with the quick keys <code>1</code> through <code>9</code>.
</p>

<p>
After setting the effort values exit <code>column mode</code> with <code>q</code>.
</p>
</div>
</div>
<div id="outline-container-SavingEstimate">
<h4 id="SavingEstimate"><a id="sec-10-2-2" name="sec-10-2-2"></a><span>10.2.2</span> Saving your estimate</h4>
<div id="text-SavingEstimate">

<p>
For fixed price jobs where you provide your estimate to a client, then
work to complete the project it is useful to save the original
estimate that is provided to the client.
</p>

<p>
Save your original estimate by creating a dynamic clock report table
at the top of your estimated project subtree.  Entering <code>C-c C-x i
RET</code> inserts a clock table report with your estimated values and any
clocked time to date.
</p>

<div>

<pre>Original Estimate
<span>#+BEGIN: columnview :hlines 1 :id local</span>
<span>| Task                        | Estimated Effort | CLOCKSUM |</span>
<span>|-----------------------------+------------------+----------|</span>
<span>| ** TODO Project to estimate |             5:40 |          |</span>
<span>| *** TODO Step 1             |             0:10 |          |</span>
<span>| *** TODO Step 2             |             0:10 |          |</span>
<span>| *** TODO Step 3             |             5:10 |          |</span>
<span>| **** TODO Step 3.1          |             2:00 |          |</span>
<span>| **** TODO Step 3.2          |             3:00 |          |</span>
<span>| **** TODO Step 3.3          |             0:10 |          |</span>
<span>| *** TODO Step 4             |             0:10 |          |</span>
<span>#+END:</span>
</pre>
</div>
<p>
I normally delete the <code>#+BEGIN:</code> and <code>#+END:</code> lines from the original
table after providing the estimate to the client to ensure I don't
accidentally update the table by hitting <code>C-c C-c</code> on the <code>#+BEGIN:</code>
line.
</p>

<p>
Saving the original estimate data makes it possible to refine the
project tasks into subtasks as you work on the project without losing
the original estimate data.
</p>
</div>
</div>
<div id="outline-container-ReviewingEstimates">
<h4 id="ReviewingEstimates"><a id="sec-10-2-3" name="sec-10-2-3"></a><span>10.2.3</span> Reviewing your estimate</h4>
<div id="text-ReviewingEstimates">

<p>
<code>Column view</code> is great for reviewing your estimate.  This shows your
estimated time value and the total clock time for the project
side-by-side.
</p>

<p>
Creating a dynamic clock table with <code>C-c C-x i RET</code> is a great way to
save this project review if you need to make it available to other
applications.
</p>

<p>
<code>C-c C-x C-d</code> also provides a quick summary of clocked time for the
current org file.
</p>
</div>
</div>
</div>
<div id="outline-container-ProgressReporting">
<h3 id="ProgressReporting"><a id="sec-10-3" name="sec-10-3"></a><span>10.3</span> Providing progress reports to others</h3>
<div id="text-ProgressReporting">


<p>
When someone wants details of what I've done recently I simple generate a
log report in the agenda with tasks I've completed and state changes combined
with a clock report for the appropriate time period.
</p>

<p>
The following setting shows closed tasks and state changes in the
agenda.  Combined with the agenda clock report ('R') I can quickly
generate all of the details required.
</p>

<div>

<pre><span>;; </span><span>Agenda log mode items to display (closed and state changes by default)</span>
(setq org-agenda-log-mode-items (quote (closed state)))
</pre>
</div>

<p>
To generate the report I pull up the agenda for the appropriate time frame
(today, yesterday, this week, or last week) and hit the key sequence
<code>l R</code> to add the log report (without clocking data lines) and the agenda clock
report at the end.
</p>

<p>
Then it's simply a matter of exporting the resulting agenda in some useful format
to provide to other people.  <code>C-x C-w /tmp/agenda.html RET</code> exports to HTML
and <code>C-x C-w /tmp/agenda.txt RET</code> exports to plain text.  Other formats are 
available but I use these two the most.
</p>

<p>
Combining this export with tag filters and <code>C-u R</code> can limit the
report to exactly the tags that people are interested in.
</p>
</div>
</div>
</div>


<div id="outline-container-HandlingNotes">
<h2 id="HandlingNotes"><a id="sec-12" name="sec-12"></a><span>12</span> Handling Notes</h2>
<div id="text-HandlingNotes">

<p>
Notes are little gems of knowledge that you come across during your
day.  They are just like tasks except there is nothing to do (except
learn and memorize the gem of knowledge).  Unfortunately there are way
too many gems to remember and my head explodes just thinking about it.
</p>

<p>
org-mode to the rescue!
</p>

<p>
Often I'll find some cool feature or thing I want to remember while
reading the org-mode and git mailing lists in Gnus.  To create a note
I use my note capture template <code>C-c c n</code>, type a heading for the note
and <code>C-c C-c</code> to save it.  The only other thing to do is to refile it
(later) to the appropriate project file.
</p>

<p>
I have an agenda view just to find notes.  Notes are refiled to an
appropriate project file and task.  If there is no specific task it
belongs to it goes to the catchall <code>* Notes</code> task.  I generally have a
catchall notes task in every project file.  Notes are created with a
<code>NOTE</code> tag already applied by the capture template so I'm free to
refile the note anywhere.  As long as the note is in a project file
that contributes to my agenda (ie. in org-agenda-files) then I can
find the note back easily with my notes agenda view by hitting the key
combination <code>F12 N</code>.  I'm free to limit the agenda view of notes using
standard agenda tag filtering.
</p>

<p>
Short notes with a meaningful headline are a great way to remember
technical details without the need to actually remember anything -
other than how to find them back when you need them using <code>F12 N</code>.
</p>

<p>
Notes that are project related and not generally useful can be
archived with the project and removed from the agenda when the project
is removed.
</p>

<p>
So my org notes go in org.org and my git notes go in git.org both
under the <code>* Notes</code> task.  I'll forever be able to find those.  A note
about some work project detail I want to remember with the project is
filed to the project task under the appropriate work org-mode file and
eventually gets removed from the agenda when the project is complete
and archived.
</p>
</div>
</div>
<div id="outline-container-HandlinePhoneCalls">
<h2 id="HandlinePhoneCalls"><a id="sec-13" name="sec-13"></a><span>13</span> Handling Phone Calls</h2>
<div id="text-HandlinePhoneCalls">

<p>
Phone calls are interruptions and I use capture mode to deal with
these (like all interruptions).  Most of the heavy lifting for phone
calls is done by capture mode.  I use a special capture template for
phone calls combined with a custom function that replaces text with
information from my <code>bbdb</code> addressbook database.
</p>

<p>
<code>C-c c p</code> starts a capture task normally and I'm free to enter notes
from the call in the template immediately.  The cursor starts in the
template normally where the name of the caller would be inserted.  I
can use a <code>bbdb</code> lookup function to insert the name with <code>f9-p</code> or I
can just type in whatever is appropriate.  If a <code>bbdb</code> entry needs to
be created for the caller I can do that and replace the caller details
with <code>f9-p</code> anytime that is convenient for me.  I found that
automatically calling the bbdb lookup function would interrupt my
workflow during the call in cases where the information about the
caller was not readily available.  Sometimes I want to make notes first 
and get the caller details later during the call.
</p>

<p>
The phone call capture template starts the clock as soon as the phone
rings and I'm free to lookup and replace the caller in bbdb anytime
during or after the call.  Capture mode starts the clock using the
<code>:clock-in t</code> setting in the template.
</p>

<p>
When the phone call ends I simple do <code>C-c C-c</code> to close the capture
buffer and stop the clock.  If I have to close it early and look up
other information during the call I just do <code>C-c C-c F9-SPC</code> to close
the capture buffer (which stops the clock) and then immediately switch
back to the last clocked item to continue the clock in the phone call
task.  When the phone call ends I clock out which normally clocks in
my default task again (if any).
</p>

<p>
Here is my set up for phone calls.  I would like to thank Gregory
</p>
<ol>
<li>Grubbs for the original bbdb lookup functions which this version
</li>
</ol>
<p>
is based on.
</p>

<p>
Below is the partial capture template showing the phone call template
followed by the phone-call related lookup functions.
</p>

<div>

<pre><span>;; </span><span>Capture templates for: TODO tasks, Notes, appointments, phone calls, and org-protocol</span>
(setq org-capture-templates
      (quote (...
              (<span>"p"</span> <span>"Phone call"</span> entry (file <span>"~/git/org/refile.org"</span>)
               <span>"* PHONE %? :PHONE:\n%U"</span> <span>:clock-in</span> t <span>:clock-resume</span> t)
              ...)))
</pre>
</div>

<div>

<pre>(<span>require</span> '<span>bbdb</span>)
(<span>require</span> '<span>bbdb-com</span>)

(global-set-key (kbd <span>"&lt;f9&gt; p"</span>) 'bh/phone-call)

<span>;;</span>
<span>;; </span><span>Phone capture template handling with BBDB lookup</span>
<span>;; </span><span>Adapted from code by Gregory J. Grubbs</span>
(<span>defun</span> <span>bh/phone-call</span> ()
  <span>"Return name and company info for caller from bbdb lookup"</span>
  (interactive)
  (<span>let*</span> (name rec caller)
    (setq name (completing-read <span>"Who is calling? "</span>
                                (bbdb-hashtable)
                                'bbdb-completion-predicate
                                'confirm))
    (<span>when</span> (&gt; (length name) 0)
      <span>; </span><span>Something was supplied - look it up in bbdb</span>
      (setq rec
            (or (first
                 (or (bbdb-search (bbdb-records) name nil nil)
                     (bbdb-search (bbdb-records) nil name nil)))
                name)))

    <span>; </span><span>Build the bbdb link if we have a bbdb record, otherwise just return the name</span>
    (setq caller (<span>cond</span> ((and rec (vectorp rec))
                        (<span>let</span> ((name (bbdb-record-name rec))
                              (company (bbdb-record-company rec)))
                          (concat <span>"[[bbdb:"</span>
                                  name <span>"]["</span>
                                  name <span>"]]"</span>
                                  (<span>when</span> company
                                    (concat <span>" - "</span> company)))))
                       (rec)
                       (t <span>"NameOfCaller"</span>)))
    (insert caller)))
</pre>
</div>
</div>
</div>
<div id="outline-container-GTD">
<h2 id="GTD"><a id="sec-14" name="sec-14"></a><span>14</span> GTD stuff</h2>
<p>
Most of my day is deadline/schedule driven.
I work off of the agenda first and then pick items from the todo lists as
outlined in <a href="#WhatDoIWorkOnNext">What do I work on next?</a>
</p>
<div id="outline-container-GTDWeeklyReview">
<h3 id="GTDWeeklyReview"><a id="sec-14-1" name="sec-14-1"></a><span>14.1</span> Weekly Review Process</h3>
<div id="text-GTDWeeklyReview">

<p>
The first day of the week (usually Monday) I do my weekly review. 
I keep a list like this one to remind me what needs to be done.
</p>

<p>
To keep the agenda fast I set
</p>
<div>

<pre>(setq org-agenda-span 'day)
</pre>
</div>
<p>
so only today's date is shown by default.  I only need the weekly
view during my weekly review and this keeps my agenda generation
fast.
</p>

<p>
I have a recurring task which keeps my weekly review checklist
handy.  This pops up as a reminder on Monday's.  This week I'm
doing my weekly review on Tuesday since Monday was a holiday.
</p>

<div>

<pre><span>* </span><span>NEXT</span><span> Weekly Review </span><span>[0/6]</span>
  <span>SCHEDULED:</span> <span>&lt;2009-05-18 Mon ++1w&gt;</span> 
  :LOGBOOK:...
  :PROPERTIES:...

  What to review:

   - <span>[ ]</span> Check follow-up folder
   - <span>[ ]</span> Review weekly agenda <span>=F12 a w //=</span>
   - <span>[ ]</span> Check clocking data for past week <span>=v c=</span>
   - <span>[ ]</span> Review clock report for past week <span>=R=</span>
     - Check where we spent time (too much or too little) and rectify this week
   - <span>[ ]</span> Look at entire agenda for today  <span>=F12 SPC=</span>
   - <span>[ ]</span> Review projects <span>=F12 SPC //=</span> and <span>=V=</span> repeatedly to view each project

   - start work
     - daily agenda first - knock off items
     - then work on NEXT tasks
</pre>
</div>
<p>
The first item [ ] Check follow-up folder makes me pull out the paper
file I dump stuff into all week long - things I need to take care of
but are in no particular hurry to deal with.  Stuff I get in the mail
etc. that I don't want to deal with now.  I just toss it in my
<code>Follow-Up</code> folder in the filing cabinet and forget about it until the
weekly review.
</p>

<p>
I go through the folder and weed out anything that needs to be dealt
with.  After that everything else is in <code>org-mode</code>.  I tend to
schedule tasks onto the agenda for the coming week so that I don't
spend lots of time trying to find what needs to be worked on next.
</p>

<p>
This works for me.  Your mileage may vary ;)
</p>
</div>
</div>
<div id="outline-container-Projects">
<h3 id="Projects"><a id="sec-14-2" name="sec-14-2"></a><span>14.2</span> Project definition and finding stuck projects</h3>
<div id="text-Projects">

<p>
I'm using a new lazy project definition to mark tasks as projects.
This requires zero effort from me.  Any task with a subtask using a
todo keyword is a project.  Period.
</p>

<p>
Projects are 'stuck' if they have no subtask with a <code>NEXT</code> todo
keyword task defined.
</p>

<p>
The org-mode stuck projects agenda view lists projects that have no
<code>NEXT</code> task defined.  Stuck projects show up on my block agenda and I
tend to assign a <code>NEXT</code> task so the list remains empty.  This helps to
keep projects moving forward.
</p>

<p>
I disable the default org-mode stuck projects agenda view with the
following setting.
</p>

<div>

<pre>(setq org-stuck-projects (quote (<span>""</span> nil nil <span>""</span>)))
</pre>
</div>

<p>
This prevents org-mode from trying to show incorrect data if I select
the default stuck project view with <code>F12 #</code> from the agenda menu.  My
customized stuck projects view is part of my block agenda displayed
with <code>F12 SPC</code>.
</p>

<p>
Projects can have subprojects - and these subprojects can also be stuck.
Any project that is stuck shows up on the stuck projects list so I can
indicate or create a <code>NEXT</code> task to move that project forward.
</p>

<p>
In the following example <code>Stuck Project A</code> is stuck because it has no
subtask which is <code>NEXT</code>.  <code>Project C</code> is not stuck because it has
<code>NEXT</code> tasks <code>SubTask G</code> and <code>Task I</code>.  <code>Stuck Sub Project D</code> is stuck
because <code>SubTask E</code> is not <code>NEXT</code> and there are no other tasks
available in this project.
</p>

<div>

<pre><span>* Category</span>
<span>** </span><span>TODO</span><span> Stuck Project A</span>
<span>*** </span><span>TODO</span><span> Task B</span>
<span>** </span><span>TODO</span><span> Project C</span>
<span>*** </span><span>TODO</span><span> Stuck Sub Project D</span>
<span>**** </span><span>TODO</span><span> SubTask E</span>
<span>*** </span><span>TODO</span><span> Sub Project F</span>
<span>**** </span><span>NEXT</span><span> SubTask G</span>
<span>**** </span><span>TODO</span><span> SubTask H</span>
<span>*** </span><span>NEXT</span><span> Task I</span>
<span>*** </span><span>TODO</span><span> Task J</span>
</pre>
</div>

<p>
All of the stuck projects and subprojects show up in the stuck
projects list and that is my indication to assign or create <code>NEXT</code>
tasks until the stuck projects list is empty.  Occasionally some
subtask is <code>WAITING</code> for something and the project is stuck until that
condition is satisfied.  In this case I leave it on the stuck project
list and just work on something else.  This stuck project 'bugs' me
regularly when I see it on the block agenda and this prompts me to
follow up on the thing that I'm waiting for.
</p>

<p>
I have the following helper functions defined for projects which are
used by agenda views.
</p>
<div>

<pre>(<span>defun</span> <span>bh/is-project-p</span> ()
  <span>"Any task with a todo keyword subtask"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((has-subtask)
          (subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
          (is-a-task (member (nth 2 (org-heading-components)) org-todo-keywords-1)))
      (<span>save-excursion</span>
        (forward-line 1)
        (<span>while</span> (and (not has-subtask)
                    (&lt; (point) subtree-end)
                    (re-search-forward <span>"^\*+ "</span> subtree-end t))
          (<span>when</span> (member (org-get-todo-state) org-todo-keywords-1)
            (setq has-subtask t))))
      (and is-a-task has-subtask))))

(<span>defun</span> <span>bh/is-project-subtree-p</span> ()
  <span>"Any task with a todo keyword that is in a project subtree.</span>
<span>Callers of this function already widen the buffer view."</span>
  (<span>let</span> ((task (<span>save-excursion</span> (org-back-to-heading 'invisible-ok)
                              (point))))
    (<span>save-excursion</span>
      (bh/find-project-task)
      (<span>if</span> (equal (point) task)
          nil
        t))))

(<span>defun</span> <span>bh/is-task-p</span> ()
  <span>"Any task with a todo keyword and no subtask"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((has-subtask)
          (subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
          (is-a-task (member (nth 2 (org-heading-components)) org-todo-keywords-1)))
      (<span>save-excursion</span>
        (forward-line 1)
        (<span>while</span> (and (not has-subtask)
                    (&lt; (point) subtree-end)
                    (re-search-forward <span>"^\*+ "</span> subtree-end t))
          (<span>when</span> (member (org-get-todo-state) org-todo-keywords-1)
            (setq has-subtask t))))
      (and is-a-task (not has-subtask)))))

(<span>defun</span> <span>bh/is-subproject-p</span> ()
  <span>"Any task which is a subtask of another project"</span>
  (<span>let</span> ((is-subproject)
        (is-a-task (member (nth 2 (org-heading-components)) org-todo-keywords-1)))
    (<span>save-excursion</span>
      (<span>while</span> (and (not is-subproject) (org-up-heading-safe))
        (<span>when</span> (member (nth 2 (org-heading-components)) org-todo-keywords-1)
          (setq is-subproject t))))
    (and is-a-task is-subproject)))

(<span>defun</span> <span>bh/list-sublevels-for-projects-indented</span> ()
  <span>"Set org-tags-match-list-sublevels so when restricted to a subtree we list all subtasks.</span>
<span>  This is normally used by skipping functions where this variable is already local to the agenda."</span>
  (<span>if</span> (marker-buffer org-agenda-restrict-begin)
      (setq org-tags-match-list-sublevels 'indented)
    (setq org-tags-match-list-sublevels nil))
  nil)

(<span>defun</span> <span>bh/list-sublevels-for-projects</span> ()
  <span>"Set org-tags-match-list-sublevels so when restricted to a subtree we list all subtasks.</span>
<span>  This is normally used by skipping functions where this variable is already local to the agenda."</span>
  (<span>if</span> (marker-buffer org-agenda-restrict-begin)
      (setq org-tags-match-list-sublevels t)
    (setq org-tags-match-list-sublevels nil))
  nil)

(<span>defvar</span> <span>bh/hide-scheduled-and-waiting-next-tasks</span> t)

(<span>defun</span> <span>bh/toggle-next-task-display</span> ()
  (interactive)
  (setq bh/hide-scheduled-and-waiting-next-tasks (not bh/hide-scheduled-and-waiting-next-tasks))
  (<span>when</span>  (equal major-mode 'org-agenda-mode)
    (org-agenda-redo))
  (message <span>"%s WAITING and SCHEDULED NEXT Tasks"</span> (<span>if</span> bh/hide-scheduled-and-waiting-next-tasks <span>"Hide"</span> <span>"Show"</span>)))

(<span>defun</span> <span>bh/skip-stuck-projects</span> ()
  <span>"Skip trees that are not stuck projects"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max)))))
      (<span>if</span> (bh/is-project-p)
          (<span>let*</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
                 (has-next ))
            (<span>save-excursion</span>
              (forward-line 1)
              (<span>while</span> (and (not has-next) (&lt; (point) subtree-end) (re-search-forward <span>"^\\*+ NEXT "</span> subtree-end t))
                (<span>unless</span> (member <span>"WAITING"</span> (org-get-tags-at))
                  (setq has-next t))))
            (<span>if</span> has-next
                nil
              next-headline)) <span>; </span><span>a stuck project, has subtasks but no next task</span>
        nil))))

(<span>defun</span> <span>bh/skip-non-stuck-projects</span> ()
  <span>"Skip trees that are not stuck projects"</span>
  <span>;; </span><span>(bh/list-sublevels-for-projects-indented)</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max)))))
      (<span>if</span> (bh/is-project-p)
          (<span>let*</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
                 (has-next ))
            (<span>save-excursion</span>
              (forward-line 1)
              (<span>while</span> (and (not has-next) (&lt; (point) subtree-end) (re-search-forward <span>"^\\*+ NEXT "</span> subtree-end t))
                (<span>unless</span> (member <span>"WAITING"</span> (org-get-tags-at))
                  (setq has-next t))))
            (<span>if</span> has-next
                next-headline
              nil)) <span>; </span><span>a stuck project, has subtasks but no next task</span>
        next-headline))))

(<span>defun</span> <span>bh/skip-non-projects</span> ()
  <span>"Skip trees that are not projects"</span>
  <span>;; </span><span>(bh/list-sublevels-for-projects-indented)</span>
  (<span>if</span> (<span>save-excursion</span> (bh/skip-non-stuck-projects))
      (<span>save-restriction</span>
        (widen)
        (<span>let</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t))))
          (<span>cond</span>
           ((bh/is-project-p)
            nil)
           ((and (bh/is-project-subtree-p) (not (bh/is-task-p)))
            nil)
           (t
            subtree-end))))
    (<span>save-excursion</span> (org-end-of-subtree t))))

(<span>defun</span> <span>bh/skip-non-tasks</span> ()
  <span>"Show non-project tasks.</span>
<span>Skip project and sub-project tasks, habits, and project related tasks."</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max)))))
      (<span>cond</span>
       ((bh/is-task-p)
        nil)
       (t
        next-headline)))))

(<span>defun</span> <span>bh/skip-project-trees-and-habits</span> ()
  <span>"Skip trees that are projects"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t))))
      (<span>cond</span>
       ((bh/is-project-p)
        subtree-end)
       ((org-is-habit-p)
        subtree-end)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-projects-and-habits-and-single-tasks</span> ()
  <span>"Skip trees that are projects, tasks that are habits, single non-project tasks"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max)))))
      (<span>cond</span>
       ((org-is-habit-p)
        next-headline)
       ((and bh/hide-scheduled-and-waiting-next-tasks
             (member <span>"WAITING"</span> (org-get-tags-at)))
        next-headline)
       ((bh/is-project-p)
        next-headline)
       ((and (bh/is-task-p) (not (bh/is-project-subtree-p)))
        next-headline)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-project-tasks-maybe</span> ()
  <span>"Show tasks related to the current restriction.</span>
<span>When restricted to a project, skip project and sub project tasks, habits, NEXT tasks, and loose tasks.</span>
<span>When not restricted, skip project and sub-project tasks, habits, and project related tasks."</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let*</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
           (next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max))))
           (limit-to-project (marker-buffer org-agenda-restrict-begin)))
      (<span>cond</span>
       ((bh/is-project-p)
        next-headline)
       ((org-is-habit-p)
        subtree-end)
       ((and (not limit-to-project)
             (bh/is-project-subtree-p))
        subtree-end)
       ((and limit-to-project
             (bh/is-project-subtree-p)
             (member (org-get-todo-state) (list <span>"NEXT"</span>)))
        subtree-end)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-project-tasks</span> ()
  <span>"Show non-project tasks.</span>
<span>Skip project and sub-project tasks, habits, and project related tasks."</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let*</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t))))
      (<span>cond</span>
       ((bh/is-project-p)
        subtree-end)
       ((org-is-habit-p)
        subtree-end)
       ((bh/is-project-subtree-p)
        subtree-end)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-non-project-tasks</span> ()
  <span>"Show project tasks.</span>
<span>Skip project and sub-project tasks, habits, and loose non-project tasks."</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let*</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t)))
           (next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max)))))
      (<span>cond</span>
       ((bh/is-project-p)
        next-headline)
       ((org-is-habit-p)
        subtree-end)
       ((and (bh/is-project-subtree-p)
             (member (org-get-todo-state) (list <span>"NEXT"</span>)))
        subtree-end)
       ((not (bh/is-project-subtree-p))
        subtree-end)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-projects-and-habits</span> ()
  <span>"Skip trees that are projects and tasks that are habits"</span>
  (<span>save-restriction</span>
    (widen)
    (<span>let</span> ((subtree-end (<span>save-excursion</span> (org-end-of-subtree t))))
      (<span>cond</span>
       ((bh/is-project-p)
        subtree-end)
       ((org-is-habit-p)
        subtree-end)
       (t
        nil)))))

(<span>defun</span> <span>bh/skip-non-subprojects</span> ()
  <span>"Skip trees that are not projects"</span>
  (<span>let</span> ((next-headline (<span>save-excursion</span> (outline-next-heading))))
    (<span>if</span> (bh/is-subproject-p)
        nil
      next-headline)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-Archiving">
<h2 id="Archiving"><a id="sec-15" name="sec-15"></a><span>15</span> Archiving</h2>

<div id="outline-container-ArchivingSubtrees">
<h3 id="ArchivingSubtrees"><a id="sec-15-1" name="sec-15-1"></a><span>15.1</span> Archiving Subtrees</h3>
<div id="text-ArchivingSubtrees">

<p>
My archiving procedure has changed.  I used to move entire subtrees to
a separate archive file for the project.  Task subtrees in <code>FILE.org</code>
get archived to <code>FILE.org_archive</code> using the <code>a y</code> command in the
agenda.
</p>

<p>
I still archive to the same archive file as before but now I archive
any done state todo task that is old enough to archive.  Tasks to
archive are listed automatically at the end of my block agenda and
these are guaranteed to be old enough that I've already billed any
time associated with these tasks.  This cleans up my project trees and
removes the old tasks that are no longer interesting.  The archived
tasks get extra property data created during the archive procedure so
that it is possible to reconstruct exactly where the archived entry
came from in the rare case where you want to unarchive something.
</p>

<p>
My archive files are huge but so far I haven't found a need to split
them by year (or decade) :)
</p>

<p>
Archivable tasks show up in the last section of my block agenda when a
new month starts.  Any tasks that are done but have no timestamps this
month or last month (ie. they are over 30 days old) are available to
archive.  Timestamps include closed dates, notes, clock data, etc - any
active or inactive timestamp in the task.
</p>

<p>
Archiving is trivial.  Just mark all of the entries in the block agenda
using the <code>m</code> key and then archive them all to the appropriate place
with <code>B $</code>.  This normally takes less than 5 minutes once a month.
</p>
</div>
</div>
<div id="outline-container-ArchiveSetup">
<h3 id="ArchiveSetup"><a id="sec-15-2" name="sec-15-2"></a><span>15.2</span> Archive Setup</h3>
<div id="text-ArchiveSetup">

<p>
I no longer use an <code>ARCHIVE</code> property in my subtrees.  Tasks can just
archive normally to the <code>Archived Tasks</code> heading in the archive file.
</p>

<p>
The following setting ensures that task states are untouched when they
are archived.  This makes it possible to archive tasks that are not
marked <code>DONE</code>.  By default tasks are archived under the heading <code>*
Archived Tasks</code> in the archive file.
</p>

<p>
This archiving function does not keep your project trees intact.  It
archives done state tasks after they are old enough to they are
removed from the main org file.  It should be possible to reconstruct
the original tree from the archive detail properties but I've never
needed to do this yet.  The archived detail is very useful the few
times a year I actually need to look for some archived data but most
of the time I just move it out of the way and keep it for historical
purposes.
</p>

<div>

<pre>(setq org-archive-mark-done nil)
(setq org-archive-location <span>"%s_archive::* Archived Tasks"</span>)
</pre>
</div>

<div>

<pre>(<span>defun</span> <span>bh/skip-non-archivable-tasks</span> ()
  <span>"Skip trees that are not available for archiving"</span>
  (<span>save-restriction</span>
    (widen)
    <span>;; </span><span>Consider only tasks with done todo headings as archivable candidates</span>
    (<span>let</span> ((next-headline (<span>save-excursion</span> (or (outline-next-heading) (point-max))))
          (subtree-end (<span>save-excursion</span> (org-end-of-subtree t))))
      (<span>if</span> (member (org-get-todo-state) org-todo-keywords-1)
          (<span>if</span> (member (org-get-todo-state) org-done-keywords)
              (<span>let*</span> ((daynr (string-to-int (format-time-string <span>"%d"</span> (current-time))))
                     (a-month-ago (* 60 60 24 (+ daynr 1)))
                     (last-month (format-time-string <span>"%Y-%m-"</span> (time-subtract (current-time) (seconds-to-time a-month-ago))))
                     (this-month (format-time-string <span>"%Y-%m-"</span> (current-time)))
                     (subtree-is-current (<span>save-excursion</span>
                                           (forward-line 1)
                                           (and (&lt; (point) subtree-end)
                                                (re-search-forward (concat last-month <span>"</span><span>\\</span><span>|</span><span>"</span> this-month) subtree-end t)))))
                (<span>if</span> subtree-is-current
                    subtree-end <span>; </span><span>Has a date in this month or last month, skip it</span>
                  nil))  <span>; </span><span>available to archive</span>
            (or subtree-end (point-max)))
        next-headline))))
</pre>
</div>
</div>
</div>
<div id="outline-container-ArchiveTagHidesInfo">
<h3 id="ArchiveTagHidesInfo"><a id="sec-15-3" name="sec-15-3"></a><span>15.3</span> Archive Tag - Hiding Information</h3>
<p>
The only time I set the ARCHIVE tag on a task is to prevent it from
opening by default because it has tons of information I don't really
need to look at on a regular basis.  I can open the task with C-TAB if
I need to see the gory details (like a huge table of data related to
the task) but normally I don't need that information displayed.
</p>
</div>
<div id="outline-container-WhenToArchive">
<h3 id="WhenToArchive"><a id="sec-15-4" name="sec-15-4"></a><span>15.4</span> When to Archive</h3>
<div id="text-WhenToArchive">

<p>
Archiving monthly works well for me.  I keep completed tasks around
for at least 30 days before archiving them.  This keeps current
clocking information for the last 30 days out of the archives.  This
keeps my files that contribute to the agenda fairly current (this
month, and last month, and anything that is unfinished).  I only
rarely visit tasks in the archive when I need to pull up ancient
history for something.
</p>

<p>
Archiving keeps my main working files clutter-free.  If I ever need
the detail for the archived tasks they are available in the
appropriate archive file.
</p>
</div>
</div>
</div>
<div id="outline-container-Publishing">
<h2 id="Publishing"><a id="sec-16" name="sec-16"></a><span>16</span> Publishing and Exporting</h2>
<div id="text-Publishing">

<p>
I don't do a lot of publishing for other people but I do keep a set of
private client system documentation online.  Most of this
documentation is a collection of notes exported to HTML.
</p>

<p>
Everything at <a href="http://doc.norang.ca/">http://doc.norang.ca/</a> is generated by publishing
org-files.  This includes the index pages on this site.
</p>

<p>
Org-mode can export to a variety of publishing formats including (but not limited to)
</p>

<ul>
<li>ASCII
(plain text - but not the original org-mode file)
</li>
<li>HTML 
</li>
<li>LaTeX
</li>
<li>Docbook
which enables getting to lots of other formats like ODF, XML, etc
</li>
<li>PDF
via LaTeX or Docbook
</li>
<li>iCal
</li>
</ul>

<p>
I haven't begun the scratch the surface of what org-mode is capable of
doing.  My main use case for org-mode publishing is just to create
HTML documents for viewing online conveniently.  Someday I'll get time
to try out the other formats when I need them for something.
</p>
</div>
<div id="outline-container-sec-16-1">
<h3 id="sec-16-1"><span>16.1</span> New Exporter Setup</h3>
<div id="text-16-1">


<p>
The new exporter created by Nicolas Goaziou was introduced in org 8.0.
</p>

<p>
I have the following setup for the exporters I use.
</p>

<p>
Alphabetical listing options need to be set before the exporters are
loaded for filling to work correctly.
</p>

<div>

<pre>(setq org-alphabetical-lists t)

<span>;; </span><span>Explicitly load required exporters</span>
(<span>require</span> '<span>ox-html</span>)
(<span>require</span> '<span>ox-latex</span>)
(<span>require</span> '<span>ox-ascii</span>)
</pre>
</div>
</div>


<div id="outline-container-sec-16-1-1">
<h4 id="sec-16-1-1"><span>16.1.1</span> Conversion from the old exporter to the new exporter</h4>
<div id="text-16-1-1">


<p>
Here is the list of changes I made to move from the old exporter (pre
org 8.0) to the new exporter.
</p>

<ul>
<li>Explicitly require exporters

<ul>
<li>Add <code>ox-html</code>
</li>

<li>Add <code>ox-latex</code>
</li>

<li>Add <code>ox-ascii</code>
</li>
</ul>
</li>

<li>Rename variables

<ul>
<li><code>org-export-html-style-extra</code> to <code>org-html-head-extra</code>
</li>

<li><code>org-export-html-validation-link</code> to <code>org-html-validation-link</code>
</li>

<li><code>org-export-html-inline-images</code> to <code>org-html-inline-images</code>
</li>

<li><code>org-export-html-style-include-default</code> to <code>org-html-head-include-default-style</code>
</li>

<li><code>org-export-html-xml-declaration</code> to <code>org-html-xml-declaration</code>
</li>

<li><code>org-export-latex-listings</code> to <code>org-latex-listings</code>
</li>

<li><code>org-export-html-style-include-scripts</code> to <code>org-html-head-include-scripts</code>
</li>
</ul>
</li>

<li>Publishing changes

<ul>
<li>Rename <code>:publishing-function</code>

<ul>
<li><code>org-publish-org-to-html</code> to <code>org-html-publish-to-html</code>
</li>

<li><code>org-publish-org-to-org</code> to <code>org-org-publish-to-org</code>
</li>
</ul>
</li>

<li>Change <code>:style</code> to <code>:html-head</code>
</li>
</ul>
</li>

<li>Change <code>bh/is-late-deadline</code> to handle modified deadline string in agenda
</li>

<li>Reverse agenda sorting for late deadlines

<p>
These are no longer reported with negative values on the agenda
</p>
</li>

<li>Add a blank line after my inactive timestamps following headings to
prevent them from being exported.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-OrgBabel">
<h3 id="OrgBabel"><a id="sec-16-2" name="sec-16-2"></a><span>16.2</span> Org-babel Setup</h3>
<div id="text-OrgBabel">

<p>
Org-babel makes it easy to generate decent graphics using external
packages like ditaa, graphviz, PlantUML, and others.
</p>

<p>
The setup is really easy.  <code>ditaa</code> is provided with the org-mode
source.  You'll have to install the <code>graphviz</code> and <code>PlantUML</code> packages
on your system.
</p>

<div>

<pre>(setq org-ditaa-jar-path <span>"~/git/org-mode/contrib/scripts/ditaa.jar"</span>)
(setq org-plantuml-jar-path <span>"~/java/plantuml.jar"</span>)

(add-hook 'org-babel-after-execute-hook 'bh/display-inline-images 'append)

<span>; </span><span>Make babel results blocks lowercase</span>
(setq org-babel-results-keyword <span>"results"</span>)

(<span>defun</span> <span>bh/display-inline-images</span> ()
  (<span>condition-case</span> nil
      (org-display-inline-images)
    (<span>error</span> nil)))

(org-babel-do-load-languages
 (quote org-babel-load-languages)
 (quote ((emacs-lisp . t)
         (dot . t)
         (ditaa . t)
         (R . t)
         (python . t)
         (ruby . t)
         (gnuplot . t)
         (clojure . t)
         (sh . t)
         (ledger . t)
         (org . t)
         (plantuml . t)
         (latex . t))))

<span>; </span><span>Do not prompt to confirm evaluation</span>
<span>; </span><span>This may be dangerous - make sure you understand the consequences</span>
<span>; </span><span>of setting this -- see the docstring for details</span>
(setq org-confirm-babel-evaluate nil)

<span>; </span><span>Use fundamental mode when editing plantuml blocks with C-c '</span>
(add-to-list 'org-src-lang-modes (quote (<span>"plantuml"</span> . fundamental)))
</pre>
</div>

<p>
Now you just create a <code>begin-src</code> block for the appropriate tool, edit
the text, and build the pictures with <code>C-c C-c</code>.  After evaluating the
block results are displayed.  You can toggle display of inline images
with <code>C-c C-x C-v</code>
</p>

<p>
I disable startup with inline images because when I access my
org-files from an SSH session without X this breaks (say from my
Android phone) it fails when trying to display the images on a non-X
session.  It's much more important for me to be able to access my 
org files from my Android phone remotely than it is to see images on
startup.
</p>

<div>

<pre><span>;; </span><span>Don't enable this because it breaks access to emacs from my Android phone</span>
(setq org-startup-with-inline-images nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-playingwithditaa">
<h3 id="playingwithditaa"><a id="sec-16-3" name="sec-16-3"></a><span>16.3</span> Playing with ditaa</h3>
<div id="text-playingwithditaa">

<p>
<a href="http://ditaa.sourceforge.net/">ditaa</a> is a great tool for quickly generating graphics to convey ideas
and <code>ditaa</code> is distributed with org-mode!  All of the graphics in this
document are automatically generated by org-mode using plain text
source.
</p>

<p>
Artist mode makes it easy to create boxes and lines for ditaa
graphics.
</p>

<p>
The source for a ditaa graphic looks like this in org-mode:
</p>
<div>

<pre><span>#+begin_src ditaa :file some_filename.png :cmdline -r -s 0.8</span>
  &lt;context of ditaa source goes here&gt;
<span>#+end_src</span>
</pre>
</div>
<p>
Here's an example without the <code>#+begin_src</code> and <code>#+end_src</code> lines.
</p>

<div>

<pre>    +-----------+        +---------+  
    |    PLC    |        |         |                
    |  Network  +&lt;------&gt;+   PLC   +&lt;---=---------+ 
    |    cRED   |        |  c707   |              | 
    +-----------+        +----+----+              | 
                              ^                   | 
                              |                   | 
                              |  +----------------|-----------------+
                              |  |                |                 |
                              v  v                v                 v
      +----------+       +----+--+--+      +-------+---+      +-----+-----+       Windows clients
      |          |       |          |      |           |      |           |      +----+      +----+
      | Database +&lt;-----&gt;+  Shared  +&lt;----&gt;+ Executive +&lt;-=--&gt;+ Operator  +&lt;----&gt;|cYEL| . . .|cYEL|
      |   c707   |       |  Memory  |      |   c707    |      | Server    |      |    |      |    |
      +--+----+--+       |{d} cGRE  |      +------+----+      |   c707    |      +----+      +----+
         ^    ^          +----------+             ^           +-------+---+
         |    |                                   |                        
         |    +--------=--------------------------+                    
         v                                                             
+--------+--------+                                                         
|                 |                                                         
| Millwide System |            -------- Data ---------                      
| cBLU            |            --=----- Signals ---=--                      
+-----------------+
</pre>
</div>


<p><img src="http://doc.norang.ca/communication.png" alt="communication.png">
</p>
</div>
</div>

<div id="outline-container-Graphviz">
<h3 id="Graphviz"><a id="sec-16-4" name="sec-16-4"></a><span>16.4</span> Playing with graphviz</h3>
<div id="text-Graphviz">

<p>
<a href="http://www.graphviz.org/">Graphviz</a> is another great tool for creating graphics in your documents.
</p>

<p>
The source for a graphviz graphic looks like this in org-mode:
</p>
<div>

<pre><span>#+begin_src dot :file some_filename.png :cmdline -Kdot -Tpng</span>
  &lt;context of graphviz source goes here&gt;
<span>#+end_src</span>
</pre>
</div>

<div>

<pre>digraph G {
  size=<span>"8,6"</span>
  ratio=expand
  edge [dir=both]
  plcnet [shape=box, label=<span>"PLC Network"</span>]
  subgraph cluster_wrapline {
    label=<span>"Wrapline Control System"</span>
    color=purple
    subgraph {
    rank=same
    exec
    sharedmem [style=filled, fillcolor=lightgrey, shape=box]
    }
    edge[style=dotted, dir=none]
    exec -&gt; opserver
    exec -&gt; db
    plc -&gt; exec
    edge [style=line, dir=both]
    exec -&gt; sharedmem
    sharedmem -&gt; db
    plc -&gt; sharedmem
    sharedmem -&gt; opserver
  }
  plcnet -&gt; plc [constraint=false]
  millwide [shape=box, label=<span>"Millwide System"</span>]
  db -&gt; millwide

  subgraph cluster_opclients {
    color=blue
    label=<span>"Operator Clients"</span>
    rankdir=LR
    labelloc=b
    node[label=client]
    opserver -&gt; client1
    opserver -&gt; client2
    opserver -&gt; client3
  }
}
</pre>
</div>


<p><img src="http://doc.norang.ca/gv01.png" alt="gv01.png">
</p>

<p>
The <code>-Kdot</code> is optional (defaults to <code>dot</code>) but you can substitute other graphviz
types instead here (ie. <code>twopi</code>, <code>neato</code>, <code>circo</code>, etc).
</p>
</div>
</div>
<div id="outline-container-PlantUML">
<h3 id="PlantUML"><a id="sec-16-5" name="sec-16-5"></a><span>16.5</span> Playing with PlantUML</h3>
<div id="text-PlantUML">

<p>
I have just started using <a href="http://plantuml.sourceforge.net/">PlantUML</a> which is built on top of <a href="http://www.graphviz.org/">Graphviz</a>.
I'm still experimenting with this but so far I like it a lot.  The
todo state change diagrams in this document are created with PlantUML.
</p>

<p>
The source for a PlantUML graphic looks like this in org-mode:
</p>
<div>

<pre><span>#+begin_src plantuml :file somefile.png</span>
  &lt;context of PlantUML source goes here&gt;
<span>#+end_src</span>
</pre>
</div>
</div>
<div id="outline-container-PlantUMLSequence">
<h4 id="PlantUMLSequence"><a id="sec-16-5-1" name="sec-16-5-1"></a><span>16.5.1</span> Sequence Diagram</h4>
<div id="text-PlantUMLSequence">


<div>

<pre>title Example Sequence Diagram
activate Client
Client -&gt; Server: Session Initiation
note right: Client requests new session
activate Server
Client &lt;-- Server: Authorization Request
note left: Server requires authentication
Client -&gt; Server: Authorization Response
note right: Client provides authentication details
Server --&gt; Client: Session Token
note left: Session established
deactivate Server
Client -&gt; Client: Saves token
deactivate Client
</pre>
</div>


<p><img src="http://doc.norang.ca/sequence.png" alt="sequence.png">
</p>
</div>
</div>

<div id="outline-container-PlantUMLActivity">
<h4 id="PlantUMLActivity"><a id="sec-16-5-2" name="sec-16-5-2"></a><span>16.5.2</span> Activity Diagram</h4>
<div id="text-PlantUMLActivity">


<div>

<pre>title Example Activity Diagram
note right: Example Function
(*)--&gt; <span>"Step 1"</span>
--&gt; <span>"Step 2"</span>
-&gt; <span>"Step 3"</span>
--&gt; <span>"Step 4"</span>
--&gt; === STARTLOOP ===
note top: For each element in the array
if <span>"Are we done?"</span> then
  -&gt; [no] <span>"Do this"</span>
  -&gt; <span>"Do that"</span>
  note bottom: Important note\ngoes here
  -up-&gt; <span>"Increment counters"</span>
  --&gt; === STARTLOOP ===
else
  --&gt; [yes] === ENDLOOP ===
endif
--&gt; <span>"Last Step"</span>
--&gt; (*)
</pre>
</div>


<p><img src="http://doc.norang.ca/activity.png" alt="activity.png">
</p>
</div>
</div>

<div id="outline-container-PlantUMLUseCase">
<h4 id="PlantUMLUseCase"><a id="sec-16-5-3" name="sec-16-5-3"></a><span>16.5.3</span> Usecase Diagram</h4>
<div id="text-PlantUMLUseCase">

<div>

<pre>LabUser --&gt; (Runs Simulation)
LabUser --&gt; (Analyses Results)
</pre>
</div>


<p><img src="http://doc.norang.ca/usecase.png" alt="usecase.png">
</p>
</div>
</div>

<div id="outline-container-PlantUMLObject">
<h4 id="PlantUMLObject"><a id="sec-16-5-4" name="sec-16-5-4"></a><span>16.5.4</span> Object Diagram</h4>
<div id="text-PlantUMLObject">

<div>

<pre>Object1 &lt;|-- Object2
Object1: someVar
Object1: execute()
Object2: getState()
Object2: setState()
Object2: state
</pre>
</div>


<p><img src="http://doc.norang.ca/object.png" alt="object.png">
</p>
</div>
</div>

<div id="outline-container-PlantUMLState">
<h4 id="PlantUMLState"><a id="sec-16-5-5" name="sec-16-5-5"></a><span>16.5.5</span> State Diagram</h4>
<div id="text-PlantUMLState">

<div>

<pre>[*] --&gt; Start
Start -&gt; State2
State2 -&gt; State3
note right of State3: Notes can be\nattached to states
State2 --&gt; State4
State4 -&gt; Finish
State3 --&gt; Finish
Finish --&gt; [*]
</pre>
</div>


<p><img src="http://doc.norang.ca/plantuml_example_states.png" alt="plantuml_example_states.png">
</p>
</div>
</div>
</div>

<div id="outline-container-PublishingSingleFiles">
<h3 id="PublishingSingleFiles"><a id="sec-16-6" name="sec-16-6"></a><span>16.6</span> Publishing Single Files</h3>
<div id="text-PublishingSingleFiles">

<p>
Org-mode exports the current file to one of the standard formats by
invoking an export function.  The standard key binding for this is
<code>C-c C-e</code> followed by the key for the type of export you want.
</p>

<p>
This works great for single files or parts of files – if you narrow
the buffer to only part of the org-mode file then you only get the
narrowed detail in the export.
</p>
</div>
</div>
<div id="outline-container-PublishingProjects">
<h3 id="PublishingProjects"><a id="sec-16-7" name="sec-16-7"></a><span>16.7</span> Publishing Projects</h3>
<div id="text-PublishingProjects">

<p>
I mainly use publishing for publishing multiple files or projects.  I
don't want to remember where the created export file needs to move to
and org-mode projects are a great solution to this.
</p>

<p>
The <a href="http://doc.norang.ca/">http://doc.norang.ca</a> website (and a bunch of other files that are
not publicly available) are all created by editing org-mode files and
publishing the project the file is contained in.  This is great for
people like me who want to figure out the details once and forget
about it.  I love stuff that Just Works(tm).
</p>

<p>
I have 5 main projects I use org-mode publishing for currently:
</p>

<ul>
<li>norang (website)
</li>
<li>doc.norang.ca (website, published documents)
</li>
<li>doc.norang.ca/private (website, non-published documents)
</li>
<li>www.norang.ca/tmp (temporary publishing site for testing org-mode stuff)
</li>
<li>org files (which are selectively included by other websites)
</li>
</ul>

<p>
Here's my publishing setup:
</p>

<div>

<pre><span>; </span><span>experimenting with docbook exports - not finished</span>
(setq org-export-docbook-xsl-fo-proc-command <span>"fop %s %s"</span>)
(setq org-export-docbook-xslt-proc-command <span>"xsltproc --output %s /usr/share/xml/docbook/stylesheet/nwalsh/fo/docbook.xsl %s"</span>)
<span>;</span>
<span>; </span><span>Inline images in HTML instead of producting links to the image</span>
(setq org-html-inline-images t)
<span>; </span><span>Do not use sub or superscripts - I currently don't need this functionality in my documents</span>
(setq org-export-with-sub-superscripts nil)
<span>; </span><span>Use org.css from the norang website for export document stylesheets</span>
(setq org-html-head-extra <span>"&lt;link rel=\"stylesheet\" href=\"http://doc.norang.ca/org.css\" type=\"text/css\" /&gt;"</span>)
(setq org-html-head-include-default-style nil)
<span>; </span><span>Do not generate internal css formatting for HTML exports</span>
(setq org-export-htmlize-output-type (quote css))
<span>; </span><span>Export with LaTeX fragments</span>
(setq org-export-with-LaTeX-fragments t)
<span>; </span><span>Increase default number of headings to export</span>
(setq org-export-headline-levels 6)

<span>; </span><span>List of projects</span>
<span>; </span><span>norang       - http://www.norang.ca/</span>
<span>; </span><span>doc          - http://doc.norang.ca/</span>
<span>; </span><span>org-mode-doc - http://doc.norang.ca/org-mode.html and associated files</span>
<span>; </span><span>org          - miscellaneous todo lists for publishing</span>
(setq org-publish-project-alist
      <span>;</span>
      <span>; </span><span>http://www.norang.ca/  (norang website)</span>
      <span>; </span><span>norang-org are the org-files that generate the content</span>
      <span>; </span><span>norang-extra are images and css files that need to be included</span>
      <span>; </span><span>norang is the top-level project that gets published</span>
      (quote ((<span>"norang-org"</span>
               <span>:base-directory</span> <span>"~/git/www.norang.ca"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/www.norang.ca/htdocs"</span>
               <span>:recursive</span> t
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> org-html-publish-to-html
               <span>:style-include-default</span> nil
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"norang.css\" type=\"text/css\" /&gt;"</span>
               <span>:author-info</span> nil
               <span>:creator-info</span> nil)
              (<span>"norang-extra"</span>
               <span>:base-directory</span> <span>"~/git/www.norang.ca/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/www.norang.ca/htdocs"</span>
               <span>:base-extension</span> <span>"css</span><span>\\</span><span>|</span><span>pdf</span><span>\\</span><span>|</span><span>png</span><span>\\</span><span>|</span><span>jpg</span><span>\\</span><span>|</span><span>gif"</span>
               <span>:publishing-function</span> org-publish-attachment
               <span>:recursive</span> t
               <span>:author</span> nil)
              (<span>"norang"</span>
               <span>:components</span> (<span>"norang-org"</span> <span>"norang-extra"</span>))
              <span>;</span>
              <span>; </span><span>http://doc.norang.ca/  (norang website)</span>
              <span>; </span><span>doc-org are the org-files that generate the content</span>
              <span>; </span><span>doc-extra are images and css files that need to be included</span>
              <span>; </span><span>doc is the top-level project that gets published</span>
              (<span>"doc-org"</span>
               <span>:base-directory</span> <span>"~/git/doc.norang.ca/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs"</span>
               <span>:recursive</span> nil
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> (org-html-publish-to-html org-org-publish-to-org)
               <span>:style-include-default</span> nil
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"/org.css\" type=\"text/css\" /&gt;"</span>
               <span>:author-info</span> nil
               <span>:creator-info</span> nil)
              (<span>"doc-extra"</span>
               <span>:base-directory</span> <span>"~/git/doc.norang.ca/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs"</span>
               <span>:base-extension</span> <span>"css</span><span>\\</span><span>|</span><span>pdf</span><span>\\</span><span>|</span><span>png</span><span>\\</span><span>|</span><span>jpg</span><span>\\</span><span>|</span><span>gif"</span>
               <span>:publishing-function</span> org-publish-attachment
               <span>:recursive</span> nil
               <span>:author</span> nil)
              (<span>"doc"</span>
               <span>:components</span> (<span>"doc-org"</span> <span>"doc-extra"</span>))
              (<span>"doc-private-org"</span>
               <span>:base-directory</span> <span>"~/git/doc.norang.ca/private"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs/private"</span>
               <span>:recursive</span> nil
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> (org-html-publish-to-html org-org-publish-to-org)
               <span>:style-include-default</span> nil
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"/org.css\" type=\"text/css\" /&gt;"</span>
               <span>:auto-sitemap</span> t
               <span>:sitemap-filename</span> <span>"index.html"</span>
               <span>:sitemap-title</span> <span>"Norang Private Documents"</span>
               <span>:sitemap-style</span> <span>"tree"</span>
               <span>:author-info</span> nil
               <span>:creator-info</span> nil)
              (<span>"doc-private-extra"</span>
               <span>:base-directory</span> <span>"~/git/doc.norang.ca/private"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs/private"</span>
               <span>:base-extension</span> <span>"css</span><span>\\</span><span>|</span><span>pdf</span><span>\\</span><span>|</span><span>png</span><span>\\</span><span>|</span><span>jpg</span><span>\\</span><span>|</span><span>gif"</span>
               <span>:publishing-function</span> org-publish-attachment
               <span>:recursive</span> nil
               <span>:author</span> nil)
              (<span>"doc-private"</span>
               <span>:components</span> (<span>"doc-private-org"</span> <span>"doc-private-extra"</span>))
              <span>;</span>
              <span>; </span><span>Miscellaneous pages for other websites</span>
              <span>; </span><span>org are the org-files that generate the content</span>
              (<span>"org-org"</span>
               <span>:base-directory</span> <span>"~/git/org/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/org"</span>
               <span>:recursive</span> t
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> org-html-publish-to-html
               <span>:style-include-default</span> nil
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"/org.css\" type=\"text/css\" /&gt;"</span>
               <span>:author-info</span> nil
               <span>:creator-info</span> nil)
              <span>;</span>
              <span>; </span><span>http://doc.norang.ca/  (norang website)</span>
              <span>; </span><span>org-mode-doc-org this document</span>
              <span>; </span><span>org-mode-doc-extra are images and css files that need to be included</span>
              <span>; </span><span>org-mode-doc is the top-level project that gets published</span>
              <span>; </span><span>This uses the same target directory as the 'doc' project</span>
              (<span>"org-mode-doc-org"</span>
               <span>:base-directory</span> <span>"~/git/org-mode-doc/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs"</span>
               <span>:recursive</span> t
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> (org-html-publish-to-html)
               <span>:plain-source</span> t
               <span>:htmlized-source</span> t
               <span>:style-include-default</span> nil
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"/org.css\" type=\"text/css\" /&gt;"</span>
               <span>:author-info</span> nil
               <span>:creator-info</span> nil)
              (<span>"org-mode-doc-extra"</span>
               <span>:base-directory</span> <span>"~/git/org-mode-doc/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/doc.norang.ca/htdocs"</span>
               <span>:base-extension</span> <span>"css</span><span>\\</span><span>|</span><span>pdf</span><span>\\</span><span>|</span><span>png</span><span>\\</span><span>|</span><span>jpg</span><span>\\</span><span>|</span><span>gif</span><span>\\</span><span>|</span><span>org"</span>
               <span>:publishing-function</span> org-publish-attachment
               <span>:recursive</span> t
               <span>:author</span> nil)
              (<span>"org-mode-doc"</span>
               <span>:components</span> (<span>"org-mode-doc-org"</span> <span>"org-mode-doc-extra"</span>))
              <span>;</span>
              <span>; </span><span>http://doc.norang.ca/  (norang website)</span>
              <span>; </span><span>org-mode-doc-org this document</span>
              <span>; </span><span>org-mode-doc-extra are images and css files that need to be included</span>
              <span>; </span><span>org-mode-doc is the top-level project that gets published</span>
              <span>; </span><span>This uses the same target directory as the 'doc' project</span>
              (<span>"tmp-org"</span>
               <span>:base-directory</span> <span>"/tmp/publish/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/www.norang.ca/htdocs/tmp"</span>
               <span>:recursive</span> t
               <span>:section-numbers</span> nil
               <span>:table-of-contents</span> nil
               <span>:base-extension</span> <span>"org"</span>
               <span>:publishing-function</span> (org-html-publish-to-html org-org-publish-to-org)
               <span>:html-head</span> <span>"&lt;link rel=\"stylesheet\" href=\"http://doc.norang.ca/org.css\" type=\"text/css\" /&gt;"</span>
               <span>:plain-source</span> t
               <span>:htmlized-source</span> t
               <span>:style-include-default</span> nil
               <span>:auto-sitemap</span> t
               <span>:sitemap-filename</span> <span>"index.html"</span>
               <span>:sitemap-title</span> <span>"Test Publishing Area"</span>
               <span>:sitemap-style</span> <span>"tree"</span>
               <span>:author-info</span> t
               <span>:creator-info</span> t)
              (<span>"tmp-extra"</span>
               <span>:base-directory</span> <span>"/tmp/publish/"</span>
               <span>:publishing-directory</span> <span>"/ssh:www-data@www:~/www.norang.ca/htdocs/tmp"</span>
               <span>:base-extension</span> <span>"css</span><span>\\</span><span>|</span><span>pdf</span><span>\\</span><span>|</span><span>png</span><span>\\</span><span>|</span><span>jpg</span><span>\\</span><span>|</span><span>gif"</span>
               <span>:publishing-function</span> org-publish-attachment
               <span>:recursive</span> t
               <span>:author</span> nil)
              (<span>"tmp"</span>
               <span>:components</span> (<span>"tmp-org"</span> <span>"tmp-extra"</span>)))))

<span>; </span><span>I'm lazy and don't want to remember the name of the project to publish when I modify</span>
<span>; </span><span>a file that is part of a project.  So this function saves the file, and publishes</span>
<span>; </span><span>the project that includes this file</span>
<span>;</span>
<span>; </span><span>It's bound to C-S-F12 so I just edit and hit C-S-F12 when I'm done and move on to the next thing</span>
(<span>defun</span> <span>bh/save-then-publish</span> (<span>&amp;optional</span> force)
  (interactive <span>"P"</span>)
  (save-buffer)
  (org-save-all-org-buffers)
  (<span>let</span> ((org-html-head-extra)
        (org-html-validation-link <span>"&lt;a href=\"http://validator.w3.org/check?uri=referer\"&gt;Validate XHTML 1.0&lt;/a&gt;"</span>))
    (org-publish-current-project force)))

(global-set-key (kbd <span>"C-s-&lt;f12&gt;"</span>) 'bh/save-then-publish)
</pre>
</div>

<p>
The main projects are <code>norang</code>, <code>doc</code>, <code>doc-private</code>, <code>org-mode-doc</code>,
and <code>tmp</code>.  These projects publish directly to the webserver directory
on a remote web server that serves the site.  Publishing one of these
projects exports all modified pages, generates images, and copies the
resulting files to the webserver so that they are immediately
available for viewing.
</p>

<p>
The <a href="http://doc.norang.ca/">http://doc.norang.ca/</a> site contains subdirectories with client and
private documentation that are restricted by using Apache Basic
authentication.  I don't create links to these sites from the publicly
viewable pages.  <a href="http://doc.norang.ca/someclient/">http://doc.norang.ca/someclient/</a> would show the index
for any org files under <code>~/git/doc.norang.ca/someclient/</code> if that is
set up as a viewable website.  I use most of the information myself
but give access to clients if they are interested in the
information/notes that I keep about their systems.
</p>

<p>
This works great for me - I know where my notes are and I can access
them from anywhere on the internet.  I'm also free to share notes with
other people by simply giving them the link to the appropriate site.
</p>

<p>
All I need to remember to do is edit the appropriate org file and
publish it with C-S-F12 – not exactly hard :)
</p>

<p>
I added a temporary publishing site for testing exports and
validation.  This is the <code>tmp</code> site which takes files from
<code>/tmp/publish</code> and exports those files to a website publishing
directory.  This makes it easy to try new throw-away things on a live
server.
</p>
</div>
</div>
<div id="outline-container-MiscBabelExportSettings">
<h3 id="MiscBabelExportSettings"><a id="sec-16-8" name="sec-16-8"></a><span>16.8</span> Miscellaneous Export Settings</h3>
<p>
This is a collection of export and publishing related settings that I
use.
</p>
<div id="outline-container-FontifyLatexListings">
<h4 id="FontifyLatexListings"><a id="sec-16-8-1" name="sec-16-8-1"></a><span>16.8.1</span> Fontify Latex listings for source blocks</h4>
<div id="text-FontifyLatexListings">

<p>
For export to latex I use the following setting to get fontified
listings from source blocks:
</p>

<div>

<pre>(setq org-latex-listings t)
</pre>
</div>
</div>
</div>

<div id="outline-container-AllowVariableBindingForExport">
<h4 id="AllowVariableBindingForExport"><a id="sec-16-8-3" name="sec-16-8-3"></a><span>16.8.3</span> Allow binding variables on export without confirmation</h4>
<div id="text-AllowVariableBindingForExport">

<p>
The following setting allows #+BIND: variables to be set on export
without confirmation.  In rare situations where I want to override
some org-mode variable for export this allows exporting the document
without a prompt.
</p>

<div>

<pre>(setq org-export-allow-BIND t)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-Reminders">
<h2 id="Reminders"><a id="sec-17" name="sec-17"></a><span>17</span> Reminders</h2>
<div id="text-Reminders">

<p>
I use appt for reminders.  It's simple and unobtrusive – putting
pending appointments in the status bar and beeping as 12, 9, 6, 3,
and 0 minutes before the appointment is due.
</p>

<p>
Everytime the agenda is displayed (and that's lots for me) the
appointment list is erased and rebuilt from the current agenda
details for today.  This means everytime I reschedule something, add
or remove tasks that are time related the appointment list is
automatically updated the next time I look at the agenda.
</p>
</div>
<div id="outline-container-ReminderSetup">
<h3 id="ReminderSetup"><a id="sec-17-1" name="sec-17-1"></a><span>17.1</span> Reminder Setup</h3>
<div id="text-ReminderSetup">

<div>

<pre><span>; </span><span>Erase all reminders and rebuilt reminders for today from the agenda</span>
(<span>defun</span> <span>bh/org-agenda-to-appt</span> ()
  (interactive)
  (setq appt-time-msg-list nil)
  (org-agenda-to-appt))

<span>; </span><span>Rebuild the reminders everytime the agenda is displayed</span>
(add-hook 'org-agenda-finalize-hook 'bh/org-agenda-to-appt 'append)

<span>; </span><span>This is at the end of my .emacs - so appointments are set up when Emacs starts</span>
(bh/org-agenda-to-appt)

<span>; </span><span>Activate appointments so we get notifications</span>
(appt-activate t)

<span>; </span><span>If we leave Emacs running overnight - reset the appointments one minute after midnight</span>
(run-at-time <span>"24:01"</span> nil 'bh/org-agenda-to-appt)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-Unused">
<h2 id="Unused"><a id="sec-19" name="sec-19"></a><span>19</span> Things I Don't Use (Anymore)</h2>
<p>
This is a partial list of things I know about but do not use.
<code>org-mode</code> is huge with tons of features.  There are features out
there that I don't know about yet or haven't explored so this list is
not going to be complete.
</p>
<div id="outline-container-ArchiveSibling">
<h3 id="ArchiveSibling"><a id="sec-19-1" name="sec-19-1"></a><span>19.1</span> Archive Sibling</h3>
<p>
This was a cute idea but I find archiving entire complete subtrees
better.  I don't mind having a bunch of tasks marked <code>DONE</code> (but not
archived)
</p>
</div>
<div id="outline-container-StrikeThroughEmphasis">
<h3 id="StrikeThroughEmphasis"><a id="sec-19-2" name="sec-19-2"></a><span>19.2</span> Strike-through emphasis</h3>
<div id="text-StrikeThroughEmphasis">

<p>
Strike-through emphasis is just unreadable and tends to only show up
when pasting data from other files into org-mode.  This just removes
the strike-through completely which I find a lot nicer.
</p>

<div>

<pre>(setq org-emphasis-alist (quote ((<span>"*"</span> bold <span>"&lt;b&gt;"</span> <span>"&lt;/b&gt;"</span>)
                                 (<span>"/"</span> italic <span>"&lt;i&gt;"</span> <span>"&lt;/i&gt;"</span>)
                                 (<span>"_"</span> underline <span>"&lt;span style=\"text-decoration:underline;\"&gt;"</span> <span>"&lt;/span&gt;"</span>)
                                 (<span>"="</span> org-code <span>"&lt;code&gt;"</span> <span>"&lt;/code&gt;"</span> verbatim)
                                 (<span>"~"</span> org-verbatim <span>"&lt;code&gt;"</span> <span>"&lt;/code&gt;"</span> verbatim))))
</pre>
</div>
</div>
</div>
<div id="outline-container-SubscriptsAndSuperscripts">
<h3 id="SubscriptsAndSuperscripts"><a id="sec-19-3" name="sec-19-3"></a><span>19.3</span> Subscripts and Superscripts</h3>
<div id="text-SubscriptsAndSuperscripts">

<p>
I don't currently write documents that need subscripts and superscript
support.  I disable handling of <code>_</code> and <code>^</code> for subscript and
superscripts with
</p>

<div>

<pre>(setq org-use-sub-superscripts nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-Yasnippets">
<h3 id="Yasnippets"><a id="sec-19-4" name="sec-19-4"></a><span>19.4</span> Yasnippet</h3>
<div id="text-Yasnippets">

<p>
<a href="http://code.google.com/p/yasnippet/">Yasnippet</a> is cool but I don't use this anymore.  I've replaced
yasnippet with a combination of <code>abbrev-mode</code> and <code>skeletons</code> which
are available by default in Emacs.
</p>

<p>
The following description applies to yasnippet version 0.5.10.  The setup
requirements may have changed with newer versions.
</p>

<p>
You type the snippet name and <code>TAB</code> and yasnippet expands the name
with the contents of the snippet text - substituting snippet variables
as appropriate.
</p>

<p>
Yasnippet comes with lots of snippets for programming languages.  I
used a few babel related snippets with <code>org-mode</code>.
</p>

<p>
I downloaded and installed the unbundled version of yasnippet so that
I can edit the predefined snippets.  I unpacked the yasnippet software
in my <code>~/.emacs.d/plugins</code> directory, renamed <code>yasnippet0.5.10</code> to
<code>yasnippet</code> and added the following setup in my <code>.emacs</code>:
</p>

<div>

<pre>(add-to-list 'load-path (expand-file-name <span>"~/.emacs.d/plugins"</span>))

(<span>require</span> '<span>yasnippet</span>)
(yas/initialize)
(yas/load-directory <span>"~/.emacs.d/plugins/yasnippet/snippets"</span>)

<span>;; </span><span>Make TAB the yas trigger key in the org-mode-hook and enable flyspell mode and autofill</span>
(add-hook 'org-mode-hook
          (<span>lambda</span> ()
            <span>;; </span><span>yasnippet</span>
            (make-variable-buffer-local 'yas/trigger-key)
            (org-set-local 'yas/trigger-key [tab])
            (define-key yas/keymap [tab] 'yas/next-field-group)
            <span>;; </span><span>flyspell mode for spell checking everywhere</span>
            (flyspell-mode 1)
            <span>;; </span><span>auto-fill mode on</span>
            (auto-fill-mode 1)))
</pre>
</div>

<p>
I used snippets for the following:
</p>
<ul>
<li><code>begin</code> for generic <code>#+begin_</code> blocks
</li>
<li><code>dot</code>   for graphviz
</li>
<li><code>uml</code>   for PlantUML graphics
</li>
<li><code>sh</code>    for bash shell scripts
</li>
<li><code>elisp</code> for emacs lisp code
</li>
<li>initials of a person converts to their full name
I used this while taking meeting notes
</li>
</ul>

<p>
Here is the definition for the <code>begin</code> snippet:
</p>

<p>
org-mode Yasnippet: ~/.emacs.d/plugins/yasnippet/snippets/text-mode/org-mode/begin
</p>
<pre>#name : #+begin_...#+end_
# --     
#+begin_$1 $2
$0
#+end_$1
</pre>

<p>
I used this to create <code>#+begin_*</code> blocks like 
</p>
<ul>
<li><code>#+begin_example</code>
</li>
<li><code>#+begin_src</code>
</li>
<li>etc.
</li>
</ul>

<p>
Simply type <code>begin</code> and then <code>TAB</code> it replaces the <code>begin</code> text with
the snippet contents.  Then type <code>src TAB emacs-lisp TAB</code> and your
snippet block is done.  I've shortened this specific sequence to just
<code>elisp TAB</code> since I use it fairly often.
</p>

<p>
Hit <code>C-c SingeQuote(')</code> and insert whatever emacs-lisp code you need.
While in this block you're in a mode that knows how to format and
colourize emacs lisp code as you enter it which is really nice.  <code>C-c
SingleQuote(')</code> exits back to org-mode.  This recognizes any emacs
editing mode so all you have to do is enter the appropriate mode name
for the block.
</p>

<p>
<code>dot</code>
</p>
<pre>#dot : #+begin_src dot ... #+end_src
# --
#+begin_src dot :file $1 :cmdline -Kdot -Tpng
$0
#+end_src
</pre>

<p>
<code>uml</code>
</p>
<pre>#uml : #+begin_src plantuml ... #+end_src
# --
#+begin_src plantuml :file $1
$0
#+end_src
</pre>

<p>
<code>sh</code>
</p>
<pre>#sh: #+begin_src sh ... #+end_src
# --
#+begin_src sh :results output
$0
#+end_src
</pre>


<p>
<code>elisp</code>
</p>
<pre>#elisp : #+begin_src emacs-lisp ...#+end_src emacs-lisp
# --
#+begin_src emacs-lisp
$0
#+end_src
</pre>

<p>
This is a great time saver.
</p>
</div>
</div>
<div id="outline-container-HeadingLevelsOddEven">
<h3 id="HeadingLevelsOddEven"><a id="sec-19-5" name="sec-19-5"></a><span>19.5</span> Show headings at odd levels only or odd-even levels</h3>
<div id="text-HeadingLevelsOddEven">
<p>
This has been replaced by org-indent-mode
</p>

<p>
I've converted my files between odd-levels-only and odd-even using the
functions <code>org-convert-to-odd-levels</code> and
<code>org-convert-to-oddeven-levels</code> functions a number of times.  I ended
up going back to odd-even levels to reduce the amount of leading
whitespace on tasks.  I didn't find that lining up the headlines and
tasks in odd-levels-only to be all that helpful.
</p>

<div>

<pre>(setq org-odd-levels-only nil)
</pre>
</div>
</div>
</div>
<div id="outline-container-PropagateStartedToParent">
<h3 id="PropagateStartedToParent"><a id="sec-19-6" name="sec-19-6"></a><span>19.6</span> Propagate STARTED to parent tasks</h3>
<div id="text-PropagateStartedToParent">

<p>
I used to have a <code>STARTED</code> and <code>NEXT</code> task state.  These were
basically the same except <code>STARTED</code> indicated that I've clocked some
time on the task.  Since then I've just moved to using <code>NEXT</code> for
this.
</p>

<p>
The following code used to propagate the <code>STARTED</code> task up the project
tree but I don't use this anymore.
</p>

<p>
When a task is marked <code>STARTED</code> (either manually or by clocking it in) the <code>STARTED</code>
state propagates up the tree to any parent tasks of this task that are <code>TODO</code> or <code>NEXT</code>.
As soon as I work on the first <code>NEXT</code> task in a tree the project is also marked <code>STARTED</code>.
This helps me keep track of things that are in progress.
</p>

<p>
Here's the setup I use to propagate <code>STARTED</code> to parent tasks:
</p>

<div>

<pre><span>;; </span><span>Mark parent tasks as started</span>
(<span>defvar</span> <span>bh/mark-parent-tasks-started</span> nil)

(<span>defun</span> <span>bh/mark-parent-tasks-started</span> ()
  <span>"Visit each parent task and change TODO states to STARTED"</span>
  (<span>unless</span> bh/mark-parent-tasks-started
    (<span>when</span> (equal org-state <span>"STARTED"</span>)
      (<span>let</span> ((bh/mark-parent-tasks-started t))
        (<span>save-excursion</span>
          (<span>while</span> (org-up-heading-safe)
            (<span>when</span> (member (nth 2 (org-heading-components)) (list <span>"TODO"</span> <span>"NEXT"</span>))
              (org-todo <span>"STARTED"</span>))))))))

(add-hook 'org-after-todo-state-change-hook 'bh/mark-parent-tasks-started 'append)
</pre>
</div>
</div>
</div>
<div id="outline-container-AutomaticallyClockingTasks">
<h3 id="AutomaticallyClockingTasks"><a id="sec-19-7" name="sec-19-7"></a><span>19.7</span> Automatically clocking tasks</h3>
<div id="text-AutomaticallyClockingTasks">

<p>
I used to spend time on an open source project called BZFlag.  During
work for releases I want to clock the time I spend testing the new
BZFlag client.  I have a key binding in my window manager that runs a
script which starts the clock on my testing task, runs the BZFlag
client, and on exit resumes the clock on the previous clocking task.
</p>

<p>
The testing task has an ID property of
<code>dcf55180-2a18-460e-8abb-a9f02f0893be</code> and the following elisp code
starts the clock on this task.
</p>

<div>

<pre>(<span>defun</span> <span>bh/clock-in-bzflagt-task</span> ()
  (interactive)
  (bh/clock-in-task-by-id <span>"dcf55180-2a18-460e-8abb-a9f02f0893be"</span>))
</pre>
</div>

<p>
This is invoked by a bash shell script as follows:
</p>

<div>

<pre><span>#</span><span>!/bin/</span><span>sh</span>
emacsclient -e <span>'(bh/clock-in-bzflagt-task)'</span>
~/git/bzflag/trunk/bzflag/src/bzflag/bzflag -directory ~/git/bzflag/trunk/bzflag/data $<span>*</span>
emacsclient -e <span>'(bh/resume-clock)'</span>
</pre>
</div>

<p>
The resume clock function just returns the clock to the previous clocking task
</p>

<div>

<pre>(<span>defun</span> <span>bh/resume-clock</span> ()
  (interactive)
  (<span>if</span> (marker-buffer org-clock-interrupted-task)
      (org-with-point-at org-clock-interrupted-task
        (org-clock-in))
    (org-clock-out)))
</pre>
</div>

<p>
If no task was clocking <code>bh/resume-clock</code> just stops the clock.
</p>
</div>
</div>
<div id="outline-container-QBuriesAgenda">
<h3 id="QBuriesAgenda"><a id="sec-19-8" name="sec-19-8"></a><span>19.8</span> q buries the agenda view buffer</h3>
<div id="text-QBuriesAgenda">


<p>
With <a href="#StickyAgendas">Sticky Agendas</a> burying the buffer is the default behaviour for
the <code>q</code> key so this is not needed anymore.
</p>

<p>
I change the <code>q</code> key in the agenda so instead of killing the agenda buffer
it merely buries it to the end of the buffer list.  This allows me to 
pull it back up quickly with the <code>q</code> speed key or <code>f9 f9</code> and regenerate
the results with <code>g</code>.
</p>

<div>

<pre>(add-hook 'org-agenda-mode-hook
          (<span>lambda</span> ()
            (define-key org-agenda-mode-map <span>"q"</span> 'bury-buffer))
          'append)
</pre>
</div>
</div>
</div>
<div id="outline-container-TaskPriorities">
<h3 id="TaskPriorities"><a id="sec-19-9" name="sec-19-9"></a><span>19.9</span> Task Priorities</h3>
<div id="text-TaskPriorities">

<p>
I use the agenda to figure out what to do work on next.  I don't use
priorities at all normally but at work I occasionally get priorities
from my manager.  In this case I mark my tasks with the priorities
from the external source just to track the values and force the agenda
to display tasks in the priority order.
</p>

<p>
I use priorities A-E where tasks without a specific priority are lowest priority E.
</p>
<div>

<pre>(setq org-enable-priority-commands t)
(setq org-default-priority ?E)
(setq org-lowest-priority ?E)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-GitSync">
<h2 id="GitSync"><a id="sec-20" name="sec-20"></a><span>20</span> Using Git for Automatic History, Backups, and Synchronization</h2>
<div id="text-GitSync">

<p>
Editing folded regions of your org-mode file can be hazardous to your
data.  My method for dealing with this is to put my org files in a
<code>Git</code> source repository.
</p>

<p>
My setup saves all of my org-files every hour and creates a commit
with my changes automatically.  This lets me go back in time and view
the state of my org files for any given hour over the lifetime of the
document.  I've used this once or twice to recover data I accidentally
removed while editing folded regions.
</p>
</div>
<div id="outline-container-HourlyCommits">
<h3 id="HourlyCommits"><a id="sec-20-1" name="sec-20-1"></a><span>20.1</span> Automatic Hourly Commits</h3>
<div id="text-HourlyCommits">

<p>
My Emacs setup saves all org buffers at 1 minute before the hour using
the following code in my <code>.emacs</code>
</p>

<div>

<pre>(run-at-time <span>"00:59"</span> 3600 'org-save-all-org-buffers)
</pre>
</div>

<p>
A <code>cron</code> job runs at the top of the hour to commit any changes just
saved by the call to <code>org-save-all-org-buffers</code> above.  I use a script
to create the commits so that I can run it on demand to easily commit
all modified work when moving from one machine to another.
</p>

<p>
<code>crontab</code> details:
</p>
<pre>0 * * * * ~/bin/org-git-sync.sh &gt;/dev/null
</pre>
</div>
<div id="outline-container-OrgGitSyncSh">
<h4 id="OrgGitSyncSh"><a id="sec-20-1-1" name="sec-20-1-1"></a><span>20.1.1</span> ~/bin/org-git-sync.sh</h4>
<div id="text-OrgGitSyncSh">

<p>
Here is the shell script I use to create a <code>git</code> commit for each of my
org-repositories.  This loops through multiple repositories and
commits any modified files.  I have the following org-mode
repositories:
</p>

<ul>
<li>org 

<p>
for all of my organization project files and todo lists
</p>
</li>

<li>doc-norang.ca

<p>
for any changes to documents under <a href="http://doc.norang.ca/">http://doc.norang.ca/</a>
</p>
</li>

<li>www.norang.ca

<p>
for any changes to my other website <a href="http://www.norang.ca/">http://www.norang.ca/</a>
</p>
</li>
</ul>

<p>
This script does not create empty commits - <code>git</code> only creates a commit
if something was modified.
</p>
<div>

<pre><span>#</span><span>!/bin/</span><span>sh</span>
<span># </span><span>Add org file changes to the repository</span>
<span>REPOS</span>=<span>"org doc.norang.ca www.norang.ca"</span>

<span>for</span> REPO<span> in</span> $<span>REPOS</span>
<span>do</span>
    <span>echo</span> <span>"Repository: $REPO"</span>
    <span>cd</span> ~/git/$<span>REPO</span>
    <span># </span><span>Remove deleted files</span>
    git ls-files --deleted -z | xargs -0 git rm &gt;/dev/null 2&gt;&amp;1
    <span># </span><span>Add new files</span>
    git add . &gt;/dev/null 2&gt;&amp;1
    git commit -m <span>"$(</span><span>date</span><span>)"</span>
<span>done</span>
</pre>
</div>

<p>
I use the following <code>.gitignore</code> file in my org-mode <code>git</code>
repositories to keep export generated files out of my <code>git</code>
repositories.  If I include a graphic from some other source than
ditaa or graphviz then I'll add it to the repository manually.  By
default all PNG graphic files are ignored (since I assume they are
produced by ditaa during export)
</p>
<pre>core
core.*
*.html
*~
.#*
\#*\#
*.txt
*.tex
*.aux
*.dvi
*.log
*.out
*.ics
*.pdf
*.xml
*.org-source
*.png
*.toc
</pre>
</div>
</div>
</div>
<div id="outline-container-GitEditWithConfidence">
<h3 id="GitEditWithConfidence"><a id="sec-20-2" name="sec-20-2"></a><span>20.2</span> Git - Edit files with confidence</h3>
<div id="text-GitEditWithConfidence">

<p>
I use <code>git</code> in all of my directories where editing a file should be
tracked.
</p>

<p>
This means I can edit files with confidence.  I'm free to change stuff
and break things because it won't matter.  It's easy to go back to a
previous working version or to see exactly what changed since the last
commit.  This is great when editing configuration files (such as
apache webserver, bind9 DNS configurations, etc.)
</p>

<p>
I find this extremely useful where your edits might break things and
having <code>git</code> tracking the changes means if you break it you can just
go back to the previous working version easily.  This is also true for
package upgrades for software where the upgrade modifies the
configuration files.
</p>

<p>
I have every version of my edits in a local <code>git</code> repository.
</p>
</div>
</div>
<div id="outline-container-git-sync">
<h3 id="git-sync"><a id="sec-20-3" name="sec-20-3"></a><span>20.3</span> Git Repository synchronization</h3>
<div id="text-git-sync">

<p>
I acquired a Eee PC 1000 HE which now serves as my main road-warrior
laptop replacing my 6 year old Toshiba Tecra S1.
</p>

<p>
I have a server on my LAN that hosts bare git repositories for all of
my projects.  The problem I was facing is I have to leave in 5 minutes
and want to make sure I have up-to-date copies of everything I work on
when I take it on the road (without Internet access).
</p>

<p>
To solve this I use a server with bare git repositories on it.  This
includes my org-mode repositories as well as any other git
repositories I'm interested in.
</p>

<p>
Just before I leave I run the <code>git-sync</code> script on my workstation to
update the bare git repositories and then I run it again on my Eee PC
to update all my local repositories on the laptop.  For any
repositories that give errors due to non-fast-forward merges I
manually merge as required and rerun <code>git-sync</code> until it reports no
errors.  This normally takes a minute or two to do.  Then I grab my
Eee PC and leave.  When I'm on the road I have full up-to-date history
of all my git repositories.
</p>

<p>
The <code>git-sync</code> script replaces my previous scripts with an all-in-one
tool that basically does this:
</p>

<ul>
<li>for each repository on the current system
<ul>
<li>fetch objects from the remote
</li>
<li>for each branch that tracks a remote branch
<ul>
<li>Check if the ref can be moved
<ul>
<li>fast-forwards if behind the remote repository and is fast-forwardable
</li>
<li>Does nothing if ref is up to date
</li>
<li>Pushes ref to remote repository if ref is ahead of remote repository and fast-forwardable
</li>
<li>Fails if ref and remote have diverged
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

<p>
This automatically advances changes on my 35+ git repositories with
minimal manual intervention.  The only time I need to manually do
something in a repository is when I make changes on my Eee PC and my
workstation at the same time - so that a merge is required.
</p>

<p>
Here is the <code>git-sync</code> script
</p>

<div>

<pre><span>#</span><span>!/bin/</span><span>sh</span>
<span>#</span>

<span># </span><span>Local bare repository name</span>
<span>syncrepo</span>=norang
<span>reporoot</span>=~/git

<span># </span><span>Display repository name only once</span>
log_repo() {
  [ <span>"x$lastrepo"</span> == <span>"x$repo"</span> ] || {
    <span>printf</span> <span>"\nREPO: ${repo}\n"</span>
    <span>lastrepo</span>=<span>"$repo"</span>
  }
}

<span># </span><span>Log a message for a repository</span>
log_msg() {
  log_repo
  <span>printf</span> <span>"  $1\n"</span>
}

<span># </span><span>fast-forward reference $1 to $syncrepo/$1</span>
fast_forward_ref() {
  log_msg <span>"fast-forwarding ref $1"</span>
  <span>current_ref</span>=$(<span>cat</span> .git/HEAD)
  <span>if</span> [ <span>"x$current_ref"</span> = <span>"xref: refs/heads/$1"</span> ]
  <span>then</span>
    <span># </span><span>Check for dirty index</span>
    <span>files</span>=$(<span>git</span> diff-index --name-only HEAD --)
    git merge refs/remotes/$<span>syncrepo</span>/$<span>1</span>
  <span>else</span>
    git branch -f $<span>1</span> refs/remotes/$<span>syncrepo</span>/$<span>1</span>
  <span>fi</span>
}

<span># </span><span>Push reference $1 to $syncrepo</span>
push_ref() {
  log_msg <span>"Pushing ref $1"</span>
  <span>if</span> ! git push --tags $<span>syncrepo</span> $<span>1</span>
  <span>then</span>
    <span>exit</span> 1
  <span>fi</span>
}

<span># </span><span>Check if a ref can be moved</span>
<span>#   </span><span>- fast-forwards if behind the sync repo and is fast-forwardable</span>
<span>#   </span><span>- Does nothing if ref is up to date</span>
<span>#   </span><span>- Pushes ref to $syncrepo if ref is ahead of syncrepo and fastforwardable</span>
<span>#   </span><span>- Fails if ref and $syncrop/ref have diverged</span>
check_ref() {
  <span>revlist1</span>=$(<span>git</span> rev-list refs/remotes/$<span>syncrepo</span>/$<span>1</span>..$<span>1</span>)
  <span>revlist2</span>=$(<span>git</span> rev-list $<span>1</span>..refs/remotes/$<span>syncrepo</span>/$<span>1</span>)
  <span>if</span> [ <span>"x$revlist1"</span> = <span>"x"</span> -a <span>"x$revlist2"</span> = <span>"x"</span> ]
  <span>then</span>
    <span># </span><span>Ref $1 is up to date.</span>
    :
  <span>elif</span> [ <span>"x$revlist1"</span> = <span>"x"</span> ]
  <span>then</span>
    <span># </span><span>Ref $1 is behind $syncrepo/$1 and can be fast-forwarded.</span>
    fast_forward_ref $<span>1</span> || <span>exit</span> 1
  <span>elif</span> [ <span>"x$revlist2"</span> = <span>"x"</span> ]
  <span>then</span>
    <span># </span><span>Ref $1 is ahead of $syncrepo/$1 and can be pushed.</span>
    push_ref $<span>1</span> || <span>exit</span> 1
  <span>else</span>
    log_msg <span>"Ref $1 and $syncrepo/$1 have diverged."</span>
    <span>exit</span> 1
  <span>fi</span>
}

<span># </span><span>Check all local refs with matching refs in the $syncrepo</span>
check_refs () {
  git for-each-ref refs/heads/* | <span>while </span><span>read</span> sha1 commit ref
  <span>do</span>
    <span>ref</span>=${<span>ref</span>/refs<span>\/</span>heads<span>\/</span>/}
    git for-each-ref refs/remotes/$<span>syncrepo</span>/$<span>ref</span> | <span>while </span><span>read</span> sha2 commit ref2
    <span>do</span>
      <span>if</span> [ <span>"x$sha2"</span> != <span>"x"</span> -a <span>"x$sha2"</span> != <span>"x"</span> ]
      <span>then</span>
        check_ref $<span>ref</span> || <span>exit</span> 1
      <span>fi</span>
    <span>done</span>
  <span>done</span>
}

<span># </span><span>For all repositories under $reporoot</span>
<span>#   </span><span>Check all refs matching $syncrepo and fast-forward, or push as necessary</span>
<span>#   </span><span>to synchronize the ref with $syncrepo</span>
<span>#   </span><span>Bail out if ref is not fastforwardable so user can fix and rerun</span>
<span>time</span> {
  <span>retval</span>=0
  <span>if</span> find $<span>reporoot</span> -type d -name <span>'*.git'</span> | { 
      <span>while </span><span>read</span> repo
      <span>do</span>
        <span>repo</span>=${<span>repo</span>/<span>\/</span>.git/}
        <span>cd</span> ${<span>repo</span>}
        <span>upd</span>=$(<span>git</span> remote update $<span>syncrepo</span> 2&gt;&amp;1 || <span>retval</span>=1)
        [ <span>"x$upd"</span> = <span>"xFetching $syncrepo"</span> ] || {
          log_repo
          <span>printf</span> <span>"$upd\n"</span>
        }
        check_refs || <span>retval</span>=1
      <span>done</span>
      <span>exit</span> $<span>retval</span>
    }
  <span>then</span>
    <span>printf</span> <span>"\nAll done.\n"</span>
  <span>else</span>
    <span>printf</span> <span>"\nFix and redo.\n"</span>
  <span>fi</span>
}

<span>exit</span> $<span>retval</span>
</pre>
</div>
</div>
</div>
</div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>