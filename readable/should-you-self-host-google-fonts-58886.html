<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Should you self-host Google Fonts? - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Should you self-host Google Fonts? - linksfor.dev(s)"/>
    <meta property="og:description" content="A deep dive into the performance implications of using Google Fonts (good and bad) and whether self-hosting is better."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.tunetheweb.com/blog/should-you-self-host-google-fonts/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Should you self-host Google Fonts?</title>
<div class="readable">
        <h1>Should you self-host Google Fonts?</h1>
            <div>Reading time: 34-43 minutes</div>
        <div>Posted here: 23 Feb 2020</div>
        <p><a href="https://www.tunetheweb.com/blog/should-you-self-host-google-fonts/">https://www.tunetheweb.com/blog/should-you-self-host-google-fonts/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="main">

	<article>





<p>This page was originally created on <time datetime="2020-01-12">12-Jan-2020</time> and last edited on <time datetime="2020-02-23">23-Feb-2020</time>.</p>
<h2 id="introduction">Introduction</h2>

<p>In the last few weeks, because of a combination of various things at work, and in side-projects, I've been learning a lot about web fonts and also a lot more about Google Fonts specifically. Through that I've come up with a more nuanced answer to the question, that in the past I thought was easy: should you self-host Google Fonts?</p>

<p>Now, to be totally up front, I'll admit that fonts are not my strong point. I'm much more practical than design-y (look at this website for evidence of that!) and have never totally got the need for fonts. Sure they look a bit nicer, and can understand they make a message seem more on-brand, but for the main body of text at least they seem more of a nice to have - I've never read an article more or less (or treated the contents any differently) because it had a pretty font. However, I've also been acutely aware of the performance implications of them so maybe that's clouded my view of them.</p>

<p>Still, many feel differently, and fonts are here, whether I appreciate them or not, and many developers aren't given a choice whether to use them or not. So let's look at what we can do to minimise the performance impact, but also give the designers what they want - win win!</p>

<h2 id="self-hosting-assers">Self-Hosting assets versus Third-Party hosting</h2>

<p>A few years back it was all the rage to use a CDN to serve common assets (e.g. jQuery from https://code.jquery.com - and yes <a href="https://almanac.httparchive.org/en/2019/javascript#open-source-libraries-and-frameworks">jQuery is still very much a thing!</a>). To be clear when I say CDN here, I mean where you are loading some assets from someone else's domain, rather than a CDN fronting your domain.</p>



<p>The theory behind this was that browsers limited the number of connections to each domain (typically to 6 connections) so using another domain gave you 6 more connections. While that may have been true in the past (particularly when browsers limited it to less than 6 domains) and before <a href="https://www.tunetheweb.com/security/https/">HTTPS</a> became the norm, now <a href="https://www.tunetheweb.com/blog/critical-resources-and-the-first-14kb/">connections are expensive to create</a>. Additionally <a href="https://www.tunetheweb.com/performance/http2/">HTTP/2</a> actually benefits from one connection (mostly!) so using other domains is often a performance cost rather than gain.</p>

<p>Another way of doing this was by sharding your domain with one or more assets subdomain (e.g. assets.example.com) so again the fonts are not hosted on your main domain where your web page is loaded from. However, it has the same connection issues so again this is not the performance benefits it may once have had.</p>

<p>The other supposed benefit of using a public CDN, was from leveraging the fact that visitors might already have that version of jQuery loaded in their HTTP cache, but again I'm convinced that's over-egged. There are so many libraries and versions, and <a href="https://www.speedshop.co/2015/11/05/page-weight-doesnt-matter.html#http-caching">browser caches are smaller than you think</a>, so for you to be lucky enough to gain from this seems unlikely. Additionally <a href="https://andydavies.me/blog/2018/09/06/safari-caching-and-3rd-party-resources/">Safari has a unique HTTP cache per domain visited</a>, for privacy reasons (called a double-keyed cache) and <a href="https://www.chromestatus.com/feature/5280299309072384">Chrome soon will have too</a>, ending any argument there.</p>

<p>That leads nicely into the privacy implications of using third-party CDNs. You have no idea what sort of tracking they are doing to your users by using them, rather than self-hosting. And recent legislation means a lot of sites have to explicitly list all the cookies used on the site, which gets more complicated when using a third-party.</p>

<p>I've been convinced for a while now that third-party CDNs, or even sharding your own domains, are not the performance boast they are thought to be. All too often you see the main domain serving the index.html, and then that connection not being used for anything else <a href="https://nooshu.github.io/blog/2019/12/30/how-to-read-a-wpt-connection-view-chart/#underutilised-connections">as time is instead wasted setting up new connections</a>.</p>
  
<p>This is not to mention the security implications of loading assets from another domain. Yes there is <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity">SRI</a> but that can <a href="https://nooshu.github.io/blog/2019/12/17/http2-and-sri-dont-always-get-on/">cause unexpected issues</a>, and I honestly don't see the point. If it is a static asset (where you can use SRI) then self-host, and if it is not static (because the contents are liable to change) then you can't use SRI.</p>

<p>On a related point, using a third-party, also introduces the risk of them becoming a single point of failure (SPOF) and taking down your website if it goes offline for any reason. This has been <a href="http://www.stevesouders.com/blog/2010/06/01/frontend-spof/">recognised for a long time</a> and while it may seem unlikely that Google Fonts will go down, it can be blocked by company proxies or <a href="https://www.labsterx.com/blog/things-to-consider-when-building-a-website-in-china-9-shtml/">whole countries</a>.</p>

<p>All in all, more and more have been advising to <a href="https://csswizardry.com/2019/05/self-host-your-static-assets/">self-host your static assets</a>, ideally on the domain you serve the web pages from. Fonts are static assets, so they should also be self-hosted right? Well it turns out it is not quite as simple as that because fonts have their own peculiarities and performance optimisations that might make self-hosting a little trickier...</p>

<h2 id="google-fonts">Google Fonts and how they work.</h2>

<p><a href="https://fonts.google.com/">Google Fonts</a> is an amazing resource for those of you that are into your fonts. It has 977 open-source fonts for anyone to use completely for free. Commercial fonts are ridiculously expensive for those of you that have ever looked into them and they are also usually licenced rather than bought, and are charged based on expected number of page views - like they will run out through use! To have so many free fonts in one collection and so easy to use is therefore very useful.</p>

<p>Google Fonts, however, takes it one step further. Like many providers of website assets (see jQuery example above), they also provide a CDN and host the fonts for you to use directly from them. This means you can start using fonts just by adding one line of code to your website to pull in the style sheet, like this:</p>

<p>&lt;link href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap" rel="stylesheet"&gt;
</p>

<p>You can also add more weights and fonts to that one line to load several fonts and variations of each font:</p>

<p>&lt;link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i,900%7CPoppins:300,400,700,900&amp;display=swap" rel="stylesheet"&gt;
</p>

<p>The downside to this is in performance (the upside is also in performance but that side is not as obvious - we'll get to that). The problem is that your website (say <code>www.example.com</code>) loads the stylesheet from <code>fonts.googleapis.com</code>, which returns some CSS made up of <code>font-face</code> declarations. Using the first example above, returns this then I view that URL in Chrome:</p>

<p>/* latin-ext */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2) format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXiWtFCc.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
</p>

We'll get into what some of those settings mean later (and also why there are two <code>font-face</code>  declarations), but for now this means you can use this font in your style like the following:

<p>body {
    font-family: 'Lato', sans-serif;
}
</p>

<p>However this means you have to connect to <code>fonts.googleapis.com</code>, download the CSS, then connect to <code>fonts.gstatic.com</code> to download the actual fonts (why Google can't host both the CSS and the fonts on the one domain I really don't know!).</p>
<p>Fonts are often discovered late by the browser when loading a page (as you need to download the CSS to see the font references) but Google Fonts are discovered extra late, as you need to download the CSS from <em>another domain</em>, then the fonts from a <em>3rd domain</em> and, as discussed above, making an HTTPS connection takes time. This can be seen in the following waterfall diagram generated by <a href="https://www.webpagetest.org/">WebPageTest</a> (note all tests were run with Chrome - 3GSlow):</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/gfonts.png" alt="Waterfall showing connection delays when using Google Fonts" height="352" width="1892"></p>

<p>You can see on line 1 we are downloading the HTML then, once that's downloaded and read at just under 2 seconds, the browsers sees the need for the Google Fonts CSS and downloads it on line 4. This takes a second just to make the connection, and then at 3.5 seconds we download the stylesheet, and we see the actual font we need and download that on line 6 - which takes about another second and a quarter to make the connection to fonts.gstatic.com, before we can actually start downloading the font.</p>

<p>So we can see using this font from Google Fonts is costing us a full 3 seconds of performance from the HTML being available, before we even start downloading the font!</p>

<h3 id="google-fonts-with-resource-hints">Improving Google Fonts with resource hints.</h3>

<p>We can mitigate some of this performance hit of downloading the CSS and then the fonts from two different domains. The first domain (for the CSS) should be fairly high up your index.html so hopefully will be seen early enough, but the second domain is not seen until later. However we <em>know</em> what that domain will be (<code>fonts.gstatic.com</code>), so we can use a <code>preconnect</code> resource hint to ask the browser to open the connection in advance to save some of that second connection time later:</p>
<p>&lt;link href="https://fonts.gstatic.com" rel="preconnect" crossorigin&gt;
&lt;link href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap" rel="stylesheet"&gt;
</p>

<p>Rerunning our test produces the waterfall below:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/gfonts-preconnect.png" alt="Waterfall Google Fonts with preconnect" height="348" width="1908"></p>

<p>Here we can see the connection on line 5 is set up in advance, before we download the CSS. This leads to over a second of improvement (downloading the fonts at 4 seconds, rather 5.25 seconds) as we do not pay that connection set up penalty, but instead can download the fonts as soon as we've read the Google Fonts CSS.</p>

<p>You might think you could take it to the next stage and <code>preload</code> the whole font, rather than settle for just <code>preconnect</code>-ing to the domain, but Google Fonts creates unique hashes for their font names. In above example the font downloaded is S6uyw4BMUTPHjx4wXg.woff2 rather than lato.woff2, so preloading is not possible, unless you want to leave your site open to breakage if they ever change that hash.</p>

<p>Anyway, if you are using Google Fonts and do nothing else after reading this post, at least add that <code>preconnect</code> hint if it's not there already - it's one line of code and should improve the performance of your page.</p>

<p>In fact Google Fonts actually returns that <code>preconnect</code> hint as a <code>link</code> HTTP Header when it returns the CSS as shown below:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/gfonts-preconnect-link-header.png" alt="Google Fonts returns the preconnect hint as a link header" height="454" width="1414"></p>

<p>In a lot of cases, this won't really help as by this point the browser now knows you want to connect to this domain to download the fonts, so you are still better specifying this in your HTML to get the <code>preconnect</code> started earlier (it doesn't matter that it's in both and the second hint will just be ignored). However if your page is still processing by the time this comes in, and the DOM is not ready (a sign of too much JavaScript on you page maybe?), then this can help improve the performance when it finally does figure out which of those fonts it needs.</p>

<h2 id="font-display-swap">Font Display Swap</h2>

<p>In the above <code>font-face</code> code you can see a <code>font-display: swap;</code> line. This is a relatively new instruction you can add to your <code>font-face</code> declaration which tells the browser to use the fallback, system font (<code>sans-serif</code> in this example) initially and then swap-in the real font once it has been downloaded. This means the content is not delayed waiting on the font, and so is seen as a good performance improvement.</p>

<p>This does lead to a flash of unstyled text (FOUT), which can be jarring and some don't like (personally I'm on the fence - I agree the content is more important than the styling but the jolt as the font steps in is often jarring and while mitigating it is possible by tweaking the fallback font, it is tricky). The alternative is the flash of invisible text (FOIT) where the text is hidden until the font comes in, which obviously delays the load and can cause other problems <a href="https://www.zachleat.com/web/mitt-romney-webfont-problem/">if some text loads and other text doesn't</a>!</p>

<p>Anyway, prior to its introduction, different browsers handled this differently - some like IE and Edge used FOUT, others used FOIT, and they had various timeouts as to when giving up waiting on the fonts. This could leave your content invisible for a long time if the font failed to download. The introduction of <code>font-display: swap</code> put that choice in the website owners control. It also has <a href="https://caniuse.com/#feat=mdn-css_at-rules_font-face_font-display">wide browser support</a> except for IE and Edge but, as per above, they use this by default anyway. Google fonts also <a href="https://twitter.com/addyosmani/status/1128548064287952896">supports different font-display options</a>, and suggests <code>font-display: swap</code> by default.</p>

<p>So, another tip, if you are using Google fonts is to check you have that that <code>&amp;display=swap</code> parameter to your loading URL, and if not (as it's only recently become supported), then add it:</p>

<p>For example, change from this:</p>

<p>&lt;link href="https://fonts.gstatic.com" rel="preconnect" crossorigin&gt;
&lt;link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"&gt;
</p>

<p>to this:</p>

<p>&lt;link href="https://fonts.gstatic.com" rel="preconnect" crossorigin&gt;
&lt;link href="https://fonts.googleapis.com/css?family=Lato&amp;display=swap" rel="stylesheet"&gt;
</p>

<p>You can also specify <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display">one of the other font-display values</a>, like <a href="https://css-tricks.com/really-dislike-fout-font-display-optional-might-jam/">optional if you prefer</a>.</p>

<p>Unfortunately, this only solves half the problem. This instruction is in the CSS that Google Fonts returns, so it is only useful <em>after</em> you have downloaded the CSS file. So this helps deal with the delay while the fonts themselves are downloading but does not help while you are waiting for that CSS to download. So a good improvement (at least for those who prefer FOUT), but still not the whole solution.</p>

<h2 id="self-hosting-google-fonts">Self-hosting Google Fonts.</h2>

<p>I've been <a href="https://www.tunetheweb.com/blog/helping-to-create-the-web-almanac">helping to create the Web Almanac</a> (a fantastic look at the state of the web - <a href="https://almanac.httparchive.org/en/2019/">check it out</a> if you've not seen it yet), and the slow loading of the Google Fonts on our site annoyed me and was something I wanted to look at. Especially with the jarring <code>font-display: swap</code> behaviour. I wanted to see if we could reduce the impact of this, and the natural solution seemed to be self-hosting, possibly with the use of <code>preload</code>.</p>

<p>We had already used the above performance improvements (<code>preload</code> and <code>font-display: swap;</code>), but surely it would be better to not have to make that annoying CSS call at all - and then remove the need for the <code>preconnect</code> completely? We know what will be in that CSS so surely self-hosting is better? Well that's where it gets interesting...</p>

<p>I found a handy script <a href="https://github.com/neverpanic/google-font-download">(Google Font Download)</a> on GitHub to help me download all the various font variations (as we had a lot of them - up to 9 depending on the page), and then I copied the CSS it outputted into our main style sheet and added the fonts to our host directory. There are also <a href="https://google-webfonts-helper.herokuapp.com/fonts">online tools that do the same</a>. This all seemed to work and we got rid of that annoying CSS download and two domains - self-hosting for the win!</p>

<p>However, on closer inspection I noticed the fonts were bigger:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/font-size-increase-from-self-hosting.png" alt="Comparison showing the sizes of various fonts - the ones on the left are up to 43% bigger" height="554" width="713"></p>

<p>As you can see there was a hefty size increase (up to 74% extra for some of them!) from the Google Font loaded fonts (on the right) and the locally hosted fonts (on the left). I initially thought this was due to my local development web-server, presumably due to compression, but WOFF2 fonts are served uncompressed by the web server - or at least should be - since the format includes Brotli compression. Also the screenshot above shows the downloaded bytes (in black above) and also the uncompressed bytes (in slightly lighter colour on the bottom) for each column (they are similar enough in both columns as the fonts <em>are</em> being served without further compression by the web server, but the downloaded bytes include HTTP headers so are slightly larger), and there were differences in both compressed and uncompressed bytes, so it wasn't that.</p>

<p>Comparing the <code>font-face</code> declarations produced by the tool highlighted one difference:</p>

<p>From Google Fonts:</p>

<p>/* latin-ext */
@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2) format('woff2');
    unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXiWtFCc.woff2) format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
</p>

<p>From the download tool:</p>

<p>@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    src:
        local('Lato Regular'),
        local('Lato-Regular'),
        /* from https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXg.woff2 */
        url('Lato_400.woff2') format('woff2'),
        /* from https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wWA.woff */
        url('Lato_400.woff') format('woff');
}
</p>

<p>The first difference is we've lost our <code>font-display: swap</code> line, so we can add that back in easily enough, but more interestingly is the fact that Google Fonts is serving two fonts - and including a different <code>unicode-range</code>, in them. This is due to font-subsetting and it reduces font files.</p>

<h2 id="font-subsetting">Font Subsetting</h2>

<p>Font subsetting involves removing the characters you are not going to use to reduce the size of the font file. Typically most western users will just use the Latin characters, and downloading a font with all the characters you probably won't use is wasteful. I'd heard of it before but had never realised the dramatic impact it can have! Google Fonts will automatically provide a <code>font-face</code> with subset fonts for Latin language and will also, where available, provide a second font for the missing extended Latin characters (e.g. Ā) which will only be downloaded if needed.</p>

<p>In fact you can take it a step further and also ask for a special font containing only the characters you want with the <code>text</code> parameter:</p>

<p>https://fonts.googleapis.com/css?family=Lato&amp;text=ABC
</p>

<p>Upon further reading, the font download tool I used apparently does support font subsetting, but only at a whole "language" (Latin or Latin-ext) and it merged both subsetted fonts into one file. So I ended up reverting to using what my browser was using, and stopped using this tool. This gave downloads of a similar side (only slightly difference being due to slightly different HTTP headers on my development environment), but I was soon to discover that it was not just subsetting that made the difference.</p>

<h2 id="google-fonts-css">Google Font is clever about how it serves the fonts</h2>

<p>Google Font does <em>not</em> serve the same CSS every time but instead <a href="https://twitter.com/davelab6/status/1127289794197970944?s=20">basis it on the user-agent provided</a>. So for Internet Explorer 11 it provides the following:</p>

<p>@font-face {
    font-family: 'Lato';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: local('Lato Regular'), local('Lato-Regular'), url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wWA.woff) format('woff');
}
</p>

<p>Here you can see it is only providing the WOFF format, as IE 11 <a href="https://caniuse.com/#feat=woff2">does not support WOFF2</a>, and it is not providing the <code>unicode-range</code> for the same reason. It does supply <code>font-display: swap</code> (as I specified that in the URL for the CSS) despite it not supporting that, but it does no harm.</p>

<p>It's not just browser make and version either. <a href="https://www.typotheque.com/articles/hinting">Font hinting</a> involves extra instructions in the font file which are then used to ensure the font is displayed the best - especially on low resolution screens or for really small sizes. Font hinting is used by Windows, but not MacOS so depending which you use to get your Google Fonts if using the browser (even if using Chrome on each platform), you'll get font files with hints or without hints. If you then download the Windows version and serve those locally, you'll actually make your MacOS users suffer with larger font files full of hints that will not be used, and if you do the opposite you'll make Windows users potentially suffer with worse fonts as they will get no hints, when previously they did.</p>

<p>When I use Google Fonts, and also when I downloaded the fonts locally, I was doing it on my Mac, so got the smaller, un-hinted fonts. When I used the tool I got the full, hinted fonts. So this was another reason for the large size difference!</p>
    
<p><a href="https://typedrawers.com/discussion/comment/24519">Whether hinting is still relevant</a> as high definition screens have become more common is a good question, and many fonts do not come with hints, because they are so time consuming to create. When they are present they can dramatically increase the size of the fonts - Lato is doubled in size with hints. Whether they are worth that extra load is another decision you'll need to take if moving off Google Fonts to self-hosting.</p>

<p>So the Google Fonts CDN is backed by a clever script to serve the most appropriate fonts, and optimise for performance. By moving to self-hosted fonts you are taking on the responsibility to set this all up correctly, and may even be losing support for your fonts in some browsers if you don't.</p>

<p>For the Web Almanac we looked at the browsers that visited us and made the decision to only support WOFF2, and also use the MacOS versions without hinting since they were half the size. This made the CSS simpler (especially with the fact that <a href="https://caniuse.com/#feat=font-unicode-range">unicode-range support</a> is basically supported by all <a href="https://caniuse.com/#feat=woff2">browsers that support WOFF2</a>). IE 11 users, and other older browsers, default back to <code>sans-serif</code> which does not look quite as nice, but we are seeing the fonts as a progressive enhancement as the site is still more than useable without them. Additionally older browsers, on older machines may even benefit from using default, system fonts as they are more likely to be on older, under-powered machines.</p>

<p>You can also <a href="https://www.zachleat.com/web/css-tricks-web-fonts/">make further adjustments to the fonts</a> if you so please (check the font licences first though!) and have more advanced knowledge, but copying the Google Fonts defaults used by Chrome on MacOS is probably sufficient for the most of us if you're willing to only support WOFF2 browsers and not have hinting. If you want the hinting, the fonts returned for Chrome on Windows is probably your best option, and then you can add other formats like WOFF if you want.</p>

<p>Still if we'd stuck with Google Fonts, then we'd have got WOFF (and even older formats) and font hinting or not as appropriate, without even having to think about it, and without any hassle of checking browser support to help decide which versions to serve locally, or thinking about font-subsetting or anything like that. So there are definite benefits to using the Google Fonts site to serve the fonts, and you are giving these up by self-hosting. This includes benefiting from any <a href="https://twitter.com/davelab6/status/1127289852460969984?s=20">future enhancements to Google Fonts</a>.</p>

<h2 id="future-font-improvements">Future Font Improvements</h2>

<p>Since I was delving deep into fonts, and since I warned that you might lose any future benefits from Google Fonts by self-hosting, I'm going to take a slight side-step into other things I've discovered while working on this. What are the big upcoming changes in the font world? Well, there are two changes which are getting a lot of buzz at the moment and which may impact fonts in future (and therefore may be supported by Google Fonts, perhaps by default, if you stayed with them): <em>variable fonts</em> and <em>progressive font enrichment</em>.</p>

<h3 id="variable-fonts">Variable Fonts</h3>

<p><a href="https://developers.google.com/web/fundamentals/design-and-ux/typography/variable-fonts">Variable fonts</a>, allow different styles of a font to be used without having to download separate fonts. I mentioned earlier that the Web Almanac uses up to 9 different font files, but it is really only for 2 fonts. The reasons we have 9 font files, is we also have a bold, italic, bold-italic, black (basically super bold!) and even light versions of one or both of them. That might seem ridiculous to have so many variations of the same font (it surprised me!) and you'd think the browser could make fonts a little thicker for bold, or slate them for italics. Well they can, but each browser does it slightly differently, and the results can be <a href="https://alistapart.com/article/say-no-to-faux-bold/">completely wrong</a>, hence why many people call them "faux fonts".</p>

<p>The only way to ensure you display what you want to, is to use a "real font" specifically for each weight and style you need. Variable fonts however <a href="https://drafts.csswg.org/css-fonts-4/">standardises how to apply variations of a font</a>, so you no longer need to download completely separate font files. This means, in theory, we could replace those 9 fonts, with just 2 when variable font versions of them become available.</p>

<p>This opens up a load of possibilities in font usage on the web. While I might think it is ridiculous to have 9 variations of two fonts, this is actually quite limited whereas variable fonts allows endless variations. On mobile you might want a slightly different thickness for "bold" than on desktop and on tablet, you might want somewhere in between - variable fonts allows that option, with some <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/font-variation-settings">simple CSS instructions</a>, without the expense of another font. <a href="https://twitter.com/jpamental">Jason Pamental</a> gave a <a href="https://www.dotconferences.com/2019/12/jason-pamental-dynamic-typographic-systems-with-variable-fonts"> fantastic talk on variable fonts at DotCSS recently</a> and has a <a href="https://codepen.io/jpamental/full/MGEPEL">demo page</a> showing how you can have a beautifully styled page with apparently many different fonts - all from one font file!</p>

<p>Using variable fonts also means that all variations of the font can load at the same time <a href="https://www.zachleat.com/web/mitt-romney-webfont-problem/">avoiding confusion caused by font loading issues mentioned previously</a>. This also results in less layout repaints: without variable fonts the page will redraw as each individual font variation is downloaded, which can result in many <a href="https://youtu.be/FbguhX3n3Uc?t=527">reflows</a>.</p>

<p><a href="https://caniuse.com/#feat=variable-fonts">Variable fonts have very good support in modern browsers</a>, but the downside to variable fonts is that the font files are bigger to accommodate for the extra instructions (exactly like hints do too). It depends on the font, but typically they are up to twice as big after compression so you'd want to be making use of at least two styles to make them worthwhile. Even then you might be better prioritising one, smaller file being downloaded to display your critical text, rather than one larger file to display all your text. Then again with <code>font-display: swap</code>, maybe that's less of an issue? That's for each site owner to decide!</p>

<h3 id="progressive-font-enrichment">Progressive Font Enrichment</h3>

<p><a href="https://rwt.io/typography-tips/progressive-font-enrichment-reinventing-web-font-performance">Progressive font enrichment</a>, basically takes the subsetting to the next level and allows downloading of additional character definitions as they are needed as a stream of extra information which supplements the currently downloaded font, rather than adding an additional one. This may seem like small gains for a lot of effort for us westerners, but for other languages - particularly in the far east - font files can be <em>massive</em> (like <a href="http://hayataki-masaharu.jp/web-typography-in-japanese/#Web_safe_font_stack_in_Japanese">2Mb massive</a>), given all the characters in those languages. For this reason web fonts are not used as much on those countries and progressive font enrichment may open web fonts up to sites in those languages.</p>

<p>Progressive font enrichment seems to be at a much earlier stage than variable fonts from my understanding, but there is <a href="https://fonts.gstatic.com/experimental/incxfer_demo">an online demo available</a>. However they are another potentially exciting change coming to fonts.</p>

<h3 id="will-google-fonts-continue-to-be-enhanced">Will Google Fonts Continue to be Enhanced?</h3>

<p>Because of the way Google Fonts works, you can imagine it could drop in enhancements like these (or many others!) just by changing the CSS it returns to you. And it could be clever about when to do this. Obviously only when your browser supports it (like it does now with the font format - WOFF or WOFF2), or for other ways. For example if you ask more than two fonts, and it is cheaper to return the variable font, then it could do that automatically and reference the same font file in multiple <code>font-face</code> declarations, but if you request only one variant then reference the smaller, traditional font. Sound far-fetched? They <a href="https://rwt.io/typography-tips/what-web-wants">already did this with one font (Oswald)</a>! I'll be honest and admit I don't know if the same is possible with progressive font enrichment as I don't fully understand how they work, but it will be interesting to see.</p>

<p>This is not to mention that when fonts are updated, perhaps to add new character sets or correct errors in the glyphs, you get the new ones automatically when using Google Fonts directly, but not when self-hosting - at least not without the manual effort of updating them. Perhaps you could look at proxying the requests via your domain for the best of both worlds, but this would likely still be slower and requires extra setup and management.</p>

<p>On the flip side, self-hosting provides stability as some updates may affect your design, for example if a one line title starts stretching to two lines because of a font change. There are a few instanced of people getting <em>very</em> upset about this but will save linking to them to hide the rage from you.</p>

<h2 id="benefit-of-self-hosting">Benefits of Self-Hosting</h2>

<p>OK so we've a lot of background and theory here, and while there are clear potential performance benefits from self-hosting, there are also complexities to consider and so using the Google Fonts site has some clear benefits too. So is self-hosting still worth it? Well that depends on the actual gains, so you can make that judgement call. Small performance improvements maybe would mean you'd stick with Google Fonts, large improvements would be a different story.</p>

<p>For the Web Almanac we recently <a href="https://github.com/HTTPArchive/almanac.httparchive.org/pull/607">switched to self-hosting our Google Fonts</a>, and with testing we saw a <em>dramatic</em> change, as can be seen below:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/local-gfonts.png" alt="Filmstrip view showing locally hosted Google Fonts version loads almost completely in 2.4 seconds instead of 6.0 seconds" height="714" width="2622"></p>

<p>The bottom image is with the locally hosted fonts on our test server and you can see the load time has halved from 6 seconds to 3 seconds! In fact when I drilled down I saw it was even better than half (3.3 seconds saving)!</p>

<p>What is not as apparent (but which we'll see later), unless you've very good eyes, is the fonts have not actually loaded at this point in either image - they happen by 7.5 seconds on locally hosted version and by 10.5 seconds on the Google Fonts hosted version. However the fonts are similar enough to the fall backs that there is only a small reflow in this case so it's less jarring than it is on some sites. This can be seen in the visual progress chart below:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/local-gfonts-visual-progress.png" alt="Visual progress chart showing locally hosted Google Fonts version loads almost completely in 2.4 seconds instead of 6.0 seconds" height="1034" width="1590"></p>

<p>The chart shows the page for the locally hosted version (in red) is almost fully loaded at 2.4 seconds, and then has a few further enhancements as image downloads, and then the fonts drop into play. Yeah I'd still like to avoid that reflow completely, but hey there is still a performance cost to fonts that we can't optimise for!</p>

<p>The reason why the improvements are so dramatic, are due to one more thing I did not consider: CSS is render blocking. So the fact you included a Google Fonts CSS link, doesn't just hold up displaying the text - it holds up displaying <em>everything!</em> We know the font is a progressive enhancement and we can safely draw the rest of the page, and even the text itself (with fallback fonts) but the browser doesn't - it just sees that there is some CSS to download so holds up the whole page, while we connect to that domain, and then download it. <a href="https://www.filamentgroup.com/lab/load-css-simpler/">There is no async for CSS</a> - but perhaps there should be for cases like this? This also makes the risk of Google Fonts being unavailable, mentioned above, even larger as your whole site will be render blocked in this case until the browser times out!</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/gfonts-css-blocking-initial-render.png" alt="Waterfall chart showing start render is delayed waiting for the Google Fonts to download." height="786" width="1644"></p>

<p>In the above waterfall, you can see the vertical green Start Render line only happens at 6 seconds - as it has to wait for the Google Fonts CSS to downloaded on line 12, which spends half the time connecting to the domain, and the other half doing the actual download.</p>

<p>Compare this to the locally hosted version:</p>

<p><img src="https://www.tunetheweb.com/assets/images/blog/gfonts-local-earlier-render.png" alt="Waterfall chart showing start render is not delayed." height="720" width="1644"></p>

<p>Here we are able to start rendering as soon as soon as the site's CSS is downloaded and processed at 2.5 seconds. There is no delay while it connects to the Google Fonts domain to get that CSS.</p>

<p>In both cases we can see the start render happens before the fonts are downloaded, and thanks to the magic of <code>font-display: swap</code>, the text is still visible. Therefore, at least when using <code>font-display: swap</code>, it would be better if Google Fonts didn't load via render-blocking CSS, and instead loaded via some async JavaScript which then injects the CSS line into the page only when they've downloaded. If they did this, they'd not have any start render delays, but on the flip side, there would still be the connection delays so a longer time when unstyled text is displayed. Edit: I raised a <a href="https://github.com/google/fonts/issues/2315">suggestion to have a non-render blocking way to load Google Fonts</a> on their GitHub issues list - upvote it if you want that too!</p>

<p><a href="https://twitter.com/zachleat">Zach Leatherman</a> advocates <a href="https://www.youtube.com/watch?v=FbguhX3n3Uc&amp;feature=youtu.be&amp;t=1934">this approach to reduce reflows</a>, and shows it is also possible with just JavaScript and without needed a CSS file. He then shows some other benefits of your fonts being managed by JavaScript, whereby you can choose to remove fonts completely if on a slow network (using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Network_Information_API">Network Information API</a>) or if the user has <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/save-data">Save-Data</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion">Prefers-Reduced-Motion</a> settings enabled. Interesting possibilities!</p>

<h2 id="preloading-fonts">Preloading fonts</h2>

<p>Once you self-host, and move away from Google's hashed URLs you have the option of preloading the font for further performance gains. This is one that has some potential downsides however, as discussed by <a href="https://twitter.com/AndyDavies">Andy Davies</a> in his <a href="https://andydavies.me/blog/2019/02/12/preloading-fonts-and-the-puzzle-of-priorities/">Preloading Fonts and the Puzzle of Priorities blog post</a>. Basically by preloading fonts, and moving them up the priority queue, you're implicitly deprioritising other critical loads (e.g. CSS), and due to a <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=788757">bug in Chrome, the fonts may even jump ahead of some of those</a>.</p>

<p>Additionally preloading when the font won't be used will cause a wasteful download - for example if a local version exists and can be used in preference, as described in our <code>font-face</code> declaration above (though I didn't go into this!), or if a browser doesn't support that font format (though all browsers that support <code>preload</code> also support WOFF2). While they do recommend <code>preload</code>, Google <a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/webfont-optimization#preload_your_webfont_resources">explicitly warns you to consider this</a>, and it is good to see them calling this out.</p>

<p>With <code>font-display: swap</code>, the need for <code>preload</code> may not be as high, though you may still benefit from preloading a small number of fonts to avoid FOUT and redraws. At the moment we haven't turned <code>preload</code> on in the Web Almanac as part of the move to locally-hosting our fonts and will need to do some more testing if we want to do this but for now I'm happy with it as is.</p>

<h2 id="conclusion">Conclusion</h2>

<p>To answer the question in the title of this post: yes it's better to self-host as the performance gains are substantial. Of course your mileage may vary as it will depend on your exact site so test, test, test, but I would imagine it would be the better option, from a performance perspective, for most sites.</p>

<p>However, Google Fonts is not just a repository of hundreds of free fonts - it is also a clever delivery mechanism utilising many of the latest web performance techniques to try to deliver the most appropriate fonts, with the minimal effort to the website owner. In moving to self-hosting you ideally want to re-implement as many of those improvements like <code>font-display: swap</code>, subsetting, and removal of hinting (at least for some browsers), or you may actually negatively impact performance by having larger fonts files.</p>

<p>There is some complexity involved in this (which Google Fonts handles for you) but with WOFF2-only being a realistic option now, and good support of most techniques with inbuilt fallbacks, this is easier than it used to be. Still it pays to have some web font knowledge when setting this all up (which hopefully this post has helped with!), and you may want to keep an ear out for upcoming changes in the font world as there will undoubtedly be further improvements to come.</p>

<p>Alternatively maybe we're over optimising here, and using the full font, with hints and no subsetting, is sufficient when serving locally? There is a download option on the Google Fonts website in the Family Selected pop up which makes that relatively easy, though weirdly <a href="https://twitter.com/dickelippe/status/1217382271050813440?s=20">it does not include WOFF and WOFF2 formats when using this</a>, for reasons that I don't understand! However if you are really that interested in web performance (and you should be!), then you should try to do this properly. This post just shows this is a bit more complex than downloading and hosting on your site as I always presumed it was.</p>

<p>Wow, that ended up being even longer than I thought it would be! But hopefully you found it as interesting as I did researching all this, and hopefully it gives you some ideas on improving your font loading time. I'd strongly encourage you to follow <a href="https://twitter.com/jpamental">Jason</a> and <a href="https://twitter.com/zachleat">Zach</a> on Twitter for more font goodness, and also <a href="https://twitter.com/AndyDavies">Andy</a> for general web performance advice.</p>




		<p>This page was originally created on <time datetime="2020-01-12">12-Jan-2020</time> and last edited on <time datetime="2020-02-23">23-Feb-2020</time>.</p>
		<a href="https://twitter.com/intent/tweet?text=Should%20you%20self-host%20Google%20Fonts?&amp;via=tunetheweb&amp;url=https://www.tunetheweb.com/blog/should-you-self-host-google-fonts/" id="tweetlink">Tweet</a>
		
		<section>
			<h4>How useful was this page?</h4>
			
			<span></span>
			<span id="star-rating-feedback-link">– Thanks for your feedback!</span>
		</section>
		
		
		
	</article>
	</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>