<!DOCTYPE html>
<html lang="en">
<head>
    <title>
The Bug That Exposed Your PayPal Password - Alex Birsan -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>The Bug That Exposed Your PayPal Password - Alex Birsan</h1><div><div class="ac ae af ag ah do aj ak"><h2 class="by ej ek ev em ew eo ex eq ey es ez cd">And Credit Card Number Too</h2><p id="9875" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">When hunting for security issues, the pursuit for uncharted assets and obscure endpoints often ends up taking the focus away from obvious, but still critical, functionality.</p><p id="36a2" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">If you approach a target like you are the first person to ever perform a security assessment on it, and check everything thoroughly, I believe you are bound to find something new — especially if the code you are testing has been in continuous development for a while.</p><p id="cd27" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">This is the story of a high-severity bug affecting what is probably one of PayPal’s most visited pages: the login form.</p><h2 id="c0a0" class="gz ha ar bz by hb hc hd he hf hg hh hi hj hk hl hm">Initial discovery</h2><p id="adad" class="gn go ar bz gp b ek hn em ho gs hp gu hq gw hr gy dj">While exploring PayPal’s main authentication flow, I noticed a javascript file containing what appeared to be a CSRF token and a session ID:</p><figure class="ht hu hv hw hx hy da db paragraph-image"><p id="6d7d" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">This immediately drew my attention, because providing any kind of session data inside a valid javascript file usually allows it to be retrieved by attackers.</p><p id="6a94" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">In what is known as a cross-site script inclusion (XSSI) attack, a malicious web page can use an HTML <code class="ij ip iq ir is b">&lt;script&gt;</code> tag to import a script cross-origin, enabling it to gain access to any data contained within the file.</p><p id="3eb5" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">Sure enough, a quick test confirmed the XSSI vulnerability and, although a javascript obfuscator was used to randomize variable names on each request, the interesting tokens were still placed in fairly predictable locations, making it possible to retrieve them with just a bit of extra work.</p><figure class="ht hu hv hw hx hy da db paragraph-image"><p id="2f1f" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">However, a secret is only as good as the damage you can do with it. I immediately set out to find out what exactly <code class="ij ip iq ir is b">_csrf</code> and <code class="ij ip iq ir is b">_sessionID</code> were and if they could actually be used in a real attack.</p><h2 id="8b6b" class="gz ha ar bz by hb hc hd he hf hg hh hi hj hk hl hm">Digging further</h2><p id="bf17" class="gn go ar bz gp b ek hn em ho gs hp gu hq gw hr gy dj">After countless attempts to replace regular CSRF tokens inside authenticated requests on PayPal’s platform with the value of <code class="ij ip iq ir is b">_csrf</code>, I came to the conclusion that a classic cross-site request forgery attack was not possible using this specific token. Similarly, a victim’s <code class="ij ip iq ir is b">_sessionID</code> was unfortunately not enough to impersonate them on PayPal’s site.</p><p id="add0" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">Next, I went back to the vulnerable script and followed the tokens to find what they were actually used for. This led to a deep dive into one of PayPal’s main protection mechanisms used to prevent brute force attacks, the <strong class="gp iv">security challenge</strong>. While this functionality is used in many places, I will be focusing on the main login form.</p><figure class="ht hu hv hw hx hy da db paragraph-image"><p id="03e8" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">The idea is pretty simple: After a few failed login attempts, you are required to solve a reCAPTCHA challenge before you can try again. The implementation, however, may raise some eyebrows.</p><p id="5e21" class="gn go ar bz gp b ek gq em gr gs gt gu gv gw gx gy dj">Upon detecting a possible brute-force attempt, the response to the next authentication attempt is a page containing nothing but a Google captcha. If the captcha is solved by the user, an HTTP POST request to <code class="ij ip iq ir is b">/auth/validatecaptcha</code> is initiated.</p></figure></figure></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>