<!DOCTYPE html>
<html lang="en">
<head>
    <title>
AndreyAkinshin/perfolizer - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="AndreyAkinshin/perfolizer - linksfor.dev(s)"/>
    <meta property="og:description" content="Performance analysis toolkit. Contribute to AndreyAkinshin/perfolizer development by creating an account on GitHub."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/AndreyAkinshin/perfolizer"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - AndreyAkinshin/perfolizer</title>
<div class="readable">
        <h1>AndreyAkinshin/perfolizer</h1>
            <div>Reading time: 20-25 minutes</div>
        <div>Posted here: 01 Jun 2020</div>
        <p><a href="https://github.com/AndreyAkinshin/perfolizer">https://github.com/AndreyAkinshin/perfolizer</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
      <div>
        <article itemprop="text"><h3>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/AndreyAkinshin/perfolizer/blob/master/docs/logo/perfolizer.svg"><img src="https://github.com/AndreyAkinshin/perfolizer/raw/master/docs/logo/perfolizer.svg?sanitize=true" alt=""></a></p>
</h3>
<h3>
<p><a href="https://www.nuget.org/packages/Perfolizer/" rel="nofollow"><img src="https://camo.githubusercontent.com/6463e2dd33c7565390601497989afea03894881b/68747470733a2f2f696d672e736869656c64732e696f2f6e756765742f762f506572666f6c697a6572" alt="NuGet" data-canonical-src="https://img.shields.io/nuget/v/Perfolizer"></a>
<a href="https://www.myget.org/feed/perfolizer/package/nuget/Perfolizer" rel="nofollow"><img src="https://camo.githubusercontent.com/3eff3c17fd16120f2c5ec8b803dc3a5dc9912bc2/68747470733a2f2f696d672e736869656c64732e696f2f6d796765742f706572666f6c697a65722f767072652f506572666f6c697a65723f6c6162656c3d6d79676574" alt="MyGet" data-canonical-src="https://img.shields.io/myget/perfolizer/vpre/Perfolizer?label=myget"></a>
<a href="https://github.com/AndreyAkinshin/perfolizer/wiki/Changelog"><img src="https://camo.githubusercontent.com/27ace1c20520ba7d5f3382fbdf29af428e4cfbc3/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d6368616e67656c6f672d696e666f726d6174696f6e616c" alt="Changelog" data-canonical-src="https://img.shields.io/badge/-changelog-informational"></a>
<a href="https://github.com/AndreyAkinshin/perfolizer/blob/master/LICENSE.md"><img src="https://camo.githubusercontent.com/890acbdcb87868b382af9a4b1fac507b9659d9bf/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d626c75652e737667" alt="License" data-canonical-src="https://img.shields.io/badge/license-MIT-blue.svg"></a>
<a href="https://github.com/AndreyAkinshin/perfolizer/actions?query=workflow%3Abuild"><img src="https://github.com/AndreyAkinshin/perfolizer/workflows/build/badge.svg?branch=master" alt="build"></a></p>
</h3>
<p><strong>Perfolizer</strong> is a collection of useful algorithms for performance analysis.
You can use it as a <a href="https://www.nuget.org/packages/Perfolizer/" rel="nofollow">NuGet package</a> or via a <a href="#command-line-tool">command-line tool</a>.</p>
<p>Perfolizer is used as a statistical engine for <a href="https://github.com/dotnet/BenchmarkDotNet">BenchmarkDotNet</a> (the most popular .NET library for benchmarking).</p>
<h2>Algorithms</h2>
<p>Currently, the following algorithms are available:</p>
<ul>
<li><a href="#changepoint-detection">Changepoint detection</a></li>
<li><a href="#multimodal-sensitive-histograms">Multimodal-sensitive histograms</a></li>
<li><a href="#multimodality-detection">Multimodality detection</a></li>
<li><a href="#range-quantile-queries">Range Quantile Queries</a></li>
<li><a href="#quickselectadaptive">QuickSelectAdaptive</a></li>
<li><a href="#quantile-estimation">Quantile estimation</a></li>
<li><a href="#shift-and-ratio">Shift and Ratio functions</a></li>
</ul>
<p>It's only the beginning, a lot of additional algorithms and approaches for performance analysis are coming!</p>
<h3>Changepoint detection</h3>
<p>If you have a history of performance measurements for a test, you may want to find changepoints.
They correspond to moments when the underlying distribution of measurements is changed.
It may be a simple performance degradation/acceleration or a more complicated change (e.g., the variance is increased, or one of the modes in a multimodal distribution is shifted).</p>
<p>Perfolizer provides two algorithms for changepoint detection: EdPelt and RqqPelt.
They can be illustrated with the following picture:</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/2259237/75871421-6ffdb700-5e04-11ea-8f28-5e55550e3b4b.png"><img src="https://user-images.githubusercontent.com/2259237/75871421-6ffdb700-5e04-11ea-8f28-5e55550e3b4b.png" alt="changepoints"></a></p>
<p>EdPelt is based on <a href="https://doi.org/10.1007/s11222-016-9687-5" rel="nofollow">this</a> paper; it's a computationally efficient algorithm with a high level of precision.
However, it doesn't work well when you have a long performance history with many changepoints.
RqqPelt is a modification of EdPelt, which is optimal for long-history cases.
Both algorithms are nonparametric (they support multimodal distributions).</p>
<p>Here is a usage example of these algorithms:</p>
<div><pre><span>var</span> <span>random</span> <span>=</span> <span>new</span> <span>Random</span>(<span>42</span>);
<span>var</span> <span>data</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;();
<span>const</span> <span>int</span> <span>n</span> <span>=</span> <span>20</span>;
<span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>n</span>; <span>i</span><span>++</span>)
    <span>data</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span> <span>*</span> <span>i</span>, <span>stdDev</span>: <span>5</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>100</span>));

<span>var</span> <span>rqqIndexes</span> <span>=</span> <span>RqqPeltChangePointDetector</span>.<span>Instance</span>.<span>GetChangePointIndexes</span>(<span>data</span>.<span>ToArray</span>());
<span>var</span> <span>edIndexes</span> <span>=</span> <span>EdPeltChangePointDetector</span>.<span>Instance</span>.<span>GetChangePointIndexes</span>(<span>data</span>.<span>ToArray</span>());</pre></div>
<p>Here we have 20 normal distributions with shifted mean values.
<code>RqqPeltChangePointDetector</code> and <code>EdPeltChangePointDetector</code> allows getting indexes of the changepoint.
Here is the result of both algorithms:</p>
<div><pre>RqqPelt  EdPelt
     <span>99</span>     <span>99</span>
    <span>199</span>    <span>199</span>
    <span>299</span>    <span>299</span>
    <span>399</span>      -
    <span>499</span>    <span>499</span>
    <span>599</span>      -
    <span>699</span>    <span>701</span>
    <span>799</span>    <span>797</span>
    <span>899</span>      -
    <span>999</span>    <span>999</span>
   <span>1099</span>      -
   <span>1199</span>   <span>1201</span>
   <span>1301</span>   <span>1299</span>
   <span>1399</span>      -
   <span>1499</span>   <span>1499</span>
   <span>1599</span>      -
   <span>1699</span>   <span>1699</span>
   <span>1799</span>   <span>1799</span>
   <span>1899</span>   <span>1900</span></pre></div>
<p>As you can see, both algorithms have pretty good accuracy, but RqqPelt detects more changepoints when there are many of them.</p>
<p><em>References:</em></p>
<ul>
<li>Haynes, Kaylea, Paul Fearnhead, and Idris A. Eckley. "A computationally efficient nonparametric approach for changepoint detection." Statistics and Computing 27, no. 5 (2017): 1293-1305.<br>
<a href="https://doi.org/10.1007/s11222-016-9687-5" rel="nofollow">https://doi.org/10.1007/s11222-016-9687-5</a></li>
<li>Killick, Rebecca, Paul Fearnhead, and Idris A. Eckley. "Optimal detection of changepoints with a linear computational cost." Journal of the American Statistical Association 107, no. 500 (2012): 1590-1598.<br>
<a href="https://arxiv.org/pdf/1101.1438.pdf" rel="nofollow">https://arxiv.org/pdf/1101.1438.pdf</a></li>
</ul>
<h3>Multimodal-sensitive histograms</h3>
<p>It's very important to understand how the distribution of performance measurement looks like.
Sometimes, we want to get an idea of the distribution shape; histograms is a great way to do it.
Unfortunately, the classic approach to build histograms using a fixed bin size may "hide" some important properties of the distribution like multimodality.
Perfolizer provides an adaptive way to build histograms with dynamic bin size: it corrects the borders of each bin in order to highlight situations when the distribution is multimodal.</p>
<p>Here is a usage example:</p>
<div><pre><span>var</span> <span>random</span> <span>=</span> <span>new</span> <span>Random</span>(<span>42</span>);
<span>var</span> <span>data</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;();
<span>data</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>data</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>22</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));

<span>const</span> <span>double</span> <span>binSize</span> <span>=</span> <span>0.5</span>;
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>*** Simple Histogram ***<span>"</span></span>);
<span>Console</span>.<span>WriteLine</span>(<span>SimpleHistogramBuilder</span>.<span>Instance</span>.<span>Build</span>(<span>data</span>, <span>binSize</span>).<span>ToString</span>());
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>*** Adaptive Histogram ***<span>"</span></span>);
<span>Console</span>.<span>WriteLine</span>(<span>AdaptiveHistogramBuilder</span>.<span>Instance</span>.<span>Build</span>(<span>data</span>, <span>binSize</span>).<span>ToString</span>());</pre></div>
<p>Below you can see histograms that built using simple and adaptive approaches:</p>
<pre><code>*** Simple Histogram ***
[17.000 ; 17.500) | @
[17.500 ; 18.000) | @@@@@@
[18.000 ; 18.500) | @@@@@@@@@
[18.500 ; 19.000) | @@@@@@@@@@@@@@@@@@@@@@@
[19.000 ; 19.500) | @@@@@@@@@@@@@@@@@@@@@@@@@@@
[19.500 ; 20.000) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[20.000 ; 20.500) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[20.500 ; 21.000) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[21.000 ; 21.500) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[21.500 ; 22.000) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[22.000 ; 22.500) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[22.500 ; 23.000) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[23.000 ; 23.500) | @@@@@@@@@@@@@
[23.500 ; 24.000) | @@@@@@@@@@@@@
[24.000 ; 24.500) | @@@
*** Adaptive Histogram ***
[16.910 ; 17.404) | @
[17.404 ; 17.815) | @@@@
[17.815 ; 18.328) | @@@@@@@@
[18.328 ; 18.879) | @@@@@@@@@@@@
[18.879 ; 19.379) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[19.379 ; 20.149) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[20.149 ; 20.878) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[20.878 ; 21.782) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[21.782 ; 22.373) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[22.373 ; 22.938) | @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
[22.938 ; 23.865) | @@@@@@@@@@@@@@@@@@@@@@@@
[23.865 ; 24.735) | @@@@@@
</code></pre>
<h3>Multimodality detection</h3>
<p>It's very important to know that the performance distribution that you are working with is multimodal.
Perfolizer uses the <a href="http://www.brendangregg.com/FrequencyTrails/modes.html" rel="nofollow">mvalue approach</a> to detect such distribution.
The rule of thumb is simple: when the mvalue is higher than 2.8-3.2,
the distribution is most probably is multimodal.</p>
<p>Here is a usage example which demonstrate mvalue calculations for unimodal, bimodal, and trimodal distributions:</p>
<div><pre><span>var</span> <span>random</span> <span>=</span> <span>new</span> <span>Random</span>(<span>42</span>);
<span>var</span> <span>data</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;();
<span>data</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>data</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>22</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>List</span><span>&lt;</span><span>double</span><span>&gt;</span>
    <span>unimodal</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;(),
    <span>bimodal</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;(),
    <span>trimodal</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>double</span>&gt;();
<span>unimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>bimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>bimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>30</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>trimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>trimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>30</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>trimodal</span>.<span>AddRange</span>(<span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>40</span>, <span>stdDev</span>: <span>1</span>).<span>Random</span>(<span>random</span>).<span>Next</span>(<span>200</span>));
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Unimodal : <span>"</span></span> <span>+</span> <span>MValueCalculator</span>.<span>Calculate</span>(<span>unimodal</span>));
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Bimodal  : <span>"</span></span> <span>+</span> <span>MValueCalculator</span>.<span>Calculate</span>(<span>bimodal</span>));
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Trimodal : <span>"</span></span> <span>+</span> <span>MValueCalculator</span>.<span>Calculate</span>(<span>trimodal</span>));</pre></div>
<p>And here is the corresponding mvalues:</p>
<pre><code>Unimodal : 2.32
Bimodal  : 3.949748743718593
Trimodal : 5.915343915343915
</code></pre>
<p><em>References:</em></p>
<ul>
<li>Brendan Gregg, "Frequency Trails: Modes and Modality", 2015<br>
<a href="http://www.brendangregg.com/FrequencyTrails/modes.html" rel="nofollow">http://www.brendangregg.com/FrequencyTrails/modes.html</a></li>
</ul>
<h3>Range Quantile Queries</h3>
<p>RQQ (Range Quantile Queries) is a data structure based on wavelet trees that allows getting the given quantile in the given range.
It takes O(n*log(n)) to build it, and O(log(n)) to process a single query.</p>
<p>Here is usage example:</p>
<div><pre><span>var</span> <span>data</span> <span>=</span> <span>new</span> <span>double</span>[] {<span>6</span>, <span>2</span>, <span>0</span>, <span>7</span>, <span>9</span>, <span>3</span>, <span>1</span>, <span>8</span>, <span>5</span>, <span>4</span>};
<span>var</span> <span>rqq</span> <span>=</span> <span>new</span> <span>Rqq</span>(<span>data</span>);
<span>Console</span>.<span>WriteLine</span>(<span>rqq</span>.<span>DumpTreeAscii</span>());
<span>Console</span>.<span>WriteLine</span>();
<span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>data</span>.<span>Length</span>; <span>i</span><span>++</span>)
    <span>Console</span>.<span>WriteLine</span>(<span><span>$"</span>sorted[{<span>i</span>}] = {<span>rqq</span>.<span>Select</span>(<span>0</span>, <span>data</span>.<span>Length</span> <span>-</span> <span>1</span>, <span>i</span>)}<span>"</span></span>);</pre></div>
<p>The <code>Select(int l, int r, int k)</code> methods returns k-th smallest element on the [l;r] range.
The RQQ implementation can also present the built tree with the help of ASCII graphics:</p>
<div><pre>                     ┌─────────────────────┐               
                     │ <span>6</span> <span>2</span> <span>0</span> <span>7</span> <span>9</span> <span>3</span> <span>1</span> <span>8</span> <span>5</span> <span>4</span> │               
                     │ <span>1</span> <span>0</span> <span>0</span> <span>1</span> <span>1</span> <span>0</span> <span>0</span> <span>1</span> <span>1</span> <span>0</span> │               
                     └┬───────────────────┬┘               
                      │                   │                
           ┌──────────┴┐                 ┌┴──────────┐     
           │ <span>2</span> <span>0</span> <span>3</span> <span>1</span> <span>4</span> │                 │ <span>6</span> <span>7</span> <span>9</span> <span>8</span> <span>5</span> │     
           │ <span>0</span> <span>0</span> <span>1</span> <span>0</span> <span>1</span> │                 │ <span>0</span> <span>0</span> <span>1</span> <span>1</span> <span>0</span> │     
           └┬─────────┬┘                 └┬─────────┬┘     
            │         │                   │         │      
      ┌─────┴─┐     ┌─┴───┐         ┌─────┴─┐     ┌─┴───┐  
      │ <span>2</span> <span>0</span> <span>1</span> │     │ <span>3</span> <span>4</span> │         │ <span>6</span> <span>7</span> <span>5</span> │     │ <span>9</span> <span>8</span> │  
      │ <span>1</span> <span>0</span> <span>0</span> │     │ <span>0</span> <span>1</span> │         │ <span>0</span> <span>1</span> <span>0</span> │     │ <span>1</span> <span>0</span> │  
      └┬─────┬┘     └┬───┬┘         └┬─────┬┘     └┬───┬┘  
       │     │       │   │           │     │       │   │   
  ┌────┴┐   ┌┴──┐ ┌──┴┐ ┌┴──┐   ┌────┴┐   ┌┴──┐ ┌──┴┐ ┌┴──┐
  │ <span>0</span> <span>1</span> │   │ <span>2</span> │ │ <span>3</span> │ │ <span>4</span> │   │ <span>6</span> <span>5</span> │   │ <span>7</span> │ │ <span>8</span> │ │ <span>9</span> │
  │ <span>0</span> <span>1</span> │   │   │ │   │ │   │   │ <span>1</span> <span>0</span> │   │   │ │   │ │   │
  └┬───┬┘   └───┘ └───┘ └───┘   └┬───┬┘   └───┘ └───┘ └───┘
   │   │                         │   │                     
┌──┴┐ ┌┴──┐                   ┌──┴┐ ┌┴──┐                   
│ <span>0</span> │ │ <span>1</span> │                   │ <span>5</span> │ │ <span>6</span> │                   
│   │ │   │                   │   │ │   │                   
└───┘ └───┘                   └───┘ └───┘

sorted[<span>0</span>] = <span>0</span>
sorted[<span>1</span>] = <span>1</span>
sorted[<span>2</span>] = <span>2</span>
sorted[<span>3</span>] = <span>3</span>
sorted[<span>4</span>] = <span>4</span>
sorted[<span>5</span>] = <span>5</span>
sorted[<span>6</span>] = <span>6</span>
sorted[<span>7</span>] = <span>7</span>
sorted[<span>8</span>] = <span>8</span>
sorted[<span>9</span>] = <span>9</span></pre></div>
<p><em>References:</em></p>
<ul>
<li>Gagie, Travis, Simon J. Puglisi, and Andrew Turpin. "Range quantile queries: Another virtue of wavelet trees." In International Symposium on String Processing and Information Retrieval, pp. 1-6. Springer, Berlin, Heidelberg, 2009.<br>
<a href="https://arxiv.org/pdf/0903.4726.pdf" rel="nofollow">https://arxiv.org/pdf/0903.4726.pdf</a></li>
</ul>
<h3>QuickSelectAdaptive</h3>
<p>QuickSelectAdaptive allows getting the k-th smallest element from the given array.
It takes O(n) operations in the worst case, and it works pretty fast in practice using different heuristics
from <a href="http://erdani.com/research/sea2017.pdf" rel="nofollow">this paper</a> by Andrei Alexandrescu.</p>
<p>Here is a usage example:</p>
<div><pre><span>var</span> <span>shuffler</span> <span>=</span> <span>new</span> <span>Shuffler</span>(<span>42</span>);
<span>var</span> <span>data</span> <span>=</span> <span>new</span> <span>double</span>[] {<span>0</span>, <span>1</span>, <span>2</span>, <span>3</span>, <span>4</span>, <span>5</span>, <span>6</span>, <span>7</span>, <span>8</span>, <span>9</span>};
<span>shuffler</span>.<span>Shuffle</span>(<span>data</span>);

<span>var</span> <span>selector</span> <span>=</span> <span>new</span> <span>QuickSelectAdaptive</span>();
<span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>data</span>.<span>Length</span>; <span>i</span><span>++</span>)
    <span>Console</span>.<span>WriteLine</span>(<span><span>$"</span>data[{<span>i</span>}] = {<span>selector</span>.<span>Select</span>(<span>data</span>, <span>i</span>)}<span>"</span></span>);</pre></div>
<p>Here is the output:</p>
<pre><code>data[0] = 0
data[1] = 1
data[2] = 2
data[3] = 3
data[4] = 4
data[5] = 5
data[6] = 6
data[7] = 7
data[8] = 8
data[9] = 9
</code></pre>
<p><em>References:</em></p>
<ul>
<li>Alexandrescu, Andrei. "Fast deterministic selection."<br>
<a href="http://erdani.com/research/sea2017.pdf" rel="nofollow">http://erdani.com/research/sea2017.pdf</a></li>
</ul>
<h3>Quantile estimation</h3>
<p>Since most of the performance distributions are nonparametric (they may be multimodal, right-skewed, heavy-tailed),
quantile estimation is essential during distribution analysis.
Unfortunately, the "simple" straightforward approach often produces results that are far from real quantile values.
The Harrell-Davis quantile estimator improves the situation and calculates better quantile estimation.</p>
<p>Here is an usage example:</p>
<div><pre><span>var</span> <span>x</span> <span>=</span> <span>new</span> <span>double</span>[] {<span>0</span>, <span>50</span>, <span>100</span>};
<span>var</span> <span>probabilities</span> <span>=</span> <span>new</span>[]
    {<span>0.0</span>, <span>0.1</span>, <span>0.2</span>, <span>0.3</span>, <span>0.4</span>, <span>0.5</span>, <span>0.6</span>, <span>0.7</span>, <span>0.8</span>, <span>0.9</span>, <span>1.0</span>};
<span>var</span> <span>simpleQuantiles</span> <span>=</span> <span>SimpleQuantileEstimator</span>.<span>Instance</span>.<span>GetQuantiles</span>(<span>x</span>, <span>probabilities</span>);
<span>var</span> <span>hdQuantiles</span> <span>=</span> <span>HarrellDavisQuantileEstimator</span>.<span>Instance</span>.<span>GetQuantiles</span>(<span>x</span>, <span>probabilities</span>);

<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Probability Simple HarrellDavis<span>"</span></span>);
<span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>probabilities</span>.<span>Length</span>; <span>i</span><span>++</span>)
    <span>Console</span>.<span>WriteLine</span>(
        <span>probabilities</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadRight</span>(<span>11</span>) <span>+</span> <span><span>"</span> <span>"</span></span> <span>+</span>
        <span>simpleQuantiles</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadLeft</span>(<span>6</span>) <span>+</span> <span><span>"</span> <span>"</span></span> <span>+</span>
        <span>hdQuantiles</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadLeft</span>(<span>12</span>));</pre></div>
<p>And here are the corresponding results for simple and Harrell-Davis quantile estimators:</p>
<div><pre>Probability Simple HarrellDavis
<span>0.0</span>            <span>0.0</span>          <span>0.0</span>
<span>0.1</span>           <span>10.0</span>          <span>4.0</span>
<span>0.2</span>           <span>20.0</span>         <span>11.6</span>
<span>0.3</span>           <span>30.0</span>         <span>22.5</span>
<span>0.4</span>           <span>40.0</span>         <span>35.7</span>
<span>0.5</span>           <span>50.0</span>         <span>50.0</span>
<span>0.6</span>           <span>60.0</span>         <span>64.3</span>
<span>0.7</span>           <span>70.0</span>         <span>77.5</span>
<span>0.8</span>           <span>80.0</span>         <span>88.4</span>
<span>0.9</span>           <span>90.0</span>         <span>96.0</span>
<span>1.0</span>          <span>100.0</span>        <span>100.0</span></pre></div>
<p><em>References:</em></p>
<ul>
<li>Harrell, F.E. and Davis, C.E., 1982. A new distribution-free quantile estimator. Biometrika, 69(3), pp.635-640.<br>
<a href="https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf" rel="nofollow">https://pdfs.semanticscholar.org/1a48/9bb74293753023c5bb6bff8e41e8fe68060f.pdf</a></li>
</ul>
<h3>Shift and Ratio</h3>
<p>Shift and ration functions are powerful tools for distribution comparing
These functions show the difference between distributions for each specified quantile.</p>
<p>Below you can see an example where we have two bimodal distributions:
<code>x</code> (modes: 20 and 40) and <code>y</code> (modes: 20 and 80).</p>
<div><pre><span>var</span> <span>x</span> <span>=</span> <span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>2</span>).<span>Random</span>(<span>1</span>).<span>Next</span>(<span>20</span>).<span>Concat</span>(
        <span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>40</span>, <span>stdDev</span>: <span>2</span>).<span>Random</span>(<span>2</span>).<span>Next</span>(<span>20</span>)).<span>ToArray</span>();
<span>var</span> <span>y</span> <span>=</span> <span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>20</span>, <span>stdDev</span>: <span>2</span>).<span>Random</span>(<span>3</span>).<span>Next</span>(<span>20</span>).<span>Concat</span>(
        <span>new</span> <span>NormalDistribution</span>(<span>mean</span>: <span>80</span>, <span>stdDev</span>: <span>2</span>).<span>Random</span>(<span>4</span>).<span>Next</span>(<span>20</span>)).<span>ToArray</span>();

<span>var</span> <span>probabilities</span> <span>=</span> <span>new</span>[] {<span>0.0</span>, <span>0.1</span>, <span>0.2</span>, <span>0.3</span>, <span>0.4</span>, <span>0.5</span>, <span>0.6</span>, <span>0.7</span>, <span>0.8</span>, <span>0.9</span>, <span>1.0</span>};
<span>var</span> <span>shift</span> <span>=</span> <span>ShiftFunction</span>.<span>Instance</span>.<span>Values</span>(<span>x</span>, <span>y</span>, <span>probabilities</span>);
<span>var</span> <span>ratio</span> <span>=</span> <span>RatioFunction</span>.<span>Instance</span>.<span>Values</span>(<span>x</span>, <span>y</span>, <span>probabilities</span>);

<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Probability Shift Ratio<span>"</span></span>);
<span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>probabilities</span>.<span>Length</span>; <span>i</span><span>++</span>)
    <span>Console</span>.<span>WriteLine</span>(
        <span>probabilities</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadRight</span>(<span>11</span>) <span>+</span> <span><span>"</span> <span>"</span></span> <span>+</span>
        <span>shift</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadLeft</span>(<span>5</span>) <span>+</span> <span><span>"</span> <span>"</span></span> <span>+</span>
        <span>ratio</span>[<span>i</span>].<span>ToString</span>(<span><span>"</span>N1<span>"</span></span>).<span>PadLeft</span>(<span>5</span>));

<span>Console</span>.<span>WriteLine</span>();
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Shift Range: <span>"</span></span> <span>+</span> <span>ShiftRangeEstimator</span>.<span>Instance</span>.<span>GetRange</span>(<span>x</span>, <span>y</span>));
<span>Console</span>.<span>WriteLine</span>(<span><span>"</span>Ratio Range: <span>"</span></span> <span>+</span> <span>RatioRangeEstimator</span>.<span>Instance</span>.<span>GetRange</span>(<span>x</span>, <span>y</span>));</pre></div>
<p>The straightforward approaches that show the difference between means or medians will not help us to see the whole picture
when one of the modes in the multimodal distribution was shifted.
The shift and ratio functions rush to the rescue:</p>
<pre><code>Probability Shift Ratio
0.0           0.1   1.0
0.1          -0.2   1.0
0.2           0.0   1.0
0.3           0.3   1.0
0.4           3.8   1.2
0.5          19.9   1.7
0.6          36.2   2.0
0.7          39.9   2.0
0.8          40.2   2.0
0.9          40.2   2.0
1.0          41.3   1.9

Shift Range: [-0.02;40.34]
Ratio Range: [1.00;2.01]
</code></pre>
<p><em>References:</em></p>
<ul>
<li>Doksum, Kjell. "Empirical probability plots and statistical inference for nonlinear models in the two-sample case." The annals of statistics (1974): 267-277.<br>
<a href="https://doi.org/10.1214/aos/1176342662" rel="nofollow">https://doi.org/10.1214/aos/1176342662</a></li>
<li>Doksum, Kjell A., and Gerald L. Sievers. "Plotting with confidence: Graphical comparisons of two populations." Biometrika 63, no. 3 (1976): 421-434.<br>
<a href="https://doi.org/10.2307/2335720" rel="nofollow">https://doi.org/10.2307/2335720</a></li>
<li>Guillaume Rousselet. "the shift function: a powerful tool to compare two entire distributions." 2016<br>
<a href="https://garstats.wordpress.com/2016/07/12/shift-function/" rel="nofollow">https://garstats.wordpress.com/2016/07/12/shift-function/</a></li>
<li>Andrey Akinshin. "Distribution comparison via the shift and ratio functions." 2019<br>
<a href="https://aakinshin.net/posts/shift-and-ratio-functions/" rel="nofollow">https://aakinshin.net/posts/shift-and-ratio-functions/</a></li>
</ul>
<h2>Command-line tool</h2>
<h3>Command-line installation</h3>
<p>First of all, you should install <a href="https://dotnet.microsoft.com/download" rel="nofollow">.NET Core SDK 3.1</a> or newer.
Once installed, run the following command to install Perfolizer.Tool:</p>
<div><pre>dotnet tool install -g Perfolizer.Tool</pre></div>
<p>If you already have a previous version installed, you can upgrade to the latest version using the following command:</p>
<div><pre>dotnet tool update -g Perfolizer.Tool</pre></div>
<p>If you want to remove the tool:</p>
<div><pre>dotnet tool uninstall -g Perfolizer.Tool</pre></div>
<p>You can find more information about .NET Core Global Tools <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/global-tools" rel="nofollow">here</a>.</p>
<h3>Command-line usage</h3>
<p>The basic usage syntax is:</p>
<div><pre>dotnet perfolizer [arguments] [options]</pre></div>
<p>By default, the tool can be found in <code>$HOME/.dotnet/tools</code> on Linux/macOS and in <code>%USERPROFILE%.dotnet	ools</code> on Windows
(you can specify the directory via the <code>--tool-path</code> option of <code>dotnet tool install</code>).
In order to shortify the command line, you can also introduce a symlink or an alias for this tool.
E.g.,</p>
<div><pre>sudo ln -s <span>~</span>/.dotnet/tools/dotnet-perfolizer /usr/bin/perfolizer</pre></div>
<p>or</p>
<div><pre><span>alias</span> perfolizer=<span><span>'</span>~/.dotnet/tools/dotnet-perfolizer<span>'</span></span></pre></div>
<p>After that, you can use it as:</p>
<div><pre>perfolizer [arguments] [options]</pre></div>
<h3>Command-line examples</h3>
<p>Changepoint detection:</p>
<div><pre>$ perfolizer cpd --data <span><span>'</span>0;0;0;0;100;100;100;100;100<span>'</span></span> --dist 1
3</pre></div>
<p>Histograms:</p>
<div><pre>$ perfolizer hist --data <span><span>'</span>0;0;0;1;2;3;54;234;234;24;12;21;3;123;3;35;134<span>'</span></span>
[ -0.180 <span>;</span>  54.180) <span>|</span> @@@@@@@@@@@@@
[ 54.180 <span>;</span> 101.320) <span>|</span> 
[101.320 <span>;</span> 155.679) <span>|</span> @@
[155.679 <span>;</span> 206.821) <span>|</span> 
[206.821 <span>;</span> 261.180) <span>|</span> @@</pre></div>
<p>Range quantile queries tree:</p>
<div><pre>$ perfolizer rqq --data <span><span>'</span>6;2;0;7;9;3;1;8;5;4<span>'</span></span>
                     ┌─────────────────────┐               
                     │ 6 2 0 7 9 3 1 8 5 4 │               
                     │ 1 0 0 1 1 0 0 1 1 0 │               
                     └┬───────────────────┬┘               
                      │                   │                
           ┌──────────┴┐                 ┌┴──────────┐     
           │ 2 0 3 1 4 │                 │ 6 7 9 8 5 │     
           │ 0 0 1 0 1 │                 │ 0 0 1 1 0 │     
           └┬─────────┬┘                 └┬─────────┬┘     
            │         │                   │         │      
      ┌─────┴─┐     ┌─┴───┐         ┌─────┴─┐     ┌─┴───┐  
      │ 2 0 1 │     │ 3 4 │         │ 6 7 5 │     │ 9 8 │  
      │ 1 0 0 │     │ 0 1 │         │ 0 1 0 │     │ 1 0 │  
      └┬─────┬┘     └┬───┬┘         └┬─────┬┘     └┬───┬┘  
       │     │       │   │           │     │       │   │   
  ┌────┴┐   ┌┴──┐ ┌──┴┐ ┌┴──┐   ┌────┴┐   ┌┴──┐ ┌──┴┐ ┌┴──┐
  │ 0 1 │   │ 2 │ │ 3 │ │ 4 │   │ 6 5 │   │ 7 │ │ 8 │ │ 9 │
  │ 0 1 │   │   │ │   │ │   │   │ 1 0 │   │   │ │   │ │   │
  └┬───┬┘   └───┘ └───┘ └───┘   └┬───┬┘   └───┘ └───┘ └───┘
   │   │                         │   │                     
┌──┴┐ ┌┴──┐                   ┌──┴┐ ┌┴──┐                   
│ 0 │ │ 1 │                   │ 5 │ │ 6 │                   
│   │ │   │                   │   │ │   │                   
└───┘ └───┘                   └───┘ └───┘                   </pre></div>
<p>k-th smallest element:</p>
<div><pre>$ perfolizer <span>select</span> <span>--data</span> <span><span>'</span>6;2;0;7;9;3;1;8;5;4<span>'</span></span> -k 3
3</pre></div>
<p>mvalue calculations:</p>
<div><pre>$ perfolizer mvalue --data <span><span>'</span>0;0;0;0;0;0;0;0<span>'</span></span>
2
$ perfolizer mvalue --data <span><span>'</span>0;0;0;0;1;1;1;1<span>'</span></span>
4</pre></div>
<p>quantile estimation:</p>
<div><pre>$ perfolizer qe --data <span><span>'</span>0;50;100<span>'</span></span> --probs <span><span>'</span>0;0.25;0.5;0.75;1<span>'</span></span>
0<span>;</span>16.666667192688482<span>;</span>50<span>;</span>83.33333280731152<span>;</span>100</pre></div>
<p>shift function:</p>
<div><pre>$ perfolizer <span>shift</span> --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --margin 0
[0.00<span>;</span>0.00]
$ perfolizer <span>shift</span> --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>4;4;4;4;4;6;6;6;6;6<span>'</span></span> --margin 0
[2.00<span>;</span>2.00]
$ perfolizer <span>shift</span> --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>2;2;2;2;2;8;8;8;8;8<span>'</span></span> --margin 0
[0.00<span>;</span>4.00]
$ perfolzier <span>shift</span> --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>1;1;1;1;1;8;8;8;8;8<span>'</span></span> --margin 0
[-1.00<span>;</span>4.00]
$ perfolizer <span>shift</span> --data1 <span><span>'</span>10;20;30;40;50<span>'</span></span> --data2 <span><span>'</span>11;22;33;44;55<span>'</span></span> --probs <span><span>'</span>0.0;0.5;1.0<span>'</span></span>
1<span>;</span>3<span>;</span>5</pre></div>
<p>ratio function:</p>
<div><pre>$ perfolizer ratio --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --margin 0
[1.00<span>;</span>1.00]
$ perfolizer ratio --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>4;4;4;4;4;8;8;8;8;8<span>'</span></span> --margin 0
[2.00<span>;</span>2.00]
$ perfolizer ratio --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>2;2;2;2;2;8;8;8;8;8<span>'</span></span> --margin 0
[1.00<span>;</span>2.00]
$ perfolizer ratio --data1 <span><span>'</span>2;2;2;2;2;4;4;4;4;4<span>'</span></span> --data2 <span><span>'</span>1;1;1;1;1;8;8;8;8;8<span>'</span></span> --margin 0
[0.50<span>;</span>2.00]</pre></div>
<h2>NuGet packages</h2>
<p>You can use perfolizer via one of the following NuGet Packages:</p>
<ul>
<li><a href="https://www.nuget.org/packages/Perfolizer/" rel="nofollow">Perfolizer</a> (if you want to use Perfolizer from .NET application)</li>
<li><a href="https://www.nuget.org/packages/Perfolizer.Tool/" rel="nofollow">Perfolizer.Tool</a> (if you want to use Perfolizer from command line)</li>
</ul>
<p>Stable versions of both packages are available on <a href="https://www.nuget.org/" rel="nofollow">nuget.org</a>.
If you want to use prerelease packages, you can download them from <a href="https://www.myget.org/" rel="nofollow">myget.org</a> via the following feed: <code>https://www.myget.org/F/perfolizer/api/v3/index.json</code>.
Here is an example of <code>NuGet.Config</code>:</p>
<div><pre>&lt;?<span>xml</span><span> version</span>=<span><span>"</span>1.0<span>"</span></span><span> encoding</span>=<span><span>"</span>utf-8<span>"</span></span>?&gt;
&lt;<span>configuration</span>&gt;
  &lt;<span>packageSources</span>&gt;
    &lt;<span>add</span> <span>key</span>=<span><span>"</span>nuget.org<span>"</span></span> <span>value</span>=<span><span>"</span>https://api.nuget.org/v3/index.json<span>"</span></span> /&gt;
    &lt;<span>add</span> <span>key</span>=<span><span>"</span>perfolizer-nightly<span>"</span></span> <span>value</span>=<span><span>"</span>https://www.myget.org/F/perfolizer/api/v3/index.json<span>"</span></span> /&gt;
  &lt;/<span>packageSources</span>&gt;
&lt;/<span>configuration</span>&gt;</pre></div>
<h2>License</h2>
<p>Copyright (c) 2020 Andrey Akinshin<br>
Copyright (c) 2013–2020 .NET Foundation and contributors</p>
<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>
<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>