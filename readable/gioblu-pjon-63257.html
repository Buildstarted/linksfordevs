<!DOCTYPE html>
<html lang="en">
<head>
    <title>
gioblu/PJON - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="gioblu/PJON - linksfor.dev(s)"/>
    <meta property="og:description" content="With PJON you build networks of devices for free with no need of a cloud service or a centralised platform you don&#x2019;t fully control. - gioblu/PJON"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/gioblu/PJON/tree/master/src/strategies/SoftwareBitBang"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - gioblu/PJON</title>
<div class="readable">
        <h1>gioblu/PJON</h1>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 22 Jun 2020</div>
        <p><a href="https://github.com/gioblu/PJON/tree/master/src/strategies/SoftwareBitBang">https://github.com/gioblu/PJON/tree/master/src/strategies/SoftwareBitBang</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
      <div>
        <article itemprop="text"><h2>SoftwareBitBang</h2>
<table>
<thead>
<tr>
<th>Medium</th>
<th>Pins used</th>
<th>Inclusion</th>
</tr>
</thead>
<tbody>
<tr>
<td>Wire</td>
<td>1 or 2</td>
<td><code>#include &lt;PJONSoftwareBitBang.h&gt;</code></td>
</tr>
</tbody>
</table>
<p><code>SoftwareBitBang</code> is a software implementation of <a href="https://github.com/gioblu/PJON/blob/master/src/strategies/SoftwareBitBang/specification/PJDL-specification-v4.1.md">PJDL (Padded Jittering Data Link)</a>. It supports simplex and half-duplex asynchronous serial communication for up to 254 devices over a single wire. The maximum length of the bus can reach between 800 and 2000 meters depending on the mode used. It is a valid alternative to 1-Wire because of its flexibility and reliability. Fault tolerance schemes can be easily implemented because communication pins can be configured at runtime. Take a look at the <a href="https://www.youtube.com/watch?v=GWlhKD5lz5w" rel="nofollow">video introduction</a> for a brief showcase of its features.</p>
<div><pre>PJDL SINGLE WIRE BUS                           ______
 ______    ______    ______    ______         |      |
|      |  |      |  |      |  |      |        |DEVICE|
|DEVICE|  |DEVICE|  |DEVICE|  |DEVICE|        |______|
|______|  |______|  |______|  |______|            |
___|__________|________|___________|______/\/\/\__| IO PIN
 ___|__    __|___    ___|__    ___|__  |  <span>110</span>-<span>180</span> Ω
|      |  |      |  |      |  |      | |  
|DEVICE|  |DEVICE|  |DEVICE|  |DEVICE| |__/\/\/\__  GND
|______|  |______|  |______|  |______|    <span>8</span> kΩ - <span>5</span> MΩ    </pre></div>
<p>It is suggested to add 8kΩ-5MΩ pull-down resistor as shown in the graph above to reduce externally induced interference. The longer is the length of the cable and the higher is the amount of induced interference, the lower should be the resistance of the pull-down resistor. Pins can be optionally protected against overload adding a current limiting resistor to each connected pin. The resistor value can be obtained solving the following equation <code>R = (operating voltage / pin max current drain)</code>, for example to obtain the current limiting resistor value for an Arduino Uno simply substitute its characteristics: <code>R = (5v / 0.030A) = 166.66Ω</code>.</p>
<h3>Compatibility</h3>
<table>
<thead>
<tr>
<th>MCU</th>
<th>Clock</th>
<th>Supported pins</th>
</tr>
</thead>
<tbody>
<tr>
<td>ATtiny84/84A</td>
<td>16MHz</td>
<td>0, 1, 2, 3, 4</td>
</tr>
<tr>
<td>ATtiny85 (Digispark development board)</td>
<td>16MHz</td>
<td>1, 2</td>
</tr>
<tr>
<td>ATmega88/168/328 (Duemilanove, Uno, Nano, Pro)</td>
<td>16MHz</td>
<td>2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, A0, A1</td>
</tr>
<tr>
<td>ATmega328PB</td>
<td>16MHz</td>
<td>10</td>
</tr>
<tr>
<td>ATmega16u4/32u4 (Leonardo, Micro)</td>
<td>16MHz</td>
<td>2, 4, 8, 12</td>
</tr>
<tr>
<td>ATmega2560 (Mega, Mega nano)</td>
<td>16MHz</td>
<td>3, 4, 7, 8, 9, 10, 12</td>
</tr>
<tr>
<td>ATmega1284P</td>
<td>16MHz</td>
<td>18, 19, 20, 21, 22, 23, A0, A1, A2, A3, A4, A5, A6, A7</td>
</tr>
<tr>
<td>SAMD (Arduino Zero)</td>
<td>48MHz</td>
<td>D0, D1, D3, A0, A1</td>
</tr>
<tr>
<td>STM32F1</td>
<td>72MHz</td>
<td>?</td>
</tr>
<tr>
<td>MK20DX256 (Teensy 3.1)</td>
<td>96MHz</td>
<td>All pins</td>
</tr>
<tr>
<td>ESP8266 (NodeMCU, AI-THINKER modules)</td>
<td>80/160MHz</td>
<td>D1 or GPIO 5</td>
</tr>
<tr>
<td>ESP32 (Heltech WiFi LoRa)</td>
<td>160MHz</td>
<td>12, 25</td>
</tr>
</tbody>
</table>
<h3>Performance</h3>
<p><code>SWBB_MODE</code> can be configured in 4 different modes, <code>1</code>, <code>2</code>, <code>3</code> and <code>4</code>:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Speed</th>
<th>Range</th>
<th>Supported MCUs</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1</code></td>
<td>1.95kB/s 15625Bd</td>
<td>2000m</td>
<td>ATtiny84/84A, ATtiny85, ATmega88/168/328, ATmega328PB, ATmega16u4/32u4, ATmega2560, ATmega1284P, SAMD, STM32F1, MK20DX256, ESP8266, ESP32</td>
</tr>
<tr>
<td><code>2</code></td>
<td>2.21kB/s 17696Bd</td>
<td>1600m</td>
<td>ATtiny84/84A, ATtiny85, ATmega88/168/328, ATmega328PB, ATmega16u4/32u4, ATmega2560</td>
</tr>
<tr>
<td><code>3</code></td>
<td>2.94kB/s 23529Bd</td>
<td>1200m</td>
<td>ATtiny84/84A, ATtiny85, ATmega88/168/328</td>
</tr>
<tr>
<td><code>4</code></td>
<td>3.40kB/s 27210Bd</td>
<td>800m</td>
<td>ATtiny84/84A, ATtiny85, ATmega88/168/328</td>
</tr>
</tbody>
</table>
<p>When including and using the <code>SoftwareBitBang</code> strategy you have the complete access to the microcontroller. This happens because <code>SoftwareBitBang</code> runs a completely software-defined implementation, transforming a painful walk in a nice flight.</p>
<p>Communication over a single wire enables quick and creative experimentation. The first suggested test, at the tester's risk, is to let two Arduino boards communicate <a href="https://www.youtube.com/watch?v=caMit7nzJsM" rel="nofollow">through a living body</a> touching with the left hand the digital pin of the first board and with the right the pin of the other one (should be harmless). It is stunning to see it working perfectly through the human body, although it also works through water and other conductors.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/gioblu/PJON/blob/master/src/strategies/SoftwareBitBang/images/PJDL-2000m-mode4-twistedpair-8.2k-pulldown-60-series.png"><img src="https://github.com/gioblu/PJON/raw/master/src/strategies/SoftwareBitBang/images/PJDL-2000m-mode4-twistedpair-8.2k-pulldown-60-series.png" alt="PJDL communication over 2000m twisted pair"></a></p>
<p>The picture above shows a <a href="https://github.com/gioblu/PJON/blob/master/src/strategies/SoftwareBitBang/specification/PJDL-specification-v4.1.md">PJDL</a> frame transmitted over a 800m twisted pair using mode <code>4</code> (test done by <a href="https://github.com/jdaandersj">Jack Anderson</a>). Although bits are substantially deformed the exchange occurs nominally and performance is not affected.</p>
<h3>Configuration</h3>
<p>Before including the library it is possible to configure <code>SoftwareBitBang</code> using predefined constants:</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>Purpose</th>
<th>Supported value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SWBB_MODE</code></td>
<td>Data transmission mode</td>
<td>1, 2, 3, 4</td>
</tr>
<tr>
<td><code>SWBB_RESPONSE_TIMEOUT</code></td>
<td>Maximum response time-out</td>
<td>Duration in microseconds (1500 by default)</td>
</tr>
<tr>
<td><code>SWBB_BACK_OFF_DEGREE</code></td>
<td>Maximum back-off exponential degree</td>
<td>Numeric value (4 by default)</td>
</tr>
<tr>
<td><code>SWBB_MAX_ATTEMPTS</code></td>
<td>Maximum transmission attempts</td>
<td>Numeric value (20 by default)</td>
</tr>
</tbody>
</table>
<p><code>SoftwareBitBang</code> supports the use of input and output pins because separated signals may be required if additional circuitry is used for amplification or noise filtering. It also works if pins are directly connected as a simple point-to-point null-modem or cross-over serial link.</p>
<div><pre>#<span>include</span> <span><span>&lt;</span>PJONSoftwareBitBang.h<span>&gt;</span></span>

PJONSoftwareBitBang bus;

<span>void</span> <span>setup</span>() {
  <span><span>//</span> Set the pin 12 as the communication pin</span>
  bus.<span>strategy</span>.<span>set_pin</span>(<span>12</span>);
  <span><span>//</span> Set pin 11 as input pin and pin 12 as output pin</span>
  bus.<span>strategy</span>.<span>set_pins</span>(<span>11</span>, <span>12</span>);
}</pre></div>
<p>After the PJON object is defined with its strategy it is possible to set the communication pin accessing to the strategy present in the PJON instance. All the other necessary information is present in the general <a href="https://github.com/gioblu/PJON/blob/master/documentation">Documentation</a>.</p>
<h3>Why not interrupts?</h3>
<p>In the Arduino environment the use of libraries is really extensive and often the end user is not able to go over collisions. Very often a library is using hardware resources of the microcontroller, colliding with other libraries. This happens because in general Arduino boards have limited hardware resources. Software-defined bit-banging, is a stable and reliable solution that leads to "more predictable" results than interrupt driven procedures coexisting on limited microcontrollers without the developer and the end user knowing about it.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/8b2414194b2fe383c1bbc2c8fc40c710e81b3572/687474703a2f2f33332e6d656469612e74756d626c722e636f6d2f30303635633339343661333431393161323833366334303532323431353863382f74756d626c725f696e6c696e655f6e767262786b586f38333173393570317a5f3530302e676966"><img src="https://camo.githubusercontent.com/8b2414194b2fe383c1bbc2c8fc40c710e81b3572/687474703a2f2f33332e6d656469612e74756d626c722e636f6d2f30303635633339343661333431393161323833366334303532323431353863382f74756d626c725f696e6c696e655f6e767262786b586f38333173393570317a5f3530302e676966" alt="PJON - Michael Teeuw application example" data-canonical-src="http://33.media.tumblr.com/0065c3946a34191a2836c405224158c8/tumblr_inline_nvrbxkXo831s95p1z_500.gif"></a></p>
<p>PJON application example made by the user <a href="http://michaelteeuw.nl/post/130558526217/pjon-my-son" rel="nofollow">Michael Teeuw</a></p>
<h3>Known issues</h3>
<ul>
<li>A 1-5 MΩ pull down resistor could be necessary to reduce interference, see <a href="https://github.com/gioblu/PJON/wiki/Mitigate-interference">Mitigate interference</a>.</li>
<li>When using more than one instance of <code>SoftwareBitBang</code> in the same sketch always use pins connected to a different port group to avoid cross-talk.</li>
<li>During the execution of other tasks or delays a certain amount of packets could be potentially lost because transmitted out of the polling time of the receiver device. Thanks to the PJON packet handler after some retries the packet is received but a certain amount of bandwidth is wasted. If this situation occurs, try to reduce as much as possible the duration of other tasks and or use a longer polling time using <code>receive</code> and passing the requested amount of microseconds: <code>bus.receive(1000); // Poll for 1 millisecond</code>.</li>
<li><code>SoftwareBitBang</code> strategy can have compatibility issues with codebases that are using interrupts, reliability or bandwidth loss can occur because of the interruptions made by third party software.</li>
</ul>
<h3>Safety warning</h3>
<p>In all cases, when installing or maintaining a PJON network, extreme care must be taken to avoid any danger. When a <a href="https://github.com/gioblu/PJON/blob/master/src/strategies/SoftwareBitBang">SoftwareBitBang</a> bus is installed each pin must be protected with a current limiting resistor as described above. If a common ground or power supply line is used its cable size and length must be carefully selected taking in consideration the overall application's power supply requirements and selected components' maximum rating.</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>