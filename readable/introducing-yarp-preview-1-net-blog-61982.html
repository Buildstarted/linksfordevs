<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Introducing YARP Preview 1 | .NET Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Introducing YARP Preview 1 | .NET Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Sam SpencerProgram Manager, .NET Core teamFollow"/>
    <meta property="og:description" content="YARP is a reverse proxy toolkit for building fast proxy servers in .NET using the infrastructure from ASP.NET and .NET."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/introducing-yarp-preview-1/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Introducing YARP Preview 1 | .NET Blog</title>
<div class="readable">
        <h1>Introducing YARP Preview 1 | .NET Blog</h1>
            <div>by Sam SpencerProgram Manager, .NET Core teamFollow</div>
            <div>Reading time: 6-7 minutes</div>
        <div>Posted here: 21 May 2020</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/introducing-yarp-preview-1/">https://devblogs.microsoft.com/dotnet/introducing-yarp-preview-1/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://secure.gravatar.com/avatar/b5ae5fb57da9de3aa92a4c49435b3602?s=58&amp;d=mm&amp;r=g" width="58" height="58" alt="Avatar"></p><p>Sam</p></div></div></div><p>May 21st, 2020</p><p><strong>Introducing YARP Preview 1</strong></p><p><a href="https://github.com/microsoft/reverse-proxy" rel="noopener noreferrer" target="_blank">YARP</a> is a project to create a reverse proxy server. It started when we noticed a pattern of questions from internal teams at Microsoft who were either building a reverse proxy for their service or had been asking about APIs and technology for building one, so we decided to get them all together to work on a common solution, which has become YARP.</p><p>YARP is a reverse proxy toolkit for building fast proxy servers in .NET using the infrastructure from ASP.NET and .NET. The key differentiator for YARP is that it is being designed to be easily customized and tweaked to match the specific needs of each deployment scenario. YARP plugs into the ASP.NET pipeline for handling incoming requests, and then has its own sub-pipeline for performing the steps to proxy the requests to backend servers. Customers can add additional modules, or replace stock modules as needed.</p><p>With the basic infrastructure of the proxy now in place, we’ve produced the first official build of YARP (Preview 1) in order to better collaborate and get feedback.</p><p><strong>What is in Preview 1</strong></p><ul><li>Core proxy infrastructure</li><li>Config-based route definitions</li><li>Pipeline model for extensibility</li><li>Forwarded Headers (hard coded)</li><li>Targeting both .NET Core 3.1 and .NET Core 5</li></ul><p><strong>What is not in Preview 1</strong></p><ul><li>Session Affinity <a href="https://github.com/microsoft/reverse-proxy/issues/45" rel="noopener noreferrer" target="_blank">#45</a></li><li>Forwarded Headers (configurable) <a href="https://github.com/microsoft/reverse-proxy/issues/60" rel="noopener noreferrer" target="_blank">#60</a></li><li>Code-based route definition &amp; per-request routing <a href="https://github.com/microsoft/reverse-proxy/issues/8" rel="noopener noreferrer" target="_blank">#8</a>, <a href="https://github.com/microsoft/reverse-proxy/issues/46" rel="noopener noreferrer" target="_blank">#46</a></li><li>Metrics &amp; logging <a href="https://github.com/microsoft/reverse-proxy/issues/61" rel="noopener noreferrer" target="_blank">#61</a></li><li>Performance tweaks <a href="https://github.com/microsoft/reverse-proxy/issues/51" rel="noopener noreferrer" target="_blank">#51</a></li><li>Connection filtering <a href="https://github.com/microsoft/reverse-proxy/issues/53" rel="noopener noreferrer" target="_blank">#53</a></li><li>And much more – see the <a href="https://github.com/microsoft/reverse-proxy/projects/5" rel="noopener noreferrer" target="_blank">project board</a> for more details</li></ul><p><strong> Getting started with YARP Preview 1 </strong></p><p>YARP is designed as a library that provides the core proxy functionality, that you can then customize by adding or replacing modules. For preview 1, YARP is being supplied as a nuget package and code snippets. We plan on having a project template, and pre-built exe in future previews.</p><ol><li>YARP works with either .NET Core 3.1 or .NET 5 preview 4 (or later). Download the preview 4 (or greater) of .NET 5 SDK from <a href="https://dotnet.microsoft.com/download/dotnet/5.0" target="_blank">https://dotnet.microsoft.com/download/dotnet/5.0</a></li><li>Create an “Empty” ASP.NET Core application using<ul><li><code><span>dotnet </span><span>new</span><span> web </span><span>-</span><span>n </span><span>MyProxy</span><span> </span><span>-</span><span>f netcoreapp5</span><span>.</span><span>0</span><span> </span></code>(or <code><span>netcoreapp3</span><span>.</span><span>1</span></code> for .NET Core 3.1)<br> Or</li><li>Create a new ASP.NET Core web application in Visual Studio, and choose “Empty” for the project template</li></ul></li><li>Open the Project and make sure it includes:<pre><span>&lt;PropertyGroup&gt;</span><span>
  </span><span>&lt;TargetFramework&gt;</span><span>netcoreapp5.0</span><span>&lt;/TargetFramework&gt;</span><span>
</span><span>&lt;/PropertyGroup&gt;</span></pre><p>And</p><pre><span>&lt;ItemGroup&gt;</span><span> 
  </span><span>&lt;PackageReference</span><span> </span><span>Include</span><span>=</span><span>"Microsoft.ReverseProxy"</span><span> </span><span>Version</span><span>=</span><span>"1.0.0-preview.1.*"</span><span> </span><span>/&gt;</span><span> 
</span><span>&lt;/ItemGroup&gt;</span></pre></li><li> <em>Startup.cs</em><br> YARP is implemented as a ASP.NET Core component, and so the majority of the sample code is in Startup.cs.<br> YARP currently uses configuration files to define the routes and endpoints for the proxy. That is loaded in the <code><span>ConfigureServices</span></code> method.<pre><span>public</span><span> </span><span>IConfiguration</span><span> </span><span>Configuration</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>}</span><span>
</span><span>public</span><span> </span><span>Startup</span><span>(</span><span>IConfiguration</span><span> configuration</span><span>)</span><span>
</span><span>{</span><span>
    </span><span>Configuration</span><span> </span><span>=</span><span> configuration</span><span>;</span><span>
</span><span>}</span><span>
</span><span>public</span><span> </span><span>void</span><span> </span><span>ConfigureServices</span><span>(</span><span>IServiceCollection</span><span> services</span><span>)</span><span> 
</span><span>{</span><span> 
    services</span><span>.</span><span>AddReverseProxy</span><span>()</span><span> 
        </span><span>.</span><span>LoadFromConfig</span><span>(</span><span>Configuration</span><span>.</span><span>GetSection</span><span>(</span><span>"ReverseProxy"</span><span>));</span><span> 
</span><span>}</span><span> </span></pre><p> The configure method defines the ASP.NET pipeline for processing requests. The reverse proxy is plugged in to ASP.NET endpoint routing, and then has its own sub pipeline for the proxy. Here proxy pipeline modules, such as load balancing can be added to customize the handling of the request.</p><pre><span>/// &lt;summary&gt;</span><span>
</span><span>/// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span><span>
</span><span>/// &lt;/summary&gt;</span><span>
</span><span>public</span><span> </span><span>void</span><span> </span><span>Configure</span><span>(</span><span>IApplicationBuilder</span><span> app</span><span>)</span><span>
</span><span>{</span><span>
    app</span><span>.</span><span>UseHttpsRedirection</span><span>();</span><span>

    app</span><span>.</span><span>UseRouting</span><span>();</span><span>
    app</span><span>.</span><span>UseAuthorization</span><span>();</span><span>
    app</span><span>.</span><span>UseEndpoints</span><span>(</span><span>endpoints </span><span>=&gt;</span><span>
    </span><span>{</span><span>
        endpoints</span><span>.</span><span>MapControllers</span><span>();</span><span>
        endpoints</span><span>.</span><span>MapReverseProxy</span><span>(</span><span>proxyPipeline </span><span>=&gt;</span><span>
        </span><span>{</span><span>
            proxyPipeline</span><span>.</span><span>UseProxyLoadBalancing</span><span>();</span><span>
        </span><span>});</span><span>
    </span><span>});</span><span>
</span><span>}</span></pre></li><li> <em>Configuration</em><p>The configuration for YARP is defined in JSON in the appsettings.json file. It defines a set of:</p><ul><li> <code><span>Backends</span></code> – which are the clusters of servers that requests can be routed to<ul><li>The destination name is an identifier that is used in metrics, logging and for session affinity.</li><li>Address is the URI prefix that will have the original request path appended to it</li></ul></li><li><code><span>Routes</span></code> – which map incoming requests to the backend clusters based on aspects of the request such as host name, path, method, request headers etc.<br> Routes are ordered, so the <code><span>app1</span></code> route needs to be defined first as <code><span>route2</span></code> will act as a catchall for all paths that have not already been matched.<p> The following needs to be a peer to the <code><span>Logging</span></code> and <code><span>AllowedHosts</span></code> sections.</p><pre><span>  </span><span>"ReverseProxy"</span><span>:</span><span> </span><span>{</span><span>
    </span><span>"Routes"</span><span>:</span><span> </span><span>[</span><span>
      </span><span>{</span><span>
        </span><span>"RouteId"</span><span>:</span><span> </span><span>"app1"</span><span>,</span><span>
        </span><span>"BackendId"</span><span>:</span><span> </span><span>"backend1"</span><span>,</span><span>
        </span><span>"Match"</span><span>:</span><span> </span><span>{</span><span>
          </span><span>"Methods"</span><span>:</span><span> </span><span>[</span><span> </span><span>"GET"</span><span>,</span><span> </span><span>"POST"</span><span> </span><span>],</span><span>
          </span><span>"Host"</span><span>:</span><span> </span><span>"localhost"</span><span>,</span><span>
          </span><span>"Path"</span><span>:</span><span> </span><span>"/app1/"</span><span>
        </span><span>}</span><span>
      </span><span>},</span><span>
      </span><span>{</span><span>
        </span><span>"RouteId"</span><span>:</span><span> </span><span>"route2"</span><span>,</span><span>
        </span><span>"BackendId"</span><span>:</span><span> </span><span>"backend2"</span><span>,</span><span>
        </span><span>"Match"</span><span>:</span><span> </span><span>{</span><span>
          </span><span>"Host"</span><span>:</span><span> </span><span>"localhost"</span><span>
        </span><span>}</span><span>
      </span><span>}</span><span>
    </span><span>],</span><span>
    </span><span>"Backends"</span><span>:</span><span> </span><span>{</span><span>
      </span><span>"backend1"</span><span>:</span><span> </span><span>{</span><span>
        </span><span>"LoadBalancing"</span><span>:</span><span> </span><span>{</span><span>
          </span><span>"Mode"</span><span>:</span><span> </span><span>"Random"</span><span>
        </span><span>},</span><span>
        </span><span>"Destinations"</span><span>:</span><span> </span><span>{</span><span>
          </span><span>"backend1_destination1"</span><span>:</span><span> </span><span>{</span><span>
            </span><span>"Address"</span><span>:</span><span> </span><span>"https://example.com:10000/"</span><span>
          </span><span>},</span><span>
          </span><span>"backend1_destination2"</span><span>:</span><span> </span><span>{</span><span>
            </span><span>"Address"</span><span>:</span><span> </span><span>"http://example.com"</span><span>10001</span><span>/</span><span>"
          }
        }
      },
      "</span><span>backend2</span><span>": {
        "</span><span>Destinations</span><span>": {
          "</span><span>backend2_destination1</span><span>": {
            "</span><span>Address</span><span>": "</span><span>https</span><span>:</span><span>//example.com:10002/"</span><span>
          </span><span>}</span><span>
        </span><span>}</span><span>
      </span><span>}</span><span>
    </span><span>}</span><span>
  </span><span>}</span></pre></li></ul></li></ol><p><strong>Survey</strong></p><p>We are interested to see how you are currently using a reverse proxy and what problems we need to solve with this project. We’d appreciate your input <a href="https://www.surveymonkey.com/r/3D53JKL" target="_blank">here</a>.</p><p><strong>Code Feedback</strong></p><p>If you have feature suggestions, changes, bugs etc, please provide feedback using the issue templates in the project repo. We welcome contributions, please see <a href="https://github.com/microsoft/reverse-proxy/blob/master/contributing.md" target="_blank">contibuting.md</a> for more details.</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>