<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Simplify microservices with Dapr (Distributed Application Runtime) - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Simplify microservices with Dapr (Distributed Application Runtime) - linksfor.dev(s)"/>
    <meta property="article:author" content="https://www.facebook.com/radoslav.gatev"/>
    <meta property="og:description" content="Building distributed applications is a tough job! To get it right you will need lots of tools just to get started. Think about availability, scalability, service discovery, data consistency, developer productivity... Now you have chosen some kind of a container-orchestration system like Kubernetes (K8s) to address some of the challenges."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.gatevnotes.com/simplify-microservices-development-with-dapr-distributed-application-runtime/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Simplify microservices with Dapr (Distributed Application Runtime)</title>
<div class="readable">
        <h1>Simplify microservices with Dapr (Distributed Application Runtime)</h1>
            <div>by https://www.facebook.com/radoslav.gatev</div>
            <div>Reading time: 10-12 minutes</div>
        <div>Posted here: 28 Mar 2020</div>
        <p><a href="https://www.gatevnotes.com/simplify-microservices-development-with-dapr-distributed-application-runtime/">https://www.gatevnotes.com/simplify-microservices-development-with-dapr-distributed-application-runtime/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="site-main">
    <div>

        <article>

            

            <figure>
                <img srcset="/content/images/size/w300/2020/03/dapr.jpg 300w,
                            /content/images/size/w600/2020/03/dapr.jpg 600w,
                            /content/images/size/w1000/2020/03/dapr.jpg 1000w,
                            /content/images/size/w2000/2020/03/dapr.jpg 2000w" sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px" src="https://www.gatevnotes.com/content/images/size/w2000/2020/03/dapr.jpg" alt="Simplify microservices with Dapr (Distributed Application Runtime)">
            </figure>

            <section>
                <div>
                    <p>Building distributed applications is a tough job! To get it right you will need lots of tools just to get started. Think about availability, scalability, service discovery, data consistency, developer productivity... Now you have chosen some kind of a container-orchestration system like Kubernetes (K8s) to address some of the challenges. At that point you have alleviated some problems but you have created a new set of issues like for example architectural complexity, operational complexity, configuration complexity and conceptual complexity...</p><p>Think about applying the <a href="https://12factor.net/">Twelve-Factor app methodology</a> to <a href="https://microservices.io/patterns/microservices.html">microservices</a>. That's a challenge, right?</p><p>What can we do to help enterprise developers build distributed applications? We already utilize ready-to-use code and patterns as libraries or frameworks. Can't we do the same with distributed apps?</p><h2 id="what-is-dapr">What is Dapr?</h2><p>The official description goes like this: </p><blockquote><a href="https://github.com/dapr/dapr">Dapr</a> is a portable, event-driven runtime that makes it easy for developers to build resilient, microservice stateless and stateful applications that run on &nbsp;the cloud and edge and embraces the diversity of languages and developer &nbsp;frameworks.</blockquote><p>A lot of things are going on in there.</p><figure><img src="https://www.gatevnotes.com/content/images/2020/03/dapr-overview-1-.png"></figure><p> <br>Dapr is a runtime that lets you use some of the best practices out of the box. I think of it as a library of reusable patterns when it comes to microservices and distributed applications. Just like when you have to deal with resiliency and transient-fault-handling in .NET, you will most likely end up using some library like <a href="http://www.thepollyproject.org/">Polly</a>.<br>In the same way Dapr consists of a set of <strong>building blocks </strong>and each of them is an API accessible by either HTTP or gRPC that provides you with some kind of an added value like an API for publish/subscribe, API for state management, etc.</p><p>Dapr is language and platform agnostic and you don't need any special libraries as it's one HTTP/gRPC call away. Having said that, Dapr also provides several SDKs to make it first-class citizen of the language of your choice. You can learn more about the <a href="https://github.com/dapr/dotnet-sdk">.NET SDK on Github</a>. Dapr can run anywhere you want - any cloud, on-premises, on the edge, inside Kubernetes or outside. </p><h2 id="building-blocks">Building blocks</h2><p>The building blocks in Dapr essentially expose the <strong>API </strong>that you work with. But the underlying functionality is performed by one or more components that you configure. All components are pluggable so that you can swap out one component with the same interface for another. For example, if you use <a href="https://redis.io/">Redis </a>as a state store, you can substitute it with <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction">Cosmos DB</a> just by changing the definition of your state component. Having applied then new component definition, all requests for state store will go to Cosmos DB.</p><figure><img src="https://www.gatevnotes.com/content/images/2020/03/concepts-building-blocks-1-.png"></figure><!--kg-card-begin: markdown--><p>Components have the following definition in YAML:</p>
<pre><code><span>apiVersion</span><span>:</span> <a href="http://dapr.io/v1alpha1" rel="nofollow"><span>dapr</span><span>.</span><span>io</span><span>/</span><span>v1alpha1</span></a>
<span>kind</span><span>:</span> Component
<span>metadata</span><span>:</span>
  <span>name</span><span>:</span> &lt;NAME<span>&gt;</span>
<span>spec</span><span>:</span>
  <span>type</span><span>:</span> state.&lt;TYPE<span>&gt;</span>
  <span>metadata</span><span>:</span>
  <span>-</span> name<span>:</span>&lt;KEY<span>&gt;</span>
    value<span>:</span>&lt;VALUE<span>&gt;</span>
  <span>-</span> <span>name</span><span>:</span> &lt;KEY<span>&gt;</span>
    <span>value</span><span>:</span> &lt;VALUE<span>&gt;</span>
</code></pre>
<!--kg-card-end: markdown--><p>The building blocks provided by Dapr are the following at the time of writing this are:</p><h3 id="service-invocation">Service Invocation</h3><figure><img src="https://www.gatevnotes.com/content/images/2020/03/service-invocation-1-.png"></figure><p>This puts the burden of service discovery on the Dapr runtime. Resilient service-to-service invocation enables method calls, including &nbsp;retries, on remote services wherever they are running in the supported hosting environment. You have to just issue a request to the <strong>/invoke</strong> endpoint, specify the <em>appId</em> and the <em>method </em>of the target application, and then Dapr will forward the response back to you. Just like a reverse proxy!</p><h3 id="state-management">State management</h3><figure><img src="https://www.gatevnotes.com/content/images/2020/03/state_management-1-.png"></figure><p>This building block API is used for storing, retrieving and deleting the key/value pairs that represents the state of your services. There are state store components for different data stores such as <a href="https://redis.io/" rel="nofollow">Redis</a>, <a href="https://azure.microsoft.com/services/cosmos-db/" rel="nofollow">Azure CosmosDB</a>, <a href="https://azure.microsoft.com/services/sql-database/" rel="nofollow">SQL Server</a>, <a href="https://aws.amazon.com/DynamoDB" rel="nofollow">AWS DynamoDB</a>, <a href="https://cloud.google.com/spanner" rel="nofollow">GCP Cloud Spanner</a> and <a href="http://cassandra.apache.org/" rel="nofollow">Cassandra</a>.</p><h3 id="publish-and-subscribe-messaging-between-services">Publish and subscribe messaging between services</h3><p>Publishing events and subscribing to topics is key for some systems. By using this building block, you abstract the usage of services such as <a href="https://redis.io/">Redis</a>, <a href="https://azure.microsoft.com/en-us/services/service-bus/">Azure Service Bus</a>, <a href="https://www.rabbitmq.com/">RabitMQ</a>, and <a href="https://nats.io/">NATS</a>. Dapr guarantees<em> At-Least-Once</em> message delivery and will ensure the delivery will hit a single instance of your app in case it's running on multiple.</p><h3 id="event-driven-resource-bindings">Event-driven Resource Bindings</h3><p>You can have an event-driven architecture designed for scale and resiliency by sending and receiving events to and from any external resources such as databases, queues, cloud-services, file systems, blob stores, webhooks, etc.</p><p>For example, your code can be triggered by a message coming from Azure Event Hub and then you can write some data to Azure Cosmos DB. But you don't have to employ the concepts of the SDK of the source/target service in your code. As already mentioned, everything happens via HTTP or gRPC.</p><h3 id="actors">Actors</h3><figure><img src="https://www.gatevnotes.com/content/images/2020/03/actor_game_example-1-.png"></figure><p>The <a href="https://en.wikipedia.org/wiki/Actor_model" rel="nofollow">actor pattern</a> is a computational model for concurrent or distributed systems in which a large number of these actors can execute simultaneously and independently of each other. Actors can communicate with each other and they can create more actors. Maybe you have used <a href="https://akka.io/">Akka</a>, <a href="https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-reliable-actors-introduction">Service Fabric Reliable Actors</a> or even <a href="https://www.microsoft.com/en-us/research/project/orleans-virtual-actors/">Orleans </a>to achieve this.</p><p>Dapr provides an actor implementation which is based on the Virtual Actor pattern which means that the actors' lifetime is not tied to their in-memory representation. Actors do not need to be explicitly created or destroyed. When actors are not in use they are garbage collected. Actors can schedule periodic work by registering either timers or reminders. In fact, Dapr C# actors are based on <a href="https://docs.microsoft.com/azure/service-fabric/service-fabric-reliable-actors-introduction" rel="nofollow">Service Fabric Reliable Actors</a>. </p><p>This building block is also based on <strong>State components</strong>.</p><h3 id="distributed-tracing">Distributed Tracing</h3><figure><img src="https://www.gatevnotes.com/content/images/2020/03/tracing-1-.png"></figure><p>Distributed tracing collects and aggregates trace events, metrics and &nbsp;performance numbers between Dapr instances. It allows you to trace the entire call chain across multiple services. Dapr uses <a href="https://opentelemetry.io/">OpenTelemetry</a> (previously known as <a href="https://opencensus.io/">OpenCensus</a>) for distributed &nbsp;traces and metrics collection. OpenTelemetry supports various backends &nbsp;including <a href="https://azure.microsoft.com/en-us/services/monitor/" rel="nofollow">Azure Monitor</a>, <a href="https://www.datadoghq.com/" rel="nofollow">Datadog</a>, <a href="https://www.instana.com/" rel="nofollow">Instana</a>, <a href="https://www.jaegertracing.io/" rel="nofollow">Jaeger</a>, <a href="https://www.signalfx.com/" rel="nofollow">SignalFX</a>, <a href="https://cloud.google.com/stackdriver" rel="nofollow">Stackdriver</a>, <a href="https://zipkin.io/" rel="nofollow">Zipkin</a> and others.</p><h3 id="secrets-management">Secrets Management</h3><p>Dapr offers developers a consistent way to extract application &nbsp;secrets, without needing to know the specifics of the secret store being used. Secret stores are components in Dapr. </p><p>You can reference secrets stored in a secret store from other components. For example, within the definition of your <em>Redis </em>state component instead of providing the <em>plaintext </em>credentials, you can reference them by <em>names </em>under which they are saved in the secret store. Or you can access secrets from your applications by calling the <strong>/secrets </strong>endpoint of the Dapr API.</p><p>Currently supported secret stores are: <a href="https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/">Kubernetes</a>, <a href="https://www.vaultproject.io/">Hashicorp Vault</a>, <a href="https://azure.microsoft.com/en-us/services/key-vault/">Azure Key Vault</a>, <a href="https://aws.amazon.com/secrets-manager/">AWS Secret manager</a>, <a href="https://cloud.google.com/kms">GCP Cloud KMS</a>, <a href="https://cloud.google.com/secret-manager/docs">GCP Secret Manager</a>.</p><h2 id="where-can-i-run-dapr">Where can I run Dapr?</h2><p>Dapr exposes its APIs in a sidecar architecture, either as a container or as a process, and by not requiring the application code to include any Dapr runtime code. This makes integration with Dapr easy from other runtimes. It currently supports two modes: Standalone (self-hosted) and Kubernetes.</p><h3 id="standalone-self-hosted-">Standalone (self-hosted)</h3><p>In standalone mode Dapr runs as a separate process from which your service code can call via HTTP or gRPC. </p><figure><img src="https://www.gatevnotes.com/content/images/2020/03/overview-sidecar-1--1.png"></figure><p>In this mode you will need to have Docker installed locally as Dapr will create a Redis container that will serve as your default state store and pub/sub message bus for components.</p><h3 id="kubernetes">Kubernetes</h3><p>Dapr natively supports Kubernetes. It can run anywhere where K8s is hosted. In Kubernetes mode, Dapr runs as a side-car container with the application container in the same pod. </p><figure><img src="https://www.gatevnotes.com/content/images/2020/03/overview-sidecar-kubernetes-1-.png"></figure><!--kg-card-begin: markdown--><p>Deploying and running a Dapr enabled application into your K8s  cluster is a simple as adding a few annotations to the deployment  scheme. To give your app an <em>ID</em> and <em>port</em> known to Dapr, turn on tracing information and launch the Dapr sidecar container, you annotate your Kubernetes deployment template like this:</p>
<pre><code><span>annotations</span><span>:</span>
  <span><a href="http://dapr.io/enabled" rel="nofollow"><span>dapr</span><span>.</span><span>io</span><span>/</span><span>enabled</span></a></span><span>:</span> <span>"true"</span>
  <span><a href="http://dapr.io/id" rel="nofollow"><span>dapr</span><span>.</span><span>io</span><span>/</span><span>id</span></a></span><span>:</span> <span>"nodeapp"</span>
  <span><a href="http://dapr.io/port" rel="nofollow"><span>dapr</span><span>.</span><span>io</span><span>/</span><span>port</span></a></span><span>:</span> <span>"3000"</span>
  <span><a href="http://dapr.io/config" rel="nofollow"><span>dapr</span><span>.</span><span>io</span><span>/</span><span>config</span></a></span><span>:</span> <span>"tracing"</span>
</code></pre>
<p>After running <code>kubectl apply</code> you'll notice that the pod for your app run two containers.<br>
<img src="https://www.gatevnotes.com/content/images/2020/03/Dapr-showing-dapr-sidecar.png" alt="Dapp sidecar in a pod"></p>
<!--kg-card-end: markdown--><h2 id="how-to-get-started">How to get started?</h2><p>You can follow the<strong> Getting Started</strong> guide on <a href="https://github.com/dapr/docs/tree/master/getting-started">dapr/docs</a>.</p><h2 id="support-for-asp-net-core">Support for ASP.NET Core</h2><p>I have already mentioned the .NET SDK for Dapr. <br>When it comes to ASP.NET Core, Dapr provides integration with controllers, so that you can access the state store in action methods or you can subscribe to events. There is <a href="https://cloudevents.io/">Cloud Events</a> model binding and Actors support.</p><h2 id="how-to-debug">How to debug?</h2><p>Debugging distributed apps is painful. There is an extension for <em>Visual Studio Code</em> helps with the coordination of the debugger with Dapr runtime. At the time of writing it only works for apps running in standalone mode of Dapr. The support for &nbsp;<a href="https://azure.microsoft.com/en-us/services/kubernetes-service/">Azure Kubernetes Service</a> with <a href="https://docs.microsoft.com/en-us/azure/dev-spaces/">Dev Spaces</a> will come quite handy but it's not there yet.</p><figure><a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-dapr"><div><p>Dapr - Visual Studio Marketplace</p><p>Extension for Visual Studio Code - Makes it easy to run, debug, and interact with Dapr-enabled applications.</p><p><img src="https://marketplace.visualstudio.com/favicon.ico"></p></div><p><img src="https://ms-azuretools.gallerycdn.vsassets.io/extensions/ms-azuretools/vscode-dapr/0.2.1/1584649119540/Microsoft.VisualStudio.Services.Icons.Default"></p></a></figure><p>First you have to configure the debugger to work with Dapr. Hit <strong>Ctrl + Shift + P </strong>and search for <strong>Dapr: Scaffold Dapr Tasks</strong>. It will ask for the name of the Dapr application and the port it listens on. This will generate proper Visual Studio Code <em>launch.json</em> configuration file for your project. You can now hit <strong><em>F5 </em></strong>and Dapr will start the app for you in Debug mode.</p><p>Then right click your application and hit Invoke GET/POST Application Method. Them VS Code will ask you to provide the name of the application method and some payload:</p><figure><img src="https://www.gatevnotes.com/content/images/2020/03/Debuggin-Dapr-Visual-Studio-Code.png"></figure><figure><img src="https://www.gatevnotes.com/content/images/2020/03/Debuggin-Dapr-Visual-Studio-Code-Breakpoint.png"></figure><h2 id="where-can-i-find-more-information">Where can I find more information?</h2><p>The documentation of Dapr is on GitHub:</p><figure><a href="https://github.com/dapr/docs"><div><p>dapr/docs</p><p>User documentation for Dapr. Contribute to dapr/docs development by creating an account on GitHub.</p><p><img src="https://github.githubassets.com/favicon.ico"><span>GitHub</span></p></div><p><img src="https://repository-images.githubusercontent.com/209614512/0f540780-ef53-11e9-9c08-7ae94ec5e99a"></p></a></figure><p><em>Dapr is currently in alpha release. I would love to know what you think about it and how it meets (or not) your distributed application development needs!</em></p>
                </div>
            </section>
            
             
                <section>
    <h3>Subscribe to The blog of Radoslav Gatev</h3>
    <p>Get the latest posts delivered right to your inbox</p>
    <form data-members-form="subscribe">
        
        <p><strong>Great!</strong> Check your inbox and click the link to confirm your subscription.
        </p>
        <p>
            Please enter a valid email address!
        </p>
    </form>
</section>
            

        </article>

    </div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>