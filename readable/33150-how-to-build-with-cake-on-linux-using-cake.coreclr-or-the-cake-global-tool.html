<!DOCTYPE html>
<html lang="en">
<head>
    <title>
How to build with Cake on Linux using Cake.CoreCLR or the Cake global tool -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>How to build with Cake on Linux using Cake.CoreCLR or the Cake global tool</h1>
    <div class="post-content">
<p>In this post I show two ways to use the <a href="https://cakebuild.net/">Cake build system</a> to build .NET Core projects on Linux: using the <em>Cake.CoreCLR</em> library, or the <em>Cake.Tool</em> .NET Core global tool. This post only deals with bootstrapping Cake, it doesn&apos;t describe how to write Cake build scripts themselves. For that, I suggest reading <a href="https://rehansaeed.com/cross-platform-devops-net-core/">Muhammad Rehan Saeed&apos;s post</a> which provides a Cake build script, or <a href="/building-asp-net-core-apps-using-cake-in-docker/">my previous post on using Cake in Docker</a>.</p> <p><a href="/building-asp-net-core-apps-using-cake-in-docker/">In a previous post</a>, I described using Mono to run the full .NET Framework version of Cake on Linux. That was fine for my purposes then, as I was <a href="/building-net-framework-asp-net-core-apps-on-linux-using-mono-and-the-net-cli/">using Mono anyway to build libraries that targeted .NET Framework on Linux</a>, and I wanted to run full framework tests on Linux.</p>
<p>However, if you only need to <em>build</em> (and not <em>run</em>), you can now <a href="/using-reference-assemblies-to-build-net-framework-libararies-on-linux-without-mono/">use the <em>Microsoft.NetFramework.ReferenceAssemblies</em> NuGet packages</a> to build .NET Framework libraries on Linux, <em>without</em> having to explicitly install Mono. For that reason, I think the full .NET Framework version of Cake is no longer the best option for building on Linux.</p>
<p>Luckily, <a href="https://github.com/cake-build/cake/issues/1751#issuecomment-487494424">there are currently three different versions of Cake</a>:</p>
<ul>
<li><a href="https://www.nuget.org/packages/Cake.Tool/">Cake.Tool</a>: a .NET Core global tool, targeting .NET Core 2.1</li>
<li><a href="https://www.nuget.org/packages/Cake.CoreCLR/">Cake.CoreCLR</a>: a .NET Core console app targeting .NET Core 2.0</li>
<li><a href="https://www.nuget.org/packages/Cake/">Cake</a>: a .NET Framework console app targeting .NET Framework 4.6.1/Mono</li>
</ul>
<p>Which option is best for you will likely depend on your exact environment. The good thing about these tools is that you should be able to switch between them without having to change your actual <em>build.cake</em> script at all. The difference is primarily in how you acquire and run Cake, i.e. the bootstrapping scripts you use.</p>
<blockquote>
<p>Note that in this post I assume you already have the correct version of .NET Core installed. For examples of installing the .NET Core SDK as part of the bootstrapping script, see <a href="https://github.com/cake-build/cake/blob/06e7983704/build.sh">this example from the Cake project itself</a>.</p>
</blockquote> <p>My first approach in converting away from Mono-based Cake was to use the Cake.CoreCLR library. I felt like this would be an easy drop in replacement, though it took a bit of googling to find some suggested bootstrapping scripts. The bootstrapping scripts effectively took one of two approaches:</p>
<ul>
<li>Use the .NET Core CLI to restore the Cake.CoreCLR package</li>
<li>Use <code>curl</code> to download the Cake.CoreCLR package, and manually extract it</li>
</ul>
<p>The first of these approaches is interesting. The <code>dotnet</code> CLI allows you to restore NuGet packages that have been added to a project, but doesn&apos;t allow you to restore <em>arbitrary</em> packages. To work around this, you can do something like the following:</p>
<pre class="language-bash"><code class="language-bash">dotnet new classlib -o <span class="token string">&quot;<span class="token variable">$TEMP_DIR</span>&quot;</span> --no-restore
dotnet add <span class="token string">&quot;<span class="token variable">$TEMP_PROJECT</span>&quot;</span> package Cake.CoreCLR --package-directory <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> --version <span class="token string">&quot;<span class="token variable">$CAKE_VERSION</span>&quot;</span>
<span class="token function">rm</span> -rf <span class="token string">&quot;<span class="token variable">$TEMP_DIR</span>&quot;</span>
</code></pre>
<p>This does four things:</p>
<ul>
<li>Creates a temporary .NET Core project using <code>dotnet new</code> in the <code>$TEMP_DIR</code> directory</li>
<li>Adds the <code>Cake.CoreCLR</code> NuGet package to the project</li>
<li>Implicitly restores the package to a specific directory, <code>$TOOLS_DIR</code></li>
<li>Deletes the temporary project</li>
</ul>
<p>After running this script, the Cake.CoreCLR NuGet package has been downloaded and extracted to the tools directory.</p>
<p>The following bash script shows how this fits in to the overall bootstrapping script. This is just the version I came up with; I&apos;ve listed a variety of example scripts at the end of this post.</p>
<pre class="language-bash"><code class="language-bash"> SCRIPT_DIR<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token function">cd</span> <span class="token string">&quot;$( dirname &quot;</span>$<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span>&quot; <span class="token variable">)</span></span><span class="token string">&quot; &amp;&amp; pwd )
TOOLS_DIR=<span class="token variable">$SCRIPT_DIR</span>/tools
TEMP_DIR=<span class="token variable">$TOOLS_DIR</span>/build
TEMP_PROJECT=<span class="token variable">$TEMP_DIR</span>/build.csproj # Define default arguments.
SCRIPT=&quot;</span>build.cake&quot;
CAKE_VERSION<span class="token operator">=</span><span class="token string">&quot;0.33.0&quot;</span>
CAKE_ARGUMENTS<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable"><a href="/cdn-cgi/l/email-protection" class="__cf_email__">[email&#xA0;protected]</a></span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span> -s<span class="token operator">|</span>--script<span class="token punctuation">)</span> SCRIPT<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span><span class="token punctuation">;</span> <span class="token function">shift</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> --cake-version<span class="token punctuation">)</span> CAKE_VERSION<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span><span class="token punctuation">;</span> <span class="token function">shift</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> --<span class="token punctuation">)</span> <span class="token function">shift</span><span class="token punctuation">;</span> CAKE_ARGUMENTS+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable"><a href="/cdn-cgi/l/email-protection" class="__cf_email__">[email&#xA0;protected]</a></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> *<span class="token punctuation">)</span> CAKE_ARGUMENTS+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> esac <span class="token function">shift</span>
<span class="token keyword">done</span> CAKE_PATH<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/cake.coreclr/<span class="token variable">$CAKE_VERSION</span>/Cake.dll&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -f <span class="token string">&quot;<span class="token variable">$CAKE_PATH</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token keyword">echo</span> <span class="token string">&quot;Restoring Cake...&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token function">mkdir</span> <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> <span class="token keyword">fi</span> dotnet new classlib -o <span class="token string">&quot;<span class="token variable">$TEMP_DIR</span>&quot;</span> --no-restore dotnet add <span class="token string">&quot;<span class="token variable">$TEMP_PROJECT</span>&quot;</span> package Cake.CoreCLR --package-directory <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> --version <span class="token string">&quot;<span class="token variable">$CAKE_VERSION</span>&quot;</span> <span class="token function">rm</span> -rf <span class="token string">&quot;<span class="token variable">$TEMP_DIR</span>&quot;</span>
<span class="token keyword">fi</span> <span class="token function">exec</span> dotnet <span class="token string">&quot;<span class="token variable">$CAKE_PATH</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$SCRIPT</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${CAKE_ARGUMENTS[@]}</span>&quot;</span>
</code></pre>
<p>The first half of the script is parsing command-line arguments and defining defaults. The path we expect to find <em>Cake.dll</em> is checked, and if it&apos;s not found, we use the previous technique to restore it. Finally, we execute cake using the form <code>dotnet Cake.dll</code>.</p>
<blockquote>
<p>Notice that I&apos;ve &quot;pinned&quot; the Cake.CoreCLR version to <code>0.33.0</code> in the script, to ensure we get a consistent version of Cake on the build server. </p>
</blockquote>
<p>When you run this script, you&apos;ll see output similar to the following, showing how the process works:</p>
<pre class="language-bash"><code class="language-bash">Restoring Cake<span class="token punctuation">..</span>.
Getting ready<span class="token punctuation">..</span>.
The template <span class="token string">&quot;Class library&quot;</span> was created successfully. Writing /tmp/tmp8yvA9D.tmp
info <span class="token keyword">:</span> Adding PackageReference <span class="token keyword">for</span> package <span class="token string">&apos;Cake.CoreCLR&apos;</span> into project <span class="token string">&apos;/sln/tools/build/build.csproj&apos;</span><span class="token keyword">.</span>
info <span class="token keyword">:</span> Restoring packages <span class="token keyword">for</span> /sln/tools/build/build.csproj<span class="token punctuation">..</span>.
info <span class="token keyword">:</span> GET https://api.nuget.org/v3-flatcontainer/cake.coreclr/index.json
info <span class="token keyword">:</span> OK https://api.nuget.org/v3-flatcontainer/cake.coreclr/index.json 438ms
info <span class="token keyword">:</span> GET https://api.nuget.org/v3-flatcontainer/cake.coreclr/0.33.0/cake.coreclr.0.33.0.nupkg
info <span class="token keyword">:</span> OK https://api.nuget.org/v3-flatcontainer/cake.coreclr/0.33.0/cake.coreclr.0.33.0.nupkg 25ms
info <span class="token keyword">:</span> Installing Cake.CoreCLR 0.33.0.
info <span class="token keyword">:</span> Package <span class="token string">&apos;Cake.CoreCLR&apos;</span> is compatible with all the specified frameworks <span class="token keyword">in</span> project <span class="token string">&apos;/sln/tools/build/build.csproj&apos;</span><span class="token keyword">.</span>
info <span class="token keyword">:</span> PackageReference <span class="token keyword">for</span> package <span class="token string">&apos;Cake.CoreCLR&apos;</span> version <span class="token string">&apos;0.33.0&apos;</span> added to <span class="token function">file</span> <span class="token string">&apos;/sln/tools/build/build.csproj&apos;</span><span class="token keyword">.</span>
info <span class="token keyword">:</span> Committing restore<span class="token punctuation">..</span>.
info <span class="token keyword">:</span> Generating MSBuild <span class="token function">file</span> /sln/tools/build/obj/build.csproj.nuget.g.props.
info <span class="token keyword">:</span> Generating MSBuild <span class="token function">file</span> /sln/tools/build/obj/build.csproj.nuget.g.targets.
info <span class="token keyword">:</span> Writing assets <span class="token function">file</span> to disk. Path: /sln/tools/build/obj/project.assets.json
log <span class="token keyword">:</span> Restore completed <span class="token keyword">in</span> 2.95 sec <span class="token keyword">for</span> /sln/tools/build/build.csproj.
</code></pre>
<p>This is quite a clever way to fetch the NuGet package, but it&apos;s probably a bit overly complicated. Another option is to directly download the NuGet and <code>unzip</code> it. You could replace the <code>dotnet new</code> approach in the above script with the following instead:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> -Lsfo <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/cake.coreclr.zip&quot;</span> <span class="token string">&quot;https://www.nuget.org/api/v2/package/Cake.CoreCLR/<span class="token variable">$CAKE_VERSION</span>&quot;</span> \ <span class="token operator">&amp;&amp;</span> unzip -q <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/cake.coreclr.zip&quot;</span> -d <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/cake.coreclr/<span class="token variable">$CAKE_VERSION</span>&quot;</span> \ <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> -f <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/cake.coreclr.zip&quot;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token keyword">echo</span> <span class="token string">&quot;An error occured while installing Cake.&quot;</span> <span class="token keyword">exit</span> 1
<span class="token keyword">fi</span>
</code></pre>
<p>This directly downloads the NuGet as a <em>.zip</em> file, extracts it, and deletes the zip file.</p>
<blockquote>
<p>Note that you must have the <code>unzip</code> command available in your environment - I don&apos;t believe it&apos;s generally installed by default.</p>
</blockquote>
<p>Either of these approaches work, and enable you to download the <code>Cake.CoreCLR</code> NuGet package. The alternative is to install the .NET Core global tool.</p> <p>.NET Core 2.1 introduced the concept of <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/global-tools">global tools</a>. These are CLI tools that can be installed globally on your machine, and are effectively just console apps. I described how to create a .NET Core global tool <a href="/creating-a-net-core-global-cli-tool-for-squashing-images-with-the-tinypng-api/">in a previous post</a>. Cake provides a global tool that can be used with .NET Core 2.1+.</p>
<p>Depending on your use case, you may or may not want to <em>actually</em> install the Cake tool <strong>globally</strong>. Global tools can also be installed to a specific folder by passing the <code>--tool-path</code> argument, in which case you can have multiple instances of the tool installed. </p>
<blockquote>
<p>My preference is to install global tool locally for each solution, to remove the dependence on outside tooling. This has the advantage of making each project self contained, and allowing different versions of the tool per-solution. The down-side is that you&apos;re using more disk space by installing the tool multiple times.</p>
</blockquote>
<p>To install Cake as a global tool, into a local <em>tools</em> folder, you can run </p>
<pre class="language-bash"><code class="language-bash">dotnet tool <span class="token function">install</span> Cake.Tool --tool-path ./tools --version 0.33.0
</code></pre>
<p>You can then invoke the tool using </p>
<pre class="language-bash"><code class="language-bash"><span class="token function">exec</span> ./tools/dotnet-cake
</code></pre>
<p>Note that we installed the tool using <code>--tool-path</code>, so we have to use the path to <code>dotnet-cake</code> directly; if you installed it globally, you could use <code>dotnet-cake</code> (or <code>dotnet cake</code>) from any folder.</p>
<p>Adding those commands to the bootstrapping script gives the following:</p>
<pre class="language-bash"><code class="language-bash"> SCRIPT_DIR<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token function">cd</span> <span class="token string">&quot;$( dirname &quot;</span>$<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span>&quot; <span class="token variable">)</span></span><span class="token string">&quot; &amp;&amp; pwd )
TOOLS_DIR=<span class="token variable">$SCRIPT_DIR</span>/tools # Define default arguments.
SCRIPT=&quot;</span>build.cake&quot;
CAKE_VERSION<span class="token operator">=</span><span class="token string">&quot;0.33.0&quot;</span>
CAKE_ARGUMENTS<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">&quot;<span class="token variable"><a href="/cdn-cgi/l/email-protection" class="__cf_email__">[email&#xA0;protected]</a></span>&quot;</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span> -s<span class="token operator">|</span>--script<span class="token punctuation">)</span> SCRIPT<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$2</span>&quot;</span><span class="token punctuation">;</span> <span class="token function">shift</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> --cake-version<span class="token punctuation">)</span> CAKE_VERSION<span class="token operator">=</span><span class="token string">&quot;--version=<span class="token variable">$2</span>&quot;</span><span class="token punctuation">;</span> <span class="token function">shift</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> --<span class="token punctuation">)</span> <span class="token function">shift</span><span class="token punctuation">;</span> CAKE_ARGUMENTS+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable"><a href="/cdn-cgi/l/email-protection" class="__cf_email__">[email&#xA0;protected]</a></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> *<span class="token punctuation">)</span> CAKE_ARGUMENTS+<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> esac <span class="token function">shift</span>
<span class="token keyword">done</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token function">mkdir</span> <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span>
<span class="token keyword">fi</span> CAKE_PATH<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>/dotnet-cake&quot;</span>
CAKE_INSTALLED_VERSION<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$CAKE_PATH --version 2<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1<span class="token variable">)</span></span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$CAKE_VERSION</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;<span class="token variable">$CAKE_INSTALLED_VERSION</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">&quot;<span class="token variable">$CAKE_PATH</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> dotnet tool uninstall Cake.Tool --tool-path <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> <span class="token keyword">fi</span> <span class="token keyword">echo</span> <span class="token string">&quot;Installing Cake <span class="token variable">$CAKE_VERSION</span>...&quot;</span> dotnet tool <span class="token function">install</span> Cake.Tool --tool-path <span class="token string">&quot;<span class="token variable">$TOOLS_DIR</span>&quot;</span> --version <span class="token variable">$CAKE_VERSION</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token keyword">echo</span> <span class="token string">&quot;An error occured while installing Cake.&quot;</span> <span class="token keyword">exit</span> 1 <span class="token keyword">fi</span>
<span class="token keyword">fi</span> <span class="token function">exec</span> <span class="token string">&quot;<span class="token variable">$CAKE_PATH</span>&quot;</span> <span class="token string">&quot;<span class="token variable">$SCRIPT</span>&quot;</span> <span class="token string">&quot;<span class="token variable">${CAKE_ARGUMENTS[@]}</span>&quot;</span>
</code></pre>
<p>As before, the first half of the script is parsing command line arguments and setting up defaults. We then check to see if the correct version of the Cake global tool is installed. If the wrong version is installed, we uninstall the old version first, otherwise we install the correct version. Finally we execute the script using the path to the global tool.</p>
<blockquote>
<p>If you&apos;re using this script in Docker containers there&apos;s pretty much no chance of there being a different version of the Cake tool installed, so you could remove the version check section if you prefer.</p>
</blockquote>
<p>The first time you run the script, you&apos;ll see the global tool installed: </p>
<pre class="language-bash"><code class="language-bash">Installing Cake 0.33.0<span class="token punctuation">..</span>.
You can invoke the tool using the following command: dotnet-cake
Tool <span class="token string">&apos;cake.tool&apos;</span> <span class="token punctuation">(</span>version <span class="token string">&apos;0.33.0&apos;</span><span class="token punctuation">)</span> was successfully installed.
</code></pre>
<p>Subsequent executions will execute the tool directly, without needing to install the tool.</p>
<p>Personally, I think the global tool is the way to go in all cases where you can use it (.NET Core 2.1+). Global tools are due to be <a href="https://www.dotnetcurry.com/dotnet/1495/dotnet-core-global-tools">updated in .NET Core 3.0</a>, but I expect that this will remain the canonical way to use Cake on Linux/Mac.</p> <p>In this post I showed two ways to run Cake on Linux: using Cake.CoreCLR, or the .NET Core global tool Cake.Tool. Generally speaking I would suggest using the global tool where possible, as it seems to be the preferred approach - <a href="https://github.com/cake-build/cake/blob/06e7983704/build.sh">even the Cake project itself is built using the .NET Core global tool</a>!</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>