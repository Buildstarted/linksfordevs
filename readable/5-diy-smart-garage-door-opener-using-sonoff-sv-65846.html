<!DOCTYPE html>
<html lang="en">
<head>
    <title>
$5 DIY &quot;Smart&quot; Garage Door Opener using Sonoff SV - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="$5 DIY &quot;Smart&quot; Garage Door Opener using Sonoff SV - linksfor.dev(s)"/>
    <meta property="article:author" content="DrZzs"/>
    <meta property="og:description" content="READ THIS UPDATE!!!! &#xA;Tasmota updates have changed some necessary settings!&#xA;Here&#x27;s what you need now:  (Thanks Chris Norton)&#xA;Switchretain 1&#xA;Powerretain 1&#xA;switchtopic2 garagestate&#xA;switchmode1 0&#xA;switchmode2 2&#xA;&#xA;GPIO 14 to 10 Switch2&#xA;&#xA;GPIO 4 to 22 Relay2&#xA;&#xA;&#xA;cover.yaml&#xA;&#xA;  - platform: mqtt&#xA;    name: &quot;Sonoff SV Garage&quot;&#xA;    state_topic: &quot;cmnd/garagestate/POWER2&quot;&#xA;    command_topic: &quot;cmnd/sonoffsv01/POWER&quot;&#xA;    payload_open: &quot;ON&quot;&#xA;    payload_close: &quot;ON&quot;&#xA;    payload_stop: &quot;ON&quot;&#xA;    state_open: &quot;ON&quot;&#xA;    state_closed: &quot;OFF&quot;&#xA;    optimistic: false&#xA;&#xA;customize.yaml&#xA;   &#xA;    cover.sonoff_sv_garage:&#xA;      device_class: garage&#xA;      friendly_name: Garage &#xA;&#xA;group.yaml&#xA;&#xA;  Garage Door:&#xA;    name: Garage Door&#xA;    view: no&#xA;    control: hidden&#xA;    icon: mdi:garage&#xA;    entities:&#xA;      - cover.sonoff_sv_garage&#xA;&#xA;&#xA;just thought I&#x2019;d share the full details of a sonoff sv garage switch with 6.2.1 firmware. &#xA;&#xA;A few common problems people have can be solved by:&#xA;#1 - in the Tasmota Console, type &quot;Switchretain 1&quot;.  That will make it so HA gets the last state from the door sensor after a reboot. &#xA;#2 - pick an unused GPIO pin on the Sonoff SV and set it as &quot;Relay2&quot;.  Use D4 or D5, not D1 or D3. That should stop the reed switch from triggering the relay.  I haven&#x27;t had to do this, but I think it may be because I&#x27;m using an older version of Tasmota. &#xA;#3 - in the Tasmota Console type &quot;Powerretain 1&quot;. That will stop the relay from randomly triggering when the Sonoff disconnects and reconnects to the MQTT broker. &#xA;&#xA;I know I went kinda fast in this one.  Everything you need is here. &#xA;&#xA;To Smarten up your garage doors you&#x2019;ll need:&#xA;Sonoff SV https://www.itead.cc/sonoff-sv.html&#xA;Reed Switch http://a.co/6qMTS35&#xA;USB cord and wall plug or some other power adapter&#xA;Jumper wires http://a.co/0htfCkL&#xA;Soap dish https://www.walmart.com/ip/iGo-Travel-Soap-Holder/13814222&#xA;There is soldering involved. No way around it on this one &#xA;Garage SV setup&#xA;Open sonoff.ino&#xA;Set a project name and your Wifi and MQTT info in user_config.h&#xA;Upload Tasmota&#xA;Find the IP address of your new Tasmotized Sonoff (you can look in your router)&#xA;Put the Sonoff IP address in your browser, go to Configuration Configure Module and and change the Module Type to Sonoff SV. Save and it&#x2019;ll restart. &#xA;Go back into Configure Module and set GPIO 14 to Switch2 save and it&#x2019;ll restart again&#xA;Click Console and type: switchmode1 0 and then switchmode2 2, restart one more time&#xA;Now we&#x2019;ve got some work to do in Home Assistant&#xA;Open configuration.yaml&#xA;Make a heading called &#x201C;cover:&#x201D; and paste these lines&#xA;&#xA;cover:&#xA;  - platform: mqtt&#xA;    name: &quot;test&quot;&#xA;    state_topic: &quot;cmnd/2/POWER2&quot;&#xA;    command_topic: &quot;cmnd/sonoffSV04/POWER&quot;&#xA;    payload_open: &quot;ON&quot;&#xA;    payload_close: &quot;ON&quot;&#xA;    payload_stop: &quot;ON&quot;&#xA;    state_open: &quot;ON&quot;&#xA;    state_closed: &quot;OFF&quot;&#xA;    optomistic: false&#xA;    retain: false&#xA;Under Customize: set the device class and give it a friendly name&#xA;    cover.test:&#xA;      device_class: garage&#xA;      friendly_name: Justin Garage&#xA;&#xA;If you want to make a card that says Garage Doors instead of Cover then open your groups.yaml.  If you don&#x2019;t have one just create and new empty file with that name and past these lines. &#xA;&#xA;    garage_doors:&#xA;      name: Garage Doors&#xA;      view: no&#xA;      control: hidden&#xA;      icon: mdi:garage&#xA;      entities:&#xA;        - cover.test&#xA;&#xA;Save both config and groups. In Home Assistant UI check the config and restart. &#xA;Now go to the Automation editor, make a new automation. The trigger is the MQTT topic that fires whenever the relay is turned ON. The action is to turn it back off after one second. Save and reload Automations. &#xA;Now the hardware setup:&#xA;To isolate the power to the ESP chip from what&#x2019;s being switched by the relay, use a small screwdriver to pop the 2 resistors. &#xA;Solder 2 lengths of small wire, one on the Input &#x2B; and one on the output &#x2B;, these wires will connect to the switch contacts on your garage door motor. &#xA;Connect female end of jumper wires to GPIO 14 and Ground. These are going to the reed switch and will tell you if the garage is open or closed. &#xA;Use a USB cable for power. The red wire is &#x2B; and the uncovered wire and the outer metal sheath are negative. &#xA;Connect those to female jumpers and plug them into &#x2B; and - for the ESP chip. &#xA;Test:&#xA;Lay it out. Connect the reed switch, power up the board, and open Home Assistant. &#xA;Move the magnet to test the reed switch &#xA;Click the open/close buttons to check the relay. &#xA;If it all works it&#x2019;s time to install&#xA;Install:&#xA;I put mine up near the garage motor. You don&#x2019;t have to do it this way. &#xA;Mount the reed switch. I put mine on the track and the magnet on the top of the door.  Took a few tries to find something that would keep them connected. There&#x2019;s a lot of motion on that track. &#xA;Find the contacts for your open/close button. Connect the wire from the input side of the relay to one contact, and the wire from the output side to the other. &#xA;On my garage door those wires are 12v.&#xA;Connect the &#x2B;/- jumpers from the USB cord, for power to the ESP, and plug it in. &#xA;You&#x2019;re done!"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.youtube.com/watch?v=QMepwpyjMCY"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - $5 DIY &quot;Smart&quot; Garage Door Opener using Sonoff SV</title>
<div class="readable">
        <h1>$5 DIY &quot;Smart&quot; Garage Door Opener using Sonoff SV</h1>
            <div>by DrZzs</div>
            <div>Watching time: 5 minutes</div>
        <div>Posted here: 19 Aug 2020</div>
        <p><a href="https://www.youtube.com/watch?v=QMepwpyjMCY">https://www.youtube.com/watch?v=QMepwpyjMCY</a></p>
        <iframe allowFullScreen="allowFullScreen" src="https://www.youtube-nocookie.com/embed/QMepwpyjMCY?ecver=1&amp;iv_load_policy=1&amp;yt:stretch=16:9&amp;autohide=1&amp;color=red&amp;width=980" width="980" height="600" allowtransparency="true" frameborder="0"></iframe>
        <br />
        <p style="text-align:left">
            READ THIS UPDATE!!!! 
Tasmota updates have changed some necessary settings!
Here's what you need now:  (Thanks Chris Norton)
Switchretain 1
Powerretain 1
switchtopic2 garagestate
switchmode1 0
switchmode2 2

GPIO 14 to 10 Switch2

GPIO 4 to 22 Relay2


cover.yaml

  - platform: mqtt
    name: "Sonoff SV Garage"
    state_topic: "cmnd/garagestate/POWER2"
    command_topic: "cmnd/sonoffsv01/POWER"
    payload_open: "ON"
    payload_close: "ON"
    payload_stop: "ON"
    state_open: "ON"
    state_closed: "OFF"
    optimistic: false

customize.yaml
   
    cover.sonoff_sv_garage:
      device_class: garage
      friendly_name: Garage 

group.yaml

  Garage Door:
    name: Garage Door
    view: no
    control: hidden
    icon: mdi:garage
    entities:
      - cover.sonoff_sv_garage


just thought I’d share the full details of a sonoff sv garage switch with 6.2.1 firmware. 

A few common problems people have can be solved by:
#1 - in the Tasmota Console, type "Switchretain 1".  That will make it so HA gets the last state from the door sensor after a reboot. 
#2 - pick an unused GPIO pin on the Sonoff SV and set it as "Relay2".  Use D4 or D5, not D1 or D3. That should stop the reed switch from triggering the relay.  I haven't had to do this, but I think it may be because I'm using an older version of Tasmota. 
#3 - in the Tasmota Console type "Powerretain 1". That will stop the relay from randomly triggering when the Sonoff disconnects and reconnects to the MQTT broker. 

I know I went kinda fast in this one.  Everything you need is here. 

To Smarten up your garage doors you’ll need:
Sonoff SV https://www.itead.cc/sonoff-sv.html
Reed Switch http://a.co/6qMTS35
USB cord and wall plug or some other power adapter
Jumper wires http://a.co/0htfCkL
Soap dish https://www.walmart.com/ip/iGo-Travel-Soap-Holder/13814222
There is soldering involved. No way around it on this one 
Garage SV setup
Open sonoff.ino
Set a project name and your Wifi and MQTT info in user_config.h
Upload Tasmota
Find the IP address of your new Tasmotized Sonoff (you can look in your router)
Put the Sonoff IP address in your browser, go to Configuration Configure Module and and change the Module Type to Sonoff SV. Save and it’ll restart. 
Go back into Configure Module and set GPIO 14 to Switch2 save and it’ll restart again
Click Console and type: switchmode1 0 and then switchmode2 2, restart one more time
Now we’ve got some work to do in Home Assistant
Open configuration.yaml
Make a heading called “cover:” and paste these lines

cover:
  - platform: mqtt
    name: "test"
    state_topic: "cmnd/2/POWER2"
    command_topic: "cmnd/sonoffSV04/POWER"
    payload_open: "ON"
    payload_close: "ON"
    payload_stop: "ON"
    state_open: "ON"
    state_closed: "OFF"
    optomistic: false
    retain: false
Under Customize: set the device class and give it a friendly name
    cover.test:
      device_class: garage
      friendly_name: Justin Garage

If you want to make a card that says Garage Doors instead of Cover then open your groups.yaml.  If you don’t have one just create and new empty file with that name and past these lines. 

    garage_doors:
      name: Garage Doors
      view: no
      control: hidden
      icon: mdi:garage
      entities:
        - cover.test

Save both config and groups. In Home Assistant UI check the config and restart. 
Now go to the Automation editor, make a new automation. The trigger is the MQTT topic that fires whenever the relay is turned ON. The action is to turn it back off after one second. Save and reload Automations. 
Now the hardware setup:
To isolate the power to the ESP chip from what’s being switched by the relay, use a small screwdriver to pop the 2 resistors. 
Solder 2 lengths of small wire, one on the Input + and one on the output +, these wires will connect to the switch contacts on your garage door motor. 
Connect female end of jumper wires to GPIO 14 and Ground. These are going to the reed switch and will tell you if the garage is open or closed. 
Use a USB cable for power. The red wire is + and the uncovered wire and the outer metal sheath are negative. 
Connect those to female jumpers and plug them into + and - for the ESP chip. 
Test:
Lay it out. Connect the reed switch, power up the board, and open Home Assistant. 
Move the magnet to test the reed switch 
Click the open/close buttons to check the relay. 
If it all works it’s time to install
Install:
I put mine up near the garage motor. You don’t have to do it this way. 
Mount the reed switch. I put mine on the track and the magnet on the top of the door.  Took a few tries to find something that would keep them connected. There’s a lot of motion on that track. 
Find the contacts for your open/close button. Connect the wire from the input side of the relay to one contact, and the wire from the output side to the other. 
On my garage door those wires are 12v.
Connect the +/- jumpers from the USB cord, for power to the ESP, and plug it in. 
You’re done!
        </p>
</div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>