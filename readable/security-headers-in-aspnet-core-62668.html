<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Security headers in ASP.NET Core - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Security headers in ASP.NET Core - linksfor.dev(s)"/>
    <meta property="article:author" content="G&#xE9;rald Barr&#xE9;"/>
    <meta property="og:description" content="Security Headers&#xA;Strict-Transport-Security&#xA;HTTP Strict Transport Security (HSTS) protect websites against man-in-the-middle attacks by indicating the browser to&#xA;access the website using HTTPS instead of using HTTP.&#xA;https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security&#xA;X-Frame-Options&#xA;The X-Frame-Options HTTP response header can be used to indicate whether or not a browser&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.meziantou.net/security-headers-in-asp-net-core.htm"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Security headers in ASP.NET Core</title>
<div class="readable">
        <h1>Security headers in ASP.NET Core</h1>
            <div>by G&#xE9;rald Barr&#xE9;</div>
            <div>Reading time: 9-12 minutes</div>
        <div>Posted here: 10 Jun 2020</div>
        <p><a href="https://www.meziantou.net/security-headers-in-asp-net-core.htm">https://www.meziantou.net/security-headers-in-asp-net-core.htm</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div itemprop="articleBody"><nav><ul><li><a href="#security-headers">Security Headers</a><ul><li><a href="#strict-transport-sec">Strict-Transport-Security</a></li><li><a href="#x-frame-options">X-Frame-Options</a></li><li><a href="#x-permitted-cross-do">X-Permitted-Cross-Domain-Policies</a></li><li><a href="#x-xss-protection">X-XSS-Protection</a></li><li><a href="#x-content-type-optio">X-Content-Type-Options</a></li><li><a href="#referrer-policy">Referrer-Policy</a></li><li><a href="#feature-policy">Feature-Policy</a></li><li><a href="#expect-ct">Expect-CT</a></li><li><a href="#content-security-pol-0984f6">Content-Security-Policy</a></li></ul></li><li><a href="#asp-net-core-middlew">ASP.NET Core middleware</a></li><li><a href="#validation">Validation</a></li></ul></nav><h3 id="strict-transport-sec"><a href="#strict-transport-sec">##</a>Strict-Transport-Security</h3><p>HTTP Strict Transport Security (HSTS) protect websites against man-in-the-middle attacks by indicating the browser to access the website using HTTPS instead of using HTTP.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security</a></p><h3 id="x-frame-options"><a href="#x-frame-options">##</a>X-Frame-Options</h3><p>The <code>X-Frame-Options</code> HTTP response header can be used to indicate whether or not a browser should be allowed to render a page in a <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code> or <code>&lt;object&gt;</code>. Sites can use this to avoid clickjacking attacks, by ensuring that their content is not embedded into other sites.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</a></p><h3 id="x-permitted-cross-do"><a href="#x-permitted-cross-do">##</a>X-Permitted-Cross-Domain-Policies</h3><p>The <code>X-Permitted-Cross-Domain-Policies</code> HTTP response header can be used to indicate whether or not an Adobe products such as Adobe Reader should be allowed to render a page. Sites can use this to avoid clickjacking attacks, by ensuring that their content is not embedded into other applications.</p><p><a href="https://www.adobe.com/devnet-docs/acrobatetk/tools/AppSec/xdomain.html">https://www.adobe.com/devnet-docs/acrobatetk/tools/AppSec/xdomain.html</a></p><h3 id="x-xss-protection"><a href="#x-xss-protection">##</a>X-XSS-Protection</h3><p>The HTTP <code>X-XSS-Protection</code> response header is a feature that stops pages from loading when they detect reflected cross-site scripting (XSS) attacks. Although these protections are largely unnecessary in modern browsers when sites implement a strong <code>Content-Security-Policy</code> that disables the use of inline JavaScript (<code>'unsafe-inline'</code>), they can still provide protections for users of older web browsers that don't yet support CSP.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection</a></p><h3 id="x-content-type-optio"><a href="#x-content-type-optio">##</a>X-Content-Type-Options</h3><p>The <code>X-Content-Type-Options</code> response header is a marker used by the server to indicate that the MIME types advertised in the <code>Content-Type</code> headers should not be changed and be followed. This is a way to opt out of MIME type sniffing, or, in other words, to say that the MIME types are deliberately configured.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options</a></p><h3 id="referrer-policy"><a href="#referrer-policy">##</a>Referrer-Policy</h3><p>The <code>Referrer-Policy</code> header controls how much referrer information (sent via the <code>Referer</code> header) should be included with requests. This may prevent information disclosure as URLs may contains sensitive data.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy</a></p><h3 id="feature-policy"><a href="#feature-policy">##</a>Feature-Policy</h3><p>The <code>Feature-Policy</code> header provides a mechanism to allow and deny the use of browser features in its own frame, and in content within any <code>&lt;iframe&gt;</code> elements in the document. It can prevent the use of sensible APIs such as microphone, or it can help fixing performance issues such as using oversized images.</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</a></p><h3 id="expect-ct"><a href="#expect-ct">##</a>Expect-CT</h3><p>The <code>Expect-CT</code> header lets sites opt in to reporting and/or enforcement of <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">Certificate Transparency</a> requirements, to prevent the use of misissued certificates for that site from going unnoticed. This help detecting man-in-the-middle attacks by someone that could generate a certificate for your domain. Cloudflare has a service to monitor certificate generation: <a href="https://blog.cloudflare.com/introducing-certificate-transparency-monitoring/">Introducing Certificate Transparency Monitoring</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT</a></p><h3 id="content-security-pol-0984f6"><a href="#content-security-pol-0984f6">##</a>Content-Security-Policy</h3><p>The <code>Content-Security-Policy</code> response header allows web site administrators to control resources the user agent is allowed to load for a given page. With a few exceptions, policies mostly involve specifying server origins and script endpoints. This helps guard against cross-site scripting attacks (XSS).</p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></p><h2 id="asp-net-core-middlew"><a href="#asp-net-core-middlew">#</a>ASP.NET Core middleware</h2><p>In ASP.NET Core, you can set the headers for every requests using a middleware. ASP.NET Core provides a middleware to set the HSTS headers when needed and redirecting to https. You'll have to set other security headers manually.</p><p>Note that you'll have to adapt the parameters depending on the features your application uses.</p><pre><code><span>public</span> <span>class</span> <span>Startup</span>
<span>{</span>
    <span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
    <span>{</span>
        services<span>.</span><span>AddRazorPages</span><span>(</span><span>)</span><span>;</span>

        <span>// Configure HSTS</span>
        <span>// https://aka.ms/aspnetcore-hsts</span>
        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security</span>
        services<span>.</span><span>AddHsts</span><span>(</span>options <span>=&gt;</span>
        <span>{</span>
            options<span>.</span>MaxAge <span>=</span> TimeSpan<span>.</span><span>FromDays</span><span>(</span><span>90</span><span>)</span><span>;</span>
            options<span>.</span>IncludeSubDomains <span>=</span> <span>true</span><span>;</span>
            options<span>.</span>Preload <span>=</span> <span>true</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>

        <span>// Configure HTTPS redirection</span>
        services<span>.</span><span>AddHttpsRedirection</span><span>(</span>options <span>=&gt;</span>
        <span>{</span>
            options<span>.</span>RedirectStatusCode <span>=</span> StatusCodes<span>.</span>Status301MovedPermanently<span>;</span>
            options<span>.</span>HttpsPort <span>=</span> <span>443</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span><span>void</span></span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
    <span>{</span>
        <span>if</span> <span>(</span><span>!</span>env<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
        <span>{</span>
            <span>// HSTS should only be enabled on production, not on localhost</span>
            app<span>.</span><span>UseHsts</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>

        <span>// Add other security headers</span>
        app<span>.</span><span><span>UseMiddleware</span><span><span>&lt;</span>SecurityHeadersMiddleware<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

        <span>// Redirect http to https</span>
        app<span>.</span><span>UseHttpsRedirection</span><span>(</span><span>)</span><span>;</span>

        app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
        <span>{</span>
            endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

<span>public</span> <span>sealed</span> <span>class</span> <span>SecurityHeadersMiddleware</span>
<span>{</span>
    <span>private</span> <span>readonly</span> <span>RequestDelegate</span> _next<span>;</span>

    <span>public</span> <span>SecurityHeadersMiddleware</span><span>(</span><span>RequestDelegate</span> next<span>)</span>
    <span>{</span>
        _next <span>=</span> next<span>;</span>
    <span>}</span>

    <span>public</span> <span>Task</span> <span>Invoke</span><span>(</span><span>HttpContext</span> context<span>)</span>
    <span>{</span>
        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy</span>
        <span>// TODO Change the value depending of your needs</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"referrer-policy"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"strict-origin-when-cross-origin"</span><span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"x-content-type-options"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"nosniff"</span><span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"x-frame-options"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"DENY"</span><span>)</span><span>)</span><span>;</span>

        <span>// https://security.stackexchange.com/questions/166024/does-the-x-permitted-cross-domain-policies-header-have-any-benefit-for-my-websit</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"X-Permitted-Cross-Domain-Policies"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"none"</span><span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"x-xss-protection"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"1; mode=block"</span><span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT</span>
        <span>// You can use https://report-uri.com/ to get notified when a misissued certificate is detected</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"Expect-CT"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span><span>"max-age=0, enforce, report-uri="https://example.report-uri.com/r/d/ct/enforce""</span><span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</span>
        <span>// https://github.com/w3c/webappsec-feature-policy/blob/master/features.md</span>
        <span>// https://developers.google.com/web/updates/2018/06/feature-policy</span>
        <span>// TODO change the value of each rule and check the documentation to see if new features are available</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"Feature-Policy"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span>
            <span>"accelerometer 'none';"</span> <span>+</span>
            <span>"ambient-light-sensor 'none';"</span> <span>+</span>
            <span>"autoplay 'none';"</span> <span>+</span>
            <span>"battery 'none';"</span> <span>+</span>
            <span>"camera 'none';"</span> <span>+</span>
            <span>"display-capture 'none';"</span> <span>+</span>
            <span>"document-domain 'none';"</span> <span>+</span>
            <span>"encrypted-media 'none';"</span> <span>+</span>
            <span>"execution-while-not-rendered 'none';"</span> <span>+</span>
            <span>"execution-while-out-of-viewport 'none';"</span> <span>+</span>
            <span>"gyroscope 'none';"</span> <span>+</span>
            <span>"magnetometer 'none';"</span> <span>+</span>
            <span>"microphone 'none';"</span> <span>+</span>
            <span>"midi 'none';"</span> <span>+</span>
            <span>"navigation-override 'none';"</span> <span>+</span>
            <span>"payment 'none';"</span> <span>+</span>
            <span>"picture-in-picture 'none';"</span> <span>+</span>
            <span>"publickey-credentials-get 'none';"</span> <span>+</span>
            <span>"sync-xhr 'none';"</span> <span>+</span>
            <span>"usb 'none';"</span> <span>+</span>
            <span>"wake-lock 'none';"</span> <span>+</span>
            <span>"xr-spatial-tracking 'none';"</span>
            <span>)</span><span>)</span><span>;</span>

        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</span>
        <span>// https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</span>
        <span>// TODO change the value of each rule and check the documentation to see if new rules are available</span>
        context<span>.</span>Response<span>.</span>Headers<span>.</span><span>Add</span><span>(</span><span>"Content-Security-Policy"</span><span>,</span> <span>new</span> <span>StringValues</span><span>(</span>
            <span>"base-uri 'none';"</span> <span>+</span>
            <span>"block-all-mixed-content;"</span> <span>+</span>
            <span>"child-src 'none';"</span> <span>+</span>
            <span>"connect-src 'none';"</span> <span>+</span>
            <span>"default-src 'none';"</span> <span>+</span>
            <span>"font-src 'none';"</span> <span>+</span>
            <span>"form-action 'none';"</span> <span>+</span>
            <span>"frame-ancestors 'none';"</span> <span>+</span>
            <span>"frame-src 'none';"</span> <span>+</span>
            <span>"img-src 'none';"</span> <span>+</span>
            <span>"manifest-src 'none';"</span> <span>+</span>
            <span>"media-src 'none';"</span> <span>+</span>
            <span>"object-src 'none';"</span> <span>+</span>
            <span>"sandbox;"</span> <span>+</span>
            <span>"script-src 'none';"</span> <span>+</span>
            <span>"script-src-attr 'none';"</span> <span>+</span>
            <span>"script-src-elem 'none';"</span> <span>+</span>
            <span>"style-src 'none';"</span> <span>+</span>
            <span>"style-src-attr 'none';"</span> <span>+</span>
            <span>"style-src-elem 'none';"</span> <span>+</span>
            <span>"upgrade-insecure-requests;"</span> <span>+</span>
            <span>"worker-src 'none';"</span>
            <span>)</span><span>)</span><span>;</span>

        <span>return</span> <span>_next</span><span>(</span>context<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><h2 id="validation"><a href="#validation">#</a>Validation</h2><p>You can check you have correctly set the security headers by using the following service: <a href="https://securityheaders.com/">https://securityheaders.com</a></p><p><img src="https://www.meziantou.net/assets/security-headers-1.png?v=69512eae&amp;utm_medium=social&amp;utm_source=web" width="743" height="624" srcset="/assets/security-headers-1-th-w500-h0.png?v=2a238faf&amp;utm_medium=social&amp;utm_source=web 500w,/assets/security-headers-1.png?v=69512eae&amp;utm_medium=social&amp;utm_source=web 743w" sizes="100vw"></p> <p>Do you have a question or a suggestion about this post? <a href="https://www.meziantou.net/contact.htm?utm_medium=social&amp;utm_source=web">Contact me!</a></p></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>