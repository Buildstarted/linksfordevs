<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Build a .NET library with GitHub Actions - Alessio Franceschelli -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Build a .NET library with GitHub Actions - Alessio Franceschelli</h1>
    <div class="ac ae af ag ah cz aj ak"><p id="339a" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">GitHub Actions are a great free tool to have continuous integration of your opensource .NET library for free, directly into GitHub, saving you from setting up other tools and linking accounts. Setting it up can feel a daunting task but, if you follow this guide you are going to be able to set it up in 10 minutes!</p><h2 id="48f4" class="ga">What will I achieve</h2><p id="e3b6" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz">Following these steps, you will be able to build and run tests, targeting multiple versions of <code class="gr gs gt gu gv b">.NET Core</code>, reporting then the status to the Pull Requests. Finally, when you release a new version (either creating a release on GitHub or pushing a new tag), it will prepare your <code class="gr gs gt gu gv b">NuGet</code> packages and upload them on <a href="https://www.nuget.org/" class="at cg gw gx gy gz">NuGet.org</a>.</p><figure class="hb hc hd he hf hg cl cm paragraph-image"><div class="hh hi hj hk ak"><div class="cl cm ha"><div class="hq r hj gr"><div class="hr r"><div class="hl hm cp t u hn ak eh ho hp"><img class="cp t u hn ak hs ht hu" src="https://miro.medium.com/max/60/1*4tS6nNB7NXwuZBPB3qE1Fg.png?q=20" width="2124"></div><img class="hl hm cp t u hn ak hv" width="2124"></div></div></div></div><figcaption class="bo eg hw hx hy cn cl cm hz ia bj ef">GitHub Actions</figcaption></figure><h2 id="766e" class="ga">What are the prerequisites</h2><p id="c563" class="fm fn dc bk fo b fp gm fr gn ft go fv gp fx gq fz">This guide assumes that you are building either .NET Standard or .NET Core libraries. Tests are run multitargeting multiple versions of .NET Core, although that is not a requirement.</p><p id="e9bb" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">It also assumes that to release new versions of the library you will create a new tag (it can be done from the <code class="gr gs gt gu gv b">Releases</code> tab on <code class="gr gs gt gu gv b">GitHub</code>) with the version number as tag name, e.g. <code class="gr gs gt gu gv b">1.2.3</code>. To release a prerelease version you will use a prerelease name as <code class="gr gs gt gu gv b">tag</code>, e.g. <code class="gr gs gt gu gv b">1.2.3-preview.1</code>.</p><p id="bec2" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">As this build step will rely on <code class="gr gs gt gu gv b">dotnet pack</code> to package your libraries, you need to make sure you are excluding all the test project, samples and other libraries you don&apos;t want to package and publish to NuGet adding the property <code class="gr gs gt gu gv b">&lt;IsPackable&gt;false&lt;/IsPackable&gt;</code> to the <code class="gr gs gt gu gv b">csproj</code>s or a <code class="gr gs gt gu gv b">Directory.Build.props</code> file.</p><p id="e4a4" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz"><em class="ib">Note: when using a </em><code class="gr gs gt gu gv b"><em class="ib">Directory.Build.props</em></code><em class="ib"> file, as these builds will run on Linux agents, the casing in the file name matters!</em></p><p id="b31f" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Here is a sample <code class="gr gs gt gu gv b">csproj</code> file for a project to not be generated as <code class="gr gs gt gu gv b">NuGet</code> package:</p><pre class="hb hc hd he hf ic id ie"><span id="d153" class="if gb dc bk gv b eg ig ih r ii">&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;</span><div id="c38b" class="if"> &lt;PropertyGroup&gt; &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt; &lt;IsPackable&gt;false&lt;/IsPackable&gt;<p> &lt;/PropertyGroup&gt;</p></div><div id="81fe" class="if"> &lt;ItemGroup&gt; &lt;PackageReference Include=&quot;Microsoft.Extensions.Logging.Abstractions&quot; Version=&quot;3.0.1&quot; /&gt;<p> &lt;/ItemGroup&gt;</p></div><span id="d9e9" class="if gb dc bk gv b eg ij ik il im in ih r ii">&lt;/Project&gt;</span></pre><h2 id="8ebb" class="ga">Ok, show me the code</h2><figure class="hb hc hd he hf hg"></figure><p id="3d7b" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Create a file in a folder <code class="gr gs gt gu gv b">.github/workflows</code> named <code class="gr gs gt gu gv b">build.yml</code> with the following content:</p><p id="64cb" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Then go into your <a href="https://www.nuget.org/" class="at cg gw gx gy gz">NuGet.org</a> account, navigate to <a href="https://www.nuget.org/account/apikeys" class="at cg gw gx gy gz">API keys</a> and create a new key. If for example your project is called <code class="gr gs gt gu gv b">MELT</code> and it is Generating a package called <code class="gr gs gt gu gv b">MELT</code> and one called <code class="gr gs gt gu gv b">MELT.AspNetCore</code>, you could call the key <code class="gr gs gt gu gv b">GitHub Actions MELT</code> and setup the glob pattern as <code class="gr gs gt gu gv b">MELT*</code>.</p><p id="9631" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz"><em class="ib">Note there is no </em><code class="gr gs gt gu gv b"><em class="ib">.</em></code><em class="ib"> before the </em><code class="gr gs gt gu gv b"><em class="ib">*</em></code><em class="ib">, otherwise, the </em><code class="gr gs gt gu gv b"><em class="ib">MELT</em></code><em class="ib"> base package will not match.</em></p><figure class="hb hc hd he hf hg cl cm paragraph-image"><div class="hh hi hj hk ak"><div class="cl cm ip"><div class="hq r hj gr"><div class="iq r"><div class="hl hm cp t u hn ak eh ho hp"><img class="cp t u hn ak hs ht hu" src="https://miro.medium.com/max/60/1*6RlBj596c1OjuEjiOXAJnA.png?q=20" width="2344"></div><img class="hl hm cp t u hn ak hv" width="2344"></div></div></div></div><figcaption class="bo eg hw hx hy cn cl cm hz ia bj ef">Create a API key on NuGet.org</figcaption></figure><p id="6bc2" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Then go into the <code class="gr gs gt gu gv b">Settings</code> of your GitHub project, then on the left navigation menu select <code class="gr gs gt gu gv b">Secrets</code>, then <code class="gr gs gt gu gv b">Add a new key</code> and name the key <code class="gr gs gt gu gv b">NUGET_TOKEN</code>.</p><figure class="hb hc hd he hf hg cl cm paragraph-image"><div class="hh hi hj hk ak"><div class="cl cm ir"><div class="hq r hj gr"><div class="is r"><div class="hl hm cp t u hn ak eh ho hp"><img class="cp t u hn ak hs ht hu" src="https://miro.medium.com/max/60/1*-WJG14zAF6QNHj0641bpng.png?q=20" width="1986"></div><img class="hl hm cp t u hn ak hv" width="1986"></div></div></div></div><figcaption class="bo eg hw hx hy cn cl cm hz ia bj ef">Add a secret to GitHub</figcaption></figure><p id="19a4" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Done!</p><p id="08dc" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">Now you just have to push the <code class="gr gs gt gu gv b">build.yml</code> to master and, after that, all the new PR (or new pushes to pre-existing ones) will start to build and attach the status to the PR.</p><p id="232e" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">When a PR is merged to master, it will also create the packages (with a temporary pre-release version, not strictly following SemVer however that doesn&#x2019;t matter as this packages are not published) and upload them as artifacts in the build results in <code class="gr gs gt gu gv b">GitHub Actions</code> so that you can check which packages have been created and download them if you need to verify something.</p><figure class="hb hc hd he hf hg cl cm paragraph-image"><div class="hh hi hj hk ak"><div class="cl cm it"><div class="hq r hj gr"><div class="iu r"><div class="hl hm cp t u hn ak eh ho hp"><img class="cp t u hn ak hs ht hu" src="https://miro.medium.com/max/60/1*0ecMFMbFST38pMb8-Hf0Mg.png?q=20" width="2110"></div><img class="hl hm cp t u hn ak hv" width="2110"></div></div></div></div><figcaption class="bo eg hw hx hy cn cl cm hz ia bj ef">Download artifacts from GitHub Actions</figcaption></figure><p id="a611" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz">If you are happy, you can then create a release, so that the actual packages with the correct version number will be generated and uploaded to <a href="https://www.nuget.org/" class="at cg gw gx gy gz">NuGet.org</a>.</p><figure class="hb hc hd he hf hg cl cm paragraph-image"><div class="hh hi hj hk ak"><div class="cl cm iv"><div class="hq r hj gr"><div class="iw r"><div class="hl hm cp t u hn ak eh ho hp"><img class="cp t u hn ak hs ht hu" src="https://miro.medium.com/max/60/1*g4KpvudfEDyxldZ_8_-Ilw.png?q=20" width="1526"></div><img class="hl hm cp t u hn ak hv" width="1526"></div></div></div></div><figcaption class="bo eg hw hx hy cn cl cm hz ia bj ef">GitHub create release</figcaption></figure><p id="cdd6" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz"><em class="ib">Happy building!</em></p></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>