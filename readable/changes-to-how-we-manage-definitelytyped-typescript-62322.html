<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Changes to How We Manage DefinitelyTyped | TypeScript - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Changes to How We Manage DefinitelyTyped | TypeScript - linksfor.dev(s)"/>
    <meta property="article:author" content="Orta TheroxEngineer on the TypeScript CompilerFollow"/>
    <meta property="og:description" content="Definitely Typed is now allowing contributors to self-merge their pull requests after a reviewer has accepted their changes."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/typescript/changes-to-how-we-manage-definitelytyped/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Changes to How We Manage DefinitelyTyped | TypeScript</title>
<div class="readable">
        <h1>Changes to How We Manage DefinitelyTyped | TypeScript</h1>
            <div>by Orta TheroxEngineer on the TypeScript CompilerFollow</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 01 Jun 2020</div>
        <p><a href="https://devblogs.microsoft.com/typescript/changes-to-how-we-manage-definitelytyped/">https://devblogs.microsoft.com/typescript/changes-to-how-we-manage-definitelytyped/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://secure.gravatar.com/avatar/28e997da43c10d99aa99273b48efe8cf?s=58&amp;d=mm&amp;r=g" width="58" height="58" alt="Avatar"></p><p>Orta</p></div></div></div><p>May 29th, 2020</p><p>The <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank">Definitely Typed</a> repository on GitHub is now a regular fixture in GitHub’s annual <a href="https://octoverse.github.com/" target="_blank">Octoverse report</a> as one of the top 10 repos with the most contributors. If you haven’t heard of Definitely Typed, it’s a repository that holds type declaration files (<code><span>*.</span><span>d</span><span>.</span><span>ts</span></code> files) for thousands of JavaScript projects, and it’s likely you’ve seen the results of this repo in the form of the npm modules <code><span>@types</span><span>/</span><span>something</span></code>.</p><p>What started off as entirely community-driven effort became so critical to the TypeScript ecosystem that the TypeScript team committed to helping maintain Definitely Typed. The TypeScript team takes the responsibility of maintaining the Definitely Typed (DT) repo very seriously, and since <a href="https://github.com/Microsoft/TypeScript/issues/9184" target="_blank">mid 2016</a> the team has had a rotation where a member focuses on merging pull requests and repo up-keep for a week. We work with other Definitely Typed maintainers to handle about ~250 pull requests a week, and until last week we handled merging over 90% of these pull requests.</p><p>For the past year, we’ve been working on tooling to protect the stability of the Definitely Typed ecosystem to the point where we can offer a more streamlined experience when contributing to DT repo – definition owners can now help merge PRs to their modules!</p><h3>How did we get here?</h3><p>We have a few stability safety nets for Definitely Typed which gives the team more confidence in the robustness of the ecosystem</p><h4>We run performance and integration tests on every change.</h4><p>The performance tests check two things: whether the change increased the amount of memory to compile the files, and whether they would slow down editor operations like go-to-definition and code completion. Performance matters because we have seen changes in one library cause dramatic compiler time increases for a libraries which depend on it. By providing useful feedback during the pull request, maintainers can make well-informed decisions about whether these trade-offs are acceptable at the time.</p><p>The integration tests verify both:</p><ul><li>The shape of your exports roughly matches the shape of the exports of the JavaScript using <a href="https://github.com/DefinitelyTyped/dts-critic" target="_blank">dts-critic</a>, which gives everyone some more confidence that their types fit the JavaScript being represented.</li><li>That the change doesn’t break downstream DT libraries which depend on the libraries being changed.</li></ul><h4>TypeScript Development Verification.</h4><p>It’s possible that improvement to the TypeScript language can break the definitions in DT.<br> This could be a a natural part of improving the compiler’s control flow analysis, or by fixing bugs which a definition accidentally relied on.</p><p>The team does not want to release a new version of TypeScript and then discover that it breaks a significant amount of types in DT. There are two systems in place to protect this.</p><p>The first is that we <a href="https://github.com/microsoft/TypeScript/wiki/Triggering-TypeScript-Bot" target="_blank">made it easy to test all of the DT tests</a> against a work-in-progress pull request of the compiler.<br> If there are breaks in DT, then it is the responsibility of the author of the compiler pull request to send fixes to DT before the changes can be merged.</p><p>The second is that we run the DT tests against the <code><span>master</span></code> branch of TypeScript every night.</p><p>This helps the team catch issues early, and moves the responsibility of fixing issues to the people making language changes.</p><h4><a href="https://github.com/microsoft/dtslint" target="_blank">dtslint</a> powered testing on a per-module basis.</h4><p>Definitely Typed packages are always committed with “test” files. The tests are <code><span>.</span><span>ts</span></code> or <code><span>.</span><span>tsx</span></code> files which use the <code><span>.</span><span>d</span><span>.</span><span>ts</span></code> files that eventually get shipped to users. We recommend that a package’s tests start out with something similar to example code for the library to test core scenarios, and then get built up as new types are added to the <code><span>d</span><span>.</span><span>ts</span></code> files.</p><p>These tests can verify the <code><span>d</span><span>.</span><span>ts</span></code> accurately describes the JavaScript, and also that future changes don’t break older clients by accident.</p><p>With these systems in place, we can more easily scale to the number of PRs coming in every day while avoiding long-running delays. That’s why we recently enabled definition owners to pull in changes themselves!</p><h3>What Pull Requests Can Be Merged By Definition Owners?</h3><p>For any pull request to Definitely Typed there are 3 groups of interested parties:</p><ul><li>The DT maintainers who want to ensure the stability of the entire DT ecosystem</li><li>The definition owners who use the library and are interested in keeping the library up-to-date and well documented</li><li>People who are interested in the changes but have not requested to be a definition owner</li></ul><p>Historically, only the DT maintainers have had the ability to merge pull requests. Through <a href="https://github.com/DefinitelyTyped/dt-mergebot/" target="_blank">a new GitHub bot</a> we’ve given access to definition owners to merge their changes.</p><p>First up in deciding if a pull request can be merged by a definition owner, we divide the changes to DT into two major sub-groups:</p><ul><li>PRs which add new libraries, these will always need a DT maintainer to validate and are out of scope</li><li>PRs which edit existing libraries</li></ul><p>We can bucket changes to existing DT libraries depending on their ecosystem impact:</p><ul><li>PRs which affect extremely popular libraries like Node, React, Lodash or Jest</li><li>PRs which affect all the other libraries</li></ul><p>Changes to extremely popular libraries with over 5,000,000 downloads per month on npm cannot be merged by definition owners and still require a DT maintainer to validate changes. However, these changes are rare and most of the pull requests we receive are quick changes to smaller libraries</p><h3>When Can a Pull Request Be Merged By Its Author?</h3><p>After determining that a pull request is one which a Definition Owner could merge, our bot starts to walk the author through the process. We set up four conditions for a pull request to be merged:</p><ul><li>There are no merge conflicts</li><li>CI has passed tests for this library, and its dependents</li><li>There are corresponding test changes for any <code><span>*.</span><span>d</span><span>.</span><span>ts</span></code> changes</li><li>The most recent commit has an approved review by either a definition owner or a DT maintainer</li></ul><p>As the pull request evolves through these different stages there is a bot updating a comment which describes the current state of movement towards auto-merging.</p><p>We’ve tried to have the bot handle a lot of different states a pull request can be in and offer direct feedback on what to do next, providing links to the revised documentation for contributors.</p><p><a href="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/1.jpg" data-featherlight="image"> <img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/1.jpg" alt="Image 1" width="935" height="551" srcset="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/1.jpg 935w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/1-300x177.jpg 300w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/1-768x453.jpg 768w" sizes="(max-width: 935px) 100vw, 935px"> </a><br> <a href="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/2.jpg" data-featherlight="image"> <img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/2.jpg" alt="Image 2" width="935" height="551" srcset="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/2.jpg 935w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/2-300x177.jpg 300w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/2-768x453.jpg 768w" sizes="(max-width: 935px) 100vw, 935px"> </a><br> <a href="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/3.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/3.png" alt="Image 3" width="935" height="551" srcset="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/3.png 935w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/3-300x177.png 300w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/3-768x453.png 768w" sizes="(max-width: 935px) 100vw, 935px"> </a><br> <a href="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/4.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/4.png" alt="Image 4" width="935" height="551" srcset="https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/4.png 935w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/4-300x177.png 300w, https://devblogs.microsoft.com/typescript/wp-content/uploads/sites/11/2020/05/4-768x453.png 768w" sizes="(max-width: 935px) 100vw, 935px"> </a></p><p>We’re starting to see about 20 pull requests a day <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pulls?q=is%3Apr+label%3AMerge%3AAuto+is%3Aclosed" target="_blank">merged by the community</a> through this new system. The pull requests which are merged by definition owners are typically handled within a day, and aren’t blocked on the time of whoever is on rotation from the TypeScript team. For example, a <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/45032#issuecomment-635231194" target="_blank">bug was found in the type definition</a> for the module <a href="https://theme-ui.com/" target="_blank">theme-ui</a> – the <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/45114" target="_blank">PR to fix it</a> was published, reviewed by the definition owners and merged within an hour. This is a perfect example of why we refined the process.</p><p>When thinking about how we maintain such a busy repo, it’s a combination of careful application of automation and a lot of human effort. Definitely Typed is a massive community project with over 10,000 contributors, and we’re really proud of how far it has come, here’s to making the life easier for the next 10k contributors.</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>