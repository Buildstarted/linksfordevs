<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Scaling up Anime with Machine Learning and Smart Real Time Algorithms - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Scaling up Anime with Machine Learning and Smart Real Time Algorithms - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@crunchyroll_"/>
    <meta property="og:description" content="Authored By Chris Kennedy, Nick Fujita &amp; Michael Dale"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/crunchyroll/scaling-up-anime-with-machine-learning-and-smart-real-time-algorithms-2fb706ec56c0"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Scaling up Anime with Machine Learning and Smart Real Time Algorithms</title>
<div class="readable">
        <h1>Scaling up Anime with Machine Learning and Smart Real Time Algorithms</h1>
            <div>by https://medium.com/@crunchyroll_</div>
            <div>Reading time: 11-14 minutes</div>
        <div>Posted here: 29 May 2020</div>
        <p><a href="https://medium.com/crunchyroll/scaling-up-anime-with-machine-learning-and-smart-real-time-algorithms-2fb706ec56c0">https://medium.com/crunchyroll/scaling-up-anime-with-machine-learning-and-smart-real-time-algorithms-2fb706ec56c0</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><section><div><div><h2 id="5755">Authored By Chris Kennedy, Nick Fujita &amp; Michael Dale</h2><div><div><div><p><a rel="noopener" href="https://medium.com/@crunchyroll_?source=post_page-----2fb706ec56c0----------------------"><img alt="Crunchyroll" src="https://miro.medium.com/fit/c/96/96/2*dIfU4ov-RWL6hW0pYRMBhw.png" width="48" height="48"></a></p></div></div></div><p id="f100" data-selectable-paragraph="">The Crunchyroll catalog spans a massive amount of video content. Our published material dates back to when content was distributed on DVD or aired on standard definition TV at 480P all to way to current anime which is almost never produced at a higher resolution than 1080P. As displays are able to handle higher and higher resolutions and streaming platforms are able to handle variable internet speeds, what does this mean for modern-day anime fans? If you’re using Crunchyroll on 4K household televisions and 4K computer monitors, anime ends up being upscaled from its native resolution (again, a maximum of 1080P) up to your display’s resolution. This gets even more complicated if your internet bandwidth becomes constrained or if you want to download an episode for offline viewing at a smaller filesize to preserve space. In both cases, a lower resolution version of the original video file will be accessed and then will be upscaled to your device’s resolution through video decoding and rendering.</p><p id="49d2" data-selectable-paragraph="">This leaves us with a pretty fascinating challenge–how can we explore thoughtful up-scaling to improve the anime viewing experience? The anime fan and content encoding communities have already been hard at work beginning and exploring this question, and we at Crunchyroll have been paying attention. We wanted to explore some of the proposed solutions, namely pre-processing and real-time up-scaling. What follows are our initial findings.</p><p id="211d" data-selectable-paragraph="">As we look to improve the situation, it’s important to understand the current process. The majority of up-scaling uses efficient generic up-scaling algorithms like bilinear interpolation–essentially using mathematical equations to estimate and fill in visual data to account for the difference between the source video and a monitor’s resolution (<em>for more information on this and other related algorithms, check out the </em><a href="https://en.wikipedia.org/wiki/Comparison_gallery_of_image_scaling_algorithms" target="_blank" rel="noopener nofollow"><em>Wikipedia</em></a><em> page</em>). In most cases your browser or your mobile app will use bilinear or bicubic interpolation to upscale videos and images. These algorithms work by creating weighted values for pixels by comparing adjacent pixels.</p><figure><div><div><div><p><img src="https://miro.medium.com/max/58/0*g9b4z7yWBSVynXVK?q=20" width="288" height="297" role="presentation"></p><p><img width="288" height="297" srcset="https://miro.medium.com/max/552/0*g9b4z7yWBSVynXVK 276w, https://miro.medium.com/max/576/0*g9b4z7yWBSVynXVK 288w" sizes="288px" role="presentation" src="https://miro.medium.com/max/288/0*g9b4z7yWBSVynXVK"></p></div></div></div></figure><p id="7430" data-selectable-paragraph=""><em>A geometric visualization of bilinear interpolation. The product of the value at the desired point (black) and the entire area is equal to the sum of the products of the value at each corner and the partial area diagonally opposite the corner (corresponding colors). Source </em><a href="https://en.wikipedia.org/wiki/Bilinear_interpolation" target="_blank" rel="noopener nofollow"><em>Wikipedia</em></a></p><p id="be26" data-selectable-paragraph="">In 4k (and now 8K) TVs, there is a growing competitive landscape of “smart” scaling. Smart scaling techniques employ a process that occurs in real-time where the source video image is cropped into overlapping segments or patches, which are in tern mapped to corresponding higher resolution patches which are projected to the target output size. Since these algorithms are proprietary and often unique to particular manufacturers or televisions, a detailed comparison of them and their subjective impact on the quality of the anime viewing experience is well beyond the scope of our initial exploration, but it is an element that <em>could </em>be at play in your viewing experience, depending on your display and its configuration.</p><p id="b3f1" data-selectable-paragraph="">In any case, depending on the television capabilities does not <em>scale </em>well (excuse the pun), towards giving every user the best upscaled anime viewing experience possible on every device and platform.</p><p id="6831" data-selectable-paragraph="">We wanted to explore some practical approaches for Crunchyroll content. We explored two possible approaches from the anime up-scaling community; upscale as part of the encode and smart real-time upscaling.</p><p id="31c1" data-selectable-paragraph="">What you should know first is that we pursued two different types of upscaling: 1. upscaling that occurs on the video file level (which we will call the encode level) (before the file is even accessed for streaming) and 2. dynamic upscaling that occurs in real time as the file is being streamed. For upscaling on the encode level, we are using the software <a href="https://github.com/nagadomi/waifu2x" target="_blank" rel="noopener nofollow">Waifu2x</a>. Waifu2x is authored by GitHub user Nagadomi and inspired by SRCNN[<a href="https://arxiv.org/abs/1501.00092" target="_blank" rel="noopener nofollow">1</a>] (Super-Resolution Using Deep Convolutional Networks) techniques–applied machine learning used for upscaling images. It leverages a Convolutional Neural Network (CNN) model that compensates for kinds of details that are commonly lost as content is scaled up. It uses that model to predict and fill in the details as content is scaled to a resolution larger than its source.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*nAoQSAns1EewoTbp?q=20" width="1600" height="1226" role="presentation"></p><p><img width="1600" height="1226" srcset="https://miro.medium.com/max/552/0*nAoQSAns1EewoTbp 276w, https://miro.medium.com/max/1104/0*nAoQSAns1EewoTbp 552w, https://miro.medium.com/max/1280/0*nAoQSAns1EewoTbp 640w, https://miro.medium.com/max/1400/0*nAoQSAns1EewoTbp 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="fd7d" data-selectable-paragraph=""><em>Standard upscaled anime — image artifacting happens all the time as content is stretched to large format TVs.</em></p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*zBakxUYBsMHBC7TS?q=20" width="1600" height="1227" role="presentation"></p><p><img width="1600" height="1227" srcset="https://miro.medium.com/max/552/0*zBakxUYBsMHBC7TS 276w, https://miro.medium.com/max/1104/0*zBakxUYBsMHBC7TS 552w, https://miro.medium.com/max/1280/0*zBakxUYBsMHBC7TS 640w, https://miro.medium.com/max/1400/0*zBakxUYBsMHBC7TS 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="ac41" data-selectable-paragraph=""><em>Improved AI upscaled anime with Waifu2x, improves the look of anime on large high resolution displays.</em></p><p id="98ec" data-selectable-paragraph="">One such example of catalog content with lower resolution source is the first episode of <em>Naruto Shippuden</em>, “Homecoming.” It was released in February of 2007, and Crunchyroll’s source video for this content is at 480P resolution.</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*PXr-I7MpuzlzuGW_?q=20" width="600" height="400" role="presentation"></p><p><img width="600" height="400" srcset="https://miro.medium.com/max/552/0*PXr-I7MpuzlzuGW_ 276w, https://miro.medium.com/max/1104/0*PXr-I7MpuzlzuGW_ 552w, https://miro.medium.com/max/1200/0*PXr-I7MpuzlzuGW_ 600w" sizes="600px" role="presentation"></p></div></div></div></figure><p id="7fc2" data-selectable-paragraph="">A <em>closer look at default scaling approaches (notice the tearing and loss of fidelity) when up-scaling the source video.</em></p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*38NrreL_HmOTkynd?q=20" width="600" height="400" role="presentation"></p><p><img width="600" height="400" srcset="https://miro.medium.com/max/552/0*38NrreL_HmOTkynd 276w, https://miro.medium.com/max/1104/0*38NrreL_HmOTkynd 552w, https://miro.medium.com/max/1200/0*38NrreL_HmOTkynd 600w" sizes="600px" role="presentation"></p></div></div></div></figure><p id="22a4" data-selectable-paragraph=""><em>Waifu2x is able to retain quality and reduce encode / compression noise as the content is scaled.</em></p><p id="4275" data-selectable-paragraph="">For us to rollout these encodes to our fans (even in a limited experiment); it was important to obtain some objective measures of the quality gains by leveraging this technique. To test the upscale performance we had to establish benchmarks with assets that already included high resolution source videos. We downsampled (we took a source video at 720P resolution and made its resolution smaller) to 360P to represent the available quality of some of our early catalog titles; and then scaled up to 720P. We then compared the original 720P video to the videos that had been enlarged from 360P. We compared <strong>bilinear interpolation</strong>, <strong>bicubic interpolation,</strong> and <strong>Waifu2x</strong>. From these measurements, Waifu2x had significant gains towards accurate representation of the target material over traditional scaling techniques. An overview of what the scripting looks like for generation this data can be viewed <a href="https://gist.github.com/bitbytebit-cr/14121f92807295211f0f9e1be9f7e722" target="_blank" rel="noopener nofollow">here</a>.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*CbVMRnNTRGsCngeg?q=20" width="1254" height="1022" role="presentation"></p><p><img width="1254" height="1022" srcset="https://miro.medium.com/max/552/0*CbVMRnNTRGsCngeg 276w, https://miro.medium.com/max/1104/0*CbVMRnNTRGsCngeg 552w, https://miro.medium.com/max/1280/0*CbVMRnNTRGsCngeg 640w, https://miro.medium.com/max/1400/0*CbVMRnNTRGsCngeg 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="c9f3" data-selectable-paragraph=""><em>Comparing commonly used up-scaling algorithms to Waifu 2x. Peak signal-to-noise ratio (VMAF) measures the ratio between the maximum possible resolution of an image and the power of corrupting noise that would affect the image’s fidelity. Video multimethod Assessment Fusion is a newer quality metric that may more accurately reflect subjective viewer quality experiences.</em></p><p id="4bb3" data-selectable-paragraph="">The changes in image resolution from 1080P to 2160P (4K) are much more difficult to notice unless using very large displays. When you already have a very detailed 1080P source material, there is less opportunity to noticeably clean things up. The Waifu2x and traditional source scaling are often not noticeably different at 4k display per our comparison. With extreme zoom some deltas of bicubic interpolation vs Waifu2x start to be noticeable.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*BdyL0jwBo56THCGX?q=20" width="1069" height="544" role="presentation"></p><p><img width="1069" height="544" srcset="https://miro.medium.com/max/552/0*BdyL0jwBo56THCGX 276w, https://miro.medium.com/max/1104/0*BdyL0jwBo56THCGX 552w, https://miro.medium.com/max/1280/0*BdyL0jwBo56THCGX 640w, https://miro.medium.com/max/1400/0*BdyL0jwBo56THCGX 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="cd10" data-selectable-paragraph=""><em>Traditional upscale of 1080P to 2140P</em></p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*oeunkuwq_w4kU2Ck?q=20" width="1069" height="544" role="presentation"></p><p><img width="1069" height="544" srcset="https://miro.medium.com/max/552/0*oeunkuwq_w4kU2Ck 276w, https://miro.medium.com/max/1104/0*oeunkuwq_w4kU2Ck 552w, https://miro.medium.com/max/1280/0*oeunkuwq_w4kU2Ck 640w, https://miro.medium.com/max/1400/0*oeunkuwq_w4kU2Ck 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="3906" data-selectable-paragraph=""><em>Waifu2x 1080P -&gt; 2140P</em></p><p id="0ced" data-selectable-paragraph="">Notice smoother scaling on lines; but there’s much less dramatic of a shift than the 480P upscale, and only noticeable on a very large display. We may explore this in more depth in future efforts, but for current experiments on encode level upscale we focused on content with lower resolution source material.</p><p id="5e56" data-selectable-paragraph="">We are experimenting with this up scaled technique on a few pieces of our historically low resolution content. Accessing this content on any Crunchyroll supported platform will consume the higher quality versions of these encodes.</p><p id="640b" data-selectable-paragraph=""><a href="https://www.crunchyroll.com/naruto-shippuden/episode-1-homecoming-509768" target="_blank" rel="noopener nofollow">Naruto Shippuden — Episode 1</a></p><p id="9894" data-selectable-paragraph=""><a href="https://www.crunchyroll.com/naruto-shippuden/episode-33-the-new-target-509834" target="_blank" rel="noopener nofollow">Naruto Shippuden — Episode 33</a></p><p id="2f89" data-selectable-paragraph=""><a href="https://www.crunchyroll.com/blue-submarine-no-6/episode-1-blues-681095" target="_blank" rel="noopener nofollow">Blue Submarine №6 — Episode 1</a></p><p id="24d7" data-selectable-paragraph="">Waifu2x offers a solution at the video file level, but you will remember above that we were also exploring real time upscaling that happens as the file is being streamed (client level). For client level upscaling, GPU<strong> </strong><a href="https://github.com/bloc97/Anime4K" target="_blank" rel="noopener nofollow"><strong>Anime4k</strong></a> is a leading solution. Anime4k was built by GitHub user bloc97 and is a “state of the art real-time anime upscale algorithm that can be implemented in arbitrary programming languages”. In the case of web experience, a WebGL shader (shaders are computer programs traditionally used to produce shades on 3D objects, but are now used widely in video post-processing) is used to support real-time up scaling within a web browser at resolutions up to 4k / 2160p. Interestingly, because Crunchyroll leverages soft subtitles (subtitles that are overlaid onto the video instead of existing as part of the original video file), we leverage browser compositing to scale the video and subtitle displays separately where possible.</p><p id="68c0" data-selectable-paragraph="">Our video player update for the web experience allows for users to select the option to enable the anime4k filter. The experience even includes some basic controls on the filter. Unlike the small sample for Waifu2x which was restricted to the number of source video files we encoded with the program, this real time method can be applied to all content played with the Crunchyroll <a href="https://blog.ellation.com/velocity-crunchyrolls-universal-react-player-e70a61b6dfa7" target="_blank" rel="noopener nofollow">Velocity player</a> when you have a GPU and modern browser. Here are some screenshots of the experience:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*reF_Uv72clT9uGpi?q=20" width="1600" height="938" role="presentation"></p><p><img width="1600" height="938" srcset="https://miro.medium.com/max/552/0*reF_Uv72clT9uGpi 276w, https://miro.medium.com/max/1104/0*reF_Uv72clT9uGpi 552w, https://miro.medium.com/max/1280/0*reF_Uv72clT9uGpi 640w, https://miro.medium.com/max/1400/0*reF_Uv72clT9uGpi 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="c7a0" data-selectable-paragraph=""><em>Traditional upscale can be seen on the left, with the Anime4k upscale on the right. Notice some sharpening of edges which Anime4k is optimized for.</em></p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*necB1rsQAimOnUNP?q=20" width="586" height="562" role="presentation"></p><p><img width="586" height="562" srcset="https://miro.medium.com/max/552/0*necB1rsQAimOnUNP 276w, https://miro.medium.com/max/1104/0*necB1rsQAimOnUNP 552w, https://miro.medium.com/max/1172/0*necB1rsQAimOnUNP 586w" sizes="586px" role="presentation"></p></div></div></div></figure><p id="39c4" data-selectable-paragraph=""><em>Default Scaling (magnified 2x.)</em></p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*kcKBmL6xlRVzpASA?q=20" width="604" height="552" role="presentation"></p><p><img width="604" height="552" srcset="https://miro.medium.com/max/552/0*kcKBmL6xlRVzpASA 276w, https://miro.medium.com/max/1104/0*kcKBmL6xlRVzpASA 552w, https://miro.medium.com/max/1208/0*kcKBmL6xlRVzpASA 604w" sizes="604px" role="presentation"></p></div></div></div></figure><p id="2455" data-selectable-paragraph=""><em>Anime4k Scaling (magnified 2x). Notice less blurring of the shadows and lines as the content is scaled up for large format presentation.</em></p><p id="36eb" data-selectable-paragraph="">The real-time upscale tools are available only on the web on select browsers where WebGL is available. The feature is <em>very much </em>still in the alpha phase, so please keep that in mind. You can see the selection under advanced quality controls for Premium Crunchyroll users of Chrome &amp; Edge browsers. Here is the process:</p><p id="4189" data-selectable-paragraph=""><strong>Step 1</strong>: Load a video on <a href="https://www.crunchyroll.com/" target="_blank" rel="noopener nofollow">Crunchyroll.com</a>. Right click on the player and enable “<strong>Advanced Quality Controls”.</strong></p><p id="8579" data-selectable-paragraph=""><strong>Step 2: </strong>Click on the gear icon in the lower right corner, select “Advanced Controls” then toggle Anime4k.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/0*q4u5uIzOZJhVf_jR?q=20" width="428" height="256" role="presentation"></p><p><img width="428" height="256" srcset="https://miro.medium.com/max/552/0*q4u5uIzOZJhVf_jR 276w, https://miro.medium.com/max/856/0*q4u5uIzOZJhVf_jR 428w" sizes="428px" role="presentation"></p></div></div></div></div></figure><p id="36ec" data-selectable-paragraph=""><strong>Step 3: </strong>You may now enjoy anime with the fine work of the Anime4k project. Some basic controls are provided if you want to adjust the default values.</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*bRTZqZGbUn4gwPfa?q=20" width="442" height="299" role="presentation"></p><p><img width="442" height="299" srcset="https://miro.medium.com/max/552/0*bRTZqZGbUn4gwPfa 276w, https://miro.medium.com/max/884/0*bRTZqZGbUn4gwPfa 442w" sizes="442px" role="presentation"></p></div></div></div></figure><p id="466a" data-selectable-paragraph="">The approach used in both encode and client upscaling is very different and they hit very different use cases. The ideal setup may be leveraging both as we look towards improving content scaling across the diversity of source files, contexts for streaming, and bandwidth constraints.</p><p id="1a55" data-selectable-paragraph="">We aim to elicit feedback from the community around scaling filters or encodes. Another important aspect of this work would be, of course, to bring these upscale capabilities (and 4k versions of our applications) to game console and UHD streaming devices that are connected to 4k televisions where these techniques’ impact would be most apparent. Likewise, on mobile where the in-network constrained environment would allow for clear benefits towards anime specific upscaling on client vs the lossy traditional scaling techniques used today.</p><p id="32d7" data-selectable-paragraph="">Also on our radar is how these upscaling strategies are used in the encode process itself. We would like to explore how knowledge of post-process filters could affect encoding trade-offs around where we spend our bytes towards maximizing visual quality. Developments within the AV1 codec (a video encoding format) ecosystem around how film grain synthesis (a concept where compression is better able to preserve film grain without loss of quality) has been tackled is inspirational towards this future exploration. See <a href="https://norkin.org/pdf/DCC_2018_AV1_film_grain.pdf" target="_blank" rel="noopener nofollow">Film Grain Synthesis for AV1 Video Codec</a> by Andrey Norkin and Neil Birkbeck for more.</p><p id="5ec4" data-selectable-paragraph="">We would like to, of course, send big thanks to the anime upscale community who have built these amazing tools. We look forward to investing more in this area as this exciting field continues to evolve.</p><p id="108a" data-selectable-paragraph=""><em>[1] Chao Dong, Chen Change Loy, Kaiming He, Xiaoou Tang, “Image Super-Resolution Using Deep Convolutional Networks”, </em><a href="http://arxiv.org/abs/1501.00092" target="_blank" rel="noopener nofollow"><em>http://arxiv.org/abs/1501.00092</em></a></p></div></div></section></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>