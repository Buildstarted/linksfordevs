<!DOCTYPE html>
<html lang="en">
<head>
    <title>
TSP with GeneticSharp and Blazor - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="TSP with GeneticSharp and Blazor - linksfor.dev(s)"/>
    <meta property="article:author" content="Diego Giacomelli"/>
    <meta property="og:description" content="In this post I will show how to use GeneticSharp and Blazor to solve the TSP (Travelling salesman problem).&#xA;&#xA;Introduction"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://diegogiacomelli.com.br/tsp-with-geneticsharp-and-blazor/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - TSP with GeneticSharp and Blazor</title>
<div class="readable">
        <h1>TSP with GeneticSharp and Blazor</h1>
            <div>by Diego Giacomelli</div>
            <div>Reading time: 26-33 minutes</div>
        <div>Posted here: 11 Jul 2019</div>
        <p><a href="http://diegogiacomelli.com.br/tsp-with-geneticsharp-and-blazor/">http://diegogiacomelli.com.br/tsp-with-geneticsharp-and-blazor/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
    




  
    <center>
   
    <img src="http://diegogiacomelli.com.br/assets/logos/city.png" data-src="/assets/logos/city.png" alt="Logo do post" data-was-processed="true"> 
  
    </center>
   
 
    <div>
      <p><i></i> <span></span>10/07/2019</p>   
      

<p><i></i> <span></span>9 minutes to read</p>
   
    </div>    
    <p>In this post I will show how to use GeneticSharp and Blazor to solve the TSP (Travelling salesman problem).</p>

<h2 id="introduction">Introduction</h2>

<p>According to Wikipedia The travelling salesman problem (TSP) asks the following question:<em><strong>“Given a list of cities and the distances between each pair of cities, what is the shortest possible route that visits each city and returns to the origin city?”</strong></em></p>

<p>TSP is a classic sample to test some optimization techniques, as well it’s fairly used to demonstrate how to implement a genetic algorithm. For these reasons I will use it to show you how to implement a basic genetic algorithm in Blazor using GeneticSharp.</p>

<p>This post is a like a mirror of the <a href="http://diegogiacomelli.com.br/tsp-with-GeneticSharp-and-Unity3d">TSP with GeneticSharp an Unity3D</a>. It’s using the same format to teach TSP and GeneticSharp, but instead of Unity3D, this one is about Blazor.</p>

<p>You can see the final result of this tutorial on <a href="http://diegogiacomelli.com.br/apps/geneticsharp-runner-blazorapp">http://diegogiacomelli/apps/geneticsharp-runner-blazorapp</a>.</p>

<p>Note that the performance presented on this demo is not the performance that GeneticSharp presents in other apps kinds, like a ASP .NET Core backend app, a console app or in a Unity 3D game. As WebAssembly do not support create a new thread, we get limited to use a Timer to made this sample interactive. More details about this in next sections of the post.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>To better understand this tutorial, you need to have some experiences/knowledges in:</p>

<ul>
  <li>Blazor (beginner)</li>
  <li>Genetic algorithms (beginner).</li>
</ul>

<p>We will perform a very basic use of Blazor and everything you need to complete this tutorial will be explained or provided by the code samples, but if you want to find out better what’s happening under the hood, take a look on <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/get-started?view=aspnetcore-3.0&amp;viewFallbackFrom=aspnetcore-2.2&amp;tabs=netcore-cli">Blazor Get Started page</a>.</p>

<p>If you need an introduction to genetic algorithms, take a look at this tutorial <a href="http://diegogiacomelli.com.br/function-optimization-with-geneticsharp/">Function optimization with GeneticSharp</a>.</p>

<h2 id="creating-the-blazor-project">Creating the Blazor project</h2>
<p>Open a terminal and type:</p>

<div><div><pre><code>dotnet new <span>-i</span> Microsoft.AspNetCore.Blazor.Templates::3.0.0-preview6.19307.2
</code></pre></div></div>
<center><span><p>This will install the latest Blazor templates for .NET Core.</p>
</span></center>


<p>This tutorial is based on Blazor <code>preview6</code>. If you are doing this tutorial using a newer Blazor version and have encountered some problem, leave a comment at the end of the post or contact me on <a href="https://twitter.com/ogiacomelli">Twitter</a>.</p>

<p>Now we’ll create a scaffold Blazor app using the <code>blazor</code> template:</p>

<div><div><pre><code>dotnet new blazor <span>-o</span> TspWithGeneticSharp
<span>cd </span>TspWithGeneticSharp
dotnet watch run
</code></pre></div></div>

<p>Wait for the message <code>Application started. Press Ctrl+C to shut down</code> show up in terminal, then open the url <a href="http://localhost:5000/">http://localhost:5000</a> on your browser, you should see something like this:</p>
<center>
        <img src="http://diegogiacomelli.com.br/assets/2019/07/10/tsp-with-geneticsharp-and-blazor/blazor-scaffold-app.png">
      </center>

<h2 id="installing-geneticsharp">Installing GeneticSharp</h2>
<p>Open a new terminal in the same folder and type:</p>

<div><div><pre><code>dotnet add package GeneticSharp
</code></pre></div></div>
<center><span><p>This will install the latest <a href="https://www.nuget.org/packages/GeneticSharp/">GeneticSharp NuGet package</a> in your newly created Blazor app.</p>
</span></center>


<h2 id="opening-the-project">Opening the project</h2>
<p>I recommend to you use <a href="https://code.visualstudio.com/">Visual Studio Code</a> to open the project. There are some cool VS Code extensions to work with Blazor.</p>

<p>In the same terminal where you added the GeneticSharp package, type:</p>


<center><span><p>This will open the Blazor project with VS Code.</p>
</span></center>


<p>In the root folder of your Blazor project create a new subfolder called <code>Tsp</code>. We’ll add all our C# classes inside this folder.</p>

<h2 id="defining-the-tsp-chromosome">Defining the TSP chromosome</h2>
<center>
      <img src="http://diegogiacomelli.com.br/assets/logos/route.png">
      </center>

<p>The chromosome represents a solution of the problem we are trying to solve. In our case the TSP chromosome should represent <em><strong>“the shortest possible route that visits each city and returns to the origin city”</strong></em>.</p>

<p>To represent the cities route each gene of our chromosome will represent an index of a city in the route.</p>

<p>Create a file called <code>TspChromosome.cs</code>:</p>

<div id="gist97085520">
    <div>
      <div>
        <div>
  <div id="file-tspchromosome-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-tspchromosome-cs-L1" data-line-number="1"></td>
        <td id="file-tspchromosome-cs-LC1"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Chromosomes</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L2" data-line-number="2"></td>
        <td id="file-tspchromosome-cs-LC2"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Randomizations</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L3" data-line-number="3"></td>
        <td id="file-tspchromosome-cs-LC3">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L4" data-line-number="4"></td>
        <td id="file-tspchromosome-cs-LC4"><span>public</span> <span>class</span> <span>TspChromosome</span> : <span>ChromosomeBase</span></td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L5" data-line-number="5"></td>
        <td id="file-tspchromosome-cs-LC5">{</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L6" data-line-number="6"></td>
        <td id="file-tspchromosome-cs-LC6">    <span>private</span> <span>readonly</span> <span>int</span> <span>_numberOfCities</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L7" data-line-number="7"></td>
        <td id="file-tspchromosome-cs-LC7">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L8" data-line-number="8"></td>
        <td id="file-tspchromosome-cs-LC8">    <span>public</span> <span>TspChromosome</span>(<span>int</span> <span>numberOfCities</span>) : <span>base</span>(<span>numberOfCities</span>)</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L9" data-line-number="9"></td>
        <td id="file-tspchromosome-cs-LC9">    {</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L10" data-line-number="10"></td>
        <td id="file-tspchromosome-cs-LC10">        <span>_numberOfCities</span> <span>=</span> <span>numberOfCities</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L11" data-line-number="11"></td>
        <td id="file-tspchromosome-cs-LC11">        <span>var</span> <span>citiesIndexes</span> <span>=</span> <span>RandomizationProvider</span>.<span>Current</span>.<span>GetUniqueInts</span>(<span>numberOfCities</span>, <span>0</span>, <span>numberOfCities</span>);</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L12" data-line-number="12"></td>
        <td id="file-tspchromosome-cs-LC12">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L13" data-line-number="13"></td>
        <td id="file-tspchromosome-cs-LC13">        <span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>numberOfCities</span>; <span>i</span><span>++</span>)</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L14" data-line-number="14"></td>
        <td id="file-tspchromosome-cs-LC14">        {</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L15" data-line-number="15"></td>
        <td id="file-tspchromosome-cs-LC15">            <span>ReplaceGene</span>(<span>i</span>, <span>new</span> <span>Gene</span>(<span>citiesIndexes</span>[<span>i</span>]));</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L16" data-line-number="16"></td>
        <td id="file-tspchromosome-cs-LC16">        }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L17" data-line-number="17"></td>
        <td id="file-tspchromosome-cs-LC17">    }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L18" data-line-number="18"></td>
        <td id="file-tspchromosome-cs-LC18">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L19" data-line-number="19"></td>
        <td id="file-tspchromosome-cs-LC19">    <span>public</span> <span>double</span> <span>Distance</span> { <span>get</span>; <span>internal</span> <span>set</span>; }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L20" data-line-number="20"></td>
        <td id="file-tspchromosome-cs-LC20">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L21" data-line-number="21"></td>
        <td id="file-tspchromosome-cs-LC21">    <span>public</span> <span>override</span> <span>Gene</span> <span>GenerateGene</span>(<span>int</span> <span>geneIndex</span>)</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L22" data-line-number="22"></td>
        <td id="file-tspchromosome-cs-LC22">    {</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L23" data-line-number="23"></td>
        <td id="file-tspchromosome-cs-LC23">        <span>return</span> <span>new</span> <span>Gene</span>(<span>RandomizationProvider</span>.<span>Current</span>.<span>GetInt</span>(<span>0</span>, <span>_numberOfCities</span>));</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L24" data-line-number="24"></td>
        <td id="file-tspchromosome-cs-LC24">    }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L25" data-line-number="25"></td>
        <td id="file-tspchromosome-cs-LC25">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L26" data-line-number="26"></td>
        <td id="file-tspchromosome-cs-LC26">    <span>public</span> <span>override</span> <span>IChromosome</span> <span>CreateNew</span>()</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L27" data-line-number="27"></td>
        <td id="file-tspchromosome-cs-LC27">    {</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L28" data-line-number="28"></td>
        <td id="file-tspchromosome-cs-LC28">        <span>return</span> <span>new</span> <span>TspChromosome</span>(<span>_numberOfCities</span>);</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L29" data-line-number="29"></td>
        <td id="file-tspchromosome-cs-LC29">    }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L30" data-line-number="30"></td>
        <td id="file-tspchromosome-cs-LC30">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L31" data-line-number="31"></td>
        <td id="file-tspchromosome-cs-LC31">    <span>public</span> <span>override</span> <span>IChromosome</span> <span>Clone</span>()</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L32" data-line-number="32"></td>
        <td id="file-tspchromosome-cs-LC32">    {</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L33" data-line-number="33"></td>
        <td id="file-tspchromosome-cs-LC33">        <span>var</span> <span>clone</span> <span>=</span> <span>base</span>.<span>Clone</span>() <span>as</span> <span>TspChromosome</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L34" data-line-number="34"></td>
        <td id="file-tspchromosome-cs-LC34">        <span>clone</span>.<span>Distance</span> <span>=</span> <span>Distance</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L35" data-line-number="35"></td>
        <td id="file-tspchromosome-cs-LC35">
</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L36" data-line-number="36"></td>
        <td id="file-tspchromosome-cs-LC36">        <span>return</span> <span>clone</span>;</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L37" data-line-number="37"></td>
        <td id="file-tspchromosome-cs-LC37">    }</td>
      </tr>
      <tr>
        <td id="file-tspchromosome-cs-L38" data-line-number="38"></td>
        <td id="file-tspchromosome-cs-LC38">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<h2 id="representing-a-city">Representing a city</h2>
<p>The next step is define our genetic algorithm fitness function, but first we need to create a simple class to represent a city on a 2D space.</p>

<p>Create a file called <code>TspCity.cs</code>:</p>

<div id="gist97085520">
    <div>
      <div>
        <div>
  <div id="file-tspcity-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-tspcity-cs-L1" data-line-number="1"></td>
        <td id="file-tspcity-cs-LC1"><span>using</span> <span>System</span>;</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L2" data-line-number="2"></td>
        <td id="file-tspcity-cs-LC2"><span>public</span> <span>class</span> <span>TspCity</span></td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L3" data-line-number="3"></td>
        <td id="file-tspcity-cs-LC3">{</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L4" data-line-number="4"></td>
        <td id="file-tspcity-cs-LC4">    <span>public</span> <span>TspCity</span>(<span>float</span> <span>x</span>, <span>float</span> <span>y</span>)</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L5" data-line-number="5"></td>
        <td id="file-tspcity-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L6" data-line-number="6"></td>
        <td id="file-tspcity-cs-LC6">        <span>X</span> <span>=</span> <span>x</span>;</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L7" data-line-number="7"></td>
        <td id="file-tspcity-cs-LC7">        <span>Y</span> <span>=</span> <span>y</span>;</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L8" data-line-number="8"></td>
        <td id="file-tspcity-cs-LC8">    }</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L9" data-line-number="9"></td>
        <td id="file-tspcity-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L10" data-line-number="10"></td>
        <td id="file-tspcity-cs-LC10">    <span>public</span> <span>float</span> <span>X</span> { <span>get</span>; }</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L11" data-line-number="11"></td>
        <td id="file-tspcity-cs-LC11">    <span>public</span> <span>float</span> <span>Y</span> { <span>get</span>; }</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L12" data-line-number="12"></td>
        <td id="file-tspcity-cs-LC12">
</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L13" data-line-number="13"></td>
        <td id="file-tspcity-cs-LC13">    <span>public</span> <span>double</span> <span>Distance</span>(<span>TspCity</span> <span>other</span>)</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L14" data-line-number="14"></td>
        <td id="file-tspcity-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L15" data-line-number="15"></td>
        <td id="file-tspcity-cs-LC15">        <span>return</span> <span>Math</span>.<span>Sqrt</span>(</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L16" data-line-number="16"></td>
        <td id="file-tspcity-cs-LC16">            <span>Math</span>.<span>Pow</span>(<span>X</span> <span>-</span> <span>other</span>.<span>X</span>, <span>2</span>) <span>+</span> <span>Math</span>.<span>Pow</span>(<span>Y</span> <span>-</span> <span>other</span>.<span>Y</span>, <span>2</span>)</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L17" data-line-number="17"></td>
        <td id="file-tspcity-cs-LC17">        );</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L18" data-line-number="18"></td>
        <td id="file-tspcity-cs-LC18">    }</td>
      </tr>
      <tr>
        <td id="file-tspcity-cs-L19" data-line-number="19"></td>
        <td id="file-tspcity-cs-LC19">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<h2 id="the-fitness-function">The fitness function</h2>
<p>Now we need to evaluate the <code>TspChromosome</code>.</p>

<p>Our fitness function will evaluate the chromosome fitness based on the total distance to reach all cities in the route represented by the chromosome. The shorter the distance, the better the chromosome.</p>

<p>Create a file called <code>TspFitness.cs</code>: </p><div id="gist97085520">
    <div>
      <div>
        <div>
  <div id="file-tspfitness-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-tspfitness-cs-L1" data-line-number="1"></td>
        <td id="file-tspfitness-cs-LC1"><span>using</span> <span>System</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L2" data-line-number="2"></td>
        <td id="file-tspfitness-cs-LC2"><span>using</span> <span>System</span>.<span>Collections</span>.<span>Generic</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L3" data-line-number="3"></td>
        <td id="file-tspfitness-cs-LC3"><span>using</span> <span>System</span>.<span>Globalization</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L4" data-line-number="4"></td>
        <td id="file-tspfitness-cs-LC4"><span>using</span> <span>System</span>.<span>Linq</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L5" data-line-number="5"></td>
        <td id="file-tspfitness-cs-LC5"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Chromosomes</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L6" data-line-number="6"></td>
        <td id="file-tspfitness-cs-LC6"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Fitnesses</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L7" data-line-number="7"></td>
        <td id="file-tspfitness-cs-LC7"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Randomizations</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L8" data-line-number="8"></td>
        <td id="file-tspfitness-cs-LC8">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L9" data-line-number="9"></td>
        <td id="file-tspfitness-cs-LC9"><span>public</span> <span>class</span> <span>TspFitness</span> : <span>IFitness</span></td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L10" data-line-number="10"></td>
        <td id="file-tspfitness-cs-LC10">{</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L11" data-line-number="11"></td>
        <td id="file-tspfitness-cs-LC11">    <span>int</span> <span>_areaWidth</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L12" data-line-number="12"></td>
        <td id="file-tspfitness-cs-LC12">    <span>int</span> <span>_areaHeight</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L13" data-line-number="13"></td>
        <td id="file-tspfitness-cs-LC13">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L14" data-line-number="14"></td>
        <td id="file-tspfitness-cs-LC14">    <span>public</span> <span>TspFitness</span>(<span>int</span> <span>numberOfCities</span>, <span>int</span> <span>areaWidth</span>, <span>int</span> <span>areaHeight</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L15" data-line-number="15"></td>
        <td id="file-tspfitness-cs-LC15">    {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L16" data-line-number="16"></td>
        <td id="file-tspfitness-cs-LC16">        <span>Cities</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>TspCity</span>&gt;(<span>numberOfCities</span>);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L17" data-line-number="17"></td>
        <td id="file-tspfitness-cs-LC17">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L18" data-line-number="18"></td>
        <td id="file-tspfitness-cs-LC18">        <span>_areaWidth</span> <span>=</span> <span>areaWidth</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L19" data-line-number="19"></td>
        <td id="file-tspfitness-cs-LC19">        <span>_areaHeight</span> <span>=</span> <span>areaHeight</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L20" data-line-number="20"></td>
        <td id="file-tspfitness-cs-LC20">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L21" data-line-number="21"></td>
        <td id="file-tspfitness-cs-LC21">        <span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>numberOfCities</span>; <span>i</span><span>++</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L22" data-line-number="22"></td>
        <td id="file-tspfitness-cs-LC22">        {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L23" data-line-number="23"></td>
        <td id="file-tspfitness-cs-LC23">            <span>Cities</span>.<span>Add</span>(<span>GetRandomCity</span>());</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L24" data-line-number="24"></td>
        <td id="file-tspfitness-cs-LC24">        }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L25" data-line-number="25"></td>
        <td id="file-tspfitness-cs-LC25">    }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L26" data-line-number="26"></td>
        <td id="file-tspfitness-cs-LC26">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L27" data-line-number="27"></td>
        <td id="file-tspfitness-cs-LC27">    <span>public</span> <span>IList</span>&lt;<span>TspCity</span>&gt; <span>Cities</span> { <span>get</span>; <span>private</span> <span>set</span>; }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L28" data-line-number="28"></td>
        <td id="file-tspfitness-cs-LC28">   </td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L29" data-line-number="29"></td>
        <td id="file-tspfitness-cs-LC29">    <span>public</span> <span>double</span> <span>Evaluate</span>(<span>IChromosome</span> <span>chromosome</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L30" data-line-number="30"></td>
        <td id="file-tspfitness-cs-LC30">    {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L31" data-line-number="31"></td>
        <td id="file-tspfitness-cs-LC31">        <span>var</span> <span>genes</span> <span>=</span> <span>chromosome</span>.<span>GetGenes</span>();</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L32" data-line-number="32"></td>
        <td id="file-tspfitness-cs-LC32">        <span>var</span> <span>distanceSum</span> <span>=</span> <span>0.0</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L33" data-line-number="33"></td>
        <td id="file-tspfitness-cs-LC33">        <span>var</span> <span>lastCityIndex</span> <span>=</span> <span>Convert</span>.<span>ToInt32</span>(<span>genes</span>[<span>0</span>].<span>Value</span>, <span>CultureInfo</span>.<span>InvariantCulture</span>);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L34" data-line-number="34"></td>
        <td id="file-tspfitness-cs-LC34">        <span>var</span> <span>citiesIndexes</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>int</span>&gt;();</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L35" data-line-number="35"></td>
        <td id="file-tspfitness-cs-LC35">        <span>citiesIndexes</span>.<span>Add</span>(<span>lastCityIndex</span>);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L36" data-line-number="36"></td>
        <td id="file-tspfitness-cs-LC36">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L37" data-line-number="37"></td>
        <td id="file-tspfitness-cs-LC37">        <span><span>//</span> Calculates the total route distance.</span></td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L38" data-line-number="38"></td>
        <td id="file-tspfitness-cs-LC38">        <span>foreach</span> (<span>var</span> <span>g</span> <span>in</span> <span>genes</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L39" data-line-number="39"></td>
        <td id="file-tspfitness-cs-LC39">        {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L40" data-line-number="40"></td>
        <td id="file-tspfitness-cs-LC40">            <span>var</span> <span>currentCityIndex</span> <span>=</span> <span>Convert</span>.<span>ToInt32</span>(<span>g</span>.<span>Value</span>, <span>CultureInfo</span>.<span>InvariantCulture</span>);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L41" data-line-number="41"></td>
        <td id="file-tspfitness-cs-LC41">            <span>distanceSum</span> <span>+=</span> <span>Cities</span>[<span>currentCityIndex</span>].<span>Distance</span>(<span>Cities</span>[<span>lastCityIndex</span>]);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L42" data-line-number="42"></td>
        <td id="file-tspfitness-cs-LC42">            <span>lastCityIndex</span> <span>=</span> <span>currentCityIndex</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L43" data-line-number="43"></td>
        <td id="file-tspfitness-cs-LC43">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L44" data-line-number="44"></td>
        <td id="file-tspfitness-cs-LC44">            <span>citiesIndexes</span>.<span>Add</span>(<span>lastCityIndex</span>);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L45" data-line-number="45"></td>
        <td id="file-tspfitness-cs-LC45">        }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L46" data-line-number="46"></td>
        <td id="file-tspfitness-cs-LC46">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L47" data-line-number="47"></td>
        <td id="file-tspfitness-cs-LC47">        <span>distanceSum</span> <span>+=</span> <span>Cities</span>[<span>citiesIndexes</span>.<span>Last</span>()].<span>Distance</span>(<span>Cities</span>[<span>citiesIndexes</span>.<span>First</span>()]);</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L48" data-line-number="48"></td>
        <td id="file-tspfitness-cs-LC48">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L49" data-line-number="49"></td>
        <td id="file-tspfitness-cs-LC49">        <span>var</span> <span>fitness</span> <span>=</span> <span>1.0</span> <span>-</span> (<span>distanceSum</span> <span>/</span> (<span>Cities</span>.<span>Count</span> <span>*</span> <span>1000.0</span>));</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L50" data-line-number="50"></td>
        <td id="file-tspfitness-cs-LC50">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L51" data-line-number="51"></td>
        <td id="file-tspfitness-cs-LC51">        ((<span>TspChromosome</span>)<span>chromosome</span>).<span>Distance</span> <span>=</span> <span>distanceSum</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L52" data-line-number="52"></td>
        <td id="file-tspfitness-cs-LC52">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L53" data-line-number="53"></td>
        <td id="file-tspfitness-cs-LC53">        <span><span>//</span> Are there repeated cities on the indexes?</span></td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L54" data-line-number="54"></td>
        <td id="file-tspfitness-cs-LC54">        <span>var</span> <span>diff</span> <span>=</span> <span>Cities</span>.<span>Count</span> <span>-</span> <span>citiesIndexes</span>.<span>Distinct</span>().<span>Count</span>();</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L55" data-line-number="55"></td>
        <td id="file-tspfitness-cs-LC55">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L56" data-line-number="56"></td>
        <td id="file-tspfitness-cs-LC56">        <span>if</span> (<span>diff</span> <span>&gt;</span> <span>0</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L57" data-line-number="57"></td>
        <td id="file-tspfitness-cs-LC57">        {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L58" data-line-number="58"></td>
        <td id="file-tspfitness-cs-LC58">            <span>fitness</span> <span>/=</span> <span>diff</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L59" data-line-number="59"></td>
        <td id="file-tspfitness-cs-LC59">        }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L60" data-line-number="60"></td>
        <td id="file-tspfitness-cs-LC60">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L61" data-line-number="61"></td>
        <td id="file-tspfitness-cs-LC61">        <span>if</span> (<span>fitness</span> <span>&lt;</span> <span>0</span>)</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L62" data-line-number="62"></td>
        <td id="file-tspfitness-cs-LC62">        {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L63" data-line-number="63"></td>
        <td id="file-tspfitness-cs-LC63">            <span>fitness</span> <span>=</span> <span>0</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L64" data-line-number="64"></td>
        <td id="file-tspfitness-cs-LC64">        }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L65" data-line-number="65"></td>
        <td id="file-tspfitness-cs-LC65">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L66" data-line-number="66"></td>
        <td id="file-tspfitness-cs-LC66">        <span>return</span> <span>fitness</span>;</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L67" data-line-number="67"></td>
        <td id="file-tspfitness-cs-LC67">    }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L68" data-line-number="68"></td>
        <td id="file-tspfitness-cs-LC68">
</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L69" data-line-number="69"></td>
        <td id="file-tspfitness-cs-LC69">    <span>private</span> <span>TspCity</span> <span>GetRandomCity</span>()</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L70" data-line-number="70"></td>
        <td id="file-tspfitness-cs-LC70">    {</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L71" data-line-number="71"></td>
        <td id="file-tspfitness-cs-LC71">        <span>return</span> <span>new</span> <span>TspCity</span>(</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L72" data-line-number="72"></td>
        <td id="file-tspfitness-cs-LC72">            <span>RandomizationProvider</span>.<span>Current</span>.<span>GetFloat</span>(<span>0</span>, <span>_areaWidth</span>), </td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L73" data-line-number="73"></td>
        <td id="file-tspfitness-cs-LC73">            <span>RandomizationProvider</span>.<span>Current</span>.<span>GetFloat</span>(<span>0</span>, <span>_areaHeight</span>));</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L74" data-line-number="74"></td>
        <td id="file-tspfitness-cs-LC74">    }</td>
      </tr>
      <tr>
        <td id="file-tspfitness-cs-L75" data-line-number="75"></td>
        <td id="file-tspfitness-cs-LC75">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<h2 id="configuring-the-genetic-algorithm">Configuring the Genetic Algorithm</h2>
<p>In this step we need to configure our genetic algorithm using the <code>TspChromosome</code>, <code>TspFitness</code> and some classic GA operators already built in GeneticSharp.</p>

<p>Create a file called <code>TspGA.cs</code>: </p><div id="gist97085520">
    <div>
      <div>
        <div>
  <div id="file-tspga-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-tspga-cs-L1" data-line-number="1"></td>
        <td id="file-tspga-cs-LC1"><span>using</span> <span>System</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L2" data-line-number="2"></td>
        <td id="file-tspga-cs-LC2"><span>using</span> <span>System</span>.<span>Threading</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L3" data-line-number="3"></td>
        <td id="file-tspga-cs-LC3"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L4" data-line-number="4"></td>
        <td id="file-tspga-cs-LC4"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Crossovers</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L5" data-line-number="5"></td>
        <td id="file-tspga-cs-LC5"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Mutations</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L6" data-line-number="6"></td>
        <td id="file-tspga-cs-LC6"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Populations</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L7" data-line-number="7"></td>
        <td id="file-tspga-cs-LC7"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Selections</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L8" data-line-number="8"></td>
        <td id="file-tspga-cs-LC8"><span>using</span> <span>GeneticSharp</span>.<span>Domain</span>.<span>Terminations</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L9" data-line-number="9"></td>
        <td id="file-tspga-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L10" data-line-number="10"></td>
        <td id="file-tspga-cs-LC10"><span>public</span> <span>class</span> <span>TspGA</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L11" data-line-number="11"></td>
        <td id="file-tspga-cs-LC11">{</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L12" data-line-number="12"></td>
        <td id="file-tspga-cs-LC12">    <span>GeneticAlgorithm</span> <span>_ga</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L13" data-line-number="13"></td>
        <td id="file-tspga-cs-LC13">    <span>Timer</span> <span>_timer</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L14" data-line-number="14"></td>
        <td id="file-tspga-cs-LC14">    <span>public</span> <span>event</span> <span>Action</span> <span>GenerationRan</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L15" data-line-number="15"></td>
        <td id="file-tspga-cs-LC15">    <span>public</span> <span>TspFitness</span> <span>Fitness</span> { <span>get</span>; <span>private</span> <span>set</span>; }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L16" data-line-number="16"></td>
        <td id="file-tspga-cs-LC16">    <span>public</span> <span>TspChromosome</span> <span>BestChromosome</span> <span>=&gt;</span>  <span>_ga</span> <span>!=</span> <span>null</span> <span>?</span> <span>_ga</span>.<span>BestChromosome</span> <span>as</span> <span>TspChromosome</span> <span>:</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L17" data-line-number="17"></td>
        <td id="file-tspga-cs-LC17">    <span>public</span> <span>int</span> <span>GenerationsNumber</span> <span>=&gt;</span> <span>_ga</span> <span>!=</span> <span>null</span> <span>?</span> <span>_ga</span>.<span>GenerationsNumber</span> <span>:</span> <span>0</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L18" data-line-number="18"></td>
        <td id="file-tspga-cs-LC18">    <span>public</span> <span>bool</span> <span>IsRunning</span> <span>=&gt;</span> <span>_timer</span> <span>!=</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L19" data-line-number="19"></td>
        <td id="file-tspga-cs-LC19">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L20" data-line-number="20"></td>
        <td id="file-tspga-cs-LC20">    <span>public</span> <span>void</span> <span>Initialize</span>(<span>int</span> <span>numberOfCities</span>, <span>int</span> <span>areaWidth</span>, <span>int</span> <span>areaHeight</span>)</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L21" data-line-number="21"></td>
        <td id="file-tspga-cs-LC21">    {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L22" data-line-number="22"></td>
        <td id="file-tspga-cs-LC22">        <span>Stop</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L23" data-line-number="23"></td>
        <td id="file-tspga-cs-LC23">        <span>Fitness</span> <span>=</span> <span>new</span> <span>TspFitness</span>(<span>numberOfCities</span>, <span>areaWidth</span>, <span>areaHeight</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L24" data-line-number="24"></td>
        <td id="file-tspga-cs-LC24">        <span>var</span> <span>chromosome</span> <span>=</span> <span>new</span> <span>TspChromosome</span>(<span>numberOfCities</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L25" data-line-number="25"></td>
        <td id="file-tspga-cs-LC25">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L26" data-line-number="26"></td>
        <td id="file-tspga-cs-LC26">        <span><span>//</span> This operators are classic genetic algorithm operators that lead to a good solution on TSP,</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L27" data-line-number="27"></td>
        <td id="file-tspga-cs-LC27">        <span><span>//</span> but you can try others combinations and see what result you get.</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L28" data-line-number="28"></td>
        <td id="file-tspga-cs-LC28">        <span>var</span> <span>crossover</span> <span>=</span> <span>new</span> <span>OrderedCrossover</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L29" data-line-number="29"></td>
        <td id="file-tspga-cs-LC29">        <span>var</span> <span>mutation</span> <span>=</span> <span>new</span> <span>ReverseSequenceMutation</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L30" data-line-number="30"></td>
        <td id="file-tspga-cs-LC30">        <span>var</span> <span>selection</span> <span>=</span> <span>new</span> <span>RouletteWheelSelection</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L31" data-line-number="31"></td>
        <td id="file-tspga-cs-LC31">        <span>var</span> <span>population</span> <span>=</span> <span>new</span> <span>Population</span>(<span>50</span>, <span>100</span>, <span>chromosome</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L32" data-line-number="32"></td>
        <td id="file-tspga-cs-LC32">       </td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L33" data-line-number="33"></td>
        <td id="file-tspga-cs-LC33">        <span>_ga</span> <span>=</span> <span>new</span> <span>GeneticAlgorithm</span>(<span>population</span>, <span>Fitness</span>, <span>selection</span>, <span>crossover</span>, <span>mutation</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L34" data-line-number="34"></td>
        <td id="file-tspga-cs-LC34">    }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L35" data-line-number="35"></td>
        <td id="file-tspga-cs-LC35">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L36" data-line-number="36"></td>
        <td id="file-tspga-cs-LC36">    <span>public</span> <span>void</span> <span>Run</span>()</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L37" data-line-number="37"></td>
        <td id="file-tspga-cs-LC37">    {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L38" data-line-number="38"></td>
        <td id="file-tspga-cs-LC38">        <span>if</span> (<span>!</span><span>IsRunning</span>)</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L39" data-line-number="39"></td>
        <td id="file-tspga-cs-LC39">        {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L40" data-line-number="40"></td>
        <td id="file-tspga-cs-LC40">            <span><span>//</span> As there no way to use a new thread on WebAssembly right now, we wil use a timer</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L41" data-line-number="41"></td>
        <td id="file-tspga-cs-LC41">            <span><span>//</span> to start a new generation each 1 microsecond.</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L42" data-line-number="42"></td>
        <td id="file-tspga-cs-LC42">            <span>_timer</span> <span>=</span> <span>new</span> <span>Timer</span>(<span>new</span> <span>TimerCallback</span>(<span>_</span> <span>=&gt;</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L43" data-line-number="43"></td>
        <td id="file-tspga-cs-LC43">            {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L44" data-line-number="44"></td>
        <td id="file-tspga-cs-LC44">                <span>_ga</span>.<span>Termination</span> <span>=</span> <span>new</span> <span>GenerationNumberTermination</span>(<span>_ga</span>.<span>GenerationsNumber</span> <span>+</span> <span>1</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L45" data-line-number="45"></td>
        <td id="file-tspga-cs-LC45">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L46" data-line-number="46"></td>
        <td id="file-tspga-cs-LC46">                <span>if</span> (<span>_ga</span>.<span>GenerationsNumber</span> <span>&gt;</span> <span>0</span>)</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L47" data-line-number="47"></td>
        <td id="file-tspga-cs-LC47">                    <span>_ga</span>.<span>Resume</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L48" data-line-number="48"></td>
        <td id="file-tspga-cs-LC48">                <span>else</span></td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L49" data-line-number="49"></td>
        <td id="file-tspga-cs-LC49">                    <span>_ga</span>.<span>Start</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L50" data-line-number="50"></td>
        <td id="file-tspga-cs-LC50">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L51" data-line-number="51"></td>
        <td id="file-tspga-cs-LC51">                <span>GenerationRan</span><span>?</span>.<span>Invoke</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L52" data-line-number="52"></td>
        <td id="file-tspga-cs-LC52">            }), <span>null</span>, <span>0</span>, <span>1</span>);</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L53" data-line-number="53"></td>
        <td id="file-tspga-cs-LC53">        }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L54" data-line-number="54"></td>
        <td id="file-tspga-cs-LC54">    }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L55" data-line-number="55"></td>
        <td id="file-tspga-cs-LC55">
</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L56" data-line-number="56"></td>
        <td id="file-tspga-cs-LC56">    <span>public</span> <span>void</span> <span>Stop</span>()</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L57" data-line-number="57"></td>
        <td id="file-tspga-cs-LC57">    {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L58" data-line-number="58"></td>
        <td id="file-tspga-cs-LC58">        <span>if</span> (<span>IsRunning</span>)</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L59" data-line-number="59"></td>
        <td id="file-tspga-cs-LC59">        {</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L60" data-line-number="60"></td>
        <td id="file-tspga-cs-LC60">            <span>_timer</span>.<span>Dispose</span>();</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L61" data-line-number="61"></td>
        <td id="file-tspga-cs-LC61">            <span>_timer</span> <span>=</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L62" data-line-number="62"></td>
        <td id="file-tspga-cs-LC62">        }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L63" data-line-number="63"></td>
        <td id="file-tspga-cs-LC63">    }</td>
      </tr>
      <tr>
        <td id="file-tspga-cs-L64" data-line-number="64"></td>
        <td id="file-tspga-cs-LC64">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<div><h3 id="why-use-timer">Why use Timer?</h3>
<p>GeneticSharp can be used as single threading or multithreading to evaluate chromosomes with the fitness function, but WebAssembly (and Blazor) can use just the UI thread, in this scenario when we call <code>GeneticAlgorithm.Start</code> method it freezes the UI until the GA finish.</p>

<p>To avoid this behavior, the solution is: run each generation of the GA inside a step in a <code>System.Threading.Timer</code> as you can see in the <code>TspGA.Run</code> method.</p>

<blockquote>
  <p>APIs that aren’t applicable inside of a web browser (for example, accessing the file system, opening a socket, and <strong>threading</strong>) throw a PlatformNotSupportedException.
(<a href="https://docs.microsoft.com/pt-br/aspnet/core/blazor/?view=aspnetcore-3.0">https://docs.microsoft.com/pt-br/aspnet/core/blazor/?view=aspnetcore-3.0</a>)</p>
</blockquote>
</div>

<h2 id="creating-the-razor-page">Creating the Razor page</h2>
<p>Inside the folder <code>Pages</code> create a file called <code>Tsp.razor</code>: </p><div id="gist97086639">
    <div>
      <div>
        <div>
  <div id="file-tsp-v1-razor">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-tsp-v1-razor-L1" data-line-number="1"></td>
        <td id="file-tsp-v1-razor-LC1"><span>@page </span><span><span>"</span>/tsp<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L2" data-line-number="2"></td>
        <td id="file-tsp-v1-razor-LC2"><span>@inject </span><span>IJSRuntime</span> <span>_js</span></td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L3" data-line-number="3"></td>
        <td id="file-tsp-v1-razor-LC3">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L4" data-line-number="4"></td>
        <td id="file-tsp-v1-razor-LC4">&lt;<span>div</span> <span>class</span>=<span><span>"</span>container<span>"</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L5" data-line-number="5"></td>
        <td id="file-tsp-v1-razor-LC5">     &lt;<span>div</span> <span>class</span>=<span><span>"</span>row<span>"</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L6" data-line-number="6"></td>
        <td id="file-tsp-v1-razor-LC6">        &lt;<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L7" data-line-number="7"></td>
        <td id="file-tsp-v1-razor-LC7">            Cities: &lt;<span>input</span> <span>type</span>=<span><span>"</span>text<span>"</span></span> <span>@bind</span>=<span>@_numberOfCities</span> <span>onblur</span>=<span>@ResetGA</span> <span>disabled</span>=<span>@_tspGA.IsRunning</span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L8" data-line-number="8"></td>
        <td id="file-tsp-v1-razor-LC8">        &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L9" data-line-number="9"></td>
        <td id="file-tsp-v1-razor-LC9">         &lt;<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L10" data-line-number="10"></td>
        <td id="file-tsp-v1-razor-LC10">            &lt;<span>button</span> <span>onclick</span>=<span>@ResetGA</span> <span>disabled</span>=<span>@_tspGA.IsRunning</span> &gt;Reset&lt;/<span>button</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L11" data-line-number="11"></td>
        <td id="file-tsp-v1-razor-LC11">        &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L12" data-line-number="12"></td>
        <td id="file-tsp-v1-razor-LC12">        &lt;<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L13" data-line-number="13"></td>
        <td id="file-tsp-v1-razor-LC13">            &lt;<span>button</span> <span>onclick</span>=<span>@_tspGA.Run</span> <span>disabled</span>=<span>@_tspGA.IsRunning</span> &gt;Run&lt;/<span>button</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L14" data-line-number="14"></td>
        <td id="file-tsp-v1-razor-LC14">        &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L15" data-line-number="15"></td>
        <td id="file-tsp-v1-razor-LC15">        &lt;<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L16" data-line-number="16"></td>
        <td id="file-tsp-v1-razor-LC16">            &lt;<span>button</span> <span>onclick</span>=<span>@StopGA</span> <span>disabled</span>=<span>@(!_tspGA.IsRunning)</span>&gt;Stop&lt;/<span>button</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L17" data-line-number="17"></td>
        <td id="file-tsp-v1-razor-LC17">        &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L18" data-line-number="18"></td>
        <td id="file-tsp-v1-razor-LC18">    &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L19" data-line-number="19"></td>
        <td id="file-tsp-v1-razor-LC19">    &lt;<span>div</span> <span>class</span>=<span><span>"</span>row<span>"</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L20" data-line-number="20"></td>
        <td id="file-tsp-v1-razor-LC20">        &lt;<span>div</span> <span>class</span>=<span><span>"</span>col alert alert-info<span>"</span></span>&gt;Generations: <span>@_tspGA.GenerationsNumber</span>&lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L21" data-line-number="21"></td>
        <td id="file-tsp-v1-razor-LC21">        &lt;<span>div</span> <span>class</span>=<span><span>"</span>col alert alert-info<span>"</span></span>&gt;Distance: <span>@_tspGA.BestChromosome</span>?.Distance&lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L22" data-line-number="22"></td>
        <td id="file-tsp-v1-razor-LC22">    &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L23" data-line-number="23"></td>
        <td id="file-tsp-v1-razor-LC23"> &lt;/<span>div</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L24" data-line-number="24"></td>
        <td id="file-tsp-v1-razor-LC24">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L25" data-line-number="25"></td>
        <td id="file-tsp-v1-razor-LC25">&lt;<span>canvas</span> <span>id</span>=<span><span>"</span>canvas<span>"</span></span> <span>style</span>=<span><span>"</span><span><span><span>border</span></span>:<span>1<span>px</span></span> <span>solid</span> <span>#d3d3d3</span>;</span><span>"</span></span>&gt;Your browser does not support the HTML5 canvas tag.&lt;/<span>canvas</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L26" data-line-number="26"></td>
        <td id="file-tsp-v1-razor-LC26">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L27" data-line-number="27"></td>
        <td id="file-tsp-v1-razor-LC27"><span>@code</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L28" data-line-number="28"></td>
        <td id="file-tsp-v1-razor-LC28">    <span>int</span> <span>_numberOfCities</span> <span>=</span> <span>10</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L29" data-line-number="29"></td>
        <td id="file-tsp-v1-razor-LC29">    <span>int</span> <span>_canvasWidth</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L30" data-line-number="30"></td>
        <td id="file-tsp-v1-razor-LC30">    <span>int</span> <span>_canvasHeight</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L31" data-line-number="31"></td>
        <td id="file-tsp-v1-razor-LC31">    <span>bool</span> <span>_initialized</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L32" data-line-number="32"></td>
        <td id="file-tsp-v1-razor-LC32">    <span>TspGA</span> <span>_tspGA</span> <span>=</span> <span>new</span> <span>TspGA</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L33" data-line-number="33"></td>
        <td id="file-tsp-v1-razor-LC33">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L34" data-line-number="34"></td>
        <td id="file-tsp-v1-razor-LC34">    <span>async</span> <span>Task</span> <span>InitializeGAAsync</span>()</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L35" data-line-number="35"></td>
        <td id="file-tsp-v1-razor-LC35">    {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L36" data-line-number="36"></td>
        <td id="file-tsp-v1-razor-LC36">        <span><span>//</span> This need to be called after the first render to get</span></td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L37" data-line-number="37"></td>
        <td id="file-tsp-v1-razor-LC37">        <span><span>//</span> the size of the canvas.</span></td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L38" data-line-number="38"></td>
        <td id="file-tsp-v1-razor-LC38">        <span>var</span> <span>size</span> <span>=</span> <span>await</span> <span>_js</span>.<span>InvokeAsync</span>&lt;<span>int</span>[]&gt;(<span><span>"</span>initializeCanvas<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L39" data-line-number="39"></td>
        <td id="file-tsp-v1-razor-LC39">        <span>_canvasWidth</span> <span>=</span> <span>size</span>[<span>0</span>];</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L40" data-line-number="40"></td>
        <td id="file-tsp-v1-razor-LC40">        <span>_canvasHeight</span> <span>=</span> <span>size</span>[<span>1</span>];</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L41" data-line-number="41"></td>
        <td id="file-tsp-v1-razor-LC41">        <span>_tspGA</span>.<span>GenerationRan</span> <span>+=</span> <span>HandleGenerationRan</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L42" data-line-number="42"></td>
        <td id="file-tsp-v1-razor-LC42">        <span>ResetGA</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L43" data-line-number="43"></td>
        <td id="file-tsp-v1-razor-LC43">    }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L44" data-line-number="44"></td>
        <td id="file-tsp-v1-razor-LC44">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L45" data-line-number="45"></td>
        <td id="file-tsp-v1-razor-LC45">    <span>void</span> <span>HandleGenerationRan</span>()</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L46" data-line-number="46"></td>
        <td id="file-tsp-v1-razor-LC46">    {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L47" data-line-number="47"></td>
        <td id="file-tsp-v1-razor-LC47">        <span>Console</span>.<span>WriteLine</span>(<span><span>$"</span>Generation: {<span>_tspGA</span>.<span>GenerationsNumber</span>} - Distance: {<span>_tspGA</span>.<span>BestChromosome</span>.<span>Distance</span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L48" data-line-number="48"></td>
        <td id="file-tsp-v1-razor-LC48">        <span>StateHasChanged</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L49" data-line-number="49"></td>
        <td id="file-tsp-v1-razor-LC49">    }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L50" data-line-number="50"></td>
        <td id="file-tsp-v1-razor-LC50">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L51" data-line-number="51"></td>
        <td id="file-tsp-v1-razor-LC51">    <span>void</span> <span>ResetGA</span>()</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L52" data-line-number="52"></td>
        <td id="file-tsp-v1-razor-LC52">    {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L53" data-line-number="53"></td>
        <td id="file-tsp-v1-razor-LC53">        <span>_tspGA</span>.<span>Initialize</span>(<span>_numberOfCities</span>, <span>_canvasWidth</span>, <span>_canvasHeight</span>);</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L54" data-line-number="54"></td>
        <td id="file-tsp-v1-razor-LC54">        <span>StateHasChanged</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L55" data-line-number="55"></td>
        <td id="file-tsp-v1-razor-LC55">    }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L56" data-line-number="56"></td>
        <td id="file-tsp-v1-razor-LC56">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L57" data-line-number="57"></td>
        <td id="file-tsp-v1-razor-LC57">    <span>void</span> <span>StopGA</span>()</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L58" data-line-number="58"></td>
        <td id="file-tsp-v1-razor-LC58">    {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L59" data-line-number="59"></td>
        <td id="file-tsp-v1-razor-LC59">        <span>_tspGA</span>.<span>Stop</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L60" data-line-number="60"></td>
        <td id="file-tsp-v1-razor-LC60">        <span>StateHasChanged</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L61" data-line-number="61"></td>
        <td id="file-tsp-v1-razor-LC61">    }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L62" data-line-number="62"></td>
        <td id="file-tsp-v1-razor-LC62">
</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L63" data-line-number="63"></td>
        <td id="file-tsp-v1-razor-LC63">    <span>protected</span> <span>override</span> <span>async</span> <span>Task</span> <span>OnAfterRenderAsync</span>()</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L64" data-line-number="64"></td>
        <td id="file-tsp-v1-razor-LC64">    {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L65" data-line-number="65"></td>
        <td id="file-tsp-v1-razor-LC65">        <span>if</span> (<span>!</span><span>_initialized</span>) {</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L66" data-line-number="66"></td>
        <td id="file-tsp-v1-razor-LC66">            <span>_initialized</span> <span>=</span> <span>true</span>;</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L67" data-line-number="67"></td>
        <td id="file-tsp-v1-razor-LC67">            <span>await</span> <span>InitializeGAAsync</span>();</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L68" data-line-number="68"></td>
        <td id="file-tsp-v1-razor-LC68">        }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L69" data-line-number="69"></td>
        <td id="file-tsp-v1-razor-LC69">        </td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L70" data-line-number="70"></td>
        <td id="file-tsp-v1-razor-LC70">        <span>await</span> <span>_js</span>.<span>InvokeAsync</span>&lt;<span>object</span>&gt;(<span><span>"</span>clearCanvas<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L71" data-line-number="71"></td>
        <td id="file-tsp-v1-razor-LC71">    }</td>
      </tr>
      <tr>
        <td id="file-tsp-v1-razor-L72" data-line-number="72"></td>
        <td id="file-tsp-v1-razor-LC72"><span>}</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<p>As we need to interop with JavaScript to manipulate DOM, we will use some helper JS functions. Add the file <code>canvas-helper.js</code> inside the folder <code>wwwroot/js</code>:  </p><div id="gist97085520">
    <div>
      <div>
        <div>
  <div id="file-canvas-helper-js">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-canvas-helper-js-L1" data-line-number="1"></td>
        <td id="file-canvas-helper-js-LC1"><span>var</span> <span>_canvas</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L2" data-line-number="2"></td>
        <td id="file-canvas-helper-js-LC2"><span>var</span> <span>_canvasContext</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L3" data-line-number="3"></td>
        <td id="file-canvas-helper-js-LC3">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L4" data-line-number="4"></td>
        <td id="file-canvas-helper-js-LC4"><span>function</span> <span>initializeCanvas</span><span>(</span><span>)</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L5" data-line-number="5"></td>
        <td id="file-canvas-helper-js-LC5"><span>{</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L6" data-line-number="6"></td>
        <td id="file-canvas-helper-js-LC6">    <span>_canvas</span> <span>=</span> <span>document</span><span>.</span><span>getElementById</span><span>(</span><span>'canvas'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L7" data-line-number="7"></td>
        <td id="file-canvas-helper-js-LC7">    <span>_canvasContext</span> <span>=</span> <span>_canvas</span><span>.</span><span>getContext</span><span>(</span><span>'2d'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L8" data-line-number="8"></td>
        <td id="file-canvas-helper-js-LC8">    <span>_canvas</span><span>.</span><span>width</span>  <span>=</span> <span>window</span><span>.</span><span>innerWidth</span> * <span>.8</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L9" data-line-number="9"></td>
        <td id="file-canvas-helper-js-LC9">    <span>_canvas</span><span>.</span><span>height</span> <span>=</span> <span>window</span><span>.</span><span>innerHeight</span> * <span>.8</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L10" data-line-number="10"></td>
        <td id="file-canvas-helper-js-LC10">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L11" data-line-number="11"></td>
        <td id="file-canvas-helper-js-LC11">    <span>return</span> <span>[</span><span>_canvas</span><span>.</span><span>width</span><span>,</span> <span>_canvas</span><span>.</span><span>height</span><span>]</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L12" data-line-number="12"></td>
        <td id="file-canvas-helper-js-LC12"><span>}</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L13" data-line-number="13"></td>
        <td id="file-canvas-helper-js-LC13">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L14" data-line-number="14"></td>
        <td id="file-canvas-helper-js-LC14"><span>function</span> <span>clearCanvas</span><span>(</span><span>)</span> </td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L15" data-line-number="15"></td>
        <td id="file-canvas-helper-js-LC15"><span>{</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L16" data-line-number="16"></td>
        <td id="file-canvas-helper-js-LC16">    <span>_canvasContext</span><span>.</span><span>clearRect</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>_canvas</span><span>.</span><span>width</span><span>,</span> <span>_canvas</span><span>.</span><span>height</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L17" data-line-number="17"></td>
        <td id="file-canvas-helper-js-LC17"><span>}</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L18" data-line-number="18"></td>
        <td id="file-canvas-helper-js-LC18">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L19" data-line-number="19"></td>
        <td id="file-canvas-helper-js-LC19"><span>function</span> <span>drawRect</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>width</span><span>,</span> <span>height</span><span>)</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L20" data-line-number="20"></td>
        <td id="file-canvas-helper-js-LC20"><span>{</span>   </td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L21" data-line-number="21"></td>
        <td id="file-canvas-helper-js-LC21">    <span>_canvasContext</span><span>.</span><span>beginPath</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L22" data-line-number="22"></td>
        <td id="file-canvas-helper-js-LC22">    <span>_canvasContext</span><span>.</span><span>rect</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>width</span><span>,</span> <span>height</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L23" data-line-number="23"></td>
        <td id="file-canvas-helper-js-LC23">    <span>_canvasContext</span><span>.</span><span>stroke</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L24" data-line-number="24"></td>
        <td id="file-canvas-helper-js-LC24"><span>}</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L25" data-line-number="25"></td>
        <td id="file-canvas-helper-js-LC25">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L26" data-line-number="26"></td>
        <td id="file-canvas-helper-js-LC26"><span>function</span> <span>drawCircle</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>radius</span><span>)</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L27" data-line-number="27"></td>
        <td id="file-canvas-helper-js-LC27"><span>{</span>   </td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L28" data-line-number="28"></td>
        <td id="file-canvas-helper-js-LC28">    <span>_canvasContext</span><span>.</span><span>fillStyle</span> <span>=</span> <span>"#000000"</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L29" data-line-number="29"></td>
        <td id="file-canvas-helper-js-LC29">    <span>_canvasContext</span><span>.</span><span>beginPath</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L30" data-line-number="30"></td>
        <td id="file-canvas-helper-js-LC30">    <span>_canvasContext</span><span>.</span><span>arc</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>radius</span><span>,</span> <span>0</span><span>,</span> <span>2</span> * <span>Math</span><span>.</span><span>PI</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L31" data-line-number="31"></td>
        <td id="file-canvas-helper-js-LC31">    <span>_canvasContext</span><span>.</span><span>fill</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L32" data-line-number="32"></td>
        <td id="file-canvas-helper-js-LC32"><span>}</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L33" data-line-number="33"></td>
        <td id="file-canvas-helper-js-LC33">
</td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L34" data-line-number="34"></td>
        <td id="file-canvas-helper-js-LC34"><span>function</span> <span>drawLine</span><span>(</span><span>x1</span><span>,</span> <span>y1</span><span>,</span> <span>x2</span><span>,</span> <span>y2</span><span>)</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L35" data-line-number="35"></td>
        <td id="file-canvas-helper-js-LC35"><span>{</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L36" data-line-number="36"></td>
        <td id="file-canvas-helper-js-LC36">    <span>_canvasContext</span><span>.</span><span>beginPath</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L37" data-line-number="37"></td>
        <td id="file-canvas-helper-js-LC37">    <span>_canvasContext</span><span>.</span><span>moveTo</span><span>(</span><span>x1</span><span>,</span> <span>y1</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L38" data-line-number="38"></td>
        <td id="file-canvas-helper-js-LC38">    <span>_canvasContext</span><span>.</span><span>lineTo</span><span>(</span><span>x2</span><span>,</span> <span>y2</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L39" data-line-number="39"></td>
        <td id="file-canvas-helper-js-LC39">    <span>_canvasContext</span><span>.</span><span>stroke</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-canvas-helper-js-L40" data-line-number="40"></td>
        <td id="file-canvas-helper-js-LC40"><span>}</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<p>Open the file <code>index.html</code> and add the tag below inside the tag <code>head</code>:  </p><div id="gist97086639">
    <div>
      <div>
        <div>
  <div id="file-index-canvas-helper-html">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-index-canvas-helper-html-L1" data-line-number="1"></td>
        <td id="file-index-canvas-helper-html-LC1"><span>&lt;</span><span>script</span> <span>src</span>="<span>js/canvas-helper.js</span>"<span>&gt;</span><span>&lt;/</span><span>script</span><span>&gt;</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>Check your terminal window where the command <code>dotnet watch run</code> is running, if there is no error in that window you can access the url <a href="http://localhost:5000/tsp">http://localhost:5000/tsp</a>.</p>

<p>Hit the <code>Run</code> button and take a look on the browser console window, you will see the distance to reach all cities getting smaller as the generations ran.</p>

<center>
        <img src="http://diegogiacomelli.com.br/assets/2019/07/10/tsp-with-geneticsharp-and-blazor/console-window.png">
      </center>

<p>This is not a tutorial about Blazor good pratices, so everything here is done in the simplest possible way to introduce how to use GenticSharp with Blazor.  I do not talk about things you should use when working with Blazor, such as separate logic from UI and use Blazor components.</p>

<h2 id="drawing-the-cities">Drawing the cities</h2>
<p>Now our GA is running inside the browser, but it needs to display the cities route better.
We need to create a visual representation to the cities.</p>

<p>In the <code>Tsp.razor</code> add the method <code>DrawCitiesAsync</code>:</p>


<div id="gist97086639">
    <div>
      <div>
        <div>
  <div id="file-drawcitiesasync-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-drawcitiesasync-cs-L1" data-line-number="1"></td>
        <td id="file-drawcitiesasync-cs-LC1"><span>async</span> <span>Task</span> <span>DrawCitiesAsync</span>()</td>
      </tr>
      <tr>
        <td id="file-drawcitiesasync-cs-L2" data-line-number="2"></td>
        <td id="file-drawcitiesasync-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-drawcitiesasync-cs-L3" data-line-number="3"></td>
        <td id="file-drawcitiesasync-cs-LC3">    <span>foreach</span>(<span>var</span> <span>city</span> <span>in</span> <span>_tspGA</span>.<span>Fitness</span>.<span>Cities</span>)</td>
      </tr>
      <tr>
        <td id="file-drawcitiesasync-cs-L4" data-line-number="4"></td>
        <td id="file-drawcitiesasync-cs-LC4">        <span>await</span> <span>_js</span>.<span>InvokeAsync</span>&lt;<span>object</span>&gt;(<span><span>"</span>drawCircle<span>"</span></span>, <span>city</span>.<span>X</span>, <span>city</span>.<span>Y</span>, <span>10</span>);</td>
      </tr>
      <tr>
        <td id="file-drawcitiesasync-cs-L5" data-line-number="5"></td>
        <td id="file-drawcitiesasync-cs-LC5">} </td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<p>Then call it from <code>OnAfterRenderAsync</code> method, after the <code>clearCanvas</code> call:</p>




<p>Reload the url <a href="http://localhost:5000/tsp">http://localhost:5000/tsp</a>.</p>

<p>Now you should see something like this:</p>
<center>
        <img src="http://diegogiacomelli.com.br/assets/2019/07/10/tsp-with-geneticsharp-and-blazor/draw-cities.gif">
      </center>

<h2 id="drawing-the-route">Drawing the route</h2>
<p>In the previous step we drawn the cities and we have the visual of the problem: the cities.</p>

<p>Now we need to draw the solution: the route represented by the best chromosome of each generation.</p>

<p>Add the following method to the <code>Tsp.razor</code>:</p>

<div id="gist97086639">
    <div>
      <div>
        <div>
  <div id="file-drawrouteasync-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-drawrouteasync-cs-L1" data-line-number="1"></td>
        <td id="file-drawrouteasync-cs-LC1"><span>async</span> <span>Task</span> <span>DrawRouteAsync</span>()</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L2" data-line-number="2"></td>
        <td id="file-drawrouteasync-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L3" data-line-number="3"></td>
        <td id="file-drawrouteasync-cs-LC3">    <span>var</span> <span>bestChromosome</span> <span>=</span> <span>_tspGA</span>.<span>BestChromosome</span>;</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L4" data-line-number="4"></td>
        <td id="file-drawrouteasync-cs-LC4">
</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L5" data-line-number="5"></td>
        <td id="file-drawrouteasync-cs-LC5">    <span>if</span>(<span>bestChromosome</span> <span>!=</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L6" data-line-number="6"></td>
        <td id="file-drawrouteasync-cs-LC6">    {</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L7" data-line-number="7"></td>
        <td id="file-drawrouteasync-cs-LC7">        <span>var</span> <span>genes</span> <span>=</span> <span>bestChromosome</span>.<span>GetGenes</span>();</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L8" data-line-number="8"></td>
        <td id="file-drawrouteasync-cs-LC8">        <span>var</span> <span>fitness</span> <span>=</span> <span>_tspGA</span>.<span>Fitness</span>;</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L9" data-line-number="9"></td>
        <td id="file-drawrouteasync-cs-LC9">        <span>var</span> <span>firstCity</span> <span>=</span> <span>fitness</span>.<span>Cities</span>[(<span>int</span>)<span>genes</span>[<span>0</span>].<span>Value</span>];</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L10" data-line-number="10"></td>
        <td id="file-drawrouteasync-cs-LC10">        <span>var</span> <span>previousCity</span> <span>=</span> <span>firstCity</span>;</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L11" data-line-number="11"></td>
        <td id="file-drawrouteasync-cs-LC11">
</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L12" data-line-number="12"></td>
        <td id="file-drawrouteasync-cs-LC12">        <span>for</span>(<span>var</span> <span>i</span> <span>=</span> <span>1</span>; <span>i</span> <span>&lt;</span> <span>genes</span>.<span>Length</span>; <span>i</span><span>++</span>)</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L13" data-line-number="13"></td>
        <td id="file-drawrouteasync-cs-LC13">        {</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L14" data-line-number="14"></td>
        <td id="file-drawrouteasync-cs-LC14">            <span>var</span> <span>city</span> <span>=</span> <span>fitness</span>.<span>Cities</span>[(<span>int</span>)<span>genes</span>[<span>i</span>].<span>Value</span>];</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L15" data-line-number="15"></td>
        <td id="file-drawrouteasync-cs-LC15">            <span>await</span> <span>_js</span>.<span>InvokeAsync</span>&lt;<span>object</span>&gt;(<span><span>"</span>drawLine<span>"</span></span>, <span>previousCity</span>.<span>X</span>, <span>previousCity</span>.<span>Y</span>, <span>city</span>.<span>X</span>, <span>city</span>.<span>Y</span>);</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L16" data-line-number="16"></td>
        <td id="file-drawrouteasync-cs-LC16">
</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L17" data-line-number="17"></td>
        <td id="file-drawrouteasync-cs-LC17">            <span>previousCity</span> <span>=</span> <span>city</span>;</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L18" data-line-number="18"></td>
        <td id="file-drawrouteasync-cs-LC18">        }</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L19" data-line-number="19"></td>
        <td id="file-drawrouteasync-cs-LC19">
</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L20" data-line-number="20"></td>
        <td id="file-drawrouteasync-cs-LC20">        <span>await</span> <span>_js</span>.<span>InvokeAsync</span>&lt;<span>object</span>&gt;(<span><span>"</span>drawLine<span>"</span></span>, <span>previousCity</span>.<span>X</span>, <span>previousCity</span>.<span>Y</span>, <span>firstCity</span>.<span>X</span>, <span>firstCity</span>.<span>Y</span>);</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L21" data-line-number="21"></td>
        <td id="file-drawrouteasync-cs-LC21">    }</td>
      </tr>
      <tr>
        <td id="file-drawrouteasync-cs-L22" data-line-number="22"></td>
        <td id="file-drawrouteasync-cs-LC22">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>


<p>Then call it from <code>OnAfterRenderAsync</code> method, after the <code>DrawCitiesAsync</code> call:</p>




<p>Reload the url <a href="http://localhost:5000/tsp">http://localhost:5000/tsp</a> again, and hit the <code>Run</code> button, now you should see the route been optimizing as the generations are ran:</p>
<center>
        <img src="http://diegogiacomelli.com.br/assets/2019/07/10/tsp-with-geneticsharp-and-blazor/draw-route.gif">
      </center>

<h2 id="conclusion">Conclusion</h2>
<p>With only 4 C# classes, 1 JS file and 1 Blazor page we built a pretty nice sample of genetic algorithms using Blazor with GeneticSharp. Now you can improve it with your own ideas or use some of mine ;):</p>

<ul>
  <li>Maybe let user change the genetic algorithm operators (crossover, mutation, selection, etc)?</li>
  <li>Move the DrawCitiesAsync and DrawRouteAsync to <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components?view=aspnetcore-3.0">Blazor components</a> responsible to only draw them?</li>
</ul>

<p>The full source code used in this post can be download or fork from this Gist: <a href="https://gist.github.com/giacomelli/9addc5182943ba25eb82201e30c76418">https://gist.github.com/giacomelli/9addc5182943ba25eb82201e30c76418</a></p>

<p>Let’s evolve!</p>


    
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>