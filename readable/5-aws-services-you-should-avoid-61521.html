<!DOCTYPE html>
<html lang="en">
<head>
    <title>
5 AWS Services You Should Avoid! - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="5 AWS Services You Should Avoid! - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@dlin128"/>
    <meta property="og:description" content="Get ready for some personal and definitely opinionated opinions!"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/teamzerolabs/5-aws-services-you-should-avoid-f45111cc10cd"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - 5 AWS Services You Should Avoid!</title>
<div class="readable">
        <h1>5 AWS Services You Should Avoid!</h1>
            <div>by https://medium.com/@dlin128</div>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 10 May 2020</div>
        <p><a href="https://medium.com/teamzerolabs/5-aws-services-you-should-avoid-f45111cc10cd">https://medium.com/teamzerolabs/5-aws-services-you-should-avoid-f45111cc10cd</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section><div><div><div><div><div><div><div><a rel="noopener" href="https://medium.com/@dlin128?source=post_page-----f45111cc10cd----------------------"><div><p><img alt="David Lin" src="https://miro.medium.com/fit/c/96/96/2*C3fNg7SpS2Py3-xFyHGv4w.jpeg" width="48" height="48"></p></div></a></div></div></div></div></div><p id="a99c" data-selectable-paragraph="">Get ready for some personal and definitely opinionated opinions!</p><p id="e1e6" data-selectable-paragraph="">AWS comes with many components that cover different areas of concerns. But, most are not general purpose and cheap enough to be applied correctly. Used in the wrong context, they end up wasting time, resources, money, and will create developer friction and frustrations for months.</p><p id="b9d5" data-selectable-paragraph="">Here are the top 5 AWS Services you should avoid:</p><ol><li id="d8fe" data-selectable-paragraph="">Cognito</li><li id="eaf9" data-selectable-paragraph="">CloudFormation</li><li id="3fcf" data-selectable-paragraph="">ElasticCache</li><li id="4888" data-selectable-paragraph="">Kinesis</li><li id="cd07" data-selectable-paragraph="">Lambda</li></ol><p id="6519" data-selectable-paragraph="">Cognito sounds great on paper. It will take care of user management for you, including Google Sign-in, Facebook Login, and handle user role assignments, reset passwords, and define password rules. It can do both Desktop and Mobile. It can work with public user pools, and private user pools (to restrict enterprise private resources).</p><p id="6a3d" data-selectable-paragraph="">Cognito will help you save time by presenting its own UI when requesting permission from users.</p><p id="23c0" data-selectable-paragraph="">Cognito has competitors: Auth0, OneLogin, Okta, to name a few. It is also possible to implement all of those above login workflows yourself, given enough time and team size.</p><p id="9534" data-selectable-paragraph="">But, if you do use Cognito for a while, ugly edges will reveal themselves. You will discover that <mark><strong>Cognito cannot be used for Native Mobile logins</strong></mark>. When you are making a mobile application, and attempting to get user to login via Facebook, if you had integrated with Firebase, it will prompt the user to open the Facebook App, and allow user to simply authenticate/authorize (assuming they are already logged in on the Facebook App).</p><p id="8254" data-selectable-paragraph="">With Cognito, they are presented with an embedded WebView, prompting the user to log into Facebook again in the embedded WebView. This creates a lot of friction, so you file tickets to the team asking about Native Logins.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/54/1*bZh3QTh5voSYu308fciWnw.png?q=20" width="1482" height="1646" role="presentation"></p><p><img width="1482" height="1646" srcset="https://miro.medium.com/max/552/1*bZh3QTh5voSYu308fciWnw.png 276w, https://miro.medium.com/max/1104/1*bZh3QTh5voSYu308fciWnw.png 552w, https://miro.medium.com/max/1280/1*bZh3QTh5voSYu308fciWnw.png 640w, https://miro.medium.com/max/1400/1*bZh3QTh5voSYu308fciWnw.png 700w" sizes="700px" role="presentation" src="https://miro.medium.com/max/1482/1*bZh3QTh5voSYu308fciWnw.png"></p></div></div></div></div><figcaption data-selectable-paragraph="">This is literally filed 16 hours ago, 2020–02–19, source: Github</figcaption></figure><p id="b651" data-selectable-paragraph="">Cognito does promise that it will work with any OAuth2 Identity provider. We thought this meant we could use it to <strong>login with WeChat</strong>, to reduce friction in user registration for Apps in China. After research, we ended up going with WeChat’s own SDK. There is no simple way of implementing simple social logins with Cognito.</p><p id="bb34" data-selectable-paragraph="">If Mobile User management is in your requirement, you would do better with Firebase Social Login. It supports Facebook and Google native social logins out of the box, and gives you enough support on the server side to create the user record for WeChat users.</p><p id="3906" data-selectable-paragraph="">There is also the option of rolling your own authentication strategy and use each of the SDK provided by Google/Apple/Facebook/WeChat. This is the safest route if you can afford the time and engineering resource. But, if you are short on manpower/time, definitely do not go with Cognito. It cannot deliver in the Mobile context.</p><p id="1021" data-selectable-paragraph="">I hate CloudFormation. I hate “Stacks.” Parameters are very clunky to work with. The formatting of the template files is super verbose. Of course, the new YAML CF is better than the old JSON CF, but it’s still tough to read long complex stacks. Also you still have an internet full of JSON CloudFormation as your body of reference.</p><p id="43a8" data-selectable-paragraph="">Circular dependency errors are soul crushing.</p><p id="a95b" data-selectable-paragraph="">Do you need to reference the attributes of one resource in a different stack? Can’t. You need to do outputs. Okay what if an output of that stack changes and needs to be reflected in the other stack? You need to remember where it’s used and perform manual intervention.</p><p id="2dcd" data-selectable-paragraph="">Do you want to modularize a piece of the infrastructure so you can reuse it across multiple resources? Sorry, you need to use “nested stacks” so you can have even more stack on stacks that are going to get stuck in IN_PROGRESS or ROLLBACK mode. To be clear, what I am saying is, do not use nested stacks.</p><p id="0e39" data-selectable-paragraph="">Lack of Drift detection or reconciliation. With lack of drift detection comes great uncertainty.</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/0*S2RjAry_aI6t21JV.png?q=20" width="565" height="318" role="presentation"></p><p><img width="565" height="318" srcset="https://miro.medium.com/max/552/0*S2RjAry_aI6t21JV.png 276w, https://miro.medium.com/max/1104/0*S2RjAry_aI6t21JV.png 552w, https://miro.medium.com/max/1130/0*S2RjAry_aI6t21JV.png 565w" sizes="565px" role="presentation"></p></div></div></div></figure><p id="9a74" data-selectable-paragraph="">I don’t like all the <code>Fn:sub</code>, <code>! Ref</code>, <code>Fn:join</code>. I honestly cannot imagine a whole infrastructure with multiple accounts, VPCs, subnets, peering connections documented entirely in CloudFormation.</p><p id="363d" data-selectable-paragraph=""><strong>Luckily the solution is easy! </strong>Use Terraform! Terraform is super awesome and we have been using it since early 2012. It’s cloud agnostic. You have a great module system that you can use and leverage heavily without fearing for your life.</p><p id="6aac" data-selectable-paragraph="">You can even do logic on top of these modules to add or not add resources based on variables using terraform’s <code>count</code> attribute.</p><p id="8a38" data-selectable-paragraph="">Here’ s a great article about <a href="https://www.hashicorp.com/blog/detecting-and-managing-drift-with-terraform/" target="_blank" rel="noopener nofollow">drift</a> with Terraform.</p><p id="cd3a" data-selectable-paragraph="">HCL is beautiful to read and write. Terraform <code>plan</code> is amazing for studying infrastructure changes and giving you the confidence that you are changing what you expect. (Yes CF has changesets if you must).</p><p id="87b8" data-selectable-paragraph="">Moral of the story is, use terraform to destress yourself. Use terraform so that you do not spend a whole day fretting over how you will possibly make changes to a stack that is depended on from above and below by other stacks. Terraform <code>plan</code>. Terraform <code>apply</code>.</p><p id="d0f4" data-selectable-paragraph="">Many a startup has fallen prey to ElastiCache. It usually happens when the team is under-staffed and rushing for a deadline and they type in <code>Redis</code> into the AWS console:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*qic_MdC6_uLIv7lwCOgQzA.png?q=20" width="320" height="177" role="presentation"></p><p><img width="320" height="177" srcset="https://miro.medium.com/max/552/1*qic_MdC6_uLIv7lwCOgQzA.png 276w, https://miro.medium.com/max/640/1*qic_MdC6_uLIv7lwCOgQzA.png 320w" sizes="320px" role="presentation"></p></div></div></div><figcaption data-selectable-paragraph="">Horray out of the box Redis that I don’t need to deploy!</figcaption></figure><p id="1d90" data-selectable-paragraph="">On the setup screen, you name your cluster, accept the defaults.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*TP_MryViXxSS3ClkgiYJ5A.png?q=20" width="774" height="416" role="presentation"></p><p><img width="774" height="416" srcset="https://miro.medium.com/max/552/1*TP_MryViXxSS3ClkgiYJ5A.png 276w, https://miro.medium.com/max/1104/1*TP_MryViXxSS3ClkgiYJ5A.png 552w, https://miro.medium.com/max/1280/1*TP_MryViXxSS3ClkgiYJ5A.png 640w, https://miro.medium.com/max/1400/1*TP_MryViXxSS3ClkgiYJ5A.png 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="9ce4" data-selectable-paragraph="">Voila! Begin using Redis. Perfect.</p><p id="3381" data-selectable-paragraph="">Obviously it works great.</p><p id="9d6c" data-selectable-paragraph="">What’s the problem? It is expensive, and no one notices for months. We’ve seen this happen a few times already when we did cost analysis for a couple clients. Firstly, the default gives you a cluster with beefy <code>cache.r5.large</code> instance. Secondly that cache.* prefix means this instance costs <strong>$0.216/hr</strong> instead of <strong>$0.126/hr</strong>, a <strong>71.4%</strong> premium. Then you might think you need one for dev, qa, and prod. That all adds up to $$$. You don’t want to be the one who caused the $3000 ElastiCache line item on the AWS bill.</p><p id="85dd" data-selectable-paragraph="">Run a Docker redis in ec2 for a while first. Make sure it serves your purposes. Figure out how the sizing works for you. Remember redis is meant to hold ephemeral data in memory, so please don’t treat it as a DB. It’s best to design your system assuming that redis may or may not lose whatever is inside. Clustering or HA via Sentinel, can all come later when you know you need it!</p><p id="884d" data-selectable-paragraph="">Kinesis, in Amazon’s own words:</p><pre><span id="fa66" data-selectable-paragraph="">Amazon Kinesis makes it easy to collect, process, and analyze real-time, streaming data so you can get timely insights and react quickly to new information.</span></pre><p id="c512" data-selectable-paragraph="">Streaming data such as video processing/uploading are a good fit for Kinesis. But, not all data/records/events should go into Kinesis. <strong>It is not a general purpose enterprise event bus or queue</strong>.</p><p id="41c7" data-selectable-paragraph="">A little context:</p><p id="0c54" data-selectable-paragraph="">We once joined on a project midway, and have to support an ETL pipeline that included Kinesis in the deployment. The application collected small json records, and stuffed them into Kinesis with the <code>python boto3 api</code> . On the other side, worker process running inside EC2/ECS were pulling these records with boto3 and processing them. We then discovered that retrieving records out of Kinesis Streams when you have multiple worker is non-trivial.</p><pre><span id="02ee" data-selectable-paragraph="">You can develop a consumer application for Amazon Kinesis Data Streams using <a href="https://docs.aws.amazon.com/streams/latest/dev/developing-consumers-with-kcl.html" target="_blank" rel="noopener nofollow">the Kinesis Client Library (KCL)</a>. Although you can use the Kinesis Data Streams API to get data from a Kinesis data stream, we recommend that you use the design patterns and code for consumer applications provided by the KCL.</span></pre><p id="4fd9" data-selectable-paragraph="">Imagine if you are running 4 workers, and they are all listening to the same Kinesis stream for events. How do we prevent them from working on the same events? In traditional queueing systems, you use locks and owner columns to ensure each task is handled by only one worker. Amazon SQS will mark a message as busy when one of the worker is working on the message, so that other workers do not do duplicate work.</p><p id="b6b2" data-selectable-paragraph="">To implement the same pattern with Kinesis Stream, you must implement KCL, which is written in Java (nothing wrong with Java). The KCL agent will be spun up as a second daemon process in the background, and send events to your application when it itself receives events.</p><p id="abcd" data-selectable-paragraph="">This means: <strong>all of your python/ruby/node docker images that handles records from Kinesis must install Java dependencies and run the KCL java process in the background</strong>. KCL communicates with the main program via std-in/out/err, so logging from the main application becomes problematic as well! If you have a bug in the application, you will not be able to print out relevant logs to STDOUT, because it will cause errors in the KCL agent.</p><p id="95e0" data-selectable-paragraph="">Furthermore, in order to have multiple workers, Kinesis Streams require you to use multiple shards. Each worker will make claim to a shard. More shards = more bills. This worker to shard mapping is stored in DynamoDB! So, to recap: in order to use Kinesis as an enterprise queue, you must:</p><ol><li id="792b" data-selectable-paragraph="">Bundle KCL agents into your running environment, which increases load and run time, and makes logging errors complicated.</li><li id="3492" data-selectable-paragraph="">Buy multiple shards to work on things in parallel.</li><li id="5697" data-selectable-paragraph="">Buy more storage space in DynamoDB, to label which worker can work on which shard.</li></ol><p id="7191" data-selectable-paragraph="">It is both cumbersome and difficult to apply Kinesis stream correctly, especially when you are looking for an enterprise queue. You would do better by using SNS/SQS combination, or using a queuing framework that sits on top of Redis or traditional databases.</p><p id="f151" data-selectable-paragraph="">Lambdas are great for the following tasks:</p><ol><li id="52fd" data-selectable-paragraph="">Serving/Redirecting requests to CloudFront.</li><li id="97bf" data-selectable-paragraph="">Reacting to events from SNS or SQS — Small asynchronous tasks such as Image transformation (write to S3), OCR, and ETL (When volume is small and you can batch process).</li></ol><p id="7990" data-selectable-paragraph="">Lambda is <strong><em>horrible</em></strong> for:</p><p id="2120" data-selectable-paragraph=""><strong>A replacement for REST API endpoints.</strong></p><p id="911b" data-selectable-paragraph="">Take an example of online book shopping REST api:</p><ul><li id="5cf7" data-selectable-paragraph="">/api/v1/books — GET/POST/PUT/DELETE</li><li id="a1f6" data-selectable-paragraph="">/api/v1/users — GET/POST/PUT</li><li id="92e3" data-selectable-paragraph="">/api/v1/carts — GET/POST/PUT/DELETE</li><li id="e6f0" data-selectable-paragraph="">/api/v1/search — GET</li><li id="d457" data-selectable-paragraph="">/api/v1/stats — GET</li><li id="4bf2" data-selectable-paragraph="">… Many more.</li></ul><p id="6b9d" data-selectable-paragraph="">A mature internal REST API endpoints can and will have hundreds of REST routes.</p><p id="191a" data-selectable-paragraph="">Normally, a company may choose an API gateway or Nginx to mount multiple microservices, one for books, one for users, one for carts, etc. Or, they might wise up and use a monolith and put all 4 modules into one backend repository.</p><p id="d01a" data-selectable-paragraph="">With the Lambda server-less paradigm, you end up with 1 lambda function per route.</p><p id="0c5f" data-selectable-paragraph="">Each deployment now means you are pushing updates for hundreds of lambda resources.</p><p id="ea75" data-selectable-paragraph="">It becomes difficult to test single routes and look at the code in AWS’s Lambda UI. Each lambda is configured via Environment variables individually. If you have 5 variables to connect into a MySQL RDS instance, it suddenly means you have 5 * 100 routes = 500 variables to configure inside the cloud formation template.</p><p id="f8ca" data-selectable-paragraph="">Furthermore, each of them will try to establish database connections when handling requests. There is literally no out of box way to share resources between lambdas for beginners.</p><p id="5660" data-selectable-paragraph="">Next, QA comes to you and ask about a backend to use with QA environments. You proceed to add “QA-” prefix to all lambda names and look at the lambda dashboard. Now, you have twice as many as small lambdas.</p><p id="54a1" data-selectable-paragraph="">Next, DevOps comes to you and ask about a backend to use with Production environments. You proceed to add “Prod-” prefix to all lambda names and look at the dashboard. Now, you have thrice as many as small lambdas.</p><p id="425a" data-selectable-paragraph="">You then discover bugs within your code, leading to request handler throwing <em>HTTP 500</em> errors, customers complain about things not working. <strong>You dig into CLOUD WATCH logs</strong>. We have three sets of logs all intermixed together. This is unreadable.</p><p id="04ee" data-selectable-paragraph="">A couple of weeks later, you discover that a teammate checked in code such that lambdas are now calling each other recursively. This is really bad, because we no longer know how long a request can take now to complete. This is not a Lambda only problem, microservices can call each other by mistakes (and this is why we should <a target="_blank" rel="noopener" href="https://medium.com/teamzerolabs/micro-services-dont-use-them-yet-f58a2758d8f9?source=friends_link&amp;sk=bb34f9139002b646a8671a34ccd413a2">use Monoliths when we can</a>).</p><p id="00a2" data-selectable-paragraph="">QA comes to you, <strong>they are asking how they can run the entire backend stack locally with docker (A reasonable thing to ask)</strong>, so they can run selenium or cucumber tests against it. How would you do it when you have several hundreds routes, each tied up in a small lambda? You can’t. Your laptop is not powerful enough to run all of the routes at once.</p><p id="3eab" data-selectable-paragraph="">DevOps comes to you, <strong>we would also like to run unit tests in CircleCI or Jenkins to test your feature branch before it gets merged in.</strong> But, we have limited computing resources and cannot spin up hundreds of small docker processes just to run the unit tests.</p><blockquote><p id="0bb5" data-selectable-paragraph="">What should have stayed as a Monoliths or small and separate microservices are now impossible to run all at once in a local environment.</p></blockquote><p id="b573" data-selectable-paragraph="">Do not attempt to use Lambda for REST API endpoints if you treasure your delivery time, sanity, and work throughput. Use a regular web framework for implementing REST APIs: express/flask/spring/go-revel/rails. They all work as intended, and you will have an easier time using them.</p><p id="60b7" data-selectable-paragraph="">Well there you go. 5 AWS Services we love to hate. Obviously there are proper ways to use all of these, but if you are new, tread carefully or learn some design patterns from experts!</p><p id="6f69" data-selectable-paragraph="">Triggered? Let us have it in the comments or clap us to our senses!</p><p id="af1b" data-selectable-paragraph="">Check out more from us below!</p></div></div></section></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>