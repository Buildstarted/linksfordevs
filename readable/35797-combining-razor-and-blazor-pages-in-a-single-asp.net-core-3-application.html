<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Combining Razor and Blazor Pages in a Single ASP.NET Core 3 Application -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Combining Razor and Blazor Pages in a Single ASP.NET Core 3 Application</h1><div><div itemprop="articleBody"><p><a href="https://mikaelkoskinen.net/posts/files/0a37281a-ec6c-4587-b144-811fd2031de6.gif"><img title="32d51f27-44ec-4fa8-8801-3dc8692e3ae7[5]" alt="32d51f27-44ec-4fa8-8801-3dc8692e3ae7[5]" src="/posts/files/0da65024-5b2a-4bdd-8c5d-48bcc567d1f6.gif" width="732" height="308"></a></p><p>This post shows you can add Blazor based pages into an existing Razor Pages application.&nbsp;</p><h3>Background</h3><p>First RTM release of Blazor <a href="https://www.dotnetconf.net/" target="_blank">should happen in two weeks</a>. Things are still changing quite rapidly, and the latest preview 9 made the interop between Razor Pages and Blazor components much harder: <a href="https://github.com/aspnet/AspNetCore/issues/13721" target="_blank">It’s not possible anymore to pass parameters</a> from a Razor Page to a Blazor component using Html.RenderComponentAsync. This may change in future but it’s quite likely that .NET Core 3.0 will arrive with this limitation.</p><p>If you still would like to enhance your existing Razor Pages based application with some Blazor magic, one solution is completely create your pages in Blazor. This post shows you can add Blazor based pages into an existing Razor Pages application, where parts of the app are created using Razor Pages and parts of the app are created using Blazor Pages. <strong>Same layout</strong> is used for both types of pages.</p><h3>Step One: Blazor support</h3><p>We start with an existing Razor Pages application which has been converted to .NET Core 3:</p><p><a href="https://mikaelkoskinen.net/posts/files/411b4040-2260-4970-8c6f-dff451a02999.png"><img title="image" border="0" alt="image" src="/posts/files/f84c9078-9ec9-4f95-9e93-d896ac0d5e13.png" width="424" height="182"></a></p><p>First, you have to add Blazor support into your application. This support will allow you to render Blazor components from a Razor page. The <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/hosting-models?view=aspnetcore-3.0" target="_blank">official documentation</a> goes through the process but here’s a quick rundown of it.</p><p><strong>Startup.cs:</strong></p><p>Services.AddServerSideBlazor is needed in ConfigureServices and endpoints.MapBlazorHub in Configure:</p><p><a href="https://mikaelkoskinen.net/posts/files/9c38a75e-0ef9-4a90-81a8-6543f27e7bc2.png"><img title="image" border="0" alt="image" src="/posts/files/6ffd6bc7-25f3-454b-bd66-7a3872e0a34e.png" width="338" height="370"></a></p><p><strong>_Layout.cshtml:</strong></p><p>Blazor’s JS-library is needed in order to enable server side Blazor. This can be added into _Layout.cshtml:</p><p><a href="https://mikaelkoskinen.net/posts/files/2af083e8-31a5-420d-aac3-b6a908f730af.png"><img title="image" border="0" alt="image" src="/posts/files/dd9c9c4a-f4b3-4f92-9487-8ed5b272e664.png" width="327" height="156"></a></p><pre class="brush:js;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">    &lt;script src="_framework/blazor.server.js"&gt;&lt;/script&gt;</pre><p><strong>_Imports.razor:</strong></p><p>We also need a new file called _Imports.razor. This should be added into the Pages-folder:</p><p><a href="https://mikaelkoskinen.net/posts/files/4112591a-6c69-42e5-a8f3-d93754a839f3.png"><img title="image" border="0" alt="image" src="/posts/files/2b232f7e-2e9c-4315-8999-9e63f6ad53dc.png" width="398" height="221"></a></p><p>_Imports.razor is used to set the using-statements for your Blazor components. We can start with the following:</p><pre class="brush:csharp;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">@using System.Net.Http
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Components.Web</pre><p><strong>And that’s it.</strong>We now should have a working Blazor-support in our existing app. We can test this out by copy-pasting the classic Counter-component into our app:</p><p><a href="https://mikaelkoskinen.net/posts/files/0a496931-2aac-49be-8e6b-8ee9b485421e.png"><img title="image" border="0" alt="image" src="/posts/files/845f63c5-130c-4ffe-aa9f-0d9b937372c5.png" width="383" height="239"></a></p><pre class="brush:csharp;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">@page "/counter"

&lt;h1&gt;Counter&lt;/h1&gt;

&lt;p&gt;Current count: @currentCount&lt;/p&gt;

&lt;button class="btn btn-primary" @onclick="IncrementCount"&gt;Click me&lt;/button&gt;

@code {
    int currentCount = 0;

    void IncrementCount()
    {
        currentCount++;
    }
}
</pre><p>And then editing Privacy.cshtml to include the Counter component:</p><pre class="brush:csharp;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">@page
@model PrivacyModel
@{
    ViewData["Title"] = "Privacy Policy";
}
&lt;h1&gt;@ViewData["Title"]&lt;/h1&gt;

&lt;p&gt;Use this page to detail your site's privacy policy.&lt;/p&gt;

&lt;component&gt;@(await Html.RenderComponentAsync&lt;Counter&gt;(RenderMode.Server))&lt;/component&gt;</pre><p>Now when we run the app, we should have a working Counter component inside our page:</p><p><a href="https://mikaelkoskinen.net/posts/files/1f6a1c6c-f7ef-425c-9510-d8c0762af7ef.gif"><img title="9cae988e-879b-4bf5-80cf-c5622a5e0a36" alt="9cae988e-879b-4bf5-80cf-c5622a5e0a36" src="/posts/files/fea2b5c6-ae5e-416c-83fb-09553c98e4e5.gif" width="504" height="227"></a></p><p>Next part of this post show you can change your Razor Pages application so that instead of just adding components into existing pages, you can create full-blown Blazor pages.</p><h3>Step Two: Blazor Pages support</h3><p>Our Blazor component defines a route “/counter”:</p><p><a href="https://mikaelkoskinen.net/posts/files/dba579fb-8cc0-46ac-a3a0-fefb6a119b25.png"><img title="image" border="0" alt="image" src="/posts/files/f51d1cc0-2d70-4abf-9ad3-2c9f310d8920.png" width="244" height="96"></a></p><p>But navigating there doesn’t work:</p><p><a href="https://mikaelkoskinen.net/posts/files/08874aa7-c907-421a-b80c-92e92e5fb71f.png"><img title="image" border="0" alt="image" src="/posts/files/bb30a4cf-032f-4805-8b89-27f5cc4777b2.png" width="352" height="287"></a></p><p>Our aim in step two is to make the routing to Blazor Pages work. And we want the Blazor Pages to use the same layout as the Razor Pages. For this we need a few things, starting with a <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/routing?view=aspnetcore-3.0" target="_blank">Router</a>.</p><p><strong>App.razor:</strong></p><p>Create a new App.razor file into Pages-folder:</p><p><a href="https://mikaelkoskinen.net/posts/files/d6974c13-edee-467b-bd0c-5bb0a1b385e5.png"><img title="image" border="0" alt="image" src="/posts/files/8368ca59-46d9-4ef9-9f14-306188ca3a18.png" width="241" height="290"></a></p><p>The Router component is defined in App.razor:</p><pre class="brush:js;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">@using Microsoft.AspNetCore.Components.Routing

&lt;Router AppAssembly="typeof(Program).Assembly"&gt;
    &lt;Found Context="routeData"&gt;
        &lt;RouteView RouteData="routeData"/&gt;
    &lt;/Found&gt;
    &lt;NotFound&gt;
        &lt;h1&gt;Page not found&lt;/h1&gt;
        &lt;p&gt;Sorry, but there's nothing here!&lt;/p&gt;
    &lt;/NotFound&gt;
&lt;/Router&gt;</pre><p>The router automatically goes through all the Blazor Components with the page-directive and adds routes to them.</p><p><strong>_Host.cshtml:</strong></p><p>We also need a page which will be used to host the Blazor pages. This can be named anyway you want but the default Blazor templates use _Host.cshtml so it’s as good name as any. In the _Host.cshtml we can define the layout which in our case will be the same as the Razor pages are using.</p><p><a href="https://mikaelkoskinen.net/posts/files/a5ba48c2-d471-409c-89a9-2e4498bfa149.png"><img title="image" border="0" alt="image" src="/posts/files/b86eaece-90cc-4899-b157-0f4e8400b816.png" width="244" height="201"></a></p><p>_Host.cshtml contains the call to Html.RenderComponentAsync:</p><pre class="brush:js;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">@page "/blazor"

@{
    Layout = "_Layout";
}

&lt;app&gt;
    @(await Html.RenderComponentAsync&lt;App&gt;(RenderMode.Server))
&lt;/app&gt;</pre><p><strong>Startup.cs:</strong></p><p>And last, a small addition to Startup.cs’ Configure-method. We previously added MapBlazorHub but now we also add call to MapFallbackToPage and point it to the new _Host.cshtml:</p><p><a href="https://mikaelkoskinen.net/posts/files/6ea55847-46c1-4ba1-a110-36c761398b52.png"><img title="image" border="0" alt="image" src="/posts/files/64eb55a1-cbe1-457f-b589-de8b517e7492.png" width="315" height="160"></a></p><p>And that’s it! Now we just need to test our setup. Add Blazor page Counter into your layout by editing Pages/Shared/_Layout.cshtml:</p><p><a href="https://mikaelkoskinen.net/posts/files/ea861a85-1dc7-4fea-888a-cd097b9466d7.png"><img title="image" border="0" alt="image" src="/posts/files/f8d0f610-792a-4b51-8bd9-24666ab67506.png" width="478" height="138"></a></p><p>When we now start out application, we should have a working Blazor page in our Razor Pages application:</p><p><a href="https://mikaelkoskinen.net/posts/files/c11e803a-2dc0-4f1a-9c05-acf28d5d8226.gif"><img title="b8af1ec4-9549-4489-a15f-0b62e11ae2a7" alt="b8af1ec4-9549-4489-a15f-0b62e11ae2a7" src="/posts/files/d12dd600-88a2-4d6f-9f67-73782f84e1f0.gif" width="776" height="327"></a></p><p>And we didn’t break the support for adding Blazor components into Razor Pages:</p><p><a href="https://mikaelkoskinen.net/posts/files/d7b775a2-e9ee-499b-9488-5830426b2d73.gif"><img title="32d51f27-44ec-4fa8-8801-3dc8692e3ae7" alt="32d51f27-44ec-4fa8-8801-3dc8692e3ae7" src="/posts/files/ae5a3570-19c1-4122-9cb9-46f8da5d8e88.gif" width="784" height="330"></a></p><h3>Notes</h3><p>There’s couple things to note:</p><ul><li>Blazor routes only work when they point into root. If “/counter” is changed to for example “/products/counter”, the page can’t load the required blazor.server.js. Instead it gives 404. It should be possible to modify the script-tag so that it can load the required script no matter the location but this seems to have changed from Preview 8 to Preview 9 and I couldn’t get it to work. Here’s a screenshot of the 404 showing the problem:</li></ul><p><a href="https://mikaelkoskinen.net/posts/files/f23d3875-5d9d-4527-8dc8-9703d333bc45.png"><img title="image" border="0" alt="image" src="/posts/files/e3732975-7fa3-49a4-8761-051a4f2ad148.png" width="471" height="86"></a></p><ul><li>If you get the script to load, you probably encounter the same issues with the Blazor hub: The scripts tries to find the hub from /products/blazor instead of blazor. To get around this, you can manually start the connection between the server and the browser:</li><pre class="brush:js;auto-links:true;collapse:false;first-line:1;gutter:true;html-script:false;light:false;ruler:false;smart-tabs:true;tab-size:4;toolbar:true">&lt;script src="~/_framework/blazor.server.js" autostart="false"&gt;&lt;/script&gt;
&lt;script&gt;
  Blazor.start({
    configureSignalR: function (builder) {
      builder.withUrl('/_blazor');
    }
  });
&lt;/script&gt;</pre></ul><h3>Sample code</h3><p>Sample code for this project is available from GitHub: <a href="https://github.com/mikoskinen/blog/tree/master/blazor-pages-razor-pages-single-app">https://github.com/mikoskinen/blog/tree/master/blazor-pages-razor-pages-single-app</a></p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>