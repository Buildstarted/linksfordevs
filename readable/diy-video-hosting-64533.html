<!DOCTYPE html>
<html lang="en">
<head>
    <title>
DIY Video Hosting - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="DIY Video Hosting - linksfor.dev(s)"/>
    <meta property="article:author" content="Posted by Tyler Hall on July 20, 2020 in"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://tyler.io/diy-video-hosting/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - DIY Video Hosting</title>
<div class="readable">
        <h1>DIY Video Hosting</h1>
            <div>by Posted by Tyler Hall on July 20, 2020 in</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 20 Jul 2020</div>
        <p><a href="https://tyler.io/diy-video-hosting/">https://tyler.io/diy-video-hosting/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
			<div>
<p>I've been a paying customer of <a href="https://vimeo.com/">Vimeo</a> since 2014 - specifically, their Pro plan.</p>
<p><img src="https://cdn.tyler.io/blog/vimeo-order.png" alt="Vimeo order receipt from 2014"></p>
<p>(Please ignore that the above email receipt is for their <em>Plus</em> plan. Shortly after subscribing I realized I needed to upgrade to <em>Pro</em>, which supports commercial use.)</p>
<p>I needed a reliable way to host a bunch of screencasts and video tutorials I was producing for <a href="https://clickontyler.com/">my software</a>. I went with Vimeo because they're the obvious choice in this space for two main reasons:</p>
<ol>
<li>I didn't want my content hosted on YouTube where it would be surrounded on all sides by an infinite expanse of flaming garbage. (Don't take that criticism too harshly - I'm a happy YouTube Premium subscriber.)</li>
<li>Vimeo is really, really, really good at what they do. I mean, supremely top-notch when it comes to ease-of-use, controlling the end-user experience, speed, and quality.</li>
</ol>
<p>But when my renewal email arrived in April, myself and other small developers were seeing sales slow down as the pandemic worsened.</p>
<p><img src="https://cdn.tyler.io/blog/vimeo-pricing.png" alt="Vimeo pricing chart"></p>
<p>Another $240/year was a tough sell for the small amount of video content I was hosting with them, and I wondered if there might be a cheaper alternative - either another service or by hosting videos myself.</p>
<p>If you're posting commercial content - like I often do - Vimeo's terms require you to be a Pro subscriber or higher. And to be clear, I <em>still</em> think Vimeo at that price (at almost any price, really) is a great value. It's cheaper than a company with four employees paying for Slack.</p>
<p>But at my tiny scale and thinking about cutting costs, given the amount of video content I'm actually posting each month and hosting with them, and also being a huge nerd, it didn't make sense any longer.</p>
<p>So, let's do this ourselves.</p>
<p>We need three things:</p>
<ol>
<li>Somewhere (cheaper than Vimeo) to serve video from.</li>
<li>A way to play the video on our website.</li>
<li>An easy way to convert raw video into an appropriate size and format for streaming.</li>
</ol>
<p>So, where to actually host the video files? My requirements are somewhere reliable that won't fall over if you get Slashdotted (ha, remember that?), can deliver quickly to visitors in any location, and won't bankrupt you.</p>
<p>I have plenty of space available (and almost always enough bandwidth available) on my <a href="https://www.linode.com/?r=d6996df66d7b3fadb1521d495fe108c5041fb77c">Linode</a> (affiliate link - but Linode is <em>wonderful</em>) servers. But even my primary $20/month VPS with them was brought to its knees multiple times when traffic spiked. (Granted, I was running WordPress at the time.) And I don't want to take the chance of my business website going down because one of my dumb blog posts on this website gets noticed.</p>
<p>A lifetime ago, <a href="https://tyler.io/using-amazon-s3-as-a-content-delivery-network/">I wrote about using S3 as a poor man's content delivery network</a>. That's still an easy and reliable choice, but the cost for bandwidth doesn't scale as a true CDN. Which is, of course, why Amazon offers CloudFront. But even then, at $0.085/GB, I've had multiple months in the past calendar year that would have been over $200.</p>
<p>Instead, let me introduce you to my secret weapon: <a href="https://bunnycdn.com/?ref=nf65m68954">BunnyCDN</a>. (I get credit if you click that link. But I only use it because I completely love their service as you'll see below.)</p>
<p>I switched to Bunny last October after using <a href="https://www.stackpath.com/maxcdn/">MaxCDN</a> (now StackPath) since 2011 for all of my static assets. And I've been utterly flabbergasted at just how damn good they are. For a number of reasons:</p>
<ol>
<li>The main metric that matters: they're really fast. I'm seeing equivalent performance as what I was used to with MaxCDN and the larger CDNs I've used at my day job.</li>
<li>The two times I've needed to email them with a support question, a knowledgable, helpful human has replied quickly and without needing to go through dumb self-serve solutions.</li>
<li>Bunny's control panel where you manage your account, choose bandwidth settings, etc. is super easy to use and incredibly powerful (at least for my needs). It's a really nice change from what I had with MaxCDN and the AWS Console (powerful as hell, but obtuse).</li>
<li>Holeeeee crap their bandwidth is cheap.</li>
</ol>
<p>For my static website assets (images, stylesheets, JavaScript, etc.) I use Bunny's standard tier, which serves my content from all of their PoPs. That means visitors will connect to the server closest to them at $0.01/GB (for US and EU PoPs).</p>
<p>However, my video content uses their volume tier, which is distributed from 7 PoPs (instead of 41). While still being plenty fast enough, that reduces the cost further to $0.005/GB. That works out to a cool $5/TB when my traffic spikes.</p>
<p>I have zero understanding of how bandwidth is actually priced globally between providers or why some companies charge such a premium compared to others for the same bits over the wire. I assume you're paying for reliability and/or speed? All I know is that I haven't seen a blip of downtime or noticed any slowness in the nine months I've used BunnyCDN. I can't explain how they can be <em>so</em> much less expensive. Maybe they won't scale to "real" traffic? But for what I need, they've been a phenomenal choice.</p>
<p>(Ok, I'm done going on and on about them now. This really isn't any sort of paid or sponsored content crap for Bunny. I've just been so impressed since switching, that I finally wanted to give them recognition.)</p>
<p>So that's my answer to point #1 - where to host the video files.</p>
<p>The next thing we need is a way to show those videos inline on your website.</p>
<p>Gone are the days of embedded Flash video. Now, you can mostly get away with just using the native HTML5 video element.</p>
<p>However, if you want more control over the appearance of your video and how it behaves, take a look at <a href="https://videojs.com/">Video.js</a>. It's a wonderful open source player from the kind folks at Brightcove that provides a similar level of control as the point and click customization options that Vimeo offers.</p>
<p>The last puzzle piece is getting your original videos into a web-friendly format and uploading them for distribution.</p>
<p>BunnyCDN offers their own online storage zones that you can simply upload to via FTP, but for historical reasons, I still store my large app downloads and videos on S3 and then have Bunny (and previously MaxCDN) pull from AWS as an origin server.</p>
<p>And as for the correct video format, I'm using <a href="https://handbrake.fr/docs/en/latest/cli/cli-options.html">Handbrake's command line interface</a> to convert my source videos files into <code>mp4</code> using the <code>Vimeo YouTube HQ 720p60</code> and <code>Vimeo YouTube HQ 1080p60</code> presets.</p>
<p>But, because, hey, I'm a geek who doesn't like doing extra work, I've wrapped up the whole process into a short shell script that</p>
<ol>
<li>Converts the source video to 720p</li>
<li>Converts the source video to 1080p</li>
<li>Uses <a href="https://tidbits.com/2016/02/12/os-x-hidden-treasures-quick-look/"><code>qlmanage</code></a> to output a frame of the video as a <code>png</code> for previewing in the HTML player before the video starts</li>
<li><a href="https://imagemagick.org/index.php"><code>imagemagick</code></a> to convert that <code>png</code> to a <code>jpg</code></li>
<li>Uploads all three assets to S3 with <a href="https://s3tools.org/s3cmd"><code>s3cmd</code></a></li>
<li>Outputs the custom shortcode I use to embed videos in my blog posts</li>
</ol>
<p>I just pass my video's filename to that script, and a few minutes later I can copy and paste the output into my text editor and make it available on my website. Honestly, it's an even faster process than using Vimeo.</p>
<p>Here's the script. You'll of course want to modify the paths to make it work with your own setup since it's completely specific to my needs right now.</p>
<div><pre><span></span><span>#!/bin/bash</span>

<span>bucket</span><span>=</span><span>$1</span>

<span>base</span><span>=</span><span>$(</span>basename -- <span>"</span><span>$2</span><span>"</span><span>)</span>
<span>extension</span><span>=</span><span>"</span><span>${</span><span>base</span><span>##*.</span><span>}</span><span>"</span>
<span>filename</span><span>=</span><span>"</span><span>${</span><span>base</span><span>%.*</span><span>}</span><span>"</span>

<span>p720</span><span>=</span><span>"/Users/thall/Dropbox/Freelance/Videos/720p/</span><span>$filename</span><span>.mp4"</span>
<span>p1080</span><span>=</span><span>"/Users/thall/Dropbox/Freelance/Videos/1080p/</span><span>$filename</span><span>.mp4"</span>
<span>png</span><span>=</span><span>"/Users/thall/Dropbox/Freelance/Videos/jpg/</span><span>$base</span><span>.png"</span>
<span>jpg</span><span>=</span><span>"/Users/thall/Dropbox/Freelance/Videos/jpg/</span><span>$filename</span><span>.jpg"</span>

/usr/local/bin/HandBrakeCLI -Z <span>"Vimeo YouTube HQ 720p60"</span> -i <span>"</span><span>$2</span><span>"</span> -o <span>$p720</span>
/usr/local/bin/HandBrakeCLI -Z <span>"Vimeo YouTube HQ 1080p60"</span> -i <span>"</span><span>$2</span><span>"</span> -o <span>$p1080</span>

/usr/bin/qlmanage -t <span>"</span><span>$2</span><span>"</span> -s <span>1080</span> -o <span>"/Users/thall/Dropbox/Freelance/Videos/jpg/"</span>
/usr/local/bin/magick convert <span>$png</span> <span>$jpg</span>
rm <span>$png</span>

s3cmd put --acl-public --guess-mime-type <span>$p720</span> <span>"s3://</span><span>$bucket</span><span>/720p/</span><span>$base</span><span>"</span>
s3cmd put --acl-public --guess-mime-type <span>$p1080</span> <span>"s3://</span><span>$bucket</span><span>/1080p/</span><span>$base</span><span>"</span>
s3cmd put --acl-public --guess-mime-type <span>$jpg</span> <span>"s3://</span><span>$bucket</span><span>/jpg/</span><span>$filename</span><span>.jpg"</span>

<span>echo</span> <span>"[tylervideo url="</span><span>$base</span><span>" img="</span><span>$filename</span><span>.jpg"]"</span>
</pre></div>

<p>So that's how I moved off Vimeo and started hosting my video content myself. On average, my bandwidth bill is about $11/month - and that includes videos, static assets, and ALSO binary downloads for all of my Mac apps. Previously, I was paying $20/month <em>just</em> for video hosting on top of the rest of my bandwidth.</p>
<p>It's definitely a geekier solution that requires more work up front to setup, and I'm not sure I would recommend it for a "real" business, but for my needs it was a fun project and I'm happy to save $200 a year.</p>
			</div>
		</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>