<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Just an environment variable away from sleep -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Just an environment variable away from sleep</h1>
    <div><section class="cu cv cw cx cy"><div class="n p"><div class="ac ae af ag ah cz aj ak"><div><div class="dm"><div class="n dn do dp dq"><div class="o n"><div><a href="https://link.medium.com/@devlead?source=post_page-----15013adc8cb6----------------------"><img alt="Mattias Karlsson" class="r dr ds dt" src="https://miro.medium.com/fit/c/96/96/1*b0O0u4yeDzrj3n7yTckSvA.png" width="48"></a></div><div class="du ak r"><span class="bj b bk bl bm bn r bo bp"><span class="bj dx dy bl dz ea eb ec ed ee bo"></span></span></div></div></div></div></div><p id="074c" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">It&#x2019;s a quarter past midnight, you should be going to sleep, but there&#x2019;s that one unit test that fails only on GitHub Action macOS build agent &#x2014; it&#x2019;s mocking you so you stay awake just a bit longer&#x2026;</p><figure class="ft fu fv fw fx fy cl cm paragraph-image"><img alt="GitHub PR build status 1 of 14 failing, GitHub action macOS" class="cp t u gb ak" src="https://miro.medium.com/max/1344/1*_NUZOnpZj_P9xZkgpfKPcw.png" width="672"></figure><p id="2678" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">You bring out you Mac and execute tests, fortunately we can reproduce &#x2014; the test fails on your machine too! A quick inspection of test output informs you that error only occurs on .NET Core.</p><p id="7edb" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Unfortunately, today neither VS Mac nor VSCode for some reason is your friend, solutions won&#x2019;t build, tests aren&#x2019;t found, break points aren&#x2019;t hit and so on.</p><p id="aa32" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Probably not their fault at all, more likely a case of complex multi target solution, having preview versions and just being too tired.</p><p id="8418" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Fortunately, as the .NET CLI &#x201C;dotnet test&#x201D; command executed by the build script compiled and executed the tests, one could leave the VS Mac/Code IDE tooling debugging for another day and trigger debugging from the command line.</p><p id="b6f6" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">This is achieved by setting the environment variable <strong class="fg gm"><em class="gn">VSTEST_HOST_DEBUG</em></strong> to <strong class="fg gm"><em class="gn">1</em></strong></p><pre class="ft fu fv fw fx go gp gq"><span id="53d8" class="gr gs dc bk gt b dy gu gv r gw">Bash:<br>export VSTEST_HOST_DEBUG=1</span><span id="687c" class="gr gs dc bk gt b dy gx gy gz ha hb gv r gw"><span class="r hc hd he hf hg hh hi hj hk gf">P</span>owerShell:<br>$env:VSTEST_HOST_DEBUG=1</span></pre><p id="952e" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Now when executing the test (specifying only the framework I want to test)</p><pre class="ft fu fv fw fx go gp gq"><span id="b836" class="gr gs dc bk gt b dy gu gv r gw">dotnet test My.Tests.csproj &#x2014; framework=netcoreapp3.0</span></pre><p id="9f80" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">It&#x2019;ll will pause and wait for a debugger to attach.</p><pre class="ft fu fv fw fx go gp gq"><span id="0f29" class="gr gs dc bk gt b dy gu gv r gw">Microsoft (R) Test Execution Command Line Tool Version 16.3.0<br>Copyright (c) Microsoft Corporation.  All rights reserved.</span><span id="0440" class="gr gs dc bk gt b dy gx gy gz ha hb gv r gw">Starting test execution, please wait...</span><span id="bf22" class="gr gs dc bk gt b dy gx gy gz ha hb gv r gw">A total of 1 test files matched the specified pattern.<br>Host debugging is enabled. Please attach debugger to testhost process to continue.<br>Process Id: 32723, Name: dotnet<br>Waiting for debugger attach&#x2026;<br>Process Id: 32723, Name: dotnet</span></pre><p id="efa8" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">And I could now attach to process both from VS Mac</p><figure class="ft fu fv fw fx fy cl cm paragraph-image"><img class="cp t u gb ak" src="https://miro.medium.com/max/1812/1*xCKx7w1FWV4IOHnOPLyb0w.png" width="906"></figure><p id="024f" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">and VS Code</p><figure class="ft fu fv fw fx fy cl cm paragraph-image"><img class="cp t u gb ak" src="https://miro.medium.com/max/1742/1*S6IRxrTuFATvL2mb5BdK4Q.png" width="871"></figure><p id="64b8" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Which allowed me to set break points, inspect variables and step through code, even though the IDEs themselves for some reason couldn&#x2019;t compile and execute the tests.</p><figure class="ft fu fv fw fx fy cl cm paragraph-image"><img class="cp t u gb ak" src="https://miro.medium.com/max/1124/1*8QFR-pRPg-zE4jh4CJXdnQ.png" width="562"></figure><p id="1cf4" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Fairly quickly found the issue added a commit and builds were green and I could go to sleep.</p><figure class="ft fu fv fw fx fy cl cm paragraph-image"><img class="cp t u gb ak" src="https://miro.medium.com/max/1320/1*myn0NJSKE_oQzgjNW6jdXA.png" width="660"></figure><p id="7450" class="fe ff dc bk fg b fh fi fj fk fl fm fn fo fp fq fr">Sometimes you just want to attack the problem and not debug tooling, then attacking the problem from another direction might get you there quicker, today it was setting <strong class="fg gm"><em class="gn">VSTEST_HOST_DEBUG</em></strong> to <strong class="fg gm"><em class="gn">1</em></strong>.</p></div></div></section></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>