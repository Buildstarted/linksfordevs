<!DOCTYPE html>
<html lang="en">
<head>
    <title>
When Git Resolves Changes It Shouldn&#x2019;t -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>When Git Resolves Changes It Shouldn’t</h1><div><div class="post-content e-content" itemprop="articleBody"><p>When you merge two branches, there may be conflicting changes between the branches. Git can often resolve these differences without intervention. For example, when each branch has changes to different files or lines of code.</p><p>But sometimes each branch has changes that Git cannot resolve without help. For example, if two developers change the same line of code. Or if one developer deletes a file, but the other changed the file. In these situations, Git fails the merge operation and reports a merge conflict.</p><p>This occurs more often than we’d like because Git doesn’t understand the semantics of code. A tool that did understand code semantics could resolve many (but not all) of these conflicts. In my last post, I gave an example of a merge conflict that a semantic tool can resolve automatically.</p><p>What about the opposite situation? Are there cases where Git automatically resolves changes that it shouldn’t? Of course the answer is yes, or I wouldn’t pose the question and write this post.</p><h2 id="multiple-usings">Multiple usings</h2><p>Let’s start with something that you’re likely to run into if you’re a .NET developer. Here we have a very simple initial commit by Bob.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span><span class="nn">System</span><span class="p">;</span><span class="k">using</span><span class="nn">System.Collections</span><span class="p">;</span><span class="k">using</span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="k">public</span><span class="k">class</span><span class="nc">Main</span><span class="p">{</span><span class="p">}</span></code></pre></div></div><p>Alice creates a branch named <code class="language-plaintext highlighter-rouge">diagnostics</code> and adds a couple using statements.</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> using System;
<span class="gi">+using System.Text;
</span> using System.Collections;
<span class="gi">+using System.Diagnostics;
</span> using System.Collections.Generic;

 public class Main
 {}
</code></pre></div></div><p>Meanwhile, on <code class="language-plaintext highlighter-rouge">master</code>, Bob adds <code class="language-plaintext highlighter-rouge">using System.IO</code> in the same place where Alice added <code class="language-plaintext highlighter-rouge">System.Text</code>. Bob also adds <code class="language-plaintext highlighter-rouge">using System.Diagnostics</code> to the end of the usings section.</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> using System;
<span class="gi">+using System.IO;
</span> using System.Collections;
 using System.Collections.Generic;
<span class="gi">+using System.Diagnostics;
</span>
 public class Main
 {
 }
</code></pre></div></div><p>Now Bob tries to merge Alice’s branch <code class="language-plaintext highlighter-rouge">diagnostics</code> into <code class="language-plaintext highlighter-rouge">master</code>. This results in the following conflict.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span><span class="nn">System</span><span class="p">;</span><span class="p">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="n">HEAD</span><span class="k">using</span><span class="nn">System.IO</span><span class="p">;</span><span class="p">=======</span><span class="k">using</span><span class="nn">System.Text</span><span class="p">;</span><span class="p">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="n">diagnostics</span><span class="k">using</span><span class="nn">System.Collections</span><span class="p">;</span><span class="k">using</span><span class="nn">System.Diagnostics</span><span class="p">;</span><span class="k">using</span><span class="nn">System.Collections.Generic</span><span class="p">;</span><span class="k">using</span><span class="nn">System.Diagnostics</span><span class="p">;</span></code></pre></div></div><p>Git reports a conflict with the second line because Alice added <code class="language-plaintext highlighter-rouge">System.Text</code> there and Bob added <code class="language-plaintext highlighter-rouge">System.IO</code> there. Notice that Git doesn’t have any problem with the fact that both developers added a redundant <code class="language-plaintext highlighter-rouge">using System.Diagnostics</code> in two different places.</p><p>What happens in gmaster when we launch the semantic merge tool?</p><p><img src="https://user-images.githubusercontent.com/19977/61091492-37354b80-a3f7-11e9-974a-27f8366243d4.png" alt="gmaster resolves the conflict and duplicate usings"></p><p>Because gmaster understands C#, it is not only able to automatically resolve the conflict, it resolves the duplicate usings as well.</p><p>To be fair, the duplicate usings issue is very minor. It doesn’t affect the correctness of the program to have an extra using statement. Also, at the time I write this, gmaster will only resolve the duplicate if there’s another conflict in the file. The reason for this is it still relies on Git to report a merge conflict. If Git doesn’t think there’s a conflict, gmaster won’t intervene.</p><h2 id="divergent-move">Divergent Move</h2><p>This scenario is a bit of an edge case, but more likely to cause problems with the final code. Here we start with an initial commit by Bob with a set of three simple interfaces.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span><span class="k">interface</span><span class="nc">IStudent</span><span class="p">{</span><span class="kt">string</span><span class="n">Name</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="kt">string</span><span class="n">Teacher</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="n">IClass</span><span class="n">Class</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="p">}</span><span class="k">public</span><span class="k">interface</span><span class="nc">IClass</span><span class="p">{</span><span class="kt">string</span><span class="n">Name</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="kt">string</span><span class="n">Subject</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="p">}</span><span class="k">public</span><span class="k">interface</span><span class="nc">IEnrollment</span><span class="p">{</span><span class="n">IStudent</span><span class="n">Student</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="n">IClass</span><span class="n">Class</span><span class="p">{</span><span class="k">get</span><span class="p">;</span><span class="p">}</span><span class="p">}</span></code></pre></div></div><p>Alice creates a branch named <code class="language-plaintext highlighter-rouge">move-teacher-to-class</code> and moves the <code class="language-plaintext highlighter-rouge">Teacher</code> property from <code class="language-plaintext highlighter-rouge">IStudent</code> to the <code class="language-plaintext highlighter-rouge">IClass</code> interface. She also adds a <code class="language-plaintext highlighter-rouge">Grade</code> property to <code class="language-plaintext highlighter-rouge">IStudent</code>. This results in these changes:</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public interface IStudent
 {
     string Name { get; }
<span class="gd">-    string Teacher { get; }
</span><span class="gi">+    int Grade { get; }
</span>     IClass Class { get; }
 }
 
 public interface IClass
 {
     string Name { get; }
     string Subject { get; }
<span class="gi">+    string Teacher { get; }
</span> }
</code></pre></div></div><p>Meanwhile, on <code class="language-plaintext highlighter-rouge">master</code>, Bob moves the <code class="language-plaintext highlighter-rouge">Teacher</code> property from <code class="language-plaintext highlighter-rouge">IStudent</code> to the <code class="language-plaintext highlighter-rouge">IEnrollment</code> interface.</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public interface IStudent
 {
     string Name { get; }
<span class="gd">-    string Teacher { get; }
</span>     IClass Class { get; }
 }

 public interface IEnrollment
 {
     IStudent Student { get; }
     IClass Class { get; }
<span class="gi">+    string Teacher { get; }
</span> }
</code></pre></div></div><p>Now what happens when Bob merges <code class="language-plaintext highlighter-rouge">move-teacher-to-class</code> into <code class="language-plaintext highlighter-rouge">master</code>?</p><div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code> public interface IStudent
 {
     string Name { get; }
<span class="gi">+&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
+=======
+    int Grade { get; }
+&gt;&gt;&gt;&gt;&gt;&gt;&gt; move-teacher-to-class
</span>     IClass Class { get; }
 }

public interface IClass
 {
     string Name { get; }
     string Subject { get; }
<span class="gi">+    string Teacher { get; }
</span> }
</code></pre></div></div><p>Git notices the conflict in the <code class="language-plaintext highlighter-rouge">IStudent</code> class. One developer removed a property. Another developer added a property. But something else interesting happened here that Git did not notice. We have a divergent move situation here. Both developers moved the <code class="language-plaintext highlighter-rouge">Teacher</code> property to different interfaces. Let’s see how gmaster handles this. When we launch the Merge Tool from within gmaster, we get this.</p><p><img src="https://user-images.githubusercontent.com/19977/61091559-7c597d80-a3f7-11e9-8134-a90e35e3dcc7.png" alt="Gmaster Merge Tool notices divergent move"></p><p>Notice that gmaster resolves the conflict in <code class="language-plaintext highlighter-rouge">IStudent</code> that Git reported. Because it understands C#, it understands this change isn’t actually in conflict.</p><p>However, gmaster does notice another conflict that Git did <em>not</em> report. gmaster reports that the <code class="language-plaintext highlighter-rouge">Teacher</code> property was moved in each branch to two different locations. That is indicative of a semantic conflict. You can click on “Explain Move” to get a semantic visualization of the change.</p><p><img src="https://user-images.githubusercontent.com/19977/61091590-9bf0a600-a3f7-11e9-9ed9-42de4743d710.png" alt="The divergent move explained in a class diagram"></p><h2 id="limitations">Limitations</h2><p>In the scenario I presented here, there’s an important caveat. As I write this, gmaster relies on Git to detect conflicts. If Alice hadn’t added the <code class="language-plaintext highlighter-rouge">Grade</code> property to <code class="language-plaintext highlighter-rouge">IStudent</code>, Git would not have reported a conflict. In that case, gmaster would not intervene to report the divergent move. Should a tool like gmaster intervene on every merge? That’s an interesting question for the gmaster product team. In theory they could build a <a href="http://www.mcclellandlegge.com/2017-03-20-customgitmergedriver/">custom Git merge driver</a> that understands the semantic of code.</p><h2 id="future-exploration">Future Exploration</h2><p>There are other conflict scenarios that a semantic tool in theory could resolve. For example, suppose you rename a variable in one branch. Another developer in another branch makes use of the old variable name. When you merge the two branches, it would be nice if the merge tool could resolve that conflict.</p><p>As I write this, gmaster doesn’t yet handle this situation. The creators of gmaster want to make sure that people find the existing tools useful before investing in deeper semantic merge scenarios.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>