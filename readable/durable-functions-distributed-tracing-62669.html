<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Durable Functions&#x2019; Distributed Tracing - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Durable Functions&#x2019; Distributed Tracing - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@tsuyoshiushio"/>
    <meta property="og:description" content="I&#x2019;m happy to announce the Distributed Tracing feature for Durable Functions. If you&#x2019;ve never heard of Durable Functions, then I recommend&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/@tsuyoshiushio/durable-functions-distributed-tracing-71426fe2246f"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Durable Functions&#x2019; Distributed Tracing</title>
<div class="readable">
        <h1>Durable Functions&#x2019; Distributed Tracing</h1>
            <div>by https://medium.com/@tsuyoshiushio</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 10 Jun 2020</div>
        <p><a href="https://medium.com/@tsuyoshiushio/durable-functions-distributed-tracing-71426fe2246f">https://medium.com/@tsuyoshiushio/durable-functions-distributed-tracing-71426fe2246f</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><section><div><div><div><div><div><div><p><a rel="noopener" href="https://medium.com/@tsuyoshiushio?source=post_page-----71426fe2246f----------------------"><img alt="Tsuyoshi Ushio" src="https://miro.medium.com/fit/c/96/96/0*UuUjIWGf50inWffR." width="48" height="48"></a></p></div></div></div></div><p id="3036" data-selectable-paragraph="">I’m happy to announce the Distributed Tracing feature for Durable Functions. If you’ve never heard of Durable Functions, then I recommend you check out our <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-concepts" target="_blank" rel="noopener nofollow">patterns and concepts documentation</a> that explains what it is and why you should care. I’m a contributor to Durable Functions, so I work with them and implement the Distributed Tracing feature.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*Isjoj87r6sbnTHx4RNsqiw.png?q=20" width="3882" height="1762" role="presentation"></p><p><img width="3882" height="1762" srcset="https://miro.medium.com/max/552/1*Isjoj87r6sbnTHx4RNsqiw.png 276w, https://miro.medium.com/max/1104/1*Isjoj87r6sbnTHx4RNsqiw.png 552w, https://miro.medium.com/max/1280/1*Isjoj87r6sbnTHx4RNsqiw.png 640w, https://miro.medium.com/max/1400/1*Isjoj87r6sbnTHx4RNsqiw.png 700w" sizes="700px" role="presentation" src="https://miro.medium.com/max/3882/1*Isjoj87r6sbnTHx4RNsqiw.png"></p></div></div></div></div><figcaption data-selectable-paragraph="">End to end tracing for Multi-layered Sub Orchestrations</figcaption></figure><p id="a711" data-selectable-paragraph="">The Azure Functions team received a lot of requests for the Distributed Tracing for Durable Functions. The host of the Azure Functions will track telemetry automatically with Application Insights, so people easy to diagnose the function execution.</p><p id="1a02" data-selectable-paragraph="">The durable functions enable us to execute orchestrations. It allows us to run a complex workflow, long-running execution, and stateful services.</p><p id="e29a" data-selectable-paragraph="">However, the orchestration is consist of several functions executions. For each function, instance Id is different and no correlation information. It was hard to identify which telemetries are belonged to the same orchestrations.</p><p id="0672" data-selectable-paragraph="">You can find the overview and demo with this video.</p><figure><div></div></figure><p id="5f05" data-selectable-paragraph="">The feature correlates the telemetries that related the same orchestration. You can see the telemetry on the end to end transaction with Application Insights. It supports <a href="https://www.w3.org/TR/trace-context-1/" target="_blank" rel="noopener nofollow">W3C TraceContext</a> and <a href="https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/src/libraries/System.Diagnostics.DiagnosticSource/src/HttpCorrelationProtocol.md" target="_blank" rel="noopener nofollow">HttpCorrelation Protocol</a>.</p><p id="8a36" data-selectable-paragraph="">It also supports the incoming telemetry correlation and custom telemetry for the customer. For more details of the external correlation, you can refer to this video.</p><figure><div></div></figure><p id="5639" data-selectable-paragraph="">Since this is the alpha release for <strong>getting feedback</strong> on this feature, All the programming models are not supported. You can refer to which programming models are already supported.</p><p id="763b" data-selectable-paragraph="">The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.activity?view=netcore-3.1" target="_blank" rel="noopener nofollow">Activity class</a> managed the correlation using Application Insights. However, It doesn’t allow re-assign the Id and serialize. Under the hood, the durable functions use queues to talk with the other orchestrators and activity functions. For the correlation, we need to pass through the telemetry data through the orchestration. We implement the wrapper of the Activity class that enables re-assign and serialization. Also, we track the telemetry at the side of durable functions for orchestrators.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*8fEGF4GTwrdoKJdVLP1cRg.png?q=20" width="3218" height="1760" role="presentation"></p><p><img width="3218" height="1760" srcset="https://miro.medium.com/max/552/1*8fEGF4GTwrdoKJdVLP1cRg.png 276w, https://miro.medium.com/max/1104/1*8fEGF4GTwrdoKJdVLP1cRg.png 552w, https://miro.medium.com/max/1280/1*8fEGF4GTwrdoKJdVLP1cRg.png 640w, https://miro.medium.com/max/1400/1*8fEGF4GTwrdoKJdVLP1cRg.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">Eternal Orchestration Pattern tracing</figcaption></figure><p id="f568" data-selectable-paragraph="">If you want to know the architecture, you can see the details on the DurableTask Distributed Tracing page, Durable Functions working on the Durable Task. You can refer to the detailed architecture from this page.</p><p id="f71d" data-selectable-paragraph="">I’ll show you the overview. If you need a step-by-step instruction, you can refer <a href="https://github.com/Azure/azure-functions-durable-extension/blob/correlation/samples/correlation-csharp/getting-started.md" target="_blank" rel="noopener nofollow">Getting Started</a>.</p><p id="726e" data-selectable-paragraph="">Step1. <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/create-new-resource" target="_blank" rel="noopener nofollow">Create a Application Insights </a>on your Azure Portal and get the instrumentation key.</p><p id="316a" data-selectable-paragraph="">Step2. <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-sequence?tabs=csharp" target="_blank" rel="noopener nofollow">Create Durable Functions</a> or <a href="https://github.com/Azure/azure-functions-durable-extension/tree/correlation/samples" target="_blank" rel="noopener nofollow">clone the samples</a>. The sample is reside on the <code>correlation</code> branch on <a href="https://github.com/Azure/azure-functions-durable-extension/tree/correlation/samples" target="_blank" rel="noopener nofollow">the Durable Functions repository</a>.</p><p id="411e" data-selectable-paragraph="">Step3. Make sure to<a href="https://docs.microsoft.com/en-us/nuget/consume-packages/install-use-packages-visual-studio#package-sources" target="_blank" rel="noopener nofollow"> add configuration for NuGet source</a> for `<a href="https://www.myget.org/F/azure-appservice-staging/api/v3/index.json" target="_blank" rel="noopener nofollow">https://www.myget.org/F/azure-appservice-staging/api/v3/index.json</a>`. The NuGet package is reside in there.</p><p id="73a4" data-selectable-paragraph="">Step4. Add <code>Microsoft.Azure.WebJobs.Extensions.DurableTask.Telemetry</code> version <code>2.2.0-alpha</code> on your <code>csproj</code> file. This <code>csproj</code> file is the samples.</p><figure><div></div><figcaption>csproj file sample</figcaption></figure><p id="d79e" data-selectable-paragraph="">Step5. Configure <code>host.json</code> and <code>local.settings.json</code> for setting up for Distributed Tracing.</p><figure><div></div><figcaption>host.json</figcaption></figure><figure><div></div><figcaption>local.settings.json</figcaption></figure><p id="25e1" data-selectable-paragraph="">Step6. Run your durable functions.</p><p id="0ef1" data-selectable-paragraph="">Step7. Go to the Application Insights on your portal and see the End To End Tracing with choosing a telemetry that has Dt prefix. If you can’t find the telemetry, Go to <a href="https://github.com/Azure/azure-functions-durable-extension/blob/correlation/samples/correlation-csharp/getting-started.md#diagnose-the-telemetry" target="_blank" rel="noopener nofollow">Getting Started</a> page. You can find more instructions.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*_iomfTQYlkgNgV_vOGFm4A.png?q=20" width="1708" height="793" role="presentation"></p><p><img width="1708" height="793" srcset="https://miro.medium.com/max/552/1*_iomfTQYlkgNgV_vOGFm4A.png 276w, https://miro.medium.com/max/1104/1*_iomfTQYlkgNgV_vOGFm4A.png 552w, https://miro.medium.com/max/1280/1*_iomfTQYlkgNgV_vOGFm4A.png 640w, https://miro.medium.com/max/1400/1*_iomfTQYlkgNgV_vOGFm4A.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">End to end tracing</figcaption></figure><p id="2d76" data-selectable-paragraph="">You will find more resources:</p><ul><li id="cab3" data-selectable-paragraph=""><a href="https://github.com/Azure/azure-functions-durable-extension/tree/correlation/samples/correlation-csharp" target="_blank" rel="noopener nofollow">Distributed Tracing for Durable Functions (Overview)</a></li><li id="f069" data-selectable-paragraph=""><a href="https://github.com/Azure/azure-functions-durable-extension/blob/correlation/samples/correlation-csharp/getting-started.md" target="_blank" rel="noopener nofollow">Getting Started</a></li><li id="0cac" data-selectable-paragraph=""><a href="https://github.com/Azure/azure-functions-durable-extension/blob/correlation/samples/correlation-csharp/reference.md" target="_blank" rel="noopener nofollow">Reference</a></li><li id="3ecb" data-selectable-paragraph=""><a href="https://github.com/Azure/azure-functions-durable-extension/blob/correlation/samples/correlation-csharp/configuration.md" target="_blank" rel="noopener nofollow">Configuration</a></li><li id="b2d3" data-selectable-paragraph=""><a href="https://github.com/Azure/azure-functions-durable-extension/tree/correlation/samples/correlation-csharp" target="_blank" rel="noopener nofollow">Distributed Tracing Durable Functions samples</a></li></ul><p id="0207" data-selectable-paragraph="">Currently, Orchestrator and Activity Functions are tracked on the Durable Functions side. It is missing the custom property that is tracked on the Azure Functions Host. In the near feature, Only the Orchestrator telemetry is tracked on the Durable Functions side with keeping each Orchestration telemetries are tracked on Azure Functions Host.</p><p id="2533" data-selectable-paragraph="">As the first alpha version, we support C# only. However, we are going to support other languages as well.</p><p id="0530" data-selectable-paragraph="">Also, Not all programming model is supported; we are implementing it shortly before GA.</p><p id="35d8" data-selectable-paragraph="">The alpha release of distributed tracing is primarily intended to gather feedback. We plan on shipping it as a GA feature shortly, so now is the time to provide feedback that will help influence the priorities and the direction it takes. We hope you’ll give it a try and let us know what you’d like to see in future updates.</p><p id="ce92" data-selectable-paragraph="">If you have feedback and requests, please submit issues on this repo. I hope you like this new feature.</p></div></div></section></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>