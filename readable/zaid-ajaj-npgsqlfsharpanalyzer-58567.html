<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Zaid-Ajaj/Npgsql.FSharp.Analyzer - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Zaid-Ajaj/Npgsql.FSharp.Analyzer - linksfor.dev(s)"/>
    <meta property="article:author" content="Zaid-Ajaj"/>
    <meta property="og:description" content="Analyzer that provides embedded SQL syntax analysis when writing queries using Npgsql.FSharp. It verifies query syntax, checks the parameters in the query match with the provided parameters and per..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/Zaid-Ajaj/Npgsql.FSharp.Analyzer"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Zaid-Ajaj/Npgsql.FSharp.Analyzer</title>
<div class="readable">
        <h1>Zaid-Ajaj/Npgsql.FSharp.Analyzer</h1>
            <div>by Zaid-Ajaj</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 20 Feb 2020</div>
        <p><a href="https://github.com/Zaid-Ajaj/Npgsql.FSharp.Analyzer">https://github.com/Zaid-Ajaj/Npgsql.FSharp.Analyzer</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>  <p><span itemprop="about">
          Analyzer that provides embedded SQL syntax analysis when writing queries using Npgsql.FSharp. It verifies query syntax, checks the parameters in the query match with the provided parameters and performs type-checking on the functions that read columns from the result sets.
        </span>
  </p>
</div><div id="readme">
    
        

      <div>
        <article itemprop="text">
<p>Analyzer that provides embedded <strong>SQL syntax analysis</strong> when writing queries using Npgsql.FSharp. It verifies querie syntax, checks the parameters in the query match with the provided parameters and performs <strong>type-checking</strong> on the functions that read columns from the result sets.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/Zaid-Ajaj/Npgsql.FSharp.Analyzer/blob/master/sql-syntax-analysis-type-checking.gif"><img src="https://github.com/Zaid-Ajaj/Npgsql.FSharp.Analyzer/raw/master/sql-syntax-analysis-type-checking.gif" alt="Demo"></a>]</p>
<h2>NuGet</h2>
<table>
<thead>
<tr>
<th>Package</th>
<th>Stable</th>
<th>Prerelease</th>
</tr>
</thead>
<tbody>
<tr>
<td>NpgsqlFSharpAnalyzer</td>
<td><a href="https://www.nuget.org/packages/NpgsqlFSharpAnalyzer/" rel="nofollow"><img src="https://camo.githubusercontent.com/56b9bad2305ccb7d164177d73a4f4d1129fb6dd0/68747470733a2f2f6275696c6473746174732e696e666f2f6e756765742f4e706773716c465368617270416e616c797a6572" alt="NuGet Badge" data-canonical-src="https://buildstats.info/nuget/NpgsqlFSharpAnalyzer"></a></td>
<td><a href="https://www.nuget.org/packages/NpgsqlFSharpAnalyzer/" rel="nofollow"><img src="https://camo.githubusercontent.com/031a872b0d422120ec1c3365ee3ca7710636ae8e/68747470733a2f2f6275696c6473746174732e696e666f2f6e756765742f4e706773716c465368617270416e616c797a65723f696e636c75646550726552656c65617365733d74727565" alt="NuGet Badge" data-canonical-src="https://buildstats.info/nuget/NpgsqlFSharpAnalyzer?includePreReleases=true"></a></td>
</tr>
</tbody>
</table>
<h2>Using The Analyzer</h2>
<h3>1 - Set <code>NPGSQL_FSHARP</code> environment variable</h3>
<p>The analyzer requires an environment variable named <code>NPGSQL_FSHARP</code> with a connection string that points to your development database. The analyzers uses this connection string to retrieve the schema of the database as well as the schema and column output of the result sets from the various queries.</p>
<h3>2 - Install the analyzer using paket</h3>
<p>Use paket to install the analyzer into a specialized <code>Analyzers</code> dependency group like this:</p>
<pre><code>paket add NpgsqlFSharpAnalyzer --group Analyzers
</code></pre>
<p><strong>DO NOT</strong> use <code>storage:none</code> because we want the analyzer package to be downloaded physically into <code>packages/analyzers</code> directory.</p>
<h3>3 - Enable analyzers in Ionide</h3>
<p>Make sure you have these settings in Ionide for FSharp</p>
<div><pre>{
    <span><span>"</span>FSharp.enableAnalyzers<span>"</span></span>: <span>true</span>,
    <span><span>"</span>FSharp.analyzersPath<span>"</span></span>: [
        <span><span>"</span>./packages/analyzers<span>"</span></span>
    ]
}</pre></div>
<p>Which instructs Ionide to load the analyzers from the directory of the analyzers into which <code>NpgsqlFSharpAnalyzer</code> was installed.</p>
<h3>Writing Long Multi-line Queries</h3>
<p>When it is not convenient to write a query inline like this:</p>
<div><pre>Sql.query <span><span>"</span>HERE COMES A VERY LONG QUERY<span>"</span></span></pre></div>
<p>You can define the query as a <em>module-level</em> <code>[&lt;Literal&gt;]</code> string and use it from the <code>Sql.query</code> function like this:</p>
<div><pre>let <span>[&lt;Literal&gt;]</span> selectActiveUsers <span>=</span> <span><span>"""</span></span>
<span>    SELECT * FROM users</span>
<span>    WHERE is_active = @is_active</span>
<span><span>"""</span></span>

<span>let</span> <span>activeUsers</span> (<span>connectionString</span>: <span>string</span>) <span>=</span>
    connectionString
    <span>|&gt;</span> Sql.connect
    <span>|&gt;</span> Sql.query selectActiveUsers
    <span>|&gt;</span> Sql.parameters <span>[</span> <span><span>"</span>is_active<span>"</span></span>, Sql.Value <span>true</span> <span>]</span>
    <span>|&gt;</span> Sql.executeReader (Sql.readRow <span>&gt;&gt;</span> Sql.readString <span><span>"</span>username<span>"</span></span>)</pre></div>
<p>The <code>[&lt;Literal&gt;]</code> string has to be defined in the same module in order for the analysis to run properly.</p>
<p>Better yet, if you use the <a href="https://github.com/Tarmil/FSharp.Data.LiteralProviders">FSharp.Data.LiteralProviders</a> package, you can write your SQL queries in external SQL files and load them in compile-time as a <code>[&lt;Literal&gt;]</code> string to allow for the analyzer to pick it up:</p>
<div><pre>let <span>[&lt;Literal&gt;]</span> selectActiveUsers <span>=</span> TextFile<span>&lt;</span><span><span>"</span>selectActiveUsers.sql<span>"</span></span><span>&gt;</span>.Text

<span>let</span> <span>activeUsers</span> (<span>connectionString</span>: <span>string</span>) <span>=</span>
    connectionString
    <span>|&gt;</span> Sql.connect
    <span>|&gt;</span> Sql.query selectActiveUsers
    <span>|&gt;</span> Sql.parameters <span>[</span> <span><span>"</span>is_active<span>"</span></span>, Sql.Value <span>true</span> <span>]</span>
    <span>|&gt;</span> Sql.executeReader (Sql.readRow <span>&gt;&gt;</span> Sql.readString <span><span>"</span>username<span>"</span></span>)</pre></div>
<p>Just remember that these <code>[&lt;Literal&gt;]</code> strings have to defined in the same module where the query is written.</p>
<hr>
<h3>Developing</h3>
<p>Make sure the following <strong>requirements</strong> are installed on your system:</p>
<ul>
<li><a href="https://www.microsoft.com/net/download/core" rel="nofollow">dotnet SDK</a> 3.0 or higher</li>
<li><a href="http://www.mono-project.com/" rel="nofollow">Mono</a> if you're on Linux or macOS.</li>
<li>Postgres database server</li>
</ul>
<p>or</p>
<ul>
<li><a href="https://code.visualstudio.com/docs/remote/containers" rel="nofollow">VSCode Dev Container</a></li>
</ul>
<hr>
<h3>Building</h3>
<div><pre><span>&gt;</span> build.cmd <span>&lt;</span>optional buildtarget<span>&gt;</span> // on windows
$ ./build.sh  <span>&lt;</span>optional buildtarget<span>&gt;</span>// on unix</pre></div>
<h3>Running The Tests</h3>
<p>The tests create and dispose a test database dynamically so you don't need to setup anything. This database is created using a default connection string that connects to your local Postgres server like this:</p>
<div><pre><span>let</span> <span>createTestDatabase</span><span>()</span> <span>=</span>
    Sql.host <span><span>"</span>localhost<span>"</span></span>
    <span>|&gt;</span> Sql.port <span>5432</span>
    <span>|&gt;</span> Sql.username <span><span>"</span>postgres<span>"</span></span>
    <span>|&gt;</span> Sql.password <span><span>"</span>postgres<span>"</span></span>
    <span>|&gt;</span> Sql.str
    <span>|&gt;</span> ThrowawayDatabase.Create</pre></div>
<p>Make sure you have a user with username and password called <code>postgres</code>.</p>
<hr>
<h3>Build Targets</h3>
<ul>
<li><code>Clean</code> - Cleans artifact and temp directories.</li>
<li><code>DotnetRestore</code> - Runs <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-restore?tabs=netcore2x" rel="nofollow">dotnet restore</a> on the <a href="https://docs.microsoft.com/en-us/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2019" rel="nofollow">solution file</a>.</li>
<li><a href="#Building"><code>DotnetBuild</code></a> - Runs <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-build?tabs=netcore2x" rel="nofollow">dotnet build</a> on the <a href="https://docs.microsoft.com/en-us/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2019" rel="nofollow">solution file</a>.</li>
<li><code>DotnetTest</code> - Runs <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-test?tabs=netcore21" rel="nofollow">dotnet test</a> on the <a href="https://docs.microsoft.com/en-us/visualstudio/extensibility/internals/solution-dot-sln-file?view=vs-2019" rel="nofollow">solution file</a>.</li>
<li><code>GenerateCoverageReport</code> - Code coverage is run during <code>DotnetTest</code> and this generates a report via <a href="https://github.com/danielpalme/ReportGenerator">ReportGenerator</a>.</li>
<li><code>WatchTests</code> - Runs <a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/dotnet-watch?view=aspnetcore-3.0" rel="nofollow">dotnet watch</a> with the test projects. Useful for rapid feedback loops.</li>
<li><code>GenerateAssemblyInfo</code> - Generates <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.applicationservices.assemblyinfo?view=netframework-4.8" rel="nofollow">AssemblyInfo</a> for libraries.</li>
<li><code>DotnetPack</code> - Runs <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-pack" rel="nofollow">dotnet pack</a>. This includes running <a href="https://github.com/dotnet/sourcelink">Source Link</a>.</li>
<li><code>PublishToNuGet</code> - Publishes the NuGet packages generated in <code>DotnetPack</code> to NuGet via <a href="https://fsprojects.github.io/Paket/paket-push.html" rel="nofollow">paket push</a>.</li>
<li><code>BuildDocs</code> - Generates Documentation from <code>docsSrc</code> and the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/xmldoc/" rel="nofollow">XML Documentation Comments</a> from your libraries in <code>src</code>.</li>
<li><code>WatchDocs</code> - Generates documentation and starts a webserver locally.  It will rebuild and hot reload if it detects any changes made to <code>docsSrc</code> files, libraries in <code>src</code>, or the <code>docsTool</code> itself.</li>
<li><code>ReleaseDocs</code> - Will stage, commit, and push docs generated in the <code>BuildDocs</code> target.</li>
</ul>
<hr>
<h3>Releasing</h3>
<ul>
<li><a href="https://fsprojects.github.io/Paket/paket-config.html#Adding-a-NuGet-API-key" rel="nofollow">Add your NuGet API key to paket</a></li>
</ul>
<div><pre>paket config add-token <span><span>"</span>https://www.nuget.org<span>"</span></span> 4003d786-cc37-4004-bfdf-c4f3e8ef9b3a</pre></div>
<ul>
<li>
<p><a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">Create a GitHub OAuth Token</a></p>
<ul>
<li>You can then set the <code>GITHUB_TOKEN</code> to upload release notes and artifacts to github</li>
<li>Otherwise it will fallback to username/password</li>
</ul>
</li>
<li>
<p>Then update the <code>RELEASE_NOTES.md</code> with a new version, date, and release notes <a href="https://fsharp.github.io/FAKE/apidocs/fake-releasenoteshelper.html" rel="nofollow">ReleaseNotesHelper</a></p>
</li>
</ul>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>