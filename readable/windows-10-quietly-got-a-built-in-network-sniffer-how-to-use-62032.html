<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Windows 10 quietly got a built-in network sniffer, how to use - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Windows 10 quietly got a built-in network sniffer, how to use - linksfor.dev(s)"/>
    <meta property="article:author" content="Lawrence Abrams"/>
    <meta property="og:description" content="Microsoft has quietly added a built-in network packet sniffer to the Windows 10 October 2018 Update, and it has gone unnoticed since its release."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.bleepingcomputer.com/news/microsoft/windows-10-quietly-got-a-built-in-network-sniffer-how-to-use/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Windows 10 quietly got a built-in network sniffer, how to use</title>
<div class="readable">
        <h1>Windows 10 quietly got a built-in network sniffer, how to use</h1>
            <div>by Lawrence Abrams</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 23 May 2020</div>
        <p><a href="https://www.bleepingcomputer.com/news/microsoft/windows-10-quietly-got-a-built-in-network-sniffer-how-to-use/">https://www.bleepingcomputer.com/news/microsoft/windows-10-quietly-got-a-built-in-network-sniffer-how-to-use/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
<p><img alt="Network switches" height="450" src="https://www.bleepstatic.com/content/posts/2020/05/network-switches-header.jpg" width="1280"></p>
<p>Microsoft has quietly added a built-in network packet sniffer to the Windows 10 October 2018 Update, and it has gone unnoticed since its release.</p>
<p>A packet sniffer, or network sniffer, is a program that monitors the network activity flowing over a computer down to an individual packet level.</p>
<p>This can be used by network administrators to diagnose networking issues, see what types of programs are being used on a network, or even listen in on network conversations sent via clear text.</p>
<cnx><cnx><cnx></cnx><cnx id="id_4a3b1590217341643"><cnx>
            <cnx></cnx>
            <cnx><cnx></cnx>
                <cnx> <cnx> <svg markup-inline="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="5 1 5 23 23 11.9165764"></polygon></svg> <cnx></cnx> <cnx-span>PLAY</cnx-span> </cnx> </cnx>
                <cnx>
                    <cnx>
                    <cnx>
                        <cnx> <cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx><cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx><cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx><cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx><cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx><cnx> <cnx> <cnx></cnx> <cnx></cnx> <cnx></cnx> </cnx> <cnx></cnx> </cnx></cnx>
                    </cnx>
                    <cnx>
                        <cnx>
                            <cnx>
                <cnx>
                <img src="https://img.connatix.com/067e5169-ece3-4ce8-87ad-c7961b8bb396/1.png">
            </cnx>
                <cnx>
                    <cnx>
                <cnx>
                    <cnx>
                        <cnx>
                            <cnx>Top Articles</cnx>
                        </cnx>
                    </cnx>
                </cnx>
            </cnx>
                    <cnx>
                <cnx>
                    <cnx>
                        <cnx>
                            <cnx></cnx>
                        </cnx>
                    </cnx>
                </cnx>
            </cnx>
                </cnx>
            </cnx>
                        </cnx>
                        <cnx>
                            <cnx><cnx>
                <cnx>
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 22 22"><path d="M11 7c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>
                </cnx>
            <cnx></cnx></cnx></cnx>
                            <cnx><cnx>
                <cnx>
                    <svg viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M18 5.4L16.6 4 11 9.6 5.4 4 4 5.4 9.6 11 4 16.6 5.4 18l5.6-5.6 5.6 5.6 1.4-1.4-5.6-5.6z"></path></svg>
                </cnx>
            <cnx></cnx></cnx></cnx>
                        </cnx>
                    </cnx>
                </cnx>
                <cnx>
                    <cnx><cnx>
                <cnx></cnx>
                <cnx><cnx>
                <cnx>
                    <cnx>
                        <cnx>Microsoft Edge 83 released with extension sync </cnx>
                    </cnx>
                </cnx>
            </cnx><cnx>
                <cnx>
                    <cnx>
                        <cnx>and autoâ€‘profiles </cnx>
                    </cnx>
                </cnx>
            </cnx></cnx>
            </cnx></cnx>
                </cnx>
                
                <cnx> <cnx><cnx><cnx>
                    <cnx><svg viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd"><path d="M5 21.453c2.022 1.627 4.6 2.602 7.387 2.602 3.973 0 7.485-1.967 9.622-4.977l-4.596-3.34a3.87 3.87 0 0 0-4.548 0L5 21.453zM22 4.977A11.75 11.75 0 0 0 12.387 0 11.74 11.74 0 0 0 5 2.602l7.9 5.74a3.81 3.81 0 0 0 4.479 0l4.63-3.364zm1.563 11.395c.494-1.3.767-2.712.767-4.186S24.057 9.3 23.563 8l-3.858 2.803a1.71 1.71 0 0 0 0 2.766l3.858 2.803z" fill="#fff"></path><path d="M2.378 5c-.024-.017-.057-.012-.074.01A11.74 11.74 0 0 0 0 12.025a11.74 11.74 0 0 0 2.304 7.004c.017.023.05.028.074.01l8.013-5.822c.81-.59.81-1.797 0-2.386L2.378 5z" fill="#09f"></path></svg></cnx>
                    <cnx>About Connatix</cnx>
                    
                </cnx></cnx></cnx> </cnx>
                </cnx>
            <cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/3c39f4e5-6008-489d-971f-a176afdbc75e.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/cbc616a6-e95b-44d6-a020-4ce273ba6d94.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/358f6626-9c0d-46cb-9600-a1eba8f285ca.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/8d394476-348e-4e1f-90df-8cdcd30c4ac4.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/eb9d980f-8b97-4d9a-8b2c-ca29c686fcf2.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx><cnx><cnx> <cnx> <cnx> <img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/865e34c1-80cb-4ba0-9167-2335d20fea0d.jpg?crop=834:469,smart&amp;width=834&amp;height=469&amp;fit=crop"></cnx></cnx> </cnx> </cnx></cnx></cnx>
            
            
        </cnx><cnx>
            <cnx><cnx></cnx>
                <cnx>
                    
                    
                    <cnx>
                        
                        
                    </cnx>
                </cnx>
            </cnx>
            
        </cnx></cnx><cnx><img src="https://img.connatix.com/d59f5d0c-2087-416a-821c-141798bc501e/cbc616a6-e95b-44d6-a020-4ce273ba6d94.jpg?crop=834:541,smart&amp;width=834&amp;height=541&amp;fit=crop"></cnx></cnx></cnx><p>While Linux users always had the <a href="https://www.tcpdump.org/" rel="nofollow" target="_blank">tcpdump</a> tool to perform network sniffing, Windows users have had to install third-party programs such as the Microsoft Network Monitor and Wireshark.</p>
<p>This all changed when Microsoft released the October 2018 Update as now Windows 10 comes with a new "Packet Monitor" program called pktmon.exe.</p>
<h2>Built-in packet sniffer comes to Windows 10</h2>
<p>With the release of the Windows 10 October 2018 Update, Microsoft quietly added a new network diagnostic and packet monitoring program called C:\Windows\system32\pktmon.exe.</p>
<p>This program has a description of "Monitor internal packet propagation and packet drop reports", which indicates it is designed for diagnosing network problems.</p>
<p>Similar to the Windows 'netsh trace' command, it can be used to perform full packet inspection of data being sent over the computer.</p>
<div>
<figure><img alt="Pktmon Help" height="400" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/pktmon-help.jpg" width="739"><figcaption><strong>Pktmon Help</strong></figcaption></figure></div>
<p>This program has no mention on Microsoft's site that we could find,&nbsp;and we had to learn how to use it by playing with the program.</p>
<p>Thankfully it&nbsp;includes a fairly extensive help system that can be used by typing '<code>pktmon [command] help</code>'.</p>
<p>For example,&nbsp;<code>pktmon filter help</code>, will give you the help screen for the filter command.</p>
<div>
<figure><img alt="Filter command help screen" height="400" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/pktmon-filter.jpg" width="739"><figcaption><strong>Filter command help screen</strong></figcaption></figure></div>
<p data-inc="1">To learn how to use Pktmon, I strongly suggest you read through the help documentation and play around with the program. We have also provided an example in the next section to help you get started.</p>
<h2>Using Pktmon to monitor network traffic</h2>
<p>Unfortunately, diving into the full feature set of Pktmon is outside of the scope of this article, but we wanted to show you a basic example of how you can use the tool.</p>
<p>For our example, we will use Pktmon to monitor FTP traffic from the computer it is run on.</p>
<p>To do this, we first need to launch a <a href="http://Windows%2010%20quietly%20got%20a%20built-in%20network%20sniffer,%20how%20to%20use%20-%20by%20@lawrenceabrams%20https//www.bleepingcomputer.com/news/microsoft/windows-10-quietly-got-a-built-in-network-sniffer-how-to-use/" target="_blank">Windows 10 elevated command prompt</a> as Pktmon requires administrator privileges.</p>
<p>We then need to create two packet filters that tell Pktmon what traffic to monitor, which in our example will be the traffic on TCP ports 20 and 21.</p>
<p>These filters can be created by using the <code>pktmon filter add -p [port]</code> command for each port we want to monitor.</p>
<pre><code>pktmon filter add -p 20
pktmon filter add -p 21</code></pre>
<p>You can then use the <code>pktmon filter list</code> command to see the packet filters we just created.</p>
<div>
<figure><img alt="Configured packet filters" height="400" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/listing-packet-filters.jpg" width="739" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/listing-packet-filters.jpg"><figcaption><strong>Configured packet filters</strong></figcaption></figure></div>
<p>To start monitoring for packets communicating with TCP ports 20 and 21, we need to use the <code>pktmon start --etw</code> command.</p>
<p>Once executed, pktmon will log all packets on <strong>ALL</strong>&nbsp;network interfaces on the device to a file called PktMon.etl and only record the first 128 bytes of a packet.</p>
<p>To make it log the entire packet and only from a&nbsp;specific ethernet device, you can use the -p 0 (capture entire packet) and -c 13 (capture only from the adapter with ID 13) arguments.</p>
<p>To determine what ID your adapters are, you can run the command <code>pktmon comp list&nbsp;</code>command</p>
<p>When we combine all the arguments, we get a final command of:</p>
<pre><code>pktmon start --etw -p 0 -c 13</code></pre>
<div>
<figure><img alt="Capturing packets" height="400" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/capturing-packets.jpg" width="739" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/capturing-packets.jpg"><figcaption><strong>Capturing packets</strong></figcaption></figure></div>
<p data-inc="2">Pktmon will now quietly run while capturing all packets that match our inputted filters.</p>
<p>To stop capturing packets, enter the <code>pktmon stop</code> command, and a log file called PktMon.etl will have been created in the same folder that contains the raw captured data.</p>
<p>This data in this file is not directly usable, so you need to convert it to a human-readable text format with the following command:</p>
<pre><code>pktmon format PktMon.etl -o ftp.txt</code></pre>
<p>Even converted into text, it is not going to give you the full packets, but only a summary of the network traffic as shown below.</p>
<div>
<figure><img alt="Converted into a text format" height="500" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/ftp-text.jpg" width="916" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/ftp-text.jpg"><figcaption><strong>Converted into a text format</strong></figcaption></figure></div>
<p>To&nbsp;benefit from the captured data, I suggest you download and install the <a href="https://www.microsoft.com/en-in/download/details.aspx?id=4865" rel="nofollow" target="_blank">Microsoft Network Monitor</a> and use it to view the ETL file.</p>
<p>Using Network Monitor, you can see the full packet that was sent, including any clear-text information.</p>
<p>For example, below you can see a packet containing the clear-text password we entered when logging into this <a href="https://dlptest.com/ftp-test/" rel="nofollow" target="_blank">FTP test site</a>.</p>
<div>
<figure><img alt="Network monitor showing clear-text FTP password" height="500" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/network-monitor.jpg" width="715" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/network-monitor.jpg"><figcaption><strong>Network monitor showing clear-text FTP password</strong></figcaption></figure></div>
<p>When done using the Pktmon program, you can remove all created filters using the command:</p>
<pre><code>pktmon filter remove</code></pre>
<h2>Real-time monitoring and pcapng support coming soon</h2>
<p>With the <a href="https://www.bleepingcomputer.com/news/microsoft/microsoft-leak-windows-10-2004-being-released-last-week-of-may/" target="_blank">upcoming release of the Windows 10 May 2020 Update</a> (Windows 10 2004), Microsoft has updated the Pktmon tool to allow you to&nbsp;display monitored packets in real-time and to convert ETL files to the PCAPNG format.</p>
<p>In the version of Pktmon coming in the next feature update, you can enable real-time monitoring using the <code>-l real-time</code> argument.</p>
<p>This will cause the captured packets to be displayed directly to the screen while also saving it to the ETL file.</p>
<div>
<figure><img alt="Real-time monitoring of DNS packets" height="500" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/real-time-monitoring.jpg" width="863" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/real-time-monitoring.jpg"><figcaption><strong>Real-time monitoring of DNS packets</strong></figcaption></figure></div>
<p>Microsoft is also adding the ability to convert ETL files to the PCAPNG format so that they can be used in programs like Wireshark.</p>
<div>
<figure><img alt="Convert ETL files into PCAPNG format" height="448" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/pcapng-support.jpg" width="811" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/pcapng-support.jpg"><figcaption><strong>Convert ETL files into PCAPNG format</strong></figcaption></figure></div>
<p data-inc="3">Once the file has been converted into the PCAPNG format, they can be opened into Wireshark so you can view the network communication better.</p>
<div>
<figure><img alt="Viewing traffic in Wireshark" height="500" src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/wireshark.jpg" width="697" data-src="https://www.bleepstatic.com/images/news/Microsoft/Windows-10/p/pktmon/wireshark.jpg"><figcaption><strong>Viewing traffic in Wireshark</strong></figcaption></figure></div>
<p>Once again, these features are not available in Windows 10 1903/1909, and will be coming to Windows 10 2004 when it's released at the end of the month.</p>
<p><strong>Update 5/16/20</strong>: Added other new features coming with Windows 10 2004</p>

</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>