<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Strangling .NET Framework App to .NET Core - Kamil Grzybek - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Strangling .NET Framework App to .NET Core - Kamil Grzybek - linksfor.dev(s)"/>
    <meta property="og:description" content="The incremental approach to migrate from .NET Framework legacy system to the new .NET Core system using Strangler Pattern."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://www.kamilgrzybek.com/design/strangling-net-framework-app-to-net-core/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Strangling .NET Framework App to .NET Core - Kamil Grzybek</title>
<div class="readable">
        <h1>Strangling .NET Framework App to .NET Core - Kamil Grzybek</h1>
            <div>Reading time: 15-18 minutes</div>
        <div>Posted here: 09 Apr 2020</div>
        <p><a href="http://www.kamilgrzybek.com/design/strangling-net-framework-app-to-net-core/">http://www.kamilgrzybek.com/design/strangling-net-framework-app-to-net-core/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		<h2>Introduction</h2>
<p>Each technology becomes obsolete after some time. It is no different with the .NET Framework – it can be safely said that after the appearance of the .NET Core platform, the old Framework is slowly disappearing. Few people write about this platform, at conferences it has not been heard for a long time in this topic. Nobody starts a project in this technology. Only the .NET Core everywhere… except for a beloved legacy systems!</p>
<p>Well, despite the fact that there is .NET Core in the new solutions, a huge number of systems stand on the old .NET Framework. If you are not participating in a greenfield project but more in maintenance, then you are very likely to be sitting in an old framework. Who likes to play with old toys? Nobody. Everyone would like to use new technology, especially if it is better, more efficient and better designed.</p>
<p>Is the only solution to change the project and even the employer to use the new technology? Certainly not. We have 2 other options: <span>“Big Bang Rewrite”</span> or the use of <span>“Strangler Pattern”</span></p>
<h3>Big Bang Rewrite</h3>
<p>Big Bank Rewrite means rewriting the whole application to new technology/system. This is usually the first thought that comes to our minds. After rewriting the entire system, turn off the old system and start the new one. It sounds easy <strong>but is not</strong>. </p>
<p>First of all, users do not use the new system until we have the whole system rewritten. This approach resembles the methodology of running a <a href="https://en.wikipedia.org/wiki/Waterfall_model" rel="noopener" target="_blank">Waterfall </a>project with all its drawbacks.</p>
<p>Secondly, it is an “all or nothing” approach. If during the project it turns out that we have run out of budget, time or resources, the End User is left with nothing – we have not delivered any business value. Users use the old system, which is still difficult to maintain. We can put our unfinished product on the shelf.</p>
<figure id="attachment_1166"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Big_Bang_Rewrite.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Big_Bang_Rewrite-1024x327.jpg" alt="Big Bang Rewrite" width="660" height="211" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Big_Bang_Rewrite-1024x327.jpg 1024w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Big_Bang_Rewrite-300x96.jpg 300w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Big_Bang_Rewrite-768x245.jpg 768w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>Big Bang Rewrite</figcaption></figure>
<p>Can we do it better? Yes, and here comes the so-called <span>“Strangler Pattern”</span>.</p>
<h3>Strangler Pattern</h3>
<p>The origin of this pattern comes from an article written by Martin Fowler called <a href="https://martinfowler.com/bliki/StranglerFigApplication.html" rel="noopener" target="_blank">Strangler Fig Application</a>. The general point is that in tropical forests live figs that live on trees and are slowly “strangling” them.</p>
<p>Apart from the issues of nature, the metaphor is quite interesting and transferring it to the context of rewriting the system is described by Martin Fowler as follows:</p>
<blockquote><p><u>gradually</u> create a new system around the edges of the old, letting it grow slowly over several years until the old system is strangled</p></blockquote>
<p>The keyword here is the word <strong>“gradually”</strong>. So, unlike the <span>“Big Bang Rewrite”</span>, we rewrite our system <u>piece by piece</u>. The functionalities implemented in the new system immediately replace the old ones. This approach has a great advantage because we immediately provide value and get immediate feedback. It is definitely a more “agile” approach with all the advantages.</p>
<figure id="attachment_1164"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Strangler_pattern.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Strangler_pattern-1024x327.jpg" alt="Strangler Pattern" width="660" height="211" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Strangler_pattern-1024x327.jpg 1024w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Strangler_pattern-300x96.jpg 300w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Strangler_pattern-768x245.jpg 768w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>Strangler Pattern</figcaption></figure>
<h2>Motivation</h2>
<p>Before proceeding to implement this approach, I would like to present the motivations for rewriting the system into new technology. Because as with everything – <em>“there is no such thing as a free lunch”</em> – rewriting the system, even in an incremental approach, will cost money, time and resources anyway.</p>
<p>So below is a list of <a href="https://www.kamilgrzybek.com/design/modular-monolith-architectural-drivers/">Architectural Drivers</a> that may affect this decision:</p>
<ul>
<li>Development will be easier, more productive</li>
<li>We can use new techniques, methods, patterns, approaches</li>
<li>System will be more maitainable</li>
<li>New technology gives us more tools, libraries, frameworks</li>
<li>New technology is more efficient and we want to increase performance of our solution</li>
<li>New technology has more support from vendor, community</li>
<li>Support of old technology is ended, no patches and upgrades are available</li>
<li>Old technology can have security vulnerabilities</li>
<li>Developers will be happy</li>
<li>It will be easier to hire new developers</li>
<li>We want to be innovative, increase <a href="https://en.wikipedia.org/wiki/Employer_branding" rel="noopener" target="_blank">Employer branding</a></li>
<li>We must meet some standards and old technology doesn’t make it possible for us</li>
</ul>
<p>As you can see the list is long and you can probably mention other things. So if you think it’s worth it, here’s one way to do it in the Microsoft ecosystem – rewriting the .NET Framework application to .NET Core using <span>“Strangler Pattern”</span>.</p>
<h2>Design</h2>
<p>The main element of this pattern is the <a href="https://en.wikipedia.org/wiki/Proxy_pattern" rel="noopener" target="_blank">Proxy </a>/ <a href="https://en.wikipedia.org/wiki/Facade_pattern" rel="noopener" target="_blank">Facade</a>, which redirects requests to either the legacy system or the new one. The most common example is the use of a load balancer that knows where to direct the request.</p>
<p>If we have to rewrite the API, e.g. Web API, the matter seems to be simple. We rewrite each Web API endpoint and implement the appropriate routing. There is nothing to describe here.</p>
<figure id="attachment_1169"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer-963x1024.jpg" alt="Rewriting using load balancer" width="660" height="702" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer-963x1024.jpg 963w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer-282x300.jpg 282w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer-768x817.jpg 768w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/Rewriting_using_load_balancer.jpg 1212w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>Rewriting using load balancer. FE and BE are separate.</figcaption></figure>
<p>However, in .NET, many systems are written combining both Backend and Frontend. I am thinking of all applications like WebForms, ASP.NET MVC with server-side rendering, WPF, Silverlight etc. In this case, placing the facade in front of the entire application would require generating FrontEnd by a new application as well. </p>
<figure id="attachment_1171"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/FrontEnd_BackEnd_combined.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/FrontEnd_BackEnd_combined-1024x344.jpg" alt="FrontEnd and BackEnd combined" width="660" height="222" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/01/FrontEnd_BackEnd_combined-1024x344.jpg 1024w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/FrontEnd_BackEnd_combined-300x101.jpg 300w, http://www.kamilgrzybek.com/wp-content/uploads/2020/01/FrontEnd_BackEnd_combined-768x258.jpg 768w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>Frontend and Backend combined</figcaption></figure>
<p>Of course, this can be done but I propose a different solution – to rewrite only Backend.</p>
<p>If do not want to put a proxy in front of our old application,<strong> we can use the same old application as a proxy</strong>. In this way, all requests will go through the old application, while some of them will be processed on the side of the new system. This approach has the following implications:</p>
<ul>
<li>Even if all logic is rewritten in the new system, the Frontend / Proxy will remain in the old one.</li>
<li>We need to implement the delegation logic of request processing on the old system</li>
<li>We move from <a href="https://www.kamilgrzybek.com/design/modular-monolith-primer/" rel="noopener" target="_blank">monolithic architecture</a> to a <a href="https://en.wikipedia.org/wiki/Distributed_computing" rel="noopener" target="_blank">distributed system</a> with all its drawbacks (see <a href="https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing" rel="noopener" target="_blank">Fallacies of distributed computing</a>)</li>
</ul>
<p>Let’s see how the architecture of such a solution looks like:</p>
<figure id="attachment_1246"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design-1024x858.jpg" alt="Strangling .NET Framework App to .NET Core" width="660" height="553" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design-1024x858.jpg 1024w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design-300x251.jpg 300w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design-768x644.jpg 768w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-Design.jpg 1365w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>Strangling .NET Framework App to .NET Core</figcaption></figure>
<div><p>The request process is as follows:</p><p>
1. Client sends a request</p><p>
2. Old Frontend receives the request and a forwards it to the old Backend (the same application) or new Backend (new .NET Core application).</p><p>
3. Both backends communicate with the same database</p></div>
<p>Communication with the new backend takes place only through the <span>Gateway</span> (see <a href="https://martinfowler.com/eaaCatalog/gateway.html" rel="noopener" target="_blank">Gateway pattern</a>). This is very important because it <u>highlights the synchronous API call</u> (see <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" rel="noopener" target="_blank">Remote Procedure Call</a>). Under no circumstances don’t hide it! On the contrary – by using the <span>Gateway</span> we show clearly what is happening in our code.</p>
<p>The main goal is that our proxy should be as thin as possible. It should know as little as possible and have the least responsibility. To do this, when communicating with the new system, we can use the <a href="https://docs.microsoft.com/pl-pl/azure/architecture/patterns/cqrs" rel="noopener" target="_blank">CQRS architectural style</a> using the fact that queries and commands can be serialized. In this way, our proxy is only responsible for invoking the appropriate query or command – nothing more. Let’s see how it can be implemented.</p>
<h2>Implementation</h2>
<h3>Backend API</h3>
<p>Let’s start by defining the API of the new system – the endpoints responsible for receiving queries and commands. Thanks to the <a href="https://github.com/jbogard/MediatR" rel="noopener" target="_blank">Mediatr </a>and <a href="https://www.newtonsoft.com/json" rel="noopener" target="_blank">JSON.NET</a> library it is very easy:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b5a929806140" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p></div>
				</td>
						<td><div><p><span>[</span><span>ApiController</span><span>]</span></p><p><span>[</span><span>Route</span><span>(</span><span>"api"</span><span>)</span><span>]</span></p><p><span>public</span><span> </span><span>class</span><span> </span><span>QueriesController</span><span> </span><span>:</span><span> </span><span>ControllerBase</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>readonly</span><span> </span><span>IMediator </span><span>_mediator</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>QueriesController</span><span>(</span><span>IMediator </span><span>mediator</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>_mediator</span><span> </span><span>=</span><span> </span><span>mediator</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>AllowAnonymous</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>HttpPost</span><span>(</span><span>"queries"</span><span>)</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>async</span><span> </span><span>Task</span><span>&lt;</span><span>IActionResult</span><span>&gt;</span><span> </span><span>ExecuteQuery</span><span>(</span><span>RequestDto </span><span>requestDto</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Type </span><span>type</span><span> </span><span>=</span><span> </span><span>GetQueriesAssembly</span><span>(</span><span>)</span><span>.</span><span>GetType</span><span>(</span><span>requestDto</span><span>.</span><span>Type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dynamic</span><span> </span><span>query</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>DeserializeObject</span><span>(</span><span>requestDto</span><span>.</span><span>Data</span><span>,</span><span> </span><span>type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>result</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>_mediator</span><span>.</span><span>Send</span><span>(</span><span>query</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>Ok</span><span>(</span><span>result</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>Assembly </span><span>GetQueriesAssembly</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>typeof</span><span>(</span><span>GetProductsQuery</span><span>)</span><span>.</span><span>Assembly</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0033 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b67591257912" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p></div>
				</td>
						<td><div><p><span>[</span><span>ApiController</span><span>]</span></p><p><span>[</span><span>Route</span><span>(</span><span>"api"</span><span>)</span><span>]</span></p><p><span>public</span><span> </span><span>class</span><span> </span><span>CommandsController</span><span> </span><span>:</span><span> </span><span>ControllerBase</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>readonly</span><span> </span><span>IMediator </span><span>_mediator</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>CommandsController</span><span>(</span><span>IMediator </span><span>mediator</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>_mediator</span><span> </span><span>=</span><span> </span><span>mediator</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>AllowAnonymous</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>HttpPost</span><span>(</span><span>"commands"</span><span>)</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>async</span><span> </span><span>Task</span><span>&lt;</span><span>IActionResult</span><span>&gt;</span><span> </span><span>ExecuteCommand</span><span>(</span><span>RequestDto </span><span>requestDto</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Type </span><span>type</span><span> </span><span>=</span><span> </span><span>GetCommandsAssembly</span><span>(</span><span>)</span><span>.</span><span>GetType</span><span>(</span><span>requestDto</span><span>.</span><span>Type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dynamic</span><span> </span><span>command</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>DeserializeObject</span><span>(</span><span>requestDto</span><span>.</span><span>Data</span><span>,</span><span> </span><span>type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>await</span><span> </span><span>_mediator</span><span>.</span><span>Send</span><span>(</span><span>command</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>Ok</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>AllowAnonymous</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>HttpPost</span><span>(</span><span>"commands-with-result"</span><span>)</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>async</span><span> </span><span>Task</span><span>&lt;</span><span>IActionResult</span><span>&gt;</span><span> </span><span>ExecuteCommandWithResult</span><span>(</span><span>RequestDto </span><span>requestDto</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Type </span><span>type</span><span> </span><span>=</span><span> </span><span>GetCommandsAssembly</span><span>(</span><span>)</span><span>.</span><span>GetType</span><span>(</span><span>requestDto</span><span>.</span><span>Type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dynamic</span><span> </span><span>command</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>DeserializeObject</span><span>(</span><span>requestDto</span><span>.</span><span>Data</span><span>,</span><span> </span><span>type</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>result</span><span> </span><span>=</span><span> </span><span>await</span><span> </span><span>_mediator</span><span>.</span><span>Send</span><span>(</span><span>command</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>Ok</span><span>(</span><span>result</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>Assembly </span><span>GetCommandsAssembly</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>typeof</span><span>(</span><span>AddProductCommand</span><span>)</span><span>.</span><span>Assembly</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0077 seconds] -->

<p>We define a simple <a href="https://en.wikipedia.org/wiki/Data_transfer_object" rel="noopener" target="_blank">Data Transfer Object</a> for these endpoints. It holds the type of object and data in serialized form (JSON):</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b6d083761832" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>public</span><span> </span><span>class</span><span> </span><span>RequestDto</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>string</span><span> </span><span>Type</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>string</span><span> </span><span>Data</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->

<p>At the moment, our API contract is just a list of queries and commands. For our old .NET Framework application to benefit from this contract using strong typing, we must put all of these objects to separate assembly. We want both .NET frameworks and .NET Core to be able to refer to it, so it must be set to target .NET Standard</p>
<figure id="attachment_1254"><a href="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly.jpg"><img src="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly-837x1024.jpg" alt=".NET Standard Contract assembly sharing" width="660" height="807" srcset="http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly-837x1024.jpg 837w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly-245x300.jpg 245w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly-768x939.jpg 768w, http://www.kamilgrzybek.com/wp-content/uploads/2020/04/Strangling-.NET-Framework-App-.NET-Standard-Contract-assembly.jpg 1130w" sizes="(max-width: 660px) 100vw, 660px"></a><figcaption>.NET Standard Contract assembly sharing</figcaption></figure>
<h3>The Gateway</h3>
<p>As I wrote earlier, communication and integration with the new Backend must go through the gateway. The gateway responsibility is:</p>
<p>1. Serialization of the request object<br>
2. Providing additional metadata for a request like the context of the user. This is important because the new <u>Backend should be stateless</u>.<br>
3. Send a request to the appropriate address<br>
4. Deserialization of response / error handling</p>
<p>However, for the client of our Gateway, we want to hide all these responsibilities behind the interface:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b72186792688" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>public</span><span> </span><span>interface</span><span> </span><span>INewAppGateway</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>void</span><span> </span><span>ExecuteCommand</span><span>(</span><span>ICommand </span><span>command</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>T</span><span> </span><span>ExecuteCommand</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>ICommand</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>command</span><span>)</span><span> </span><span>where</span><span> </span><span>T</span><span> </span><span>:</span><span> </span><span>class</span><span>,</span><span> </span><span>new</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>T</span><span> </span><span>ExecuteQuery</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>IQuery</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>query</span><span>)</span><span> </span><span>where</span><span> </span><span>T</span><span> </span><span>:</span><span> </span><span>class</span><span>,</span><span> </span><span>new</span><span>(</span><span>)</span><span>;</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0031 seconds] -->

<p>The implementation of Gateway looks like this:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b75393888288" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p></div>
				</td>
						<td><div><p><span>public</span><span> </span><span>class</span><span> </span><span>NewAppGateway</span><span> </span><span>:</span><span> </span><span>INewAppGateway</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>readonly</span><span> </span><span>string</span><span> </span><span>_backendBaseUrl</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>readonly</span><span> </span><span>IUserContext </span><span>_userContext</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>NewAppGateway</span><span>(</span><span>string</span><span> </span><span>backendBaseUrl</span><span>,</span><span> </span><span>IUserContext </span><span>userContext</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>_backendBaseUrl</span><span> </span><span>=</span><span> </span><span>backendBaseUrl</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>_userContext</span><span> </span><span>=</span><span> </span><span>userContext</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>void</span><span> </span><span>ExecuteCommand</span><span>(</span><span>ICommand </span><span>command</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>RestClient </span><span>client</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>RestClient</span><span>(</span><span>_backendBaseUrl</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>type</span><span> </span><span>=</span><span> </span><span>command</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span><span>FullName</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>data</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>SerializeObject</span><span>(</span><span>command</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>request</span><span> </span><span>=</span><span> </span><span>CreateRequest</span><span>(</span><span>"api/commands"</span><span>,</span><span> </span><span>type</span><span>,</span><span> </span><span>data</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>client</span><span>.</span><span>Execute</span><span>(</span><span>request</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>T</span><span> </span><span>ExecuteCommand</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>ICommand</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>command</span><span>)</span><span> </span><span>where</span><span> </span><span>T</span><span> </span><span>:</span><span> </span><span>class</span><span>,</span><span> </span><span>new</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>RestClient </span><span>client</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>RestClient</span><span>(</span><span>_backendBaseUrl</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>type</span><span> </span><span>=</span><span> </span><span>command</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span><span>FullName</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>data</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>SerializeObject</span><span>(</span><span>command</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>request</span><span> </span><span>=</span><span> </span><span>CreateRequest</span><span>(</span><span>"api/commands-with-result"</span><span>,</span><span> </span><span>type</span><span>,</span><span> </span><span>data</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>response</span><span> </span><span>=</span><span> </span><span>client</span><span>.</span><span>Execute</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>request</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>response</span><span>.</span><span>Data</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>T</span><span> </span><span>ExecuteQuery</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>IQuery</span><span>&lt;</span><span>T</span><span>&gt;</span><span> </span><span>query</span><span>)</span><span> </span><span>where</span><span> </span><span>T</span><span> </span><span>:</span><span> </span><span>class</span><span>,</span><span> </span><span>new</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>client</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>RestClient</span><span>(</span><span>_backendBaseUrl</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>type</span><span> </span><span>=</span><span> </span><span>query</span><span>.</span><span>GetType</span><span>(</span><span>)</span><span>.</span><span>FullName</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>data</span><span> </span><span>=</span><span> </span><span>JsonConvert</span><span>.</span><span>SerializeObject</span><span>(</span><span>query</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>request</span><span> </span><span>=</span><span> </span><span>CreateRequest</span><span>(</span><span>"api/queries"</span><span>,</span><span> </span><span>type</span><span>,</span><span> </span><span>data</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>response</span><span> </span><span>=</span><span> </span><span>client</span><span>.</span><span>Execute</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>request</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>response</span><span>.</span><span>Data</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>private</span><span> </span><span>IRestRequest </span><span>CreateRequest</span><span>(</span><span>string</span><span> </span><span>resource</span><span>,</span><span> </span><span>string</span><span> </span><span>type</span><span>,</span><span> </span><span>string</span><span> </span><span>data</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IRestRequest </span><span>request</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>RestRequest</span><span>(</span><span>resource</span><span>,</span><span> </span><span>Method</span><span>.</span><span>POST</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>request</span><span>.</span><span>RequestFormat</span><span> </span><span>=</span><span> </span><span>DataFormat</span><span>.</span><span>Json</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>request</span><span>.</span><span>JsonSerializer</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>CustomJsonSerializer</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>if</span><span> </span><span>(</span><span>_userContext</span><span>.</span><span>UserId</span><span>.</span><span>HasValue</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>request</span><span>.</span><span>AddHeader</span><span>(</span><span>HttpHeaderKeys</span><span>.</span><span>AuthorizationUserIdKey</span><span>,</span><span> </span><span>_userContext</span><span>.</span><span>UserId</span><span>.</span><span>ToString</span><span>(</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>requestDto</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>RequestDto</span><span>(</span><span>type</span><span>,</span><span> </span><span>data</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>request</span><span>.</span><span>AddBody</span><span>(</span><span>requestDto</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>return</span><span> </span><span>request</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0180 seconds] -->

<p>Finally, we come to usage of our Gateway. Most often it will be a Controller (in the <a href="https://www.kamilgrzybek.com/design/grasp-explained/" rel="noopener" target="_blank">GRASP</a> terms):</p>
<blockquote><p>Represents the overall “system”, “root object”, device that the software is running within, or a major subsystem (these are all variations of a facade controller)</p></blockquote>
<p>In other words, it will be a place in the old application that starts processing the request. In ASP.NET MVC applications this will be the MVC Controller, in WebForms application – the code behind class and in WPF application – ViewModel (from <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel" rel="noopener" target="_blank">MVVM pattern</a>).</p>
<p>For the purposes of this article, I have prepared a console application to make the example as simple as possible:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e8eba8212b7a776009218" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p></div>
				</td>
						<td><div><p><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>INewAppGateway </span><span>gateway</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>NewAppGateway</span><span>(</span><span>"<a href="http://localhost:5000/" rel="nofollow"><span>http</span><span>://</span><span>localhost</span><span>:</span><span>5000</span></a>"</span><span>,</span><span> </span><span>new</span><span> </span><span>UserContextMock</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>UserId</span><span> </span><span>=</span><span> </span><span>Guid</span><span>.</span><span>Parse</span><span>(</span><span>"cd5c2ae8-6939-45b1-b07d-fdfb483b337d"</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Adding first product"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>gateway</span><span>.</span><span>ExecuteCommand</span><span>(</span><span>new</span><span> </span><span>AddProductCommand</span><span>(</span><span>"Product 1"</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Adding second product"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>gateway</span><span>.</span><span>ExecuteCommand</span><span>(</span><span>new</span><span> </span><span>AddProductCommand</span><span>(</span><span>"Product 2"</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Adding third product"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>gateway</span><span>.</span><span>ExecuteCommand</span><span>(</span><span>new</span><span> </span><span>AddProductCommand</span><span>(</span><span>"Product 3"</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Get all products"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>products</span><span> </span><span>=</span><span> </span><span>gateway</span><span>.</span><span>ExecuteQuery</span><span>(</span><span>new</span><span> </span><span>GetProductsQuery</span><span>(</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>foreach</span><span> </span><span>(</span><span>var</span><span> </span><span>productDto </span><span>in</span><span> </span><span>products</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$</span><span>"Product name : {productDto.Name} for user: {productDto.UserId}"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>ReadKey</span><span>(</span><span>)</span><span>;</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0060 seconds] -->

<p>This sample application adds 3 products by executing 3 commands and finally gets the list of added products by executing the query. Of course, in a real application Gateway interface is injected in accordance with the principle of <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" rel="noopener" target="_blank">Dependency Inversion Principle</a>.</p>
<h2>Example repository</h2>
<p>The entire implementation can be found on my specially prepared GitHub repository: <a href="https://github.com/kgrzybek/old-dotnet-to-core-sample">https://github.com/kgrzybek/old-dotnet-to-core-sample</a> </p>
<h2>Summary</h2>
<p>In this article I discussed the following topics:</p>
<ul>
<li>Approaches and motivations for rewriting the system</li>
<li>Strangler Pattern</li>
<li>Designing the system for rewriting</li>
<li>Implementation of incremental migration from .NET Framework applications to .NET Core</li>
</ul>
<p>The decision to rewrite the system is often not easy because it is a long-term investment. At the very beginning, the development of a new system rarely brings any business value – only costs.</p>
<p>That is why it is always important to <strong>clearly explain to all stakeholders what benefits the rewriting of the system will bring and what risks the lack of such rewriting may result</strong>. In this way, it will be much easier to convince anyone to rewrite the system and we will not look like people who only care about playing with new toys. Good luck!</p>
<h2>Related Posts</h2>
<p>1. <a href="https://www.kamilgrzybek.com/design/simple-cqrs-implementation-with-raw-sql-and-ddd/">Simple CQRS implementation with raw SQL and DDD</a><br>
2. <a href="https://www.kamilgrzybek.com/design/grasp-explained/">GRASP – General Responsibility Assignment Software Patterns Explained</a><br>
3. <a href="https://www.kamilgrzybek.com/design/processing-commands-with-hangfire-and-mediatr/">Processing commands with Hangfire and MediatR</a></p>
	</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>