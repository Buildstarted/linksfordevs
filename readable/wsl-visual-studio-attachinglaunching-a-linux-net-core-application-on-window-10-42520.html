<!DOCTYPE html>
<html lang="en">
<head>
    <title>
WSL &#x2B; Visual Studio = attaching/launching a Linux&#xA0;.NET Core application on my Window 10 - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="WSL &#x2B; Visual Studio = attaching/launching a Linux&#xA0;.NET Core application on my Window 10 - linksfor.dev(s)"/>
    <meta property="article:author" content="Christophe Nasarre"/>
    <meta property="og:description" content="This post shows how to attach to a&#xA0;.NET Core process running on Linux with WSL and also how to start a Linux process with Visual Studio&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/criteo-labs/wsl-visual-studio-attaching-launching-a-linux-net-core-application-on-my-window-10-ab21c179702d"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - WSL &#x2B; Visual Studio = attaching/launching a Linux&#xA0;.NET Core application on my Window 10</title>
<div class="readable">
        <h1>WSL &#x2B; Visual Studio = attaching/launching a Linux&#xA0;.NET Core application on my Window 10</h1>
            <div>by Christophe Nasarre</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 22 Nov 2019</div>
        <p><a href="https://medium.com/criteo-labs/wsl-visual-studio-attaching-launching-a-linux-net-core-application-on-my-window-10-ab21c179702d">https://medium.com/criteo-labs/wsl-visual-studio-attaching-launching-a-linux-net-core-application-on-my-window-10-ab21c179702d</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><section><div><div><div><div><div><div><p><a rel="noopener" href="https://medium.com/@chnasarre?source=post_page-----ab21c179702d----------------------"><img alt="Christophe Nasarre" src="https://miro.medium.com/fit/c/96/96/0*p_afBNMUbL9S3Ojv" width="48" height="48"></a></p></div></div></div></div><p id="a3f7" data-selectable-paragraph="">This post shows how to attach to a .NET Core process running on Linux with WSL and also how to start a Linux process with Visual Studio debugger</p><p id="1e91" data-selectable-paragraph="">Coming from the Windows world, I don’t find that easy to develop .NET Core applications for Linux. I’m used to code and debug in Visual Studio. Now, I need to build on Windows (due to our Criteo continuous integration), deploy an artifact to Marathon in order to get an application running inside a Mesos container. At Criteo, we had to build a whole set of services to allow remote debugging or memory dump analysis.</p><p id="8c99" data-selectable-paragraph="">But what if I just wanted to test and debug a small scenario on my beloved Windows machine? Windows Subsystem for Linux (aka WSL) is perfect for running a Linux .NET Core application on Windows. However, how to attach to it or even start a debugging session from Visual Studio? In the rest of this post, I’ll explain how to setup your Windows 10 machine to achieve these miracles.</p><p id="f25c" data-selectable-paragraph=""><strong>Linux on Windows: welcome WSL</strong></p><p id="e49a" data-selectable-paragraph="">It is obviously not the place to dig into Windows Subsystem for Linux. You just need to know that once installed, it allows you open up a Linux shell on your Windows machine without any virtual machine kind of technology. It is also possible to share folders between Windows (where you want to build your application) and Linux (where you want to execute the built assemblies).</p><p id="a39c" data-selectable-paragraph="">The first step is to turn on WSL feature in your Windows:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*wWxcALCpjyt9rusNe-HEhA.png?q=20" width="911" height="595" role="presentation"></p><p><img width="911" height="595" role="presentation" src="https://miro.medium.com/max/911/1*wWxcALCpjyt9rusNe-HEhA.png"></p></div></div></div></div></figure><p id="820a" data-selectable-paragraph="">After a reboot, you are able to start a WSL prompt:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*H2J7LJHM_0IhH53Wp39y1A.png?q=20" width="495" height="186" role="presentation"></p><p><img width="495" height="186" role="presentation" src="https://miro.medium.com/max/495/1*H2J7LJHM_0IhH53Wp39y1A.png"></p></div></div></div></figure><p id="8889" data-selectable-paragraph="">You can also <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" target="_blank" rel="noopener nofollow">install your favorite Linux distro</a> if you want.</p><p id="b52e" data-selectable-paragraph="">The next step is to install <a href="https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/runtime-current" target="_blank" rel="noopener nofollow">.NET Core runtime</a> or SDK so you are able to run your application on Linux.</p><p id="fa73" data-selectable-paragraph="">It is now time to look at your hard drive from a Linux perspective:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*I8QG0SAEL5VBfFxDFjeu6A.png?q=20" width="400" height="71" role="presentation"></p><p><img width="400" height="71" role="presentation"></p></div></div></div></figure><p id="0729" data-selectable-paragraph="">Your drives are mapped under /mnt without the “:”. In my case, I created a wsl folder under my d: drive to do my experiments. With Visual Studio, I generated a TestConsole application with the following code:</p><figure><div></div></figure><p id="63e0" data-selectable-paragraph="">I’m publishing the application to get all needed assemblies:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*704gGclGK7DghZt9KWt5aw.png?q=20" width="656" height="438" role="presentation"></p><p><img width="656" height="438" role="presentation"></p></div></div></div></figure><p id="50e1" data-selectable-paragraph="">In a WSL prompt, type <strong>dotnet</strong> with the name of your application assembly et voila!</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*vevFiW92sk4T-gj1afHX7g.png?q=20" width="996" height="150" role="presentation"></p><p><img width="996" height="150" role="presentation"></p></div></div></div></div></figure><p id="7304" data-selectable-paragraph="">A Linux .NET Core application is running on your Windows machine.</p><p id="096c" data-selectable-paragraph=""><strong>How to attach to a running Linux application</strong></p><p id="fa12" data-selectable-paragraph="">Let’s say that I’m detecting a problem and I want to debug the Linux application with Visual Studio. When attaching the Visual Studio debugger to a process, several connection types are available:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*DvtErIdCBVZK5eiosgl1jQ.png?q=20" width="977" height="223" role="presentation"></p><p><img width="977" height="223" role="presentation"></p></div></div></div></div></figure><p id="57b5" data-selectable-paragraph="">The SSH connection type will be used with WSL with the following kind of communications architecture:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*xCaMzwnuuIBS_yLZN0k8pg.png?q=20" width="577" height="500" role="presentation"></p><p><img width="577" height="500" role="presentation"></p></div></div></div></figure><p id="e95a" data-selectable-paragraph="">The Visual Studio debugger is sending commands to the remote Linux debugger vsdbg via an SSH channel. Here are the steps to follow to install the missing components:</p><ol><li id="7729" data-selectable-paragraph="">By default, an SSH server is installed with WSL. However, I was not able to make the whole pipeline work with it so I had to uninstall and reinstall it:<br><code>sudo apt-get remove openssh-server</code><br><code>sudo apt-get install openssh-server</code></li><li id="56fc" data-selectable-paragraph="">The SSH configuration needs also to be changed in order to allow username/password kind of security needed by Visual Studio (if you prefer key-based security, look at the end of the post for available resources). If you don’t know how to use vi efficiently to simply edit a file, install nano (thanks @kookiz for the tips :^)<br><code>sudo apt-get install nano</code></li><li id="9ed3" data-selectable-paragraph="">In /etc/ssh/sshd_config, change the PasswordAuthentication settings<br><code>sudo nano /etc/ssh/sshd_config<br>PasswordAuthentication yes</code></li><li id="b67b" data-selectable-paragraph="">Restart the ssh server<br><code>sudo service ssh start</code></li><li id="945f" data-selectable-paragraph="">You need to install unzip in order to get vsdbg<br><code>sudo apt-get install unzip<br>curl -sSL <a href="https://aka.ms/getvsdbgsh" target="_blank" rel="noopener nofollow">https://aka.ms/getvsdbgsh</a> | bash /dev/stdin -v latest -l ~/vsdbg</code></li></ol><p id="2cdc" data-selectable-paragraph="">You are now ready to select SSH as connection type and enter your machine name before clicking the Refresh button. At that time, a new dialog should pop up for you to enter your WSL credentials:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*ir_VKzbyLhKrcOPWLYKSIA.png?q=20" width="953" height="786" role="presentation"></p><p><img width="953" height="786" role="presentation"></p></div></div></div></div></figure><p id="85db" data-selectable-paragraph="">After you click the Refresh button, the list at the bottom should contain the Linux processes running in WSL</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*QfZCPLgxNkgL6YgBTB2_Ug.png?q=20" width="978" height="807" role="presentation"></p><p><img width="978" height="807" role="presentation"></p></div></div></div></div></figure><p id="2bb1" data-selectable-paragraph="">Select your .NET Core application and click Attach to select the Managed debugger:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*SmNkyPOVL98SW63NvIMMRA.png?q=20" width="530" height="328" role="presentation"></p><p><img width="530" height="328" role="presentation"></p></div></div></div></figure><p id="7432" data-selectable-paragraph="">Now, if you set a breakpoint in the code and trigger it with an appropriate action in your WSL prompt</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*CrUfw_8-c40dk_R5P7peow.png?q=20" width="441" height="170" role="presentation"></p><p><img width="441" height="170" role="presentation"></p></div></div></div></figure><p id="be35" data-selectable-paragraph="">then the debugger will break as expected:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*04MwvOr1WgetWjsCQu9epA.png?q=20" width="790" height="306" role="presentation"></p><p><img width="790" height="306" role="presentation"></p></div></div></div></div></figure><p id="5557" data-selectable-paragraph="">Note that when you stop your debugging session, the Linux application is not stopped; just detached from the debugger and keeps on running.</p><p id="958c" data-selectable-paragraph=""><strong>Showtime for F5!</strong></p><p id="8c52" data-selectable-paragraph="">Attaching to a running Linux application is nice but it would be even better to start a Linux process from Visual Studio debugger. In order to achieve this goal you need to add another piece to the architecture puzzle:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*uMcLQA9pq4wtHLq61dV8Gw.png?q=20" width="577" height="500" role="presentation"></p><p><img width="577" height="500" role="presentation"></p></div></div></div></figure><p id="2084" data-selectable-paragraph="">As detailed in <a href="https://github.com/Microsoft/MIEngine/wiki/Offroad-Debugging-of-.NET-Core-on-Linux---OSX-from-Visual-Studio" target="_blank" rel="noopener nofollow">this WIKI page</a>, it is possible to tell Visual Studio to execute debugging actions thanks to a launch.json file such as the following:</p><figure><div></div></figure><p id="38eb" data-selectable-paragraph="">The <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank" rel="noopener nofollow">plink tool from putty</a> will be used as an adapter for Visual Studio to communicate with vsdbg running in WSL. The <strong>adapterArgs</strong> property gives the same SSH/machine/user/password information that you provide via Visual Studio UI in the Attach scenario. The <strong>configuration</strong> section defines which request (“launch” instead of attach and which folder/assembly to start) will be sent to vsdbg.</p><p id="040f" data-selectable-paragraph="">Once this file is created (in my case in d:\wsl\vs folder), you just need to type the following command in the Immediate pane of Visual Studio:</p><p id="fce4" data-selectable-paragraph=""><code>DebugAdapterHost.Launch /LaunchJson:d:\wsl\vs\launch.json</code></p><p id="60be" data-selectable-paragraph="">and if you had set a breakpoint on the first line of your application, the debugger should break there:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*C47ToX7-YaX6BGyRghirBg.png?q=20" width="712" height="454" role="presentation"></p><p><img width="712" height="454" role="presentation"></p></div></div></div></div></figure><p id="07d8" data-selectable-paragraph="">In a WSL prompt, you can see the expected 2 new spawned processes:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*fgJIfDh6d7D_ScWh-wJQ-g.png?q=20" width="1432" height="39" role="presentation"></p><p><img width="1432" height="39" role="presentation"></p></div></div></div></div></figure><p id="cf0f" data-selectable-paragraph="">But wait!</p><p id="e13b" data-selectable-paragraph="">I have a problem now: I don’t have any prompt in which typing input for my console application… However, as always in Linux, you simply need to write to a file to fix this. The stdin stream of your application is accessible under <code>/proc/&lt;pid&gt;/fd/0</code>.</p><p id="71eb" data-selectable-paragraph="">So, when I type the following command:</p><p id="dfc5" data-selectable-paragraph=""><code>echo "Launching a Linux app is not a problem!" &gt; /proc/18341/fd/0</code></p><p id="b24c" data-selectable-paragraph="">my breakpoint is hit in Visual Studio:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*3_cdYBQnO98KTGt1W18P2Q.png?q=20" width="800" height="234" role="presentation"></p><p><img width="800" height="234" role="presentation"></p></div></div></div></div></figure><p id="fa7d" data-selectable-paragraph="">Also note that everything that is sent to the console appears in Visual Studio Output pane:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/60/1*taAUpwNYE-9oVC7_C3Aahw.png?q=20" width="556" height="322" role="presentation"></p><p><img width="556" height="322" role="presentation"></p></div></div></div></figure><p id="ad70" data-selectable-paragraph="">Note that, unlike the Attach scenario, if you stop the debugging session, the Linux application (and vsdbg) will be terminated.</p><p id="186b" data-selectable-paragraph=""><strong>Resources</strong></p><p id="982e" data-selectable-paragraph="">During my investigations I’ve found a few resources you might find useful (especially about configuring SSL with keys instead of passing clear user/password)</p><ul><li id="b80f" data-selectable-paragraph="">Basic VS + WSL — <a href="https://devblogs.microsoft.com/devops/debugging-net-core-on-unix-over-ssh/" target="_blank" rel="noopener nofollow">https://devblogs.microsoft.com/devops/debugging-net-core-on-unix-over-ssh/</a></li><li id="43ad" data-selectable-paragraph="">Good description about how to use VS 2017 to attach to .NET Core app running in WSL — <a href="http://parsstudent.com/debug-netcore-running-in-wsl-with-vs2017/" target="_blank" rel="noopener nofollow">http://parsstudent.com/debug-netcore-running-in-wsl-with-vs2017/</a></li><li id="a79f" data-selectable-paragraph="">Debugging .NET Core from VS 2017 and WSL — <a href="https://www.dotnetcatch.com/2017/04/23/debugging-net-core-from-vs2017-on-windows-subsystem-for-linux/" target="_blank" rel="noopener nofollow">https://www.dotnetcatch.com/2017/04/23/debugging-net-core-from-vs2017-on-windows-subsystem-for-linux/</a></li><li id="8182" data-selectable-paragraph="">VS/C++ with WSL (describe how to install WSL and setup open ssh server) — <a href="https://www.planetanalog.com/using-visual-studio-and-wsl-to-develop-linux-applications-for-the-iot/" target="_blank" rel="noopener nofollow">https://www.planetanalog.com/using-visual-studio-and-wsl-to-develop-linux-applications-for-the-iot/</a></li><li id="04af" data-selectable-paragraph="">Setup SSH on WSL — <a href="https://www.illuminiastudios.com/dev-diaries/ssh-on-windows-subsystem-for-linux/" target="_blank" rel="noopener nofollow">https://www.illuminiastudios.com/dev-diaries/ssh-on-windows-subsystem-for-linux/</a></li><li id="ff84" data-selectable-paragraph="">Wiki for VSDBG — <a href="https://github.com/Microsoft/MIEngine/wiki/Offroad-Debugging-of-.NET-Core-on-Linux---OSX-from-Visual-Studio" target="_blank" rel="noopener nofollow">https://github.com/Microsoft/MIEngine/wiki/Offroad-Debugging-of-.NET-Core-on-Linux---OSX-from-Visual-Studio</a></li><li id="606e" data-selectable-paragraph="">Great description about how to setup your linux dev environment with VS Code and WSL — <a href="https://devblogs.microsoft.com/commandline/an-in-depth-tutorial-on-linux-development-on-windows-with-wsl-and-visual-studio-code/" target="_blank" rel="noopener nofollow">https://devblogs.microsoft.com/commandline/an-in-depth-tutorial-on-linux-development-on-windows-with-wsl-and-visual-studio-code/</a></li></ul></div></div></section></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>