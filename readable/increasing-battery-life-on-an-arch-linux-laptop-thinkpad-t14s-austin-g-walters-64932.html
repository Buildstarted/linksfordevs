<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Increasing Battery Life on an Arch Linux Laptop (ThinkPad T14s) - Austin G. Walters - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Increasing Battery Life on an Arch Linux Laptop (ThinkPad T14s) - Austin G. Walters - linksfor.dev(s)"/>
    <meta property="og:description" content="Configure and Arch Linux laptop to maximize battery performance while not reducing performance. In this case, we cover T14s and stretch battery life 2hrs."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://austingwalters.com/increasing-battery-life-on-an-arch-linux-laptop-thinkpad-t14s/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Increasing Battery Life on an Arch Linux Laptop (ThinkPad T14s) - Austin G. Walters</title>
<div class="readable">
        <h1>Increasing Battery Life on an Arch Linux Laptop (ThinkPad T14s) - Austin G. Walters</h1>
            <div>Reading time: 14-18 minutes</div>
        <div>Posted here: 28 Jul 2020</div>
        <p><a href="https://austingwalters.com/increasing-battery-life-on-an-arch-linux-laptop-thinkpad-t14s/">https://austingwalters.com/increasing-battery-life-on-an-arch-linux-laptop-thinkpad-t14s/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><article id="post-3409">

<div>
<p>This week I received the latest 14in laptop from Lenovo, the T14s (AMD gen1). Below are some of the tweaks / setup I’ve done on my machine (and generally all my laptops) which typically increase the battery life (with no noticeable reduction in performance).</p>
<p><a href="https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated.jpeg"><img src="https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128.jpeg" data-lazy-type="image" data-src="https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128.jpeg" alt="" width="700" height="500" srcset="https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128.jpeg 1800w, https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128-300x214.jpeg 300w, https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128-1024x732.jpeg 1024w, https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128-768x549.jpeg 768w, https://austingwalters.com/wp-content/uploads/2020/07/laptop-on-table-rotated-e1595655657128-1536x1097.jpeg 1536w" data-srcset="" sizes="(max-width: 700px) 100vw, 700px"></a></p>
<p>The specs are as follows (Lenovo Thinkpad T14s):</p>
<ul>
<li>CPU – 8 Core, 16 Thread – AMD Ryzen 7 Pro 4750u</li>
<li>GPU – AMD Renoir</li>
<li>DISK – 2Tb – M.2 NVME SSD – 970 EVO Plus</li>
<li>RAM – 32 Gb</li>
<li>DISPLAY – 1080p low power (ISP)</li>
<li>KEYBOARD – backlit English</li>
</ul>
<p>As all my machines run on Arch Linux (with Gnome as the GUI), I went ahead and installed the latest build. It worked out of the box, no issues, was up in about an hour.</p>
<p>However, it does requires quite a few optimizations to get power consumption down on a laptop. The goal is always to maximize battery life, while enabling all the functions you’d normally do on a machine.</p>
<h2>BIOS</h2>
<p>On any new laptop, it’s often possible to disable features you don’t need in the BIOS. For instance, any 3rd party software and unused components (such as fingerprint scanner), Bluetooth, etc. can switched off. Often, this will power down those components and save battery.</p>
<p>In this case, I turned off the following components (it’s possible to turn them back on, if needed):</p>
<ul>
<li>Ethernet LAN</li>
<li>USB Port</li>
<li>Memory Card Slot</li>
<li>Smart Card Slot</li>
<li>Fingerprint Reader</li>
</ul>
<p><a href="https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list.jpeg"><img src="https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list.jpeg" data-lazy-type="image" data-src="https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list.jpeg" alt="" width="532" height="236" srcset="https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list.jpeg 800w, https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list-300x133.jpeg 300w, https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list-768x341.jpeg 768w" data-srcset="https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list.jpeg 800w, https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list-300x133.jpeg 300w, https://austingwalters.com/wp-content/uploads/2020/07/device-disabled-list-768x341.jpeg 768w" sizes="(max-width: 532px) 100vw, 532px"></a></p>
<p>There is also some 3rd party software which apparently you can also uninstall:</p>
<p><a href="https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled.jpeg"><img src="https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled.jpeg" data-lazy-type="image" data-src="https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled.jpeg" alt="" width="533" height="142" srcset="https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled.jpeg 780w, https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled-300x80.jpeg 300w, https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled-768x205.jpeg 768w" data-srcset="https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled.jpeg 780w, https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled-300x80.jpeg 300w, https://austingwalters.com/wp-content/uploads/2020/07/security-chip-disabled-768x205.jpeg 768w" sizes="(max-width: 533px) 100vw, 533px"></a></p>
<p>That’s it! It’s possible to later turn on components if necessary. This should result in some minor reductions in power draw.</p>
<h2>TLP or PowerTop</h2>
<p>On the software side, the first step is to install <a href="https://wiki.archlinux.org/index.php/Powertop" target="_blank" rel="noopener noreferrer">PowerTop</a>. This lets you manage and monitor <em>almost </em>everything you’ll need related to power consumption: turning off components, increasing system wakes, etc.</p>
<p>This can get rather complex, but for brevity: <a href="https://wiki.archlinux.org/index.php/Powertop#Calibration_to_prevent_inaccurate_measurement" target="_blank" rel="noopener noreferrer">start with calibrating PowerTop</a>. I should note, this will run several measurements, changing screen brightness, fan speed, etc. and will take some time (few minutes), so be prepared:</p>
<blockquote>
<pre>sudo powertop --calibrate
</pre>
</blockquote>
<p>Launch powertop with sudo:</p>
<blockquote>
<pre>sudo powertop</pre>
</blockquote>
<p>Tab over to “Tunables” and turn on / off various recommendations. This can often result in 5-25% gains in battery life. To set all recommendations to “good”, utilize auto-tune:</p>
<blockquote>
<pre>sudo powertop --auto-tune</pre>
</blockquote>
<p>This will automatically run all the possible recommendations.</p>
<p>Finally, if you’d like these changes to be persistent (aka not run the command every time you startup the laptop), it’s recommended you create a service:</p>
<pre>/etc/systemd/system/powertop.service</pre>
<div><div id="gist104514519">
    <div>
      <div>
        <div>
  <div id="file-powertop-service">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-powertop-service-L1" data-line-number="1"></td>
        <td id="file-powertop-service-LC1">[Unit]</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L2" data-line-number="2"></td>
        <td id="file-powertop-service-LC2">Description=Powertop tunings</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L3" data-line-number="3"></td>
        <td id="file-powertop-service-LC3">
</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L4" data-line-number="4"></td>
        <td id="file-powertop-service-LC4">[Service]</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L5" data-line-number="5"></td>
        <td id="file-powertop-service-LC5">Type=oneshot</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L6" data-line-number="6"></td>
        <td id="file-powertop-service-LC6">ExecStart=/usr/bin/powertop --auto-tune</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L7" data-line-number="7"></td>
        <td id="file-powertop-service-LC7">
</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L8" data-line-number="8"></td>
        <td id="file-powertop-service-LC8">[Install]</td>
      </tr>
      <tr>
        <td id="file-powertop-service-L9" data-line-number="9"></td>
        <td id="file-powertop-service-LC9">WantedBy=multi-user.target</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
</div>
<p>Then enable the service:</p>
<blockquote>
<pre>sudo systemctl enable powertop.service</pre>
</blockquote>
<p>This will automatically tune your computer to improve power utilization on boot (although it’ll slow the boot process 1-3 seconds).</p>
<p>It is also important to note that there is <a href="https://wiki.archlinux.org/index.php/TLP" target="_blank" rel="noopener noreferrer">TLP</a>, which also offers a similar service to PowerTop. There are some noticeable differences with TLP. TLP for instance, doesn’t shutdown all connected devices (i.e. PCI devices).</p>
<p>I personally chose TLP, but many other swear by PowerTop.</p>
<p>TLP requires a far more minimal setup:</p>
<blockquote>
<pre>sudo systemctl enable tlp.service</pre>
</blockquote>
<h2>Suspend vs Hibernate</h2>
<p>The next improvement that can dramatically improve the time between charges is modifying the suspend behavior.</p>
<p>Don’t know what suspend is?</p>
<blockquote><p><strong>Suspend to RAM</strong> – Keep machine state in RAM. This requires keeping the RAM powered, but power is cut to other components of the system (keyboard, monitor, etc.)</p></blockquote>
<p>Essentially, when a laptop lid opens, it instantly boots, often before the laptop is fully ajar. This lets you get “right to work”, but that requires the RAM to be constantly powered.</p>
<p>There is an alternative method, often called <em>Suspend to Disk</em> or <em>Hibernation</em></p>
<blockquote><p><strong>Hibernation (Suspend to Disk)</strong> – Saves the machine state into the <a href="https://www.linux.com/news/all-about-linux-swap-space/" target="_blank" rel="noopener noreferrer"><em>swap space</em></a> on disk and completely powers off the machine. When the lid is opened / machine is powered on, the machine state is loaded into RAM.</p></blockquote>
<p>The hibernation method can save power for very long periods, as it completely powers down the machine. The drawback is that (at least on my machine) it can take 10-30 seconds to boot into the prior state.</p>
<p>In addition, a <strong>swap file or partition is required</strong>. Note, it is recommend that the swap space is 2-3x than the available RAM.</p>
<p>The beauty, is it’s possible to marry the two methods called: <em>suspend-then-hibernate</em>. It’s possible to <em>suspend</em> for a duration of time (say one hour), then if the laptop isn’t brought out of <em>suspend</em> it will <em>hibernate</em>.</p>
<blockquote><p><strong>Suspend then Hibernate</strong> – Keep the machine state in RAM for a duration of time, then transition to <em>Hibernation</em> on disk.</p></blockquote>
<p>I should note, it’s also possible to do both <em>suspend</em> and <em>hibernate</em> at the same time, in the case of power loss.</p>
<blockquote><p><strong>Suspend and Hibernate</strong> – The machine state is copied to the <em>swap space</em> and continues to be stored in RAM. The RAM will continue to draw power, but if power is lost the machine state can be recovered.</p></blockquote>
<h2>Closing the Lid</h2>
<p>The most effective power saving method (as discussed above) is to hibernate, every time.</p>
<p>However, it can be rather annoying to close a laptop, realize you need something, then reopen it and waiting 30 seconds for it to boot.</p>
<blockquote><p>Is a 30 second delay in booting your laptop worth the power savings?</p></blockquote>
<p>Honestly, most people should say it’s a worthy trade. Thirty seconds is a negligible amount of time, given we often open our laptops for hours.</p>
<p>That being said, there’s something primal about being able to open a laptop and being “ready-to-rock” in less than a few seconds. With that in mind, I used the <em>Suspend-then-Hibernate</em> configuration. The <em>suspend-then-hibernate</em> behavior will let the computer quickly boot for some specified amount of time (say 2 hours), after which it will enter the hibernation state.</p>
<h2>Hibernate Configuration</h2>
<p>First, to configure the <em>hibernate</em> behavior, simply edit the following files.</p>
<p>To get <em>hibernate</em> configured, inform GRUB where and how to swap. I personally recommend a swap partition over a swap file as the swap file appears to cause issues in some machines[<a href="https://askubuntu.com/questions/6769/hibernate-and-resume-from-a-swap-file" target="_blank" rel="noopener noreferrer">1</a>].</p>
<p>To accomplish this, find the swap partition, and add the UUID to the GRUB_CMDLINE_LINUX_DEFAULT.</p>
<pre><strong>$ sudo lsblk</strong>
NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
nvme0n1     259:0    0  1.8T  0 disk 
├─nvme0n1p1 259:1    0    1G  0 part  
├─nvme0n1p2 259:2    0   64G  0 part [SWAP]
└─nvme0n1p3 259:3    0  1.8T  0 part /
<strong>$ sudo lsblk -f | grep SWAP</strong>
├─nvme0n1p2 swap   1 &lt;UUID&gt;  [SWAP]</pre>
<p>Add the resume=UUID=&lt;PARTITION UUID&gt; to the following file:</p>
<pre>/etc/default/grub</pre>
<div><div id="gist104521625">
    <div>
      <div>
        <div>
  <div id="file-grub">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-grub-L1" data-line-number="1"></td>
        <td id="file-grub-LC1"># Resume UUID set to enable hybernation, will write RAM to swap                 </td>
      </tr>
      <tr>
        <td id="file-grub-L2" data-line-number="2"></td>
        <td id="file-grub-LC2">GRUB_CMDLINE_LINUX_DEFAULT="resume=UUID=&lt;PARTITION UUID&gt; loglevel=3 quiet"</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
</div>
<p>From there, you can start hibernating by adding the MAJ:MIN values for the swap partition to /sys/power/resume with the following command[<a href="https://wiki.archlinux.org/index.php/Power_management/Suspend_and_hibernate#Hibernation" target="_blank" rel="noopener noreferrer">2</a>]:</p>
<pre>sudo echo 259:2 &gt; /sys/power/resume</pre>
<p>It should then be possible to hibernate.</p>
<p>To make the changes to GRUB on boot, execute the following:</p>
<pre>sudo grub-mkconfig -o /boot/grub/grub.cfg</pre>
<p>At this point, a reboot is recommended.</p>
<h2>Suspend-Then-Hibernate Configuration</h2>
<p>Once it’s possible to enter &amp; wake from the hibernation state, we can then transition to the <em>suspend-then-hibernate</em> step. For this, we have to configure systemd to handle entering <em>hibernation</em> from the <em>suspend</em> state after a given period.</p>
<p>There are two edits here:</p>
<ol>
<li>Set a delay in the sleep.conf, which will inform systemd how long to stay in the suspend state before hibernating.</li>
<li>Inform systemd the behavior of the power switch, lid closing, and suspend state.</li>
</ol>
<p>See the file edits below:</p>
<pre>/etc/systemd/sleep.conf</pre>
<div><div id="gist104514809">
    <div>
      <div>
        <div>
  <div id="file-sleep-conf">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-sleep-conf-L1" data-line-number="1"></td>
        <td id="file-sleep-conf-LC1">[Sleep]</td>
      </tr>
      <tr>
        <td id="file-sleep-conf-L2" data-line-number="2"></td>
        <td id="file-sleep-conf-LC2">suspend=suspend-then-hibernate</td>
      </tr>
      <tr>
        <td id="file-sleep-conf-L3" data-line-number="3"></td>
        <td id="file-sleep-conf-LC3">HibernateState=disk</td>
      </tr>
      <tr>
        <td id="file-sleep-conf-L4" data-line-number="4"></td>
        <td id="file-sleep-conf-LC4"># Suspend then Hibernate after 45 min</td>
      </tr>
      <tr>
        <td id="file-sleep-conf-L5" data-line-number="5"></td>
        <td id="file-sleep-conf-LC5">HibernateDelaySec=2700</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
</div>
<pre>/etc/systemd/logind.conf</pre>
<div><div id="gist104514799">
    <div>
      <div>
        <div>
  <div id="file-logind-conf">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-logind-conf-L1" data-line-number="1"></td>
        <td id="file-logind-conf-LC1">[Login]</td>
      </tr>
      <tr>
        <td id="file-logind-conf-L2" data-line-number="2"></td>
        <td id="file-logind-conf-LC2">HandlePowerKey=suspend-then-hibernate</td>
      </tr>
      <tr>
        <td id="file-logind-conf-L3" data-line-number="3"></td>
        <td id="file-logind-conf-LC3">HandleLidSwitch=suspend-then-hibernate</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
</div>
<p>The above enables closing the lid or clicking power button to trigger a <em>suspend-then-hibernate state.</em> For the first 45 minutes (in this case), the machine state will be kept in RAM. After 45 minutes (in this case), the machine state will write to disk and power down.</p>
<p>When the lid is next opened, if the machine is in the&nbsp;<em>suspend</em> state (&lt;45 minutes), logging in will take a second or two. If the machine is in the <em>hibernation</em> state, the system will power up, load the machine state into RAM, then let you login (~25-30 seconds).</p>
<h2>Quickly Recovering from Hibernation</h2>
<p>One quick way to speed up recovering from hibernation is to reduce the time the grub menu is up. To edit this, go to:</p>
<pre>/etc/default/grub</pre>
<p>And edit the following command, I changed it from GRUB_TIMEOUT=5 to:</p>
<pre>GRUB_TIMEOUT=1</pre>
<p>This saves an addition 4 seconds on boot, although this does mean you’ll have to act fast if you need to utilize the grub menu. After that, you’ll have to execute the following command for it to take effect:</p>
<pre>sudo grub-mkconfig -o /boot/grub/grub.cfg</pre>
<p>Beyond speeding up GRUB, you can run the following command to analyze the boot up process via <a href="https://wiki.archlinux.org/index.php/Improving_performance/Boot_process" target="_blank" rel="noopener noreferrer">systemd-analyze</a>:</p>
<pre>$ sudo systemd-analyze
Startup finished in 5.566s (firmware) + 2.088s (loader) 
+ 1.010s (kernel) + 9.702s (userspace) = 18.368s 
graphical.target reached after 9.614s in userspace</pre>
<p>To get a more detailed list use the blame or critical-chain argument:</p>
<pre>$ sudo systemd-analyze critical-chain
The time when unit became active or started is printed after the "@" character.
The time the unit took to start is printed after the "+" character.

graphical.target @9.614s
└─multi-user.target @9.613s
  └─autofs.service @9.577s +34ms
    └─remote-fs.target @9.575s
      └─mnt-archive.mount @9.040s +534ms
        └─network-online.target @9.037s
          └─NetworkManager-wait-online.service @920ms +8.116s
            └─NetworkManager.service @880ms +38ms
              └─dbus.service @877ms
                └─basic.target @876ms
                  └─sockets.target @876ms
                    └─dbus.socket @876ms
                      └─sysinit.target @874ms
                        └─systemd-backlight@backlight:amdgpu_bl0.service @2.609s +12ms
                          └─system-systemd-backlight.slice @893ms
                            └─system.slice @177ms
                              └─-.slice @177ms</pre>
<p>In this case, it appears the network manager is the real bottleneck. This is a <a href="https://wiki.archlinux.org/index.php/NetworkManager#Enable_NetworkManager_Wait_Online" target="_blank" rel="noopener noreferrer">known issue</a>, and can be addressed by disabling the NetworkManager-wait-onine.service. Although, it should be noted this could cause your system to fail to boot, if the network daemons require internet connection (highly unadvised to use such systems on a laptop).</p>
<p>To disable, it is possible (<strong>but risky</strong>) execute the following:</p>
<pre>sudo systemctl disable --now NetworkManager-wait-online.service</pre>
<p>From there, we should see a very quick boot time — if it works. Unfortunately, disabling this service can lead to other systems failing and <em>can cause a failure to boot</em>. Basically, some services will need the network up, if those services don’t wait for the NetworkManager to boot, then the service will fail.</p>
<h2>Boot Optimizations</h2>
<p>Below are the steps I particularly took to reduce the boot time by around 90%.</p>
<p>Switched to autofs (NFS solution):</p>
<ul>
<li>Install <a href="https://help.ubuntu.com/community/Autofs" target="_blank" rel="noopener noreferrer">autofs</a></li>
<li>Remove <a href="https://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration" target="_blank" rel="noopener noreferrer">NFS</a> entries from <a href="https://wiki.archlinux.org/index.php/Fstab" target="_blank" rel="noopener noreferrer">fstab</a></li>
</ul>
<p>Increase battery life:</p>
<ul>
<li>Utilize the&nbsp;<a href="https://wiki.archlinux.org/index.php/TLP" target="_blank" rel="noopener noreferrer">TLP</a>, service</li>
<li>Alternatively, it’s possible to use <a href="https://forums.opensuse.org/showthread.php/501602-run-sudo-usr-sbin-powertop-auto-tune-after-login/page2" target="_blank" rel="noopener noreferrer">Powertop</a></li>
</ul>
<p>I also disabled the NetworkManager-wait-online.service (reducing boot by 6 seconds).</p>
<pre>sudo systemctl disable --now NetworkManager-wait-online.service</pre>
<p>After the above, the updated boot time is down 88%, nine seconds to one second:</p>
<pre><strong>$ sudo systemd-analyze critical-chain</strong>

graphical.target @1.152s
└─multi-user.target @1.152s
  └─<span><strong>systemd-logind.service @922ms +225ms</strong></span>
    └─basic.target @914ms
      └─sockets.target @913ms
        └─dbus.socket @913ms
          └─sysinit.target @906ms
            └─<span><strong>systemd-backlight@leds:tpacpi::kbd_backlight.service @1.171s +14ms</strong></span>
              └─system-systemd-backlight.slice @1.170s
                └─system.slice @185ms
                  └─-.slice @185ms</pre>
<p>A few final items which can provide some speedups are trusting the CPU’s random function:</p>
<ul>
<li>Adding <a href="https://security.stackexchange.com/questions/42164/rdrand-from-dev-random" target="_blank" rel="noopener noreferrer"><em>random.trust_cpu=0 </em>flag on boot</a>. This flag tells your system to trust the CPU random number generator (vs the software solution). This shaves a second off system boot and likely poses minimal, if any, risk.</li>
</ul>
<h2>Notable Issues: GDM Failure</h2>
<p>One rather frustrating issue has been a GDM (Gnome Display Manager) failure.</p>
<blockquote><p>GDM hangs on boot/reboot/wake up with a black blinking cursor</p></blockquote>
<p>The computer will reach all the way to the graphical.target state only to have no login window appear. It’s possible to do:</p>
<pre>CTRL+ALT+F2 (move to tty2)
CTRL+ALT+F1 (return to tty1)</pre>
<p>After which GDM would start up again. This appears to be an error with the service, in the logs you see the following:</p>
<p><code>$ journalctl -u gdm</code></p>
<pre>systemd[1]: Starting GNOME Display Manager... 
systemd[1]: Started GNOME Display Manager. 
gdm[543]: <strong>Child process -622 was already dead.</strong> 
gdm-password][964]: <strong><span>gkr-pam: unable to locate daemon control file</span> </strong> 
gdm-password][964]: gkr-pam: stashed password to try later in open session 
gdm-password][964]: pam_unix(gdm-password:session): session opened for user by (uid=0) 
gdm-password][964]: gkr-pam: gnome-keyring-daemon started properly and unlocked keyring</pre>
<p>The fix for this is in the <a href="https://wiki.archlinux.org/index.php/GDM#GDM_freezes_with_systemd" target="_blank" rel="noopener noreferrer">Arch wiki</a>, GDM will freeze on systemd unless the service is edited:</p>
<pre><code>$ systemctl edit gdm</code></pre>
<pre>[Service]
Type=idle</pre>
<p>After which, the system should boot up without hanging.</p>
<h2>Conclusion</h2>
<p>I hope others found this guide useful, feel free to give any tips in the comment section.</p>
<p>Overall, these changes have just about doubled my computers effectively battery life – roughly 8 hours of decent use. At the same time, battery charge is preserved as the computer goes into hibernation after a short-ish suspend cycle and reboots in a few seconds. Personally, I am pleased with the results.</p>
<h3>Related Content</h3>
<ul>
<li><a href="https://austingwalters.com/parsing-uspto-patents-to-create-a-dataset/" target="_blank" rel="noopener noreferrer">Parsing USPTO Patents to Create a Massive Free Labeled Dataset</a></li>
<li><a href="https://austingwalters.com/how-to-add-a-product-demo-to-your-landing-page/" target="_blank" rel="noopener noreferrer">How to create a product demo video for your landing page</a></li>
<li><a href="https://austingwalters.com/active-record-subquries-postgresql-rails-and-active-record/" target="_blank" rel="noopener noreferrer">Active Record Subqueries using Rails and PostgreSQL</a></li>
<li><a href="https://austingwalters.com/fast-full-text-search-in-postgresql/" target="_blank" rel="noopener noreferrer">Fast Full-Text Search in PostgreSQL</a></li>
<li><a href="https://austingwalters.com/export-a-command-line-curl-command-to-an-executable/" target="_blank" rel="noopener noreferrer">Export a Command Line cURL Command to an Executable</a></li>
</ul>

</div>

</article></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>