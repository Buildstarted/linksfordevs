<!DOCTYPE html>
<html lang="en">
<head>
    <title>
me-no-dev/ESPAsyncWebServer: Async Web Server for ESP8266 and ESP32 -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>me-no-dev/ESPAsyncWebServer: Async Web Server for ESP8266 and ESP32</h1><div><div id="" class="markdown-body entry-content p-5"><p><a href="https://travis-ci.org/me-no-dev/ESPAsyncWebServer" rel="nofollow"><img src="https://camo.githubusercontent.com/b0f3f91920aa7f4ba56ee6c78ee52a4475c4527b/68747470733a2f2f7472617669732d63692e6f72672f6d652d6e6f2d6465762f4553504173796e635765625365727665722e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/me-no-dev/ESPAsyncWebServer.svg?branch=master"></a><a target="_blank" rel="noopener noreferrer" href="https://github.com/me-no-dev/ESPAsyncWebServer/workflows/ESP%20Async%20Web%20Server%20CI/badge.svg"><img src="https://github.com/me-no-dev/ESPAsyncWebServer/workflows/ESP%20Async%20Web%20Server%20CI/badge.svg" alt=""></a><a href="https://www.codacy.com/manual/me-no-dev/ESPAsyncWebServer?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=me-no-dev/ESPAsyncWebServer&amp;utm_campaign=Badge_Grade" rel="nofollow"><img src="https://camo.githubusercontent.com/30cfba29d6b99f7b88dfb36ba8a5d9b07a0ae61d/68747470733a2f2f6170692e636f646163792e636f6d2f70726f6a6563742f62616467652f47726164652f3339356464343263666336373465366361326533323661663361663830666663" alt="Codacy Badge" data-canonical-src="https://api.codacy.com/project/badge/Grade/395dd42cfc674e6ca2e326af3af80ffc"></a></p><p>For help and support <a href="https://gitter.im/me-no-dev/ESPAsyncWebServer?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" rel="nofollow"><img src="https://camo.githubusercontent.com/4b5c65e1481a3d412224f49123b6f63f2df897a3/68747470733a2f2f6261646765732e6769747465722e696d2f6d652d6e6f2d6465762f4553504173796e635765625365727665722e737667" alt="Join the chat at https://gitter.im/me-no-dev/ESPAsyncWebServer" data-canonical-src="https://badges.gitter.im/me-no-dev/ESPAsyncWebServer.svg"></a></p><p>Async HTTP and WebSocket Server for ESP8266 Arduino</p><p>For ESP8266 it requires <a href="https://github.com/me-no-dev/ESPAsyncTCP">ESPAsyncTCP</a>
To use this library you might need to have the latest git versions of <a href="https://github.com/esp8266/Arduino">ESP8266</a> Arduino Core</p><p>For ESP32 it requires <a href="https://github.com/me-no-dev/AsyncTCP">AsyncTCP</a> to work
To use this library you might need to have the latest git versions of <a href="https://github.com/espressif/arduino-esp32">ESP32</a> Arduino Core</p><h2><a id="user-content-table-of-contents" class="anchor" aria-hidden="true" href="#table-of-contents"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table of contents</h2><h2><a id="user-content-installation" class="anchor" aria-hidden="true" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2><h3><a id="user-content-using-platformio" class="anchor" aria-hidden="true" href="#using-platformio"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using PlatformIO</h3><p><a href="http://platformio.org" rel="nofollow">PlatformIO</a> is an open source ecosystem for IoT development with cross platform build system, library manager and full support for Espressif ESP8266/ESP32 development. It works on the popular host OS: Mac OS X, Windows, Linux 32/64, Linux ARM (like Raspberry Pi, BeagleBone, CubieBoard).</p><ol><li>Install <a href="http://platformio.org/platformio-ide" rel="nofollow">PlatformIO IDE</a></li><li>Create new project using "PlatformIO Home &gt; New Project"</li><li>Update dev/platform to staging version:
</li><li>Add "ESP Async WebServer" to project using <a href="http://docs.platformio.org/page/projectconf.html" rel="nofollow">Project Configuration File <code>platformio.ini</code></a> and <a href="http://docs.platformio.org/page/projectconf/section_env_library.html#lib-deps" rel="nofollow">lib_deps</a> option:</li></ol><div class="highlight highlight-source-ini"><pre><span class="pl-en">[env:myboard]</span><span class="pl-k">platform</span> = espressif...
<span class="pl-k">board</span> = ...
<span class="pl-k">framework</span> = arduino

<span class="pl-c"><span class="pl-c">#</span> using the latest stable version</span><span class="pl-k">lib_deps</span> = ESP Async WebServer

<span class="pl-c"><span class="pl-c">#</span> or using GIT Url (the latest development version)</span><span class="pl-k">lib_deps</span> = https://github.com/me-no-dev/ESPAsyncWebServer.git</pre></div><ol start="5"><li>Happy coding with PlatformIO!</li></ol><h2><a id="user-content-why-should-you-care" class="anchor" aria-hidden="true" href="#why-should-you-care"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why should you care</h2><ul><li>Using asynchronous network means that you can handle more than one connection at the same time</li><li>You are called once the request is ready and parsed</li><li>When you send the response, you are immediately ready to handle other connections
while the server is taking care of sending the response in the background</li><li>Speed is OMG</li><li>Easy to use API, HTTP Basic and Digest MD5 Authentication (default), ChunkedResponse</li><li>Easily extendible to handle any type of content</li><li>Supports Continue 100</li><li>Async WebSocket plugin offering different locations without extra servers or ports</li><li>Async EventSource (Server-Sent Events) plugin to send events to the browser</li><li>URL Rewrite plugin for conditional and permanent url rewrites</li><li>ServeStatic plugin that supports cache, Last-Modified, default index and more</li><li>Simple template processing engine to handle templates</li></ul><h2><a id="user-content-important-things-to-remember" class="anchor" aria-hidden="true" href="#important-things-to-remember"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Important things to remember</h2><ul><li>This is fully asynchronous server and as such does not run on the loop thread.</li><li>You can not use yield or delay or any function that uses them inside the callbacks</li><li>The server is smart enough to know when to close the connection and free resources</li><li>You can not send more than one response to a single request</li></ul><h2><a id="user-content-principles-of-operation" class="anchor" aria-hidden="true" href="#principles-of-operation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Principles of operation</h2><h3><a id="user-content-the-async-web-server" class="anchor" aria-hidden="true" href="#the-async-web-server"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Async Web server</h3><ul><li>Listens for connections</li><li>Wraps the new clients into <code>Request</code></li><li>Keeps track of clients and cleans memory</li><li>Manages <code>Rewrites</code> and apply them on the request url</li><li>Manages <code>Handlers</code> and attaches them to Requests</li></ul><h3><a id="user-content-request-life-cycle" class="anchor" aria-hidden="true" href="#request-life-cycle"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request Life Cycle</h3><ul><li>TCP connection is received by the server</li><li>The connection is wrapped inside <code>Request</code> object</li><li>When the request head is received (type, url, get params, http version and host),
the server goes through all <code>Rewrites</code> (in the order they were added) to rewrite the url and inject query parameters,
next, it goes through all attached <code>Handlers</code>(in the order they were added) trying to find one
that <code>canHandle</code> the given request. If none are found, the default(catch-all) handler is attached.</li><li>The rest of the request is received, calling the <code>handleUpload</code> or <code>handleBody</code> methods of the <code>Handler</code> if they are needed (POST+File/Body)</li><li>When the whole request is parsed, the result is given to the <code>handleRequest</code> method of the <code>Handler</code> and is ready to be responded to</li><li>In the <code>handleRequest</code> method, to the <code>Request</code> is attached a <code>Response</code> object (see below) that will serve the response data back to the client</li><li>When the <code>Response</code> is sent, the client is closed and freed from the memory</li></ul><h3><a id="user-content-rewrites-and-how-do-they-work" class="anchor" aria-hidden="true" href="#rewrites-and-how-do-they-work"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rewrites and how do they work</h3><ul><li>The <code>Rewrites</code> are used to rewrite the request url and/or inject get parameters for a specific request url path.</li><li>All <code>Rewrites</code> are evaluated on the request in the order they have been added to the server.</li><li>The <code>Rewrite</code> will change the request url only if the request url (excluding get parameters) is fully match
the rewrite url, and when the optional <code>Filter</code> callback return true.</li><li>Setting a <code>Filter</code> to the <code>Rewrite</code> enables to control when to apply the rewrite, decision can be based on
request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li><li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface,
<code>ON_STA_FILTER</code> to execute the rewrite when request is made to the STA interface.</li><li>The <code>Rewrite</code> can specify a target url with optional get parameters, e.g. <code>/to-url?with=params</code></li></ul><h3><a id="user-content-handlers-and-how-do-they-work" class="anchor" aria-hidden="true" href="#handlers-and-how-do-they-work"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handlers and how do they work</h3><ul><li>The <code>Handlers</code> are used for executing specific actions to particular requests</li><li>One <code>Handler</code> instance can be attached to any request and lives together with the server</li><li>Setting a <code>Filter</code> to the <code>Handler</code> enables to control when to apply the handler, decision can be based on
request url, http version, request host/port/target host, get parameters or the request client's localIP or remoteIP.</li><li>Two filter callbacks are provided: <code>ON_AP_FILTER</code> to execute the rewrite when request is made to the AP interface,
<code>ON_STA_FILTER</code> to execute the rewrite when request is made to the STA interface.</li><li>The <code>canHandle</code> method is used for handler specific control on whether the requests can be handled
and for declaring any interesting headers that the <code>Request</code> should parse. Decision can be based on request
method, request url, http version, request host/port/target host and get parameters</li><li>Once a <code>Handler</code> is attached to given <code>Request</code> (<code>canHandle</code> returned true)
that <code>Handler</code> takes care to receive any file/data upload and attach a <code>Response</code>
once the <code>Request</code> has been fully parsed</li><li><code>Handlers</code> are evaluated in the order they are attached to the server. The <code>canHandle</code> is called only
if the <code>Filter</code> that was set to the <code>Handler</code> return true.</li><li>The first <code>Handler</code> that can handle the request is selected, not further <code>Filter</code> and <code>canHandle</code> are called.</li></ul><h3><a id="user-content-responses-and-how-do-they-work" class="anchor" aria-hidden="true" href="#responses-and-how-do-they-work"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Responses and how do they work</h3><ul><li>The <code>Response</code> objects are used to send the response data back to the client</li><li>The <code>Response</code> object lives with the <code>Request</code> and is freed on end or disconnect</li><li>Different techniques are used depending on the response type to send the data in packets
returning back almost immediately and sending the next packet when this one is received.
Any time in between is spent to run the user loop and handle other network packets</li><li>Responding asynchronously is probably the most difficult thing for most to understand</li><li>Many different options exist for the user to make responding a background task</li></ul><h3><a id="user-content-template-processing" class="anchor" aria-hidden="true" href="#template-processing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Template processing</h3><ul><li>ESPAsyncWebserver contains simple template processing engine.</li><li>Template processing can be added to most response types.</li><li>Currently it supports only replacing template placeholders with actual values. No conditional processing, cycles, etc.</li><li>Placeholders are delimited with <code>%</code> symbols. Like this: <code>%TEMPLATE_PLACEHOLDER%</code>.</li><li>It works by extracting placeholder name from response text and passing it to user provided function which should return actual value to be used instead of placeholder.</li><li>Since it's user provided function, it is possible for library users to implement conditional processing and cycles themselves.</li><li>Since it's impossible to know the actual response size after template processing step in advance (and, therefore, to include it in response headers), the response becomes <a href="#chunked-response">chunked</a>.</li></ul><h2><a id="user-content-libraries-and-projects-that-use-asyncwebserver" class="anchor" aria-hidden="true" href="#libraries-and-projects-that-use-asyncwebserver"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Libraries and projects that use AsyncWebServer</h2><ul><li><a href="https://github.com/hallard/WebSocketToSerial">WebSocketToSerial</a> - Debug serial devices through the web browser</li><li><a href="https://github.com/Hopperpop/Sattrack">Sattrack</a> - Track the ISS with ESP8266</li><li><a href="https://github.com/Edzelf/Esp-radio">ESP Radio</a> - Icecast radio based on ESP8266 and VS1053</li><li><a href="https://github.com/andig/vzero">VZero</a> - the Wireless zero-config controller for volkszaehler.org</li><li><a href="https://bitbucket.org/xoseperez/espurna" rel="nofollow">ESPurna</a> - ESPurna ("spark" in Catalan) is a custom C firmware for ESP8266 based smart switches. It was originally developed with the ITead Sonoff in mind.</li><li><a href="https://bitbucket.org/xoseperez/fauxmoesp" rel="nofollow">fauxmoESP</a> - Belkin WeMo emulator library for ESP8266.</li><li><a href="https://github.com/omersiar/esp-rfid">ESP-RFID</a> - MFRC522 RFID Access Control Management project for ESP8266.</li></ul><h2><a id="user-content-request-variables" class="anchor" aria-hidden="true" href="#request-variables"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request Variables</h2><h3><a id="user-content-common-variables" class="anchor" aria-hidden="true" href="#common-variables"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Common Variables</h3><div class="highlight highlight-source-c++"><pre>request-&gt;<span class="pl-en">version</span>();       <span class="pl-c"><span class="pl-c">//</span> uint8_t: 0 = HTTP/1.0, 1 = HTTP/1.1</span>
request-&gt;<span class="pl-en">method</span>();        <span class="pl-c"><span class="pl-c">//</span> enum:    HTTP_GET, HTTP_POST, HTTP_DELETE, HTTP_PUT, HTTP_PATCH, HTTP_HEAD, HTTP_OPTIONS</span>
request-&gt;<span class="pl-en">url</span>();           <span class="pl-c"><span class="pl-c">//</span> String:  URL of the request (not including host, port or GET parameters)</span>
request-&gt;<span class="pl-en">host</span>();          <span class="pl-c"><span class="pl-c">//</span> String:  The requested host (can be used for virtual hosting)</span>
request-&gt;<span class="pl-en">contentType</span>();   <span class="pl-c"><span class="pl-c">//</span> String:  ContentType of the request (not avaiable in Handler::canHandle)</span>
request-&gt;<span class="pl-en">contentLength</span>(); <span class="pl-c"><span class="pl-c">//</span> size_t:  ContentLength of the request (not avaiable in Handler::canHandle)</span>
request-&gt;<span class="pl-en">multipart</span>();     <span class="pl-c"><span class="pl-c">//</span> bool:    True if the request has content type "multipart"</span></pre></div><h3><a id="user-content-headers" class="anchor" aria-hidden="true" href="#headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Headers</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>List all collected headers</span><span class="pl-k">int</span> headers = request-&gt;<span class="pl-en">headers</span>();
<span class="pl-k">int</span> i;
<span class="pl-k">for</span>(i=<span class="pl-c1">0</span>;i&lt;headers;i++){
  AsyncWebHeader* h = request-&gt;<span class="pl-c1">getHeader</span>(i);
  Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>HEADER[%s]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, h-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), h-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
}

<span class="pl-c"><span class="pl-c">//</span>get specific header by name</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader<span class="pl-pds">"</span></span>)){
  AsyncWebHeader* h = request-&gt;<span class="pl-c1">getHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader<span class="pl-pds">"</span></span>);
  Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, h-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
}

<span class="pl-c"><span class="pl-c">//</span>List all collected headers (Compatibility)</span><span class="pl-k">int</span> headers = request-&gt;<span class="pl-en">headers</span>();
<span class="pl-k">int</span> i;
<span class="pl-k">for</span>(i=<span class="pl-c1">0</span>;i&lt;headers;i++){
  Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>HEADER[%s]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, request-&gt;<span class="pl-c1">headerName</span>(i).<span class="pl-c1">c_str</span>(), request-&gt;<span class="pl-c1">header</span>(i).<span class="pl-c1">c_str</span>());
}

<span class="pl-c"><span class="pl-c">//</span>get specific header by name (Compatibility)</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader<span class="pl-pds">"</span></span>)){
  Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, request-&gt;<span class="pl-c1">header</span>(<span class="pl-s"><span class="pl-pds">"</span>MyHeader<span class="pl-pds">"</span></span>).<span class="pl-c1">c_str</span>());
}</pre></div><h3><a id="user-content-get-post-and-file-parameters" class="anchor" aria-hidden="true" href="#get-post-and-file-parameters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GET, POST and FILE parameters</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>List all parameters</span><span class="pl-k">int</span> params = request-&gt;<span class="pl-en">params</span>();
<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;params;i++){
  AsyncWebParameter* p = request-&gt;<span class="pl-c1">getParam</span>(i);
  <span class="pl-k">if</span>(p-&gt;<span class="pl-c1">isFile</span>()){ <span class="pl-c"><span class="pl-c">//</span>p-&gt;isPost() is also true</span>
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>FILE[%s]: %s, size: %u<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">size</span>());
  } <span class="pl-k">else</span><span class="pl-k">if</span>(p-&gt;<span class="pl-c1">isPost</span>()){
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>POST[%s]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
  } <span class="pl-k">else</span> {
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>GET[%s]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
  }
}

<span class="pl-c"><span class="pl-c">//</span>Check if GET parameter exists</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasParam</span>(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>))
  AsyncWebParameter* p = request-&gt;getParam(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>Check if POST (but not File) parameter exists</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasParam</span>(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>))
  AsyncWebParameter* p = request-&gt;getParam(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>);

<span class="pl-c"><span class="pl-c">//</span>Check if FILE was uploaded</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasParam</span>(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>, <span class="pl-c1">true</span>))
  AsyncWebParameter* p = request-&gt;getParam(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>, <span class="pl-c1">true</span>, <span class="pl-c1">true</span>);

<span class="pl-c"><span class="pl-c">//</span>List all parameters (Compatibility)</span><span class="pl-k">int</span> args = request-&gt;<span class="pl-en">args</span>();
<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;args;i++){
  Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ARG[%s]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, request-&gt;<span class="pl-c1">argName</span>(i).<span class="pl-c1">c_str</span>(), request-&gt;<span class="pl-c1">arg</span>(i).<span class="pl-c1">c_str</span>());
}

<span class="pl-c"><span class="pl-c">//</span>Check if parameter exists (Compatibility)</span><span class="pl-k">if</span>(request-&gt;<span class="pl-en">hasArg</span>(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>))
  String arg = request-&gt;arg(<span class="pl-s"><span class="pl-pds">"</span>download<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-file-upload-handling" class="anchor" aria-hidden="true" href="#file-upload-handling"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FILE Upload handling</h3><div class="highlight highlight-source-c++"><pre><span class="pl-k">void</span><span class="pl-en">handleUpload</span>(AsyncWebServerRequest *request, String filename, <span class="pl-c1">size_t</span> index, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len, <span class="pl-k">bool</span> final){
  <span class="pl-k">if</span>(!<span class="pl-c1">index</span>){
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>UploadStart: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, filename.<span class="pl-c1">c_str</span>());
  }
  <span class="pl-k">for</span>(<span class="pl-c1">size_t</span> i=<span class="pl-c1">0</span>; i&lt;len; i++){
    Serial.<span class="pl-c1">write</span>(data[i]);
  }
  <span class="pl-k">if</span>(final){
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>UploadEnd: %s, %u B<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, filename.<span class="pl-c1">c_str</span>(), <span class="pl-c1">index</span>+len);
  }
}</pre></div><h3><a id="user-content-body-data-handling" class="anchor" aria-hidden="true" href="#body-data-handling"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Body data handling</h3><div class="highlight highlight-source-c++"><pre><span class="pl-k">void</span><span class="pl-en">handleBody</span>(AsyncWebServerRequest *request, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len, <span class="pl-c1">size_t</span> index, <span class="pl-c1">size_t</span> total){
  <span class="pl-k">if</span>(!<span class="pl-c1">index</span>){
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>BodyStart: %u B<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, total);
  }
  <span class="pl-k">for</span>(<span class="pl-c1">size_t</span> i=<span class="pl-c1">0</span>; i&lt;len; i++){
    Serial.<span class="pl-c1">write</span>(data[i]);
  }
  <span class="pl-k">if</span>(<span class="pl-c1">index</span> + len == total){
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>BodyEnd: %u B<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, total);
  }
}</pre></div><p>If needed, the <code>_tempObject</code> field on the request can be used to store a pointer to temporary data (e.g. from the body) associated with the request. If assigned, the pointer will automatically be freed along with the request.</p><h3><a id="user-content-json-body-handling-with-arduinojson" class="anchor" aria-hidden="true" href="#json-body-handling-with-arduinojson"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON body handling with ArduinoJson</h3><p>Endpoints which consume JSON can use a special handler to get ready to use JSON data in the request callback:</p><div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>AsyncJson.h<span class="pl-pds">"</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>ArduinoJson.h<span class="pl-pds">"</span></span>

AsyncCallbackJsonWebHandler* handler = <span class="pl-k">new</span> AsyncCallbackJsonWebHandler(<span class="pl-s"><span class="pl-pds">"</span>/rest/endpoint<span class="pl-pds">"</span></span>, [](AsyncWebServerRequest *request, JsonVariant &amp;json) {
  JsonObject&amp; jsonObj = json.<span class="pl-smi">as</span>&lt;JsonObject&gt;();
  <span class="pl-c"><span class="pl-c">//</span> ...</span>
});
server.addHandler(handler);</pre></div><h2><a id="user-content-responses" class="anchor" aria-hidden="true" href="#responses"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Responses</h2><h3><a id="user-content-redirect-to-another-url" class="anchor" aria-hidden="true" href="#redirect-to-another-url"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Redirect to another URL</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>to local url</span>
request-&gt;<span class="pl-en">redirect</span>(<span class="pl-s"><span class="pl-pds">"</span>/login<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>to external url</span>
request-&gt;<span class="pl-en">redirect</span>(<span class="pl-s"><span class="pl-pds">"</span>http://esp8266.com<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-basic-response-with-http-code" class="anchor" aria-hidden="true" href="#basic-response-with-http-code"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic response with HTTP Code</h3><div class="highlight highlight-source-c++"><pre>request-&gt;<span class="pl-en">send</span>(<span class="pl-c1">404</span>); <span class="pl-c"><span class="pl-c">//</span>Sends 404 File Not Found</span></pre></div><h3><a id="user-content-basic-response-with-http-code-and-extra-headers" class="anchor" aria-hidden="true" href="#basic-response-with-http-code-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic response with HTTP Code and extra headers</h3><div class="highlight highlight-source-c++"><pre>AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(<span class="pl-c1">404</span>); <span class="pl-c"><span class="pl-c">//</span>Sends 404 File Not Found</span>
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-basic-response-with-string-content" class="anchor" aria-hidden="true" href="#basic-response-with-string-content"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic response with string content</h3><div class="highlight highlight-source-c++"><pre>request-&gt;<span class="pl-en">send</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-basic-response-with-string-content-and-extra-headers" class="anchor" aria-hidden="true" href="#basic-response-with-string-content-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic response with string content and extra headers</h3><div class="highlight highlight-source-c++"><pre>AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-send-large-webpage-from-progmem" class="anchor" aria-hidden="true" href="#send-large-webpage-from-progmem"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send large webpage from PROGMEM</h3><div class="highlight highlight-source-c++"><pre><span class="pl-k">const</span><span class="pl-k">char</span> index_html[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>; <span class="pl-c"><span class="pl-c">//</span> large char array, tested with 14k</span>
request-&gt;<span class="pl-en">send_P</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>, index_html);</pre></div><h3><a id="user-content-send-large-webpage-from-progmem-and-extra-headers" class="anchor" aria-hidden="true" href="#send-large-webpage-from-progmem-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send large webpage from PROGMEM and extra headers</h3><div class="highlight highlight-source-c++"><pre><span class="pl-k">const</span><span class="pl-k">char</span> index_html[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>; <span class="pl-c"><span class="pl-c">//</span> large char array, tested with 14k</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse_P</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>, index_html);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-send-large-webpage-from-progmem-containing-templates" class="anchor" aria-hidden="true" href="#send-large-webpage-from-progmem-containing-templates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send large webpage from PROGMEM containing templates</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-k">const</span><span class="pl-k">char</span> index_html[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>; <span class="pl-c"><span class="pl-c">//</span> large char array, tested with 14k</span>
request-&gt;<span class="pl-en">send_P</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>, index_html, processor);</pre></div><h3><a id="user-content-send-large-webpage-from-progmem-containing-templates-and-extra-headers" class="anchor" aria-hidden="true" href="#send-large-webpage-from-progmem-containing-templates-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send large webpage from PROGMEM containing templates and extra headers</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-k">const</span><span class="pl-k">char</span> index_html[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>; <span class="pl-c"><span class="pl-c">//</span> large char array, tested with 14k</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse_P</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>, index_html, processor);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-send-binary-content-from-progmem" class="anchor" aria-hidden="true" href="#send-binary-content-from-progmem"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Send binary content from PROGMEM</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>File: favicon.ico.gz, Size: 726</span>
#<span class="pl-k">define</span><span class="pl-en">favicon_ico_gz_len</span><span class="pl-c1">726</span><span class="pl-k">const</span><span class="pl-c1">uint8_t</span> favicon_ico_gz[] PROGMEM = {
 <span class="pl-c1">0x1F</span>, <span class="pl-c1">0x8B</span>, <span class="pl-c1">0x08</span>, <span class="pl-c1">0x08</span>, <span class="pl-c1">0x0B</span>, <span class="pl-c1">0x87</span>, <span class="pl-c1">0x90</span>, <span class="pl-c1">0x57</span>, <span class="pl-c1">0x00</span>, <span class="pl-c1">0x03</span>, <span class="pl-c1">0x66</span>, <span class="pl-c1">0x61</span>, <span class="pl-c1">0x76</span>, <span class="pl-c1">0x69</span>, <span class="pl-c1">0x63</span>, <span class="pl-c1">0x6F</span>,
 <span class="pl-c1">0x6E</span>, <span class="pl-c1">0x2E</span>, <span class="pl-c1">0x69</span>, <span class="pl-c1">0x63</span>, <span class="pl-c1">0x6F</span>, <span class="pl-c1">0x00</span>, <span class="pl-c1">0xCD</span>, <span class="pl-c1">0x53</span>, <span class="pl-c1">0x5F</span>, <span class="pl-c1">0x48</span>, <span class="pl-c1">0x9A</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0x14</span>, <span class="pl-c1">0xBF</span>, <span class="pl-c1">0x62</span>, <span class="pl-c1">0x6D</span>,
 <span class="pl-c1">0x86</span>, <span class="pl-c1">0x96</span>, <span class="pl-c1">0xA9</span>, <span class="pl-c1">0x64</span>, <span class="pl-c1">0xD3</span>, <span class="pl-c1">0xFE</span>, <span class="pl-c1">0xA8</span>, <span class="pl-c1">0x99</span>, <span class="pl-c1">0x65</span>, <span class="pl-c1">0x1A</span>, <span class="pl-c1">0xB4</span>, <span class="pl-c1">0x8A</span>, <span class="pl-c1">0xA8</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0x54</span>, <span class="pl-c1">0x23</span>,
 <span class="pl-c1">0xA8</span>, <span class="pl-c1">0x11</span>, <span class="pl-c1">0x49</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0x8A</span>, <span class="pl-c1">0x34</span>, <span class="pl-c1">0x62</span>, <span class="pl-c1">0x93</span>, <span class="pl-c1">0x85</span>, <span class="pl-c1">0x31</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x44</span>, <span class="pl-c1">0x12</span>, <span class="pl-c1">0x45</span>, <span class="pl-c1">0x2D</span>, <span class="pl-c1">0x58</span>,
 <span class="pl-c1">0xF5</span>, <span class="pl-c1">0x52</span>, <span class="pl-c1">0x41</span>, <span class="pl-c1">0x10</span>, <span class="pl-c1">0x23</span>, <span class="pl-c1">0x82</span>, <span class="pl-c1">0xA0</span>, <span class="pl-c1">0x20</span>, <span class="pl-c1">0x98</span>, <span class="pl-c1">0x2F</span>, <span class="pl-c1">0xC1</span>, <span class="pl-c1">0x26</span>, <span class="pl-c1">0xED</span>, <span class="pl-c1">0xA1</span>, <span class="pl-c1">0x20</span>, <span class="pl-c1">0x89</span>,
 <span class="pl-c1">0x04</span>, <span class="pl-c1">0xD7</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x20</span>, <span class="pl-c1">0x28</span>, <span class="pl-c1">0x04</span>, <span class="pl-c1">0xAB</span>, <span class="pl-c1">0xD1</span>, <span class="pl-c1">0x9B</span>, <span class="pl-c1">0x8C</span>, <span class="pl-c1">0xE5</span>, <span class="pl-c1">0xC3</span>, <span class="pl-c1">0x60</span>, <span class="pl-c1">0x32</span>, <span class="pl-c1">0x64</span>,
 <span class="pl-c1">0x0E</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0xBF</span>, <span class="pl-c1">0x9D</span>, <span class="pl-c1">0xEF</span>, <span class="pl-c1">0xF6</span>, <span class="pl-c1">0x30</span>, <span class="pl-c1">0x82</span>, <span class="pl-c1">0xED</span>, <span class="pl-c1">0xAD</span>, <span class="pl-c1">0x87</span>, <span class="pl-c1">0xDD</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0xF3</span>, <span class="pl-c1">0xDD</span>, <span class="pl-c1">0x8F</span>,
 <span class="pl-c1">0x73</span>, <span class="pl-c1">0xCF</span>, <span class="pl-c1">0xEF</span>, <span class="pl-c1">0x9C</span>, <span class="pl-c1">0xDF</span>, <span class="pl-c1">0x39</span>, <span class="pl-c1">0xBF</span>, <span class="pl-c1">0xFB</span>, <span class="pl-c1">0x31</span>, <span class="pl-c1">0x26</span>, <span class="pl-c1">0xA2</span>, <span class="pl-c1">0x27</span>, <span class="pl-c1">0x37</span>, <span class="pl-c1">0x97</span>, <span class="pl-c1">0xD1</span>, <span class="pl-c1">0x5B</span>,
 <span class="pl-c1">0xCF</span>, <span class="pl-c1">0x9E</span>, <span class="pl-c1">0x67</span>, <span class="pl-c1">0x30</span>, <span class="pl-c1">0xA6</span>, <span class="pl-c1">0x66</span>, <span class="pl-c1">0x8C</span>, <span class="pl-c1">0x99</span>, <span class="pl-c1">0xC9</span>, <span class="pl-c1">0xC8</span>, <span class="pl-c1">0x45</span>, <span class="pl-c1">0x9E</span>, <span class="pl-c1">0x6B</span>, <span class="pl-c1">0x3F</span>, <span class="pl-c1">0x5F</span>, <span class="pl-c1">0x74</span>,
 <span class="pl-c1">0xA6</span>, <span class="pl-c1">0x94</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0xDB</span>, <span class="pl-c1">0xFF</span>, <span class="pl-c1">0xB2</span>, <span class="pl-c1">0xE6</span>, <span class="pl-c1">0xE7</span>, <span class="pl-c1">0xE7</span>, <span class="pl-c1">0xF9</span>, <span class="pl-c1">0xDE</span>, <span class="pl-c1">0xD6</span>, <span class="pl-c1">0xD6</span>, <span class="pl-c1">0x96</span>, <span class="pl-c1">0xDB</span>, <span class="pl-c1">0xD8</span>,
 <span class="pl-c1">0xD8</span>, <span class="pl-c1">0x78</span>, <span class="pl-c1">0xBF</span>, <span class="pl-c1">0xA1</span>, <span class="pl-c1">0xA1</span>, <span class="pl-c1">0xC1</span>, <span class="pl-c1">0xDA</span>, <span class="pl-c1">0xDC</span>, <span class="pl-c1">0xDC</span>, <span class="pl-c1">0x2C</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0xED</span>, <span class="pl-c1">0xED</span>, <span class="pl-c1">0x15</span>, <span class="pl-c1">0x9B</span>, <span class="pl-c1">0xCD</span>,
 <span class="pl-c1">0xE6</span>, <span class="pl-c1">0x4A</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0xC1</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0x2E</span>, <span class="pl-c1">0x29</span>, <span class="pl-c1">0x29</span>, <span class="pl-c1">0x99</span>, <span class="pl-c1">0xD6</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0xB5</span>, <span class="pl-c1">0x4F</span>, <span class="pl-c1">0x75</span>, <span class="pl-c1">0x3A</span>, <span class="pl-c1">0x9D</span>,
 <span class="pl-c1">0x61</span>, <span class="pl-c1">0x75</span>, <span class="pl-c1">0x75</span>, <span class="pl-c1">0x95</span>, <span class="pl-c1">0xB5</span>, <span class="pl-c1">0xB7</span>, <span class="pl-c1">0xB7</span>, <span class="pl-c1">0xDF</span>, <span class="pl-c1">0xC8</span>, <span class="pl-c1">0xD1</span>, <span class="pl-c1">0xD4</span>, <span class="pl-c1">0xD4</span>, <span class="pl-c1">0xF4</span>, <span class="pl-c1">0xB0</span>, <span class="pl-c1">0xBA</span>, <span class="pl-c1">0xBA</span>,
 <span class="pl-c1">0xFA</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0xD5</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0xFD</span>, <span class="pl-c1">0x5A</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0x9E</span>, <span class="pl-c1">0x28</span>, <span class="pl-c1">0x2D</span>, <span class="pl-c1">0x2D</span>, <span class="pl-c1">0x0D</span>, <span class="pl-c1">0x10</span>, <span class="pl-c1">0xC6</span>, <span class="pl-c1">0x4B</span>,
 <span class="pl-c1">0x98</span>, <span class="pl-c1">0x78</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0xDE</span>, <span class="pl-c1">0x95</span>, <span class="pl-c1">0x42</span>, <span class="pl-c1">0xA1</span>, <span class="pl-c1">0x40</span>, <span class="pl-c1">0x4E</span>, <span class="pl-c1">0x4E</span>, <span class="pl-c1">0xCE</span>, <span class="pl-c1">0x65</span>, <span class="pl-c1">0x76</span>, <span class="pl-c1">0x76</span>, <span class="pl-c1">0xF6</span>,
 <span class="pl-c1">0x47</span>, <span class="pl-c1">0xB5</span>, <span class="pl-c1">0x5A</span>, <span class="pl-c1">0x6D</span>, <span class="pl-c1">0x4F</span>, <span class="pl-c1">0x26</span>, <span class="pl-c1">0x93</span>, <span class="pl-c1">0xA2</span>, <span class="pl-c1">0xD6</span>, <span class="pl-c1">0xD6</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0x8E</span>, <span class="pl-c1">0x6D</span>, <span class="pl-c1">0x69</span>, <span class="pl-c1">0x69</span>, <span class="pl-c1">0xD1</span>,
 <span class="pl-c1">0x11</span>, <span class="pl-c1">0x36</span>, <span class="pl-c1">0x62</span>, <span class="pl-c1">0xB1</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x60</span>, <span class="pl-c1">0x32</span>, <span class="pl-c1">0x99</span>, <span class="pl-c1">0xA0</span>, <span class="pl-c1">0xD7</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x88</span>, <span class="pl-c1">0xFC</span>,
 <span class="pl-c1">0xFC</span>, <span class="pl-c1">0x7C</span>, <span class="pl-c1">0x10</span>, <span class="pl-c1">0x16</span>, <span class="pl-c1">0x02</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0x2E</span>, <span class="pl-c1">0x97</span>, <span class="pl-c1">0x43</span>, <span class="pl-c1">0x2A</span>, <span class="pl-c1">0x95</span>, <span class="pl-c1">0x42</span>, <span class="pl-c1">0x2C</span>, <span class="pl-c1">0x16</span>, <span class="pl-c1">0x23</span>, <span class="pl-c1">0x33</span>,
 <span class="pl-c1">0x33</span>, <span class="pl-c1">0x33</span>, <span class="pl-c1">0xAE</span>, <span class="pl-c1">0x52</span>, <span class="pl-c1">0xA9</span>, <span class="pl-c1">0x1E</span>, <span class="pl-c1">0x64</span>, <span class="pl-c1">0x65</span>, <span class="pl-c1">0x65</span>, <span class="pl-c1">0x71</span>, <span class="pl-c1">0x7C</span>, <span class="pl-c1">0x7D</span>, <span class="pl-c1">0x7D</span>, <span class="pl-c1">0xBD</span>, <span class="pl-c1">0x93</span>, <span class="pl-c1">0xEA</span>,
 <span class="pl-c1">0xFE</span>, <span class="pl-c1">0x30</span>, <span class="pl-c1">0x1A</span>, <span class="pl-c1">0x8D</span>, <span class="pl-c1">0xE8</span>, <span class="pl-c1">0xEC</span>, <span class="pl-c1">0xEC</span>, <span class="pl-c1">0xC4</span>, <span class="pl-c1">0xE2</span>, <span class="pl-c1">0xE2</span>, <span class="pl-c1">0x22</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0x40</span>, <span class="pl-c1">0x39</span>,
 <span class="pl-c1">0x41</span>, <span class="pl-c1">0xB5</span>, <span class="pl-c1">0x38</span>, <span class="pl-c1">0x4E</span>, <span class="pl-c1">0xC8</span>, <span class="pl-c1">0x33</span>, <span class="pl-c1">0x3C</span>, <span class="pl-c1">0x3C</span>, <span class="pl-c1">0x0C</span>, <span class="pl-c1">0x87</span>, <span class="pl-c1">0xC3</span>, <span class="pl-c1">0xC1</span>, <span class="pl-c1">0x6B</span>, <span class="pl-c1">0x54</span>, <span class="pl-c1">0x54</span>, <span class="pl-c1">0x54</span>,
 <span class="pl-c1">0xBC</span>, <span class="pl-c1">0xE9</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0x93</span>, <span class="pl-c1">0x5F</span>, <span class="pl-c1">0x5C</span>, <span class="pl-c1">0x5C</span>, <span class="pl-c1">0x30</span>, <span class="pl-c1">0x8A</span>, <span class="pl-c1">0x9D</span>, <span class="pl-c1">0x2E</span>, <span class="pl-c1">0x2B</span>, <span class="pl-c1">0x2B</span>, <span class="pl-c1">0xBB</span>, <span class="pl-c1">0xA2</span>,
 <span class="pl-c1">0x3E</span>, <span class="pl-c1">0x41</span>, <span class="pl-c1">0xBD</span>, <span class="pl-c1">0x21</span>, <span class="pl-c1">0x1E</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0x63</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0x6A</span>, <span class="pl-c1">0x0A</span>, <span class="pl-c1">0x81</span>, <span class="pl-c1">0x40</span>, <span class="pl-c1">0x00</span>, <span class="pl-c1">0x94</span>, <span class="pl-c1">0x1B</span>, <span class="pl-c1">0x3D</span>,
 <span class="pl-c1">0x3D</span>, <span class="pl-c1">0x3D</span>, <span class="pl-c1">0x42</span>, <span class="pl-c1">0x3C</span>, <span class="pl-c1">0x96</span>, <span class="pl-c1">0x96</span>, <span class="pl-c1">0x96</span>, <span class="pl-c1">0x70</span>, <span class="pl-c1">0x7E</span>, <span class="pl-c1">0x7E</span>, <span class="pl-c1">0x8E</span>, <span class="pl-c1">0xE3</span>, <span class="pl-c1">0xE3</span>, <span class="pl-c1">0x63</span>, <span class="pl-c1">0xF8</span>, <span class="pl-c1">0xFD</span>,
 <span class="pl-c1">0xFE</span>, <span class="pl-c1">0xB4</span>, <span class="pl-c1">0xD7</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0xF5</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0x5B</span>, <span class="pl-c1">0x68</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0x6F</span>, <span class="pl-c1">0x05</span>, <span class="pl-c1">0xCE</span>, <span class="pl-c1">0xB4</span>, <span class="pl-c1">0xE3</span>,
 <span class="pl-c1">0xE8</span>, <span class="pl-c1">0xE8</span>, <span class="pl-c1">0x08</span>, <span class="pl-c1">0x27</span>, <span class="pl-c1">0x27</span>, <span class="pl-c1">0x27</span>, <span class="pl-c1">0xD8</span>, <span class="pl-c1">0xDF</span>, <span class="pl-c1">0xDF</span>, <span class="pl-c1">0xC7</span>, <span class="pl-c1">0xD9</span>, <span class="pl-c1">0xD9</span>, <span class="pl-c1">0x19</span>, <span class="pl-c1">0x6C</span>, <span class="pl-c1">0x36</span>, <span class="pl-c1">0x1B</span>,
 <span class="pl-c1">0x36</span>, <span class="pl-c1">0x36</span>, <span class="pl-c1">0x36</span>, <span class="pl-c1">0x38</span>, <span class="pl-c1">0x9F</span>, <span class="pl-c1">0x85</span>, <span class="pl-c1">0x85</span>, <span class="pl-c1">0x05</span>, <span class="pl-c1">0xAC</span>, <span class="pl-c1">0xAF</span>, <span class="pl-c1">0xAF</span>, <span class="pl-c1">0x23</span>, <span class="pl-c1">0x1A</span>, <span class="pl-c1">0x8D</span>, <span class="pl-c1">0x22</span>, <span class="pl-c1">0x91</span>,
 <span class="pl-c1">0x48</span>, <span class="pl-c1">0x20</span>, <span class="pl-c1">0x16</span>, <span class="pl-c1">0x8B</span>, <span class="pl-c1">0xFD</span>, <span class="pl-c1">0xDA</span>, <span class="pl-c1">0xDA</span>, <span class="pl-c1">0xDA</span>, <span class="pl-c1">0x7A</span>, <span class="pl-c1">0x41</span>, <span class="pl-c1">0x33</span>, <span class="pl-c1">0x7E</span>, <span class="pl-c1">0x57</span>, <span class="pl-c1">0x50</span>, <span class="pl-c1">0x50</span>, <span class="pl-c1">0x80</span>,
 <span class="pl-c1">0x89</span>, <span class="pl-c1">0x89</span>, <span class="pl-c1">0x09</span>, <span class="pl-c1">0x84</span>, <span class="pl-c1">0xC3</span>, <span class="pl-c1">0x61</span>, <span class="pl-c1">0x6C</span>, <span class="pl-c1">0x6F</span>, <span class="pl-c1">0x6F</span>, <span class="pl-c1">0x23</span>, <span class="pl-c1">0x12</span>, <span class="pl-c1">0x89</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0x00</span>,
 <span class="pl-c1">0x43</span>, <span class="pl-c1">0x43</span>, <span class="pl-c1">0x43</span>, <span class="pl-c1">0x58</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0x5E</span>, <span class="pl-c1">0xE6</span>, <span class="pl-c1">0x9C</span>, <span class="pl-c1">0x7D</span>, <span class="pl-c1">0x3E</span>, <span class="pl-c1">0x1F</span>, <span class="pl-c1">0x46</span>, <span class="pl-c1">0x47</span>, <span class="pl-c1">0x47</span>, <span class="pl-c1">0x79</span>, <span class="pl-c1">0xBE</span>,
 <span class="pl-c1">0xBD</span>, <span class="pl-c1">0xBD</span>, <span class="pl-c1">0x3D</span>, <span class="pl-c1">0xE1</span>, <span class="pl-c1">0x3C</span>, <span class="pl-c1">0x1D</span>, <span class="pl-c1">0x0C</span>, <span class="pl-c1">0x06</span>, <span class="pl-c1">0x9F</span>, <span class="pl-c1">0x10</span>, <span class="pl-c1">0xB7</span>, <span class="pl-c1">0xC7</span>, <span class="pl-c1">0x84</span>, <span class="pl-c1">0x4F</span>, <span class="pl-c1">0xF6</span>, <span class="pl-c1">0xF7</span>,
 <span class="pl-c1">0xF7</span>, <span class="pl-c1">0x63</span>, <span class="pl-c1">0x60</span>, <span class="pl-c1">0x60</span>, <span class="pl-c1">0x00</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0x83</span>, <span class="pl-c1">0x18</span>, <span class="pl-c1">0x19</span>, <span class="pl-c1">0x19</span>, <span class="pl-c1">0xC1</span>, <span class="pl-c1">0xDC</span>, <span class="pl-c1">0xDC</span>, <span class="pl-c1">0x1C</span>, <span class="pl-c1">0x8F</span>,
 <span class="pl-c1">0x17</span>, <span class="pl-c1">0x7C</span>, <span class="pl-c1">0xA4</span>, <span class="pl-c1">0x27</span>, <span class="pl-c1">0xE7</span>, <span class="pl-c1">0x34</span>, <span class="pl-c1">0x39</span>, <span class="pl-c1">0x39</span>, <span class="pl-c1">0x89</span>, <span class="pl-c1">0x9D</span>, <span class="pl-c1">0x9D</span>, <span class="pl-c1">0x1D</span>, <span class="pl-c1">0x6E</span>, <span class="pl-c1">0x54</span>, <span class="pl-c1">0xE3</span>, <span class="pl-c1">0x13</span>,
 <span class="pl-c1">0xE5</span>, <span class="pl-c1">0x34</span>, <span class="pl-c1">0x11</span>, <span class="pl-c1">0x37</span>, <span class="pl-c1">0x49</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0x51</span>, <span class="pl-c1">0xD1</span>, <span class="pl-c1">0x4B</span>, <span class="pl-c1">0xA5</span>, <span class="pl-c1">0x52</span>, <span class="pl-c1">0xF9</span>, <span class="pl-c1">0x45</span>, <span class="pl-c1">0x26</span>, <span class="pl-c1">0x93</span>, <span class="pl-c1">0x5D</span>,
 <span class="pl-c1">0x0A</span>, <span class="pl-c1">0xF3</span>, <span class="pl-c1">0x92</span>, <span class="pl-c1">0x48</span>, <span class="pl-c1">0x24</span>, <span class="pl-c1">0xA0</span>, <span class="pl-c1">0x6F</span>, <span class="pl-c1">0x14</span>, <span class="pl-c1">0x17</span>, <span class="pl-c1">0x17</span>, <span class="pl-c1">0xA3</span>, <span class="pl-c1">0xB6</span>, <span class="pl-c1">0xB6</span>, <span class="pl-c1">0x16</span>, <span class="pl-c1">0x5D</span>, <span class="pl-c1">0x5D</span>,
 <span class="pl-c1">0x5D</span>, <span class="pl-c1">0x7C</span>, <span class="pl-c1">0x1E</span>, <span class="pl-c1">0xBB</span>, <span class="pl-c1">0xBB</span>, <span class="pl-c1">0xBB</span>, <span class="pl-c1">0x9C</span>, <span class="pl-c1">0xD7</span>, <span class="pl-c1">0xE1</span>, <span class="pl-c1">0xE1</span>, <span class="pl-c1">0x21</span>, <span class="pl-c1">0x42</span>, <span class="pl-c1">0xA1</span>, <span class="pl-c1">0xD0</span>, <span class="pl-c1">0x6B</span>, <span class="pl-c1">0xD2</span>,
 <span class="pl-c1">0x45</span>, <span class="pl-c1">0x4C</span>, <span class="pl-c1">0x33</span>, <span class="pl-c1">0x12</span>, <span class="pl-c1">0x34</span>, <span class="pl-c1">0xCC</span>, <span class="pl-c1">0xA0</span>, <span class="pl-c1">0x19</span>, <span class="pl-c1">0x54</span>, <span class="pl-c1">0x92</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0x0E</span>, <span class="pl-c1">0xD2</span>, <span class="pl-c1">0xD9</span>, <span class="pl-c1">0x43</span>, <span class="pl-c1">0xF8</span>,
 <span class="pl-c1">0xCF</span>, <span class="pl-c1">0x82</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0xC2</span>, <span class="pl-c1">0xDC</span>, <span class="pl-c1">0xEB</span>, <span class="pl-c1">0xEA</span>, <span class="pl-c1">0xEA</span>, <span class="pl-c1">0x38</span>, <span class="pl-c1">0x7E</span>, <span class="pl-c1">0x6C</span>, <span class="pl-c1">0x6C</span>, <span class="pl-c1">0x4C</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0xFE</span>, <span class="pl-c1">0x9D</span>,
 <span class="pl-c1">0xB8</span>, <span class="pl-c1">0xBF</span>, <span class="pl-c1">0xA7</span>, <span class="pl-c1">0xFA</span>, <span class="pl-c1">0xAF</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0x56</span>, <span class="pl-c1">0xEE</span>, <span class="pl-c1">0x6D</span>, <span class="pl-c1">0x6E</span>, <span class="pl-c1">0x6E</span>, <span class="pl-c1">0xDE</span>, <span class="pl-c1">0xB8</span>, <span class="pl-c1">0x47</span>, <span class="pl-c1">0x55</span>,
 <span class="pl-c1">0x55</span>, <span class="pl-c1">0x55</span>, <span class="pl-c1">0x6C</span>, <span class="pl-c1">0x66</span>, <span class="pl-c1">0x66</span>, <span class="pl-c1">0x46</span>, <span class="pl-c1">0x44</span>, <span class="pl-c1">0xDA</span>, <span class="pl-c1">0x3B</span>, <span class="pl-c1">0x34</span>, <span class="pl-c1">0x1A</span>, <span class="pl-c1">0x4D</span>, <span class="pl-c1">0x94</span>, <span class="pl-c1">0xB0</span>, <span class="pl-c1">0x3F</span>, <span class="pl-c1">0x09</span>,
 <span class="pl-c1">0x7B</span>, <span class="pl-c1">0x45</span>, <span class="pl-c1">0xBD</span>, <span class="pl-c1">0xA5</span>, <span class="pl-c1">0x5D</span>, <span class="pl-c1">0x2E</span>, <span class="pl-c1">0x57</span>, <span class="pl-c1">0x8C</span>, <span class="pl-c1">0x7A</span>, <span class="pl-c1">0x73</span>, <span class="pl-c1">0xD9</span>, <span class="pl-c1">0xED</span>, <span class="pl-c1">0xF6</span>, <span class="pl-c1">0x3B</span>, <span class="pl-c1">0x84</span>, <span class="pl-c1">0xFF</span>,
 <span class="pl-c1">0xE7</span>, <span class="pl-c1">0x7D</span>, <span class="pl-c1">0xA6</span>, <span class="pl-c1">0x3A</span>, <span class="pl-c1">0x2C</span>, <span class="pl-c1">0x95</span>, <span class="pl-c1">0x4A</span>, <span class="pl-c1">0xB1</span>, <span class="pl-c1">0x8E</span>, <span class="pl-c1">0x8E</span>, <span class="pl-c1">0x0E</span>, <span class="pl-c1">0x6D</span>, <span class="pl-c1">0x77</span>, <span class="pl-c1">0x77</span>, <span class="pl-c1">0xB7</span>, <span class="pl-c1">0xCD</span>,
 <span class="pl-c1">0xE9</span>, <span class="pl-c1">0x74</span>, <span class="pl-c1">0x3E</span>, <span class="pl-c1">0x73</span>, <span class="pl-c1">0xBB</span>, <span class="pl-c1">0xDD</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0x3C</span>, <span class="pl-c1">0x1E</span>, <span class="pl-c1">0x8F</span>, <span class="pl-c1">0xE6</span>, <span class="pl-c1">0xF4</span>, <span class="pl-c1">0xF4</span>, <span class="pl-c1">0x94</span>, <span class="pl-c1">0xAD</span>, <span class="pl-c1">0xAD</span>,
 <span class="pl-c1">0xAD</span>, <span class="pl-c1">0xDD</span>, <span class="pl-c1">0xDE</span>, <span class="pl-c1">0xCF</span>, <span class="pl-c1">0x73</span>, <span class="pl-c1">0x0B</span>, <span class="pl-c1">0x0B</span>, <span class="pl-c1">0xB8</span>, <span class="pl-c1">0xB6</span>, <span class="pl-c1">0xE0</span>, <span class="pl-c1">0x5D</span>, <span class="pl-c1">0xC6</span>, <span class="pl-c1">0x66</span>, <span class="pl-c1">0xC5</span>, <span class="pl-c1">0xE4</span>, <span class="pl-c1">0x10</span>,
 <span class="pl-c1">0x4C</span>, <span class="pl-c1">0xF4</span>, <span class="pl-c1">0xF7</span>, <span class="pl-c1">0xD8</span>, <span class="pl-c1">0x59</span>, <span class="pl-c1">0xF2</span>, <span class="pl-c1">0x7F</span>, <span class="pl-c1">0xA3</span>, <span class="pl-c1">0xB8</span>, <span class="pl-c1">0xB4</span>, <span class="pl-c1">0xFC</span>, <span class="pl-c1">0x0F</span>, <span class="pl-c1">0xEE</span>, <span class="pl-c1">0x37</span>, <span class="pl-c1">0x70</span>, <span class="pl-c1">0xEC</span>,
 <span class="pl-c1">0x16</span>, <span class="pl-c1">0x4A</span>, <span class="pl-c1">0x7E</span>, <span class="pl-c1">0x04</span>, <span class="pl-c1">0x00</span>, <span class="pl-c1">0x00</span>
};

AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse_P</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>image/x-icon<span class="pl-pds">"</span></span>, favicon_ico_gz, favicon_ico_gz_len);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Content-Encoding<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>gzip<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-stream" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-stream"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a Stream</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>read 12 bytes from Serial and send them as Content Type text/plain</span>
request-&gt;<span class="pl-en">send</span>(Serial, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">12</span>);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-stream-and-extra-headers" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-stream-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a Stream and extra headers</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>read 12 bytes from Serial and send them as Content Type text/plain</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(Serial, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">12</span>);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-stream-containing-templates" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-stream-containing-templates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a Stream containing templates</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-c"><span class="pl-c">//</span>read 12 bytes from Serial and send them as Content Type text/plain</span>
request-&gt;<span class="pl-en">send</span>(Serial, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">12</span>, processor);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-stream-containing-templates-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a Stream containing templates and extra headers</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-c"><span class="pl-c">//</span>read 12 bytes from Serial and send them as Content Type text/plain</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(Serial, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">12</span>, processor);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-file" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-file"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a File</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>Send index.htm with default content type</span>
request-&gt;<span class="pl-en">send</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>Send index.htm as text</span>
request-&gt;<span class="pl-en">send</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>Download index.htm</span>
request-&gt;<span class="pl-en">send</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, String(), true);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-file-and-extra-headers" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-file-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a File and extra headers</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>Send index.htm with default content type</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>Send index.htm as text</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>Download index.htm</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, String(), true);

response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-respond-with-content-coming-from-a-file-containing-templates" class="anchor" aria-hidden="true" href="#respond-with-content-coming-from-a-file-containing-templates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content coming from a File containing templates</h3><p>Internally uses <a href="#chunked-response">Chunked Response</a>.</p><p>Index.htm contents:</p><pre><code>%HELLO_FROM_TEMPLATE%
</code></pre><p>Somewhere in source files:</p><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-c"><span class="pl-c">//</span>Send index.htm with template processor function</span>
request-&gt;<span class="pl-en">send</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, String(), false, processor);</pre></div><h3><a id="user-content-respond-with-content-using-a-callback" class="anchor" aria-hidden="true" href="#respond-with-content-using-a-callback"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content using a callback</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>send 128 bytes as plain text</span>
request-&gt;<span class="pl-en">send</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">128</span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will not be asked for more bytes once the content length has been reached.</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-c"><span class="pl-c">//</span>Send what you currently have and you will be asked for more again</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
});</pre></div><h3><a id="user-content-respond-with-content-using-a-callback-and-extra-headers" class="anchor" aria-hidden="true" href="#respond-with-content-using-a-callback-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content using a callback and extra headers</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>send 128 bytes as plain text</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">128</span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will not be asked for more bytes once the content length has been reached.</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-c"><span class="pl-c">//</span>Send what you currently have and you will be asked for more again</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
});
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-respond-with-content-using-a-callback-containing-templates" class="anchor" aria-hidden="true" href="#respond-with-content-using-a-callback-containing-templates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content using a callback containing templates</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-c"><span class="pl-c">//</span>send 128 bytes as plain text</span>
request-&gt;<span class="pl-en">send</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">128</span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will not be asked for more bytes once the content length has been reached.</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-c"><span class="pl-c">//</span>Send what you currently have and you will be asked for more again</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
}, processor);</pre></div><h3><a id="user-content-respond-with-content-using-a-callback-containing-templates-and-extra-headers" class="anchor" aria-hidden="true" href="#respond-with-content-using-a-callback-containing-templates-and-extra-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content using a callback containing templates and extra headers</h3><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span><span class="pl-c"><span class="pl-c">//</span>send 128 bytes as plain text</span>
AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginResponse</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">128</span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will not be asked for more bytes once the content length has been reached.</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-c"><span class="pl-c">//</span>Send what you currently have and you will be asked for more again</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
}, processor);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-chunked-response" class="anchor" aria-hidden="true" href="#chunked-response"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chunked Response</h3><p>Used when content length is unknown. Works best if the client supports HTTP/1.1</p><div class="highlight highlight-source-c++"><pre>AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginChunkedResponse</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will be asked for more data until 0 is returned</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
});
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-chunked-response-containing-templates" class="anchor" aria-hidden="true" href="#chunked-response-containing-templates"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chunked Response containing templates</h3><p>Used when content length is unknown. Works best if the client supports HTTP/1.1</p><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span>

AsyncWebServerResponse *response = request-&gt;<span class="pl-en">beginChunkedResponse</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>index equals the amount of bytes that have been already sent</span><span class="pl-c"><span class="pl-c">//</span>You will be asked for more data until 0 is returned</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
}, processor);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-print-to-response" class="anchor" aria-hidden="true" href="#print-to-response"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Print to response</h3><div class="highlight highlight-source-c++"><pre>AsyncResponseStream *response = request-&gt;<span class="pl-en">beginResponseStream</span>(<span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Webpage at %s&lt;/title&gt;&lt;/head&gt;&lt;body&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">url</span>().c_str());

response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;h2&gt;Hello <span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">print</span>(request-&gt;<span class="pl-en">client</span>()-&gt;remoteIP());
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;/h2&gt;<span class="pl-pds">"</span></span>);

response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;h3&gt;General&lt;/h3&gt;<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;ul&gt;<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;Version: HTTP/1.%u&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">version</span>());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;Method: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">methodToString</span>());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;URL: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">url</span>().c_str());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;Host: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">host</span>().c_str());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;ContentType: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">contentType</span>().c_str());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;ContentLength: %u&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">contentLength</span>());
response-&gt;<span class="pl-en">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;Multipart: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, request-&gt;<span class="pl-en">multipart</span>()?"true":"false");
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;/ul&gt;<span class="pl-pds">"</span></span>);

response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;h3&gt;Headers&lt;/h3&gt;<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;ul&gt;<span class="pl-pds">"</span></span>);
<span class="pl-k">int</span> headers = request-&gt;<span class="pl-en">headers</span>();
<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;headers;i++){
  AsyncWebHeader* h = request-&gt;<span class="pl-c1">getHeader</span>(i);
  response-&gt;<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;%s: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, h-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), h-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
}
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;/ul&gt;<span class="pl-pds">"</span></span>);

response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;h3&gt;Parameters&lt;/h3&gt;<span class="pl-pds">"</span></span>);
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;ul&gt;<span class="pl-pds">"</span></span>);
<span class="pl-k">int</span> params = request-&gt;<span class="pl-en">params</span>();
<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;params;i++){
  AsyncWebParameter* p = request-&gt;<span class="pl-c1">getParam</span>(i);
  <span class="pl-k">if</span>(p-&gt;<span class="pl-c1">isFile</span>()){
    response-&gt;<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;FILE[%s]: %s, size: %u&lt;/li&gt;<span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">size</span>());
  } <span class="pl-k">else</span><span class="pl-k">if</span>(p-&gt;<span class="pl-c1">isPost</span>()){
    response-&gt;<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;POST[%s]: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
  } <span class="pl-k">else</span> {
    response-&gt;<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;li&gt;GET[%s]: %s&lt;/li&gt;<span class="pl-pds">"</span></span>, p-&gt;<span class="pl-c1">name</span>().<span class="pl-c1">c_str</span>(), p-&gt;<span class="pl-c1">value</span>().<span class="pl-c1">c_str</span>());
  }
}
response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;/ul&gt;<span class="pl-pds">"</span></span>);

response-&gt;<span class="pl-en">print</span>(<span class="pl-s"><span class="pl-pds">"</span>&lt;/body&gt;&lt;/html&gt;<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span>send the response last</span>
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-arduinojson-basic-response" class="anchor" aria-hidden="true" href="#arduinojson-basic-response"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ArduinoJson Basic Response</h3><p>This way of sending Json is great for when the result is below 4KB</p><div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>AsyncJson.h<span class="pl-pds">"</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>ArduinoJson.h<span class="pl-pds">"</span></span>


AsyncResponseStream *response = request-&gt;<span class="pl-en">beginResponseStream</span>(<span class="pl-s"><span class="pl-pds">"</span>application/json<span class="pl-pds">"</span></span>);
DynamicJsonBuffer jsonBuffer;
JsonObject &amp;root = jsonBuffer.createObject();
root[<span class="pl-s"><span class="pl-pds">"</span>heap<span class="pl-pds">"</span></span>] = ESP.getFreeHeap();
root[<span class="pl-s"><span class="pl-pds">"</span>ssid<span class="pl-pds">"</span></span>] = WiFi.SSID();
root.printTo(*response);
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h3><a id="user-content-arduinojson-advanced-response" class="anchor" aria-hidden="true" href="#arduinojson-advanced-response"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ArduinoJson Advanced Response</h3><p>This response can handle really large Json objects (tested to 40KB)
There isn't any noticeable speed decrease for small results with the method above
Since ArduinoJson does not allow reading parts of the string, the whole Json has to
be passed every time a chunks needs to be sent, which shows speed decrease proportional
to the resulting json packets</p><div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>AsyncJson.h<span class="pl-pds">"</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>ArduinoJson.h<span class="pl-pds">"</span></span>


AsyncJsonResponse * response = <span class="pl-k">new</span> AsyncJsonResponse();
response-&gt;<span class="pl-en">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Server<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>ESP Async Web Server<span class="pl-pds">"</span></span>);
JsonObject&amp; root = response-&gt;<span class="pl-en">getRoot</span>();
root[<span class="pl-s"><span class="pl-pds">"</span>heap<span class="pl-pds">"</span></span>] = ESP.getFreeHeap();
root[<span class="pl-s"><span class="pl-pds">"</span>ssid<span class="pl-pds">"</span></span>] = WiFi.SSID();
response-&gt;<span class="pl-en">setLength</span>();
request-&gt;<span class="pl-en">send</span>(response);</pre></div><h2><a id="user-content-serving-static-files" class="anchor" aria-hidden="true" href="#serving-static-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serving static files</h2><p>In addition to serving files from SPIFFS as described above, the server provide a dedicated handler that optimize the
performance of serving files from SPIFFS - <code>AsyncStaticWebHandler</code>. Use <code>server.serveStatic()</code> function to
initialize and add a new instance of <code>AsyncStaticWebHandler</code> to the server.
The Handler will not handle the request if the file does not exists, e.g. the server will continue to look for another
handler that can handle the request.
Notice that you can chain setter functions to setup the handler, or keep a pointer to change it at a later time.</p><h3><a id="user-content-serving-specific-file-by-name" class="anchor" aria-hidden="true" href="#serving-specific-file-by-name"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serving specific file by name</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Serve the file "/www/page.htm" when request url is "/page.htm"</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/page.htm<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/page.htm<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-serving-files-in-directory" class="anchor" aria-hidden="true" href="#serving-files-in-directory"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serving files in directory</h3><p>To serve files in a directory, the path to the files should specify a directory in SPIFFS and ends with "/".</p><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Serve files in directory "/www/" when request url starts with "/"</span><span class="pl-c"><span class="pl-c">//</span> Request to the root or none existing files will try to server the defualt</span><span class="pl-c"><span class="pl-c">//</span> file name "index.htm" if exists</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span> Server with different default file</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setDefaultFile(<span class="pl-s"><span class="pl-pds">"</span>default.html<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-serving-static-files-with-authentication" class="anchor" aria-hidden="true" href="#serving-static-files-with-authentication"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serving static files with authentication</h3><div class="highlight highlight-source-c++"><pre>server
    .serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>)
    .setDefaultFile(<span class="pl-s"><span class="pl-pds">"</span>default.html<span class="pl-pds">"</span></span>)
    .setAuthentication(<span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>pass<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-specifying-cache-control-header" class="anchor" aria-hidden="true" href="#specifying-cache-control-header"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Specifying Cache-Control header</h3><p>It is possible to specify Cache-Control header value to reduce the number of calls to the server once the client loaded
the files. For more information on Cache-Control values see <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9" rel="nofollow">Cache-Control</a></p><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Cache responses for 10 minutes (600 seconds)</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setCacheControl(<span class="pl-s"><span class="pl-pds">"</span>max-age=600<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>*** Change Cache-Control after server setup ***</span><span class="pl-c"><span class="pl-c">//</span> During setup - keep a pointer to the handler</span>
AsyncStaticWebHandler* handler = &amp;server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setCacheControl(<span class="pl-s"><span class="pl-pds">"</span>max-age=600<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span> At a later event - change Cache-Control</span>
handler-&gt;<span class="pl-en">setCacheControl</span>(<span class="pl-s"><span class="pl-pds">"</span>max-age=30<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-specifying-date-modified-header" class="anchor" aria-hidden="true" href="#specifying-date-modified-header"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Specifying Date-Modified header</h3><p>It is possible to specify Date-Modified header to enable the server to return Not-Modified (304) response for requests
with "If-Modified-Since" header with the same value, instead of responding with the actual file content.</p><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Update the date modified string every time files are updated</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setLastModified(<span class="pl-s"><span class="pl-pds">"</span>Mon, 20 Jun 2016 14:00:00 GMT<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>*** Chage last modified value at a later stage ***</span><span class="pl-c"><span class="pl-c">//</span> During setup - read last modified value from config or EEPROM</span>
String date_modified = loadDateModified();
AsyncStaticWebHandler* handler = &amp;server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>);
handler-&gt;<span class="pl-en">setLastModified</span>(date_modified);

<span class="pl-c"><span class="pl-c">//</span> At a later event when files are updated</span>
String date_modified = getNewDateModfied();
<span class="pl-en">saveDateModified</span>(date_modified); <span class="pl-c"><span class="pl-c">//</span> Save for next reset</span>
handler-&gt;<span class="pl-en">setLastModified</span>(date_modified);</pre></div><h3><a id="user-content-specifying-template-processor-callback" class="anchor" aria-hidden="true" href="#specifying-template-processor-callback"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Specifying Template Processor callback</h3><p>It is possible to specify template processor for static files. For information on template processor see
<a href="#respond-with-content-coming-from-a-file-containing-templates">Respond with content coming from a File containing templates</a>.</p><div class="highlight highlight-source-c++"><pre>String <span class="pl-en">processor</span>(<span class="pl-k">const</span> String&amp; var)
{
  <span class="pl-k">if</span>(var == <span class="pl-s"><span class="pl-pds">"</span>HELLO_FROM_TEMPLATE<span class="pl-pds">"</span></span>)
    <span class="pl-k">return</span><span class="pl-c1">F</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello world!<span class="pl-pds">"</span></span>);
  <span class="pl-k">return</span><span class="pl-c1">String</span>();
}

<span class="pl-c"><span class="pl-c">//</span> ...</span>

server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setTemplateProcessor(processor);</pre></div><h2><a id="user-content-param-rewrite-with-matching" class="anchor" aria-hidden="true" href="#param-rewrite-with-matching"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Param Rewrite With Matching</h2><p>It is possible to rewrite the request url with parameter matchg. Here is an example with one parameter:
Rewrite for example "/radio/{frequence}" -&gt; "/radio?f={frequence}"</p><div class="highlight highlight-source-c++"><pre><span class="pl-k">class</span><span class="pl-en">OneParamRewrite</span> : <span class="pl-k">public</span><span class="pl-en">AsyncWebRewrite</span>
{
  <span class="pl-k">protected:</span>
    String _urlPrefix;
    <span class="pl-k">int</span> _paramIndex;
    String _paramsBackup;

  <span class="pl-k">public:</span><span class="pl-en">OneParamRewrite</span>(<span class="pl-k">const</span><span class="pl-k">char</span>* from, <span class="pl-k">const</span><span class="pl-k">char</span>* to)
    : AsyncWebRewrite(from, to) {

      _paramIndex = _from.<span class="pl-c1">indexOf</span>(<span class="pl-s"><span class="pl-pds">'</span>{<span class="pl-pds">'</span></span>);

      <span class="pl-k">if</span>( _paramIndex &gt;=<span class="pl-c1">0</span> &amp;&amp; _from.<span class="pl-c1">endsWith</span>(<span class="pl-s"><span class="pl-pds">"</span>}<span class="pl-pds">"</span></span>)) {
        _urlPrefix = _from.<span class="pl-c1">substring</span>(<span class="pl-c1">0</span>, _paramIndex);
        <span class="pl-k">int</span><span class="pl-c1">index</span> = _params.<span class="pl-c1">indexOf</span>(<span class="pl-s"><span class="pl-pds">'</span>{<span class="pl-pds">'</span></span>);
        <span class="pl-k">if</span>(<span class="pl-c1">index</span> &gt;= <span class="pl-c1">0</span>) {
          _params = _params.<span class="pl-c1">substring</span>(<span class="pl-c1">0</span>, <span class="pl-c1">index</span>);
        }
      } <span class="pl-k">else</span> {
        _urlPrefix = _from;
      }
      _paramsBackup = _params;
  }

  <span class="pl-k">bool</span><span class="pl-en">match</span>(AsyncWebServerRequest *request) <span class="pl-k">override</span> {
    <span class="pl-k">if</span>(request-&gt;<span class="pl-c1">url</span>().<span class="pl-c1">startsWith</span>(_urlPrefix)) {
      <span class="pl-k">if</span>(_paramIndex &gt;= <span class="pl-c1">0</span>) {
        _params = _paramsBackup + request-&gt;<span class="pl-c1">url</span>().<span class="pl-c1">substring</span>(_paramIndex);
      } <span class="pl-k">else</span> {
        _params = _paramsBackup;
      }
    <span class="pl-k">return</span><span class="pl-c1">true</span>;

    } <span class="pl-k">else</span> {
      <span class="pl-k">return</span><span class="pl-c1">false</span>;
    }
  }
};</pre></div><p>Usage:</p><div class="highlight highlight-source-c++"><pre>  server.addRewrite( <span class="pl-k">new</span> OneParamRewrite(<span class="pl-s"><span class="pl-pds">"</span>/radio/{frequence}<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>/radio?f={frequence}<span class="pl-pds">"</span></span>) );</pre></div><h2><a id="user-content-using-filters" class="anchor" aria-hidden="true" href="#using-filters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using filters</h2><p>Filters can be set to <code>Rewrite</code> or <code>Handler</code> in order to control when to apply the rewrite and consider the handler.
A filter is a callback function that evaluates the request and return a boolean <code>true</code> to include the item
or <code>false</code> to exclude it.
Two filter callback are provided for convince:</p><ul><li><code>ON_STA_FILTER</code> - return true when requests are made to the STA (station mode) interface.</li><li><code>ON_AP_FILTER</code> - return true when requests are made to the AP (access point) interface.</li></ul><h3><a id="user-content-serve-different-site-files-in-ap-mode" class="anchor" aria-hidden="true" href="#serve-different-site-files-in-ap-mode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serve different site files in AP mode</h3><div class="highlight highlight-source-c++"><pre>server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>).setFilter(ON_STA_FILTER);
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/ap/<span class="pl-pds">"</span></span>).setFilter(ON_AP_FILTER);</pre></div><h3><a id="user-content-rewrite-to-different-index-on-ap" class="anchor" aria-hidden="true" href="#rewrite-to-different-index-on-ap"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rewrite to different index on AP</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Serve the file "/www/index-ap.htm" in AP, and the file "/www/index.htm" on STA</span>
server.rewrite(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>index.htm<span class="pl-pds">"</span></span>);
server.rewrite(<span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>index-ap.htm<span class="pl-pds">"</span></span>).setFilter(ON_AP_FILTER);
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-serving-different-hosts" class="anchor" aria-hidden="true" href="#serving-different-hosts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Serving different hosts</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Filter callback using request host</span><span class="pl-k">bool</span><span class="pl-en">filterOnHost1</span>(AsyncWebServerRequest *request) { <span class="pl-k">return</span> request-&gt;<span class="pl-c1">host</span>() == <span class="pl-s"><span class="pl-pds">"</span>host1<span class="pl-pds">"</span></span>; }

<span class="pl-c"><span class="pl-c">//</span> Server setup: server files in "/host1/" to requests for "host1", and files in "/www/" otherwise.</span>
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/host1/<span class="pl-pds">"</span></span>).setFilter(filterOnHost1);
server.serveStatic(<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/www/<span class="pl-pds">"</span></span>);</pre></div><h3><a id="user-content-determine-interface-inside-callbacks" class="anchor" aria-hidden="true" href="#determine-interface-inside-callbacks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Determine interface inside callbacks</h3><div class="highlight highlight-source-c++"><pre>  String RedirectUrl = <span class="pl-s"><span class="pl-pds">"</span>http://<span class="pl-pds">"</span></span>;
  <span class="pl-k">if</span> (ON_STA_FILTER(request)) {
    RedirectUrl += WiFi.<span class="pl-c1">localIP</span>().<span class="pl-c1">toString</span>();
  } <span class="pl-k">else</span> {
    RedirectUrl += WiFi.<span class="pl-c1">softAPIP</span>().<span class="pl-c1">toString</span>();
  }
  RedirectUrl += <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>;
  request-&gt;<span class="pl-en">redirect</span>(RedirectUrl);</pre></div><h2><a id="user-content-bad-responses" class="anchor" aria-hidden="true" href="#bad-responses"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bad Responses</h2><p>Some responses are implemented, but you should not use them, because they do not conform to HTTP.
The following example will lead to unclean close of the connection and more time wasted
than providing the length of the content</p><h3><a id="user-content-respond-with-content-using-a-callback-without-content-length-to-http10-clients" class="anchor" aria-hidden="true" href="#respond-with-content-using-a-callback-without-content-length-to-http10-clients"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Respond with content using a callback without content length to HTTP/1.0 clients</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>This is used as fallback for chunked responses to HTTP/1.0 Clients</span>
request-&gt;<span class="pl-en">send</span>(<span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">0</span>, [](<span class="pl-c1">uint8_t</span> *buffer, <span class="pl-c1">size_t</span> maxLen, <span class="pl-c1">size_t</span> index) -&gt; size_t {
  <span class="pl-c"><span class="pl-c">//</span>Write up to "maxLen" bytes into "buffer" and return the amount written.</span><span class="pl-c"><span class="pl-c">//</span>You will be asked for more data until 0 is returned</span><span class="pl-c"><span class="pl-c">//</span>Keep in mind that you can not delay or yield waiting for more data!</span><span class="pl-k">return</span> mySource.<span class="pl-c1">read</span>(buffer, maxLen);
});</pre></div><h2><a id="user-content-async-websocket-plugin" class="anchor" aria-hidden="true" href="#async-websocket-plugin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async WebSocket Plugin</h2><p>The server includes a web socket plugin which lets you define different WebSocket locations to connect to
without starting another listening service or using different port</p><h3><a id="user-content-async-websocket-event" class="anchor" aria-hidden="true" href="#async-websocket-event"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async WebSocket Event</h3><div class="highlight highlight-source-c++"><pre><span class="pl-k">void</span><span class="pl-en">onEvent</span>(AsyncWebSocket * server, AsyncWebSocketClient * client, AwsEventType type, <span class="pl-k">void</span> * arg, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len){
  <span class="pl-k">if</span>(type == WS_EVT_CONNECT){
    <span class="pl-c"><span class="pl-c">//</span>client connected</span><span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] connect<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>());
    client-&gt;<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Hello Client %u :)<span class="pl-pds">"</span></span>, client-&gt;<span class="pl-c1">id</span>());
    client-&gt;<span class="pl-c1">ping</span>();
  } <span class="pl-k">else</span><span class="pl-k">if</span>(type == WS_EVT_DISCONNECT){
    <span class="pl-c"><span class="pl-c">//</span>client disconnected</span><span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] disconnect: %u<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>());
  } <span class="pl-k">else</span><span class="pl-k">if</span>(type == WS_EVT_ERROR){
    <span class="pl-c"><span class="pl-c">//</span>error was received from the other end</span><span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] error(%u): %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), *((<span class="pl-c1">uint16_t</span>*)arg), (<span class="pl-k">char</span>*)data);
  } <span class="pl-k">else</span><span class="pl-k">if</span>(type == WS_EVT_PONG){
    <span class="pl-c"><span class="pl-c">//</span>pong message was received (in response to a ping request maybe)</span><span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] pong[%u]: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), len, (len)?(<span class="pl-k">char</span>*)data:<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>);
  } <span class="pl-k">else</span><span class="pl-k">if</span>(type == WS_EVT_DATA){
    <span class="pl-c"><span class="pl-c">//</span>data packet</span>
    AwsFrameInfo * info = (AwsFrameInfo*)arg;
    <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">final</span> &amp;&amp; info-&gt;<span class="pl-smi">index</span> == <span class="pl-c1">0</span> &amp;&amp; info-&gt;<span class="pl-smi">len</span> == len){
      <span class="pl-c"><span class="pl-c">//</span>the whole message is in a single frame and we got all of it's data</span><span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] %s-message[%llu]: <span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), (info-&gt;<span class="pl-smi">opcode</span> == WS_TEXT)?<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>binary<span class="pl-pds">"</span></span>, info-&gt;<span class="pl-smi">len</span>);
      <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">opcode</span> == WS_TEXT){
        data[len] = <span class="pl-c1">0</span>;
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, (<span class="pl-k">char</span>*)data);
      } <span class="pl-k">else</span> {
        <span class="pl-k">for</span>(<span class="pl-c1">size_t</span> i=<span class="pl-c1">0</span>; i &lt; info-&gt;<span class="pl-smi">len</span>; i++){
          <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%02x <span class="pl-pds">"</span></span>, data[i]);
        }
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
      }
      <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">opcode</span> == WS_TEXT)
        client-&gt;<span class="pl-c1">text</span>(<span class="pl-s"><span class="pl-pds">"</span>I got your text message<span class="pl-pds">"</span></span>);
      <span class="pl-k">else</span>
        client-&gt;<span class="pl-c1">binary</span>(<span class="pl-s"><span class="pl-pds">"</span>I got your binary message<span class="pl-pds">"</span></span>);
    } <span class="pl-k">else</span> {
      <span class="pl-c"><span class="pl-c">//</span>message is comprised of multiple frames or the frame is split into multiple packets</span><span class="pl-k">if</span>(info-&gt;<span class="pl-smi">index</span> == <span class="pl-c1">0</span>){
        <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">num</span> == <span class="pl-c1">0</span>)
          <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] %s-message start<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), (info-&gt;<span class="pl-smi">message_opcode</span> == WS_TEXT)?<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>binary<span class="pl-pds">"</span></span>);
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] frame[%u] start[%llu]<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), info-&gt;<span class="pl-smi">num</span>, info-&gt;<span class="pl-smi">len</span>);
      }

      <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] frame[%u] %s[%llu - %llu]: <span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), info-&gt;<span class="pl-smi">num</span>, (info-&gt;<span class="pl-smi">message_opcode</span> == WS_TEXT)?<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>binary<span class="pl-pds">"</span></span>, info-&gt;<span class="pl-smi">index</span>, info-&gt;<span class="pl-smi">index</span> + len);
      <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">message_opcode</span> == WS_TEXT){
        data[len] = <span class="pl-c1">0</span>;
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, (<span class="pl-k">char</span>*)data);
      } <span class="pl-k">else</span> {
        <span class="pl-k">for</span>(<span class="pl-c1">size_t</span> i=<span class="pl-c1">0</span>; i &lt; len; i++){
          <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>%02x <span class="pl-pds">"</span></span>, data[i]);
        }
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
      }

      <span class="pl-k">if</span>((info-&gt;<span class="pl-smi">index</span> + len) == info-&gt;<span class="pl-smi">len</span>){
        <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] frame[%u] end[%llu]<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), info-&gt;<span class="pl-smi">num</span>, info-&gt;<span class="pl-smi">len</span>);
        <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">final</span>){
          <span class="pl-c1">os_printf</span>(<span class="pl-s"><span class="pl-pds">"</span>ws[%s][%u] %s-message end<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, server-&gt;<span class="pl-c1">url</span>(), client-&gt;<span class="pl-c1">id</span>(), (info-&gt;<span class="pl-smi">message_opcode</span> == WS_TEXT)?<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>binary<span class="pl-pds">"</span></span>);
          <span class="pl-k">if</span>(info-&gt;<span class="pl-smi">message_opcode</span> == WS_TEXT)
            client-&gt;<span class="pl-c1">text</span>(<span class="pl-s"><span class="pl-pds">"</span>I got your text message<span class="pl-pds">"</span></span>);
          <span class="pl-k">else</span>
            client-&gt;<span class="pl-c1">binary</span>(<span class="pl-s"><span class="pl-pds">"</span>I got your binary message<span class="pl-pds">"</span></span>);
        }
      }
    }
  }
}</pre></div><h3><a id="user-content-methods-for-sending-data-to-a-socket-client" class="anchor" aria-hidden="true" href="#methods-for-sending-data-to-a-socket-client"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Methods for sending data to a socket client</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>Server methods</span>
AsyncWebSocket <span class="pl-en">ws</span>(<span class="pl-s"><span class="pl-pds">"</span>/ws<span class="pl-pds">"</span></span>);
<span class="pl-c"><span class="pl-c">//</span>printf to a client</span>
ws.printf((<span class="pl-c1">uint32_t</span>)client_id, arguments...);
<span class="pl-c"><span class="pl-c">//</span>printf to all clients</span>
ws.printfAll(arguments...);
<span class="pl-c"><span class="pl-c">//</span>printf_P to a client</span>
ws.printf_P((<span class="pl-c1">uint32_t</span>)client_id, PSTR(format), arguments...);
<span class="pl-c"><span class="pl-c">//</span>printfAll_P to all clients</span>
ws.printfAll_P(PSTR(format), arguments...);
<span class="pl-c"><span class="pl-c">//</span>send text to a client</span>
ws.text((<span class="pl-c1">uint32_t</span>)client_id, (<span class="pl-k">char</span>*)text);
ws.text((<span class="pl-c1">uint32_t</span>)client_id, (<span class="pl-c1">uint8_t</span>*)text, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>send text from PROGMEM to a client</span>
ws.text((<span class="pl-c1">uint32_t</span>)client_id, PSTR(<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>));
<span class="pl-k">const</span><span class="pl-k">char</span> flash_text[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>Text to send<span class="pl-pds">"</span></span>
ws.text((<span class="pl-c1">uint32_t</span>)client_id, FPSTR(flash_text));
<span class="pl-c"><span class="pl-c">//</span>send text to all clients</span>
ws.textAll((<span class="pl-k">char</span>*)text);
ws.textAll((<span class="pl-c1">uint8_t</span>*)text, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>send binary to a client</span>
ws.binary((<span class="pl-c1">uint32_t</span>)client_id, (<span class="pl-k">char</span>*)binary);
ws.binary((<span class="pl-c1">uint32_t</span>)client_id, (<span class="pl-c1">uint8_t</span>*)binary, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>send binary from PROGMEM to a client</span><span class="pl-k">const</span><span class="pl-c1">uint8_t</span> flash_binary[] PROGMEM = { <span class="pl-c1">0x01</span>, <span class="pl-c1">0x02</span>, <span class="pl-c1">0x03</span>, <span class="pl-c1">0x04</span> };
ws.binary((<span class="pl-c1">uint32_t</span>)client_id, flash_binary, <span class="pl-c1">4</span>);
<span class="pl-c"><span class="pl-c">//</span>send binary to all clients</span>
ws.binaryAll((<span class="pl-k">char</span>*)binary);
ws.binaryAll((<span class="pl-c1">uint8_t</span>*)binary, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>HTTP Authenticate before switch to Websocket protocol</span>
ws.setAuthentication(<span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>pass<span class="pl-pds">"</span></span>);

<span class="pl-c"><span class="pl-c">//</span>client methods</span>
AsyncWebSocketClient * client;
<span class="pl-c"><span class="pl-c">//</span>printf</span>
client-&gt;<span class="pl-en">printf</span>(arguments...);
<span class="pl-c"><span class="pl-c">//</span>printf_P</span>
client-&gt;<span class="pl-en">printf_P</span>(PSTR(format), arguments...);
<span class="pl-c"><span class="pl-c">//</span>send text</span>
client-&gt;<span class="pl-en">text</span>((<span class="pl-k">char</span>*)text);
client-&gt;<span class="pl-en">text</span>((<span class="pl-c1">uint8_t</span>*)text, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>send text from PROGMEM</span>
client-&gt;<span class="pl-en">text</span>(PSTR(<span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>));
<span class="pl-k">const</span><span class="pl-k">char</span> flash_text[] PROGMEM = <span class="pl-s"><span class="pl-pds">"</span>Text to send<span class="pl-pds">"</span></span>;
client-&gt;<span class="pl-en">text</span>(FPSTR(flash_text));
<span class="pl-c"><span class="pl-c">//</span>send binary</span>
client-&gt;<span class="pl-en">binary</span>((<span class="pl-k">char</span>*)binary);
client-&gt;<span class="pl-en">binary</span>((<span class="pl-c1">uint8_t</span>*)binary, (<span class="pl-c1">size_t</span>)len);
<span class="pl-c"><span class="pl-c">//</span>send binary from PROGMEM</span><span class="pl-k">const</span><span class="pl-c1">uint8_t</span> flash_binary[] PROGMEM = { <span class="pl-c1">0x01</span>, <span class="pl-c1">0x02</span>, <span class="pl-c1">0x03</span>, <span class="pl-c1">0x04</span> };
client-&gt;<span class="pl-en">binary</span>(flash_binary, <span class="pl-c1">4</span>);</pre></div><h3><a id="user-content-direct-access-to-web-socket-message-buffer" class="anchor" aria-hidden="true" href="#direct-access-to-web-socket-message-buffer"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Direct access to web socket message buffer</h3><p>When sending a web socket message using the above methods a buffer is created.  Under certain circumstances you might want to manipulate or populate this buffer directly from your application, for example to prevent unnecessary duplications of the data.  This example below shows how to create a buffer and print data to it from an ArduinoJson object then send it.</p><div class="highlight highlight-source-c++"><pre><span class="pl-k">void</span><span class="pl-en">sendDataWs</span>(AsyncWebSocketClient * client)
{
    DynamicJsonBuffer jsonBuffer;
    JsonObject&amp; root = jsonBuffer.<span class="pl-c1">createObject</span>();
    root[<span class="pl-s"><span class="pl-pds">"</span>a<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>abc<span class="pl-pds">"</span></span>;
    root[<span class="pl-s"><span class="pl-pds">"</span>b<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>abcd<span class="pl-pds">"</span></span>;
    root[<span class="pl-s"><span class="pl-pds">"</span>c<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>abcde<span class="pl-pds">"</span></span>;
    root[<span class="pl-s"><span class="pl-pds">"</span>d<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>abcdef<span class="pl-pds">"</span></span>;
    root[<span class="pl-s"><span class="pl-pds">"</span>e<span class="pl-pds">"</span></span>] = <span class="pl-s"><span class="pl-pds">"</span>abcdefg<span class="pl-pds">"</span></span>;
    <span class="pl-c1">size_t</span> len = root.<span class="pl-c1">measureLength</span>();
    AsyncWebSocketMessageBuffer * buffer = ws.<span class="pl-c1">makeBuffer</span>(len); <span class="pl-c"><span class="pl-c">//</span>  creates a buffer (len + 1) for you.</span><span class="pl-k">if</span> (buffer) {
        root.<span class="pl-c1">printTo</span>((<span class="pl-k">char</span> *)buffer-&gt;<span class="pl-c1">get</span>(), len + <span class="pl-c1">1</span>);
        <span class="pl-k">if</span> (client) {
            client-&gt;<span class="pl-c1">text</span>(buffer);
        } <span class="pl-k">else</span> {
            ws.<span class="pl-c1">textAll</span>(buffer);
        }
    }
}</pre></div><h3><a id="user-content-limiting-the-number-of-web-socket-clients" class="anchor" aria-hidden="true" href="#limiting-the-number-of-web-socket-clients"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Limiting the number of web socket clients</h3><p>Browsers sometimes do not correctly close the websocket connection, even when the close() function is called in javascript.  This will eventually exhaust the web server's resources and will cause the server to crash.  Periodically calling the cleanClients() function from the main loop() function limits the number of clients by closing the oldest client when the maximum number of clients has been exceeded.  This can called be every cycle, however, if you wish to use less power, then calling as infrequently as once per second is sufficient.</p><div class="highlight highlight-source-c++"><pre><span class="pl-k">void</span><span class="pl-en">loop</span>(){
  ws.<span class="pl-c1">cleanupClients</span>();
}</pre></div><h2><a id="user-content-async-event-source-plugin" class="anchor" aria-hidden="true" href="#async-event-source-plugin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Async Event Source Plugin</h2><p>The server includes EventSource (Server-Sent Events) plugin which can be used to send short text events to the browser.
Difference between EventSource and WebSockets is that EventSource is single direction, text-only protocol.</p><h3><a id="user-content-setup-event-source-on-the-server" class="anchor" aria-hidden="true" href="#setup-event-source-on-the-server"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Event Source on the server</h3><div class="highlight highlight-source-c++"><pre>AsyncWebServer <span class="pl-en">server</span>(<span class="pl-c1">80</span>);
AsyncEventSource <span class="pl-en">events</span>(<span class="pl-s"><span class="pl-pds">"</span>/events<span class="pl-pds">"</span></span>);

<span class="pl-k">void</span><span class="pl-en">setup</span>(){
  <span class="pl-c"><span class="pl-c">//</span> setup ......</span>
  events.<span class="pl-c1">onConnect</span>([](AsyncEventSourceClient *client){
    <span class="pl-k">if</span>(client-&gt;<span class="pl-c1">lastId</span>()){
      Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Client reconnected! Last message ID that it gat is: %u<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, client-&gt;<span class="pl-c1">lastId</span>());
    }
    <span class="pl-c"><span class="pl-c">//</span>send event with message "hello!", id current millis</span><span class="pl-c"><span class="pl-c">//</span> and set reconnect delay to 1 second</span>
    client-&gt;<span class="pl-c1">send</span>(<span class="pl-s"><span class="pl-pds">"</span>hello!<span class="pl-pds">"</span></span>,<span class="pl-c1">NULL</span>,<span class="pl-c1">millis</span>(),<span class="pl-c1">1000</span>);
  });
  <span class="pl-c"><span class="pl-c">//</span>HTTP Basic authentication</span>
  events.<span class="pl-c1">setAuthentication</span>(<span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>pass<span class="pl-pds">"</span></span>);
  server.<span class="pl-c1">addHandler</span>(&amp;events);
  <span class="pl-c"><span class="pl-c">//</span> setup ......</span>
}

<span class="pl-k">void</span><span class="pl-en">loop</span>(){
  <span class="pl-k">if</span>(eventTriggered){ <span class="pl-c"><span class="pl-c">//</span> your logic here</span><span class="pl-c"><span class="pl-c">//</span>send event "myevent"</span>
    events.<span class="pl-c1">send</span>(<span class="pl-s"><span class="pl-pds">"</span>my event content<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>myevent<span class="pl-pds">"</span></span>,<span class="pl-c1">millis</span>());
  }
}</pre></div><h3><a id="user-content-setup-event-source-in-the-browser" class="anchor" aria-hidden="true" href="#setup-event-source-in-the-browser"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup Event Source in the browser</h3><div class="highlight highlight-source-js"><pre><span class="pl-k">if</span> (<span class="pl-k">!!</span><span class="pl-c1">window</span>.<span class="pl-smi">EventSource</span>) {
  <span class="pl-k">var</span> source <span class="pl-k">=</span><span class="pl-k">new</span><span class="pl-en">EventSource</span>(<span class="pl-s"><span class="pl-pds">'</span>/events<span class="pl-pds">'</span></span>);

  <span class="pl-smi">source</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-s"><span class="pl-pds">'</span>open<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Events Connected<span class="pl-pds">"</span></span>);
  }, <span class="pl-c1">false</span>);

  <span class="pl-smi">source</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {
    <span class="pl-k">if</span> (<span class="pl-smi">e</span>.<span class="pl-c1">target</span>.<span class="pl-c1">readyState</span><span class="pl-k">!=</span><span class="pl-c1">EventSource</span>.<span class="pl-c1">OPEN</span>) {
      <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Events Disconnected<span class="pl-pds">"</span></span>);
    }
  }, <span class="pl-c1">false</span>);

  <span class="pl-smi">source</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-s"><span class="pl-pds">'</span>message<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>, <span class="pl-smi">e</span>.<span class="pl-c1">data</span>);
  }, <span class="pl-c1">false</span>);

  <span class="pl-smi">source</span>.<span class="pl-c1">addEventListener</span>(<span class="pl-s"><span class="pl-pds">'</span>myevent<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">e</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>myevent<span class="pl-pds">"</span></span>, <span class="pl-smi">e</span>.<span class="pl-c1">data</span>);
  }, <span class="pl-c1">false</span>);
}</pre></div><h2><a id="user-content-scanning-for-available-wifi-networks" class="anchor" aria-hidden="true" href="#scanning-for-available-wifi-networks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scanning for available WiFi Networks</h2><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span>First request will return 0 results unless you start scan from somewhere else (loop/setup)</span><span class="pl-c"><span class="pl-c">//</span>Do not request more often than 3-5 seconds</span>
server.on(<span class="pl-s"><span class="pl-pds">"</span>/scan<span class="pl-pds">"</span></span>, HTTP_GET, [](AsyncWebServerRequest *request){
  String json = <span class="pl-s"><span class="pl-pds">"</span>[<span class="pl-pds">"</span></span>;
  <span class="pl-k">int</span> n = WiFi.<span class="pl-c1">scanComplete</span>();
  <span class="pl-k">if</span>(n == -<span class="pl-c1">2</span>){
    WiFi.<span class="pl-c1">scanNetworks</span>(<span class="pl-c1">true</span>);
  } <span class="pl-k">else</span><span class="pl-k">if</span>(n){
    <span class="pl-k">for</span> (<span class="pl-k">int</span> i = <span class="pl-c1">0</span>; i &lt; n; ++i){
      <span class="pl-k">if</span>(i) json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span>;
      json += <span class="pl-s"><span class="pl-pds">"</span>{<span class="pl-pds">"</span></span>;
      json += <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span>rssi<span class="pl-cce">\"</span>:<span class="pl-pds">"</span></span>+<span class="pl-c1">String</span>(WiFi.<span class="pl-c1">RSSI</span>(i));
      json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-cce">\"</span>ssid<span class="pl-cce">\"</span>:<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>+WiFi.<span class="pl-c1">SSID</span>(i)+<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span><span class="pl-pds">"</span></span>;
      json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-cce">\"</span>bssid<span class="pl-cce">\"</span>:<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>+WiFi.<span class="pl-c1">BSSIDstr</span>(i)+<span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span><span class="pl-pds">"</span></span>;
      json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-cce">\"</span>channel<span class="pl-cce">\"</span>:<span class="pl-pds">"</span></span>+<span class="pl-c1">String</span>(WiFi.<span class="pl-c1">channel</span>(i));
      json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-cce">\"</span>secure<span class="pl-cce">\"</span>:<span class="pl-pds">"</span></span>+<span class="pl-c1">String</span>(WiFi.<span class="pl-c1">encryptionType</span>(i));
      json += <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-cce">\"</span>hidden<span class="pl-cce">\"</span>:<span class="pl-pds">"</span></span>+<span class="pl-c1">String</span>(WiFi.<span class="pl-c1">isHidden</span>(i)?<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>);
      json += <span class="pl-s"><span class="pl-pds">"</span>}<span class="pl-pds">"</span></span>;
    }
    WiFi.<span class="pl-c1">scanDelete</span>();
    <span class="pl-k">if</span>(WiFi.<span class="pl-c1">scanComplete</span>() == -<span class="pl-c1">2</span>){
      WiFi.<span class="pl-c1">scanNetworks</span>(<span class="pl-c1">true</span>);
    }
  }
  json += <span class="pl-s"><span class="pl-pds">"</span>]<span class="pl-pds">"</span></span>;
  request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>application/json<span class="pl-pds">"</span></span>, json);
  json = <span class="pl-c1">String</span>();
});</pre></div><h2><a id="user-content-remove-handlers-and-rewrites" class="anchor" aria-hidden="true" href="#remove-handlers-and-rewrites"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remove handlers and rewrites</h2><p>Server goes through handlers in same order as they were added. You can't simple add handler with same path to override them.
To remove handler:</p><pre lang="arduino"><code>// save callback for particular URL path
auto handler = server.on("/some/path", [](AsyncWebServerRequest *request){
  //do something useful
});
// when you don't need handler anymore remove it
server.removeHandler(&amp;handler);

// same with rewrites
server.removeRewrite(&amp;someRewrite);

server.onNotFound([](AsyncWebServerRequest *request){
  request-&gt;send(404);
});

// remove server.onNotFound handler
server.onNotFound(NULL);

// remove all rewrites, handlers and onNotFound/onFileUpload/onRequestBody callbacks
server.reset();
</code></pre><h2><a id="user-content-setting-up-the-server" class="anchor" aria-hidden="true" href="#setting-up-the-server"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up the server</h2><div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>ESPAsyncTCP.h<span class="pl-pds">"</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">"</span>ESPAsyncWebServer.h<span class="pl-pds">"</span></span>

AsyncWebServer <span class="pl-en">server</span>(<span class="pl-c1">80</span>);
AsyncWebSocket <span class="pl-en">ws</span>(<span class="pl-s"><span class="pl-pds">"</span>/ws<span class="pl-pds">"</span></span>); <span class="pl-c"><span class="pl-c">//</span> access at ws://[esp ip]/ws</span>
AsyncEventSource <span class="pl-en">events</span>(<span class="pl-s"><span class="pl-pds">"</span>/events<span class="pl-pds">"</span></span>); <span class="pl-c"><span class="pl-c">//</span> event source (Server-Sent events)</span><span class="pl-k">const</span><span class="pl-k">char</span>* ssid = <span class="pl-s"><span class="pl-pds">"</span>your-ssid<span class="pl-pds">"</span></span>;
<span class="pl-k">const</span><span class="pl-k">char</span>* password = <span class="pl-s"><span class="pl-pds">"</span>your-pass<span class="pl-pds">"</span></span>;
<span class="pl-k">const</span><span class="pl-k">char</span>* http_username = <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>;
<span class="pl-k">const</span><span class="pl-k">char</span>* http_password = <span class="pl-s"><span class="pl-pds">"</span>admin<span class="pl-pds">"</span></span>;

<span class="pl-c"><span class="pl-c">//</span>flag to use from web update to reboot the ESP</span><span class="pl-k">bool</span> shouldReboot = <span class="pl-c1">false</span>;

<span class="pl-k">void</span><span class="pl-en">onRequest</span>(AsyncWebServerRequest *request){
  <span class="pl-c"><span class="pl-c">//</span>Handle Unknown Request</span>
  request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">404</span>);
}

<span class="pl-k">void</span><span class="pl-en">onBody</span>(AsyncWebServerRequest *request, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len, <span class="pl-c1">size_t</span> index, <span class="pl-c1">size_t</span> total){
  <span class="pl-c"><span class="pl-c">//</span>Handle body</span>
}

<span class="pl-k">void</span><span class="pl-en">onUpload</span>(AsyncWebServerRequest *request, String filename, <span class="pl-c1">size_t</span> index, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len, <span class="pl-k">bool</span> final){
  <span class="pl-c"><span class="pl-c">//</span>Handle upload</span>
}

<span class="pl-k">void</span><span class="pl-en">onEvent</span>(AsyncWebSocket * server, AsyncWebSocketClient * client, AwsEventType type, <span class="pl-k">void</span> * arg, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len){
  <span class="pl-c"><span class="pl-c">//</span>Handle WebSocket event</span>
}

<span class="pl-k">void</span><span class="pl-en">setup</span>(){
  Serial.<span class="pl-c1">begin</span>(<span class="pl-c1">115200</span>);
  WiFi.<span class="pl-c1">mode</span>(WIFI_STA);
  WiFi.<span class="pl-c1">begin</span>(ssid, password);
  <span class="pl-k">if</span> (WiFi.<span class="pl-c1">waitForConnectResult</span>() != WL_CONNECTED) {
    Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>WiFi Failed!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);
    <span class="pl-k">return</span>;
  }

  <span class="pl-c"><span class="pl-c">//</span> attach AsyncWebSocket</span>
  ws.<span class="pl-c1">onEvent</span>(onEvent);
  server.<span class="pl-c1">addHandler</span>(&amp;ws);

  <span class="pl-c"><span class="pl-c">//</span> attach AsyncEventSource</span>
  server.<span class="pl-c1">addHandler</span>(&amp;events);

  <span class="pl-c"><span class="pl-c">//</span> respond to GET requests on URL /heap</span>
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/heap<span class="pl-pds">"</span></span>, HTTP_GET, [](AsyncWebServerRequest *request){
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-c1">String</span>(ESP.<span class="pl-c1">getFreeHeap</span>()));
  });

  <span class="pl-c"><span class="pl-c">//</span> upload a file to /upload</span>
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/upload<span class="pl-pds">"</span></span>, HTTP_POST, [](AsyncWebServerRequest *request){
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>);
  }, onUpload);

  <span class="pl-c"><span class="pl-c">//</span> send a file when /index is requested</span>
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/index<span class="pl-pds">"</span></span>, HTTP_ANY, [](AsyncWebServerRequest *request){
    request-&gt;<span class="pl-c1">send</span>(SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/index.htm<span class="pl-pds">"</span></span>);
  });

  <span class="pl-c"><span class="pl-c">//</span> HTTP basic authentication</span>
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/login<span class="pl-pds">"</span></span>, HTTP_GET, [](AsyncWebServerRequest *request){
    <span class="pl-k">if</span>(!request-&gt;<span class="pl-c1">authenticate</span>(http_username, http_password))
        <span class="pl-k">return</span> request-&gt;<span class="pl-c1">requestAuthentication</span>();
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Login Success!<span class="pl-pds">"</span></span>);
  });

  <span class="pl-c"><span class="pl-c">//</span> Simple Firmware Update Form</span>
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/update<span class="pl-pds">"</span></span>, HTTP_GET, [](AsyncWebServerRequest *request){
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>&lt;form method='POST' action='/update' enctype='multipart/form-data'&gt;&lt;input type='file' name='update'&gt;&lt;input type='submit' value='Update'&gt;&lt;/form&gt;<span class="pl-pds">"</span></span>);
  });
  server.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/update<span class="pl-pds">"</span></span>, HTTP_POST, [](AsyncWebServerRequest *request){
    shouldReboot = !Update.<span class="pl-c1">hasError</span>();
    AsyncWebServerResponse *response = request-&gt;<span class="pl-c1">beginResponse</span>(<span class="pl-c1">200</span>, <span class="pl-s"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, shouldReboot?<span class="pl-s"><span class="pl-pds">"</span>OK<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>FAIL<span class="pl-pds">"</span></span>);
    response-&gt;<span class="pl-c1">addHeader</span>(<span class="pl-s"><span class="pl-pds">"</span>Connection<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>close<span class="pl-pds">"</span></span>);
    request-&gt;<span class="pl-c1">send</span>(response);
  },[](AsyncWebServerRequest *request, String filename, <span class="pl-c1">size_t</span><span class="pl-c1">index</span>, <span class="pl-c1">uint8_t</span> *data, <span class="pl-c1">size_t</span> len, <span class="pl-k">bool</span> final){
    <span class="pl-k">if</span>(!<span class="pl-c1">index</span>){
      Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Update Start: %s<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, filename.<span class="pl-c1">c_str</span>());
      Update.<span class="pl-c1">runAsync</span>(<span class="pl-c1">true</span>);
      <span class="pl-k">if</span>(!Update.<span class="pl-c1">begin</span>((ESP.<span class="pl-c1">getFreeSketchSpace</span>() - <span class="pl-c1">0x1000</span>) &amp; <span class="pl-c1">0xFFFFF000</span>)){
        Update.<span class="pl-c1">printError</span>(Serial);
      }
    }
    <span class="pl-k">if</span>(!Update.<span class="pl-c1">hasError</span>()){
      <span class="pl-k">if</span>(Update.<span class="pl-c1">write</span>(data, len) != len){
        Update.<span class="pl-c1">printError</span>(Serial);
      }
    }
    <span class="pl-k">if</span>(final){
      <span class="pl-k">if</span>(Update.<span class="pl-c1">end</span>(<span class="pl-c1">true</span>)){
        Serial.<span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Update Success: %uB<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-c1">index</span>+len);
      } <span class="pl-k">else</span> {
        Update.<span class="pl-c1">printError</span>(Serial);
      }
    }
  });

  <span class="pl-c"><span class="pl-c">//</span> attach filesystem root at URL /fs</span>
  server.<span class="pl-c1">serveStatic</span>(<span class="pl-s"><span class="pl-pds">"</span>/fs<span class="pl-pds">"</span></span>, SPIFFS, <span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span>);

  <span class="pl-c"><span class="pl-c">//</span> Catch-All Handlers</span><span class="pl-c"><span class="pl-c">//</span> Any request that can not find a Handler that canHandle it</span><span class="pl-c"><span class="pl-c">//</span> ends in the callbacks below.</span>
  server.<span class="pl-c1">onNotFound</span>(onRequest);
  server.<span class="pl-c1">onFileUpload</span>(onUpload);
  server.<span class="pl-c1">onRequestBody</span>(onBody);

  server.<span class="pl-c1">begin</span>();
}

<span class="pl-k">void</span><span class="pl-en">loop</span>(){
  <span class="pl-k">if</span>(shouldReboot){
    Serial.<span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">"</span>Rebooting...<span class="pl-pds">"</span></span>);
    <span class="pl-c1">delay</span>(<span class="pl-c1">100</span>);
    ESP.<span class="pl-c1">restart</span>();
  }
  <span class="pl-k">static</span><span class="pl-k">char</span> temp[<span class="pl-c1">128</span>];
  <span class="pl-c1">sprintf</span>(temp, <span class="pl-s"><span class="pl-pds">"</span>Seconds since boot: %u<span class="pl-pds">"</span></span>, <span class="pl-c1">millis</span>()/<span class="pl-c1">1000</span>);
  events.<span class="pl-c1">send</span>(temp, <span class="pl-s"><span class="pl-pds">"</span>time<span class="pl-pds">"</span></span>); <span class="pl-c"><span class="pl-c">//</span>send event "time"</span>
}</pre></div><h3><a id="user-content-setup-global-and-class-functions-as-request-handlers" class="anchor" aria-hidden="true" href="#setup-global-and-class-functions-as-request-handlers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup global and class functions as request handlers</h3><div class="highlight highlight-source-c++"><pre>#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">&lt;</span>Arduino.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">&lt;</span>ESPAsyncWebserver.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">&lt;</span>Hash.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">include</span><span class="pl-s"><span class="pl-pds">&lt;</span>functional<span class="pl-pds">&gt;</span></span><span class="pl-k">void</span><span class="pl-en">handleRequest</span>(AsyncWebServerRequest *request){}

<span class="pl-k">class</span><span class="pl-en">WebClass</span> {
public :
  AsyncWebServer classWebServer = AsyncWebServer(<span class="pl-c1">81</span>);

  <span class="pl-en">WebClass</span>(){};

  <span class="pl-k">void</span><span class="pl-en">classRequest</span> (AsyncWebServerRequest *request){}

  <span class="pl-k">void</span><span class="pl-en">begin</span>(){
    <span class="pl-c"><span class="pl-c">//</span> attach global request handler</span>
    classWebServer.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/example<span class="pl-pds">"</span></span>, HTTP_ANY, handleRequest);

    <span class="pl-c"><span class="pl-c">//</span> attach class request handler</span>
    classWebServer.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/example<span class="pl-pds">"</span></span>, HTTP_ANY, <span class="pl-c1">std::bind</span>(&amp;WebClass::classRequest, <span class="pl-c1">this</span>, std::placeholders::_1));
  }
};

AsyncWebServer <span class="pl-en">globalWebServer</span>(<span class="pl-c1">80</span>);
WebClass webClassInstance;

<span class="pl-k">void</span><span class="pl-en">setup</span>() {
  <span class="pl-c"><span class="pl-c">//</span> attach global request handler</span>
  globalWebServer.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/example<span class="pl-pds">"</span></span>, HTTP_ANY, handleRequest);

  <span class="pl-c"><span class="pl-c">//</span> attach class request handler</span>
  globalWebServer.<span class="pl-c1">on</span>(<span class="pl-s"><span class="pl-pds">"</span>/example<span class="pl-pds">"</span></span>, HTTP_ANY, <span class="pl-c1">std::bind</span>(&amp;WebClass::classRequest, webClassInstance, std::placeholders::_1));
}

<span class="pl-k">void</span><span class="pl-en">loop</span>() {

}</pre></div><h3><a id="user-content-methods-for-controlling-websocket-connections" class="anchor" aria-hidden="true" href="#methods-for-controlling-websocket-connections"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Methods for controlling websocket connections</h3><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> Disable client connections if it was activated</span><span class="pl-k">if</span> ( ws.enabled() )
    ws.enable(<span class="pl-c1">false</span>);

  <span class="pl-c"><span class="pl-c">//</span> enable client connections if it was disabled</span><span class="pl-k">if</span> ( !ws.enabled() )
    ws.enable(<span class="pl-c1">true</span>);</pre></div><p>Example of OTA code</p><div class="highlight highlight-source-c++"><pre><span class="pl-c"><span class="pl-c">//</span> OTA callbacks</span>
  ArduinoOTA.onStart([]() {
    <span class="pl-c"><span class="pl-c">//</span> Clean SPIFFS</span>
    SPIFFS.<span class="pl-c1">end</span>();

    <span class="pl-c"><span class="pl-c">//</span> Disable client connections    </span>
    ws.<span class="pl-c1">enable</span>(<span class="pl-c1">false</span>);

    <span class="pl-c"><span class="pl-c">//</span> Advertise connected clients what's going on</span>
    ws.<span class="pl-c1">textAll</span>(<span class="pl-s"><span class="pl-pds">"</span>OTA Update Started<span class="pl-pds">"</span></span>);

    <span class="pl-c"><span class="pl-c">//</span> Close them</span>
    ws.<span class="pl-c1">closeAll</span>();

  });
</pre></div><h3><a id="user-content-adding-default-headers" class="anchor" aria-hidden="true" href="#adding-default-headers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding Default Headers</h3><p>In some cases, such as when working with CORS, or with some sort of custom authentication system,
you might need to define a header that should get added to all responses (including static, websocket and EventSource).
The DefaultHeaders singleton allows you to do this.</p><p>Example:</p><div class="highlight highlight-source-c++"><pre><span class="pl-en">DefaultHeaders::Instance</span>().addHeader(<span class="pl-s"><span class="pl-pds">"</span>Access-Control-Allow-Origin<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span>);
webServer.begin();</pre></div><p><em>NOTE</em>: You will still need to respond to the OPTIONS method for CORS pre-flight in most cases. (unless you are only using GET)</p><p>This is one option:</p><div class="highlight highlight-source-c++"><pre>webServer.onNotFound([](AsyncWebServerRequest *request) {
  <span class="pl-k">if</span> (request-&gt;<span class="pl-c1">method</span>() == HTTP_OPTIONS) {
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">200</span>);
  } <span class="pl-k">else</span> {
    request-&gt;<span class="pl-c1">send</span>(<span class="pl-c1">404</span>);
  }
});</pre></div><h3><a id="user-content-path-variable" class="anchor" aria-hidden="true" href="#path-variable"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Path variable</h3><p>With path variable you can create a custom regex rule for a specific parameter in a route.
For example we want a <code>sensorId</code> parameter in a route rule to match only a integer.</p><div class="highlight highlight-source-c++"><pre>  server.on(<span class="pl-s"><span class="pl-pds">"</span>^<span class="pl-cce">\\</span>/sensor<span class="pl-cce">\\</span>/([0-9]+)$<span class="pl-pds">"</span></span>, HTTP_GET, [] (AsyncWebServerRequest *request) {
      String sensorId = request-&gt;<span class="pl-c1">pathArg</span>(<span class="pl-c1">0</span>);
  });</pre></div><p><em>NOTE</em>: All regex patterns starts with <code>^</code> and ends with <code>$</code></p><p>To enable the <code>Path variable</code> support, you have to define the buildflag <code>-DASYNCWEBSERVER_REGEX</code>.</p><p>For Arduino IDE create/update <code>platform.local.txt</code>:</p><p><code>Windows</code>: C:\Users(username)\AppData\Local\Arduino15\packages\<code>{espxxxx}</code>\hardware\<code>espxxxx</code>\<code>{version}</code>\platform.local.txt</p><p><code>Linux</code>: ~/.arduino15/packages/<code>{espxxxx}</code>/hardware/<code>{espxxxx}</code>/<code>{version}</code>/platform.local.txt</p><p>Add/Update the following line:</p><pre><code>  compiler.cpp.extra_flags=-DDASYNCWEBSERVER_REGEX
</code></pre><p>For platformio modify <code>platformio.ini</code>:</p><div class="highlight highlight-source-ini"><pre><span class="pl-en">[env:myboard]</span><span class="pl-k">build_flags</span> = 
  -DASYNCWEBSERVER_REGEX</pre></div><p><em>NOTE</em>: By enabling <code>ASYNCWEBSERVER_REGEX</code>, <code>&lt;regex&gt;</code> will be included. This will add an 100k to your binary.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>