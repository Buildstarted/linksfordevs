<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Brad Wilson: The &quot;Testable Object&quot; Pattern -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook" xmlns=""><div id="readInner" class="margin-medium size-medium"><h1>Brad Wilson: The "Testable Object" Pattern</h1><div><div class="entry-body" xmlns="http://www.w3.org/1999/xhtml"><p><i>This is a republished blog post from 2007. You can tell it's old because the tests were in NUnit instead of xUnit.net. :)</i></p><p>I've demonstrated this a few times in presentations, and someone will inevitably ask for more information. Truth is, I don't remember when I came up with it, or where I might've been inspired for it. I should say up front that I don't believe in mock object frameworks (because they encourage white-box protocols), and I don't believe in [SetUp] and [TearDown] (because they hide intention and force the use of fields in test fixtures, which should be strongly discouraged).</p></div><div class="entry-more" xmlns="http://www.w3.org/1999/xhtml"><p>An example I was giving yesterday was a user editor in Model-View-Presenter style (what Martin Fowler now calls <a href="https://web.archive.org/web/20081012054717/http://www.martinfowler.com/eaaDev/SupervisingPresenter.html">Supervising Presenter</a>). The user editor presenter needed to talk to two things: the view and the user service. We ended up with a presenter with a constructor signature like this:</p><pre class="brush:csharp">public class UserEditorPresenter
{
    public UserEditorPresenter(IUserEditorView view,
                               IUserService service)
    [...]
}</pre><p>Given my dislike of [SetUp] and [TearDown], that means that each test starts out with code like this:</p><pre class="brush:csharp">[Test]
public void MyTest()
{
    StubEditorView view = new StubEditorView();
    StubUserService service = new StubUserService();
    UserEditorPresenter presenter = new UserEditorPresenter(view, service);
}</pre><p>Interestingly, we started with just the view, and then later added the user service. When that happened, it meant we had to change all our tests. No fun.</p><p>Since I'm averse to [SetUp], I like this alternative instead:</p><pre class="brush:csharp">public class TestableUserEditorPresenter : UserEditorPresenter
{
    public StubEditorView View;
    public StubUserService Service;

    private TestableUserEditorPresenter(StubEditorView view,
                                        StubUserService service)
        : base(view, service)
    {
        View = view;
        Service = service;
    }

    public static TestableUserEditorPresenter Create()
    {
        return new TestableUserEditorPresenter(
            new StubEditorView(),
            new StubUserService()
        );
    }
}</pre><p>Now the tests become one-liner initialization:</p><pre class="brush:csharp">[Test]
public void MyTest()
{
    var presenter = TestableUserEditPresenter.Create();
}</pre><p>As the needs of the presenter grow, the tests don't need to be modified. It's easy to follow the Create link in your editor to see exactly what is happening during creation (instead of searching for the SetUp method).</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>