<!DOCTYPE html>
<html lang="en">
<head>
    <title>
CamSD.ino - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="CamSD.ino - linksfor.dev(s)"/>
    <meta property="article:author" content="262588213843476"/>
    <meta property="og:description" content="GitHub Gist: instantly share code, notes, and snippets."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://gist.github.com/wybiral/ff410907b9c79864c2499a0d238207b2"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - CamSD.ino</title>
<div class="readable">
        <h1>CamSD.ino</h1>
            <div>by 262588213843476</div>
            <div>Reading time: 4-5 minutes</div>
        <div>Posted here: 25 Feb 2020</div>
        <p><a href="https://gist.github.com/wybiral/ff410907b9c79864c2499a0d238207b2">https://gist.github.com/wybiral/ff410907b9c79864c2499a0d238207b2</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
  <div id="file-camsd-ino">
      
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-camsd-ino-L1" data-line-number="1"></td>
        <td id="file-camsd-ino-LC1">#<span>include</span> <span><span>&lt;</span>esp32cam.h<span>&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L2" data-line-number="2"></td>
        <td id="file-camsd-ino-LC2">
</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L3" data-line-number="3"></td>
        <td id="file-camsd-ino-LC3">#<span>include</span> <span><span>"</span>FS.h<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L4" data-line-number="4"></td>
        <td id="file-camsd-ino-LC4">#<span>include</span> <span><span>"</span>SD_MMC.h<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L5" data-line-number="5"></td>
        <td id="file-camsd-ino-LC5">#<span>include</span> <span><span>"</span>WiFi.h<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L6" data-line-number="6"></td>
        <td id="file-camsd-ino-LC6">
</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L7" data-line-number="7"></td>
        <td id="file-camsd-ino-LC7"><span><span>//</span> Current image number (per folder)</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L8" data-line-number="8"></td>
        <td id="file-camsd-ino-LC8"><span>uint32_t</span> image;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L9" data-line-number="9"></td>
        <td id="file-camsd-ino-LC9">
</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L10" data-line-number="10"></td>
        <td id="file-camsd-ino-LC10"><span><span>//</span> Current folder number</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L11" data-line-number="11"></td>
        <td id="file-camsd-ino-LC11"><span>uint32_t</span> folder;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L12" data-line-number="12"></td>
        <td id="file-camsd-ino-LC12">
</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L13" data-line-number="13"></td>
        <td id="file-camsd-ino-LC13"><span>void</span> <span>setup</span>() {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L14" data-line-number="14"></td>
        <td id="file-camsd-ino-LC14">  Serial.<span>begin</span>(<span>9600</span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L15" data-line-number="15"></td>
        <td id="file-camsd-ino-LC15">  <span><span>//</span> Stop WiFi/BLE</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L16" data-line-number="16"></td>
        <td id="file-camsd-ino-LC16">  WiFi.<span>mode</span>(WIFI_OFF);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L17" data-line-number="17"></td>
        <td id="file-camsd-ino-LC17">  <span>btStop</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L18" data-line-number="18"></td>
        <td id="file-camsd-ino-LC18">  <span><span>//</span> Setup Cam</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L19" data-line-number="19"></td>
        <td id="file-camsd-ino-LC19">  <span>auto</span> res = <span>esp32cam::Resolution::find</span>(<span>1024</span>, <span>768</span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L20" data-line-number="20"></td>
        <td id="file-camsd-ino-LC20">  esp32cam::Config cfg;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L21" data-line-number="21"></td>
        <td id="file-camsd-ino-LC21">  cfg.<span>setPins</span>(esp32cam::pins::AiThinker);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L22" data-line-number="22"></td>
        <td id="file-camsd-ino-LC22">  cfg.<span>setResolution</span>(res);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L23" data-line-number="23"></td>
        <td id="file-camsd-ino-LC23">  cfg.<span>setJpeg</span>(<span>80</span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L24" data-line-number="24"></td>
        <td id="file-camsd-ino-LC24">  esp32cam::Camera.<span>begin</span>(cfg);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L25" data-line-number="25"></td>
        <td id="file-camsd-ino-LC25">  <span><span>//</span> Setup SD</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L26" data-line-number="26"></td>
        <td id="file-camsd-ino-LC26">  Serial.<span>println</span>(<span><span>"</span>Starting SD Card<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L27" data-line-number="27"></td>
        <td id="file-camsd-ino-LC27">  <span>if</span> (!SD_MMC.<span>begin</span>()) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L28" data-line-number="28"></td>
        <td id="file-camsd-ino-LC28">    Serial.<span>println</span>(<span><span>"</span>SD Card Mount Failed<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L29" data-line-number="29"></td>
        <td id="file-camsd-ino-LC29">  } </td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L30" data-line-number="30"></td>
        <td id="file-camsd-ino-LC30">  <span>uint8_t</span> cardType = SD_MMC.<span>cardType</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L31" data-line-number="31"></td>
        <td id="file-camsd-ino-LC31">  <span>if</span> (cardType == CARD_NONE) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L32" data-line-number="32"></td>
        <td id="file-camsd-ino-LC32">    Serial.<span>println</span>(<span><span>"</span>No SD Card attached<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L33" data-line-number="33"></td>
        <td id="file-camsd-ino-LC33">  }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L34" data-line-number="34"></td>
        <td id="file-camsd-ino-LC34">  <span><span>//</span> Find next folder number by scanning root</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L35" data-line-number="35"></td>
        <td id="file-camsd-ino-LC35">  image = <span>0</span>;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L36" data-line-number="36"></td>
        <td id="file-camsd-ino-LC36">  folder = <span>0</span>;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L37" data-line-number="37"></td>
        <td id="file-camsd-ino-LC37">  File root = SD_MMC.<span>open</span>(<span><span>"</span>/<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L38" data-line-number="38"></td>
        <td id="file-camsd-ino-LC38">  File file = root.<span>openNextFile</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L39" data-line-number="39"></td>
        <td id="file-camsd-ino-LC39">  <span>while</span> (file) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L40" data-line-number="40"></td>
        <td id="file-camsd-ino-LC40">    <span>if</span> (file.<span>isDirectory</span>()) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L41" data-line-number="41"></td>
        <td id="file-camsd-ino-LC41">      String name = <span>String</span>(file.<span>name</span>());</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L42" data-line-number="42"></td>
        <td id="file-camsd-ino-LC42">      name = name.<span>substring</span>(<span>1</span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L43" data-line-number="43"></td>
        <td id="file-camsd-ino-LC43">      <span>long</span> n = name.<span>toInt</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L44" data-line-number="44"></td>
        <td id="file-camsd-ino-LC44">      <span>if</span> (n &gt; folder) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L45" data-line-number="45"></td>
        <td id="file-camsd-ino-LC45">        folder = n;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L46" data-line-number="46"></td>
        <td id="file-camsd-ino-LC46">      }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L47" data-line-number="47"></td>
        <td id="file-camsd-ino-LC47">    }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L48" data-line-number="48"></td>
        <td id="file-camsd-ino-LC48">    file = root.<span>openNextFile</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L49" data-line-number="49"></td>
        <td id="file-camsd-ino-LC49">  }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L50" data-line-number="50"></td>
        <td id="file-camsd-ino-LC50">  folder++;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L51" data-line-number="51"></td>
        <td id="file-camsd-ino-LC51">  SD_MMC.<span>mkdir</span>(<span><span>"</span>/<span>"</span></span> + <span>String</span>(folder));</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L52" data-line-number="52"></td>
        <td id="file-camsd-ino-LC52">  Serial.<span>println</span>(folder);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L53" data-line-number="53"></td>
        <td id="file-camsd-ino-LC53">}</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L54" data-line-number="54"></td>
        <td id="file-camsd-ino-LC54">
</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L55" data-line-number="55"></td>
        <td id="file-camsd-ino-LC55"><span>void</span> <span>loop</span>() {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L56" data-line-number="56"></td>
        <td id="file-camsd-ino-LC56">  <span><span>//</span> Capture</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L57" data-line-number="57"></td>
        <td id="file-camsd-ino-LC57">  Serial.<span>println</span>(<span><span>"</span>Capturing...<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L58" data-line-number="58"></td>
        <td id="file-camsd-ino-LC58">  <span>auto</span> img = <span>esp32cam::capture</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L59" data-line-number="59"></td>
        <td id="file-camsd-ino-LC59">  <span>if</span> (img == <span>nullptr</span>) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L60" data-line-number="60"></td>
        <td id="file-camsd-ino-LC60">    Serial.<span>println</span>(<span><span>"</span>Image capture failed<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L61" data-line-number="61"></td>
        <td id="file-camsd-ino-LC61">    <span>return</span>;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L62" data-line-number="62"></td>
        <td id="file-camsd-ino-LC62">  }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L63" data-line-number="63"></td>
        <td id="file-camsd-ino-LC63">  <span><span>//</span> Write to SD</span></td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L64" data-line-number="64"></td>
        <td id="file-camsd-ino-LC64">  String name = <span><span>"</span>/<span>"</span></span> + <span>String</span>(folder) + <span><span>"</span>/<span>"</span></span> + <span>String</span>(image) + <span><span>"</span>.jpg<span>"</span></span>;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L65" data-line-number="65"></td>
        <td id="file-camsd-ino-LC65">  File file = SD_MMC.<span>open</span>(name, FILE_WRITE);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L66" data-line-number="66"></td>
        <td id="file-camsd-ino-LC66">  <span>if</span> (!file) {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L67" data-line-number="67"></td>
        <td id="file-camsd-ino-LC67">    Serial.<span>println</span>(<span><span>"</span>Failed to open file<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L68" data-line-number="68"></td>
        <td id="file-camsd-ino-LC68">  } <span>else</span> {</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L69" data-line-number="69"></td>
        <td id="file-camsd-ino-LC69">    img-&gt;<span>writeTo</span>(file);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L70" data-line-number="70"></td>
        <td id="file-camsd-ino-LC70">  }</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L71" data-line-number="71"></td>
        <td id="file-camsd-ino-LC71">  image++;</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L72" data-line-number="72"></td>
        <td id="file-camsd-ino-LC72">  file.<span>close</span>();</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L73" data-line-number="73"></td>
        <td id="file-camsd-ino-LC73">  Serial.<span>println</span>(<span><span>"</span>Done<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L74" data-line-number="74"></td>
        <td id="file-camsd-ino-LC74">  <span>delay</span>(<span>1000</span>);</td>
      </tr>
      <tr>
        <td id="file-camsd-ino-L75" data-line-number="75"></td>
        <td id="file-camsd-ino-LC75">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>