<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Welcome to C# 9.0 | .NET Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Welcome to C# 9.0 | .NET Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Mads TorgersenC# Lead Designer, .NET TeamFollow"/>
    <meta property="og:description" content="C# 9.0 is taking shape, and I&#x2019;d like to share our thinking on some of the major features we&#x2019;re adding to this next version of the language. With every new version of C# we strive for greater clarity and simplicity in common coding scenarios,"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Welcome to C# 9.0 | .NET Blog</title>
<div class="readable">
        <h1>Welcome to C# 9.0 | .NET Blog</h1>
            <div>by Mads TorgersenC# Lead Designer, .NET TeamFollow</div>
            <div>Reading time: 15-18 minutes</div>
        <div>Posted here: 20 May 2020</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/">https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2019/02/DSC07122-3-150x150.jpg" width="58" height="58" alt="Mads Torgersen"></p><p>Mads</p></div></div></div><p>May 20th, 2020</p><p>C# 9.0 is taking shape, and I’d like to share our thinking on some of the major features we’re adding to this next version of the language.</p><p>With every new version of C# we strive for greater clarity and simplicity in common coding scenarios, and C# 9.0 is no exception. One particular focus this time is supporting terse and immutable representation of data shapes.</p><p>Let’s dive in!</p><p>Object initializers are pretty awesome. They give the client of a type a very flexible and readable format for creating an object, and they are especially great for nested object creation where a whole tree of objects is created in one go. Here’s a simple one:</p><pre><code><span><span>new</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Scott"</span></span><span><span>,</span></span><span><span>
    </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>Object initializers also free the type author from writing a lot of construction boilerplate – all they have to do is write some properties!</p><pre><code><span><span>public</span></span><span><span> </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> </span></span><span><span>set</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> </span></span><span><span>set</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>The one big limitation today is that the properties have to be <em>mutable</em> for object initializers to work: They function by first calling the object’s constructor (the default, parameterless one in this case) and then assigning to the property setters.</p><p>Init-only properties fix that! They introduce an <code><span>init</span></code> accessor that is a variant of the <code><span>set</span></code> accessor which can only be called during object initialization:</p><pre><code><span><span>public</span></span><span><span> </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>With this declaration, the client code above is still legal, but any subsequent assignment to the <code><span>FirstName</span></code> and <code><span>LastName</span></code> properties is an error.</p><h2 id="init-accessors-and-readonly-fields">Init accessors and readonly fields<a href="#init-accessors-and-readonly-fields"></a></h2><p>Because <code><span>init</span></code> accessors can only be called during initialization, they are allowed to mutate <code><span>readonly</span></code> fields of the enclosing class, just like you can in a constructor.</p><pre><code><span><span>public</span></span><span><span> </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>private</span></span><span><span> </span></span><span><span>readonly</span></span><span><span> </span></span><span><span>string</span></span><span><span> firstName</span></span><span><span>;</span></span><span><span>
    </span></span><span><span>private</span></span><span><span> </span></span><span><span>readonly</span></span><span><span> </span></span><span><span>string</span></span><span><span> lastName</span></span><span><span>;</span></span><span><span>
    
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> 
    </span></span><span><span>{</span></span><span><span> 
        </span></span><span><span>get</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> firstName</span></span><span><span>;</span></span><span><span> 
        init </span></span><span><span>=&gt;</span></span><span><span> firstName </span></span><span><span>=</span></span><span><span> </span></span><span><span>(</span></span><span><span>value</span></span><span><span> </span></span><span><span>??</span></span><span><span> </span></span><span><span>throw</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>ArgumentNullException</span></span><span><span>(</span></span><span><span>nameof</span></span><span><span>(</span></span><span><span>FirstName</span></span><span><span>)));</span></span><span><span>
    </span></span><span><span>}</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> 
    </span></span><span><span>{</span></span><span><span> 
        </span></span><span><span>get</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> lastName</span></span><span><span>;</span></span><span><span> 
        init </span></span><span><span>=&gt;</span></span><span><span> lastName </span></span><span><span>=</span></span><span><span> </span></span><span><span>(</span></span><span><span>value</span></span><span><span> </span></span><span><span>??</span></span><span><span> </span></span><span><span>throw</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>ArgumentNullException</span></span><span><span>(</span></span><span><span>nameof</span></span><span><span>(</span></span><span><span>LastName</span></span><span><span>)));</span></span><span><span>
    </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>Init-only properties are great if you want to make individual properties immutable. If you want the whole object to be immutable and behave like a value, then you should consider declaring it as a <em>record</em>:</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>The <code><span>data</span></code> keyword on the class declaration marks it as a record. This imbues it with several additional value-like behaviors, which we’ll dig into in the following. Generally speaking, records are meant to be seen more as “values” – data! – and less as objects. They aren’t meant to have mutable encapsulated state. Instead you represent change over time by creating new records representing the new state. They are defined not by their identity, but by their contents.</p><h2 id="with-expressions">With-expressions<a href="#with-expressions"></a></h2><p>When working with immutable data, a common pattern is to create new values from existing ones to represent a new state. For instance, if our person were to change their last name we would represent it as a new object that’s a copy of the old one, except with a different last name. This technique is often referred to as <em>non-destructive mutation</em>. Instead of representing the person <em>over time</em>, the record represents the person’s state <em>at a given time</em>.</p><p>To help with this style of programming, records allow for a new kind of expression; the <code><span>with</span></code>-expression:</p><pre><code><span><span>var</span></span><span><span> otherPerson </span></span><span><span>=</span></span><span><span> person </span></span><span><span>with</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hanselman"</span></span><span><span> </span></span><span><span>};</span></span></code></pre><p>With-expressions use object initializer syntax to state what’s different in the new object from the old object. You can specify multiple properties.</p><p>A record implicitly defines a <code><span>protected</span></code> “copy constructor” – a constructor that takes an existing record object and copies it field by field to the new one:</p><pre><code><span><span>protected</span></span><span><span> </span></span><span><span>Person</span></span><span><span>(</span></span><span><span>Person</span></span><span><span> original</span></span><span><span>)</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>/* copy all the fields */</span></span><span><span> </span></span><span><span>}</span></span><span><span> </span></span><span><span>// generated</span></span></code></pre><p>The <code><span>with</span></code> expression causes the copy constructor to get called, and then applies the object initializer on top to change the properties accordingly.</p><p>If you don’t like the default behavior of the generated copy constructor you can define your own instead, and that will be picked up by the <code><span>with</span></code> expression.</p><h2 id="value-based-equality">Value-based equality<a href="#value-based-equality"></a></h2><p>All objects inherit a virtual <code><span>Equals</span><span>(</span><span>object</span><span>)</span></code> method from the <code><span>object</span></code> class. This is used as the basis for the <code><span>Object</span><span>.</span><span>Equals</span><span>(</span><span>object</span><span>,</span><span> </span><span>object</span><span>)</span></code> static method when both parameters are non-null.</p><p>Structs override this to have “value-based equality”, comparing each field of the struct by calling <code><span>Equals</span></code> on them recursively. Records do the same.</p><p>This means that in accordance with their “value-ness” two record objects can be equal to one another without being the <em>same</em> object. For instance if we modify the last name of the modified person back again:</p><pre><code><span><span>var</span></span><span><span> originalPerson </span></span><span><span>=</span></span><span><span> otherPerson </span></span><span><span>with</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span> </span></span><span><span>};</span></span></code></pre><p>We would now have <code><span>ReferenceEquals</span><span>(</span><span>person</span><span>,</span><span> originalPerson</span><span>)</span></code> = false (they aren’t the same object) but <code><span>Equals</span><span>(</span><span>person</span><span>,</span><span> originalPerson</span><span>)</span></code> = true (they have the same value).</p><p>If you don’t like the default field-by-field comparison behavior of the generated <code><span>Equals</span></code> override, you can write your own instead. You just need to be careful that you understand how value-based equality works in records, especially when inheritance is involved, which we’ll come back to below.</p><p>Along with the value-based <code><span>Equals</span></code> there’s also a value-based <code><span>GetHashCode</span><span>()</span></code> override to go along with it.</p><h2 id="data-members">Data members<a href="#data-members"></a></h2><p>Records are overwhelmingly intended to be immutable, with init-only public properties that can be non-destructively modified through <code><span>with</span></code>-expressions. In order to optimize for that common case, records change the defaults of what a simple member declaration of the form <code><span>string</span><span> </span><span>FirstName</span></code> means. Instead of an implicitly private field, as in other class and struct declarations, in records this is taken to be shorthand for a public, init-only auto-property! Thus, the declaration:</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span>;</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span></code></pre><p>Means exactly the same as the one we had before:</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>get</span></span><span><span>;</span></span><span><span> init</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>We think this makes for beautiful and clear record declarations. If you really want a private field, you can just add the <code><span>private</span></code> modifier explicitly:</p><pre><code><span><span>private</span></span><span><span> </span></span><span><span>string</span></span><span><span> firstName</span></span><span><span>;</span></span></code></pre><h2 id="positional-records">Positional records<a href="#positional-records"></a></h2><p>Sometimes it’s useful to have a more positional approach to a record, where its contents are given via constructor arguments, and can be extracted with positional deconstruction.</p><p>It’s perfectly possible to specify your own constructor and deconstructor in a record:</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span> 
</span></span><span><span>{</span></span><span><span> 
    </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span>;</span></span><span><span> 
    </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>;</span></span><span><span> 
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>Person</span></span><span><span>(</span></span><span><span>string</span></span><span><span> firstName</span></span><span><span>,</span></span><span><span> </span></span><span><span>string</span></span><span><span> lastName</span></span><span><span>)</span></span><span><span> 
      </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>(</span></span><span><span>FirstName</span></span><span><span>,</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>)</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>(</span></span><span><span>firstName</span></span><span><span>,</span></span><span><span> lastName</span></span><span><span>);</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>void</span></span><span><span> </span></span><span><span>Deconstruct</span></span><span><span>(</span></span><span><span>out</span></span><span><span> </span></span><span><span>string</span></span><span><span> firstName</span></span><span><span>,</span></span><span><span> </span></span><span><span>out</span></span><span><span> </span></span><span><span>string</span></span><span><span> lastName</span></span><span><span>)</span></span><span><span> 
      </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>(</span></span><span><span>firstName</span></span><span><span>,</span></span><span><span> lastName</span></span><span><span>)</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>(</span></span><span><span>FirstName</span></span><span><span>,</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>);</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>But there’s a much shorter syntax for expressing exactly the same thing (modulo casing of parameter names):</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span>(</span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span>,</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>);</span></span></code></pre><p>This declares the public init-only auto-properties <em>and</em> the constructor <em>and</em> the deconstructor, so that you can write:</p><pre><code><span><span>var</span></span><span><span> person </span></span><span><span>=</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>Person</span></span><span><span>(</span></span><span><span>"Scott"</span></span><span><span>,</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span>);</span></span><span><span> </span></span><span><span>// positional construction</span></span><span><span>
</span></span><span><span>var</span></span><span><span> </span></span><span><span>(</span></span><span><span>f</span></span><span><span>,</span></span><span><span> l</span></span><span><span>)</span></span><span><span> </span></span><span><span>=</span></span><span><span> person</span></span><span><span>;</span></span><span><span>                        </span></span><span><span>// positional deconstruction</span></span></code></pre><p>If you don’t like the generated auto-property you can define your own property of the same name instead, and the generated constructor and deconstructor will just use that one.</p><h2 id="records-and-mutation">Records and mutation<a href="#records-and-mutation"></a></h2><p>The value-based semantics of a record don’t gel well with mutable state. Imagine putting a record object into a dictionary. Finding it again depends on <code><span>Equals</span></code> and (sometimes) <code><span>GethashCode</span></code>. But if the record changes its state, it will also change what it’s equal to! We might not be able to find it again! In a hash table implementation it might even corrupt the data structure, since placement is based on the hash code it has “on arrival”!</p><p>There are probably some valid advanced uses of mutable state inside of records, notably for caching. But the manual work involved in overriding the default behaviors to ignore such state is likely to be considerable.</p><h2 id="with-expressions-and-inheritance">With-expressions and inheritance<a href="#with-expressions-and-inheritance"></a></h2><p>Value-based equality and non-destructive mutation are notoriously challenging when combined with inheritance. Let’s add a derived record class <code><span>Student</span></code> to our running example:</p><pre><code><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Person</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span>;</span></span><span><span> </span></span><span><span>string</span></span><span><span> </span></span><span><span>LastName</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span><span><span>
</span></span><span><span>public</span></span><span><span> data </span></span><span><span>class</span></span><span><span> </span></span><span><span>Student</span></span><span><span> </span></span><span><span>:</span></span><span><span> </span></span><span><span>Person</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>int</span></span><span><span> ID</span></span><span><span>;</span></span><span><span> </span></span><span><span>}</span></span></code></pre><p>And let’s start our <code><span>with</span></code>-expression example by actually creating a <code><span>Student</span></code>, but storing it in a <code><span>Person</span></code> variable:</p><pre><code><span><span>Person</span></span><span><span> person </span></span><span><span>=</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>Student</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Scott"</span></span><span><span>,</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span>,</span></span><span><span> ID </span></span><span><span>=</span></span><span><span> </span></span><span><span>GetNewId</span></span><span><span>()</span></span><span><span> </span></span><span><span>};</span></span><span><span>
otherPerson </span></span><span><span>=</span></span><span><span> person </span></span><span><span>with</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hanselman"</span></span><span><span> </span></span><span><span>};</span></span></code></pre><p>At the point of that <code><span>with</span></code>-expression on the last line the compiler has no idea that <code><span>person</span></code> actually contains a <code><span>Student</span></code>. Yet, the new person wouldn’t be a proper copy if it wasn’t <em>actually</em> a <code><span>Student</span></code> object, complete with the same <code><span>ID</span></code> as the first one copied over.</p><p>C# makes this work. Records have a hidden virtual method that is entrusted with “cloning” the <em>whole</em> object. Every derived record type overrides this method to call the copy constructor of that type, and the copy constructor of a derived record chains to the copy constructor of the base record. A <code><span>with</span></code>-expression simply calls the hidden “clone” method and applies the object initializer to the result.</p><h2 id="value-based-equality-and-inheritance">Value-based equality and inheritance<a href="#value-based-equality-and-inheritance"></a></h2><p>Similarly to the <code><span>with</span></code>-expression support, value-based equality also has to be “virtual”, in the sense that <code><span>Student</span></code>s need to compare all the <code><span>Student</span></code> fields, even if the statically known type at the point of comparison is a base type like <code><span>Person</span></code>. That is easily achieved by overriding the already virtual <code><span>Equals</span></code> method.</p><p>However, there is an additional challenge with equality: What if you compare two <em>different</em> kinds of <code><span>Person</span></code>? We can’t really just let one of them decide which equality to apply: Equality is supposed to be symmetric, so the result should be the same regardless of which of the two objects come first. In other words, they have to <em>agree</em> on the equality being applied!</p><p>An example to illustrate the problem:</p><pre><code><span><span>Person</span></span><span><span> person1 </span></span><span><span>=</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>Person</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Scott"</span></span><span><span>,</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span> </span></span><span><span>};</span></span><span><span>
</span></span><span><span>Person</span></span><span><span> person2 </span></span><span><span>=</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>Student</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>FirstName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Scott"</span></span><span><span>,</span></span><span><span> </span></span><span><span>LastName</span></span><span><span> </span></span><span><span>=</span></span><span><span> </span></span><span><span>"Hunter"</span></span><span><span>,</span></span><span><span> ID </span></span><span><span>=</span></span><span><span> </span></span><span><span>GetNewId</span></span><span><span>()</span></span><span><span> </span></span><span><span>};</span></span></code></pre><p>Are the two objects equal to one another? <code><span>person1</span></code> might think so, since <code><span>person2</span></code> has all the <code><span>Person</span></code> things right, but <code><span>person2</span></code> would beg to differ! We need to make sure that they both agree that they are different objects.</p><p>Once again, C# takes care of this for you automatically. The way it’s done is that records have a virtual protected property called <code><span>EqualityContract</span></code>. Every derived record overrides it, and in order to compare equal, the two objects musts have the same <code><span>EqualityContract</span></code>.</p><p>Writing a simple program in C# requires a remarkable amount of boilerplate code:</p><pre><code><span><span>using</span></span><span><span> </span></span><span><span>System</span></span><span><span>;</span></span><span><span>
</span></span><span><span>class</span></span><span><span> </span></span><span><span>Program</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>static</span></span><span><span> </span></span><span><span>void</span></span><span><span> </span></span><span><span>Main</span></span><span><span>()</span></span><span><span>
    </span></span><span><span>{</span></span><span><span>
        </span></span><span><span>Console</span></span><span><span>.</span></span><span><span>WriteLine</span></span><span><span>(</span></span><span><span>"Hello World!"</span></span><span><span>);</span></span><span><span>
    </span></span><span><span>}</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>This is not only overwhelming for language beginners, but clutters up the code and adds levels of indentation.</p><p>In C# 9.0 you can just choose to write your main program at the top level instead:</p><pre><code><span><span>using</span></span><span><span> </span></span><span><span>System</span></span><span><span>;</span></span><span><span>

</span></span><span><span>Console</span></span><span><span>.</span></span><span><span>WriteLine</span></span><span><span>(</span></span><span><span>"Hello World!"</span></span><span><span>);</span></span></code></pre><p>Any statement is allowed. The program has to occur after the <code><span>using</span></code>s and before any type or namespace declarations in the file, and you can only do this in one file, just as you can have only one <code><span>Main</span></code> method today.</p><p>If you want to return a status code you can do that. If you want to <code><span>await</span></code> things you can do that. And if you want to access command line arguments, <code><span>args</span></code> is available as a “magic” parameter.</p><p>Local functions are a form of statement and are also allowed in the top level program. It is an error to call them from anywhere outside of the top level statement section.</p><p>Several new kinds of patterns have been added in C# 9.0. Let’s look at them in the context of this code snippet from the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/tutorials/pattern-matching" target="_blank">pattern matching tutorial</a>:</p><pre><code><span><span>public</span></span><span><span> </span></span><span><span>static</span></span><span><span> </span></span><span><span>decimal</span></span><span><span> </span></span><span><span>CalculateToll</span></span><span><span>(</span></span><span><span>object</span></span><span><span> vehicle</span></span><span><span>)</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span>
    vehicle </span></span><span><span>switch</span></span><span><span>
    </span></span><span><span>{</span></span><span><span>
       </span></span><span><span>...</span></span><span><span>
       
        </span></span><span><span>DeliveryTruck</span></span><span><span> t </span></span><span><span>when</span></span><span><span> t</span></span><span><span>.</span></span><span><span>GrossWeightClass</span></span><span><span> </span></span><span><span>&gt;</span></span><span><span> </span></span><span><span>5000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>+</span></span><span><span> </span></span><span><span>5.00m</span></span><span><span>,</span></span><span><span>
        </span></span><span><span>DeliveryTruck</span></span><span><span> t </span></span><span><span>when</span></span><span><span> t</span></span><span><span>.</span></span><span><span>GrossWeightClass</span></span><span><span> </span></span><span><span>&lt;</span></span><span><span> </span></span><span><span>3000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>-</span></span><span><span> </span></span><span><span>2.00m</span></span><span><span>,</span></span><span><span>
        </span></span><span><span>DeliveryTruck</span></span><span><span> _ </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span>,</span></span><span><span>

        _ </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>throw</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>ArgumentException</span></span><span><span>(</span></span><span><span>"Not a known vehicle type"</span></span><span><span>,</span></span><span><span> nameof</span></span><span><span>(</span></span><span><span>vehicle</span></span><span><span>))</span></span><span><span>
    </span></span><span><span>};</span></span><span>
</span></code></pre><h2 id="simple-type-patterns">Simple type patterns<a href="#simple-type-patterns"></a></h2><p>Currently, a type pattern needs to declare an identifier when the type matches – even if that identifier is a discard <code><span>_</span></code>, as in <code><span>DeliveryTruck</span><span> _</span></code> above. But now you can just write the type:</p><pre><code><span><span>DeliveryTruck</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span>,</span></span></code></pre><h2 id="relational-patterns">Relational patterns<a href="#relational-patterns"></a></h2><p>C# 9.0 introduces patterns corresponding to the relational operators <code><span>&lt;</span></code>, <code><span>&lt;=</span></code> and so on. So you can now write the <code><span>DeliveryTruck</span></code> part of the above pattern as a nested switch expression:</p><pre><code><span><span>DeliveryTruck</span></span><span><span> t </span></span><span><span>when</span></span><span><span> t</span></span><span><span>.</span></span><span><span>GrossWeightClass</span></span><span><span> </span></span><span><span>switch</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>&gt;</span></span><span><span> </span></span><span><span>5000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>+</span></span><span><span> </span></span><span><span>5.00m</span></span><span><span>,</span></span><span><span>
    </span></span><span><span>&lt;</span></span><span><span> </span></span><span><span>3000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>-</span></span><span><span> </span></span><span><span>2.00m</span></span><span><span>,</span></span><span><span>
    _ </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span>,</span></span><span><span>
</span></span><span><span>},</span></span></code></pre><p>Here <code><span>&gt;</span><span> </span><span>5000</span></code> and <code><span>&lt; 3000</span></code> are relational patterns.</p><h2 id="logical-patterns">Logical patterns<a href="#logical-patterns"></a></h2><p>Finally you can combine patterns with logical operators <code><span>and</span></code>, <code><span>or</span></code> and <code><span>not</span></code>, spelled out as words to avoid confusion with the operators used in expressions. For instance, the cases of the nested switch above could be put into ascending order like this:</p><pre><code><span><span>DeliveryTruck</span></span><span><span> t </span></span><span><span>when</span></span><span><span> t</span></span><span><span>.</span></span><span><span>GrossWeightClass</span></span><span><span> </span></span><span><span>switch</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>&lt;</span></span><span><span> </span></span><span><span>3000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>-</span></span><span><span> </span></span><span><span>2.00m</span></span><span><span>,</span></span><span><span>
    </span></span><span><span>&gt;=</span></span><span><span> </span></span><span><span>3000</span></span><span><span> </span></span><span><span>and</span></span><span><span> </span></span><span><span>&lt;=</span></span><span><span> </span></span><span><span>5000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span>,</span></span><span><span>
    </span></span><span><span>&gt;</span></span><span><span> </span></span><span><span>5000</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>10.00m</span></span><span><span> </span></span><span><span>+</span></span><span><span> </span></span><span><span>5.00m</span></span><span><span>,</span></span><span><span>
</span></span><span><span>},</span></span></code></pre><p>The middle case there uses <code><span>and</span></code> to combine two relational patterns and form a pattern representing an interval.</p><p>A common use of the <code><span>not</span></code> pattern will be applying it to the <code><span>null</span></code> constant pattern, as in <code><span>not</span><span> </span><span>null</span></code>. For instance we can split the handling of unknown cases depending on whether they are null:</p><pre><code><span><span>not</span></span><span><span> </span></span><span><span>null</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>throw</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>ArgumentException</span></span><span><span>(</span></span><span><span>$</span></span><span><span>"Not a known vehicle type: {vehicle}"</span></span><span><span>,</span></span><span><span> nameof</span></span><span><span>(</span></span><span><span>vehicle</span></span><span><span>)),</span></span><span><span>
</span></span><span><span>null</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>throw</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>ArgumentNullException</span></span><span><span>(</span></span><span><span>nameof</span></span><span><span>(</span></span><span><span>vehicle</span></span><span><span>))</span></span></code></pre><p>Also <code><span>not</span></code> is going to be convenient in if-conditions containing is-expressions where, instead of unwieldy double parentheses:</p><pre><code><span><span>if</span></span><span><span> </span></span><span><span>(!(</span></span><span><span>e </span></span><span><span>is</span></span><span><span> </span></span><span><span>Customer</span></span><span><span>))</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>...</span></span><span><span> </span></span><span><span>}</span></span></code></pre><p>You can just say</p><pre><code><span><span>if</span></span><span><span> </span></span><span><span>(</span></span><span><span>e </span></span><span><span>is</span></span><span><span> </span></span><span><span>not</span></span><span><span> </span></span><span><span>Customer</span></span><span><span>)</span></span><span><span> </span></span><span><span>{</span></span><span><span> </span></span><span><span>...</span></span><span><span> </span></span><span><span>}</span></span></code></pre><p>“Target typing” is a term we use for when an expression gets its type from the context of where it’s being used. For instance <code><span>null</span></code> and lambda expressions are always target typed.</p><p>In C# 9.0 some expressions that weren’t previously target typed become able to be guided by their context.</p><h2 id="target-typed-new-expressions">Target-typed <code><span>new</span></code> expressions<a href="#target-typed-new-expressions"></a></h2><p><code><span>new</span></code> expressions in C# have always required a type to be specified (except for implicitly typed array expressions). Now you can leave out the type if there’s a clear type that the expressions is being assigned to.</p><pre><code><span><span>Point</span></span><span><span> p </span></span><span><span>=</span></span><span><span> </span></span><span><span>new</span></span><span><span> </span></span><span><span>(</span></span><span><span>3</span></span><span><span>,</span></span><span><span> </span></span><span><span>5</span></span><span><span>);</span></span></code></pre><h2 id="target-typed--and-">Target typed <code><span>??</span></code> and <code><span>?:</span></code><a href="#target-typed--and-"></a></h2><p>Sometimes conditional <code><span>??</span></code> and <code><span>?:</span></code> expressions don’t have an obvious shared type between the branches. Such cases fail today, but C# 9.0 will allow them if there’s a target type that both branches convert to:</p><pre><code><span><span>Person</span></span><span><span> person </span></span><span><span>=</span></span><span><span> student </span></span><span><span>??</span></span><span><span> customer</span></span><span><span>;</span></span><span><span> </span></span><span><span>// Shared base type</span></span><span><span>
</span></span><span><span>int</span></span><span><span>?</span></span><span><span> result </span></span><span><span>=</span></span><span><span> b </span></span><span><span>?</span></span><span><span> </span></span><span><span>0</span></span><span><span> </span></span><span><span>:</span></span><span><span> </span></span><span><span>null</span></span><span><span>;</span></span><span><span> </span></span><span><span>// nullable value type</span></span></code></pre><p>It’s sometimes useful to express that a method override in a derived class has a more specific return type than the declaration in the base type. C# 9.0 allows that:</p><pre><code><span><span>abstract</span></span><span><span> </span></span><span><span>class</span></span><span><span> </span></span><span><span>Animal</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>abstract</span></span><span><span> </span></span><span><span>Food</span></span><span><span> </span></span><span><span>GetFood</span></span><span><span>();</span></span><span><span>
    </span></span><span><span>...</span></span><span><span>
</span></span><span><span>}</span></span><span><span>
</span></span><span><span>class</span></span><span><span> </span></span><span><span>Tiger</span></span><span><span> </span></span><span><span>:</span></span><span><span> </span></span><span><span>Animal</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span>public</span></span><span><span> </span></span><span><span>override</span></span><span><span> </span></span><span><span>Meat</span></span><span><span> </span></span><span><span>GetFood</span></span><span><span>()</span></span><span><span> </span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span>...;</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>The best place to check out the full set of upcoming features for C# 9.0 and follow their completion is the <a href="https://github.com/dotnet/roslyn/blob/master/docs/Language%20Feature%20Status.md" target="_blank">Language Feature Status</a> on the Roslyn (C#/VB Compiler) GitHub repo.</p><p>Happy Hacking!</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>