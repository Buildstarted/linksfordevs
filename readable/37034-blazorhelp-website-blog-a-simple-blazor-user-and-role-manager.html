<!DOCTYPE html>
<html lang="en">
<head>
    <title>
BlazorHelp Website &gt; Blog - A Simple Blazor User and Role Manager -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>BlazorHelp Website &gt; Blog - A Simple Blazor User and Role Manager</h1><div><div class="BlogBody"><acronym class="BlogPublished" title="9/22/2019 3:02 PM"><span class="BlogPubMonth"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryMonth">Sep</span></span><span class="BlogPubDate"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryDay">22</span></span></acronym><p class="BlogSubHead"><span class="blog_author"><span id="dnn_ctr382_MainView_ViewEntry_lblPostedBy">Written by:</span><span id="dnn_ctr382_MainView_ViewEntry_lblUserID">Michael Washington</span></span><br><span id="dnn_ctr382_MainView_ViewEntry_lblDateTime" class="BlogDate">9/22/2019 3:02 PM</span>&nbsp;
  <a id="dnn_ctr382_MainView_ViewEntry_lnkRss" href="http://blazorhelpwebsite.com/Blog/tabid/61/rssid/1/Default.aspx" target="_blank"><img id="dnn_ctr382_MainView_ViewEntry_lnkRssIcon" src="/desktopmodules/Blog/Images/feed-icon-12x12.gif" alt="RssIcon"></a></p><p><img src="/images/BlazorUserAdmin.gif"></p><p>You can create a simple <strong>administration page</strong> to allow you to <strong>create</strong>, <strong>update</strong>, and <strong>delete</strong> users in your <strong>server side Blazor application</strong> by adding a single <strong>.razor</strong> page. This example also demonstrates how to <strong>update the passwords</strong> for your users.</p><p>It does this by programmatically creating an <em>Administrator</em> role in the <strong>Microsoft ASP.NET Core Identity membership</strong> and programmatically providing administrator access to a designated user (by placing them in the <strong>Administrators</strong> role). </p><h1>The Application</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_4a63e986-0f83-4204-be18-b1414ced40d7.png" width="132" height="51"></p><p>When you run the application for the first time, you will need to click the <strong>Register</strong> link and create an account called <strong>Admin@BlazorHelpWebsite.com</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_3a6a8b23-a51a-427d-9a8b-b6b9b9a84248.png" width="508" height="317"></p><p>The <strong>Entity Framework Core</strong><em>migrations</em> will run (to create the database)…</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_04760ae8-6cc3-4fbe-8c83-4cc9ee63091b.png" width="412" height="467"></p><p>…and you will then be able to <strong>log into</strong> the application with that account.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_df84e83e-8129-40fc-afdb-d88b3d79bec5.png" width="623" height="332"></p><p>The application is coded to <em>programmatically</em> add that account to the <strong>Administrators</strong> role if the user navigates to the <strong>Administration page</strong> and they are not an <strong>Administrator</strong>…</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_8b96087f-1750-4957-bdd6-c5236393d980.png" width="323" height="66"></p><p>…but to have the application recognize this, you will have to <strong>log out</strong> and <strong>log back in</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_fe7dc22f-283f-404e-a94f-062d5e765e60.png" width="673" height="283"></p><p>When you <strong>log back in</strong>, you will be able to navigate to the <strong>Administration</strong> page and see the <strong>User Administration</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_f2969c1e-fbf8-4fb2-b4df-5643e99a876d.png" width="594" height="349"></p><p>Clicking the <strong>Edit</strong> button next to an existing user allows you to update the <strong>email address</strong> of the user, their <strong>password</strong> (the password will only update if you actually make a change), and their <strong>Role</strong> (either <strong>Users</strong> or <strong>Administrators</strong> – <strong>Note:</strong> only users in the <strong>Administrators</strong> role can access the <strong>Administration</strong> page).</p><p>You can either press <strong>Save</strong> to <em>update</em> the user, or <strong>Delete</strong> to <em>remove</em> the user from the application.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_b1a7a532-ebfd-4aba-b98c-d98f12fb72c2.png" width="566" height="187"></p><p>The <strong>Add User</strong> button allows you to <em>create</em> a new user.</p><h1>Create The Application</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_12c28ffd-dc9d-4f6e-8b7d-9103397998e1.png" width="87" height="99"></p><p>Using <strong>Visual Studio 2019</strong> (or higher), create a <strong>Blazor server side</strong> application. </p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_637c9382-8759-4c4e-8689-7f90d69acfe1.png" width="694" height="239"></p><p>Change the <strong>Authentication</strong>…</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_6f2c15ba-fa05-48b6-8416-1ea1220dbd00.png" width="700" height="275"></p><p>… and select <strong>Individual User Accounts</strong>. </p><p>Click <strong>OK</strong> and complete the process to create the application.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_bc533491-ed60-4b63-adad-f564919ce02d.png" width="267" height="364"></p><p>When the application opens in <strong>Visual Studio</strong>, to add support for <strong>Roles</strong>, open the <strong>Startup.cs</strong> file, and change the following code:</p><pre><pre>            services.AddDefaultIdentity&lt;IdentityUser&gt;()
</pre><pre>                .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;();</pre></pre><p>to:</p><pre><pre>            services.AddDefaultIdentity&lt;IdentityUser&gt;()
</pre><pre><span>.AddRoles&lt;IdentityRole&gt;()</span></pre><pre>                .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;();</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_bfec92d4-eac7-49ff-879c-757b1ee8bb70.png" width="263" height="467"></p><p>Add a new page to the project (and a link to it in the navigation menu – see: <a href="/Blog/tabid/61/EntryId/4318/Creating-A-Step-By-Step-End-To-End-Database-Server-Side-Blazor-Application.aspx">Creating A Step-By-Step End-To-End Database Server-Side Blazor Application</a> for help doing this), called <strong>Administration.razor</strong> using the following code:</p><pre><pre>@page "/administration"
</pre><pre>@using Microsoft.AspNetCore.Authorization;
</pre><pre>@using Microsoft.AspNetCore.Identity;
</pre><pre>@inject UserManager<span>&lt;</span><span>IdentityUser</span><span>&gt;</span> _UserManager
</pre><pre>@inject RoleManager<span>&lt;</span><span>IdentityRole</span><span>&gt;</span> _RoleManager
</pre><pre>@inject AuthenticationStateProvider AuthenticationStateProvider
</pre><pre></pre><pre><span>&lt;</span><span>h3</span><span>&gt;</span>Administration<span>&lt;/</span><span>h3</span><span>&gt;</span></pre><pre><span>&lt;</span><span>AuthorizeView</span><span>&gt;</span></pre><pre><span>&lt;</span><span>Authorized</span><span>&gt;</span></pre><pre>        @if (@context.User.IsInRole(ADMINISTRATION_ROLE))
</pre><pre>        {
</pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>You are in @ADMINISTRATION_ROLE <span>&lt;/</span><span>p</span><span>&gt;</span></pre><pre>        }
</pre><pre>        else
</pre><pre>        {
</pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>You're not signed in as a user in @ADMINISTRATION_ROLE.<span>&lt;/</span><span>p</span><span>&gt;</span></pre><pre>        }
</pre><pre><span>&lt;/</span><span>Authorized</span><span>&gt;</span></pre><pre><span>&lt;</span><span>NotAuthorized</span><span>&gt;</span></pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>You're not loggged in.<span>&lt;/</span><span>p</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>NotAuthorized</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>AuthorizeView</span><span>&gt;</span></pre></pre><pre><pre>@code {
</pre><pre>    [CascadingParameter]
</pre><pre><span>private</span> Task&lt;AuthenticationState&gt; authenticationStateTask { <span>get</span>; <span>set</span>; }
</pre><pre></pre><pre><span>string</span> ADMINISTRATION_ROLE = "<span>Administrators</span>";
</pre><pre>    System.Security.Claims.ClaimsPrincipal CurrentUser;
</pre><pre></pre><pre><span>protected</span><span>override</span> async Task OnInitializedAsync()
</pre><pre>    {
</pre><pre><span>// ensure there is a ADMINISTRATION_ROLE</span></pre><pre>        var RoleResult = await _RoleManager.FindByNameAsync(ADMINISTRATION_ROLE);
</pre><pre><span>if</span> (RoleResult == <span>null</span>)
</pre><pre>        {
</pre><pre><span>// Create ADMINISTRATION_ROLE Role</span></pre><pre>            await _RoleManager.CreateAsync(<span>new</span> IdentityRole(ADMINISTRATION_ROLE));
</pre><pre>        }
</pre><pre></pre><pre><span>// Ensure a user named Admin@BlazorHelpWebsite.com is an Administrator</span></pre><pre>        var user = await _UserManager.FindByNameAsync("<span>Admin@BlazorHelpWebsite.com</span>");
</pre><pre><span>if</span> (user != <span>null</span>)
</pre><pre>        {
</pre><pre><span>// Is Admin@BlazorHelpWebsite.com in administrator role?</span></pre><pre>            var UserResult = await _UserManager.IsInRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre><span>if</span> (!UserResult)
</pre><pre>            {
</pre><pre><span>// Put admin in Administrator role</span></pre><pre>                await _UserManager.AddToRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre>            }
</pre><pre>        }
</pre><pre></pre><pre><span>// Get the current logged in user</span></pre><pre>        CurrentUser = (await authenticationStateTask).User;
</pre><pre>    }
</pre><pre>}</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_5003557b-83e4-462e-9453-091a39e54b86.png" width="289" height="114"></p><p><strong>Run</strong> the application.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_fd3063f1-7900-4ae7-ad63-52bab1237bd5.png" width="646" height="212"></p><p>Click the <strong>Register</strong> link and create a user named <strong>Admin@BlazorHelpWebsite.com</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_b9df5e06-0e90-4aea-9fba-e729cfdfa8a6.png" width="516" height="383"></p><p>The <strong>Entity Framework Core</strong><em>migration</em> page will show.</p><p>Click <strong>Apply Migrations</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_6ef52d5d-9dfc-432a-94b1-8219724d87aa.png" width="454" height="312"></p><p>After the <strong>migrations</strong> are applied, <em>refresh</em> the page in the <strong>web browser</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_acdaa0d5-4d48-4748-a18c-44c8a1c0d1b9.png" width="468" height="193"></p><p>Click <strong>Continue</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_14eee2d3-a31b-4f1f-8425-8ecfcb416fd0.png" width="645" height="242"></p><p>You will now be <strong>logged in</strong>.</p><p>Navigate to the <strong>Administration</strong> page.</p><p>You will see a message that indicates your are not in the <strong>Administrators</strong> role (even though code has run, because you navigated to that page, to add your account to that <strong>Role</strong>).</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_038227cb-0884-4f91-a040-84adeb288179.png" width="641" height="247"></p><p><strong>Log out</strong> and <strong>log back in</strong> again, and you will now be recognized as a user in the <strong>Administrators</strong> role.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_95908a86-4384-4bc2-b687-b75b9c37ea25.png" width="583" height="323"></p><p>Create another user.</p><p>No matter how many times you log in and out, that user will not be placed in the <strong>Administrators</strong> role.</p><h1>List Users</h1><p>The first step is to list the <strong>current users</strong> in the application. </p><p>First, let’s add some fields and variables to the <span>@code</span> section of the <strong>Administration.razor</strong> page that we will need now and to support code we will add later:</p><pre><pre><span>// Property used to add or edit the currently selected user</span></pre><pre>    IdentityUser objUser = <span>new</span> IdentityUser();
</pre><pre></pre><pre><span>// Tracks the selected role for the currently selected user</span></pre><pre><span>string</span> CurrentUserRole { <span>get</span>; <span>set</span>; } = "<span>Users</span>";
</pre><pre></pre><pre><span>// Collection to display the existing users</span></pre><pre>    List&lt;IdentityUser&gt; ColUsers = <span>new</span> List&lt;IdentityUser&gt;();
</pre><pre></pre><pre><span>// Options to display in the roles dropdown when editing a user</span></pre><pre>    List&lt;<span>string</span>&gt; Options = <span>new</span> List&lt;<span>string</span>&gt;() { "<span>Users</span>", "<span>Administrators</span>" };
</pre><pre></pre><pre><span>// To hold any possible errors</span></pre><pre><span>string</span> strError = "<span></span>";
</pre><pre></pre><pre><span>// To enable showing the Popup</span></pre><pre><span>bool</span> ShowPopup = <span>false</span>;
</pre><pre></pre></pre><p>Let’s also add method stubs for methods we will need later. </p><p>We add them now because markup that we will add soon, will refer to these methods, and the code will not compile if the methods do not exist (even though at this point the methods will not actually perform the eventual functionality).</p><pre><pre><span>void</span> AddNewUser()
</pre><pre>    {
</pre><pre></pre><pre>    }
</pre><pre></pre><pre>    async Task SaveUser()
</pre><pre>    {
</pre><pre></pre><pre>    }
</pre><pre></pre><pre>    async Task EditUser(IdentityUser _IdentityUser)
</pre><pre>    {
</pre><pre></pre><pre>    }
</pre><pre></pre><pre>    async Task DeleteUser()
</pre><pre>    {
</pre><pre></pre><pre>    }
</pre><pre></pre><pre><span>void</span> ClosePopup()
</pre><pre>    {
</pre><pre><span>// Close the Popup</span></pre><pre>        ShowPopup = <span>false</span>;
</pre><pre>    }</pre></pre><p>Now let us add the code to display the existing users.</p><p>Add the following method:</p><pre><pre><span>public</span><span>void</span> GetUsers()
</pre><pre>    {
</pre><pre><span>// clear any error messages</span></pre><pre>        strError = "<span></span>";
</pre><pre></pre><pre><span>// Collection to hold users</span></pre><pre>        ColUsers = <span>new</span> List&lt;IdentityUser&gt;();
</pre><pre></pre><pre><span>// get users from _UserManager</span></pre><pre>        var user = _UserManager.Users.Select(x =&gt; <span>new</span> IdentityUser
</pre><pre>        {
</pre><pre>            Id = x.Id,
</pre><pre>            UserName = x.UserName,
</pre><pre>            Email = x.Email,
</pre><pre>            PasswordHash = "<span>*****</span>"
</pre><pre>        });
</pre><pre></pre><pre><span>foreach</span> (var item <span>in</span> user)
</pre><pre>        {
</pre><pre>            ColUsers.Add(item);
</pre><pre>        }
</pre><pre>    }</pre></pre><p>Also, add the following code to the end of the<strong><em></em>protected override async Task OnInitializedAsync()</strong> method so that the <strong>getUsers()</strong> method will be invoked when the user navigates to the page:</p><pre><pre><span>// Get the users</span></pre><pre>        GetUsers();</pre></pre><p>Finally, in the HTML markup section, at the top of the file, replace this line of code:</p><pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>You are in @ADMINISTRATION_ROLE <span>&lt;/</span><span>p</span><span>&gt;</span></pre></pre><p>With the following code:</p><pre><pre><span>&lt;</span><span>table</span><span>class</span>=<span>"table"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>thead</span><span>&gt;</span></pre><pre><span>&lt;</span><span>tr</span><span>&gt;</span></pre><pre><span>&lt;</span><span>th</span><span>&gt;</span>Id<span>&lt;/</span><span>th</span><span>&gt;</span></pre><pre><span>&lt;</span><span>th</span><span>&gt;</span>User Name<span>&lt;/</span><span>th</span><span>&gt;</span></pre><pre><span>&lt;</span><span>th</span><span>&gt;</span>Email<span>&lt;/</span><span>th</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>tr</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>thead</span><span>&gt;</span></pre><pre><span>&lt;</span><span>tbody</span><span>&gt;</span></pre><pre>                    @foreach (var user in ColUsers)
</pre><pre>                    {
</pre><pre><span>&lt;</span><span>tr</span><span>&gt;</span></pre><pre><span>&lt;</span><span>td</span><span>&gt;</span>@user.Id.Substring(0, 5) ...<span>&lt;/</span><span>td</span><span>&gt;</span></pre><pre><span>&lt;</span><span>td</span><span>&gt;</span>@user.UserName<span>&lt;/</span><span>td</span><span>&gt;</span></pre><pre><span>&lt;</span><span>td</span><span>&gt;</span>@user.Email<span>&lt;/</span><span>td</span><span>&gt;</span></pre><pre><span>&lt;</span><span>td</span><span>&gt;</span></pre><pre><span>&lt;!-- Edit the current forecast --&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>class</span>=<span>"btn btn-primary"</span></pre><pre>                                        @<span>onclick</span>=<span>"(() =&gt; EditUser(user))"</span><span>&gt;</span></pre><pre>                                    Edit
</pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>td</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>tr</span><span>&gt;</span></pre><pre>                    }
</pre><pre><span>&lt;/</span><span>tbody</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>table</span><span>&gt;</span></pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_5e1b8d56-a89c-495e-bdd8-17fe3e2b7636.png" width="582" height="242"></p><p>When we log in with the <strong>Admin@BlazorHelpWebsite.com</strong> account and navigate to the <strong>Administration</strong> page, we see a list of the users.</p><p>Note, the <strong>Edit</strong> button will not actually work at this point.</p><h1>Add Users</h1><p>In the <strong>UI markup</strong>, under the recently added table markup, add the following code to implement the popup to <strong>add</strong> and <strong>edit</strong> users and an <strong>Add User</strong> button to trigger it:</p><pre><pre>@if (ShowPopup)
</pre><pre>{
</pre><pre><span>&lt;!-- This is the popup to create or edit a user --&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal"</span><span>tabindex</span>=<span>"-1"</span><span>style</span>=<span>"display:block"</span><span>role</span>=<span>"dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-content"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-header"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>h3</span><span>class</span>=<span>"modal-title"</span><span>&gt;</span>Edit User<span>&lt;/</span><span>h3</span><span>&gt;</span></pre><pre><span>&lt;!-- Button to close the popup --&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>type</span>=<span>"button"</span><span>class</span>=<span>"close"</span></pre><pre>                            @<span>onclick</span>=<span>"ClosePopup"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>span</span><span>aria</span>-<span>hidden</span>=<span>"true"</span><span>&gt;</span>X<span>&lt;/</span><span>span</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;!-- Edit form for the current user --&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-body"</span><span>&gt;</span></pre><pre><span>&lt;!-- Only show Id if not a new user --&gt;</span></pre><pre>                    @if (objUser.Id != "")
</pre><pre>                    {
</pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>@objUser.Id<span>&lt;/</span><span>p</span><span>&gt;</span></pre><pre>                    }
</pre><pre><span>&lt;!-- Only allow edit if a new user --&gt;</span></pre><pre>                    @if (objUser.Id != "")
</pre><pre>                    {
</pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>@objUser.UserName<span>&lt;/</span><span>p</span><span>&gt;</span></pre><pre>                    }
</pre><pre>                    else
</pre><pre>                    {
</pre><pre><span>&lt;</span><span>input</span><span>class</span>=<span>"form-control"</span><span>type</span>=<span>"text"</span></pre><pre><span>placeholder</span>=<span>"UserName"</span></pre><pre>                                @<span>bind</span>=<span>"objUser.UserName"</span><span>/&gt;</span></pre><pre>                    }
</pre><pre><span>&lt;</span><span>input</span><span>class</span>=<span>"form-control"</span><span>type</span>=<span>"text"</span></pre><pre><span>placeholder</span>=<span>"Email"</span></pre><pre>                            @<span>bind</span>=<span>"objUser.Email"</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>input</span><span>class</span>=<span>"form-control"</span><span>type</span>=<span>"password"</span></pre><pre><span>placeholder</span>=<span>"Password"</span></pre><pre>                            @<span>bind</span>=<span>"objUser.PasswordHash"</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>select</span><span>class</span>=<span>"form-control"</span></pre><pre>                            @<span>bind</span>=<span>"@CurrentUserRole"</span><span>&gt;</span></pre><pre>                        @foreach (var option in Options)
</pre><pre>                        {
</pre><pre><span>&lt;</span><span>option</span><span>value</span>=<span>"@option"</span><span>&gt;</span></pre><pre>                                @option
</pre><pre><span>&lt;/</span><span>option</span><span>&gt;</span></pre><pre>                        }
</pre><pre><span>&lt;/</span><span>select</span><span>&gt;</span></pre><pre><span>&lt;</span><span>br</span><span>/&gt;</span><span>&lt;</span><span>br</span><span>/&gt;</span></pre><pre><span>&lt;!-- Button to save the user --&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>class</span>=<span>"btn btn-primary"</span></pre><pre>                            @<span>onclick</span>=<span>"SaveUser"</span><span>&gt;</span></pre><pre>                        Save
</pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre><span>&lt;!-- Only show delete button if not a new record --&gt;</span></pre><pre>                    @if (objUser.Id != "")
</pre><pre>                    {
</pre><pre><span>&lt;!-- Button to delete the forecast --&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>class</span>=<span>"btn btn-danger"</span></pre><pre>                                @<span>onclick</span>=<span>"DeleteUser"</span><span>&gt;</span></pre><pre>                            Delete
</pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre>                    }
</pre><pre><span>&lt;</span><span>br</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>span</span><span>style</span>=<span>"color:red"</span><span>&gt;</span>@strError<span>&lt;/</span><span>span</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre>}
</pre><pre><span>&lt;</span><span>button</span><span>class</span>=<span>"btn btn-success"</span> @<span>onclick</span>=<span>"AddNewUser"</span><span>&gt;</span>Add User<span>&lt;/</span><span>button</span><span>&gt;</span></pre></pre><p>In the procedure code, change the <strong>AddNewUser()</strong> method to the following (this is <em>triggered</em> when the <strong>Add User</strong> button is clicked):</p><pre><pre><span>void</span> AddNewUser()
</pre><pre>    {
</pre><pre><span>// Make new user</span></pre><pre>        objUser = <span>new</span> IdentityUser();
</pre><pre>        objUser.PasswordHash = "<span>*****</span>";
</pre><pre></pre><pre><span>// Set Id to blank so we know it is a new record</span></pre><pre>        objUser.Id = "<span></span>";
</pre><pre></pre><pre><span>// Open the Popup</span></pre><pre>        ShowPopup = <span>true</span>;
</pre><pre>    }</pre></pre><p>Finally, alter the <strong>SaveUser()</strong> method to the following:</p><pre><pre>   async Task SaveUser()
</pre><pre>    {
</pre><pre><span>try</span></pre><pre>        {
</pre><pre><span>// Is this an existing user?</span></pre><pre><span>if</span> (objUser.Id != "<span></span>")
</pre><pre>            {
</pre><pre><span>// To be implemented later...</span></pre><pre>            }
</pre><pre><span>else</span></pre><pre>            {
</pre><pre><span>// Insert new user</span></pre><pre></pre><pre>                var NewUser =
</pre><pre><span>new</span> IdentityUser
</pre><pre>                    {
</pre><pre>                        UserName = objUser.UserName,
</pre><pre>                        Email = objUser.Email
</pre><pre>                    };
</pre><pre></pre><pre>                var CreateResult =
</pre><pre>                    await _UserManager
</pre><pre>                    .CreateAsync(NewUser, objUser.PasswordHash);
</pre><pre></pre><pre><span>if</span> (!CreateResult.Succeeded)
</pre><pre>                {
</pre><pre><span>if</span> (CreateResult
</pre><pre>                        .Errors
</pre><pre>                        .FirstOrDefault() != <span>null</span>)
</pre><pre>                    {
</pre><pre>                        strError =
</pre><pre>                            CreateResult
</pre><pre>                            .Errors
</pre><pre>                            .FirstOrDefault()
</pre><pre>                            .Description;
</pre><pre>                    }
</pre><pre><span>else</span></pre><pre>                    {
</pre><pre>                        strError = "<span>Create error</span>";
</pre><pre>                    }
</pre><pre></pre><pre><span>// Keep the popup opened</span></pre><pre><span>return</span>;
</pre><pre>                }
</pre><pre><span>else</span></pre><pre>                {
</pre><pre><span>// Handle Roles</span></pre><pre><span>if</span> (CurrentUserRole == ADMINISTRATION_ROLE)
</pre><pre>                    {
</pre><pre><span>// Put admin in Administrator role</span></pre><pre>                        await _UserManager
</pre><pre>                            .AddToRoleAsync(NewUser, ADMINISTRATION_ROLE);
</pre><pre>                    }
</pre><pre>                }
</pre><pre>            }
</pre><pre></pre><pre><span>// Close the Popup</span></pre><pre>            ShowPopup = <span>false</span>;
</pre><pre></pre><pre><span>// Refresh Users</span></pre><pre>            GetUsers();
</pre><pre>        }
</pre><pre><span>catch</span> (Exception ex)
</pre><pre>        {
</pre><pre>            strError = ex.GetBaseException().Message;
</pre><pre>        }
</pre><pre>    }</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_45f5654d-3cdd-4a7e-99e6-7792595d8f67.png" width="564" height="233"></p><p>When we run the application, we can now click the <strong>Add User</strong> button to open the popup.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_9007a386-2f0d-44e8-8d5f-58806a663223.png" width="406" height="279"></p><p>The popup allows us to enter the information required to create a <strong>new user</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_646ef1a9-600d-4295-9f10-d8100545fa1c.png" width="419" height="319"></p><p>We can enter information to create a <strong>new user</strong>, and receive error messages if there are any.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_9c1d1138-0944-42d0-a572-ecf757d4dfd7.png" width="562" height="290"></p><p>The new user is created and can now <strong>log in</strong> using the <strong>password</strong> we created.</p><h1>Update (And Delete)</h1><p>To enable the <strong>Edit</strong> button to work, alter the <strong>EditUser</strong> method to the following:</p><pre><pre>    async Task EditUser(IdentityUser _IdentityUser)
</pre><pre>    {
</pre><pre><span>// Set the selected user</span></pre><pre><span>// as the current user</span></pre><pre>        objUser = _IdentityUser;
</pre><pre></pre><pre><span>// Get the user</span></pre><pre>        var user = await _UserManager.FindByIdAsync(objUser.Id);
</pre><pre><span>if</span> (user != <span>null</span>)
</pre><pre>        {
</pre><pre><span>// Is user in administrator role?</span></pre><pre>            var UserResult =
</pre><pre>                await _UserManager
</pre><pre>                .IsInRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre></pre><pre><span>if</span> (UserResult)
</pre><pre>            {
</pre><pre>                CurrentUserRole = ADMINISTRATION_ROLE;
</pre><pre>            }
</pre><pre><span>else</span></pre><pre>            {
</pre><pre>                CurrentUserRole = "<span>Users</span>";
</pre><pre>            }
</pre><pre>        }
</pre><pre></pre><pre><span>// Open the Popup</span></pre><pre>        ShowPopup = <span>true</span>;
</pre><pre>    }</pre></pre><p>Next, to enable updating to work, alter the <strong>SaveUser()</strong> method to replace the following code:</p><pre><pre><span>// To be implemented later...</span></pre></pre><p>with:</p><pre><pre><span>                // Get the user</span></pre><pre>                var user = await _UserManager.FindByIdAsync(objUser.Id);
</pre><pre></pre><pre><span>// Update Email</span></pre><pre>                user.Email = objUser.Email;
</pre><pre></pre><pre><span>// Update the user</span></pre><pre>                await _UserManager.UpdateAsync(user);
</pre><pre></pre><pre><span>// Only update password if the current value</span></pre><pre><span>// is not the default value</span></pre><pre><span>if</span> (objUser.PasswordHash != "<span>*****</span>")
</pre><pre>                {
</pre><pre>                    var resetToken = 
</pre><pre>                        await _UserManager.GeneratePasswordResetTokenAsync(user);
</pre><pre></pre><pre>                    var passworduser = 
</pre><pre>                        await _UserManager.ResetPasswordAsync(
</pre><pre>                            user, 
</pre><pre>                            resetToken, 
</pre><pre>                            objUser.PasswordHash);
</pre><pre></pre><pre><span>if</span> (!passworduser.Succeeded)
</pre><pre>                    {
</pre><pre><span>if</span> (passworduser.Errors.FirstOrDefault() != <span>null</span>)
</pre><pre>                        {
</pre><pre>                            strError = 
</pre><pre>                                passworduser
</pre><pre>                                .Errors
</pre><pre>                                .FirstOrDefault()
</pre><pre>                                .Description;
</pre><pre>                        }
</pre><pre><span>else</span></pre><pre>                        {
</pre><pre>                            strError = "<span>Pasword error</span>";
</pre><pre>                        }
</pre><pre></pre><pre><span>// Keep the popup opened</span></pre><pre><span>return</span>;
</pre><pre>                    }
</pre><pre>                }
</pre><pre></pre><pre><span>// Handle Roles</span></pre><pre></pre><pre><span>// Is user in administrator role?</span></pre><pre>                var UserResult = 
</pre><pre>                    await _UserManager
</pre><pre>                    .IsInRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre></pre><pre><span>// Is Administrator role selected </span></pre><pre><span>// but user is not an Administrator?</span></pre><pre><span>if</span> (
</pre><pre>                    (CurrentUserRole == ADMINISTRATION_ROLE) 
</pre><pre>                    &amp; 
</pre><pre>                    (!UserResult))
</pre><pre>                {
</pre><pre><span>// Put admin in Administrator role</span></pre><pre>                    await _UserManager
</pre><pre>                        .AddToRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre>                }
</pre><pre><span>else</span></pre><pre>                {
</pre><pre><span>// Is Administrator role not selected </span></pre><pre><span>// but user is an Administrator?</span></pre><pre><span>if</span> ((CurrentUserRole != ADMINISTRATION_ROLE) 
</pre><pre>                        &amp; 
</pre><pre>                        (UserResult))
</pre><pre>                    {
</pre><pre><span>// Remove user from Administrator role</span></pre><pre>                        await _UserManager
</pre><pre>                            .RemoveFromRoleAsync(user, ADMINISTRATION_ROLE);
</pre><pre>                    }
</pre><pre>                }</pre></pre><p>Finally, alter the <strong>DeleteUser()</strong> method to the following:</p><pre><pre>    async Task DeleteUser()
</pre><pre>    {
</pre><pre><span>// Close the Popup</span></pre><pre>        ShowPopup = <span>false</span>;
</pre><pre></pre><pre><span>// Get the user</span></pre><pre>        var user = await _UserManager.FindByIdAsync(objUser.Id);
</pre><pre><span>if</span> (user != <span>null</span>)
</pre><pre>        {
</pre><pre><span>// Delete the user</span></pre><pre>            await _UserManager.DeleteAsync(user);
</pre><pre>        }
</pre><pre></pre><pre><span>// Refresh Users</span></pre><pre>        GetUsers();
</pre><pre>    }</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4354/Windows-Live-Writer-A-Simple-Blazor_518B-image_512ea768-a2a5-4267-a651-b44d4030303a.png" width="590" height="338"></p><p>When you run the application, you will now have the ability to <strong>update</strong> and <strong>delete</strong> users.</p><h1>Links</h1><p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity?view=aspnetcore-3.0&amp;tabs=visual-studio">Introduction to Identity on ASP.NET Core</a></p><p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/roles?view=aspnetcore-3.0">Role-based authorization in ASP.NET Core</a></p><p><a href="https://www.dotnetcurry.com/aspnet-core/role-based-security">Role Based Security in an ASP.NET Core Application</a></p><h1>Download</h1><p>The project is available at <a href="/Downloads.aspx">http://Blazorhelpwebsite.com/Downloads.aspx</a></p><p>You must have <strong>Visual Studio 2019 </strong>(or higher) installed to run the code.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>