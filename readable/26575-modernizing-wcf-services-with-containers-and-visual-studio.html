<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Modernizing WCF Services with containers and Visual Studio -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Modernizing WCF Services with containers and Visual Studio</h1>
    <section class="article_text post">
<p>There are a number of reasons for moving long-standing .NET Framework applications like WCF, and ASP.NET Webforms to containers and then into containers or &quot;modernizing <del>legacy</del> heritage apps&quot;.</p>
<ol>
<li><p>DevOps - Once the application is set up in a container, build a CI/CD pipeline to build and push the applications to the cloud in a streamlined fashion.</p></li>
<li><p>Velocity - In addition to the CI/CD features, the ability to version the container, ease of deployment and rollback in the event of failures is easier.</p></li>
<li><p>Leverage other cloud services - Add Application Insights or logging, managed database services, and other PAAS offerings.&#xA0;</p></li>
</ol>
<h2 id="wheretostart">Where to start</h2>
<p><a href="https://visualstudio.com">Visual Studio 2019</a> has the Docker tooling built into the workloads. You will need to install <a href="https://docs.docker.com/docker-for-windows/">Docker for Windows</a> and ensure <a href="https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers">Windows Containers</a> are enabled.</p>
<p>Open your WCF application in VS 2019, right-click the project file and select Add -&gt; Docker Support.</p>
<p><img src="/content/images/2019/06/Screen-Shot-2019-06-11-at-2.36.28-PM.png" alt></p>
<p>The Docker tooling for Visual Studio will inspect the application and add the appropriate Dockerfile for your application.</p>
<p>In the case of WCF, the following Dockerfile is added to your solution.</p>
<pre><code class="language-docker">FROM mcr.microsoft.com/dotnet/framework/wcf:4.7.2-windowsservercore-ltsc2019  
ARG source  
WORKDIR /inetpub/wwwroot  
COPY ${source:-obj/Docker/publish} .  
</code></pre>
<p>Now when you run your application, select &quot;Docker&quot; from the Debug menu and the WCF Test Client will launch and add the container url for the service.</p>
<blockquote>
<p>If the WCF Test Client does not load, be sure to check that the workload is selected in the Visual Studio 2019 Installer.</p>
</blockquote>
<p>Upon looking at the <code>*csproj</code> file, you should see that there are new entries for starting the new container with F5.</p>
<pre><code class="language-xml">&lt;DockerLaunchAction&gt;LaunchWcfTestClient&lt;/DockerLaunchAction&gt;&lt;DockerLaunchUrl&gt;http://{ServiceIPAddress}/MyService.svc&lt;/DockerLaunchUrl&gt;  
</code></pre>
<p>The WCF Client will start and add the new container URL endpoint to test against instead of <code>http://localhost...</code>. All of your breakpoints and debugging will now happen within the container as the debugger is attached to the container as opposed to the local machine host.</p>
<h2 id="buildingthedockerimage">Building the Docker Image</h2>
<p>When you click Debug or press F5, the image is built for your application by Visual Studio, after the base image is pulled. This may take some time as this is a Windows Container image and ~1.59 Gb compressed.</p>
<p>If you are familiar with Docker, you&apos;re likely to try and use the standard <code>docker build</code> or <code>docker run</code> commands. However, will fail using the command line if the proper MSBuild command is not run to produce the appropriate output.</p>
<p>We have to build the WCF application first either using Visual Studio or MSBuild. The Docker tooling for VS, actually runs an MSBuild command behind the scenes to create the <code>obj/Docker/publish</code> folder, compile the app and copy the output there prior to running the <code>docker run</code> command. </p>
<p>This is important in the event we move to a DevOps scenario. The command need to run on the command line and in Azure DevOps is:</p>
<pre><code class="language-console">msbuild /t:ContainerBuild /p:Configuration=Release  
</code></pre>
<h3 id="pushingtheimagetoaregistry">Pushing the image to a registry</h3>
<p>Give a project name i.e. <code>hellowcf</code> will produce a docker image named <code>hellowcf:latest</code>. From here, you may want to <strong>tag</strong> the image with an appropriate version number, or other identifier prior to pushing it to a registry.</p>
<p>For example, tagging with a <strong>buildId</strong> and pushing it to an Azure Container registry.</p>
<pre><code class="language-console">docker tag hellowcf:latest myregistry.azure.cr/hellowcf:1234

docker push myregistry.azure.cr/hellowcf:1234  
</code></pre>
<h3 id="usingvisualstudio">Using Visual Studio</h3>
<p>Visual Studio has a rich UI for publishing your applications and with containers, the same is true.</p>
<p>The publish dialog has options for <a href="https://docs.microsoft.com/en-us/visualstudio/containers/hosting-web-apps-in-docker?view=vs-2019">deploying to a container registry (Azure Container Registry, Docker Hub, Custom)</a> or <a href="https://docs.microsoft.com/en-us/visualstudio/containers/deploy-app-service?view=vs-2019">deploying the built container image direct to Azure App Service</a> right from the UI.</p>
<p><img src="https://docs.microsoft.com/en-us/visualstudio/containers/media/hosting-web-apps-in-docker/vs-acr-provisioning-dialog.png?view=vs-2019" alt></p>
<h2 id="publishingtheapplication">Publishing the application</h2>
<p>In this scenario, a WCF application was used however it could as easily have been an ASP.NET WebForms app or a console service.</p>
<p>For the WCF app, Windows Containers on AppService is a great first step and if you have a number of components to your architecture that is needing to spin up at once; AKS - <a href="https://docs.microsoft.com/en-us/azure/aks/windows-container-cli">Azure Kubernetes Service</a> now supports Windows Containers as well.</p>
<p>Console apps or services that run once and while, or on timers to perform work is when a service like <a href="https://docs.microsoft.com/en-us/azure/container-instances/">Azure Container instances</a> is a great fit. </p>
<p>The point here is getting your long-standing and stable applications into a container without re-writing or re-architecting the solution and still take advantage of cloud native type practices. </p>
<h2 id="additionalreading">Additional Reading</h2>
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/modernize-with-azure-and-containers/modernize-existing-apps-to-cloud-optimized/deploy-existing-net-apps-as-windows-containers">Deploying Existing .NET Apps as Windows Containers</a></p> </section>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>