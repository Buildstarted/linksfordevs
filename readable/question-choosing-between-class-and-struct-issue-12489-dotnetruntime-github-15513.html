<!DOCTYPE html>
<html lang="en">
<head>
    <title>
[question] choosing between class and struct &#xB7; Issue #12489 &#xB7; dotnet/runtime - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="[question] choosing between class and struct &#xB7; Issue #12489 &#xB7; dotnet/runtime - linksfor.dev(s)"/>
    <meta property="article:author" content="caozhiyuan"/>
    <meta property="og:description" content="here has a docment write in 2008 : https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/choosing-between-class-and-struct it suggest &#xFF1A; X AVOID defining a struct unless the type has al..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/coreclr/issues/23960"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - [question] choosing between class and struct &#xB7; Issue #12489 &#xB7; dotnet/runtime</title>
<div class="readable">
        <h1>[question] choosing between class and struct &#xB7; Issue #12489 &#xB7; dotnet/runtime</h1>
            <div>by caozhiyuan</div>
            <div>Reading time: 4 minutes</div>
        <div>Posted here: 13 Apr 2019</div>
        <p><a href="https://github.com/dotnet/coreclr/issues/23960">https://github.com/dotnet/coreclr/issues/23960</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-channel="marked-as-read:issue:557945992">

              
<div data-gid="MDU6SXNzdWU1NTc5NDU5OTI=" data-url="/_render_node/MDU6SXNzdWU1NTc5NDU5OTI=/issues/body" data-channel="issue:557945992">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/caozhiyuan/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/caozhiyuan"><img height="40" width="40" alt="@caozhiyuan" src="https://avatars0.githubusercontent.com/u/3415285?s=88&amp;v=4"></a>

</p>


  
<div id="issue-557945992">
  <div data-body-version="dc5ad3375d30e3a997c82530ef2c23ea" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>here has a docment write in 2008 :<br>
<a rel="nofollow" href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/choosing-between-class-and-struct">https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/choosing-between-class-and-struct</a></p>
<p>it suggest ï¼š<br>
X AVOID defining a struct unless the type has all of the following characteristics:<br>
It logically represents a single value, similar to primitive types (int, double, etc.).<br>
It has an instance size under 16 bytes.<br>
It is immutable.<br>
It will not have to be boxed frequently.</p>
<p>now . in net core ,suggest instance size under xx bytes changed ? i seems remeber under 40 bytes.</p>
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> help , thanks.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>

</div>


              

  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mjg2NTk3NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mjg2NTk3NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Mjg2NTk3NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-482865975">
    <div>
      

  

<details data-body-version="a02728552b3fd2723f333a517deb90d1">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a02728552b3fd2723f333a517deb90d1" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>These are general guidelines. They are not hard rules. "AVOID" means recomendation that does not have to be followed 100% of the time.</p>
<p>16 bytes is a good general number for 32-bit platforms. A good number for 64-bit platforms may be a bit higher, say 24 bytes.</p>
<p>There has been a lot of experiments and interest to use much larger structs to avoid GC heap allocations recently. It typically comes with number of usability issues and it does not even always improve performance unless you are very careful (shifts the GC heap allocation costs somewhere else). It is not a good design pattern for mainstream APIs. For example, the new .NET Core 3.0 Utf8JsonReader/Utf8JsonWriter has been designed around large structs and we are considering redesigning it now because of we are not happy with it as a mainstream public API.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mjg5NzIzMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mjg5NzIzMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Mjg5NzIzMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/caozhiyuan/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/caozhiyuan"><img height="40" width="40" alt="@caozhiyuan" src="https://avatars0.githubusercontent.com/u/3415285?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-482897232">
    <div>
      

  

<details data-body-version="e193af00b909c57c9e3565f55dd23bc9">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e193af00b909c57c9e3565f55dd23bc9" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a>  thanks , Utf8JsonReader/Utf8JsonWriter(ref struct) is stack allocated , may be ok.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mzg5MzQ1Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mzg5MzQ1Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Mzg5MzQ1Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jzabroski/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jzabroski"><img height="40" width="40" alt="@jzabroski" src="https://avatars3.githubusercontent.com/u/447485?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-483893452">
    <div>
      

  

<details data-body-version="d9c256c7facd0fedaac7a3d0774efb01">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mzg5NjM1Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Mzg5NjM1Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Mzg5NjM1Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-483896356">
    <div>
      

  

<details data-body-version="efe4ca5ba5a306d79d7b12ed6714109a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4MzkxMTQ2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4MzkxMTQ2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4MzkxMTQ2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mairaw/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mairaw"><img height="40" width="40" alt="@mairaw" src="https://avatars3.githubusercontent.com/u/12971179?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-483911466">
    <div>
      

  

<details data-body-version="ef3f1ed9ba16be612074c8f38908ad4d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="ef3f1ed9ba16be612074c8f38908ad4d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Yes, disallowed by design because of copyright. We need to come up with our own guidelines if we don't want to use that content.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4MzkxMzAzMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4MzkxMzAzMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4MzkxMzAzMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jzabroski/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jzabroski"><img height="40" width="40" alt="@jzabroski" src="https://avatars3.githubusercontent.com/u/447485?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-483913032">
    <div>
      

  

<details data-body-version="4d806122bf685baed80a2299697e4043">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4d806122bf685baed80a2299697e4043" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>My ideal vision would be a document that describes current best practices as well as possibly an area for people to document exceptions, and then those exceptions raise awareness for stronger ways of thinking about what APIs we need as engineers to crush Rust in the TechEmpower  benchmark, and just generally write efficient systems with .NET</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  







<!-- Rendered timeline since 2020-01-30 22:44:18 -->



            </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>