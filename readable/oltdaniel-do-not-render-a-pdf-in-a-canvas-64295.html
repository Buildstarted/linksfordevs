<!DOCTYPE html>
<html lang="en">
<head>
    <title>
oltdaniel - Do not render a PDF in a canvas - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="oltdaniel - Do not render a PDF in a canvas - linksfor.dev(s)"/>
    <meta property="article:author" content="Daniel Oltmanns"/>
    <meta property="og:description" content="Mobile browsers are far from perfect. Browsing larger GitHub Source files, slow loading websites with one gig of images and js. They are just not done for it. However, there are things, that should just not be."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://oltdaniel.at/2020/just-do-not-render-a-pdf.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - oltdaniel - Do not render a PDF in a canvas</title>
<div class="readable">
        <h1>oltdaniel - Do not render a PDF in a canvas</h1>
            <div>by Daniel Oltmanns</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 14 Jul 2020</div>
        <p><a href="https://oltdaniel.at/2020/just-do-not-render-a-pdf.html">https://oltdaniel.at/2020/just-do-not-render-a-pdf.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
    <h2>Do not render a PDF in a canvas</h2>
    <post-meta>
        <time datetime="2020-07-14T00:00:00+02:00">14 July 2020</time>
        with <words>887</words> words
        (<reading-time>4</reading-time> minute(s) to read)
    </post-meta>
    <p>Mobile browsers are far from perfect. Browsing larger GitHub Source files, slow loading websites with one gig of images and js. They are just not done for it. However, there are things, that should just not be.</p>

<!--abstract-->

<hr>

<blockquote>
  <p>I am a student in my second semester of computer science. I have a lot of stuff to learn, but this is something that “I don’t enjoy”. Just do not build it in the first place. Done.</p>
</blockquote>

<p>A fellow student of mine, send me a lecture notes to a module to prepare for my exams. We have an own GitLab instance running for our university where every student is free to create and share their work. In this case, a user create a repo for a specific module to store the source files and final PDF of his lecture notes. So far, so good.</p>

<p>Got the link, opened up on my smartphone, waited for the PDF to load and … crash. The browser closed, the homescreen restarted. Wait, what? Opened up the messenger, clicked the link again, waited for the PDF to load. Crash. My first thought was, my phone was just too bad. But I have a Samsung Galaxy S9, nothing low end, nothing ultra. But does the job in everything … except this. So I started digging.</p>

<p>First off, GitLab (at least the version 13.1.3-ee, used by our university) renders the PDF file in a HTML canvas, each page, one canvas. First thought, maybe there are too many pages. No, there are just 90 pages in that PDF. But as I have exams coming up, I cannot dig deeper into the JavaScript Part of GitLab. So I did some other testing for now instead.</p>

<p>The default Browser I have on my phone is Chrome v83.0.4103.106 and additionally Firefox v68.10.1, running on Android 10 and One UI v2.1 (build number: QP1A.190711.020.G960FXXU9ETF5). So I know Chrome fails to render the PDF in 90 Canvas elements. So I checked Firefox, same thing happens. With this knowledge I asked in the computer science group of my university, for other people to verify this behavior and the android users could verify it. Apple users verified that it renders successfully in both Safari and Firefox on IOS. I wanted to record my screen in order to document this crash, but as lucky I am, the screen recorder app is killed straight away after the browser crashed. As I have no additional equipment to record, feel free to crash it yourself.</p>

<h3 id="how-do-we-test">how do we test</h3>

<p>Well, as the GitLab instance of my university is public and repos can be shared publicly, I still do not want to get into any trouble. But, now problem, we have GitLab itself and a small demo side I built. Technical stuff: GitLab uses PDF.js from mozilla. My version is based on one of their examples, as I am not currently able to dive into GitLab source code. For a PDF I used the ethereum PDF file, twice, to have a PDF file that is large enough. It is a bit bigger than the original PDF file I had, but roughly the same number of pages (just 78 here).</p>

<p>During the development I tested in my desktop to see if the page displays everything correctly, and then continue testing on my mobile device. During this phase I crashed by laptop while it was rendering 78Pages of PDF in the browser. Note here, my Laptop is an XPS15 with an Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz with 6 cores. Due to my time limits, I need to continue my work in the future (1 month from now).</p>

<h2 id="attention">ATTENTION</h2>

<p>THESE LINKS ARE LIKELY TO CRASH YOUR BROWSER, IF YOU ARE ON ANDROID. IF THERE IS ANY DAMAGE DONE BY OPENING THIS LINK, I HAVE WARNED YOU WITH THIS MESSAGE AND AM NOT ACCOUNTABLE FOR ANY DAMAGE. IF THE TAB LOADS, JUST CLOSE IT TO AVOID THE CRASH. I SUGGEST MY VERSION, AS YOU JUST NEED TO CLICK A BUTTON TO CRASH YOUR BROWSER.</p>

<p><a href="https://oltdaniel.at/pdf_test.html">My Version</a></p>

<p><a href="https://gitlab.com/oltdaniel/crash-pdf/-/blob/master/paper.pdf">GitLab Version</a></p>

<h3 id="conclusion">conclusion</h3>

<p>PDF files are like SVG files. You can zoom into each character without seeing any pixels. It’s a great format. But as usual, there where people that need to render PDF files to a raw canvas. Nothing wrong with it, but e.g. to keep up the Quality GitLab renders each page in a 2381x3367 canvas (at least on my computer). It is required, because if you reduce the scale there is no damn way to read the pdf in this rendered format. But that is the reason, why there are so many PDF readers on so many platforms. That is the reason why desktop browser have built-in PDF readers, because in any other format you just kill system resources and/or do not get the same visual quality.</p>

<p>In the end, I am fascinated how quickly someone can crash a browser. And I mean, really crash a browser. Nobody, expects a mobile browser crashing just by rendering a PDF file. It could be fixed in this special case, by reducing the size of each canvas, or just render pager per page (as the key example of mozilla’s PDF.js presents <a href="https://mozilla.github.io/pdf.js/examples/">here</a>).</p>

<p>More to this scenario will follow in the future with further details and demos.</p>

</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>