<!DOCTYPE html>
<html lang="en">
<head>
    <title>
StrathWeb. A free flowing web tech monologue. -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>StrathWeb. A free flowing web tech monologue.</h1>
    <article class="post-6556 post type-post status-publish format-standard hentry category-net-core category-asp-net-core category-mvc-core"> <div class="entry-content clearfix"> <p>One of the great extensibility points in the routing feature of the older versions of the ASP.NET MVC and ASP.NET Core MVC frameworks was the ability to pick up any route and dynamically point it at a given controller/action.</p>
<p>This had a lot of excellent use cases &#x2013; as we will briefly see &#x2013; and since ASP.NET Core 3.0 Preview 7, the feature is actually finally available in ASP.NET Core 3.0 (despite not being mentioned in the <a href="https://devblogs.microsoft.com/aspnet/asp-net-core-and-blazor-updates-in-net-core-3-0-preview-7/">official release blog post</a>). </p>
<p>So, let&#x2019;s have a look at dynamic routing in ASP.NET Core 3.0 together!</p> <h3 id="toc_1">Background</h3>
<p>In a typical set up, MVC routes would be defined statically using route attributes:</p>
<p>When using this approach, each route has to be manually declared.</p>
<div> <div id="crayon-5d67f85ed4509415880622" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
public class HomeController : Controller
{
   [Route(&quot;&quot;)]
   [Route(&quot;Home&quot;)]
   [Route(&quot;Home/Index&quot;)]
   public IActionResult Index()
   {
      return View();
   }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed4509415880622-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">HomeController</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Controller</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4509415880622-6"><span class="crayon-h">&#xA0;&#xA0; </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">IActionResult </span><span class="crayon-e">Index</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td> </tr> </table> </div> </div> </div>
<p>Alternatively, you can use the centralized routing model, which doesn&#x2019;t require you to explicitly declare every route &#x2013; the routes are &#x201C;alive&#x201D; automatically for all the discovered controllers. The pre-requisite is, however, that these controllers are there in the first place. </p>
<p>This is shown below, using the new syntax relevant for ASP.NET Core 3.0 and its <a href="https://docs.microsoft.com/en-us/aspnet/core/migration/22-to-30?view=aspnetcore-2.2&amp;tabs=visual-studio#migrate-startupconfigure">endpoint routing</a> approach.</p>
<div> <div id="crayon-5d67f85ed451e050406165" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapControllerRoute(&quot;default&quot;, &quot;{controller=Home}/{action=Index}/{id?}&quot;);
    });</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed451e050406165-1"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">UseEndpoints</span><span class="crayon-sy">(</span><span class="crayon-v">endpoints</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5d67f85ed451e050406165-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">endpoints</span><span class="crayon-sy">.</span><span class="crayon-e">MapControllerRoute</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;default&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>What both of these approaches have in common, is that the routes are known at application start up time. However, what if you want to be able to dynamically define routes &#x2013; and add/remove them as the application is running?</p>
<p>There could be several use cases for this &#x2013; we will name just a few and let your imagination (or, well, business needs) fill in the rest. For example:</p>
<ul>
<li>route translation and changes to those translated routes, as well as roll out of new languagues</li>
<li>CMS type of applications where &#x201C;pages&#x201D; can be added without needing to create new controllers or to hardcode new routes in the source code</li>
<li>multi tenant applications where tenant routes can be activated/deactivated at any point</li>
</ul>
<p>The process of handling this should actually be fairly understandable. You&#x2019;d want to &#x201C;intercept&#x201D; the route handling early, check the current route values that have been resolved for it and &#x201C;transform&#x201D; them, using for example data from a database, into a new set of route values, such values, that point to an actually existing controller.</p>
<h3 id="toc_2">Sample problem &#x2013; translated routes</h3>
<p>In the older versions of ASP.NET Core MVC you&#x2019;d typically solve this problem with a custom <em>IRouter</em> &#x2013; this however is not supported anymore in ASP.NET Core 3.0, where routing is handled via the aforementioned endpoint routing. Thankfully, there is support for our scenarios &#x2013; since ASP.NET Core 3.0 Preview 7 &#x2013; via a new feature called <em>MapDynamicControllerRoute</em> and an extensibility point called <em>DynamicRouteValueTransformer</em>. Let&#x2019;s have a look at a concrete example.</p>
<p>Imagine you have a single <em>OrdersController</em> and you&#x2019;d want to support multiple translations for it:</p>
<div> <div id="crayon-5d67f85ed452d976418803" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
public class OrdersController : Controller
{
    public IActionResult List()
    {
        return View();
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed452d976418803-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">OrdersController</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Controller</span></div><div class="crayon-line" id="crayon-5d67f85ed452d976418803-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">IActionResult </span><span class="crayon-e">List</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td> </tr> </table> </div> </div> </div>
<p>How could this look like? For example:</p>
<ul>
<li>for English &#x2013; <em>/en/orders/list</em></li>
<li>for German &#x2013; <em>/de/bestellungen/liste</em></li>
<li>for Polish &#x2013; <em>/pl/zamowienia/lista</em></li>
</ul>
<h3 id="toc_3">Route translations with dynamic routing</h3>
<p>So how do we solve this now? Instead of using the default MVC route, we can use the new feature <em>MapDynamicControllerRoute</em>, and point it at our custom <em>DynamicRouteValueTransformer</em>, which will run the route value transformation that we mentioned earlier.</p>
<div> <div id="crayon-5d67f85ed453a649786052" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Latest);

        services.AddSingleton&lt;TranslationTransformer&gt;();
        services.AddSingleton&lt;TranslationDatabase&gt;();
    }

    public void Configure(IApplicationBuilder app)
    {
        app.UseRouting();
        app.UseEndpoints(endpoints =&gt;
        {
            endpoints.MapDynamicControllerRoute&lt;TranslationTransformer&gt;(&quot;{language}/{controller}/{action}&quot;);
        });
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> <div class="crayon-nums-content"></div> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed453a649786052-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">ConfigureServices</span><span class="crayon-sy">(</span><span class="crayon-e">IServiceCollection </span><span class="crayon-v">services</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d67f85ed453a649786052-5"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">services</span><span class="crayon-sy">.</span><span class="crayon-e">AddMvc</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">SetCompatibilityVersion</span><span class="crayon-sy">(</span><span class="crayon-v">CompatibilityVersion</span><span class="crayon-sy">.</span><span class="crayon-v">Latest</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed453a649786052-7"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">services</span><span class="crayon-sy">.</span><span class="crayon-v">AddSingleton</span><span class="crayon-o">&lt;</span><span class="crayon-v">TranslationTransformer</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed453a649786052-8"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">services</span><span class="crayon-sy">.</span><span class="crayon-v">AddSingleton</span><span class="crayon-o">&lt;</span><span class="crayon-v">TranslationDatabase</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed453a649786052-11"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Configure</span><span class="crayon-sy">(</span><span class="crayon-e">IApplicationBuilder </span><span class="crayon-v">app</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed453a649786052-14"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">app</span><span class="crayon-sy">.</span><span class="crayon-e">UseEndpoints</span><span class="crayon-sy">(</span><span class="crayon-v">endpoints</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed453a649786052-16"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">endpoints</span><span class="crayon-sy">.</span><span class="crayon-v">MapDynamicControllerRoute</span><span class="crayon-o">&lt;</span><span class="crayon-v">TranslationTransformer</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;{language}/{controller}/{action}&quot;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>Our <em>TranslationTransformer</em>, which is a subclass of <em>DynamicRouteValueTransformer</em>, will be responsible for converting the incoming language-specific route values, which would normally not match to anything in our application (after all, we don&#x2019;t have controller names in Polish or German), into a route value dictionary that would match a controller/action in our application. So, to make it clearer, in German case it will transform the controller name &#x201C;Bestellungen&#x201D; into &#x201C;Orders&#x201D; and action name &#x201C;Liste&#x201D; into &#x201C;List&#x201D;.</p>
<p><em>TranslationTransformer</em> is passed as a generic type parameter into the <em>MapDynamicControllerRoute</em>, and it must be registered into the DI container, as it will be resolved from there by the framework. At that point, we also register something called a <em>TranslationDatabase</em> into the DI, but that&#x2019;s just our custom demo helper &#x2013; we will get to that later.</p>
<div> <div id="crayon-5d67f85ed4548502343283" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
public class TranslationTransformer : DynamicRouteValueTransformer
{
    private readonly TranslationDatabase _translationDatabase;

    public TranslationTransformer(TranslationDatabase translationDatabase)
    {
        _translationDatabase = translationDatabase;
    }

    public override async ValueTask&lt;RouteValueDictionary&gt; TransformAsync(HttpContext httpContext, RouteValueDictionary values)
    {
        if (!values.ContainsKey(&quot;language&quot;) || !values.ContainsKey(&quot;controller&quot;) || !values.ContainsKey(&quot;action&quot;)) return values;

        var language = (string)values[&quot;language&quot;];
        var controller = await _translationDatabase.Resolve(language, (string)values[&quot;controller&quot;]);
        if (controller == null) return values;
        values[&quot;controller&quot;] = controller;

        var action = await _translationDatabase.Resolve(language, (string)values[&quot;action&quot;]);
        if (action == null) return values;
        values[&quot;action&quot;] = action;

        return values;
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> <div class="crayon-nums-content"></div> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed4548502343283-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">TranslationTransformer</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">DynamicRouteValueTransformer</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">readonly </span><span class="crayon-e">TranslationDatabase </span><span class="crayon-v">_translationDatabase</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-5"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">TranslationTransformer</span><span class="crayon-sy">(</span><span class="crayon-e">TranslationDatabase </span><span class="crayon-v">translationDatabase</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-7"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">_translationDatabase</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">translationDatabase</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4548502343283-10"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">override </span><span class="crayon-e">async </span><span class="crayon-v">ValueTask</span><span class="crayon-o">&lt;</span><span class="crayon-v">RouteValueDictionary</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e">TransformAsync</span><span class="crayon-sy">(</span><span class="crayon-e">HttpContext </span><span class="crayon-v">httpContext</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">RouteValueDictionary </span><span class="crayon-v">values</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4548502343283-12"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">ContainsKey</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;language&quot;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">ContainsKey</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;controller&quot;</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">values</span><span class="crayon-sy">.</span><span class="crayon-e">ContainsKey</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;action&quot;</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4548502343283-14"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">language</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-s">&quot;language&quot;</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-15"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">controller</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">await </span><span class="crayon-v">_translationDatabase</span><span class="crayon-sy">.</span><span class="crayon-e">Resolve</span><span class="crayon-sy">(</span><span class="crayon-v">language</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-s">&quot;controller&quot;</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4548502343283-16"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">controller</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-17"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-s">&quot;controller&quot;</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">controller</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-19"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">await </span><span class="crayon-v">_translationDatabase</span><span class="crayon-sy">.</span><span class="crayon-e">Resolve</span><span class="crayon-sy">(</span><span class="crayon-v">language</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-s">&quot;action&quot;</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4548502343283-20"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">action</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">values</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4548502343283-21"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">values</span><span class="crayon-sy">[</span><span class="crayon-s">&quot;action&quot;</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">action</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>In the transformer, we try to pick up our 3 route segments &#x2013; language, controller and action, and then try to locate their translations (or &#x201C;mappings&#x201D;) in a hypothetical translation DB. As we already mentioned, you&#x2019;d typically want to drive stuff like this from a DB as that would allow you to dynamically influence routes at any point in the application lifetime. To illustrate this, we use the <em>TranslationDatabase</em> helper I mentioned briefly later. It&#x2019;s here for demo purposes only &#x2013; I will show it for the record next &#x2013; though the code is not that important, instead, please close your eyes and imagine that it represents a real database connection.</p>
<div> <div id="crayon-5d67f85ed4555185941672" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
public class TranslationDatabase
{
    private static Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt; Translations = new Dictionary&lt;string, Dictionary&lt;string, string&gt;&gt;
    {
        {
            &quot;en&quot;, new Dictionary&lt;string, string&gt;
            {
                { &quot;orders&quot;, &quot;orders&quot; },
                { &quot;list&quot;, &quot;list&quot; }
            }
        },
        {
            &quot;de&quot;, new Dictionary&lt;string, string&gt;
            {
                { &quot;bestellungen&quot;, &quot;orders&quot; },
                { &quot;liste&quot;, &quot;list&quot; }
            }
        },
        {
            &quot;pl&quot;, new Dictionary&lt;string, string&gt;
            {
                { &quot;zamowienia&quot;, &quot;order&quot; },
                { &quot;lista&quot;, &quot;list&quot; }
            }
        },
    };

    public async Task&lt;string&gt; Resolve(string lang, string value)
    {
        var normalizedLang = lang.ToLowerInvariant();
        var normalizedValue = value.ToLowerInvariant();
        if (Translations.ContainsKey(normalizedLang) &amp;&amp; Translations[normalizedLang].ContainsKey(normalizedValue))
        {
            return Translations[normalizedLang][normalizedValue];
        }

        return null;
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> <div class="crayon-nums-content"></div> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed4555185941672-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">TranslationDatabase</span></div><div class="crayon-line" id="crayon-5d67f85ed4555185941672-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-v">Translations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-6"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-s">&quot;en&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5d67f85ed4555185941672-13"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-s">&quot;de&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5d67f85ed4555185941672-15"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-s">&quot;bestellungen&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">&quot;orders&quot;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-20"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-s">&quot;pl&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Dictionary</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-22"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-s">&quot;zamowienia&quot;</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">&quot;order&quot;</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-28"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">async </span><span class="crayon-v">Task</span><span class="crayon-o">&lt;</span><span class="crayon-t">string</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e">Resolve</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">lang</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-30"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">normalizedLang</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lang</span><span class="crayon-sy">.</span><span class="crayon-e">ToLowerInvariant</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5d67f85ed4555185941672-31"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">normalizedValue</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">value</span><span class="crayon-sy">.</span><span class="crayon-e">ToLowerInvariant</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-32"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Translations</span><span class="crayon-sy">.</span><span class="crayon-e">ContainsKey</span><span class="crayon-sy">(</span><span class="crayon-v">normalizedLang</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">Translations</span><span class="crayon-sy">[</span><span class="crayon-v">normalizedLang</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">ContainsKey</span><span class="crayon-sy">(</span><span class="crayon-v">normalizedValue</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d67f85ed4555185941672-34"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Translations</span><span class="crayon-sy">[</span><span class="crayon-v">normalizedLang</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-v">normalizedValue</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>At this point, we are pretty much there! With such a setup in your MVC app, you can start issuing requests to each of the three route definitions we mentioned earlier and call:</p>
<ul>
<li>for English &#x2013; <em>/en/orders/list</em></li>
<li>for German &#x2013; <em>/de/bestellungen/liste</em></li>
<li>for Polish &#x2013; <em>/pl/zamowienia/lista</em></li>
</ul>
<p>and in each case we will end up in our <em>OrdersController</em> and <em>List</em> action. Of course you can scale that approach further to many other controllers too. On top of that, changing anything, rolling out a new language or mapping a new route alias to the same controller/action in an already existing language is just a database-level change, which wouldn&#x2019;t require any application changes or even a restart.</p>
<p>Please note that in this article we only focused on translating routes as an example of a feature you may want to build using the new dynamic controller functionality of ASP.NET Core 3.0. If you wish to fully implement localization in your app you may want to read the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/localization?view=aspnetcore-3.0">localization guide</a> too, as you&#x2019;d likely want to correctly set the <em>CurrentCulture</em> based on the route value for our language.</p>
<p>Finally, I also wanted to mentioned that the example we looked at, explicitly used <em>{controller}</em> and <em>{action}</em> placeholders in the route template. This is not mandatory &#x2013; in other scenarios you could have defined a general purpose &#x201C;catch-all&#x201D; route &#x2013; and transform that into controller/action route values. </p>
<p>Such a catch-all route is a typical solution in CMS systems, where you have different dynamic &#x201C;pages&#x201D; &#x2013; and it could look like this:</p>
<div> <div id="crayon-5d67f85ed4564972441293" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
endpoints.MapDynamicControllerRoute&lt;PageTransformer&gt;(&quot;pages/{**slug}&quot;);</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5d67f85ed4564972441293-1"><span class="crayon-v">endpoints</span><span class="crayon-sy">.</span><span class="crayon-v">MapDynamicControllerRoute</span><span class="crayon-o">&lt;</span><span class="crayon-v">PageTransformer</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-s">&quot;pages/{**slug}&quot;</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>Then you have to transform the entire URL portion after <em>/pages</em> into something that represents an existing executable controller &#x2013; typically also using URL/route mapping from a database.</p>
<p>Hopefully you will find this article useful &#x2013; all the demo source code is, as usually, available on <a href="https://github.com/filipw/Strathweb.Samples.DynamicControllerRouting">Github</a>.</p> </div> </article>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>