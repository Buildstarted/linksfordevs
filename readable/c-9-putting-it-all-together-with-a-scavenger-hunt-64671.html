<!DOCTYPE html>
<html lang="en">
<head>
    <title>
C# 9: Putting it all together with a scavenger hunt - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="C# 9: Putting it all together with a scavenger hunt - linksfor.dev(s)"/>
    <meta property="article:author" content="Dave Brock"/>
    <meta property="og:description" content="Let&#x2019;s go through the major C# 9 features in a single post."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://daveabrock.com/2020/07/21/c-sharp-9-scavenger-hunt"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - C# 9: Putting it all together with a scavenger hunt</title>
<div class="readable">
        <h1>C# 9: Putting it all together with a scavenger hunt</h1>
            <div>by Dave Brock</div>
            <div>Reading time: 13-16 minutes</div>
        <div>Posted here: 23 Jul 2020</div>
        <p><a href="https://daveabrock.com/2020/07/21/c-sharp-9-scavenger-hunt">https://daveabrock.com/2020/07/21/c-sharp-9-scavenger-hunt</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section itemprop="text">
        
        <p>Here we are, friends: our last post in our C# 9 deep dive series. We’ve discussed a lot of topics, so I thought it’d be fun to bundle all we’ve learned into a single post. (You can think of this as a <a href="https://en.wikipedia.org/wiki/CliffsNotes">CliffsNotes</a> of the 10,000 or so words I’ve written about C# 9 so far.)</p>

<p>So, let’s go on a scavenger hunt! (I know I have readers from different countries and customs—where I’m from, it’s a fun game where you have to run around outside and find a number of miscellaneous things from a list). So this is how us nerds do it: inside, with air conditioning, geeking out about features that aren’t fully released yet.</p>

<p>I’ll be focusing on the how, not the why—you can see all my other posts for the full details on the concepts.</p>

<p>Of course, the complete and up-to-date feature set on C# 9 can be found by reviewing the <a href="https://github.com/dotnet/roslyn/blob/master/docs/Language%20Feature%20Status.md">Language Feature Status in GitHub</a>. As that moves along, I’ll probably have some more posts on any new features that weren’t covered during Build.</p>

<p>This is the sixth—and last!—post on my C# 9 deep dive series.</p>

<ul>
  <li>Post 1 - <a href="https://daveabrock.com/2020/06/29/c-sharp-9-deep-dive-inits">Init-only features</a></li>
  <li>Post 2 - <a href="https://daveabrock.com/2020/07/06/c-sharp-9-deep-dive-records">Records</a></li>
  <li>Post 3 - <a href="https://daveabrock.com/2020/07/06/c-sharp-9-pattern-matching">Pattern matching</a></li>
  <li>Post 4 - <a href="https://daveabrock.com/2020/07/09/c-sharp-9-top-level-programs">Top-level programs</a></li>
  <li>Post 5 - <a href="https://daveabrock.com/2020/07/14/c-sharp-9-target-typing-covariants">Target typing and covariant returns</a></li>
  <li>Post 6 (<em>this post</em>) - Putting it all together with a scavenger hunt</li>
</ul>

<p><strong>Heads up!</strong> C# 9 is still in preview mode, so much of this content might change. I will do my best to update it as I come across it, but that is not guaranteed. Have fun, but your experience may vary.</p>

<h2 id="our-scavenger-hunt-the-list">Our scavenger hunt: the list<a href="#our-scavenger-hunt-the-list" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>Here’s our list for our scavenger hunt. We’ll check it off as we go!</p>

<p>(Target typing <code>??</code> and <code>?:</code> and data member simplification have been removed from the list, as they do not compile in today’s previews.)</p>

<ul>
  <li>Init-only properties
    <ul>
      <li>Init accessors and readonly fields</li>
    </ul>
  </li>
  <li>Records
    <ul>
      <li><code>with</code> expressions</li>
      <li>Value-based equality</li>
      <li>Positional records</li>
      <li><code>with</code> expressions and inheritance</li>
      <li>Value-based equality and inheritance</li>
    </ul>
  </li>
  <li>Top-level programs</li>
  <li>Improved pattern matching
    <ul>
      <li>Simple type patterns</li>
      <li>Relational patterns</li>
      <li>Logical patterns</li>
    </ul>
  </li>
  <li>Improved target typing
    <ul>
      <li>Target-typed <code>new</code> expressions</li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="the-low-hanging-fruit-top-level-programs">The low-hanging fruit: top-level programs<a href="#the-low-hanging-fruit-top-level-programs" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>For a quick win, let’s make a top-level program. If you remember, this allows us to run a program without that pesky <code>Main</code> method.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"I am Groot."</span><span>);</span>
</code></pre></div></div>

<p>Well, that was easy! Knock one off the list.</p>

<ul>
  <li>Init-only properties
    <ul>
      <li>Init accessors and readonly fields</li>
    </ul>
  </li>
  <li>Records
    <ul>
      <li><code>with</code> expressions</li>
      <li>Value-based equality</li>
      <li>Positional records</li>
      <li><code>with</code> expressions and inheritance</li>
      <li>Value-based equality and inheritance</li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li>Improved pattern matching
    <ul>
      <li>Simple type patterns</li>
      <li>Relational patterns</li>
      <li>Logical patterns</li>
    </ul>
  </li>
  <li>Improved target typing
    <ul>
      <li>Target-typed <code>new</code> expressions</li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="init-only-properties">Init-only properties<a href="#init-only-properties" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>With init-only properties, we can use object initializers with immutable fields.</p>

<p>Let’s create an <code>Avenger</code> class:</p>

<div><div><pre><code><span>public</span> <span>class</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>string</span> <span>FirstName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>Now, we can use them with object initializers in C# 9.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>var</span> <span>ironMan</span> <span>=</span> <span>new</span> <span>Avenger</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Tony"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Stark"</span> <span>};</span>
<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>Avenger</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Banner"</span> <span>};</span>
<span>var</span> <span>blackWidow</span> <span>=</span> <span>new</span> <span>Avenger</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Natasha"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Romanova"</span><span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"Iron Man is </span><span>{</span><span>ironMan</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>ironMan</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Hulk is </span><span>{</span><span>hulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>hulk</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Black Widow is </span><span>{</span><span>blackWidow</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>blackWidow</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
</code></pre></div></div>

<p>Great! Let’s scratch another quick one off the list with some target typing. We can leave <code>ironMan</code> alone, but for the others we’ll replace <code>new Avenger</code> with just <code>new</code> and it’ll work the same.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>var</span> <span>ironMan</span> <span>=</span> <span>new</span> <span>Avenger</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Tony"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Stark"</span> <span>};</span>
<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Banner"</span> <span>};</span>
<span>var</span> <span>blackWidow</span> <span>=</span> <span>new</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Natasha"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Romanova"</span><span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"Iron Man is </span><span>{</span><span>ironMan</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>ironMan</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Hulk is </span><span>{</span><span>hulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>hulk</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Black Widow is </span><span>{</span><span>blackWidow</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>blackWidow</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
</code></pre></div></div>

<p>Now we have two more off the list, hooray!</p>

<ul>
  <li><del>Init-only properties</del>
    <ul>
      <li>Init accessors and readonly fields</li>
    </ul>
  </li>
  <li>Records
    <ul>
      <li><code>with</code> expressions</li>
      <li>Value-based equality</li>
      <li>Positional records</li>
      <li><code>with</code> expressions and inheritance</li>
      <li>Value-based equality and inheritance</li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li>Improved pattern matching
    <ul>
      <li>Simple type patterns</li>
      <li>Relational patterns</li>
      <li>Logical patterns</li>
    </ul>
  </li>
  <li><del>Improved target typing</del>
    <ul>
      <li><del>Target-typed <code>new</code> expressions</del></li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="init-accessors-and-readonly-fields">Init accessors and readonly fields<a href="#init-accessors-and-readonly-fields" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>As we’ve learned, <code>init</code> accessors can only be called when you initialize. If you try it after, you’ll be greeted with this:</p>

<pre><code>FirstName cannot be assigned to -- it is read-only
</code></pre>

<p>With these <code>init</code> accessors, you can also mutate read-only fields—which you previously could do with constructors. With only changing the <code>Avengers</code> class, do it this way:</p>

<div><div><pre><code><span>class</span> <span>Avenger</span>
<span>{</span>
    <span>private</span> <span>readonly</span> <span>string</span> <span>firstName</span><span>;</span>
    <span>private</span> <span>readonly</span> <span>string</span> <span>lastName</span><span>;</span>

    <span>public</span> <span>string</span> <span>FirstName</span>
    <span>{</span>
        <span>get</span> <span>=&gt;</span> <span>firstName</span><span>;</span>
        <span>init</span> <span>=&gt;</span> <span>firstName</span> <span>=</span> <span>(</span><span>value</span> <span>??</span> <span>throw</span> <span>new</span> <span>ArgumentNullException</span><span>(</span><span>nameof</span><span>(</span><span>FirstName</span><span>)));</span>
    <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span>
    <span>{</span>
        <span>get</span> <span>=&gt;</span> <span>lastName</span><span>;</span>
        <span>init</span> <span>=&gt;</span> <span>lastName</span> <span>=</span> <span>(</span><span>value</span> <span>??</span> <span>throw</span> <span>new</span> <span>ArgumentNullException</span><span>(</span><span>nameof</span><span>(</span><span>LastName</span><span>)));</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>OK, one more gone. On to records!</p>

<ul>
  <li><del>Init-only properties</del>
    <ul>
      <li><del>Init accessors and readonly fields</del></li>
    </ul>
  </li>
  <li>Records
    <ul>
      <li><code>with</code> expressions</li>
      <li>Value-based equality</li>
      <li>Positional records</li>
      <li><code>with</code> expressions and inheritance</li>
      <li>Value-based equality and inheritance</li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li>Improved pattern matching
    <ul>
      <li>Simple type patterns</li>
      <li>Relational patterns</li>
      <li>Logical patterns</li>
    </ul>
  </li>
  <li><del>Improved target typing</del>
    <ul>
      <li><del>Target-typed <code>new</code> expressions</del></li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="records">Records<a href="#records" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>Let’s convert our object to a record. This allows an entire object-like construct to be immutable and act like a value.</p>

<p>Change the <code>Avenger</code> object to a record and our program should still run as expected:</p>

<div><div><pre><code><span>record</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>string</span> <span>FirstName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre></div></div>

<h3 id="use-with-expressions">Use <code>with</code> expressions<a href="#use-with-expressions" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h3>

<p>With records, we can leverage <em>non-destructive mutation</em>, or a way to create new values from existing ones to resemble new state. We can make a copy of a record, and then change what we need. What if the Hulk had a little boy, who joins him and also turns green when he’s angry?</p>

<p>Change the main part of the program to this:</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>Avenger</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Banner"</span><span>};</span>
<span>var</span> <span>babyHulk</span> <span>=</span> <span>hulk</span> <span>with</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Baby"</span> <span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Hulk is </span><span>{</span><span>hulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>hulk</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Baby Hulk is </span><span>{</span><span>babyHulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>babyHulk</span><span>.</span><span>LastName</span><span>}</span><span>."</span><span>);</span>
</code></pre></div></div>

<h4 id="use-with-expressions-with-inheritance">Use <code>with</code> expressions with inheritance<a href="#use-with-expressions-with-inheritance" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h4>

<p>Records support inheritance. Structs do not. We can even use it with the <code>with</code> expression.</p>

<p>Change your program to this, and it works through the power of a hidden virtual method, which I showed off when <a href="https://daveabrock.com/2020/07/06/c-sharp-9-deep-dive-records">discussing records in-depth</a>.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>Hulk</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Banner"</span><span>,</span> <span>AngerLevel</span> <span>=</span> <span>90</span><span>};</span>
<span>var</span> <span>babyHulk</span> <span>=</span> <span>hulk</span> <span>with</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Baby"</span> <span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Hulk is </span><span>{</span><span>hulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>hulk</span><span>.</span><span>LastName</span><span>}</span><span>, "</span> <span>+</span>
                    <span>$"and anger level is </span><span>{</span><span>hulk</span><span>.</span><span>AngerLevel</span><span>}</span><span>."</span><span>);</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$"The Baby Hulk is </span><span>{</span><span>babyHulk</span><span>.</span><span>FirstName</span><span>}</span><span> </span><span>{</span><span>babyHulk</span><span>.</span><span>LastName</span><span>}</span><span>, "</span> <span>+</span>
                    <span>$"and anger level is </span><span>{</span><span>babyHulk</span><span>.</span><span>AngerLevel</span><span>}</span><span>."</span><span>);</span>

<span>record</span> <span>Hulk</span> <span>:</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>int</span> <span>AngerLevel</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>

<span>record</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>string</span> <span>FirstName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre></div></div>

<h4 id="use-value-based-equality-and-inheritance">Use value-based equality and inheritance<a href="#use-value-based-equality-and-inheritance" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h4>

<p>When it comes to records, C# 9 takes care of value-based equality for you through an <code>EqualityContract</code>. Every derived record overrides it and for equal comparison to occur the two objects must both have an <code>EqualityContract.</code></p>

<p>Because we are being immutable, we can create a new record, set the value back, and see the object comparison returns equal.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>// init-only properties</span>
<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>Hulk</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span><span>,</span> <span>LastName</span> <span>=</span> <span>"Banner"</span><span>,</span> <span>AngerLevel</span> <span>=</span> <span>90</span><span>};</span>
<span>var</span> <span>babyHulk</span> <span>=</span> <span>hulk</span> <span>with</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Baby"</span> <span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>Object</span><span>.</span><span>ReferenceEquals</span><span>(</span><span>hulk</span><span>,</span> <span>babyHulk</span><span>));</span> <span>// false</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>Object</span><span>.</span><span>Equals</span><span>(</span><span>hulk</span><span>,</span> <span>babyHulk</span><span>));</span> <span>// false</span>

<span>var</span> <span>backToRegularHulk</span> <span>=</span> <span>babyHulk</span> <span>with</span> <span>{</span> <span>FirstName</span> <span>=</span> <span>"Bruce"</span> <span>};</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>Object</span><span>.</span><span>Equals</span><span>(</span><span>hulk</span><span>,</span> <span>backToRegularHulk</span><span>));</span> <span>// true</span>

<span>record</span> <span>Hulk</span> <span>:</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>int</span> <span>AngerLevel</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>

<span>record</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>string</span> <span>FirstName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre></div></div>

<h3 id="positional-records">Positional records<a href="#positional-records" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h3>

<p>We can take a positional approach, where we hand out data from constructor arguments and we can use deconstruction to extract data.</p>

<div><div><pre><code><span>using</span> <span>System</span><span>;</span>

<span>var</span> <span>hulk</span> <span>=</span> <span>new</span> <span>Avenger</span><span>(</span><span>"Bruce"</span><span>,</span> <span>"Banner"</span><span>);</span>
<span>var</span> <span>(</span><span>first</span><span>,</span> <span>last</span><span>)</span> <span>=</span> <span>hulk</span><span>;</span>

<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>first</span><span>);</span> <span>// false</span>
<span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>last</span><span>);</span> <span>// false</span>

<span>public</span> <span>record</span> <span>Avenger</span>
<span>{</span>
    <span>string</span> <span>FirstName</span><span>;</span>
    <span>string</span> <span>LastName</span><span>;</span>
    <span>public</span> <span>Avenger</span><span>(</span><span>string</span> <span>firstName</span><span>,</span> <span>string</span> <span>lastName</span><span>)</span> 
      <span>=&gt;</span> <span>(</span><span>FirstName</span><span>,</span> <span>LastName</span><span>)</span> <span>=</span> <span>(</span><span>firstName</span><span>,</span> <span>lastName</span><span>);</span>
    <span>public</span> <span>void</span> <span>Deconstruct</span><span>(</span><span>out</span> <span>string</span> <span>firstName</span><span>,</span> <span>out</span> <span>string</span> <span>lastName</span><span>)</span> 
      <span>=&gt;</span> <span>(</span><span>firstName</span><span>,</span> <span>lastName</span><span>)</span> <span>=</span> <span>(</span><span>FirstName</span><span>,</span> <span>LastName</span><span>);</span>
<span>}</span>
</code></pre></div></div>

<p>That should do it for records! How are we doing so far?</p>

<ul>
  <li><del>Init-only properties</del>
    <ul>
      <li><del>Init accessors and readonly fields</del></li>
    </ul>
  </li>
  <li><del>Records</del>
    <ul>
      <li><del><code>with</code> expressions</del></li>
      <li><del>Value-based equality</del></li>
      <li><del>Positional records</del></li>
      <li><del><code>with</code> expressions and inheritance</del></li>
      <li><del>Value-based equality and inheritance</del></li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li>Improved pattern matching
    <ul>
      <li>Simple type patterns</li>
      <li>Relational patterns</li>
      <li>Logical patterns</li>
    </ul>
  </li>
  <li><del>Improved target typing</del>
    <ul>
      <li><del>Target-typed <code>new</code> expressions</del></li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="improved-pattern-matching">Improved pattern matching<a href="#improved-pattern-matching" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>C# 9 offers improved pattern matching for simple type patterns, relational patterns, and logical patterns.</p>

<p>In this example, we will calculate a monthly insurance cost depending on the Hulk’s <code>AngerLevel</code>. Our records look like this:</p>

<div><div><pre><code><span>record</span> <span>Hulk</span> <span>:</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>int</span> <span>AngerLevel</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>

<span>record</span> <span>Avenger</span>
<span>{</span>
    <span>public</span> <span>string</span> <span>FirstName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
    <span>public</span> <span>string</span> <span>LastName</span> <span>{</span> <span>get</span><span>;</span> <span>init</span><span>;</span> <span>}</span>
<span>}</span>
</code></pre></div></div>

<h3 id="simple-type-patterns">Simple type patterns<a href="#simple-type-patterns" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h3>

<p>Using simple type patterns, we don’t need that discard (<code>_</code>) operator to just declare the type. Now, we can just say <code>Hulk =&gt; 1000</code> in <code>CalculateInsuranceCost</code>:</p>

<div><div><pre><code><span>static</span> <span>int</span> <span>CalculateInsuranceCost</span><span>(</span><span>object</span> <span>hulk</span><span>)</span> <span>=&gt;</span>
    <span>hulk</span> <span>switch</span>
    <span>{</span>
        <span>Hulk</span> <span>t</span> <span>when</span> <span>t</span><span>.</span><span>AngerLevel</span> <span>&gt;</span> <span>90</span> <span>=&gt;</span> <span>10000</span><span>,</span>
        <span>Hulk</span> <span>t</span> <span>when</span> <span>t</span><span>.</span><span>AngerLevel</span> <span>&lt;</span> <span>20</span> <span>=&gt;</span> <span>100</span><span>,</span>
        <span>Hulk</span> <span>=&gt;</span> <span>1000</span><span>,</span>

        <span>_</span> <span>=&gt;</span> <span>throw</span> <span>new</span> <span>ArgumentException</span><span>(</span><span>"Not a known hulk"</span><span>,</span> <span>nameof</span><span>(</span><span>hulk</span><span>))</span>
    <span>;</span>
</code></pre></div></div>

<h3 id="relational-patterns">Relational patterns<a href="#relational-patterns" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h3>

<p>With relational patterns, we can use <code>&lt;</code>, <code>&gt;</code>, and so on with pattern matching. Take a look at this <code>CalculateInsuranceCost</code> method:</p>

<div><div><pre><code><span>static</span> <span>int</span> <span>CalculateInsuranceCost</span><span>(</span><span>Hulk</span> <span>hulk</span><span>)</span> <span>=&gt;</span>
  <span>hulk</span><span>.</span><span>AngerLevel</span> <span>switch</span>
  <span>{</span>
    <span>&gt;</span> <span>90</span> <span>=&gt;</span> <span>10000</span><span>,</span>
    <span>&lt;</span> <span>20</span> <span>=&gt;</span> <span>100</span><span>,</span>
    <span>_</span> <span>=&gt;</span> <span>1000</span><span>,</span>
  <span>};</span>
</code></pre></div></div>

<h3 id="logical-patterns">Logical patterns<a href="#logical-patterns" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h3>

<p>With logical patterns, you can use <code>and</code>, <code>or</code>, and <code>not</code>:</p>

<div><div><pre><code><span>static</span> <span>int</span> <span>CalculateInsuranceCost</span><span>(</span><span>Hulk</span> <span>hulk</span><span>)</span> <span>=&gt;</span>
  <span>hulk</span><span>.</span><span>AngerLevel</span> <span>switch</span>
  <span>{</span>
    <span>&gt;</span> <span>90</span> <span>=&gt;</span> <span>10000</span><span>,</span>
    <span>&lt;</span> <span>20</span> <span>and</span> <span>&lt;</span> <span>80</span> <span>=&gt;</span> <span>100</span><span>,</span>
    <span>_</span> <span>=&gt;</span> <span>1000</span><span>,</span>
  <span>};</span>
</code></pre></div></div>

<p>How’s our scavenger hunt going? Are we done yet?</p>

<ul>
  <li><del>Init-only properties</del>
    <ul>
      <li><del>Init accessors and readonly fields</del></li>
    </ul>
  </li>
  <li><del>Records</del>
    <ul>
      <li><del><code>with</code> expressions</del></li>
      <li><del>Value-based equality</del></li>
      <li><del>Positional records</del></li>
      <li><del><code>with</code> expressions and inheritance</del></li>
      <li><del>Value-based equality and inheritance</del></li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li><del>Improved pattern matching</del>
    <ul>
      <li><del>Simple type patterns</del></li>
      <li><del>Relational patterns</del></li>
      <li><del>Logical patterns</del></li>
    </ul>
  </li>
  <li><del>Improved target typing</del>
    <ul>
      <li><del>Target-typed <code>new</code> expressions</del></li>
    </ul>
  </li>
  <li>Covariant returns</li>
</ul>

<h2 id="covariant-returns">Covariant returns<a href="#covariant-returns" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>One item left: covariant returns. If you read the last post, this should be familiar to you. With return type covariance, you can override a base class method (that has a less-specific type) with one that returns a more specific type. To return some new objects, you could try this.</p>

<div><div><pre><code><span>public</span> <span>virtual</span> <span>Avenger</span> <span>GetHero</span><span>()</span>
<span>{</span>
    <span>// this is the parent (or base) class</span>
    <span>return</span> <span>new</span> <span>Avenger</span><span>();</span>
<span>}</span>

<span>public</span> <span>override</span> <span>Hulk</span> <span>GetHero</span><span>()</span>
<span>{</span>
    <span>// better!</span>
    <span>return</span> <span>new</span> <span>Hulk</span><span>();</span>
<span>}</span>
</code></pre></div></div>

<p>We did it!</p>

<ul>
  <li><del>Init-only properties</del>
    <ul>
      <li><del>Init accessors and readonly fields</del></li>
    </ul>
  </li>
  <li><del>Records</del>
    <ul>
      <li><del><code>with</code> expressions</del></li>
      <li><del>Value-based equality</del></li>
      <li><del>Positional records</del></li>
      <li><del><code>with</code> expressions and inheritance</del></li>
      <li><del>Value-based equality and inheritance</del></li>
    </ul>
  </li>
  <li><del>Top-level programs</del></li>
  <li><del>Improved pattern matching</del>
    <ul>
      <li><del>Simple type patterns</del></li>
      <li><del>Relational patterns</del></li>
      <li><del>Logical patterns</del></li>
    </ul>
  </li>
  <li><del>Improved target typing</del>
    <ul>
      <li><del>Target-typed <code>new</code> expressions</del></li>
    </ul>
  </li>
  <li><del>Covariant returns</del></li>
</ul>

<h2 id="and-thats-it-friends">And that’s it, friends<a href="#and-thats-it-friends" title="Permalink"><span>Permalink</span><!-- <i class="fa fa-link"></i> --></a></h2>

<p>Thank you so much for reading and providing feedback on all these articles. This won’t be the last I write about C#, obviously, but it does conclude my first pass on C# 9 features. As always, I’m excited to hear how things are going for you—don’t be shy!</p>

        
      </section></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>