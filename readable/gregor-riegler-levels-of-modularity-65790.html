<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Gregor Riegler &#xB7; Levels of Modularity - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Gregor Riegler &#xB7; Levels of Modularity - linksfor.dev(s)"/>
    <meta property="og:description" content="Peter &lt;Code Cop&gt; Kofler and I recently facilitated a refactoring workshop where we guided our participants to incrementally extract a microservice from a monolith. Similar workshops were mostly about the technology side of things and neglected the coding part which we found was sad. So we obviously decided to focus on hands on coding and to practice the refactoring steps needed for this task."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://gregorriegler.com/2020/08/08/levels-of-modularity.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Gregor Riegler &#xB7; Levels of Modularity</title>
<div class="readable">
        <h1>Gregor Riegler &#xB7; Levels of Modularity</h1>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 17 Aug 2020</div>
        <p><a href="https://gregorriegler.com/2020/08/08/levels-of-modularity.html">https://gregorriegler.com/2020/08/08/levels-of-modularity.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
    <p><a href="https://code-cop.org/">Peter &lt;Code Cop&gt; Kofler</a> and I recently facilitated a refactoring workshop where we guided our participants to incrementally extract a microservice from a monolith. Similar workshops were mostly about the technology side of things and neglected the coding part which we found was sad. So we obviously decided to focus on <strong>hands on coding</strong> and to practice the refactoring steps needed for this task.</p>

<p>We identified several milestones in this refactoring exercise which we then laid out as the <strong>‘Levels of Modularity’</strong>.
Each level represents a different kind of architecture that shows stronger or weaker modularity.</p>

<p>The model helps us to reason about our current architecture and decide where we want to go.
But most interestingly it acts as a play book how to extract a microservice.
It is feasible to go through each level and gradually increase the modularity in an attempt to extract the microservice.</p>

<h2 id="modularity-is-about-controlling-the-scope-of-change">Modularity is about controlling the scope of change</h2>
<p>Modularity is the property of a system to which degree it is composed of modules. 
Modularity is recursive - Modules may be further decomposed into submodules.
A module is a cohesive, loosely coupled, encapsulated and composable piece of software that does one thing.<br>
I don’t see modularity and its characteristics as absolutes. 
I rather see nuances and trade offs.
But it is all about controlling the scope of change.</p>

<ul>
  <li>Cohesion tells whether code that changes for the same reason, is put closely. We aim for high cohesion.</li>
  <li>Coupling tells to which degree a change in one part of the system affects another. 
Usually we aim for loose coupling so that we can change things independently. 
But the decoupling may come with a burden, which forces us to make trade offs. 
So we like to find the sweet spot.</li>
</ul>

<h2 id="level--1-the-distributed-monolith">Level -1: The Distributed Monolith</h2>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level99_distributed_monolith.svg" alt="Distributed Monolith" width="25%"></p>

<div>

  <table>
    <thead>
      <tr>
        <th>Drawing</th>
        <th>What it means</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Grey Box with Black Border</td>
        <td>The Unit of Deployment</td>
      </tr>
      <tr>
        <td>Colored Circles</td>
        <td>This is Code. The Color represents what the Code is doing work for. Every Color signifies another Feature / Behaviour.</td>
      </tr>
      <tr>
        <td>Lines connecting Things</td>
        <td>Dependencies</td>
      </tr>
    </tbody>
  </table>

</div>

<p>The structure tells that there has been an attempt to decompose the system into services.
But what it apparently does is it tears apart cohesive pieces of software and puts thick walls between them. 
None of the parts is able to perform useful work on its own. They have a strong coupling with their dependencies. 
<em>Shotgun Surgery<sup id="fnref:ShotgunSurgery" role="doc-noteref"><a href="#fn:ShotgunSurgery">1</a></sup></em> is the result. 
One has to touch many services when changing a single feature.
Another effect is that it’s mostly impossible to deploy any of those services independently.</p>

<p>I put this even below level 0, as i see negative modularity going on. 
In an attempt to increase its modularity we would first have to join the services again, only to arrive at level 0.</p>

<p>How did we get there?</p>
<ul>
  <li>We just didn’t understand how to properly decompose a system into modules.</li>
  <li>We drew the boundaries before we had a proper understanding of the domain we’re building.</li>
  <li>There are different developers working on different layers of the same thing. (<em>Conways Law<sup id="fnref:ConwaysLaw" role="doc-noteref"><a href="#fn:ConwaysLaw">2</a></sup></em>)</li>
</ul>

<h2 id="level-0">Level 0</h2>

<p>Monoliths with low cohesion and high coupling.</p>

<h3 id="level-0-the-big-ball-of-mud">Level 0: The Big Ball of Mud</h3>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level0.svg" alt="The Big Ball of Mud" width="25%"></p>

<p>This animal is completely disorganized. There is no recognizable structure, no abstraction, dependencies are intertwined. 
Strong coupling is the result. Changes in one area of the code lead to bugs in several other areas. 
It contains all sorts of <em>Code Smells<sup id="fnref:CodeSmell" role="doc-noteref"><a href="#fn:CodeSmell">3</a></sup></em> from <em>God Classes</em> to <em>Feature Envy</em>, <em>Dead Code</em> and <em>Change Preventers</em>.</p>

<p>Developers get there because of many reasons:</p>
<ul>
  <li>Lack of Experience</li>
  <li>Carelessness after feeling treated unfair</li>
  <li>Rushing Changes to try and meet a deadline</li>
  <li>Developers with different views working independently on the same codebase without sufficient alignment.</li>
  <li>Fluctuation</li>
</ul>

<h3 id="level-0-monolith-packaged-by-layer">Level 0: Monolith packaged by Layer</h3>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level0_layered.svg" alt="Monolith packaged by Layer" width="25%"></p>

<p>This is probably the most common monolith out there. 
Its package structure is often guided by frameworks and code generators that propose having packages like <code>controllers</code>, <code>domain</code> and <code>repositories</code> on the top level. 
This framing proposes <em>Separation of Concerns<sup id="fnref:SeparationOfConcerns" role="doc-noteref"><a href="#fn:SeparationOfConcerns">4</a></sup></em> which is a good thing. 
But the proposed way of having those packages on the top level obfuscates what the application is doing. “Controllers” does not provide any clue about what the app is doing.</p>

<h2 id="level-1">Level 1</h2>

<p>Monoliths with high cohesion.</p>

<h3 id="level-1-package-by-feature">Level 1: Package by Feature</h3>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level1.svg" alt="Package by Feature" width="25%"></p>

<p>Package by Feature is much more desirable. 
It puts the names of features like Order, Cart and User at the top level which are screaming<sup id="fnref:ScreamingArchitecture" role="doc-noteref"><a href="#fn:ScreamingArchitecture">5</a></sup>: “I am a Shop!”.
It helps us to quickly find the code we need to change. 
As the cohesion is increased, we typically just have to touch a single top level package when changing a feature. 
There is no <em>information hiding<sup id="fnref:InformationHiding" role="doc-noteref"><a href="#fn:InformationHiding">6</a></sup></em> going on between the features though. 
A code within one feature knows about the internals of another feature and has access to it. 
For Example: Feature A may fetch data from the Repository of Feature B, or use its business logic. 
So there is still coupling going on.</p>

<h3 id="level-1-features-but-layered-inside">Level 1: Features, but layered inside</h3>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level1_layered.svg" alt="Features, but layered inside" width="25%"></p>

<p><em>Separation of Concerns</em><sup id="fnref:SeparationOfConcerns:1" role="doc-noteref"><a href="#fn:SeparationOfConcerns">4</a></sup> again, just inside feature packages.
We do this when we want to isolate our domain, our <em>Happy Zone<sup id="fnref:UniversalArchitecture" role="doc-noteref"><a href="#fn:UniversalArchitecture">7</a></sup></em> from infrastructure code.
Or maybe we just like to organize our many files and put them into distinct folders to gain a better understanding of what a file is about.</p>

<h2 id="level-2-the-modular-monolith">Level 2: The Modular Monolith</h2>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level2.svg" alt="The Modular Monolith" width="25%"></p>

<p>A Monolith with both low coupling and high cohesion.</p>

<p>Feature packages turn modules. 
Each module now has a clear api which is the only way to access it. 
One module doesn’t know about the inner details of another module anymore. 
So they are encapsulated, and the coupling is further reduced. 
But as the module does not encapsulate its data, the modules are still coupled by the shared database.</p>

<p>Increasing the modularity further than this may come with a significant cost.</p>

<h2 id="level-3-the-microservice-ready-monolith">Level 3: The Microservice Ready Monolith</h2>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level3.svg" alt="The Microservice Ready Monolith" width="25%"></p>

<p>The coupling of a shared database is removed. 
Each module now uses its own data. 
Could be a separate database, or just separate tables within the same database. 
As long as there is no hidden coupling like a foreign key, we consider it as separated.
Sometimes, two or more modules need to access the same data.
In this case they would access the data through the module that owns it, or have a separate copy of the data.
In case of a copy we would choose a data model that perfectly fits the needs of the respective module. 
The data might be updated through events.</p>

<p>It’s still a monolith, but a very decoupled one. 
Extracting a microservice is very easy from this level.</p>

<h2 id="level-4-microservices">Level 4: Microservices</h2>

<p><img src="https://gregorriegler.com/assets/modularity/modularity_level4_microservice.svg" alt="Microservices" width="25%"></p>

<p>We can now deploy, as well as scale each service independently.
Each microservice has a strong autonomy and can be developed by its own team that uses the tech that best fits the services job.</p>

<p>But it comes at a cost and a lot of pain:</p>
<ul>
  <li>Hard to Integrate.</li>
  <li>Hard to Maintain.</li>
  <li>An organizational challenge.</li>
  <li>Lot’s of additional Technology might be needed.
    <ul>
      <li>API Gateway</li>
      <li>Event Bus</li>
      <li>Container Orchestration</li>
      <li>Configuration Broker</li>
      <li>Contract Testing</li>
      <li>Bulkheads</li>
      <li>Circuit Breakers</li>
      <li>Distributed Tracing</li>
      <li>Distributed Logging</li>
      <li>Service Registry</li>
      <li>and so on</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>“Don’t even consider microservices unless you have a system that’s too complex to manage as a monolith.”</p>

  <p>~Martin Fowler</p>
</blockquote>

<h2 id="conclusion">Conclusion</h2>

<p>The <strong>Levels of Modularity</strong> provide a model to reason about an architecture and help decide on where you want to go. 
The higher the level, the more modular an architecture is.</p>

<p>Also, we may use the <strong>Levels of Modularity</strong> as a cook book to refactor to a more modular architecture. 
We want to go level by level incrementally.</p>

<p>To get from a <em>Big Ball of Mud (Level 0)</em> to a <em>Modular Monolith (Level 2)</em>, we first want to find the features and collect them in distinct packages to arrive at <em>Package by Feature (Level 1)</em>. 
Only then would we decouple the feature packages to finally arrive at a <em>Modular Monolith (Level 2)</em>. 
We may even apply the <em>Strangler Pattern<sup id="fnref:StranglerPattern" role="doc-noteref"><a href="#fn:StranglerPattern">8</a></sup></em> and carry one feature at a time through all levels.</p>



    



<p><span>
      <span>
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>&nbsp;<span>Modularity</span>
    </span>
  
    <span>
      <span>
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>&nbsp;<span>Design</span>
    </span>
  
    <span>
      <span>
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"></path>
</svg>
      </span>&nbsp;<span>Architecture</span>
    </span>
  
</p>
  </div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>