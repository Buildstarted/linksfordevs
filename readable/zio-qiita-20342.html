<!DOCTYPE html>
<html lang="en">
<head>
    <title>
ZIO&#x3067;&#x306E;&#x7E70;&#x308A;&#x8FD4;&#x3057;&#x3068;&#x30EA;&#x30C8;&#x30E9;&#x30A4;&#x51E6;&#x7406; - Qiita - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="ZIO&#x3067;&#x306E;&#x7E70;&#x308A;&#x8FD4;&#x3057;&#x3068;&#x30EA;&#x30C8;&#x30E9;&#x30A4;&#x51E6;&#x7406; - Qiita - linksfor.dev(s)"/>
    <meta property="article:author" content="@MitsutakaTakedaFollow"/>
    <meta property="og:description" content="# `Schedule[A, B]`&#xA;&#xA;ZIO&#x306F;&#x7E70;&#x308A;&#x8FD4;&#x3057;&#x3068;&#x30EA;&#x30C8;&#x30E9;&#x30A4;&#x51E6;&#x7406;&#x3092;`Schedule[A, B]`&#x3068;&#x3044;&#x3046;&#x578B;&#x3067;&#x62BD;&#x8C61;&#x5316;&#x3057;&#x540C;&#x7B49;&#x306B;&#x6271;&#x3044;&#x307E;&#x3059;&#x3002;&#xA;&#xA;`Schedule[A, B]`&amp;lt;sup&amp;gt;a&amp;lt;/sup&amp;gt;&#x306F;&#x4EE5;&#x4E0B;&#x3092;&#x8868;&#x73FE;..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://qiita.com/MitsutakaTakeda/items/178eee8feea905efb7bb"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ğŸ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - ZIO&#x3067;&#x306E;&#x7E70;&#x308A;&#x8FD4;&#x3057;&#x3068;&#x30EA;&#x30C8;&#x30E9;&#x30A4;&#x51E6;&#x7406; - Qiita</title>
<div class="readable">
        <h1>ZIO&#x3067;&#x306E;&#x7E70;&#x308A;&#x8FD4;&#x3057;&#x3068;&#x30EA;&#x30C8;&#x30E9;&#x30A4;&#x51E6;&#x7406; - Qiita</h1>
            <div>by @MitsutakaTakedaFollow</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 07 May 2019</div>
        <p><a href="https://qiita.com/MitsutakaTakeda/items/178eee8feea905efb7bb">https://qiita.com/MitsutakaTakeda/items/178eee8feea905efb7bb</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><div><section itemprop="articleBody"><div id="personal-public-article-body"><div>


<p>ZIOã¯ç¹°ã‚Šè¿”ã—ã¨ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’<code>Schedule[A, B]</code>ã¨ã„ã†å‹ã§æŠ½è±¡åŒ–ã—åŒç­‰ã«æ‰±ã„ã¾ã™ã€‚</p>

<p><code>Schedule[A, B]</code><sup>a</sup>ã¯ä»¥ä¸‹ã‚’è¡¨ç¾ã™ã‚‹ä¸å¤‰ãªå€¤ã§ã™ã€‚</p>

<ul>
<li>
<code>A</code>å‹ã®å€¤ã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚Š<code>B</code>å‹ã®å€¤ã‚’å‡ºåŠ›ã™ã‚‹ã€‚</li>
<li>å…¥åŠ›ã«åŸºã¥ã„ã¦è¨ˆç®—ã‚’çµ‚äº†ã™ã‚‹ã‹ã€é…å»¶ã‚’æŒŸã‚“ã§ç¶™ç¶šã™ã‚‹ã‹æ±ºå®šã™ã‚‹ã€‚</li>
</ul>

<p><code>Schedule[A, B]</code>ã‚’å°å…¥ã™ã‚‹ã¨ã€ç¹°ã‚Šè¿”ã—ã¯è¨ˆç®—ã®æˆåŠŸçµæœ<code>S</code>ã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚‹<code>Schedule[S, B]</code>ã¨ã—ã¦ã€ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã¯è¨ˆç®—ã®å¤±æ•—ç†ç”±<code>E</code>ã‚’å…¥åŠ›ã¨ã—ã¦å—ã‘å–ã‚‹<code>Schedule[E, B]</code>ã¨ã—ã¦è¡¨ç¾ã§ãã¾ã™ã€‚</p>

<p>è¨ˆç®—ã®<code>repeat</code>ã¨<code>retry</code>ãƒ¡ã‚½ãƒƒãƒ‰ã«<code>Schedule</code>ã®å€¤ã‚’æ¸¡ã™ã¨ã€ãã®è¨ˆç®—ã®ç¹°ã‚Šè¿”ã—ã¨ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>



<h2>
<span id="never"></span><a href="#never"><i></i></a><code>never</code>
</h2>

<p>è¨ˆç®—ã‚’å®Ÿè¡Œã—ãªãã—ã¾ã™ã€‚</p>

<p>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯"Hello"ã‚’è¡¨ç¤ºã›ãšçµ‚äº†ã—ã¾ã›ã‚“ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule.never"</span> <span>should</span> <span>{</span>
    <span>"never execute the effect"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span><span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>)).</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>never</span><span>))</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<h2>
<span id="forever-and-identity"></span><a href="#forever-and-identity"><i></i></a><code>forever</code> and <code>identity</code>
</h2>

<p><code>forever</code>ã¨<code>identity</code>ã¯è¨ˆç®—ã‚’åˆ¶é™ãªãç¹°ã‚Šè¿”ã—ã¾ã™ã€‚</p>

<p>1ç•ªç›®ã®ã‚±ãƒ¼ã‚¹ã§ã¯1ç§’é–“"Hello"ã‚’ç¹°ã‚Šè¿”ã—è¡¨ç¤ºã—ã¾ã™ã€‚<a href="#%E8%A3%9C%E8%B6%B3"><sup>c</sup></a></p>

<p>2ç•ªç›®ã®ã‚±ãƒ¼ã‚¹ã§ã¯æˆåŠŸã™ã‚‹ã¾ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚</p>

<p>3ç•ªç›®ã®ã‚±ãƒ¼ã‚¹ã§ã¯<code>repeat(forever)</code>ã¨ã—ã¦åˆ¶é™ãªãç¹°ã‚Šè¿”ã™ã‚ˆã†ã«æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚2ç•ªç›®ã®ã‚±ãƒ¼ã‚¹<code>retry(forever)</code>ã§è¦‹ãŸã‚ˆã†ã«<code>retry</code>ã¯æœ€åˆã®æˆåŠŸã®æ™‚ç‚¹ã§è¨ˆç®—ãŒçµ‚äº†ã—ã€<code>repeat</code>ã¯æœ€åˆã®å¤±æ•—ã®æ™‚ç‚¹ã§è¨ˆç®—ãŒçµ‚äº†ã—ã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule.forever"</span> <span>should</span> <span>{</span>
    <span>"repeat the successful effect forever"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>)).</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>forever</span><span>)</span>
          <span>.</span><span>race</span><span>(</span><span>UIO</span><span>(</span><span>"done"</span><span>).</span><span>delay</span><span>(</span><span>Duration</span><span>(</span><span>1</span><span>,</span> <span>TimeUnit</span><span>.</span><span>SECONDS</span><span>)))</span>
      <span>)</span>
    <span>}</span>
    <span>"retry the effect until succeed"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>2</span><span>)</span>
      <span>unsafeRun</span><span>(</span>
        <span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>()).</span><span>retry</span><span>(</span><span>Schedule</span><span>.</span><span>forever</span><span>)</span> <span>&gt;&gt;=</span> <span>(</span><span>s</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>println</span><span>(</span><span>s</span><span>)))</span>
      <span>)</span>
    <span>}</span>
    <span>"repeat does not repeat failed effect"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>2</span><span>)</span>
      <span>assertThrows</span><span>[</span><span>FiberFailure</span><span>]</span> <span>{</span>
        <span>unsafeRun</span><span>(</span>
          <span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>()).</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>forever</span><span>)</span> <span>&gt;&gt;=</span> <span>(</span><span>s</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>println</span><span>(</span><span>s</span><span>)))</span>
        <span>)</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p><code>identity</code>ã¯<code>forever</code>ã¨åŒã˜ãåˆ¶é™ãªãç¹°ã‚Šè¿”ã™<code>Schedule</code>ã§ã™ã€‚<code>identity</code>ã¯<code>Schedule[A, A]</code>å‹ã§å…¥åŠ›ã‚’ãã®ã¾ã¾å‡ºåŠ›ã™ã‚‹ã®ã«å¯¾ã—ã¦ã€<code>forever</code>ã¯<code>Schedule[Any, Int]</code>å‹ã§å…¥åŠ›ã‚’ç ´æ£„ã—ã¦ç¾åœ¨ã®ç¹°ã‚Šè¿”ã—ã®å›æ•°ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚å‡ºåŠ›ã®é•ã„ã¯å¾Œè¿°ã®<a href="#Schedule%E3%81%AE%E5%90%88%E6%88%90">Scheduleã®åˆæˆ</a>ã§æ„å‘³ã‚’æŒã¤ã“ã¨ã«ãªã‚Šã¾ã™ã€‚</p>

<h2>
<span id="recurse-and-once"></span><a href="#recurse-and-once"><i></i></a><code>recurse</code> and <code>once</code>
</h2>

<p>ç¹°ã‚Šè¿”ã—ã®å›æ•°ã‚’æŒ‡å®šã™ã‚‹å ´åˆã«ã¯<code>recurse</code>ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<p><code>recurse</code>ã§æŒ‡å®šã™ã‚‹"ç¹°ã‚Šè¿”ã—ã®å›æ•°"ã¯ã€æœ€åˆã®è¨ˆç®—ã®å®Ÿè¡Œå›æ•°ã‚’å«ã¿ã¾ã›ã‚“ã€‚ãã®ãŸã‚<code>repeat</code>ã«<code>recurse</code>ã‚’æ¸¡ã—ãŸã¨ãå®Ÿéš›ã«è¨ˆç®—ã¯<code>recurse</code>ã§æŒ‡å®šã—ãŸå›æ•°ï¼‹ï¼‘ã«ãªã‚Šã¾ã™ã€‚åŒæ§˜ã«<code>retry</code>ã«æ¸¡ã—ãŸã¨ãã‚‚<code>recurse</code>ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å›æ•°ã§ã¯ãªããƒªãƒˆãƒ©ã‚¤ã®å›æ•°ã«ãªã‚Šã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule recurse"</span> <span>should</span> <span>{</span>
    <span>"repeat the effect for specified numbers"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>)).</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>2</span><span>))</span>
      <span>)</span>
      <span>// prints out "Hello" three times:</span>
      <span>// Hello</span>
      <span>// Hello</span>
      <span>// Hello</span>
    <span>}</span>
    <span>"retry the effect for specified numbers"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>2</span><span>)</span>
      <span>unsafeRun</span><span>(</span>
        <span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>()).</span><span>retry</span><span>(</span><span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>2</span><span>))</span> <span>&gt;&gt;=</span> <span>(</span><span>s</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>println</span><span>(</span><span>s</span><span>)))</span>
        <span>// prints out: Succeeded at 2 attempt</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p><code>once</code>ã¯<code>recurse(1)</code>ã¨åŒç­‰ã§ã™ã€‚</p>

<h2>
<span id="dowhile-and-dountil"></span><a href="#dowhile-and-dountil"><i></i></a><code>doWhile</code> and <code>doUntil</code>
</h2>

<p>å…¥åŠ›å€¤ã«åŸºã¥ã„ã¦è¨ˆç®—ã®ç¶™ç¶šã‹çµ‚äº†ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã«ã¯<code>doWhile</code>ã‚„<code>doUntil</code>ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<p><code>doWhile</code>ã¯å…¥åŠ›å€¤ã«å¯¾ã™ã‚‹è¿°èªã‚’å—ã‘å–ã‚Šã€"ãã®è¿°èªãŒçœŸã§ã‚ã‚‹é–“"è¨ˆç®—ã‚’ç¶™ç¶šã—ã¾ã™ã€‚</p>

<p>ãƒªãƒ”ãƒ¼ãƒˆã®å›æ•°ã‚„ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«ã‚ˆã£ã¦ã€ç¹°ã‚Šè¿”ã—ã€ã¾ãŸã¯ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã‚’ç¶™ç¶šã™ã‚‹ã‹åˆ¤å®šã§ãã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule doWhile"</span> <span>should</span> <span>{</span>
    <span>"repeat an effect while a predicate is satisfied"</span> <span>in</span> <span>{</span>
      <span>var</span> <span>i</span> <span>=</span> <span>0</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>{</span> <span>i</span> <span>+=</span> <span>1</span><span>;</span> <span>i</span> <span>}.</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>doWhile</span><span>(</span><span>_</span> <span>&lt;</span> <span>3</span><span>))</span> <span>&gt;&gt;=</span> <span>(</span><span>n</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>n</span><span>))</span>
      <span>)</span> <span>shouldBe</span> <span>3</span>
    <span>}</span>
    <span>"retry an effect while a predicate is satisfied"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>2</span><span>)</span>
      <span>unsafeRun</span><span>(</span><span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>()).</span><span>retry</span><span>(</span><span>Schedule</span><span>.</span><span>doWhile</span><span>{(</span><span>e</span><span>:</span> <span>Throwable</span><span>)</span> <span>=&gt;</span> <span>e</span> <span>match</span> <span>{</span>
        <span>case</span> <span>NonFatal</span><span>(</span><span>_</span><span>)</span> <span>=&gt;</span> <span>true</span>
      <span>}}).</span><span>either</span><span>)</span> <span>shouldBe</span> <span>a</span><span>[</span><span>Right</span><span>[</span><span>_</span>, <span>_</span><span>]]</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p><code>doUntil</code>ã¯å…¥åŠ›å€¤ã«å¯¾ã™ã‚‹è¿°èªã‚’å—ã‘å–ã‚Šã€"ãã®è¿°èªãŒçœŸã«ãªã‚‹ã¾ã§"è¨ˆç®—ã‚’ç¶™ç¶šã—ã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule doUntil"</span> <span>should</span> <span>{</span>
    <span>// doUntil is equivalent to doWhile negated</span>
    <span>"repeat an effect until a predicate is satisfied"</span> <span>in</span> <span>{</span>
      <span>var</span> <span>i</span> <span>=</span> <span>0</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>{</span> <span>i</span> <span>+=</span> <span>1</span><span>;</span> <span>i</span> <span>}.</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>doUntil</span><span>(</span><span>_</span> <span>&gt;=</span> <span>3</span><span>))</span> <span>&gt;&gt;=</span> <span>(</span><span>n</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>n</span><span>))</span>
      <span>)</span> <span>shouldBe</span> <span>3</span>
    <span>}</span>
    <span>"retry an effect while a predicate is satisfied"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>2</span><span>)</span>
      <span>unsafeRun</span><span>(</span><span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>()).</span><span>retry</span><span>(</span><span>Schedule</span><span>.</span><span>doUntil</span><span>{(</span><span>e</span><span>:</span> <span>Throwable</span><span>)</span> <span>=&gt;</span> <span>e</span> <span>match</span> <span>{</span>
        <span>case</span> <span>NonFatal</span><span>(</span><span>_</span><span>)</span> <span>=&gt;</span> <span>false</span>
      <span>}}).</span><span>either</span><span>)</span> <span>shouldBe</span> <span>a</span><span>[</span><span>Right</span><span>[</span><span>_</span>, <span>_</span><span>]]</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<h2>
<span id="spaced-linear-fibonacci-and-exponential"></span><a href="#spaced-linear-fibonacci-and-exponential"><i></i></a><code>spaced</code>, <code>linear</code>, <code>fibonacci</code>, and <code>exponential</code>
</h2>

<p>ç¹°ã‚Šè¿”ã—ã‚„ãƒªãƒˆãƒ©ã‚¤ã®é–“éš”ã‚’æŒ‡å®šã§ãã¾ã™ã€‚</p>

<p><code>spaced</code>ã¯æŒ‡å®šã•ã‚ŒãŸé–“éš”ã§ç­‰é–“éš”ã§è¨ˆç®—ã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚100ãƒŸãƒªç§’ã”ã¨ã«"Hello"ã‚’è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule spaced"</span> <span>should</span> <span>{</span>
    <span>"repeat an effect "</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>))</span>
          <span>.</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>spaced</span><span>(</span><span>Duration</span><span>(</span><span>100</span><span>,</span> <span>TimeUnit</span><span>.</span><span>MILLISECONDS</span><span>)))</span>
          <span>.</span><span>race</span><span>(</span><span>UIO</span><span>(()).</span><span>delay</span><span>(</span><span>Duration</span><span>(</span><span>1</span><span>,</span> <span>TimeUnit</span><span>.</span><span>SECONDS</span><span>)))</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p><code>linear</code>ã€<code>fibonacci</code>ã€<code>exponential</code>ã¯ã€åˆæœŸã®é–“éš”ã‚’å—ã‘å–ã‚Šç¹°ã‚Šè¿”ã—æ¯ã«é–“éš”ã‚’å¢—åŠ ã•ã›ã¦ã„ãã¾ã™ã€‚100msecã‚’åˆæœŸã®é–“éš”ã¨ã—ãŸå ´åˆã®å®Ÿè¡Œã®é–“éš”ã¯ä»¥ä¸‹ã®ã‚°ãƒ©ãƒ•ã®ã‚ˆã†ã«æ¨ç§»ã—ã¾ã™ã€‚</p>

<p><a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F12045%2F4c8c3640-07e9-2378-dc5f-8d6775026b63.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e8c5fcb87deb6e3976b5a105ca4a4ebf" target="_blank" rel="nofollow noopener"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F12045%2F4c8c3640-07e9-2378-dc5f-8d6775026b63.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=e8c5fcb87deb6e3976b5a105ca4a4ebf" alt="chart.png" data-canonical-src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/12045/4c8c3640-07e9-2378-dc5f-8d6775026b63.png" srcset="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F12045%2F4c8c3640-07e9-2378-dc5f-8d6775026b63.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;w=1400&amp;fit=max&amp;s=d24ca562017fd25f01f4f488972b8445 1x" loading="lazy"></a></p>



<p>è¤‡æ•°ã®<code>Schedule</code>ã‹ã‚‰æ–°ã—ã„<code>Schedule</code>ã‚’åˆæˆã§ãã¾ã™ã€‚</p>

<h2>
<span id="ç©ã¨å’Œ"></span><a href="#%E7%A9%8D%E3%81%A8%E5%92%8C"><i></i></a>ç©(&amp;&amp;)ã¨å’Œ(||)</h2>

<p><code>Schedule</code>ã«ã¯ç©ã¨å’Œã®æ¼”ç®—ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<table>
<thead>
<tr>
<th></th>
<th><code>s1</code></th>
<th><code>s2</code></th>
<th><code>s1 &amp;&amp; s2</code></th>
<th>
<code>s1 or s2</code><sup>â€»</sup>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¶™ç¶šã¾ãŸã¯çµ‚äº†</td>
<td>s1ã®æ¡ä»¶</td>
<td>s2ã®æ¡ä»¶</td>
<td>s1ã¨s2ã®æ¡ä»¶ã®è«–ç†ç©</td>
<td>s1ã¨s2ã®æ¡ä»¶ã®è«–ç†å’Œ</td>
</tr>
<tr>
<td>é–“éš”</td>
<td>s1ã®é–“éš”</td>
<td>s2ã®é–“éš”</td>
<td>s1ã¨s2ã®é–“éš”ã®max</td>
<td>s1ã¨s2ã®é–“éš”ã®min</td>
</tr>
<tr>
<td>çµæœ</td>
<td>s1ã®çµæœ</td>
<td>s2ã®çµæœ</td>
<td>s1ã¨s2ã®çµæœã®<code>pair: (B1, B2)</code>
</td>
<td>s1ã¨s2ã®çµæœã®<code>pair: (B1, B2)</code>
</td>
</tr>
</tbody>
</table>

<p>100msecã®ç­‰é–“éš”(<code>s1 = spaced(100msec)</code>)ã§3å›ç¹°ã‚Šè¿”ã™(<code>s2 = recurse(3)</code>)ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Schedule operator"</span> <span>should</span> <span>{</span>
    <span>"compose multiple schedules"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>))</span>
          <span>.</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>spaced</span><span>(</span><span>Duration</span><span>(</span><span>100</span><span>,</span> <span>TimeUnit</span><span>.</span><span>MILLISECONDS</span><span>))</span> <span>&amp;&amp;</span> <span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>3</span><span>))</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p>2æ—¥ãŠãã€ã¾ãŸã¯ã€æ¯é€±ç¹°ã‚Šè¿”ã™ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å’Œã§å®šç¾©ã§ãã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Union"</span> <span>should</span> <span>{</span>
    <span>"execute computation when either one of schedules triggers"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>// prints "Hello" every two days or every week</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>))</span>
          <span>.</span><span>repeat</span><span>(</span><span>Schedule</span><span>.</span><span>spaced</span><span>(</span><span>Duration</span><span>(</span><span>2</span><span>,</span> <span>TimeUnit</span><span>.</span><span>DAYS</span><span>))</span> <span>||</span> <span>Schedule</span><span>.</span><span>spaced</span><span>(</span><span>Duration</span><span>(</span><span>7</span><span>,</span> <span>TimeUnit</span><span>.</span><span>DAYS</span><span>)))</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p>ç©ã«ã¯åˆæˆã—ãŸ<code>Schedule</code>ã®çµæœã‚’ç„¡è¦–ã™ã‚‹<code>*&gt;</code>ã¨<code>&lt;*</code>ã¨ã„ã†æ¼”ç®—å­ã‚‚ã‚ã‚Šã¾ã™ã€‚</p>

<h2>
<span id="andthen-and-andtheneither"></span><a href="#andthen-and-andtheneither"><i></i></a><code>andThen</code> and <code>andThenEither</code>
</h2>

<p>1ã¤ç›®ã®<code>Schedule</code>ã®å®Œäº†å¾Œã«2ã¤ç›®ã®<code>Schedule</code>ã«ç§»è¡Œã™ã‚‹<code>Schedule</code>ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã«<code>andThen</code>ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚</p>

<p>æœ€åˆã®4å›ã®ç¹°ã‚Šè¿”ã—ã¯æŒ‡æ•°é–¢æ•°çš„ã«é–“éš”ã‚’åºƒã’ã¦ã„ãï¼ˆ1ã¤ç›®ã®<code>Schedule</code>)ã€ãã®ã‚ã¨ç­‰é–“éš”ã«ç¹°ã‚Šè¿”ã™ï¼ˆ2ã¤ç›®ã®<code>Schedule</code>ï¼‰ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"andThen"</span> <span>should</span> <span>{</span>
    <span>"complete the first schedule and then execute the second"</span> <span>in</span> <span>{</span>
      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>))</span>
          <span>.</span><span>repeat</span><span>(</span>
            <span>(</span><span>Schedule</span><span>.</span><span>exponential</span><span>(</span><span>Duration</span><span>(</span><span>100</span><span>,</span> <span>TimeUnit</span><span>.</span><span>MILLISECONDS</span><span>))</span> <span>&amp;&amp;</span>
              <span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>4</span><span>))</span> <span>andThen</span>
              <span>(</span><span>Schedule</span><span>.</span><span>spaced</span><span>(</span><span>Duration</span><span>(</span><span>2</span><span>,</span> <span>TimeUnit</span><span>.</span><span>SECONDS</span><span>))</span> <span>&amp;&amp;</span>
                <span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>2</span><span>))</span>
          <span>)</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p><code>andThen</code>ã¯1ã¤ç›®ã®<code>Schedule</code>ã®çµæœã¨2ã¤ç›®ã®<code>Schedule</code>ã®çµæœã‚’ãƒãƒ¼ã‚¸ã—ã¦ã€ã©ã¡ã‚‰ã®<code>Schedule</code>ã®çµæœã‹åŒºåˆ¥ã§ããªããªã‚Šã¾ã™ã€‚<code>andThenEither</code>ã§<code>Schedule</code>ã‚’åˆæˆã™ã‚‹ã¨1ã¤ã‚ã®çµæœã‚’<code>Left</code>ã«2ã¤ç›®ã®çµæœã‚’<code>Right</code>ã«æ ¼ç´ã™ã‚‹<code>Either</code>å‹ã®çµæœã‚’è¿”ã—ã¾ã™ã€‚</p>



<h2>
<span id="jittered"></span><a href="#jittered"><i></i></a><code>jittered</code>
</h2>

<p><code>Schedule</code>ã®é–“éš”ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«èª¿æ•´ã—ã¾ã™ã€‚</p>

<p><code>c</code>ç•ªç›®ã®ãƒªãƒˆãƒ©ã‚¤ã®é–“éš”ãŒ<span><span id="MJXp-Span-1"><span id="MJXp-Span-2">d</span><span id="MJXp-Span-3">âˆˆ</span><span id="MJXp-Span-4">[</span><span id="MJXp-Span-5">0</span><span id="MJXp-Span-6">,</span><span id="MJXp-Span-7"><span id="MJXp-Span-8">ãƒ™</span></span><span id="MJXp-Span-9"><span id="MJXp-Span-10">ãƒ¼</span></span><span id="MJXp-Span-11"><span id="MJXp-Span-12">ã‚¹</span></span><span id="MJXp-Span-13"><span id="MJXp-Span-14">é–“</span></span><span id="MJXp-Span-15"><span id="MJXp-Span-16">éš”</span></span><span id="MJXp-Span-17">Ã—</span><span id="MJXp-Span-18">(</span><span id="MJXp-Span-19"><span id="MJXp-Span-20">2</span><span id="MJXp-Span-21">c</span></span><span id="MJXp-Span-22">âˆ’</span><span id="MJXp-Span-23">1</span><span id="MJXp-Span-24">)</span><span id="MJXp-Span-25">]</span></span></span>ã«ãªã‚‹ã‚ˆã†ãª<a href="https://en.wikipedia.org/wiki/Exponential_backoff" rel="nofollow noopener" target="_blank">Ethernetã®Exponential Backoffã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </a>ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"Ethernet protocol"</span> <span>should</span> <span>{</span>
    <span>"avoid collision by exponential backoff"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>base</span> <span>=</span> <span>Duration</span><span>(</span><span>51200</span><span>,</span> <span>TimeUnit</span><span>.</span><span>NANOSECONDS</span><span>)</span>
      <span>val</span> <span>backOffPolicy</span> <span>=</span> <span>Schedule</span><span>.</span><span>exponential</span><span>(</span><span>base</span><span>).</span><span>jittered</span>

      <span>unsafeRun</span><span>(</span>
        <span>UIO</span><span>(</span><span>println</span><span>(</span><span>"Hello"</span><span>))</span>
          <span>.</span><span>repeat</span><span>(</span><span>backOffPolicy</span><span>)</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<h2>
<span id="loginput-and-logoutput"></span><a href="#loginput-and-logoutput"><i></i></a><code>logInput</code> and <code>logOutput</code>
</h2>

<p>è¨ˆç®—ã®å®Ÿè¡Œçµæœã‚„ã‚¨ãƒ©ãƒ¼æƒ…å ±ã®ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ãŸã„ã¨ãã«ä½¿ç”¨ã™ã‚‹ã®ãŒ<code>logInput</code>ã¨<code>logOutput</code>ã§ã™ã€‚</p>

<p><code>logInput</code>ã§<code>Schedule</code>ã®å…¥åŠ›ã‚’ã€<code>logOutput</code>ã§å‡ºåŠ›ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<code>retry</code>ã¯Scheduleã®å…¥åŠ›ã«ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’æ¸¡ã™ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«<code>logInput</code>ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã§ãã¾ã™ã€‚</p>

<div data-lang="scala"><div><pre>  <span>"logInput"</span> <span>should</span> <span>{</span>
    <span>"log every input"</span> <span>in</span> <span>{</span>
      <span>val</span> <span>service</span> <span>=</span> <span>new</span> <span>StubService</span><span>(</span><span>100</span><span>)</span>

      <span>unsafeRun</span><span>(</span>
        <span>IO</span><span>(</span><span>service</span><span>.</span><span>request</span><span>())</span>
          <span>.</span><span>retry</span><span>(</span><span>Schedule</span><span>.</span><span>recurs</span><span>(</span><span>4</span><span>)</span>
            <span>.</span><span>logInput</span><span>((</span><span>e</span><span>:</span> <span>Throwable</span><span>)</span> <span>=&gt;</span> <span>UIO</span><span>(</span><span>println</span><span>(</span><span>e</span><span>))))</span>
      <span>)</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>



<p>ZIOã®<code>Schedule</code>ã¯ç¹°ã‚Šè¿”ã—å‡¦ç†ã¨ãƒªãƒˆãƒ©ã‚¤å‡¦ç†ã®ä»•æ§˜ã‚’è¡¨ç¾ã™ã‚‹ä¸å¤‰ãªå€¤ã§ã™ã€‚ZIOã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹åŸºæœ¬çš„ãª<code>Schedule</code>ã¨çµ„ã¿åˆã‚ã›æ“ä½œã«ã‚ˆã£ã¦è¤‡é›‘ãªä»•æ§˜ã‚‚è¡¨ç¾å¯èƒ½ã§ã™ã€‚</p>



<p><a href="https://www.slideshare.net/jdegoes/zio-schedule-conquering-flakiness-recurrence-with-pure-functional-programming-119932802" rel="nofollow noopener" target="_blank">ZIO Schedule: Conquering Flakiness &amp; Recurrence with Pure Functional Programming</a></p>



<p>a.<code>Schedule[A, B]</code>ã¯<code>ZSchedule[R, A, B]</code>ã®ç’°å¢ƒ<code>R</code>ã‚’<code>Any</code>ã«å›ºå®šã—ãŸã‚¨ã‚¤ãƒªã‚¢ã‚¹ã€‚</p>

<p>b. ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ä¸­ã®<code>StubService</code>ã®å®šç¾©ã€‚æŒ‡å®šã—ãŸå›æ•°ã®é–“ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å¤±æ•—ã—ã¦ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã€‚</p>

<div data-lang="scala"><div><pre>  <span>class</span> <span>StubService</span><span>(</span><span>val</span> <span>failUntil</span><span>:</span> <span>Int</span><span>)</span> <span>{</span>
    <span>var</span> <span>current</span> <span>=</span> <span>0</span>

    <span>def</span> <span>request</span><span>()</span><span>:</span> <span>String</span> <span>=</span> <span>{</span>
      <span>current</span> <span>+=</span> <span>1</span>
      <span>if</span> <span>(</span><span>current</span> <span>&gt;=</span> <span>failUntil</span><span>)</span> <span>{</span>
        <span>s</span><span>"Succeed at $current attempt"</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>throw</span> <span>new</span> <span>Exception</span><span>(</span><span>s</span><span>"failed at $current attempt"</span><span>)</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>
</pre></div></div>

<p>c. <code>race</code>ã«ã¤ã„ã¦ã¯<a href="https://qiita.com/MitsutakaTakeda/items/0eabe12c5270d7eeaa02" id="reference-571ff19e7c18abd6f024">ä»¥å‰ã®è¨˜äº‹</a>ã‚’å‚ç…§ã€‚</p>
</div></div></section><div><p>Why not register and get more from Qiita?</p><ol><li>We will deliver articles that match you<p>By following users and tags, you can catch up information on technical fields that you are interested in as a whole</p></li><li>you can read useful information later efficiently<p>By "stocking" the articles you like, you can search right away</p></li></ol><p><a href="https://qiita.com/signup?callback_action=login_or_signup&amp;redirect_to=%2FMitsutakaTakeda%2Fitems%2F178eee8feea905efb7bb&amp;realm=qiita">Sign up</a><a href="https://qiita.com/login?callback_action=login_or_signup&amp;redirect_to=%2FMitsutakaTakeda%2Fitems%2F178eee8feea905efb7bb&amp;realm=qiita">Login</a></p></div></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>