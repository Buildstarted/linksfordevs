<!DOCTYPE html>
<html lang="en">
<head>
    <title>
runtime: non-cooperative goroutine preemption &#xB7; Issue #24543 &#xB7; golang/go - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="runtime: non-cooperative goroutine preemption &#xB7; Issue #24543 &#xB7; golang/go - linksfor.dev(s)"/>
    <meta property="article:author" content="aclements"/>
    <meta property="og:description" content="I propose that we solve #10958 (preemption of tight loops) using non-cooperative preemption techniques. I have a detailed design proposal, which I will post shortly. This issue will track this spec..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/golang/go/issues/24543"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - runtime: non-cooperative goroutine preemption &#xB7; Issue #24543 &#xB7; golang/go</title>
<div class="readable">
        <h1>runtime: non-cooperative goroutine preemption &#xB7; Issue #24543 &#xB7; golang/go</h1>
            <div>by aclements</div>
            <div>Reading time: 18-22 minutes</div>
        <div>Posted here: 02 Mar 2020</div>
        <p><a href="https://github.com/golang/go/issues/24543">https://github.com/golang/go/issues/24543</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
  <div>

    
    
  <div data-pjax="">
    
      



  <div id="show_issue" data-channel="issue:308708148:timeline">

    
  



      <div>
      <div>
        <p><span>Assignees</span></p><p><a data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
              <img src="https://avatars2.githubusercontent.com/u/2688315?s=40&amp;v=4" width="20" height="20" alt="@aclements">
</a>        </p>
      </div>

      


      
  </div>


    <h2>Comments</h2>
    <div id="discussion_bucket">
      <div>

  <div>
              <div data-quote-markdown=".js-comment-body" data-issue-and-pr-hovercards-enabled="" data-team-hovercards-enabled="">

            <div data-channel="marked-as-read:issue:308708148">

              



                

  


  
  


  
  



  
  



  
  



  
  



  
  



  
  



  
  



  
  



  
  


  
  



  
  



  
  



  
  



  
  



  
  



  
  


  
  



  
  



  
  



  
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDE1ODY4MTE4MjE=">
  
        <div>
  <div id="ref-commit-8871c93">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-8871c93">
      <relative-time datetime="2018-04-20T18:47:21Z" title="Apr 20, 2018, 11:47 AM PDT">on Apr 20, 2018</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:8871c930bead174b942ce934677054f8958d0631" data-url="/golang/go/commit/8871c930bead174b942ce934677054f8958d0631/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>Currently, each architecture lowers OpConvert to an arch-specific
OpXXXconvert. This is silly because OpConvert means the same thing on
all architectures and is logically a no-op that exists only to keep
track of conversions to and from unsafe.Pointer. Furthermore, lowering
it makes it harder to recognize in other analyses, particularly
liveness analysis.

This CL eliminates the lowering of OpConvert, leaving it as the
generic op until code generation time.

The main complexity here is that we still need to register-allocate
OpConvert operations. Currently, each arch's lowered OpConvert
specifies all GP registers in its register mask. Ideally, OpConvert
wouldn't affect value homing at all, and we could just copy the home
of OpConvert's source, but this can potentially home an OpConvert in a
LocalSlot, which neither regalloc nor stackalloc expect. Rather than
try to disentangle this assumption from regalloc and stackalloc, we
continue to register-allocate OpConvert, but teach regalloc that
OpConvert can be allocated to any allocatable GP register.

For <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I795a6aee5fd94d4444a7bafac3838a400c9f7bb6
Reviewed-on: <a href="https://go-review.googlesource.com/108496" rel="nofollow">https://go-review.googlesource.com/108496</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: David Chase &lt;drchase@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-568d6f9">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-568d6f9">
      <relative-time datetime="2018-04-20T19:10:31Z" title="Apr 20, 2018, 12:10 PM PDT">on Apr 20, 2018</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:568d6f983172706d2f5f7f66024b7b7a544ada53" data-url="/golang/go/commit/568d6f983172706d2f5f7f66024b7b7a544ada53/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>These will appear when tracking live pointers in registers, so we need
to know whether they have pointers.

For <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I2edccee39ca989473db4b3e7875ff166808ac141
Reviewed-on: <a href="https://go-review.googlesource.com/108497" rel="nofollow">https://go-review.googlesource.com/108497</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
Reviewed-by: David Chase &lt;drchase@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  

  

  <div>
  <div id="ref-commit-bdb65da">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-bdb65da">
      <relative-time datetime="2018-04-23T16:32:52Z" title="Apr 23, 2018, 9:32 AM PDT">on Apr 23, 2018</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:bdb65da0490e695da0de6eba2b0d5da244e88293" data-url="/golang/go/commit/bdb65da0490e695da0de6eba2b0d5da244e88293/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>Currently Liveness.compact rewrites the Liveness.livevars slice in
place. However, we're about to add register maps, which we'll want to
track in livevars, but compact independently from the stack maps.
Hence, this CL modifies Liveness.compact to consume Liveness.livevars
and produce a new slice of deduplicated stack maps. This is somewhat
clearer anyway because it avoids potential confusion over how
Liveness.livevars is indexed.

Passes toolstash -cmp.

For <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I7093fbc71143f8a29e677aa30c96e501f953ca2b
Reviewed-on: <a href="https://go-review.googlesource.com/108498" rel="nofollow">https://go-review.googlesource.com/108498</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: David Chase &lt;drchase@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  



</div>

  
  




  

    
  



    
  



    
  



    
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDI3NjA2ODIyODY=">
  
        <div>
  <div id="ref-commit-a9b37ae">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-a9b37ae">
      <relative-time datetime="2019-10-31T17:10:24Z" title="Oct 31, 2019, 10:10 AM PDT">on Oct 31, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:a9b37ae02604e03d2356b6143679d2a71bdd32a7" data-url="/golang/go/commit/a9b37ae02604e03d2356b6143679d2a71bdd32a7/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>Currently, several important fields of a heap span are set by
heapBits.initSpan, which happens after the span has already been
published and returned from the locked region of alloc_m. In
particular, allocBits is set very late, which makes mspan.isFree
unsafe even if you were to lock the heap because it tries to access
allocBits.

This CL fixes this by populating these fields in alloc_m. The next CL
builds on this to only publish the span once it is fully initialized.
Together, they'll make it safe to check allocBits even if there is a
race with alloc_m.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>, but a good fix in general.

Change-Id: I7fde90023af0f497e826b637efa4d19c32840c08
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/203285" rel="nofollow">https://go-review.googlesource.com/c/go/+/203285</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;
Reviewed-by: Michael Knyszek &lt;mknyszek@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-7de15e3">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-7de15e3">
      <relative-time datetime="2019-10-31T17:10:24Z" title="Oct 31, 2019, 10:10 AM PDT">on Oct 31, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:7de15e362b0bc4ba83c8ca4d7cadc319c99db65a" data-url="/golang/go/commit/7de15e362b0bc4ba83c8ca4d7cadc319c99db65a/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>When everything is working correctly, any pointer the garbage
collector encounters can only point into a fully initialized heap
span, since the span must have been initialized before that pointer
could escape the heap allocator and become visible to the GC.

However, in various cases, we try to be defensive against bad
pointers. In findObject, this is just a sanity check: we never expect
to find a bad pointer, but programming errors can lead to them. In
spanOfHeap, we don't necessarily trust the pointer and we're trying to
check if it really does point to the heap, though it should always
point to something. Conservative scanning takes this to a new level,
since it can only guess that a word may be a pointer and verify this.

In all of these cases, we have a problem that the span lookup and
check can race with span initialization, since the span becomes
visible to lookups before it's fully initialized.

Furthermore, we're about to start initializing the span without the
heap lock held, which is going to introduce races where accesses were
previously protected by the heap lock.

To address this, this CL makes accesses to mspan.state atomic, and
ensures that the span is fully initialized before setting the state to
mSpanInUse. All loads are now atomic, and in any case where we don't
trust the pointer, it first atomically loads the span state and checks
that it's mSpanInUse, after which it will have synchronized with span
initialization and can safely check the other span fields.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>, but a good fix in general.

Change-Id: I518b7c63555b02064b98aa5f802c92b758fef853
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/203286" rel="nofollow">https://go-review.googlesource.com/c/go/+/203286</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Michael Knyszek &lt;mknyszek@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  



</div>

    
  



    
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDI3NjQ5ODk3ODI=">
  
        

  <div>
  <div id="ref-commit-40b7455">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-40b7455">
      <relative-time datetime="2019-11-02T21:52:32Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:40b74558771ba9db493728dcaabe43318daf9b97" data-url="/golang/go/commit/40b74558771ba9db493728dcaabe43318daf9b97/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This doesn't do anything yet, but it will provide a way to disable
non-cooperative preemption.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: Ifdef303f103eabd0922ced8d9bebbd5f0aa2cda4
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201757" rel="nofollow">https://go-review.googlesource.com/c/go/+/201757</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Brad Fitzpatrick &lt;bradfitz@golang.org&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-61fa798">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-61fa798">
      <relative-time datetime="2019-11-02T21:52:32Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:61fa79885ba83b2552e7026cb300ae426a3c0b83" data-url="/golang/go/commit/61fa79885ba83b2552e7026cb300ae426a3c0b83/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>Currently, the compiler fails to mark any unsafe-points in the initial
instructions of a function as unsafe points. This happens because
unsafe points are encoded as a stack map index of -2 and the compiler
emits PCDATA instructions when there's a change in the stack map
index, but I had set the initial stack map index to -2. The actual
initial PCDATA value assumed by the PCDATA encoder and the runtime is
-1. Hence, if the first instructions had a stack map index of -2, no
PCDATA was emitted, which cause the runtime to assume the index was -1
instead.

This was particularly problematic in the runtime, where the compiler
was supposed to mark only calls as safe-points and everything else as
unsafe-points. Runtime leaf functions, for example, should have been
marked as entirely unsafe-points, but were instead marked entirely as
safe-points.

Fix this by making the PCDATA instruction generator assume the initial
PCDATA value is -1 instead of -2, so it will emit a PCDATA instruction
right away if the first real instruction is an unsafe-point.

This increases the size of the cmd/go binary by 0.02% since we now
emit slightly more PCDATA than before.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I92222107f799130072b36d49098d2686f1543699
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/202084" rel="nofollow">https://go-review.googlesource.com/c/go/+/202084</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-2d031dc">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-2d031dc">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:2d031dc559a720ec2c1939848a2e5de2782acd5a" data-url="/golang/go/commit/2d031dc559a720ec2c1939848a2e5de2782acd5a/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds a sigctxt.pushCall method that pushes a call at the signaled
site. We'll use this to inject asynchronous preemptions and in some
places we use it to clean up preparePanic.

For the moment this only works on 386 and amd64. We stub it out on
other platforms and will avoid calling the stubbed version.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I49e0e853f935d32dd67a70c6cafbae44ee68af8e
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201758" rel="nofollow">https://go-review.googlesource.com/c/go/+/201758</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-a3ffb0d">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-a3ffb0d">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:a3ffb0d9eb948409c0898c6b1803401c9bc68ed4" data-url="/golang/go/commit/a3ffb0d9eb948409c0898c6b1803401c9bc68ed4/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds asynchronous preemption function for amd64 and 386. These
functions spill and restore all register state that can be used by
user Go code.

For the moment we stub out the other arches.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I6f93fabe9875f4834922a5712362e79045c00aca
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201759" rel="nofollow">https://go-review.googlesource.com/c/go/+/201759</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-d16ec13">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-d16ec13">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:d16ec137568fb20e674a99c265e7c340c065dd69" data-url="/golang/go/commit/d16ec137568fb20e674a99c265e7c340c065dd69/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds support for scanning the stack when a goroutine is stopped
at an async safe point. This is not yet lit up because asyncPreempt is
not yet injected, but prepares us for that.

This works by conservatively scanning the registers dumped in the
frame of asyncPreempt and its parent frame, which was stopped at an
asynchronous safe point.

Conservative scanning works by only marking words that are pointers to
valid, allocated heap objects. One complication is pointers to stack
objects. In this case, we can't determine if the stack object is still
"allocated" or if it was freed by an earlier GC. Hence, we need to
propagate the conservative-ness of scanning stack objects: if all
pointers found to a stack object were found via conservative scanning,
then the stack object itself needs to be scanned conservatively, since
its pointers may point to dead objects.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I7ff84b058c37cde3de8a982da07002eaba126fd6
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201761" rel="nofollow">https://go-review.googlesource.com/c/go/+/201761</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-62e53b7">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-62e53b7">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:62e53b79227dafc6afcd92240c89acb8c0e1dd56" data-url="/golang/go/commit/62e53b79227dafc6afcd92240c89acb8c0e1dd56/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds support for pausing a running G by sending a signal to its
M.

The main complication is that we want to target a G, but can only send
a signal to an M. Hence, the protocol we use is to simply mark the G
for preemption (which we already do) and send the M a "wake up and
look around" signal. The signal checks if it's running a G with a
preemption request and stops it if so in the same way that stack check
preemptions stop Gs. Since the preemption may fail (the G could be
moved or the signal could arrive at an unsafe point), we keep a count
of the number of received preemption signals. This lets stopG detect
if its request failed and should be retried without an explicit
channel back to suspendG.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I3e1538d5ea5200aeb434374abb5d5fdc56107e53
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201760" rel="nofollow">https://go-review.googlesource.com/c/go/+/201760</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-177a36a">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-177a36a">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:177a36a5dc29854489825e8113ecb2cbb7070690" data-url="/golang/go/commit/177a36a5dc29854489825e8113ecb2cbb7070690/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds signal-based preemption to preemptone.

Since STW and forEachP ultimately use preemptone, this also makes
these work with async preemption.

This also makes freezetheworld more robust so tracebacks from fatal
panics should be far less likely to report "goroutine running on other
thread; stack unavailable".

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>. (This doesn't fix it yet because asynchronous
preemption only works on POSIX platforms on 386 and amd64 right now.)

Change-Id: If776181dd5a9b3026a7b89a1b5266521b95a5f61
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201762" rel="nofollow">https://go-review.googlesource.com/c/go/+/201762</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-7955ece">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-7955ece">
      <relative-time datetime="2019-11-02T21:52:33Z" title="Nov 2, 2019, 2:52 PM PDT">on Nov 2, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:7955ecebfc85851d43913f9358fa5f6a7bbb7c59" data-url="/golang/go/commit/7955ecebfc85851d43913f9358fa5f6a7bbb7c59/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This adds a test of preempting a loop containing no synchronous safe
points for STW and stack scanning.

We couldn't add this test earlier because it requires scheduler, STW,
and stack scanning preemption to all be working.

For <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I73292db78ca3d14aab11bdafd26d03986920ef0a
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/201777" rel="nofollow">https://go-review.googlesource.com/c/go/+/201777</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  



</div>

    
  



    
  



    
  



    
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDI4MTYxMDI5NDg=">
  
        <div>
  <div id="ref-commit-6fd467e">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-6fd467e">
      <relative-time datetime="2019-11-20T17:14:25Z" title="Nov 20, 2019, 9:14 AM PST">on Nov 20, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:6fd467ee29226bf4b875921b7cb3b692c9db52ef" data-url="/golang/go/commit/6fd467ee29226bf4b875921b7cb3b692c9db52ef/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>On Windows, there is currently a race between unminit closing the
thread's handle and profileloop1 suspending the thread using its
handle. If another handle reuses the same handle value, this can lead
to unpredictable results.

To fix this, we protect the thread handle with a lock and duplicate it
under this lock in profileloop1 before using it.

This is going to become a much bigger problem with non-cooperative
preemption (<a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>), which uses the same basic mechanism as
profileloop1.

Change-Id: I9d62b83051df8c03f3363344438e37781a69ce16
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/207779" rel="nofollow">https://go-review.googlesource.com/c/go/+/207779</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;
Reviewed-by: Alex Brainman &lt;alex.brainman@gmail.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>

  <div>
  <div id="ref-commit-b89b462">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-b89b462">
      <relative-time datetime="2019-11-20T17:14:25Z" title="Nov 20, 2019, 9:14 AM PST">on Nov 20, 2019</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:b89b4623eb70cbdc6b0aea43a5a826b7a26f20a7" data-url="/golang/go/commit/b89b4623eb70cbdc6b0aea43a5a826b7a26f20a7/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>This implements preemptM on Windows using SuspendThead and
ResumeThread.

Unlike on POSIX platforms, preemptM on Windows happens synchronously.
This means we need a make a few other tweaks to suspendG:

1. We need to CAS the G back to _Grunning before doing the preemptM,
   or there's a good chance we'll just catch the G spinning on its
   status in the runtime, which won't be preemptible.

2. We need to rate-limit preemptM attempts. Otherwise, if the first
   attempt catches the G at a non-preemptible point, the busy loop in
   suspendG may hammer it so hard that it never makes it past that
   non-preemptible point.

Updates <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: Ie53b098811096f7e45d864afd292dc9e999ce226
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/204340" rel="nofollow">https://go-review.googlesource.com/c/go/+/204340</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>



</div>

    
  



    
  


    
  



    
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDI5MzU4MTc4Mjg=">
  
        <div>
  <div id="ref-commit-957259b">
    
  <p><a data-hovercard-type="user" data-hovercard-url="/users/gopherbot/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gopherbot">gopherbot</a> 

      pushed a commit
      that referenced
      this issue

    </p><a href="#ref-commit-957259b">
      <relative-time datetime="2020-01-09T17:29:29Z" title="Jan 9, 2020, 9:29 AM PST">on Jan 9</relative-time>
    </a>
    <div>
      

<div data-channel="repo:23096959:commit:957259b7e2c40cf9955469ce93b35bdc0289e942" data-url="/golang/go/commit/957259b7e2c40cf9955469ce93b35bdc0289e942/_render_node/commit/condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/aclements/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aclements">
          <img height="20" width="20" alt="@aclements" src="https://avatars1.githubusercontent.com/u/2688315?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>On Windows, we implement asynchronous preemption using SuspendThread
to suspend other threads in our process. However, SuspendThread is
itself actually asynchronous (it enqueues a kernel "asynchronous
procedure call" and returns). Unfortunately, Windows' ExitProcess API
kills all threads except the calling one and then runs APCs. As a
result, if SuspendThread and ExitProcess are called simultaneously,
the exiting thread can be suspended and the suspending thread can be
exited, leaving behind a ghost process consisting of a single thread
that's suspended.

We've already protected against the runtime's own calls to
ExitProcess, but if Go code calls external code, there's nothing
stopping that code from calling ExitProcess. For example, in <a data-error-text="Failed to load title" data-id="527241433" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/35775" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/35775/hovercard" href="https://github.com/golang/go/issues/35775">#35775</a>,
our own call to racefini leads to C code calling ExitProcess and
occasionally causing a deadlock.

This CL fixes this by introducing synchronization between calling
external code on Windows and preemption. It adds an atomic field to
the M that participates in a simple CAS-based synchronization protocol
to prevent suspending a thread running external code. We use this to
protect cgocall (which is used for both cgo calls and system calls on
Windows) and racefini.

Tested by running the flag package's TestParse test compiled in race
mode in a loop. Before this change, this would reliably deadlock after
a few minutes.

<span aria-label="This commit closes issue #35775.">Fixes</span> <a data-error-text="Failed to load title" data-id="527241433" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/35775" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/35775/hovercard" href="https://github.com/golang/go/issues/35775">#35775</a>.
Updates <a data-error-text="Failed to load title" data-id="81098230" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/10958" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/10958/hovercard" href="https://github.com/golang/go/issues/10958">#10958</a>, <a data-error-text="Failed to load title" data-id="308708148" data-permission-text="Title is private" data-url="https://github.com/golang/go/issues/24543" data-hovercard-type="issue" data-hovercard-url="/golang/go/issues/24543/hovercard" href="https://github.com/golang/go/issues/24543">#24543</a>.

Change-Id: I50d847abcdc2688b4f71eee6a75eca0f2fee892c
Reviewed-on: <a href="https://go-review.googlesource.com/c/go/+/213837" rel="nofollow">https://go-review.googlesource.com/c/go/+/213837</a>
Run-TryBot: Austin Clements &lt;austin@google.com&gt;
TryBot-Result: Gobot Gobot &lt;gobot@golang.org&gt;
Reviewed-by: Cherry Zhang &lt;cherryyz@google.com&gt;
Reviewed-by: David Chase &lt;drchase@google.com&gt;</pre>
    </div>
</div>


    </div>
  </div>
</div>



</div>

    
  



    
  





<!-- Rendered timeline since 2020-02-28 09:39:52 -->



            </div>


            
          </div>

</div>

    
</div>


    </div>
  </div>

  </div>


  </div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>