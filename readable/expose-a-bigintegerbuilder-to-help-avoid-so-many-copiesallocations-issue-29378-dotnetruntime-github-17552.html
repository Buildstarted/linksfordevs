<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Expose a BigInteger.Builder to help avoid so many copies/allocations &#xB7; Issue #29378 &#xB7; dotnet/runtime - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Expose a BigInteger.Builder to help avoid so many copies/allocations &#xB7; Issue #29378 &#xB7; dotnet/runtime - linksfor.dev(s)"/>
    <meta property="article:author" content="tannergooding"/>
    <meta property="og:description" content="Rationale System.Numerics.BigInteger is an immutable struct that frequently works with &amp;quot;big data&amp;quot;. This can cause it to be very ineffecient to use given that you need to create a new immu..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/corefx/issues/37204"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Expose a BigInteger.Builder to help avoid so many copies/allocations &#xB7; Issue #29378 &#xB7; dotnet/runtime</title>
<div class="readable">
        <h1>Expose a BigInteger.Builder to help avoid so many copies/allocations &#xB7; Issue #29378 &#xB7; dotnet/runtime</h1>
            <div>by tannergooding</div>
            <div>Reading time: 51-64 minutes</div>
        <div>Posted here: 25 Apr 2019</div>
        <p><a href="https://github.com/dotnet/corefx/issues/37204">https://github.com/dotnet/corefx/issues/37204</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
              <div data-quote-markdown=".js-comment-body" data-issue-and-pr-hovercards-enabled="" data-team-hovercards-enabled="">

            <div data-channel="marked-as-read:issue:558459908">

              
<div data-gid="MDU6SXNzdWU1NTg0NTk5MDg=" data-url="/_render_node/MDU6SXNzdWU1NTg0NTk5MDg=/issues/body" data-channel="issue:558459908">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding"><img height="40" width="40" alt="@tannergooding" src="https://avatars2.githubusercontent.com/u/10487869?s=88&amp;v=4"></a>

</p>


  
<div id="issue-558459908">
  <div data-body-version="de3379dfbd367ee3983a319b4505c657" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <h3>Rationale</h3>
<p><code>System.Numerics.BigInteger</code> is an immutable struct that frequently works with "big data". This can cause it to be very ineffecient to use given that you need to create a new immutable struct for every operation. As such, I propose we expose a new <code>BigInteger.Builder</code> type which allows for multiple operations to be performed on a mutable class before ultimately serializing the final result back to a regular <code>BigInteger</code>. This pattern has been used to good affect in other types, such as those in <code>System.Collections.Immutable</code>.</p>
<h3>Proposed API</h3>
<div><pre><span>namespace</span> <span>System</span>.<span>Numerics</span>
{
    <span>public</span> <span>partial</span> <span>struct</span> <span>BigInteger</span>
    {
        <span><span>//</span> Should there be a CreateBuilder method which takes an initial capacity?</span>

        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>();
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>byte</span>[] <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>decimal</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>double</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>int</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>long</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>float</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>uint</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>ulong</span> <span>value</span>);
        <span>public</span> <span>static</span> <span>Builder</span> <span>CreateBuilder</span>(<span>BigInteger</span> <span>value</span>);

        <span>public</span> <span>sealed</span> <span>class</span> <span>Builder</span> : <span>IFormattable</span>, <span>IComparable</span>, <span>IComparable</span>&lt;<span>BigInteger</span>.<span>Builder</span>&gt;, <span>IEquatable</span>&lt;<span>BigInteger</span>.<span>Builder</span>&gt;
        {
            <span><span>//</span> Already in BigInteger</span>

                <span>public</span> <span>bool</span> <span>IsEven</span> { <span>get</span>; }
                <span>public</span> <span>bool</span> <span>IsOne</span> { <span>get</span>; }
                <span>public</span> <span>bool</span> <span>IsPowerOfTwo</span> { <span>get</span>; }
                <span>public</span> <span>bool</span> <span>IsZero</span> { <span>get</span>; }

                <span>public</span> <span>int</span> <span>Sign</span> { <span>get</span>; }

                <span>public</span> <span>static</span> <span>Builder</span> <span>Abs</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Add</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>int</span> <span>Compare</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Divide</span>(<span>Builder</span> <span>dividend</span>, <span>Builder</span> <span>divisor</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>DivRem</span>(<span>Builder</span> <span>dividend</span>, <span>Builder</span> <span>divisor</span>, <span>out</span> <span>Builder</span> <span>remainder</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>GreatestCommonDivisor</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Log</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>double</span> <span>Log</span>(<span>Builder</span> <span>value</span>, <span>double</span> <span>baseValue</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Log10</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Max</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Min</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>ModPow</span>(<span>Builder</span> <span>value</span>, <span>Builder</span> <span>exponent</span>, <span>Builder</span> <span>modulus</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Multiply</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Negate</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Pow</span>(<span>Builder</span> <span>value</span>, <span>int</span> <span>exponent</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Remainder</span>(<span>Builder</span> <span>dividend</span>, <span>Builder</span> <span>divisor</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Subtract</span>(<span>Builder</span> <span>value</span>, <span>int</span> <span>shift</span>);

                <span>public</span> <span>int</span> <span>CompareTo</span>(<span>Builder</span> <span>other</span>);
                <span>public</span> <span>override</span> <span>Equals</span>(<span>object</span> <span>other</span>);
                <span>public</span> <span>bool</span> <span>Equals</span>(<span>Builder</span> <span>other</span>);
                <span>public</span> <span>int</span> <span>GetByteCount</span>(<span>bool</span> <span>isUnsigned</span> <span>=</span> <span>false</span>);
                <span>public</span> <span>override</span> <span>int</span> <span>GetHashCode</span>();
                <span>public</span> <span>byte</span>[] <span>ToByteArray</span>(<span>bool</span> <span>isUnsigned</span> <span>=</span> <span>false</span>, <span>bool</span> <span>isBigEndian</span> <span>=</span> <span>false</span>);
                <span>public</span> <span>override</span> <span>string</span> <span>ToString</span>();

            <span><span>//</span> Not listed</span>
            
                <span><span>//</span> All the operators, including:</span>
                <span><span>//</span>   * Explicit Casts</span>
                <span><span>//</span>   * Implicit Casts</span>
                <span><span>//</span>   * Comparison (&gt;, &gt;=, &lt;, &lt;=, ==, !=)</span>

                <span><span>//</span> Parse methods</span>

            <span><span>//</span> Not in BigInteger</span>

                <span>public</span> <span>static</span> <span>Builder</span> <span>BitwiseAnd</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>BitwiseOr</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Decrement</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Increment</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>LeftShift</span>(<span>Builder</span> <span>value</span>, <span>int</span> <span>shift</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Modulus</span>(<span>Builder</span> <span>dividend</span>, <span>Builder</span> <span>divisor</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>OnesComplement</span>(<span>Builder</span> <span>value</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>RightShift</span>(<span>Builder</span> <span>value</span>, <span>int</span> <span>shift</span>);
                <span>public</span> <span>static</span> <span>Builder</span> <span>Xor</span>(<span>Builder</span> <span>left</span>, <span>Builder</span> <span>right</span>);

                <span>public</span> <span>BigInteger</span> <span>ToBigInteger</span>();
        }
    }
}</pre></div>
<h3>Open Questions</h3>
<p>How should the builder handle taking an existing <code>BigInteger</code> as an input? We don't want to force creation of a <code>Builder</code> as that could copy unecessarily.</p>
<p>Should the Builder be a class, as other builders have been. What about a <code>ref struct</code> which might help with lifetime and allow usage of the stack, rather than force array allocations...</p>
<p>Should the APIs be exposed in a more "builder" oriented manner (instance methods that return 'self')?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>

</div>


              

  


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg3MzQ4Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg3MzQ4Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Njg3MzQ4Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick"><img height="40" width="40" alt="@svick" src="https://avatars2.githubusercontent.com/u/287848?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-486873487">
    <div>
      

  

<details data-body-version="d8ea31d078c3085c78dba2d77f9b916e">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d8ea31d078c3085c78dba2d77f9b916e" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>How do the binary operations behave? Is the return value guaranteed to be the same instance as the first operand? Or should both operands be considered invalid after those operations? Either way, I think it's going to be unintuitive and instance methods would make the mutations much clearer.</p>
<p>What is the expected usage pattern? Just the method name thanks to <code>using static</code>? (I think that e.g. <code>BigInteger.Abs</code> is mostly reasonable, but <code>BigInteger.Builder.Abs</code> is quite verbose.)</p>
<p>Maybe an example would help. Consider the following variation of computing an arithmetic series:</p>
<div><pre><span>BigInteger</span> <span>ArithmeticSeries</span>(<span>BigInteger</span> <span>n</span>, <span>BigInteger</span> <span>a1</span>, <span>BigInteger</span> <span>d</span>) <span>=&gt;</span>
    (<span>2</span> <span>*</span> <span>a1</span> <span>+</span> (<span>n</span> <span>-</span> <span>1</span>) <span>*</span> <span>d</span>) <span>*</span> <span>n</span> <span>/</span> <span>2</span>;</pre></div>
<p>How would you do the same thing using <code>BigInteger.Builder</code>?</p>
<blockquote>
<p>How should the builder handle taking an existing <code>BigInteger</code> as an input? We don't want to force creation of a <code>Builder</code> as that could copy unnecessarily.</p>
</blockquote>
<p>Maybe it doesn't have to copy, if you use copy-on-write? When you create a <code>Builder</code> from <code>BigInteger</code>, it reuses its backing array and remembers that it's not allowed to mutate it. When a mutation is performed on that <code>Builder</code>, then it will allocate its own array.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg3NTI2MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg3NTI2MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Njg3NTI2MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding"><img height="40" width="40" alt="@tannergooding" src="https://avatars2.githubusercontent.com/u/10487869?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-486875261">
    <div>
      

  

<details data-body-version="d0a292289a7fac2f0e549eca0aea73d1">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d0a292289a7fac2f0e549eca0aea73d1" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>How do the binary operations behave? Is the return value guaranteed to be the same instance as the first operand? Or should both operands be considered invalid after those operations? Either way, I think it's going to be unintuitive and instance methods would make the mutations much clearer.</p>
</blockquote>
<p>Right, this is why I called out that the APIs should possibly be exposed in a more "builder" oriented manner... Essentially, we will need to either:</p>
<ul>
<li>Have a fluent design with instance methods (can't really use operators)</li>
<li>Have a design where the user can explicitly specify the destination builder. This could potentially be returned as the result as well, but we can't really utilize operators</li>
<li>Have a "RMW" design where the left operand is also the destination (potentially confusing design, also potentially inefficient when the user has an ultimate destination but multiple sub-operations)</li>
</ul>
<blockquote>
<p>Maybe it doesn't have to copy, if you use copy-on-write?</p>
</blockquote>
<p>That might work, could probably do this fairly easily as well....</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg4ODE2OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg4ODE2OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Njg4ODE2OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-486888169">
    <div>
      

  

<details data-body-version="496cff1231c6695e99162356ee23674f">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="496cff1231c6695e99162356ee23674f" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I'll write my full comments when I get a chance, but for now, here's a design that is worthwhile to consider:</p>
<pre><code>class Builder
{
    public void Multiply(Builder left, Builder right);
}
</code></pre>
<p>Yes, although it may seem surprising, that is indeed a non-static method and I intentionally wrote "void" return type.   The result of the multiplication is stored into <code>this</code>, the same instance.  In the following example, the result of the multiplication is stored into "r".</p>
<pre><code>Builder x = new Builder(123456);
Builder y = new Builder(50000);
Builder r = new Builder();
r.Multiply(x, y);
</code></pre>
<p>I'm not saying this is the one true way, rather I'm saying, at least consider this design, even if it initially seems different than what you're traditionally accustomed to.  Sometimes an idea seems unlikeable at first because it different to an old habit, but after you get used to it, you might end up liking it and discovering that it has advantages, even if it seemed strange at first.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg5NDE3Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4Njg5NDE3Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4Njg5NDE3Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick"><img height="40" width="40" alt="@svick" src="https://avatars2.githubusercontent.com/u/287848?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-486894173">
    <div>
      

  

<details data-body-version="ed23a54f8d200a6fe29014ac79c79f03">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="ed23a54f8d200a6fe29014ac79c79f03" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode">@verelpode</a></p>
<p>With that design, would you be allowed to write <code>r.Multiply(r, x);</code> (effectively <code>r *= x;</code>)? Or even <code>r.Multiply(r, r);</code>?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzEzMjAwOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzEzMjAwOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzEzMjAwOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487132009">
    <div>
      

  

<details data-body-version="be5abdbee146f3b2ce5bb0bb6ff04a3b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="be5abdbee146f3b2ce5bb0bb6ff04a3b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick">@svick</a> Good question.  Yes, in my opinion, it should be written not to malfunction nor throw exception when any of r, x, y is the same instance as any of r, x, y, otherwise the reliability would be unsatisfactory.  I've done some work in this area and my experience was that this ability is easy enough to support, if you implement it by simply loading the operand fields into local variables and then work with the local variables instead of the operand fields directly.  As simple as this:</p>
<pre><code>public void Multiply(Builder inOperandA, Builder inOperandB)
{
    uint[] a_bits = inOperandA._bits;
    uint[] b_bits = inOperandB._bits;
    int a_sign = inOperandA._sign;
    int b_sign = inOperandB._sign;
    ...
}
</code></pre>
<p>As a pleasing side-effect, this use of local variables also tends to help the compiler (or CIL-to-x64 compiler) optimize the generated code.   Sometimes it also reduces the amount of additional work necessary to make something thread-safe.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE0MTEwMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE0MTEwMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE0MTEwMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487141103">
    <div>
      

  

<details data-body-version="c860138b9cef54079d1248dc078b996d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c860138b9cef54079d1248dc078b996d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Maybe an example would help. Consider the following variation of computing an arithmetic series:<br>
BigInteger ArithmeticSeries(BigInteger n, BigInteger a1, BigInteger d) =&gt;<br>
(2 * a1 + (n - 1) * d) * n / 2;<br>
How would you do the same thing using BigInteger.Builder?</p>
</blockquote>
<p>I agree, this example certainly helps.  If the design is as I proposed, then the following demonstrates an <strong>optimized</strong> implementation of the above expression.</p>
<pre><code>BigInteger ArithmeticSeries(BigInteger n, BigInteger a1, BigInteger d)
{
    var r = new BigInteger.Builder();
    r.Multiply(2, a1);   // r = 2 * a1;

    var t = new BigInteger.Builder();
    t.SubtractOne(n);    // t = n - 1;
    t.Multiply(t, d);    // t = t * d;
    r.Add(r, t);         // r = r + t;

    r.Multiply(r, n);    // r = r * n;
    r.Divide(r, 2);      // r = r / 2;
    return r.ToBigInteger();
}
</code></pre>
<p>In addition to having <code>Builder.Multiply(BigInteger, BigInteger)</code>, consider also having <code>MultiplyBy</code> and <code>DivideBy</code> methods that are simply one-liner shortcuts that invoke <code>Multiply</code> or <code>Divide</code>.  Thus the above example would be simplified to:</p>
<pre><code>BigInteger ArithmeticSeries(BigInteger n, BigInteger a1, BigInteger d)
{
    var r = new BigInteger.Builder();
    r.Multiply(2, a1);   // r = 2 * a1;

    var t = new BigInteger.Builder();
    t.SubtractOne(n);    // t = n - 1;
    t.MultiplyBy(d);     // t *= d;
    r.AddWith(t);        // r += t;

    r.MultiplyBy(n);     // r *= n;
    r.DivideBy(2);       // r /= 2;
    return r.ToBigInteger();
}
</code></pre>
<pre><code>class Builder
{
    public void Add(BigInteger operandA, BigInteger operandB) { ... }
    public void Multiply(BigInteger operandA, BigInteger operandB) { ... }
    public void Divide(BigInteger operandA, BigInteger operandB) { ... }
    
    public void AddWith(BigInteger operand)
    {
        this.Add(this, operand);
    }
    
    public void MultiplyBy(BigInteger operand)
    {
        this.Multiply(this, operand);
    }
    
    public void DivideBy(BigInteger operand)
    {
        this.Divide(this, operand);
    }
}
</code></pre>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE0ODQ3OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE0ODQ3OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE0ODQ3OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487148479">
    <div>
      

  

<details data-body-version="8d48710995f2186244e86ecec1f375d7">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8d48710995f2186244e86ecec1f375d7" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>If the design is as I said except now with the idea of making each method finish with <code>return this;</code>, then ArithmeticSeries could be written as:</p>
<pre><code>BigInteger ArithmeticSeries(BigInteger n, BigInteger a1, BigInteger d)
{
    var r = BigInteger.Builder.New(2).MultiplyBy(a1);
    r.AddWith( BigInteger.Builder.New(n).Decrement().MultiplyBy(d) );
    return r.MultiplyBy(n).DivideBy(2).ToBigInteger();
}
</code></pre>
<p>Or if you really want to write it all on a single line, then the following is also valid, although not necessarily better in terms of code readability/maintainability.</p>
<pre><code>BigInteger ArithmeticSeries(BigInteger n, BigInteger a1, BigInteger d)
{
    return BigInteger.Builder.New(2).MultiplyBy(a1).AddWith( BigInteger.Builder.New(n).Decrement().MultiplyBy(d) ).MultiplyBy(n).DivideBy(2).ToBigInteger();
}
</code></pre>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE1Nzg2NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE1Nzg2NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE1Nzg2NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse"><img height="40" width="40" alt="@Clockwork-Muse" src="https://avatars1.githubusercontent.com/u/5569508?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487157864">
    <div>
      

  

<details data-body-version="90a88dae629e501e7d3d7ebc671bf7db">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="90a88dae629e501e7d3d7ebc671bf7db" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode">@verelpode</a> -</p>
<blockquote>
<p>I've done some work in this area and my experience was that this ability is easy enough to support, if you implement it by simply loading the operand fields into local variables and then work with the local variables instead of the operand fields directly. As simple as this:</p>
</blockquote>
<p>Doing something like that would require a copy of the underlying data, since copying the pointer wouldn't have a material effect on the outcome.  Now, you would only have to copy in the case that the operands were the same, and I'd actually only copy the "result" operand (and set it at the end of the operation), since that's the only one that would be modified.</p>
<blockquote>
<p>Sometimes it also reduces the amount of additional work necessary to make something thread-safe.</p>
</blockquote>
<p>Builders are almost never thread-safe, nor do most usecases warrant that.  The main problem is the fact that interleaving calls to a mutable piece of data is inherently dangerous, even if the internal representation doesn't tear or otherwise protects itself from corruption.</p>
<blockquote>
<p>If the design is as I said except now with the idea of making each method finish with <code>return this</code>...</p>
</blockquote>
<p>At this point (and I would personally prefer a <code>this</code>-returning type), do we really have a <code>Builder</code>, as opposed to a <code>MutableBigInteger</code>?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE2MTA3MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE2MTA3MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE2MTA3MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick"><img height="40" width="40" alt="@svick" src="https://avatars2.githubusercontent.com/u/287848?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487161071">
    <div>
      

  

<details data-body-version="8fbc09cf5e463a5489a1cbc5a5c90fd9">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8fbc09cf5e463a5489a1cbc5a5c90fd9" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode">@verelpode</a></p>
<p>I like the example in your last post: it looks fairly close to the original expression (which makes it easier to understand) and it has only one mutable variable, which I think makes it easier to write the code correctly (because you're unlikely to mutate the wrong variable).</p>
<p>Though I note that you're exclusively using the <code>By</code> versions of operations. And if you limit yourself to just those, I think your proposal is effectively the same as the original proposal from <a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a>, except with instance methods, as suggested in the last open question.</p>
<p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse">@Clockwork-Muse</a></p>
<blockquote>
<p>At this point (and I would personally prefer a <code>this</code>-returning type), do we really have a <code>Builder</code>, as opposed to a <code>MutableBigInteger</code>?</p>
</blockquote>
<p><code>StringBuilder</code> uses that approach, so it would not be unprecedented to call such type a <code>Builder</code>. Though e.g. <code>ImmutableList&lt;T&gt;.Builder</code> does not.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE2OTMyMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE2OTMyMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE2OTMyMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487169323">
    <div>
      

  

<details data-body-version="9005fcb2d2f772bf4738e228bf704967">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9005fcb2d2f772bf4738e228bf704967" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse">@Clockwork-Muse</a></p>
<blockquote>
<p>Doing something like that would require a copy of the underlying data, since copying the pointer wouldn't have a material effect on the outcome. Now, you would only have to copy in the case that the operands were the same</p>
</blockquote>
<p>No, that's incorrect or inaccurate or "not necessarily true", depending on the precise implementation details.  For example, have a look at the preexisting source code of <code>System.Numerics.BigIntegerBuilder.Mul</code>.  Here's the start of it:</p>
<pre><code>// Multiply reg1 times reg2, putting the result in 'this'. This version never shares memory
// with either of the operands. This is useful when performing a series of arithmetic operations
// and large working buffers are allocated up front.
public void Mul(ref BigIntegerBuilder reg1, ref BigIntegerBuilder reg2) {
</code></pre>
<blockquote>
<p>Builders are almost never thread-safe,</p>
</blockquote>
<p>I didn't say that loading fields into local variables make things thread-safe, rather I said that it's a step in the direction of thread safety -- it tends to reduce the amount of additional work necessary to make something thread-safe.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE3NDI4OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE3NDI4OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE3NDI4OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487174289">
    <div>
      

  

<details data-body-version="24d88d436a895444350c57aa284e74ea">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="24d88d436a895444350c57aa284e74ea" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick">@svick</a></p>
<blockquote>
<p>if you limit yourself to just those, I think your proposal is effectively the same as the original proposal from <a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a>, except with instance methods, as suggested in the last open question.</p>
</blockquote>
<p>True, <a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a> may well have already thought of practically the same thing.  Nevertheless I think it was still useful to work through your ArithmeticSeries example and explain in more detail, in order to decide the best way to go.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE5NTUyNw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzE5NTUyNw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzE5NTUyNw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse"><img height="40" width="40" alt="@Clockwork-Muse" src="https://avatars1.githubusercontent.com/u/5569508?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487195527">
    <div>
      

  

<details data-body-version="fa2c8b8e6d6ab2cdc073786a0ee24d37">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="fa2c8b8e6d6ab2cdc073786a0ee24d37" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode">@verelpode</a> -</p>
<blockquote>
<p>No, that's incorrect or inaccurate or "not necessarily true", depending on the precise implementation details. For example, have a look at the preexisting source code of <code>System.Numerics.BigIntegerBuilder.Mul</code>. Here's the start of it:</p>
</blockquote>
<p>I was speaking about attempting to use the <code>this</code> object as either of the operands, I should have been a little clearer.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzIwMjg3NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzIwMjg3NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzIwMjg3NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487202875">
    <div>
      

  

<details data-body-version="e281ee11ac3a25e9ef630bb52a7f4f85">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e281ee11ac3a25e9ef630bb52a7f4f85" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse">@Clockwork-Muse</a> OK, I could have been clearer too, and I might have made it sound easier than it is in reality.  Anyway, the important points are:</p>
<ol>
<li>It's not difficult to permit either operand to be the same instance as the other operand OR the same instance as <code>this</code>, but yes it is important to mention and remember this issue in order to prevent a faulty implementation.</li>
<li>Duplication of an operand's underlying data/array is <em>not</em> necessarily required, even when it is the same instance as the other operand or <code>this</code>, depending on how the algorithm is written.  For example, see <code>System.Numerics.BigIntegerBuilder.Mul(ref BigIntegerBuilder, ref BigIntegerBuilder)</code> and other big-integer math algorithms that don't destructively interfere.  When an algorithm modifies an array element but never again reads that array element, it can succeed even when it is the same instance as the other operand or <code>this</code>, even without prior duplication, but it depends on which math operation it is, addition including subtraction, or multiplication, or division, and which algorithm is used.</li>
<li>In the case when the operands are BigInteger not Builder, then BigInteger is immutable thus merely copying the pointer is as good as copying the underlying data.  It seems to be not-yet-decided whether the operands will be BigInteger or Builder or both supported.</li>
</ol>
<p>"Double buffering" is another technique that can potentially be used to eliminate prior duplication of operands.  The Builder has 2 buffers, one in use, one not in use, and it alternates between them.  The result of a math operation is stored in whichever buffer is not currently in-use, and the in-use and not-in-use status of the 2 buffers is swapped.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzIxMjM2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzIxMjM2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzIxMjM2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487212366">
    <div>
      

  

<details data-body-version="bc8d268e14a893bbf388f0dc164e2747">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="bc8d268e14a893bbf388f0dc164e2747" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/svick/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/svick">@svick</a> mentioned previously that BigInteger recently received <a href="https://docs.microsoft.com/en-us/dotnet/api/system.numerics.biginteger.-ctor?view=netcore-3.0#System_Numerics_BigInteger__ctor_System_ReadOnlySpan_System_Byte__System_Boolean_System_Boolean_" rel="nofollow">a new constructor that accepts <code>Span&lt;byte&gt;</code></a>. Let's put the same constructor in Builder, but not only byte, please let's also support UInt32.  Byte is good in relation to binary serialization/deserialization purposes, whereas UInt32 is good for importing big integer data that was generated at runtime and that has nothing to do with serialization.  Thus:</p>
<pre><code>public Builder (ReadOnlySpan&lt;byte&gt; value, bool isUnsigned = false, bool isBigEndian = false);
public Builder (ReadOnlySpan&lt;UInt32&gt; value, bool isUnsigned = false);
public Builder (ReadOnlySpan&lt;UInt64&gt; value, bool isUnsigned = false);
public Builder (ReadOnlySpan&lt;native int&gt; value, bool isUnsigned = false);
</code></pre>
<p>In my opinion, the "isBigEndian" parameter is only applicable for byte not UInt32 (I wrote more details about this in a <a href="https://github.com/dotnet/corefx/issues/36682#issuecomment-480941369">previous comment</a>.)</p>
<p>Setting a Builder to <code>ReadOnlySpan&lt;byte&gt;</code> shouldn't be limited to the constructor.  Thus I suggest that the constructors invoke public <code>SetValue</code> methods as follows:</p>
<pre><code>public Builder (ReadOnlySpan&lt;byte&gt; value, bool isUnsigned = false, bool isBigEndian = false)
{
    this.SetValue(value, isUnsigned, isBigEndian);
}
public Builder (ReadOnlySpan&lt;UInt32&gt; value, bool isUnsigned = false)
{
    this.SetValue(value, isUnsigned);
}
public Builder (ReadOnlySpan&lt;UInt64&gt; value, bool isUnsigned = false)
{
    this.SetValue(value, isUnsigned);
}
public Builder (ReadOnlySpan&lt;native int&gt; value, bool isUnsigned = false)
{
    this.SetValue(value, isUnsigned);
}

public void SetValue(ReadOnlySpan&lt;byte&gt; value, bool isUnsigned = false, bool isBigEndian = false) { ... }
public void SetValue(ReadOnlySpan&lt;UInt32&gt; value, bool isUnsigned = false) { ... }
public void SetValue(ReadOnlySpan&lt;UInt64&gt; value, bool isUnsigned = false) { ... }
public void SetValue(ReadOnlySpan&lt;native int&gt; value, bool isUnsigned = false) { ... }

public void SetValue(Int32 value) { ... }
public void SetValue(UInt32 value) { ... }
public void SetValue(Int64 value) { ... }
public void SetValue(UInt64 value) { ... }

public void SetValue(UInt8 value) { this.SetValue((UInt32)value); }
public void SetValue(UInt16 value) { this.SetValue((UInt32)value); }
</code></pre>
<p>Although the <code>SetValue(UInt8)</code> and <code>SetValue(UInt16)</code> appear completely superfluous at first glance, they're not.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzI0NzQzNg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzI0NzQzNg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzI0NzQzNg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487247436">
    <div>
      

  

<details data-body-version="1765cf8774897e0d2f9ec1a10d81dff8">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1765cf8774897e0d2f9ec1a10d81dff8" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>I like the example in your last post: it looks fairly close to the original expression</p>
</blockquote>
<p>I might end up with the same preference as you, but here's something to consider:  Although that ArithmeticSeries example was helpful and a good start (I'm not criticizing it), it may be worthwhile to work through another example; this time an example that suits real modern software engineering practices as opposed to an artificial example similar to what mathematicians and math teachers produce.</p>
<p>Unfortunately math teachers continue to use a very old style that causes never-ending difficulties and complaints from students.  In the beginning of software engineering, the old problematic mathematical style was copied into software engineering, but in modern software engineering, especially in teamwork, it is increasingly recognized that it is bad practice to obscurely name variables, parameters, or fields as "q1" and "q2" instead of something meaningful such as "remainingDistance" and "estimatedDistance".</p>
<p>In the past, "q1" and "q2" were viewed as intelligent because people thought:<br>
<em>"I understand nothing of what he wrote therefore he must be super intelligent.  The more complex and difficult it is to understand, the smarter it must be.  When I write something, I'll likewise write it in a way that is impressively obscure and complex."</em></p>
<p>Nowadays the attitude in professional software engineering is increasingly becoming like this:<br>
<em>"Obscure names such as q1 and q2 cause difficulties for team members / coworkers and long-term maintainability of code.  Our team runs better when the code is clear and easy to understand, as much as possible/practical.  Whenever possible, a simple-but-effective solution is impressive and intelligent.  Artificial complexity causes problems such as increased rate of mistakes/bugs, additional cost and delay to produce the next version, and difficulty transferring code between coworkers."</em></p>
<p>I was shocked when I heard a university mathematics professor say <em>proudly</em>:<br>
<em>"And this is exactly the same today as it was 200 years ago!"</em></p>
<p>I was shocked because he said it with pride and joy, whereas I thought:<br>
<em>"Aren't you the least bit embarrassed about having made no progress, no advancements, no improvements during the last 200 years?  I'd reconsider before I'd proudly announce no changes after 200 years."</em></p>
<p>My point is, we are software engineers not mathematics professors, therefore let's design BigInteger.Builder to suit modern professional software engineering practices, not to suit badly-written math textbooks that torment poor university students year after year after year.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMwOTE5NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMwOTE5NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMwOTE5NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/Clockwork-Muse/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Clockwork-Muse"><img height="40" width="40" alt="@Clockwork-Muse" src="https://avatars1.githubusercontent.com/u/5569508?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487309195">
    <div>
      

  

<details data-body-version="7793beee19238c382947f838ad3c2221">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="7793beee19238c382947f838ad3c2221" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>In the past, "q1" and "q2" were viewed as intelligent because people thought:<br>
<em>"I understand nothing of what he wrote therefore he must be super intelligent. The more complex and difficult it is to understand, the smarter it must be. When I write something, I'll likewise write it in a way that is impressively obscure and complex."</em></p>
</blockquote>
<p>....I don't think this was ever actually true.</p>
<p>Discounting the common practice of short variable names for loop counters (which should probably be changed to more descriptive names in many cases, although I doubt they were ever intended to look complex), in some older languages <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)#Length_of_identifiers" rel="nofollow">there was literally a maximum length that the parser/linker would accept</a>:</p>
<blockquote>
<p>early linkers which required variable names to be restricted to 6 characters to save memory. A later "advance" allowed longer variable names to be used for human comprehensibility, but where only the first few characters were significant. In some versions of BASIC such as TRS-80 Level 2 Basic, long names were allowed, but only the first two letters were significant. This feature permitted erroneous behaviour that could be difficult to debug, for example when names such as "VALUE" and "VAT" were used and intended to be distinct.</p>
</blockquote>
<p>(BASIC isn't the only language with a restriction like this - many punchcard/columnar-based languages would be restricted due to the input/storage medium!)</p>
<p>And while it's true that at least some of the tradition for short variable names comes from mathematics, there variable names aren't intended to obscure things, but rather most of the time it's intended as an abstraction, and you just want "something that's not a digit".</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMxNDMwMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMxNDMwMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMxNDMwMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487314303">
    <div>
      

  

<details data-body-version="10cdd189e6017d6cdd282514fa47a312">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="10cdd189e6017d6cdd282514fa47a312" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Sure, sometimes I use single-letter names as well, especially "i" in "for" loops.  I don't want to be an extremist against single-letter names.  It's a judgement call.  The preference for descriptive names is only a <strong>guideline</strong>, not a hard rule from an extremist who can only see black and white and nothing in-between.</p>
<p>Good point re some early languages being incapable of longer names, but the problem of artificial obscurity also pops up in languages that do support long names.  I can't speak for your experiences, but in my experience, I have personally experienced cases of artificially-introduced obscurity/complexity.  Fake complexity intended to impress.  I have encountered real people who are elitist and view obscurity as a sign of intelligence and simplicity as a sign of a plebeian.   (Not svick. I know svick wasn't doing that.)</p>
<blockquote>
<p>At this point (and I would personally prefer a this-returning type), do we really have a Builder, as opposed to a MutableBigInteger?</p>
</blockquote>
<p>I prefer the name "Builder" because it indicates that instances of Builder are intended/designed to have a relatively short lifespan, whereas instances of immutable BigInteger are suitable for long-term storage of values.  In contrast, if Builder is named "MutableBigInteger", then it sounds like it's suitable for long-term storage but it likely won't be (depending on how it's implemented).</p>
<p>For example, if a Builder implementation happened to use the aforementioned double-buffering technique to avoid operand duplications, then a Builder instance can contain 2 arrays and this is satisfactory for a Builder <em>but not for a MutableBigInteger.</em>  If a MutableBigInteger is stored for a long time and it contains a large secondary array/buffer that is unused, then it's a design defect.</p>
<p>Likewise in general, if any Builder class is named "Builder", then the implementation has the freedom to store any temporary objects that may be helpful in private fields of Builder.  This implementation freedom and optimization freedom is cancelled if Builder is named "MutableBigInteger" because the lifetime/scope of "MutableBigInteger" becomes unclearly defined.</p>
<p>The reason for having 2 classes -- one immutable and one Builder -- is a clearly defined reason with a well-known advantage, whereas if we have "ImmutableX" and "MutableX", then the design has an awkward question such as:  Why not just use "MutableX" for everything and delete "ImmutableX" entirely?  Thus a design of "ImmutableX" plus "MutableX" is harder to justify than "ImmutableX" plus "ImmutableX.Builder".  I'd stick with Tanner's naming regardless of whether the methods do <code>return this;</code></p>
<p>If the Builder pattern is claimed to be wrong, then it would mean that <code>System.String</code> can be deleted and <code>System.Text.StringBuilder</code> used instead, in all places where strings are used.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyMjYzNg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyMjYzNg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMyMjYzNg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487322636">
    <div>
      

  

<details data-body-version="382c2b5bfeb307e7af9fc556996f190a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="382c2b5bfeb307e7af9fc556996f190a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>To be consistent with <code>BitwiseAnd</code> and <code>BitwiseOr</code>, I suggest renaming <code>Xor</code> to <code>BitwiseExclusiveOr</code>.  Nowadays VS/IntelliSense makes it easy to use full names.  See also <code>System.Linq.Expressions.Expression.ExclusiveOr</code> and <code>ExclusiveOrAssign</code>.  "And", "Or", and "Exclusive Or" are all the same category -- they're all <a href="https://en.wikipedia.org/wiki/Boolean_algebra" rel="nofollow">boolean logic functions</a> therefore it'd be good to name them consistently with each other.</p>
<p><code>LeftShift</code> and <code>RightShift</code> could be renamed to <code>BitwiseShiftLeft</code> and <code>BitwiseShiftRight</code>.  (Alternatively <code>BitwiseShiftUp</code> (left) and <code>BitwiseShiftDown</code> (right) are better names except for being non-traditional.  I expect that people will want to stick with the traditional names in this case.)</p>
<p>I notice the proposed API contains both <code>Remainder</code> AND <code>Modulus</code>.  Is that intentional somehow?</p>
<p>I suggest renaming <code>Builder.Pow</code> to <code>Power</code> (or maybe <code>RaiseBy</code>) because "pow()" is an obsolete function name from the "bad old days" of plain C -- the Wild Wild West of programming -- the medieval middle ages of software -- the Dark Ages.  Even when RAM was much smaller than it is today, there was no justifiable logical reason for truncating the name of this function by removing the last 2 bytes/chars.</p>
<p>Note if <code>Builder.Multiply</code> will not exist and only <code>Builder.MultiplyBy</code> will exist, then the Power method would operate likewise and would be named something like <code>RaiseBy</code> I guess.</p>
<p>Unfortunately <code>System.Math.Pow</code> continues the bad practice from C, but there is no good reason why <code>BigInteger.Builder</code> should perpetuate this bad practice just because <code>System.Math</code> contains some unfortunate naming.  Anyway possibly this issue will be side-stepped via AddWith, MultiplyBy, DivideBy, RaiseBy, etc.</p>
<p>Last night I had a nightmare about the bad old days.  I dreamed that I was forced to write a huge section of an app using plain old C.  I woke up screaming and drenched in sweat.  I grabbed the phone and immediately called the emergency hotline and exclaimed anxiously: <em>"I'm deathly worried about having a huge C section!!"</em><br>
The guy replied calmly:  <em>"Don't worry. You're a man. Men don't have C sections."</em></p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNTE4Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNTE4Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMyNTE4Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding"><img height="40" width="40" alt="@tannergooding" src="https://avatars2.githubusercontent.com/u/10487869?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487325182">
    <div>
      

  

<details data-body-version="8c759d3412ac33827b15c99dc4064603">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8c759d3412ac33827b15c99dc4064603" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>To be consistent with BitwiseAnd and BitwiseOr, I suggest renaming Xor to BitwiseExclusiveOr.</p>
</blockquote>
<p>There are pre-existing "friendly" names that exist for all the standard operators. The names I used above follow that: <a rel="nofollow" href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/operator-overloads">https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/operator-overloads</a></p>
<blockquote>
<p>I notice the proposed API contains both Remainder AND Modulus. Is that intentional somehow?</p>
</blockquote>
<p>Remainder and Modulus are different functions and have different behaviors when dealing with negative numbers.</p>
<blockquote>
<p>I suggest renaming Builder.Pow to Power (or maybe RaiseBy) because "pow()" is an obsolete function</p>
</blockquote>
<p>This is still the standard name used by most spec's, frameworks, and languages (including .NET). It is also the name used by the existing <code>BigInteger</code> class. Having consistency is generally considered better and it will likely not change.</p>
<blockquote>
<p>At this point (and I would personally prefer a this-returning type), do we really have a Builder, as opposed to a MutableBigInteger?</p>
</blockquote>
<p>The builder pattern and calling the mutable version "Builder" is an existing convention we have.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNTIyOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNTIyOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMyNTIyOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding"><img height="40" width="40" alt="@tannergooding" src="https://avatars2.githubusercontent.com/u/10487869?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487325229">
    <div>
      

  

<details data-body-version="e7455b79cf209b659eeae67ed544d4b1">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e7455b79cf209b659eeae67ed544d4b1" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>The conversations above have covered some great points so far. I'll try to collect the points covered so far and updated the original post sometime soon (including examples of the different suggested patterns).</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNjk5Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyNjk5Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMyNjk5Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487326996">
    <div>
      

  

<details data-body-version="bb0f445114e779748854ed3edf02f23f">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="bb0f445114e779748854ed3edf02f23f" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Should Builder accept operands of type Builder or BigInteger or both?  Following I've written an incomplete example implementation that demonstrates one way of allowing the operand of <code>MultiplyBy</code> to be Builder, BigInteger, uint, or UInt64 (signed int would also be supported but is not shown here).</p>
<p>This is implemented as a wrapper around the preexisting internal struct <code>System.Numerics.BigIntegerBuilder</code>, which I renamed to <code>SBigIntegerBuilder</code> in this example for clarity.</p>
<p>This already supports <strong>copy-on-write</strong> via the preexisting <code>System.Numerics.BigIntegerBuilder._fWritable</code>.</p>
<p>This isn't intended to be a real nor proper implementation.  It is only an example of what is possible.  This does contain bugs -- for example, it doesn't even try to calculate the correct sign of the multiplication result.  Likewise yes one must be careful to prevent malfunction when the operand is the same instance as <code>this</code> and there exists more than one solution to that issue.</p>
<pre><code>public class Builder
{
    private SBigIntegerBuilder _internalBuilder;

    public Builder MultiplyBy(Builder inOperand)
    {
        _internalBuilder.Mul(ref inOperand._internalBuilder);
        return this;
    }

    public Builder MultiplyBy(BigInteger inOperand)
    {
        SBigIntegerBuilder operandAsSBuilder = new SBigIntegerBuilder(inOperand);
        _internalBuilder.Mul(ref operandAsSBuilder);
        return this;
    }

    public Builder MultiplyBy(uint inOperand)
    {
        SBigIntegerBuilder operandAsSBuilder = new SBigIntegerBuilder();
        operandAsSBuilder.Set(inOperand);
        _internalBuilder.Mul(ref operandAsSBuilder);
        return this;
    }

    public Builder MultiplyBy(UInt64 inOperand)
    {
        SBigIntegerBuilder operandAsSBuilder = new SBigIntegerBuilder();
        operandAsSBuilder.Set(inOperand);
        _internalBuilder.Mul(ref operandAsSBuilder);
        return this;
    }

} // class Builder
</code></pre>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyOTM2Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4NzMyOTM2Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4NzMyOTM2Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-487329362">
    <div>
      

  

<details data-body-version="302c5932b5b5b8a22c74eba73e7dda6f">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="302c5932b5b5b8a22c74eba73e7dda6f" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>The idea of "MultiplyBy" with <code>return this;</code> was liked.  Although the English language makes the "By" naming easy for multiplication and division, unfortunately English does not make it so easy for subtraction.  Therefore note the following difference between <code>SubtractWith</code> versus <code>SubtractFrom</code>.  The many peculiarities of English and other natural languages.  Here is a list of potential names, not without some flaws.</p>
<pre><code>r.Increment()       means r = r + 1;
r.Decrement()       means r = r - 1;
r.AddWith(b)        means r = r + b;
r.SubtractWith(b)   means r = r - b;
r.SubtractFrom(b)   means r = b - r;
r.MultiplyBy(b)     means r = r * b;
r.DivideBy(divisor) means r = r / divisor;
r.DivideToRemainderBy(b) means remainder of r divided by b;
r.RaiseBy(exponent)  means r = r ** exponent; means r = Power(r, exponent);
r.PowerModulo(exponent, modulus)  means DivRemainder(Power(value, exponent), modulus);

r.MakePositive()     means r = abs(r);
r.MakeNegative()     means r = -abs(r);
r.InvertSign()       means r = -r;

r.BitwiseAndWith(b)  means r = r &amp; b;
r.BitwiseOrWith(b)   means r = r | b;
r.BitwiseExclusiveOrWith(b) means r = r ^ b;
r.OnesComplement()   means r = -(r + 1);
r.BitwiseShiftLeft(amount)  means r = r &lt;&lt; amount;
r.BitwiseShiftRight(amount) means r = r &gt;&gt; amount;

r.SelectLowest(b)    means r = min(r, b);
r.SelectHighest(b)   means r = max(r, b);

r.GreatestCommonDivisor(b) means r = GCD(r, b);
r.NaturalLogarithm() means r = BigInteger.Log(r);
r.Logarithm10()      means r = BigInteger.Log10(r);
r.Logarithm(base)    means r = BigInteger.Log(r, base);
</code></pre>
<p>Yes I deliberately included a couple of names that provoke controversy and quarrel because on one hand they are better names but on the other hand, many people find it impossibly difficult to change old ingrained habits/traditions even when the tradition is something as wildly nuts as drinking car fuel (ethanol) every weekend as if it's perfectly normal for everyone to drink car fuel.  Cheers :-)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4ODA5NDA2NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4ODA5NDA2NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4ODA5NDA2NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-488094064">
    <div>
      

  

<details data-body-version="a4010191567aa344845f90a432bd81ef">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a4010191567aa344845f90a432bd81ef" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Remainder and Modulus are different functions and have different behaviors when dealing with negative numbers.</p>
</blockquote>
<p>Aha, I didn't realize that.  In that case, shouldn't the Modulus method be renamed to <strong>Modulo</strong>?  Here's the definition of <a href="https://en.oxforddictionaries.com/definition/modulus" rel="nofollow">"modulus" in Oxford English Dictionary</a>:</p>
<blockquote>
<p>Mathematics: 1 another term for absolute value<br>
1.1 The positive square root of the sum of the squares of the real and imaginary parts of a complex number.<br>
2 A constant factor or ratio.<br>
3 A number used as a divisor for considering numbers in sets, numbers being considered congruent when giving the same remainder when divided by a particular modulus.</p>
</blockquote>
<p>Definitions 1 and 1.1 are also examples of the problem that I mentioned -- elitism and deliberate obfuscation -- and such behavior is unprofessional and bad for teamwork and should not be adopted into software engineering.  Definition 3 is the nearest to what BigInteger needs but it says that the <strong>"modulus" is the divisor</strong>, which would mean that where the Builder proposal currently says....</p>
<pre><code>public static Builder Modulus(Builder dividend, Builder divisor);
</code></pre>
<p>...the "divisor" parameter is also known as "modulus", but let's keep the name "divisor" because the name "modulus" makes no sense.</p>
<p><a href="https://en.wikipedia.org/wiki/Modulo_operation" rel="nofollow">"Modulo operation" in Wikipedia</a> says the same as Oxford -- that the divisor is sometimes called modulus:</p>
<blockquote>
<p>In computing, the modulo operation finds the remainder after division of one number by another (sometimes called modulus).</p>
</blockquote>
<ul>
<li>Name of the operation:  Modulo</li>
<li>Name of the divisor:  Divisor or modulus</li>
<li>Name of the result:  Remainder</li>
</ul>
<p>Mathematical terminology is a minefield and desperately needs to be updated but as I mentioned, unfortunately the attitude is that it's impressive to have 200 years without progress/changes, and that "obfuscation = super intelligent".</p>
<p><a href="https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/operator-overloads" rel="nofollow">C# "Operator Overloads"</a> doesn't actually say that the modulo operation should be called modulus.  It says that the "Friendly Name" is "Mod or Remainder" therefore it suggests <code>Builder.Mod</code> or <code>Builder.Remainder</code> not <code>Builder.Modulus</code>.  Unfortunately the metadata name is "op_Modulus" but that's irrelevant because that's a hidden internal compiler-generated name that the C# compiler stores into a compiled Assembly, not normally visible to the user of the C# language.  <code>Builder.Mod</code> isn't a hidden internal compiler-generated name, therefore the internal "op_Modulus" can be ignored.</p>
<p>See also the preexisting <code>BigInteger.ModPow</code> method:</p>
<pre><code>public static BigInteger ModPow(BigInteger value, BigInteger exponent,BigInteger modulus)
</code></pre>
<p>This "modulus" parameter in <code>BigInteger.ModPow</code> is consistent with OED and Wikipedia, whereas the proposed <code>Builder.Modulus</code> method is not.<br>
Damn, I only wanted to write a short message about this topic.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4ODY4NzQwMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4ODY4NzQwMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4ODY4NzQwMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/FiniteReality/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/FiniteReality"><img height="40" width="40" alt="@FiniteReality" src="https://avatars0.githubusercontent.com/u/21000186?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-488687402">
    <div>
      

  

<details data-body-version="327b7681400d1ae5ac0b537b480fbd69">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="327b7681400d1ae5ac0b537b480fbd69" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Since there's a way to get a byte[] from the Builder, shouldn't there be a way to get a Span from the builder? BigInteger has TryWriteBytes, so I'm guessing this was missed.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTE5Mjc4MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTE5Mjc4MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTE5Mjc4MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489192781">
    <div>
      

  

<details data-body-version="1aa1d8e026bcc329c5cc5b0eb2bafcff">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1aa1d8e026bcc329c5cc5b0eb2bafcff" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/FiniteReality/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/FiniteReality">@FiniteReality</a> I agree.  This should be supported in both directions.  For the direction Span-to-BigInteger, see my <a href="https://github.com/dotnet/corefx/issues/37204#issuecomment-487212366">previous comment</a>, and for the direction BigInteger-to-Span, I suggest the following methods.  What do you think?</p>
<pre><code>class Builder
{
    public int CopyTo(Span&lt;byte&gt; destination, bool isUnsigned = false, bool isBigEndian = false);
    public int CopyTo(Span&lt;UInt32&gt; destination, bool isUnsigned = false);
    public int CopyTo(Span&lt;UInt64&gt; destination, bool isUnsigned = false);

    // Span might be unsupported in some environments, therefore also support arrays directly:
    public int CopyTo(byte[] destination, int destinationIndex, bool isUnsigned = false, bool isBigEndian = false);
    public int CopyTo(UInt32[] destination, int destinationIndex, bool isUnsigned = false);
    public int CopyTo(UInt64[] destination, int destinationIndex, bool isUnsigned = false);
}

struct BigInteger
{
    // BigInteger and BigInteger.Builder should both have the same "CopyTo" methods.
    public int CopyTo(...);
}
</code></pre>
<p>The name <code>CopyTo</code> is consistent with <code>System.Collections.Generic.ICollection&lt;T&gt;.CopyTo(T[] array, int arrayIndex)</code>.</p>
<p>I defined <code>CopyTo</code> to return int.  It should return the number of elements copied/written to the destination span or array, which may be less than the length of the span.  If the span length (or remaining array length) is insufficient, then do nothing and throw exception.  When copying to a byte array or span, CopyTo should return the same as <code>Builder.GetByteCount</code>.  When copying to a UInt32 array or span, the measurement unit of <code>destinationIndex</code> and the return value are elements not bytes, thus <code>CopyTo(Span&lt;UInt32&gt;, ...)</code> returns a length equalling <code>Builder.GetByteCount(...) / sizeof(UInt32)</code>.</p>
<p>In my opinion, <code>Span&lt;UInt32&gt;</code> and <code>Span&lt;UInt64&gt;</code> should be supported, not only <code>Span&lt;byte&gt;</code>, because byte is for serialization/deserialization purposes whereas UInt32 and UInt64 are for importing/exporting data generated at runtime unrelated to serialization.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIwMjA4Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIwMjA4Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTIwMjA4Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489202082">
    <div>
      

  

<details data-body-version="bd84ea4eb8ec2cffbcbf2f8b29f2ff75">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="bd84ea4eb8ec2cffbcbf2f8b29f2ff75" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I also suggest adding the following "TryConvertTo" methods to both of <code>BigInteger.Builder</code> and <code>BigInteger</code>.  These methods attempt to typecast/convert the BigInteger or BigInteger.Builder <em>without</em> throwing <code>System.OverflowException</code>, unlike the existing typecast operators in BigInteger.  The following methods should return false if conversion is unsucccessful (meaning return false if the BigInteger does not fit within the specified smaller integer type).</p>
<pre><code>public bool TryConvertTo(out Int32 outValue);
public bool TryConvertTo(out Int64 outValue);
public bool TryConvertTo(out UInt32 outValue);
public bool TryConvertTo(out UInt64 outValue);

// The following would throw exception when conversion is unsucccessful:
public Int32 ConvertToInt32();
public Int64 ConvertToInt64();
public UInt32 ConvertToUInt32();
public UInt64 ConvertToUInt64();
</code></pre>
<p>Alternatively "TryConvertTo" could be named "TryConvert".</p>
<p>Actually I prefer to make the "TryConvertTo" methods return a nullable integer (as follows) instead of boolean and output parameter, but I changed the proposal to bool+out because <a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a> wanted it.  I don't agree but I've accepted Tanner's decision, so the proposal is now boolean+out, whereas the previous proposal was:</p>
<pre><code>public Int32? TryConvertToInt32();
public Int64? TryConvertToInt64();
public UInt32? TryConvertToUInt32();
public UInt64? TryConvertToUInt64();

public Int32 ConvertToInt32();
public Int64 ConvertToInt64();
public UInt32 ConvertToUInt32();
public UInt64 ConvertToUInt64();
</code></pre>
<p>In the case of converting to unsigned UInt64, if the BigInteger is less than zero (<code>UInt64.MinValue</code>) or greater than <code>UInt64.MaxValue</code>, then <code>TryConvertTo(out UInt64)</code> would return false.</p>
<p>For 128-bit integers, the following TryConvertToInt128 method would return true if the conversion is successful.  The sign would be output separately via the boolean "outNegative" parameter (I've found that separated sign is quite useful), thus the "outLowPart" and "outHighPart" parameters are in-effect set to what would be the result of <code>BigInteger.Abs</code>.</p>
<pre><code>public bool TryConvertToInt128(out UInt64 outLowPart, out UInt64 outHighPart, out bool outNegative)
{
	outNegative = (_sign &lt; 0);
	...
}

// Conversion to unsigned 128-bit integer:
public bool TryConvertToUInt128(out UInt64 outLowPart, out UInt64 outHighPart)
{
	bool neg;
	return (this.TryConvertToInt128(out outLowPart, out outHighPart, out neg) &amp;&amp; !neg);
}

// Conversion to signed 128-bit integer with high part represented as signed 64-bit integer:
public bool TryConvertToInt128(out UInt64 outLowPart, out Int64 outHighPart)
{
	UInt64 unsignedHighPart;
	bool neg;
	if (this.TryConvertToUInt128(out outLowPart, out unsignedHighPart, out neg))
	{
		if (neg)
		{
			if (unsignedHighPart &lt;= unchecked((UInt64)Int64.MinValue))
			{
				outHighPart = unchecked(-(Int64)unsignedHighPart);
				return true; // success
			}
		}
		else if ((unsignedHighPart &gt;&gt; 64) == 0)
		{
			outHighPart = unchecked((Int64)unsignedHighPart);
			return true; // success
		}
	}
	outLowPart = 0;
	outHighPart = 0;
	return false; // unsuccessful
}
</code></pre>
<p>If desired, TryConvertTo could also be supported for floating-point as follows.</p>
<pre><code>public bool TryConvertTo(out double outValue);
public bool TryConvertTo(out single outValue);
public bool TryConvertTo(out decimal outValue);

public double ConvertToFloat64();
public single ConvertToFloat32();
public decimal ConvertToDecimal();
</code></pre>
<p>Note <code>TryConvertTo(out double)</code> etc should only return exactly converted values.  If the BigInteger would be inexactly/approx represented by float64 (System.Double), then null should be returned.  If you want an inexact conversion to float64, then use the preexisting <code>public static explicit operator Double(BigInteger value)</code> that is already present in BigInteger.  Alternatively, if desired, <code>TryConvertTo(out double)</code> might have a parameter to control exact versus inexact conversion, as follows:</p>
<pre><code>public bool TryConvertTo(out double outValue, bool approximation = false);
public bool TryConvertTo(out single outValue, bool approximation = false);
public bool TryConvertTo(out decimal outValue, bool approximation = false);
</code></pre>
<p>For reference, previously <a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a> mentioned "ConvertTo" methods in addition to the "TryConvertTo":</p>
<blockquote>
<p>We should likely also consider exposing plain ConvertToX methods for contrast (as I believe the non-throwing methods would be the explicit casts otherwise).</p>
</blockquote>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIxNDkxOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIxNDkxOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTIxNDkxOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding"><img height="40" width="40" alt="@tannergooding" src="https://avatars2.githubusercontent.com/u/10487869?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489214919">
    <div>
      

  

<details data-body-version="01904edc6310edc6e1a3fc10e7ae1357">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="01904edc6310edc6e1a3fc10e7ae1357" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Just wanted to say, as much as there are some great ideas for new APIs, they need to be split out into a separate proposal.</p>
<p>The initial proposal for the <code>BigInteger.Builder</code> should just try to provide parity with the existing <code>BigInteger</code> struct. This simplifies the review process and will give it a higher chance of being merged.</p>
<p>The entirely new APIs can then be reviewed/processed independently (which also makes their review simpler and gives them a higher chance of being accepted) with the assumption that they will either also make it into the builder (whether accepted/merged before or after the builder).</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIxNjEzNg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIxNjEzNg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTIxNjEzNg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489216136">
    <div>
      

  

<details data-body-version="1979433071b61b8bd2a7b184fb0b2f09">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1979433071b61b8bd2a7b184fb0b2f09" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I thought further about this issue:  On one hand, the idea of "MultiplyBy" with <code>return this;</code> was liked, and it works well with multiplication etc., but not with certain other special operations such as <code>Builder.GreatestCommonDivisor</code>, therefore I suggest the following API where suitable operations are represented in "By" form whereas other operations are represented in "return void" form.</p>
<pre><code>public Builder MultiplyBy(Builder operand);
public Builder MultiplyBy(BigInteger operand);
public Builder MultiplyBy(Int32 operand);
public Builder MultiplyBy(Int64 operand);

public Builder DivideBy(Builder operand);
public Builder DivideBy(BigInteger operand);
public Builder DivideBy(Int32 operand);
public Builder DivideBy(Int64 operand);

public Builder RaiseBy(Int32 exponent);
...
public Builder Increment();
public Builder Decrement();
...
public Builder InvertSign(); // will be renamed to "Negate" unfortunately.
public Builder MakePositive(); // will be renamed to "Abs" unfortunately.
public Builder MakeNegative();
public Builder OnesComplement();
...
</code></pre>
<p>And the following non-static methods return void/nothing and store the result into <code>this</code>.  Any preexisting value in <code>this</code> is ignored and overwritten.</p>
<pre><code>public void GreatestCommonDivisor(Builder left, Builder right);
public void PowerModulo(Builder value, Builder exponent, Builder modulus);
public void SelectLowest(Builder operandA, Builder operandB);
public void SelectLowest(Builder operandA, Builder operandB, Builder operandC);
public void SelectHighest(Builder operandA, Builder operandB);
public void SelectHighest(Builder operandA, Builder operandB, Builder operandC);
</code></pre>
<p>If desired, <strong>both</strong> the <code>MultiplyBy</code> and <code>Multiply</code> patterns could be supported as follows, with <code>MultiplyBy</code> implemented by invoking <code>this.Multiply</code>.</p>
<pre><code>public void Multiply(Builder operandA, Builder operandB) { ... }

public Builder MultiplyBy(Builder operand)
{
    this.Multiply(this, operand);
    return this;
}

public Builder MultiplyBy(BigInteger operand) { ... }
public Builder MultiplyBy(Int32 operand) { ... }
public Builder MultiplyBy(Int64 operand) { ... }
</code></pre>
<p>static/non-instance 3-parameter forms might also be supported as follows, and the methods with 1 and 2 parameters are implemented by invoking the 3-parameter method.</p>
<pre><code>// Non-instance method:
public static void Multiply(Builder destination, Builder operandA, Builder operandB) { ... }

// Per-instance methods:
public void Multiply(Builder operandA, Builder operandB)
{
    Builder.Multiply(this, operandA, operandB);
}

public Builder MultiplyBy(Builder operand)
{
    Builder.Multiply(this, this, operand);
    return this;
}

public Builder MultiplyBy(BigInteger operand) { ... }
public Builder MultiplyBy(Int32 operand) { ... }
public Builder MultiplyBy(Int64 operand) { ... }
</code></pre>
<p>Re the overloads to conveniently support the operand being any of Builder, BigInteger, Int32, Int64, these convenient shortcuts would probably only be supported with <code>MultiplyBy(operand)</code> not <code>Multiply(a,b)</code> and not <code>Multiply(dest,a,b)</code>, because the 2-param and 3-param methods would produce too many combinations.  See also the <code>SetValue</code> methods that I proposed in a previous message:</p>
<pre><code>class Builder
{
    public void SetValue(Int32 value) { ... }
    public void SetValue(UInt32 value) { ... }
    public void SetValue(Int64 value) { ... }
    public void SetValue(UInt64 value) { ... }

    // The following may serve as tiny optimizations but it depends on the internal details of Builder.
    public void SetValue(UInt8 value) { this.SetValue((UInt32)value); }
    public void SetValue(UInt16 value) { this.SetValue((UInt32)value); }
}
</code></pre>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIyMjQ5MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTIyMjQ5MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTIyMjQ5MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/verelpode/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/verelpode"><img height="40" width="40" alt="@verelpode" src="https://avatars3.githubusercontent.com/u/32857007?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489222491">
    <div>
      

  

<details data-body-version="89fc0edfb83b55200c91cdcaa1f8ba75">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="89fc0edfb83b55200c91cdcaa1f8ba75" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/tannergooding/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tannergooding">@tannergooding</a></p>
<blockquote>
<p>The entirely new APIs can then be reviewed/processed independently</p>
</blockquote>
<p>OK.  When you update the Builder proposal, you could place the summary/API of the separate proposal in a commented-out section like follows:</p>
<pre><code>class Builder
{
    public Builder MultiplyBy(Builder operand);
    ...

    /*
    The following methods are also proposed but will be finalized via a separate proposal.
    ...
    ...
    */
}
</code></pre>
<p>The reason for summarizing the separate proposal in a commented-out section is this:  Sometimes a design appears good when we see and consider only the small picture, but it no longer appears good when we see <strong>the big picture</strong>.  Thus I suggest that "Stage 1" is decided with inclusion of a summary of the ideas in "Stage 2" even though "Stage 2" will be implemented via a separate proposal.  This way we avoid losing the big picture, yet still gain the advantages of separation that you mentioned.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>




    
  





<!-- Rendered timeline since 2020-01-31 17:59:07 -->



            </div>


            
          </div>

</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>