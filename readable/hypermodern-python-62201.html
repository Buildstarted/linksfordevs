<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Hypermodern Python - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Hypermodern Python - linksfor.dev(s)"/>
    <meta property="article:author" content="Claudio Jolowicz"/>
    <meta property="og:description" content="A guide to modern Python tooling with a focus on simplicity and minimalism."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://cjolowicz.github.io/posts/hypermodern-python-01-setup/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Hypermodern Python</title>
<div class="readable">
        <h1>Hypermodern Python</h1>
            <div>by Claudio Jolowicz</div>
            <div>Reading time: 14-18 minutes</div>
        <div>Posted here: 28 May 2020</div>
        <p><a href="https://cjolowicz.github.io/posts/hypermodern-python-01-setup/">https://cjolowicz.github.io/posts/hypermodern-python-01-setup/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
        <p><a href="https://medium.com/@cjolowicz/hypermodern-python-d44485d9d769">Read this article on Medium</a></p>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop01.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop01.jpg"> </a>
</figure>

<p>New Year 2020 <a href="https://www.python.org/doc/sunset-python-2/">marks the end</a> of
more than a decade of coexistence of Python 2 and
3. The Python landscape has changed considerably over this period: a host of new
tools and best practices now improve the Python developer experience. Their
adoption, however, lags behind due to the constraints of legacy support.</p>
<p>This article series is a guide to modern Python tooling with a focus on
simplicity and minimalism.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> It walks you through the creation of a complete
and up-to-date Python project structure, with unit tests, static analysis,
type-checking, documentation, and continuous integration and delivery.</p>
<p>This guide is aimed at beginners who are keen to learn best practises from the
start, and seasoned Python developers whose workflows are affected by
boilerplate and workarounds required by the legacy toolbox.</p>
<h3 id="requirements">Requirements</h3>
<p>You need a recent Linux, Unix, or Mac system with
<a href="https://www.gnu.org/software/bash/">bash</a>, <a href="https://curl.haxx.se/">curl</a> and
<a href="https://www.git-scm.com/">git</a> for this tutorial.</p>
<p>On Windows 10, enable the <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">Windows Subsystem for
Linux</a> (WSL) and
install the Ubuntu 18.04 LTS distribution. Open Ubuntu from the Start Menu, and
install additional packages using the following command:</p>
<div><pre><code data-lang="sh">sudo apt update <span>&amp;&amp;</span> sudo apt install -y make build-essential libssl-dev zlib1g-dev <span>
</span><span></span>libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev <span>
</span><span></span>libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python-openssl git
</code></pre></div><h2 id="overview">Overview</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop04.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop04.jpg"> </a>
</figure>

<p>In this first chapter, we set up a Python project using
<a href="https://github.com/pyenv/pyenv">pyenv</a> and
<a href="https://python-poetry.org/">Poetry</a>. Our example project is a simple
command-line application, which uses the Wikipedia API to display random facts
on the console.</p>
<p>Here are the topics covered in this chapter:</p>
<ul>
<li><a href="#setting-up-a-github-repository">Setting up a GitHub repository</a></li>
<li><a href="#installing-python-with-pyenv">Installing Python with pyenv</a></li>
<li><a href="#setting-up-a-python-project-using-poetry">Setting up a Python project using Poetry</a></li>
<li><a href="#creating-a-package-in-src-layout">Creating a package in src layout</a></li>
<li><a href="#managing-virtual-environments-with-poetry">Managing virtual environments with Poetry</a></li>
<li><a href="#managing-dependencies-with-poetry">Managing dependencies with Poetry</a></li>
<li><a href="#command-line-interfaces-with-click">Command-line interfaces with click</a></li>
<li><a href="#example-consuming-a-rest-api-with-requests">Example: Consuming a REST API with requests</a></li>
</ul>
<p>Here is a list of the articles in this series:</p>
<ul>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-01-setup">Chapter 1: Setup</a> (this article)</li>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-02-testing">Chapter 2: Testing</a></li>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-03-linting">Chapter 3: Linting</a></li>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-04-typing">Chapter 4: Typing</a></li>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-05-documentation">Chapter 5: Documentation</a></li>
<li><a href="https://cjolowicz.github.io/posts/hypermodern-python-06-ci-cd">Chapter 6: CI/CD</a></li>
</ul>
<p>This guide has a companion repository:
<a href="https://github.com/cjolowicz/hypermodern-python">cjolowicz/hypermodern-python</a>.
Each article in the guide corresponds to a set of commits in the GitHub
repository.</p>
<ul>
<li><a href="https://github.com/cjolowicz/hypermodern-python/compare/initial...chapter01">View changes</a></li>
<li><a href="https://github.com/cjolowicz/hypermodern-python/archive/chapter01.zip">Download code</a></li>
</ul>
<h2 id="setting-up-a-github-repository">Setting up a GitHub repository</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop02.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop02.jpg"> </a>
</figure>

<p>For the purposes of this guide, <a href="https://github.com/">GitHub</a> is used to host the
public git repository for your project. Other popular options are
<a href="https://gitlab.com/">GitLab</a> and <a href="https://bitbucket.org/">BitBucket</a>. Create a
repository, and populate it with <code>README.md</code> and <code>LICENSE</code> files. For this
project, I will use the <a href="https://choosealicense.com/licenses/mit/">MIT license</a>,
a simple permissive license.</p>
<blockquote>
<p><em>Throughout this guide, replace <code>hypermodern-python</code> with the name of your own
repository. Choose a different name to avoid a name collision on PyPI.</em></p>
</blockquote>
<p>Clone the repository to your machine, and <code>cd</code> into it:</p>
<div><pre><code data-lang="sh">git clone git@github.com:&lt;your-username&gt;/hypermodern-python.git
cd hypermodern-python
</code></pre></div><p>As you follow the rest of this guide, create a series of <a href="https://deepsource.io/blog/git-best-practices/">small, atomic
commits</a> documenting your steps.
Use <code>git status</code> to discover files generated by commands shown in the guide.</p>
<h2 id="installing-python-with-pyenv">Installing Python with pyenv</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop03.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop03.jpg"> </a>
</figure>

<p>Let’s continue by setting up the developer environment. First you need to get a
recent Python. Don’t bother with package managers or official binaries. The tool
of choice is <a href="https://github.com/pyenv/pyenv">pyenv</a>, a Python version manager.
Install it like this:</p>
<div><pre><code data-lang="sh">curl https://pyenv.run | bash
</code></pre></div><p>Add the following lines to your <code>~/.bashrc</code>:</p>
<div><pre><code data-lang="sh">export PATH<span>=</span><span>"</span><span>~/.pyenv/bin:</span>$PATH<span>"</span>
eval <span>"</span><span>$(</span>pyenv init -<span>)</span><span>"</span>
eval <span>"</span><span>$(</span>pyenv virtualenv-init -<span>)</span><span>"</span>
</code></pre></div><p>Open a new shell, or source <code>~/.bashrc</code> in your current shell:</p>
<p>Install the Python build dependencies for your platform, using one of the
commands listed in the <a href="https://github.com/pyenv/pyenv/wiki/Common-build-problems">official
instructions</a>. For
example, on a recent <a href="https://ubuntu.com/">Ubuntu</a> this would be:</p>
<div><pre><code data-lang="sh">sudo apt update <span>&amp;&amp;</span> sudo apt install -y make build-essential libssl-dev zlib1g-dev <span>
</span><span></span>libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev <span>
</span><span></span>libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python-openssl git
</code></pre></div><p>You’re ready to install the latest Python releases. This may take a while:</p>
<div><pre><code data-lang="sh">pyenv install 3.8.2
pyenv install 3.7.7
</code></pre></div><p>Make your fresh Pythons available inside the repository:</p>
<p>Congratulations! You have access to the latest and greatest of Python:</p>
<div><pre><code data-lang="sh">$ python --version
Python 3.8.2

$ python3.7 --version
Python 3.7.7
</code></pre></div><p>Python 3.8.2 is the default version and can be invoked as <code>python</code>, but both
versions are accessible as <code>python3.7</code> and <code>python3.8</code>, respectively.</p>
<h2 id="setting-up-a-python-project-using-poetry">Setting up a Python project using Poetry</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop05.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop05.jpg"> </a>
</figure>

<p><a href="https://python-poetry.org/">Poetry</a> is a tool to manage Python packaging and
dependencies. Its ease of use and support for modern workflows make it the ideal
successor to the venerable <a href="http://setuptools.readthedocs.io/">setuptools</a>. It is
similar to <code>npm</code> and <code>yarn</code> in the JavaScript world, and to other modern package
and dependency managers. For alternatives to Poetry, have a look at
<a href="https://github.com/takluyver/flit">flit</a>,
<a href="https://pipenv.kennethreitz.org/en/latest/">pipenv</a>,
<a href="https://github.com/David-OConnor/pyflow">pyflow</a>, and
<a href="https://dephell.org/">dephell</a>.</p>
<p>Install Poetry:</p>
<div><pre><code data-lang="sh">curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
</code></pre></div><p>Open a new login shell or source <code>~/.poetry/env</code> in your current shell:</p>
<p>Initialize your Python project:</p>
<div><pre><code data-lang="sh">poetry init --no-interaction
</code></pre></div><p>This command will create a <code>pyproject.toml</code> file, the new Python package
configuration file specified in <a href="https://www.python.org/dev/peps/pep-0517/">PEP
517</a> and
<a href="https://www.python.org/dev/peps/pep-0518/">518</a>.</p>
<div><pre><code data-lang="toml"><span># pyproject.toml</span>
[<span>tool</span>.<span>poetry</span>]
<span>name</span> = <span>"hypermodern-python"</span>
<span>version</span> = <span>"0.1.0"</span>
<span>description</span> = <span>""</span>
<span>authors</span> = [<span>"Your Name &lt;you@example.com&gt;"</span>]

[<span>tool</span>.<span>poetry</span>.<span>dependencies</span>]
<span>python</span> = <span>"^3.8"</span>

[<span>tool</span>.<span>poetry</span>.<span>dev</span><span>-</span><span>dependencies</span>]

[<span>build</span><span>-</span><span>system</span>]
<span>requires</span> = [<span>"poetry&gt;=0.12"</span>]
<span>build</span><span>-</span><span>backend</span> = <span>"poetry.masonry.api"</span>
</code></pre></div><p>There you go: One declarative file in <a href="https://github.com/toml-lang/toml">TOML</a>
syntax, containing the entire package configuration. Let’s add some metadata to
the package:</p>
<div><pre><code data-lang="toml"><span># pyproject.toml</span>
[<span>tool</span>.<span>poetry</span>]
...
<span>description</span> = <span>"The hypermodern Python project"</span>
<span>license</span> = <span>"MIT"</span>
<span>readme</span> = <span>"README.md"</span>
<span>homepage</span> = <span>"https://github.com/&lt;your-username&gt;/hypermodern-python"</span>
<span>repository</span> = <span>"https://github.com/&lt;your-username&gt;/hypermodern-python"</span>
<span>keywords</span> = [<span>"hypermodern"</span>]
</code></pre></div><p>Poetry added a dependency on Python 3.8, because this is the Python version you
ran it in. Support the previous release as well by changing this to Python 3.7:</p>
<div><pre><code data-lang="toml">[<span>tool</span>.<span>poetry</span>.<span>dependencies</span>]
<span>python</span> = <span>"^3.7"</span>
</code></pre></div><p>The caret (<code>^</code>) in front of the version number means “up to the next major
release”. In other words, you are promising that your package won’t break when
users upgrade to Python 3.8 or 3.9, but you’re giving no guarantees for its use
with a future Python 4.0.</p>
<h2 id="creating-a-package-in-src-layout">Creating a package in src layout</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop06.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop06.jpg"> </a>
</figure>

<p>Let’s create an initial skeleton package. Organize your package in <a href="https://hynek.me/articles/testing-packaging/">src
layout</a>, like this:</p>
<div><pre><code data-lang="sh">.
├── pyproject.toml
└── src
    └── hypermodern_python
        └── __init__.py

<span>2</span> directories, <span>2</span> files
</code></pre></div><p>The source file contains only a version declaration:</p>
<div><pre><code data-lang="python"><span># src/hypermodern_python/__init__.py</span>
__version__ <span>=</span> <span></span><span>"</span><span>0.1.0</span><span>"</span>
</code></pre></div><p>Use <a href="https://en.wikipedia.org/wiki/Snake_case">snake case</a> for the package name
<code>hypermodern_python</code>, as opposed to the <a href="https://en.wiktionary.org/wiki/kebab_case">kebab
case</a> used for the repository name
<code>hypermodern-python</code>. In other words, name the package after your repository,
replacing hyphens by underscores.</p>
<blockquote>
<p>Replace <code>hypermodern-python</code> with the name of your own repository, to avoid a
name collision on PyPI.</p>
</blockquote>
<h2 id="managing-virtual-environments-with-poetry">Managing virtual environments with Poetry</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop07.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop07.jpg"> </a>
</figure>

<p>A <a href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a> gives your
project an isolated runtime environment, consisting of a specific Python version
and an independent set of installed Python packages. This way, the dependencies
of your current project do not interfere with the system-wide Python
installation, or other projects you’re working on.</p>
<p>Poetry manages virtual environments for your projects. To see it in action,
install the skeleton package using <a href="https://python-poetry.org/docs/cli/#install">poetry
install</a>:</p>
<div><pre><code data-lang="sh">$ poetry install

Creating virtualenv hypermodern-python-rLESuZJY-py3.8 in …/pypoetry/virtualenvs
Updating dependencies
Resolving dependencies... <span>(</span>0.1s<span>)</span>

Writing lock file

Nothing to install or update

  - Installing hypermodern-python <span>(</span>0.1.0<span>)</span>
</code></pre></div><p>Poetry has now created a virtual environment dedicated to your project, and
installed your initial package into it. It has also created a so-called <em>lock
file</em>, named <code>poetry.lock</code>. You will learn more about this file in the next
section.</p>
<p>Let’s run a Python session inside the new virtual environment, using <a href="https://python-poetry.org/docs/cli/#run">poetry
run</a>:</p>
<div><pre><code data-lang="python"><span>$</span> poetry run python

Python <span>3.8</span><span>.</span><span>2</span> (default, Feb <span>26</span> <span>2020</span>, <span>07</span>:<span>03</span>:<span>58</span>)
[GCC <span>8.3</span><span>.</span><span>0</span>] on linux
Type <span></span><span>"</span><span>help</span><span>"</span>, <span></span><span>"</span><span>copyright</span><span>"</span>, <span></span><span>"</span><span>credits</span><span>"</span> <span>or</span> <span></span><span>"</span><span>license</span><span>"</span> <span>for</span> more information<span>.</span>
<span>&gt;&gt;</span><span>&gt;</span> <span>import</span> hypermodern_python
<span>&gt;&gt;</span><span>&gt;</span> hypermodern_python<span>.</span>__version__
<span></span><span>'</span><span>0.1.0</span><span>'</span>
<span>&gt;&gt;</span><span>&gt;</span>
</code></pre></div><h2 id="managing-dependencies-with-poetry">Managing dependencies with Poetry</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop08.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop08.jpg"> </a>
</figure>

<p>Let’s install the first dependency, the
<a href="https://click.palletsprojects.com/">click</a> package. This Python package allows
you to create beautiful command-line interfaces in a composable way with as
little code as necessary. You can install dependencies using <a href="https://python-poetry.org/docs/cli/#add">poetry
add</a>:</p>
<div><pre><code data-lang="sh">$ poetry add click

Using version ^7.0 <span>for</span> click

Updating dependencies
Resolving dependencies... <span>(</span>0.1s<span>)</span>

Writing lock file


Package operations: <span>1</span> install, <span>0</span> updates, <span>0</span> removals

  - Installing click <span>(</span>7.0<span>)</span>
</code></pre></div><p>Several things are happening here:</p>
<ul>
<li>The package is downloaded and installed into the virtual environment.</li>
<li>The installed version is registered in the lock file <code>poetry.lock</code>.</li>
<li>A more general version constraint is added to <code>pyproject.toml</code>.</li>
</ul>
<p>The dependency entry in <code>pyproject.toml</code> contains a <a href="https://python-poetry.org/docs/versions/">version
constraint</a> for the installed package:
<code>^7.0</code>. This means that users of the package need to have at least the current
release, <code>7.0</code>. The constraint also allows newer releases of the package, as
long as the version number does not indicate breaking changes. (After 1.0.0,
<a href="https://semver.org/">Semantic Versioning</a> limits breaking changes to major
releases.)</p>
<p>By contrast, <code>poetry.lock</code> contains the exact version of <code>click</code> installed into
the virtual environment. Place this file under source control. It allows
everybody in your team to work with the same environment. It also helps you
<a href="https://12factor.net/dev-prod-parity">keep production and development environments as similar as
possible</a>.</p>
<p>Upgrading the dependency to a new minor or patch release is now as easy as
invoking <a href="https://python-poetry.org/docs/cli/#update">poetry update</a> with the
package name:</p>
<p>To upgrade to a new major release, you need to update the version constraint
explicitly. Coming from the previous major release of <code>click</code>, you could use the
following command to upgrade to <code>7.0</code>:</p>
<h2 id="command-line-interfaces-with-click">Command-line interfaces with click</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop09.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop09.jpg"> </a>
</figure>

<p>Time to add some actual code to the package. As you may have guessed, we’re
going to create a console application using <code>click</code>:</p>
<div><pre><code data-lang="python"><span># src/hypermodern_python/console.py</span>
<span>import</span> click

<span>from</span> . <span>import</span> __version__


<span>@click.command</span>()
<span>@click.version_option</span>(version<span>=</span>__version__)
<span>def</span> <span>main</span>():
    <span></span><span>"""</span><span>The hypermodern Python project.</span><span>"""</span>
    click<span>.</span>echo(<span></span><span>"</span><span>Hello, world!</span><span>"</span>)
</code></pre></div><p>The <code>console</code> module defines a minimal command-line application, supporting
<code>--help</code> and <code>--version</code> options.</p>
<p>Register the script in <code>pyproject.toml</code>:</p>
<div><pre><code data-lang="toml">[<span>tool</span>.<span>poetry</span>.<span>scripts</span>]
<span>hypermodern</span><span>-</span><span>python</span> = <span>"hypermodern_python.console:main"</span>
</code></pre></div><p>Finally, install the package into the virtual environment:</p>
<p>You can now run the script like this:</p>
<div><pre><code data-lang="sh">$ poetry run hypermodern-python

Hello, world!
</code></pre></div><p>You can also pass options to your script:</p>
<div><pre><code data-lang="sh">$ poetry run hypermodern-python --help

Usage: hypermodern-python <span>[</span>OPTIONS<span>]</span>

  The hypermodern Python project.

Options:
  --version  Show the version and exit.
  --help     Show this message and exit.
</code></pre></div><h2 id="example-consuming-a-rest-api-with-requests">Example: Consuming a REST API with requests</h2>
<figure><a href="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop10.jpg">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/opera_crop10.jpg"> </a>
</figure>

<p>Let’s build an example application which prints random facts to the console. The
data is retrieved from the <a href="https://www.mediawiki.org/wiki/REST_API">Wikipedia
API</a>.</p>
<p>Install the <a href="https://requests.readthedocs.io/">requests</a> package, the <em>de facto</em>
standard for making HTTP requests in Python:</p>
<p>Next, replace the file <code>src/hypermodern-python/console.py</code> with the source code
shown below.</p>
<div><pre><code data-lang="python"><span># src/hypermodern_python/console.py</span>
<span>import</span> textwrap

<span>import</span> click
<span>import</span> requests

<span>from</span> . <span>import</span> __version__


API_URL <span>=</span> <span></span><span>"</span><span>https://en.wikipedia.org/api/rest_v1/page/random/summary</span><span>"</span>


<span>@click.command</span>()
<span>@click.version_option</span>(version<span>=</span>__version__)
<span>def</span> <span>main</span>():
    <span></span><span>"""</span><span>The hypermodern Python project.</span><span>"""</span>
    <span>with</span> requests<span>.</span>get(API_URL) <span>as</span> response:
        response<span>.</span>raise_for_status()
        data <span>=</span> response<span>.</span>json()

    title <span>=</span> data[<span></span><span>"</span><span>title</span><span>"</span>]
    extract <span>=</span> data[<span></span><span>"</span><span>extract</span><span>"</span>]

    click<span>.</span>secho(title, fg<span>=</span><span></span><span>"</span><span>green</span><span>"</span>)
    click<span>.</span>echo(textwrap<span>.</span>fill(extract))
</code></pre></div><p>Let’s have a look at the imports at the top of the module first.</p>
<div><pre><code data-lang="python"><span>import</span> textwrap

<span>import</span> click
<span>import</span> requests

<span>from</span> . <span>import</span> __version__
</code></pre></div><p>The <a href="https://docs.python.org/3/library/textwrap.html">textwrap</a> module from the
standard library allows you to wrap lines when printing text to the console. We
also import the newly installed <code>requests</code> package. Blank lines serve to group
imports as recommended in <a href="https://www.python.org/dev/peps/pep-0008/#imports">PEP
8</a> (standard library–third
party packages–local imports).</p>
<div><pre><code data-lang="python">API_URL <span>=</span> <span></span><span>"</span><span>https://en.wikipedia.org/api/rest_v1/page/random/summary</span><span>"</span>
</code></pre></div><p>The <code>API_URL</code> constant points to the <a href="https://restfulapi.net/">REST API</a> of the
English Wikipedia, or more specifically, its <code>/page/random/summary</code> endpoint,
which returns the summary of a random Wikipedia article.</p>
<div><pre><code data-lang="python"><span>with</span> requests<span>.</span>get(API_URL) <span>as</span> response:
    response<span>.</span>raise_for_status()
    data <span>=</span> response<span>.</span>json()
</code></pre></div><p>In the body of the <code>main</code> function, the <code>requests.get</code> invocation sends an <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods">HTTP
GET</a> request to the
Wikipedia API. The <code>with</code> statement ensures that the HTTP connection is closed
at the end of the block. Before looking at the response body, we check the HTTP
status code and raise an exception if it signals an error. The response body
contains the resource data in <a href="https://www.json.org/">JSON</a> format, which can be
accessed using the <code>response.json()</code> method.</p>
<div><pre><code data-lang="python">title <span>=</span> data[<span></span><span>"</span><span>title</span><span>"</span>]
extract <span>=</span> data[<span></span><span>"</span><span>extract</span><span>"</span>]
</code></pre></div><p>We are only interested in the <code>title</code> and <code>extract</code> attributes, containing the
title of the Wikipedia page and a short plain text extract, respectively.</p>
<div><pre><code data-lang="python">click<span>.</span>secho(title, fg<span>=</span><span></span><span>"</span><span>green</span><span>"</span>)
click<span>.</span>echo(textwrap<span>.</span>fill(extract))
</code></pre></div><p>Finally, we print the title and extract to the console, using the <code>click.echo</code>
and <code>click.secho</code> functions. The latter function allows you to specify the
foreground color using the <code>fg</code> keyword attribute. The <code>textwrap.fill</code> function
wraps the text in <code>extract</code> so that every line is at most 70 characters long.</p>
<p>Let’s try it out!</p>
<div><pre><code data-lang="sh">$ poetry run hypermodern-python

Jägersbleeker Teich
The Jägersbleeker Teich in the Harz Mountains of central Germany is a
storage pond near the town of Clausthal-Zellerfeld in the county of
Goslar in Lower Saxony. It is one of the Upper Harz Ponds that were
created <span>for</span> the mining industry.
</code></pre></div><p>Feel free to play around with this a little. Here are some things you might want
to try:</p>
<ul>
<li>Display a friendly error message when the API is not reachable.</li>
<li>Add an option to select the Wikipedia edition for another language.</li>
<li>If you feel adventurous: auto-detect the user’s preferred language edition,
using <a href="https://docs.python.org/3.8/library/locale.html">locale</a>.</li>
</ul>
<h2 id="thanks-for-reading">Thanks for reading!</h2>
<p>The next chapter is about adding unit tests to your project.</p>
<figure><a href="https://cjolowicz.github.io/posts/hypermodern-python-02-testing">
    <img src="https://cjolowicz.github.io/images/hypermodern-python-01/train.png"> </a>
</figure>

<p><span><a href="https://cjolowicz.github.io/posts/hypermodern-python-02-testing">Continue to the next chapter</a></span></p>
<section role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>The title of this guide is inspired by the book <em>Die hypermoderne
Schachpartie</em> (The hypermodern chess game), written by <a href="https://en.wikipedia.org/wiki/Savielly_Tartakower">Savielly
Tartakower</a> in 1924. It
surveys the revolution that had taken place in chess theory in the decade
after the First World War. The images in this chapter are details from the
hand-colored print <em>Le Sortie de l’opéra en l’an 2000</em> (Leaving the opera in
the year 2000) by Albert Robida, ca 1902 (source: <a href="http://www.loc.gov/pictures/item/2007676247/">Library of
Congress</a>). <a href="#fnref:1" role="doc-backlink">↩︎</a></p>
</li>
</ol>
</section>

      </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>