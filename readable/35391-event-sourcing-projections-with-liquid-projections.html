<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Event Sourcing: Projections with Liquid Projections -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Event Sourcing: Projections with Liquid Projections</h1>
    <div class="entry-content"> <div class="wp-block-image">
<figure class="alignright"><img src="https://codeopinion.com/wp-content/uploads/2019/09/liquidprojections-300x269.png" alt="Liquid Projections" class="wp-image-6553" srcset="https://codeopinion.com/wp-content/uploads/2019/09/liquidprojections-300x269.png 300w, https://codeopinion.com/wp-content/uploads/2019/09/liquidprojections-768x689.png 768w, https://codeopinion.com/wp-content/uploads/2019/09/liquidprojections.png 815w" sizes="(max-width: 300px) 100vw, 300px"></figure>
</div> <p>Projections are an important yet pretty simple concept when working with event-centric or event sourcing systems. The concept is to build a state from a stream of events. In my previous post, Event Sourcing with <a href="https://codeopinion.com/event-sourcing-with-sql-stream-store/">SQL Stream Store</a>, I made a pretty basic projection to keep the current account balance. In this post, I&#x2019;ll use Liquid Projections to accomplish the same task.</p> <p>I recommend checking out my post on <a href="https://codeopinion.com/event-sourcing-with-sql-stream-store/">SQL Stream Store</a> as I&#x2019;m using the same example/demo application in this post.</p> <h2>Liquid Projections</h2> <p>Liquid Projection is a library for building projections. The concept and API are pretty simple, and I&#x2019;ll cover the basics in this post.</p> <p>First I&#x2019;ll update my Demo Application to use the Liquid Projections <a href="https://www.nuget.org/packages/liquidprojections">NuGet package.</a></p> <figure class="wp-block-embed"> </figure> <h2>Event Map</h2> <p>The first building block is creating an event map. The idea is to map an event to an action that we want to be invoked when the event occurs. We can use the <strong>EventMapBuild&lt;TContext&gt;</strong> to create all of our event mappings. The <strong>TContext</strong> can be anything but I&#x2019;ll be using it to mutate the state that represents the current balance.</p> <p>As a refresher from my previous post, here is the <strong>Balance</strong></p> <figure class="wp-block-embed"> </figure> <p>Now using the <strong>EventMapBuilder&lt;Balance&gt;</strong> to handle the <strong>Deposited </strong>and <strong>Withdrawn </strong>events.</p> <figure class="wp-block-embed"> </figure> <p>You&#x2019;ll notice call <strong>Build()</strong> on the <strong>EventMapBuilder&lt;Balance&gt;</strong> which will return us the <strong>EventMap&lt;Balance&gt;</strong>. At this point, you can call Handle() to pass in the events incoming from our subscription with our current Balance.</p> <h2>Conditions</h2> <p>There are also some nice additions such as providing conditions for when to execute a map. For example, if you wanted to handle only deposited events where the amount was greater than 100.</p> <figure class="wp-block-embed"> </figure> <h2>Inheritance</h2> <p>There is also support for inheritance, which means since my Deposited and Withdrawn events inherit from the AccountEvent base class, I could also have done</p> <figure class="wp-block-embed"> </figure> <h2>Event Store Integration</h2> <p>The next on my list is write this up directly with to something like Event Store or SQL Stream Store. Stay tuned.</p> <p>Check out Liquid Projections on <a href="https://github.com/liquidprojections/LiquidProjections">GitHub </a>for more.</p> <p>All the&#xA0;<a href="https://github.com/dcomartin/SqlStreamStore.Demo">source code</a>&#xA0;shown in this post is available on GitHub.</p> <p>If you&#x2019;d like a more detailed contented related to various aspects of event sourcing, let me know in the comments or on twitter.</p> <p>Related Links:</p> <a href="https://twitter.com/codeopinion?ref_src=twsrc%5Etfw" class="twitter-follow-button">Follow @codeopinion</a> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>