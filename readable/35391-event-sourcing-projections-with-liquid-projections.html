<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Event Sourcing: Projections with Liquid Projections -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Event Sourcing: Projections with Liquid Projections</h1><div><div class="entry-content"><p>Projections are an important yet pretty simple concept when working with event-centric or event sourcing systems.  The concept is to build a state from a stream of events.  In my previous post, Event Sourcing with <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://codeopinion.com/event-sourcing-with-sql-stream-store/" target="_blank">SQL Stream Store</a>, I made a pretty basic projection to keep the current account balance.  In this post, I’ll use Liquid Projections to accomplish the same task.</p><p>I recommend checking out my post on <a href="https://codeopinion.com/event-sourcing-with-sql-stream-store/" target="_blank" rel="noreferrer noopener" aria-label="SQL Stream Store (opens in a new tab)">SQL Stream Store</a> as I’m using the same example/demo application in this post.</p><h2>Liquid Projections</h2><p>Liquid Projection is a library for building projections.  The concept and API are pretty simple, and I’ll cover the basics in this post.</p><p>First I’ll update my Demo Application to use the Liquid Projections <a href="https://www.nuget.org/packages/liquidprojections" target="_blank" rel="noreferrer noopener" aria-label="NuGet package. (opens in a new tab)">NuGet package.</a></p><figure class="wp-block-embed"><h2>Event Map</h2><p>The first building block is creating an event map.  The idea is to map an event to an action that we want to be invoked when the event occurs.    We can use the <strong>EventMapBuild&lt;TContext&gt;</strong> to create all of our event mappings.  The <strong>TContext</strong> can be anything but I’ll be using it to mutate the state that represents the current balance.</p><p>As a refresher from my previous post, here is the <strong>Balance</strong></p><figure class="wp-block-embed"><p>Now using the <strong>EventMapBuilder&lt;Balance&gt;</strong> to handle the <strong>Deposited </strong>and <strong>Withdrawn </strong>events.</p><figure class="wp-block-embed"><p>You’ll notice call <strong>Build()</strong> on the <strong>EventMapBuilder&lt;Balance&gt;</strong> which will return us the <strong>EventMap&lt;Balance&gt;</strong>. At this point, you can call Handle() to pass in the events incoming from our subscription with our current Balance.</p><h2>Conditions</h2><p>There are also some nice additions such as providing conditions for when to execute a map.  For example, if you wanted to handle only deposited events where the amount was greater than 100.</p><figure class="wp-block-embed"><h2>Inheritance</h2><p>There is also support for inheritance, which means since my Deposited and Withdrawn events inherit from the AccountEvent base class, I could also have done</p><figure class="wp-block-embed"><h2>Event Store Integration</h2><p>The next on my list is write this up directly with to something like Event Store or SQL Stream Store.   Stay tuned.</p><p>Check out Liquid Projections on <a href="https://github.com/liquidprojections/LiquidProjections">GitHub </a>for more.</p><p>All the&nbsp;<a rel="noreferrer noopener" href="https://github.com/dcomartin/SqlStreamStore.Demo" target="_blank">source code</a>&nbsp;shown in this post is available on GitHub.</p><p>If you’d like a more detailed contented related to various aspects of event sourcing, let me know in the comments or on twitter.</p><p>Related Links:</p><a href="https://twitter.com/codeopinion?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false">Follow @codeopinion</a></figure></figure></figure></figure></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>