<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Version mismatches in 2.1 and 2.2 patch updates (often causes FileLoadException) &#xB7; Issue #3503 &#xB7; dotnet/aspnetcore &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Version mismatches in 2.1 and 2.2 patch updates (often causes FileLoadException) · Issue #3503 · dotnet/aspnetcore · GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><p>Some ASP.NET Core 2.1 users have been affected by a bug in the .NET Core host (see <a href="https://github.com/dotnet/core-setup/issues/4512">https://github.com/dotnet/core-setup/issues/4512</a>) which can cause apps to fail with System.IO.FileLoadException. The issue may also be present in your app, even if the app does not fail with System.IO.FileLoadException.</p><h3>Affected versions</h3><p>.NET Core, 2.1.1 through 2.1.4 (all OSes), 2.1.7 (Windows only), 2.2.1  (Windows only)</p><h3>Symptom 1</h3><p>ASP.NET Core apps running on the Microsoft.AspNetCore.App shared framework may fail to run after the machine-wide version of .NET Core is updated. Apps fail with an error such as:</p><blockquote><p>Unhandled Exception: System.IO.FileLoadException: Could not load file or assembly 'Microsoft.Extensions.Identity.Core, Version=2.1.3.0, Culture=neutral, PublicKeyToken=adb9793829ddae60'. <strong>The located assembly's manifest definition does not match the assembly reference.</strong> (Exception from HRESULT: 0x80131040)<br>at Diary.Api.Startup.ConfigureServices(IServiceCollection services)</p></blockquote><h3>Symptom 2</h3><p>When publishing an ASP.NET Core application which references Microsoft.AspNetCore.App, additional Microsoft assemblies are in the publish output.</p><p>For example, if you run <code>dotnet publish --output PublishDir/ </code> and you see <code>Microsoft.Extensions.*.dll</code> or <code>Microsoft.AspNetCore.*.dll</code> files in <code>PublishDir/</code>, you may be running into this issue.</p><h3>Cause</h3><p>This issue is typically caused by .csproj files which have a PackageReference to a package which is already part of Microsoft.AspNetCore.App.</p><p>For example,</p><div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">ItemGroup</span>&gt;
  &lt;<span class="pl-ent">PackageReference</span><span class="pl-e">Include</span>=<span class="pl-s"><span class="pl-pds">"</span>Microsoft.AspNetCore.App<span class="pl-pds">"</span></span> /&gt;
  &lt;<span class="pl-ent">PackageReference</span><span class="pl-e">Include</span>=<span class="pl-s"><span class="pl-pds">"</span>Microsoft.AspNetCore.SignalR<span class="pl-pds">"</span></span><span class="pl-e">Version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0.3<span class="pl-pds">"</span></span> /&gt;
&lt;/<span class="pl-ent">ItemGroup</span>&gt;</pre></div><p>The Microsoft.AspNetCore.SignalR package is already pulled in as a part of Microsoft.AspNetCore.App, so does not normally need to be referenced. The presence of this reference causes a mismatch of versions, which in turn causes a problem with the .NET Core host, as described in <a href="https://github.com/dotnet/core-setup/issues/4376">https://github.com/dotnet/core-setup/issues/4376</a>.</p><p>More technical details here: <a class="issue-link js-issue-link" data-error-text="Failed to load issue title" data-id="353886676" data-permission-text="Issue title is private" data-url="https://github.com/Azure/app-service-announcements-discussions/issues/65" data-hovercard-type="issue" data-hovercard-url="/Azure/app-service-announcements-discussions/issues/65/hovercard?comment_id=417379227&amp;comment_type=issue_comment" href="https://github.com/Azure/app-service-announcements-discussions/issues/65#issuecomment-417379227">Azure/app-service-announcements-discussions#65 (comment)</a></p><h3>Workaround 1</h3><p>Remove PackageReference's which are already part of Microsoft.AspNetCore.App. You can find a list of what this package pulls in by looking at <a rel="nofollow" href="https://www.nuget.org/packages/microsoft.aspnetcore.app#show-dependency-groups">https://www.nuget.org/packages/microsoft.aspnetcore.app#show-dependency-groups</a>. This will avoid the version mismatch.</p><h3>Workaround 2</h3><p>Upgrade the Microsoft.AspNetCore.App PackageReference to the latest 2.1.x version by adding the <code>Version</code> attribute.</p><div class="highlight highlight-text-xml"><pre>  &lt;<span class="pl-ent">PackageReference</span><span class="pl-e">Include</span>=<span class="pl-s"><span class="pl-pds">"</span>Microsoft.AspNetCore.App<span class="pl-pds">"</span></span><span class="pl-e">Version</span>=<span class="pl-s"><span class="pl-pds">"</span>2.1.3<span class="pl-pds">"</span></span> /&gt;</pre></div><p><g-emoji class="g-emoji" alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji> This may have unintended consequences on your deployment environment. If the deployment environment does not have the the 2.1.3 runtime, apps will fail to start with an error. In Azure or apps hosted behind IIS, this may appear as HTTP 502.5 error.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>