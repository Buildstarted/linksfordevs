<!DOCTYPE html>
<html lang="en">
<head>
    <title>
How to make your game run at 60fps - Tyler Glaiel -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>How to make your game run at 60fps - Tyler Glaiel</h1><div><div class="ac ae af ag ah do aj ak"><p id="9b2e" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">I’m thrilled at the reception this blog post originally received, and I want to make sure this is the most up to date and thorough resource for this common gamedev problem out there. So I will update this article as new information is brought to my attention, and I’m also adding a few more pieces of information here that I couldn’t find the place for in the original article.</p><h2 id="c28c" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Hybrid Approaches</h2><p id="dbe4" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">Unity (and other big engines) use a hybrid approach. Unity provides Update() and FixedUpdate() callbacks separately. Update uses variable time steps and FixedUpdate uses fixed time steps, plus it automatically interpolates stuff like physics states and animation states. If you mix and match both of those update callbacks without knowing how they work under the hood, you end up getting weird stuttering inconsistencies in your unity project. It’s a common problem I’ve seen in unity games, so even if you are using an engine, you still should understand how this all works.</p><h2 id="3d98" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">1000hz Fixed Update</h2><p id="f056" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">I’ve seen a few people mention to me their solution to this is to just update at a fixed rate of 1000 times per second. Because the difference between doing 1 and 2 updates per frame is a lot more noticeable than the difference between 16 and 17 updates a frame. You can do this if your game is pretty simple, but it does not scale well to more complicated projects.</p><h2 id="bb24" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Timing Anomalies</h2><p id="f10d" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">You do need to account for various timing anomalies when measuring frame code. If delta time is less than 0, that means that the system timer wrapped around. If it’s really high, you probably don’t want to fast forward your game a ton in one step, so you probably should cap it. If you just clamp deltaTime to between 0 and &lt;maximum delta time&gt; (this is 8/60 (7.5fps) for me), that should account for most anomalies.</p><h2 id="d23a" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Resyncing</h2><p id="1fad" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">In my engine I have a manual callback I can use to “resync” my timer code (set the accumulator to 0 and delta time to 1/60 the next time through the loop), which I do after loading a level or swapping scenes. You need this because you typically don’t want the game to start each level by immediately trying to make up the time it spent loading.</p><h2 id="c72f" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Spiral of Doom</h2><p id="cb5c" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">If your game cannot *update* at 60hz, you end up in a spiral of doom where your game can never catch up to where it should be, and so it will do more and more updates every time until it eventually just freezes. Cap your accumulator to a maximum (I use 8/60 (7.5fps) as the max) and it should prevent that issue. This will not be a fun experience for whoever is trying to play the game, but at least it won’t freeze.</p><h2 id="70fa" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Floating Point Inaccuracies</h2><p id="2f76" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">In this article and my monitor simulator code, I was using doubles for clarity. Using doubles or floats introduces floating point error, like adding 1.0/60.0 60 times in a row will not actually end up being exactly 1. In my engine I actually use 64 bit integers for my timer code instead to sidestep this. <a href="https://wiki.libsdl.org/SDL_GetPerformanceCounter" class="bi cv gy gz ha hb" target="_blank" rel="noopener nofollow">SDL reports the system timer as a 64 bit int</a>, so I just keep it in this format to avoid the loss you get from converting it to a double. In the game itself, this gets converted to double, but the timer code keeps it as an int.</p><h2 id="7ae1" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Situations where interpolation is not an option</h2><p id="47d9" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">Interpolation is the industry standard method of doing this, because it’s a good robust solution that works great in the majority of use cases. But this has resulted in a few people acting as if there is no reason to even consider lockstep, and existing resources about this basically never even discuss it. Ignoring the extra difficulty involved in getting interpolation working, there are a few situations where interpolation just inherently isn’t an option, like emulators. It’s up to you to determine what your needs and options are here for your specific use case.</p><h2 id="bacc" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Averaging Delta Time</h2><p id="9e5c" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">Some games and engines average together the previous few time deltas to smooth out any single frame spikes. For example, instead of a single slow frame resulting in 4 updates on the next frame, it would do 2 updates for the next 3 frames instead. You do this averaging when you compute delta time, before adding to the accumulator.</p><h2 id="5e41" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Update Multiplicity</h2><p id="7cca" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj">An uneven framerate is worse than a slow framerate. For this reason I have a setting in my engine called “update multiplicity” that basically just makes the game always do a multiple of N updates at a time.</p><pre class="gk gl gm gn go gp gq gr"><span id="bc91" class="gs gt ar bz gu b eu gv gw r gx">while(accumulator &gt;= (1.0 / 60.0) * update_multiplicity){<br>for(int i = 0; i&lt;update_multiplicity; i++){<br>simulate_update();<br>accumulator -= 1.0 / 60.0;<br>}<br>}</span></pre><p id="11f7" class="fw fx ar bz fy b fz ga gb gc gd ge gf gg gh gi gj dj">Setting update multiplicity to 2 basically says “Act as if this game is running at 30fps even if it isn’t”. For people with low powered machines this is preferable to alternating between 30 and 60 rapidly. There’s probably some way to detect uneven framerates and just fall back to this, but I just have it as a manual setting for now.</p><h2 id="524a" class="gs gt ar bz by ih jd je jf jg jh ji jj jk jl jm jn">Sample Code</h2><p id="e212" class="fw fx ar bz fy b fz ir gb is gd it gf iu gh iv gj dj"><a href="https://github.com/TylerGlaiel/FrameTimingControl" class="bi cv gy gz ha hb" target="_blank" rel="noopener nofollow">This is production code from my engine that I have commented</a>. It uses many of the techniques and tricks I’ve illustrated in this post. You probably can’t just plug and play this into your engine, but I’ve decided to put this up for reference because sometimes you just wanna see what everything looks like together.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>