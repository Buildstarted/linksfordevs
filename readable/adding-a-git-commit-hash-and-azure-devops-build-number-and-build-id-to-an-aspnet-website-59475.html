<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Adding a git commit hash and Azure DevOps Build Number and Build ID to an ASP.NET website - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Adding a git commit hash and Azure DevOps Build Number and Build ID to an ASP.NET website - linksfor.dev(s)"/>
    <meta property="article:author" content="Scott Hanselman"/>
    <meta property="og:description" content="A few months back I moved my CI/CD (Continuous Integration/Continuous Development) to Azure DevOps for free. You get ..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.hanselman.com/blog/AddingAGitCommitHashAndAzureDevOpsBuildNumberAndBuildIDToAnASPNETWebsite.aspx"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Adding a git commit hash and Azure DevOps Build Number and Build ID to an ASP.NET website</title>
<div class="readable">
        <h1>Adding a git commit hash and Azure DevOps Build Number and Build ID to an ASP.NET website</h1>
            <div>by Scott Hanselman</div>
            <div>Reading time: 10-13 minutes</div>
        <div>Posted here: 10 Mar 2020</div>
        <p><a href="https://www.hanselman.com/blog/AddingAGitCommitHashAndAzureDevOpsBuildNumberAndBuildIDToAnASPNETWebsite.aspx">https://www.hanselman.com/blog/AddingAGitCommitHashAndAzureDevOpsBuildNumberAndBuildIDToAnASPNETWebsite.aspx</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section>
	<section>
          
		<p><img title="image" alt="image" src="https://www.hanselman.com/blog/content/binary/Windows-Live-Writer/b3ea03d561cd_10358/image_4ad31585-2276-45c6-9355-9e0a0f7b81c9.png" width="350" height="200">A few months back I <a href="http://setting%20up%20azure%20devops%20ci/CD%20for%20a%20.NET%20Core%203.1%20Web%20App%20hosted%20in%20Azure%20App%20Service%20for%20Linux">moved my CI/CD (Continuous Integration/Continuous Development) to Azure DevOps</a> for free. You <a href="https://azure.microsoft.com/en-us/pricing/details/devops/azure-devops-services/?WT.mc_id=-blog-scottha">get 1800 build minutes a month FREE</a> and I'm not even close to using it with three occasionally-updated sites building on it. Earlier this week I wrote about <a href="https://www.hanselman.com/blog/MakingACleanerAndMoreIntentionalAzurepipelinesymlForAnASPNETCoreWebApp.aspx">making a cleaner and more intentional azure-pipelines.yml for an ASP.NET Core Web App</a></p> <p>I was working/pairing with Damian today because <strong>I wanted to get my git commit hashes and build ids embedded into the actual website so I could see exactly what commit is in production</strong>.  </p><p>That's live on <a href="http://hanselminutes.com/">hanselminutes.com</a> righ tnow and looks like this  </p><p><em>Â© Copyright 2020, </em><a href="https://www.hanselman.com/"><em>Scott Hanselman</em></a><em>. Design by </em><a href="http://www.8164.org/"><em>@jzy</em></a><em>, Powered by .NET Core 3.1.2 and deployed from commit </em><a href="https://github.com/shanselman/hanselminutes-core/commit/314a8a696c988166878c841eb888e71dc66b48de?WT.mc_id=-blog-scottha"><em>6b48de</em></a><em> via build </em><a href="https://dev.azure.com/hanselman/Hanselminutes%20Website/_build/results?buildId=179&amp;view=results&amp;WT.mc_id=-blog-scottha"><em>20200310.7</em></a>  </p><p>There's a few things here and it's all in my ASP.NET Web App's main layout page called _layout.cshtml. You can look all about <a href="https://dot.net/videos?WT.mc_id=-blog-scottha">ASP.NET Core 101</a>, .NET and C# over at <a href="https://dot.net/videos?WT.mc_id=-blog-scottha">https://dot.net/videos</a> if you'd like. They've lovely videos.</p><figure><img title="My website footer has git commits" alt="My website footer has git commits" src="https://www.hanselman.com/blog/content/binary/Windows-Live-Writer/b3ea03d561cd_10358/image_6785bcf2-3283-4f14-9e7b-80f169698c1b.png" width="999" height="61"></figure>  <p>So let's take this footer apart, shall we?</p><div><div id="highlighter_660822"><div><div><p><code>&lt;</code><code>div</code> <code>class</code><code>=</code><code>"copyright"</code><code>&gt;&amp;copy; Copyright @DateTime.Now.Year, </code></p><p><code>&nbsp;</code><code>&lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://www.hanselman.com"</code><code>&gt;Scott Hanselman&lt;/</code><code>a</code><code>&gt;. </code></p><p><code>&nbsp;</code><code>Design by &lt;</code><code>a</code> <code>href</code><code>=</code><code>"http://www.8164.org/"</code><code>&gt;@@jzy&lt;/</code><code>a</code><code>&gt;, </code></p><p><code>&nbsp;</code><code>Powered by @System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription</code></p><p><code>&nbsp;</code><code>and deployed from commit &lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://github.com/shanselman/hanselminutes-core/commit/@appInfo.GitHash"</code><code>&gt;@appInfo.ShortGitHash&lt;/</code><code>a</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>via build &lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://dev.azure.com/hanselman/Hanselminutes%20Website/_build/results?buildId=@appInfo.BuildId&amp;view=results"</code><code>&gt;@appInfo.BuildNumber&lt;/</code><code>a</code><code>&gt; </code></p><p><code>&lt;/</code><code>div</code><code>&gt;</code></p></div></div></div></div>
<p>First, the obvious floating copyright year. Then a few credits that are hard coded.</p>
<p>Next, a call to <code>@System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription</code> which gives me this string "<strong>.NET Core 3.1.2</strong>" Note that there was a time for a while where that Property was <a href="https://github.com/dotnet/runtime/issues/17722?WT.mc_id=-blog-scottha">somewhat goofy</a>, but <a href="https://github.com/dotnet/corefx/pull/35516?WT.mc_id=-blog-scottha">no longer</a>.</p>
<p>I have two kinds of things I want to store along with my build artifact and output. </p>
<ul>
<li>I want the the Git commit hash of the code that was deployed. 
<ul>
<li>Then I want to link it back to my source control. Note that my site is a private repo so you'll get a 404</li></ul>
</li><li>I want the Build Number and the Build ID 
<ul>
<li>This way I can link back to my Azure DevOps site</li></ul></li></ul>
<h3>Adding a Git Commit Hash to your .NET assembly</h3>
<p>There's lots of Assembly-level attributes you can add to your .NET assembly. One lovely one is AssemblyInformationalVersion and if you pass in SourceRevisionId on the dotnet build command line, it shows up in there automatically. Here's an example:</p><div><div id="highlighter_996564"><div><div><p><code>[assembly: AssemblyConfiguration(</code><code>"Release"</code><code>)]</code></p><p><code>[assembly: AssemblyFileVersion(</code><code>"1.0.0.0"</code><code>)]</code></p><p><code>[assembly: AssemblyInformationalVersion(</code><code>"1.0.0+d6b3d432970c9acbc21ecd22c9f5578892385305"</code><code>)]</code></p><p><code>[assembly: AssemblyProduct(</code><code>"hanselminutes.core"</code><code>)]</code></p><p><code>[assembly: AssemblyTitle(</code><code>"hanselminutes.core"</code><code>)]</code></p><p><code>[assembly: AssemblyVersion(</code><code>"1.0.0.0"</code><code>)]</code></p></div></div></div></div>
<p>From this command line:</p><pre>dotnet build --configuration Release /p:SourceRevisionId=d6b3d432970c9acbc21ecd22c9f5578892385305</pre>
<p>But where does that hash come from? Well, Azure Dev Ops includes it in an environment variable so you can make a YAML task like this:</p><pre>- task: DotNetCoreCLI@2<br>  displayName: 'dotnet build $(buildConfiguration)'<br>  inputs:<br>    command: 'build'<br>    arguments: '-r $(rid) --configuration $(buildConfiguration) /p:SourceRevisionId=$(Build.SourceVersion)'</pre>
<p>Sweet. That will put in VERSION+HASH, so we'll pull that out of a utility class Damian made like this (full class will be shown later)</p><div><div id="highlighter_464417"><div><div><p><code>public</code> <code>string</code> <code>GitHash</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>get</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_gitHash))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var version = </code><code>"1.0.0+LOCALBUILD"</code><code>; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var appAssembly = </code><code>typeof</code><code>(AppVersionInfo).Assembly;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var infoVerAttr = (AssemblyInformationalVersionAttribute)appAssembly</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.GetCustomAttributes(</code><code>typeof</code><code>(AssemblyInformationalVersionAttribute)).FirstOrDefault();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(infoVerAttr != </code><code>null</code> <code>&amp;&amp; infoVerAttr.InformationalVersion.Length &gt; 6)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>version = infoVerAttr.InformationalVersion;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_gitHash = version.Substring(version.IndexOf(</code><code>'+'</code><code>) + 1);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>_gitHash;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></div></div></div>
<p>Displaying it is then trivial given the helper class we'll see in a minute. Note that hardcoded paths for my private repo. No need to make things complex.</p><div><div id="highlighter_494089"><div><div><p><code>deployed from commit &lt;a href=</code><code>"https://github.com/shanselman/hanselminutes-core/commit/@appInfo.GitHash"</code><code>&gt;@appInfo.ShortGitHash&lt;/a&gt;</code></p></div></div></div></div>
<h3>Getting and Displaying Azure DevOps Build Number and Build ID</h3>
<p>This one is a little more complex. We could theoretically tunnel this info into an assembly as well but it's just as easy, if not easier to put it into a text file and make sure it's part of the ContentRootPath (meaning it's just in the root of the website's folder). </p>
<p><strong>To be clear, an option: </strong>There are ways to put this info in an Attribute but not without messing around with your csproj using some not-well-documented stuff. I like a clean csproj so I like this. Ideally there'd be another thing like SourceRevisionID to carry this metadata.</p>
<p>You'd need to do something like this, and then pull it out with reflection. Meh.</p><div><div id="highlighter_446639"><div><div><p><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>AssemblyAttribute</code> <code>Include</code><code>=</code><code>"System.Reflection.AssemblyMetadataAttribute"</code> <code>Condition</code><code>=</code><code>"$(BuildNumber) != ''"</code> <code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>_Parameter1</code><code>&gt;BuildNumber&lt;/</code><code>_Parameter1</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>_Parameter2</code><code>&gt;$(BuildNumber)&lt;/</code><code>_Parameter2</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>AssemblyAttribute</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>AssemblyAttribute</code> <code>Include</code><code>=</code><code>"System.Reflection.AssemblyMetadataAttribute"</code> <code>Condition</code><code>=</code><code>"$(BuildId) != ''"</code> <code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>_Parameter1</code><code>&gt;BuildId&lt;/</code><code>_Parameter1</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>_Parameter2</code><code>&gt;$(BuildId)&lt;/</code><code>_Parameter2</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>AssemblyAttribute</code><code>&gt;</code></p><p><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p></div></div></div></div>
<p>Those $(BuildNumber) and $(BuildId) dealies are build variables. Again, this csproj messing around is not for me.</p>
<p>Instead, a simple text file, coming along for the ride.</p><pre>- script: 'echo -e "$(Build.BuildNumber)
$(Build.BuildId)" &gt; .buildinfo.json'<br>  displayName: "Emit build number"<br>  workingDirectory: '$(Build.SourcesDirectory)/hanselminutes.core'<br>  failOnStderr: true</pre>
<p>I'm cheating a little as I gave it the .json extension, only because JSON files are copying and brought along as "Content." If it didn't have an extension I would need to copy it manually, again, with my csproj:</p><div><div id="highlighter_719657"><div><div><p><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>Content</code> <code>Include</code><code>=</code><code>".buildinfo"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>CopyToOutputDirectory</code><code>&gt;Always&lt;/</code><code>CopyToOutputDirectory</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>Content</code><code>&gt;</code></p><p><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p></div></div></div></div>
<p>So, to be clear, two build variables inside a little text file. Then make a little helper class from Damian. Again, that file is in ContentRootPath and was zipped up and deployed with our web app.</p><div><div id="highlighter_60921"><div><div><p><code>public</code> <code>class</code> <code>AppVersionInfo</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>static</code> <code>readonly</code> <code>string</code> <code>_buildFileName = </code><code>".buildinfo.json"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>string</code> <code>_buildFilePath;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>string</code> <code>_buildNumber;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>string</code> <code>_buildId;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>string</code> <code>_gitHash;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>string</code> <code>_gitShortHash;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>AppVersionInfo(IHostEnvironment hostEnvironment)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_buildFilePath = Path.Combine(hostEnvironment.ContentRootPath, _buildFileName);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>BuildNumber</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>get</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_buildNumber))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(File.Exists(_buildFilePath))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var fileContents = File.ReadLines(_buildFilePath).ToList();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(fileContents.Count &gt; 0)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_buildNumber = fileContents[0];</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(fileContents.Count &gt; 1)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_buildId = fileContents[1];</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_buildNumber))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_buildNumber = DateTime.UtcNow.ToString(</code><code>"yyyyMMdd"</code><code>) + </code><code>".0"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_buildId))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_buildId = </code><code>"123456"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>_buildNumber;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>BuildId</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>get</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_buildId))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var _ = BuildNumber;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>_buildId;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>GitHash</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>get</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_gitHash))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var version = </code><code>"1.0.0+LOCALBUILD"</code><code>; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var appAssembly = </code><code>typeof</code><code>(AppVersionInfo).Assembly;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var infoVerAttr = (AssemblyInformationalVersionAttribute)appAssembly</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.GetCustomAttributes(</code><code>typeof</code><code>(AssemblyInformationalVersionAttribute)).FirstOrDefault();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(infoVerAttr != </code><code>null</code> <code>&amp;&amp; infoVerAttr.InformationalVersion.Length &gt; 6)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>version = infoVerAttr.InformationalVersion;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_gitHash = version.Substring(version.IndexOf(</code><code>'+'</code><code>) + 1);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>_gitHash;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>ShortGitHash</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>get</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(</code><code>string</code><code>.IsNullOrEmpty(_gitShortHash))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_gitShortHash = GitHash.Substring(GitHash.Length - 6, 6);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>_gitShortHash;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></div></div></div>
<p>How do we access this class? Simple! It's a Singleton added in one line in Startup.cs's ConfigureServices():</p><div><div id="highlighter_200519"><div><div><p><code>services.AddSingleton&lt;AppVersionInfo&gt;();</code></p></div></div></div></div>
<p>Then injected in one line in our _layout.cshtml!</p><div><div id="highlighter_136091"><div><div><p><code>@inject AppVersionInfo appInfo</code></p></div></div></div></div>
<p>Then I can use it and it's easy. I could put an environment tag around it to make it only show up in staging:</p><div><div id="highlighter_531974"><div><div><p><code>&lt;</code><code>environment</code> <code>include</code><code>=</code><code>"Staging"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>cache</code> <code>expires-after</code><code>=</code><code>"@TimeSpan.FromDays(30)"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>div</code> <code>class</code><code>=</code><code>"copyright"</code><code>&gt;&amp;copy; Copyright @DateTime.Now.Year, &lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://www.hanselman.com"</code><code>&gt;Scott Hanselman&lt;/</code><code>a</code><code>&gt;. Design by &lt;</code><code>a</code> <code>href</code><code>=</code><code>"http://www.8164.org/"</code><code>&gt;@@jzy&lt;/</code><code>a</code><code>&gt;, Powered by @System.Runtime.InteropServices.RuntimeInformation.FrameworkDescription and deployed from commit &lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://github.com/shanselman/hanselminutes-core/commit/@appInfo.GitHash"</code><code>&gt;@appInfo.ShortGitHash&lt;/</code><code>a</code><code>&gt; via build &lt;</code><code>a</code> <code>href</code><code>=</code><code>"https://dev.azure.com/hanselman/Hanselminutes%20Website/_build/results?buildId=@appInfo.BuildId&amp;view=results"</code><code>&gt;@appInfo.BuildNumber&lt;/</code><code>a</code><code>&gt; &lt;/</code><code>div</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>cache</code><code>&gt;</code></p><p><code>&lt;/</code><code>environment</code><code>&gt;</code></p></div></div></div></div>
<p>I could also wrap it all in a cache tag like this. Worst case for a few days/weeks at the start of a new year the Year is off.</p><div><div id="highlighter_306105"><div><div><p><code>&lt;</code><code>cache</code> <code>expires-after</code><code>=</code><code>"@TimeSpan.FromDays(30)"</code><code>&gt;</code></p><p><code>&lt;</code><code>cache</code><code>&gt;</code></p></div></div></div></div>
<p>Thoughts on this technique?</p>
<hr>

<p><strong>Sponsor: </strong>This week's sponsor is...me! This blog and my podcast has been a labor of love for over 18 years. Your sponsorship pays my hosting bills for both AND allows me to buy gadgets to review AND the occasional taco. <a href="https://hanselminutes.com/advertise">Join me</a>!</p>


  
		
<div>
	<div>
	    <h4>About Scott</h4>
        <div>
			<p>Scott Hanselman is a former professor, former Chief Architect in finance, now speaker, consultant, father, diabetic, and Microsoft employee. He is a failed stand-up comic, a cornrower, and a book author.</p>
            <p><a href="https://facebook.com/shanselman"><img src="https://www.hanselman.com/images/icon-fb.png" alt="facebook"></a>
            <a href="https://twitter.com/shanselman"><img src="https://www.hanselman.com/images/icon-twitter.png" alt="twitter"></a>
            <a href="https://plus.google.com/108573066018819777334?rel=author" rel="author"><img src="https://www.hanselman.com/images/icon-gplus.png" alt="g+"></a>
            <a href="http://feeds.hanselman.com/ScottHanselman"><img src="https://www.hanselman.com/images/icon-rss.png" alt="subscribe"></a><br>
            <a href="http://hanselman.com/about">About</a> &nbsp; <a href="http://www.hanselman.com/newsletter">Newsletter</a>
        </p></div>
	</div> 
    
      <div>
          
         <p><strong>Hosting By</strong><br>
                <a rel="nofollow" href="https://sherweb.com/"><img alt="Dedicated Windows Server Hosting by SherWeb" width="125" height="125" src="https://images.sherweb.com/OrcsWeb/SherWebPoweredbyLogo_V-250x250Color.png"></a>
          </p>        

     </div>
</div>
  
  
		



		
		
		
		
		
  </section>
</section></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>