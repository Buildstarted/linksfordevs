<!DOCTYPE html>
<html lang="en">
<head>
    <title>
ritterim/stuntman - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="ritterim/stuntman - linksfor.dev(s)"/>
    <meta property="article:author" content="ritterim"/>
    <meta property="og:description" content="Library for impersonating users during development leveraging ASP.NET Identity. - ritterim/stuntman"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/ritterim/stuntman"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - ritterim/stuntman</title>
<div class="readable">
        <h1>ritterim/stuntman</h1>
            <div>by ritterim</div>
            <div>Reading time: 5-7 minutes</div>
        <div>Posted here: 28 Jul 2020</div>
        <p><a href="https://github.com/ritterim/stuntman">https://github.com/ritterim/stuntman</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
      <div>
        <article itemprop="text"><p><a target="_blank" rel="noopener noreferrer" href="https://raw.githubusercontent.com/ritterim/stuntman/master/stuntman-icon-128.png"><img src="https://raw.githubusercontent.com/ritterim/stuntman/master/stuntman-icon-128.png" alt="Stuntman logo"></a></p>
<blockquote>
<p>"Sometimes you need a Stuntman before you send in real, unsuspecting users!"</p>
</blockquote>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.nuget.org/packages/RimDev.Stuntman" rel="nofollow">RimDev.Stuntman</a></td>
<td><a href="https://www.nuget.org/packages/RimDev.Stuntman" rel="nofollow"><img src="https://camo.githubusercontent.com/e6d2294dc19c43ed1aab4a79953e313daf5748cd/68747470733a2f2f696d672e736869656c64732e696f2f6e756765742f762f52696d4465762e5374756e746d616e2e737667" alt="RimDev.Stuntman NuGet Version" data-canonical-src="https://img.shields.io/nuget/v/RimDev.Stuntman.svg"></a></td>
</tr>
</tbody>
</table>
<p><strong>Stuntman</strong> is a library for impersonating users during development leveraging .NET Claims Identity. Used primarily in web environments like ASP.NET MVC, ASP.NET Web Forms, and OWIN applications that serve HTML. This allows you to test different user scenarios that exist in your application with minimal friction. It also allows you to share those scenarios with other team members via source control.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://cloud.githubusercontent.com/assets/1012917/10737939/5154bbdc-7beb-11e5-87dd-979c4e8cb3c0.gif"><img src="https://cloud.githubusercontent.com/assets/1012917/10737939/5154bbdc-7beb-11e5-87dd-979c4e8cb3c0.gif" alt="Stuntman demo"></a></p>
<h2>Installation</h2>
<p>Install the <a href="https://www.nuget.org/packages/RimDev.Stuntman" rel="nofollow">RimDev.Stuntman</a> NuGet package.</p>
<pre><code>PM&gt; Install-Package RimDev.Stuntman
</code></pre>
<h2>Usage</h2>
<h3>Startup / Middleware registration</h3>
<p>Stuntman uses OWIN and is registered as middleware, and allows for programmatically preset user scenarios, in the form of claims identities. These presets can be utilized by you or other team members working on the same code base.</p>
<div><pre><span><span>//</span> OWIN Startup class</span>
<span>public</span> <span>class</span> <span>Startup</span>
{
    <span>public</span> <span>static</span> <span>readonly</span> <span>StuntmanOptions</span> <span>StuntmanOptions</span> <span>=</span> <span>new</span> <span>StuntmanOptions</span>();

    <span>public</span> <span>void</span> <span>Configuration</span>(<span>IAppBuilder</span> <span>app</span>)
    {
        <span>StuntmanOptions</span>
            .<span>AddUser</span>(<span>new</span> <span>StuntmanUser</span>(<span><span>"</span>user-1<span>"</span></span>, <span><span>"</span>User 1<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>given_name<span>"</span></span>, <span><span>"</span>John<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>family_name<span>"</span></span>, <span><span>"</span>Doe<span>"</span></span>));

        <span><span>//</span> Optionally assign a user an access token.</span>
        <span>StuntmanOptions</span>
            .<span>AddUser</span>(<span>new</span> <span>StuntmanUser</span>(<span><span>"</span>user-2<span>"</span></span>, <span><span>"</span>User 2<span>"</span></span>)
                .<span>SetAccessToken</span>(<span><span>"</span>123<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>given_name<span>"</span></span>, <span><span>"</span>Mary<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>family_name<span>"</span></span>, <span><span>"</span>Smith<span>"</span></span>));

        <span><span>//</span> You can also add users using HTTP/HTTPS or the file system!</span>
        <span>StuntmanOptions</span>
            .<span>AddUsersFromJson</span>(<span><span>"</span>https://example.com/web-test-users.json<span>"</span></span>)
            .<span>AddUsersFromJson</span>(<span><span>@"</span>C:\local-test-users.json<span>"</span></span>);

        <span><span>//</span> Optional alignment of user picker</span>
        <span><span>//</span> Supported options are:</span>
        <span><span>//</span> - StuntmanAlignment.Left (default)</span>
        <span><span>//</span> - StuntmanAlignment.Center</span>
        <span><span>//</span> - StuntmanAlignment.Right</span>
        <span>StuntmanOptions</span>.<span>SetUserPickerAlignment</span>(<span>StuntmanAlignment</span>.<span>Right</span>);

        <span><span>//</span> Only show when debug is true in Web.config.</span>
        <span>if</span> (<span>System</span>.<span>Web</span>.<span>HttpContext</span>.<span>Current</span>.<span>IsDebuggingEnabled</span>)
        {
            <span>app</span>.<span>UseStuntman</span>(<span>StuntmanOptions</span>);
        }
    }
}</pre></div>
<div><pre><span><span>//</span> ASP.NET Core</span>
<span>public</span> <span>class</span> <span>Startup</span>
{
    <span>public</span> <span>static</span> <span>readonly</span> <span>StuntmanOptions</span> <span>StuntmanOptions</span> <span>=</span> <span>new</span> <span>StuntmanOptions</span>();

    <span>public</span> <span>Startup</span>(<span>IConfiguration</span> <span>configuration</span>)
    {
        <span>StuntmanOptions</span>
            .<span>AddUser</span>(<span>new</span> <span>StuntmanUser</span>(<span><span>"</span>user-1<span>"</span></span>, <span><span>"</span>User 1<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>given_name<span>"</span></span>, <span><span>"</span>John<span>"</span></span>)
                .<span>AddClaim</span>(<span><span>"</span>family_name<span>"</span></span>, <span><span>"</span>Doe<span>"</span></span>));

        <span>Configuration</span> <span>=</span> <span>configuration</span>;
    }

    <span>public</span> <span>IConfiguration</span> <span>Configuration</span> { <span>get</span>; }

    <span>public</span> <span>void</span> <span>ConfigureServices</span>(<span>IServiceCollection</span> <span>services</span>)
    {
        <span>services</span>.<span>AddStuntman</span>(<span>StuntmanOptions</span>);
    }

    <span>public</span> <span>void</span> <span>Configure</span>(<span>IApplicationBuilder</span> <span>app</span>, <span>IHostingEnvironment</span> <span>env</span>)
    {
        <span>app</span>.<span>UseStuntman</span>(<span>StuntmanOptions</span>);
    }
}</pre></div>
<h3>View</h3>
<p>Here's how to use Stuntman in a <strong>Razor</strong> view to show the user picker <em>(assuming the application <code>Startup</code> class has <code>StuntmanOptions</code> that can be used)</em>.</p>
<pre><code>@* Only show when debug is true in Web.config. *@
@if (System.Web.HttpContext.Current.IsDebuggingEnabled)
{
    @Html.Raw(YourApplicationNamespace.Startup.StuntmanOptions.UserPicker(User));
}
</code></pre>
<h3>Bearer-token</h3>
<p>Stuntman supports bearer-tokens based on a user's access-token (<code>StuntmanUser.SetAccessToken</code>). There is nothing special about the value and no additional encoding/decoding is necessary. Upon successful authentication, the value is added as a claim. Leveraging the previous <code>Startup</code> code, you could construct an HTTP-request to utilize User 2's access-token:</p>
<div><pre><span>&gt;</span> curl -i -H <span><span>"</span>Authorization: Bearer 123<span>"</span></span> http://localhost:54917/secure
HTTP/1.1 200 OK</pre></div>
<p>Basic format-checking is done on the value:</p>
<div><pre><span>&gt;</span> curl -i -H <span><span>"</span>Authorization: Bearer not-real<span>"</span></span> http://localhost:54917/secure
HTTP/1.1 403 options provided does not include the requested <span><span>'</span>not-real<span>'</span></span> user.</pre></div>
<div><pre><span>&gt;</span> curl -i -H <span><span>"</span>Authorization: Bearer abc 123<span>"</span></span> http://localhost:54917/secure
HTTP/1.1 400 Authorization header is not <span>in</span> correct format.</pre></div>
<h3>Remote users</h3>
<p>Users can be populated from remote locations using one or more of the following:</p>
<ul>
<li>From the file system</li>
</ul>
<div><pre><span>StuntmanOptions</span>.<span>AddUsersFromJson</span>(<span><span>"</span>C:<span>\\</span>path<span>\\</span>to<span>\\</span>users.json<span>"</span></span>);</pre></div>
<ul>
<li>From a web url to a JSON file</li>
</ul>
<div><pre><span>StuntmanOptions</span>.<span>AddUsersFromJson</span>(<span><span>"</span>https://example.com/users.json<span>"</span></span>);</pre></div>
<ul>
<li>From a web url to a Stuntman instance with a running server</li>
</ul>
<div><pre><span><span>//</span></span>
<span><span>//</span> On the server</span>
<span><span>//</span></span>
<span>StuntmanOptions</span>.<span>EnableServer</span>();

<span><span>//</span></span>
<span><span>//</span> On the client</span>
<span><span>//</span></span>
<span>StuntmanOptions</span>.<span>AddConfigurationFromServer</span>(<span><span>"</span>https://some-stuntman-enabled-app.example.com/<span>"</span></span>);
<span><span>//</span> or, if you prefer to not throw an exception</span>
<span><span>//</span> and have the users silently not added</span>
<span><span>//</span> if the server is unavailable:</span>
<span>StuntmanOptions</span>.<span>TryAddConfigurationFromServer</span>(<span><span>"</span>https://some-stuntman-enabled-app.example.com/<span>"</span></span>);</pre></div>
<h3>Example users JSON</h3>
<p>Here's an example users JSON that can be consumed by <code>StuntmanOptions.AddUsersFromJson(string pathOrUrl)</code>:</p>
<div><pre>{
  <span><span>"</span>Users<span>"</span></span>: [
    {
      <span><span>"</span>Id<span>"</span></span>: <span><span>"</span>user-1<span>"</span></span>,
      <span><span>"</span>Name<span>"</span></span>: <span><span>"</span>User 1<span>"</span></span>
    },
    {
      <span><span>"</span>Id<span>"</span></span>: <span><span>"</span>user-2<span>"</span></span>,
      <span><span>"</span>Name<span>"</span></span>: <span><span>"</span>User 2<span>"</span></span>
    }
  ]
}</pre></div>
<h2>Contributing</h2>
<p>Have an idea? Let's talk about it in an issue!</p>
<p>Find a bug? Open an issue or submit a pull request!</p>
<h2>License</h2>
<p>MIT License</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>