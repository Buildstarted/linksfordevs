<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using AWS Parameter Store for ASP.NET Core Data Protection Keys -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Using AWS Parameter Store for ASP.NET Core Data Protection Keys</h1><div><div class="entry-content"><p>If you’re using ASP.NET Core in AWS under any type of load balanced scenario, either through Elastic Beanstalk or an ALB with and ECS, etc, you will need to share the data protection keys.  This is because each instance of your application needs to be using the exact same keys.  </p><p>This isn’t an issue if you are using a single instance as the keys will be stored in memory.</p><p>If you haven’t yet used the AWS SDK, I highly recommend first checking out my quick start on <a rel="noreferrer noopener" aria-label="configuring AWS SDK in ASP.NET Core (opens in a new tab)" href="https://codeopinion.com/configuring-aws-sdk-in-asp-net-core/" target="_blank">configuring AWS SDK in ASP.NET Core</a>.</p><h2>AWS Systems Manager Parameter Store</h2><p>One option is to use Parameter store to store the data protection keys.  Thankfully AWS has released a nice little package to make this really simple.</p><p>First, add the <a rel="noreferrer noopener" aria-label="Amazon.AspNetCore.DataProtection.SSM (opens in a new tab)" href="https://www.nuget.org/packages/Amazon.AspNetCore.DataProtection.SSM" target="_blank">Amazon.AspNetCore.DataProtection.SSM</a> package to your csproj.</p><p>Now you can use the <strong>PersistKeysToAWSSystemsManager</strong> method passing the prefix as the parameter.</p><figure class="wp-block-embed"><p>That’s it!  That simple.  Now when you run your application, you will see that a new parameter has been created with the prefix you specified followed by key-{GUID}.</p><figure class="wp-block-image"><img src="https://codeopinion.com/wp-content/uploads/2019/04/ssm-1024x232.png" alt="" class="wp-image-6299" srcset="https://codeopinion.com/wp-content/uploads/2019/04/ssm-1024x232.png 1024w, https://codeopinion.com/wp-content/uploads/2019/04/ssm-300x68.png 300w, https://codeopinion.com/wp-content/uploads/2019/04/ssm-768x174.png 768w, https://codeopinion.com/wp-content/uploads/2019/04/ssm.png 1228w" sizes="(max-width: 1024px) 100vw, 1024px"></figure><h2>ASP.NET Core Data Protection</h2><p>If you want to persist data protection keys to somewhere like S3, check out <a href="https://codeopinion.com/asp-net-core-data-protection/" target="_blank" rel="noreferrer noopener" aria-label="this other post. (opens in a new tab)">this other post.</a></p><p>If you have any questions or comments, please let me know on twitter as I will focus my posts on those questions and comments.  </p><p>Related Links:</p><a href="https://twitter.com/codeopinion?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-show-count="false">Follow @codeopinion</a></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>