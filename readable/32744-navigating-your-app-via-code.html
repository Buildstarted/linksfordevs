<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Navigating your app via code -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <article id="post-603" class="post-603 page type-page status-publish hentry"> <div class="entry-content"> <p>The source code for this section can be found on <a href="https://github.com/mrpmorris/blazor-university/tree/master/NavigatingViaCode/NavigatingViaCode">GitHub</a>.</p> <p>Access to browser navigation from Blazor is provided via the <code>IUriHelper</code> service. This can be injected into a Blazor component using <code>@inject</code> in a razor file, or the <code>[Inject]</code> attribute in a CS file.</p> <p>The <code>IUriHelper</code> service has two members that are of particular interest; <code>NavigateTo</code> and <code>OnLocationChanged</code>.</p> <h2>The OnLocationChanged event</h2> <p><code>OnLocationChanged</code> is an event that is triggered whenever the URL in the browser is altered. It passes an instance of <code>LocationChangedEventArgs</code> which provides the following information:</p> <pre class="EnlighterJSRAW">public readonly struct LocationChangedEventArgs
{
	public string Location { get; }
	public bool IsNavigationIntercepted { get; }
}</pre> <p>The <code>Location</code> property is the full URL as it appears in the browser, including the protocol, path, and any query string.</p> <p><strong>IsNavigationIntercepted</strong> indicates whether the navigation was initiated via code or via an HTML navigation.</p> <ul><li><code>false</code><br>The navigation was initiated by <code>IUriHelper.NavigateTo</code> being called from code.</li><li><code>true</code><br>The user clicked an HTML navigation element (such as an <code>a href</code>), and Blazor intercepted the navigation instead of allowing the browser to actually navigate to a new URL, which would result in a request to the server. It will also be true in other cases, such as if some <code>JavaScript</code> on the page causes a navigation (for example, after a <code>timeOut</code>). Ultimately, any navigation event that wasn&#x2019;t initiated via <code>IUriHelper.NavigateTo</code> will be considered an intercepted navigation, and this value will be <code>true</code>.</li></ul> <p>Note there is currently no way to intercept a navigation and prevent it from proceeding.</p> <h3>Observing OnLocationChanged events</h3> <p>It is important to note that the <code>IUriHelper</code> service is a long-living instance. Consequently, any component that subscribes to its <code>OnLocationChanged</code> event will be strongly referenced for the duration of its lifetime. It is therefore important our components also unsubscribe when they are destroyed, so they may be garbage collected.</p> <p>Currently, the <code>ComponentBase</code> class does not have a <a href="http://blazor-university.com/components/component-lifecycles/">lifecycle</a> event for when it is destroyed and there is no way to implement interfaces such as <code>IDisposable</code>, so there is nowhere in a <code>.razor</code> file where we can remove a subscription and ensure our component can be garbage collected. To remedy this we must create a <code>.cs</code> file that descends from <code>ComponentBase</code> and implements <code>IDisposable</code>, and then <code>@inherit</code> our <code>.razor</code> file from that class.</p> <pre class="EnlighterJSRAW">using Microsoft.AspNetCore.Components;
using Microsoft.AspNetCore.Components.Routing;
using System;
using System.Diagnostics;

namespace NavigatingViaCode.Pages
{
	public class CounterBase : ComponentBase, IDisposable
	{
		// Inject an instance of the IUriHelper
		[Inject] protected IUriHelper UriHelper { get; set; }

		protected override void OnInit()
		{
			// Subscribe to the event
			UriHelper.OnLocationChanged += LocationChanged;
			base.OnInit();
		}

		public void Dispose()
		{
			// Unsubscribe from the event when our component is disposed
			UriHelper.OnLocationChanged -= LocationChanged;
		}

		private void LocationChanged(object sender, LocationChangedEventArgs e)
		{
			string navigationMethod = e.IsNavigationIntercepted ? &quot;HTML&quot; : &quot;code&quot;;
			Debug.WriteLine($&quot;Notified of navigation via {navigationMethod} to {e.Location}&quot;);
		}
	}
}</pre> <p>And then in the <code>Counter.razor</code> file add <code>@inherits CounterBase</code>.</p> <h2>The NavigateTo method</h2> <p>The <code>IUriHelper.NavigateTo</code> method enables C# code to control the browser&#x2019;s URL. As with intercepted navigations, the browser does not actually navigate to a new URL. Instead the URL in the browser is replaced, and the previous URL is inserted into the browser&#x2019;s navigation history, but no request is made to the server for the content of the new page. Navigations made via <code>NavigateTo</code> will cause the <code>OnLocationChanged</code> event to trigger, passing the new URL and <code>false</code> for <code>IsNavigationIntercepted</code>.</p> <p>For this example we&#x2019;ll alter the standard Blazor template again. We&#x2019;ll use what we learned previously in <a href="/routing/route-parameters/">Route parameters</a> and <a href="/routing/optional-route-parameters/">Optional route parameters</a>.</p> <p>First, delete the <code>Index.razor</code> and <code>FetchData.razor</code> pages, and remove the links to those pages inside the <code>NavMenu.razor</code> file. Also in NavMenu, change the <code>href</code> of the link to counter to <code>href=&quot;&quot;</code>, because we are going to make it the default page.</p> <p>Edit <code>Counter.razor</code> and give it two routes, <code>&quot;/&quot;</code> and <code>&quot;/counter/{CurrentCount:int}&quot;</code>, also make sure it descends from the <code>CounterBase</code> class so we can see navigation logs in the browser&#x2019;s console window &#x2013; the CounterBase.cs file was outlined previously in the <code>OnLocationChanged</code> section.</p> <pre class="EnlighterJSRAW">@page &quot;/&quot;
@page &quot;/counter/{CurrentCount:int}&quot;
@inherits CounterBase</pre> <p>We&#x2019;ll also need to change the <code>currentCount</code> field so it is a property with a getter and setter, and decorate it as a <code>[Parameter]</code>. Note that it has been renamed from <em>camelCase</em> to <em>PascalCase</em> too.</p> <pre class="EnlighterJSRAW">[Parameter] int CurrentCount { get; set; }</pre> <p>We now have a counter page that can be accessed either simply be reaching the main page of the app, or by specifying <code>/counter/X</code>, where <em>X</em> is an integer value.</p> <p>The <code>IUriHelper</code> was injected into our <code>CounterBase</code> class, and so is accessible in our <code>Counter.razor</code> file.</p> <pre class="EnlighterJSRAW">@code {
	[Parameter] int CurrentCount { get; set; }

	bool forceLoad;

	void AlterBy(int adjustment)
	{
		int newCount = CurrentCount + adjustment;
		UriHelper.NavigateTo(&quot;/counter/&quot; + newCount, forceLoad);
	}
}</pre> <p>We&#x2019;ll call the <code>AlterBy</code> method from two buttons, one to increment the <code>CurrentCount</code> and one to decrement it. There is also an option the user will be able to select, <code>forceLoad</code>, which will set the relevant parameter in the call to <code>NavigateTo</code> so we can see the difference. The whole file should eventually look like this:</p> <pre class="EnlighterJSRAW">@page &quot;/&quot;
@page &quot;/counter/{CurrentCount:int}&quot;
@inherits CounterBase

&lt;h1&gt;Counter value = @CurrentCount&lt;/h1&gt;

&lt;div class=&quot;form-check&quot;&gt;
	&lt;input @bind=@forceLoad type=&quot;checkbox&quot; class=&quot;form-check-input&quot; id=&quot;ForceLoadCheckbox&quot;/&gt;
	&lt;label class=&quot;form-check-label&quot; for=&quot;ForceLoadCheckbox&quot;&gt;Force page reload on navigate&lt;/label&gt;
&lt;/div&gt;

&lt;div class=&quot;btn-group&quot; role=&quot;group&quot;&gt;
	&lt;button @onclick=@( () =&gt; AlterBy(-1) ) class=&quot;btn btn-primary&quot;&gt;-&lt;/button&gt;
	&lt;input value=@CurrentCount readonly class=&quot;form-control&quot; /&gt;
	&lt;button @onclick=@( () =&gt; AlterBy(1) ) class=&quot;btn btn-primary&quot;&gt;+&lt;/button&gt;
&lt;/div&gt;
&lt;a href=&quot;/Counter/0&quot;&gt;Reset&lt;/a&gt;

@code {
	[Parameter] int CurrentCount { get; set; }

	bool forceLoad;

	void AlterBy(int adjustment)
	{
		int newCount = CurrentCount + adjustment;
		UriHelper.NavigateTo(&quot;/counter/&quot; + newCount, forceLoad);
	}
}
</pre> <p>Clicking the <code>-</code> or <code>+</code> buttons will call the <code>AlterBy</code> method which will instruct the <code>IUriHelper</code> service to navigate to <code>/counter/X</code>, where <em>X</em> is the value of the adjusted <code>CurrentCount</code> &#x2013; resulting in the following output in the browser&#x2019;s console:</p> <blockquote class="wp-block-quote"><p>WASM: &#xFEFF;Notified of navigation via code to http://localhost:6812/counter/1WASM: Notified of navigation via code to http://localhost:6812/counter/2WASM: Notified of navigation via code to http://localhost:6812/counter/3</p><p>WASM: Notified of navigation via code to http://localhost:6812/counter/4</p></blockquote></div></article>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>