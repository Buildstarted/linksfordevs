<!DOCTYPE html>
<html lang="en">
<head>
    <title>
WSL &#x2B; Visual Studio = attaching/launching a Linux .NET Core application on Window 10 -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>WSL + Visual Studio = attaching/launching a Linux .NET Core application on Window 10</h1><div><div class="ac ae af ag ah ea aj ak"><p id="a3f7" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">This post shows how to attach to a .NET Core process running on Linux with WSL and also how to start a Linux process with Visual Studio debugger</p><p id="1e91" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Coming from the Windows world, I don’t find that easy to develop .NET Core applications for Linux. I’m used to code and debug in Visual Studio. Now, I need to build on Windows (due to our Criteo continuous integration), deploy an artifact to Marathon in order to get an application running inside a Mesos container. At Criteo, we had to build a whole set of services to allow remote debugging or memory dump analysis.</p><p id="8c99" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">But what if I just wanted to test and debug a small scenario on my beloved Windows machine? Windows Subsystem for Linux (aka WSL) is perfect for running a Linux .NET Core application on Windows. However, how to attach to it or even start a debugging session from Visual Studio? In the rest of this post, I’ll explain how to setup your Windows 10 machine to achieve these miracles.</p><p id="f25c" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><strong class="gq hc">Linux on Windows: welcome WSL</strong></p><p id="e49a" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">It is obviously not the place to dig into Windows Subsystem for Linux. You just need to know that once installed, it allows you open up a Linux shell on your Windows machine without any virtual machine kind of technology. It is also possible to share folders between Windows (where you want to build your application) and Linux (where you want to execute the built assemblies).</p><p id="a39c" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">The first step is to turn on WSL feature in your Windows:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="820a" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">After a reboot, you are able to start a WSL prompt:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="8889" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">You can also <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" class="da by ic id ie if" target="_blank" rel="noopener nofollow">install your favorite Linux distro</a> if you want.</p><p id="b52e" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">The next step is to install <a href="https://dotnet.microsoft.com/download/linux-package-manager/ubuntu18-04/runtime-current" class="da by ic id ie if" target="_blank" rel="noopener nofollow">.NET Core runtime</a> or SDK so you are able to run your application on Linux.</p><p id="fa73" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">It is now time to look at your hard drive from a Linux perspective:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="0729" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Your drives are mapped under /mnt without the “:”. In my case, I created a wsl folder under my d: drive to do my experiments. With Visual Studio, I generated a TestConsole application with the following code:</p><figure class="he hf hg hh hi hj"><p id="63e0" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">I’m publishing the application to get all needed assemblies:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="50e1" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">In a WSL prompt, type <strong class="gq hc">dotnet</strong> with the name of your application assembly et voila!</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="7304" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">A Linux .NET Core application is running on your Windows machine.</p><p id="096c" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><strong class="gq hc">How to attach to a running Linux application</strong></p><p id="fa12" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Let’s say that I’m detecting a problem and I want to debug the Linux application with Visual Studio. When attaching the Visual Studio debugger to a process, several connection types are available:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="57b5" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">The SSH connection type will be used with WSL with the following kind of communications architecture:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="e95a" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">The Visual Studio debugger is sending commands to the remote Linux debugger vsdbg via an SSH channel. Here are the steps to follow to install the missing components:</p><ol class=""><li id="7729" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb ir is it">By default, an SSH server is installed with WSL. However, I was not able to make the whole pipeline work with it so I had to uninstall and reinstall it:<br><code class="hu iu iv iw ix b">sudo apt-get remove openssh-server</code><br><code class="hu iu iv iw ix b">sudo apt-get install openssh-server</code></li><li id="56fc" class="go gp ed at gq b gr iy gt iz gv ja gx jb gz jc hb ir is it">The SSH configuration needs also to be changed in order to allow username/password kind of security needed by Visual Studio (if you prefer key-based security, look at the end of the post for available resources). If you don’t know how to use vi efficiently to simply edit a file, install nano (thanks @kookiz for the tips :^)<br><code class="hu iu iv iw ix b">sudo apt-get install nano</code></li><li id="9ed3" class="go gp ed at gq b gr iy gt iz gv ja gx jb gz jc hb ir is it">In /etc/ssh/sshd_config, change the PasswordAuthentication settings<br><code class="hu iu iv iw ix b">sudo nano /etc/ssh/sshd_config<br>PasswordAuthentication yes</code></li><li id="b67b" class="go gp ed at gq b gr iy gt iz gv ja gx jb gz jc hb ir is it">Restart the ssh server<br><code class="hu iu iv iw ix b">sudo service ssh start</code></li><li id="945f" class="go gp ed at gq b gr iy gt iz gv ja gx jb gz jc hb ir is it">You need to install unzip in order to get vsdbg<br><code class="hu iu iv iw ix b">sudo apt-get install unzip<br>curl -sSL <a href="https://aka.ms/getvsdbgsh" class="da by ic id ie if" target="_blank" rel="noopener nofollow">https://aka.ms/getvsdbgsh</a> | bash /dev/stdin -v latest -l ~/vsdbg</code></li></ol><p id="2cdc" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">You are now ready to select SSH as connection type and enter your machine name before clicking the Refresh button. At that time, a new dialog should pop up for you to enter your WSL credentials:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="85db" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">After you click the Refresh button, the list at the bottom should contain the Linux processes running in WSL</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="2bb1" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Select your .NET Core application and click Attach to select the Managed debugger:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="7432" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Now, if you set a breakpoint in the code and trigger it with an appropriate action in your WSL prompt</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="be35" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">then the debugger will break as expected:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="5557" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Note that when you stop your debugging session, the Linux application is not stopped; just detached from the debugger and keeps on running.</p><p id="958c" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><strong class="gq hc">Showtime for F5!</strong></p><p id="8c52" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Attaching to a running Linux application is nice but it would be even better to start a Linux process from Visual Studio debugger. In order to achieve this goal you need to add another piece to the architecture puzzle:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="2084" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">As detailed in <a href="https://github.com/Microsoft/MIEngine/wiki/Offroad-Debugging-of-.NET-Core-on-Linux---OSX-from-Visual-Studio" class="da by ic id ie if" target="_blank" rel="noopener nofollow">this WIKI page</a>, it is possible to tell Visual Studio to execute debugging actions thanks to a launch.json file such as the following:</p><figure class="he hf hg hh hi hj"><p id="38eb" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">The <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" class="da by ic id ie if" target="_blank" rel="noopener nofollow">plink tool from putty</a> will be used as an adapter for Visual Studio to communicate with vsdbg running in WSL. The <strong class="gq hc">adapterArgs</strong> property gives the same SSH/machine/user/password information that you provide via Visual Studio UI in the Attach scenario. The <strong class="gq hc">configuration</strong> section defines which request (“launch” instead of attach and which folder/assembly to start) will be sent to vsdbg.</p><p id="040f" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Once this file is created (in my case in d:\wsl\vs folder), you just need to type the following command in the Immediate pane of Visual Studio:</p><p id="fce4" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><code class="hu iu iv iw ix b">DebugAdapterHost.Launch /LaunchJson:d:\wsl\vs\launch.json</code></p><p id="60be" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">and if you had set a breakpoint on the first line of your application, the debugger should break there:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="07d8" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">In a WSL prompt, you can see the expected 2 new spawned processes:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="cf0f" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">But wait!</p><p id="e13b" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">I have a problem now: I don’t have any prompt in which typing input for my console application… However, as always in Linux, you simply need to write to a file to fix this. The stdin stream of your application is accessible under <code class="hu iu iv iw ix b">/proc/&lt;pid&gt;/fd/0</code>.</p><p id="71eb" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">So, when I type the following command:</p><p id="dfc5" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><code class="hu iu iv iw ix b">echo "Launching a Linux app is not a problem!" &gt; /proc/18341/fd/0</code></p><p id="b24c" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">my breakpoint is hit in Visual Studio:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="fa7d" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Also note that everything that is sent to the console appears in Visual Studio Output pane:</p><figure class="he hf hg hh hi hj dm dn paragraph-image"><p id="ad70" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">Note that, unlike the Attach scenario, if you stop the debugging session, the Linux application (and vsdbg) will be terminated.</p><p id="186b" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv"><strong class="gq hc">Resources</strong></p><p id="982e" class="go gp ed at gq b gr gs gt gu gv gw gx gy gz ha hb dv">During my investigations I’ve found a few resources you might find useful (especially about configuring SSL with keys instead of passing clear user/password)</p></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>