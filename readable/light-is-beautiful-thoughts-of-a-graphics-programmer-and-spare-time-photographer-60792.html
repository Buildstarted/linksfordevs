<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Light is beautiful | Thoughts of a graphics programmer and spare time photographer - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Light is beautiful | Thoughts of a graphics programmer and spare time photographer - linksfor.dev(s)"/>
    <meta property="og:description" content="Over the last few months I have been trying to push my understanding of Physically Based Shading, by actively exploring every corner and turning over every stone, to uncover any area where I lack knowledge. Although this is still an ongoing process and I still have a lot to do, I thought I could already share some of what I have learned in the process."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://lousodrome.net/blog/light/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Light is beautiful | Thoughts of a graphics programmer and spare time photographer</title>
<div class="readable">
        <h1>Light is beautiful | Thoughts of a graphics programmer and spare time photographer</h1>
            <div>Reading time: 26-32 minutes</div>
        <div>Posted here: 17 Apr 2020</div>
        <p><a href="http://lousodrome.net/blog/light/">http://lousodrome.net/blog/light/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="primary">
			<div id="content" role="main">

			
						<nav id="nav-above">
			<h3>Post navigation</h3>
			
			
		</nav><!-- #nav-above -->
	
								
					
	<article id="post-1486">
		<!-- .entry-header -->

				<div>
			
<p>Over the last few months I have been trying to push my understanding of Physically Based Shading, by actively exploring every corner and turning over every stone, to uncover any area where I lack knowledge. Although this is still an ongoing process and I still have a lot to do, I thought I could already share some of what I have learned in the process.</p>



<p>Last weekend the Easter demoparty event <a href="https://2020.revision-party.net/">Revision</a> took place, as an online version due to the current pandemic situation. There, I presented a talk on Physically Based Shading, in which I went into electromagnetism, existing models, and an brief overview of a prototype I am working on.</p>



<p>The presentation goes into a lot of detail about interaction of light with matter from a physics point of view, then builds its way up to the Cook-Torrance specular BRDF model. The diffuse BRDF and the Image Based Lighting were skipped due to time constraints. I am considering doing a Part 2 to address those topics, but I haven’t decided anything yet.</p>



<p>In the mean time, please leave a comment or contact me if you notice any mistake or inaccuracy.</p>


<h2>Abstract</h2>
<blockquote>
<p>How do you implement a Physically Based Shading for your demos yet keep the possibility to try something completely different without having to rewrite everything?<br>In this talk we will first get an intuitive understanding of what makes matter look the way it looks, with as much detail as we can given the time we have. We will then see how this is modeled by a BRDF (Bidirectional Reflectance Distribution Function) and review some of the available models.<br>We will also see what makes it challenging for design and for real-time implementation. Finally we will discuss a possible implementation that allows to experiment with different models, can work in a variety of cases, and remains compatible with size coding constraints.</p>
</blockquote>
<h2>Slides</h2>
<p>Here are the slides, together with the text of the talk and the link to the references:<br><strong><a href="https://bit.ly/2IZqYET">Implementing a Physically Based Shading model without locking yourself in</a></strong>.</p>
<h2>Video</h2>
<p>And finally here is the recording of the talk, including a quick demonstration of the prototype:<br><iframe src="https://www.youtube.com/embed/E5HEynjqDcg" allowfullscreen="allowfullscreen" width="560" height="315" frameborder="0"></iframe></p>
<h2>Interference shader</h2>
<p>Here is the shader used during the presentation to illustrate light interaction at the interface between to media:</p>

<h2>Acknowledgements</h2>
<p>Thanks again to Alan Wolfe for reviewing the text, Alkama for the motivation and questions upfront and help in the video department, Scoup and the Revision crew for organizing the seminars, Ronny and Siana for the help in the sound department, and everyone who provided feedback <a href="http://lousodrome.net/blog/light/2020/01/04/physically-based-rendering-references-at-the-end-of-2019/">on my previous article on Physically Based Shading</a>.</p>







					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1486 -->

				
					
	<article id="post-1479">
		<!-- .entry-header -->

				<div>
			
<p>This <a href="https://www.youtube.com/playlist?list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p">series of short videos</a> shows how to derive <a href="https://en.wikipedia.org/wiki/Maxwell%27s_equations">Maxwell’s equations</a> all the way to <a href="https://en.wikipedia.org/wiki/Fresnel_equations">Fresnel’s equations</a>. Each one is about 10 to 15mn long.</p>



<p><iframe src="https://www.youtube.com/embed/_FS6csrxBPU" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" width="560" height="315" frameborder="0"></iframe></p>



<p>The first four videos show how to use boundary conditions to deduce the relationship between the electromagnetic field on both sides of a surface (or interface between two different media).<br></p>



<ul><li><a href="https://www.youtube.com/watch?v=_FS6csrxBPU&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p">Electromagnetic Boundary Conditions Explained</a></li><li><a href="https://www.youtube.com/watch?v=vlNUGyDzJ90&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=2">Normal Electric Field Boundary Conditions</a></li><li><a href="https://www.youtube.com/watch?v=BMUz8AjYzOc&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=3">Tangential Magnetic Field Boundary Conditions</a></li><li><a href="https://www.youtube.com/watch?v=7NdMcBmjpuo&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=4">Normal Magnetic Field Boundary Conditions</a></li></ul>



<p>The next four videos use the previous results to obtain the Fresnel equations, for S-polarized and P-polarized cases.</p>



<ul><li><a href="https://www.youtube.com/watch?v=86eU7TKTr5U&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=5">Wave Impedance Explained</a></li><li><a href="https://www.youtube.com/watch?v=fB3upo0TM6k&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=6">Fresnel Equations at Normal Incidence</a></li><li><a href="https://www.youtube.com/watch?v=DRo2ItvLHNo&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=7">Fresnels Equations at an Angle</a></li><li><a href="https://www.youtube.com/watch?v=OgjZj60yt04&amp;list=PLQms29D1RqeKnVqHdrQbHr7uvA7Q3401p&amp;index=8">Fresnels Equations for p-Polarized Waves</a></li></ul>



<p>The rest of the series then dives into other topics like thin film interference.</p>



<p>The series assumes the viewer to be already familiar with the Maxwell equations, so it can be helpful to first see the explanation by Grant Sanderson of <a href="https://www.youtube.com/watch?v=rB83DpBJQsE">3Blue1Brown on Maxwell’s equations</a>.</p>


<p><iframe src="https://www.youtube.com/embed/rB83DpBJQsE" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" width="560" height="315" frameborder="0"></iframe></p>					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1479 -->

				
					
	<article id="post-1412">
		<!-- .entry-header -->

				<div>
			<p>A lot has happened in the graphics community in the last ten years, especially when it comes to physically based rendering (PBR). It started to become popular around 2009, as hardware made more powerful models affordable, and really took over between 2010 and 2014. Real-time engines started replacing Phong and Blinn-Phong with a normalized Blinn-Phong, until pretty much everyone switched to GGX and its long trailing reflections. Researchers explored how to make it work with image based lighting (IBL), area lights, and it seems that nowadays everyone is looking at the secondary bounce problem.</p>
<p>I am not sure why adoption also happened at the same in the film industry (instead of much earlier), despite having different constraints than real-time. Films made before 2010 were mostly ad hoc, until a wave converted nearly the entire industry to unbiased path tracing.</p>
<p>I gathered a first <a href="http://lousodrome.net/blog/light/2011/12/27/readings-on-physically-based-rendering/">PBR reading list</a> back in 2011, but since then, the community has collectively made strides of progress. I also have a better understanding of the topic myself. So I think it is time to revisit it with a new, updated (and unfortunately, longer) reading list.</p>
<p>However, covering the entire PBR pipeline would be way too vast, so I am going to focus on physically based shading instead, and ignore topics like physical lighting units, physically based camera or photogrammetry, even though some of the links cover those topics.</p>
<p><strong>Note:</strong> If you see mistakes, inaccuracies or missing important pieces, please let me know. I expect to update this article accordingly during the next few weeks.</p>

<ul>
<li>Physically Based Shading in Theory and Practice (formerly “Practical Physically Based Shading in Film and Game Production”)<br>
<a href="https://renderwonk.com/publications/s2010-shading-course/">2010</a>, (no 2011?), <a href="https://blog.selfshadow.com/publications/s2012-shading-course/">2012</a>, <a href="https://blog.selfshadow.com/publications/s2013-shading-course/">2013</a>, <a href="https://blog.selfshadow.com/publications/s2014-shading-course/">2014</a>, <a href="https://blog.selfshadow.com/publications/s2015-shading-course/">2015</a>, <a href="https://blog.selfshadow.com/publications/s2016-shading-course/">2016</a>, <a href="https://blog.selfshadow.com/publications/s2017-shading-course/">2017</a>.<br>
This recurring <em>SIGGRAPH</em> course by the leading actors of the field is a fantastic resource and a must see for anyone interested in the topic. Naty Hoffman then Stephen Hill have been hosting on their websites the course material for several years. Some of the presentations are also available on Youtube.</li>
<li><a href="http://www.pbr-book.org/">Physically Based Rendering: From Theory To Implementation</a>, Third edition, 2016, Matt Pharr, Wenzel Jakob, and Greg Humphreys<br>
As of 2018, the content of this reference book is entirely available online.</li>
<li><a href="https://placeholderart.wordpress.com/2015/07/28/implementation-notes-runtime-environment-map-filtering-for-image-based-lighting/">Implementation Notes: Runtime Environment Map Filtering for Image Based Lighting</a>, 2015, Padraic Hennessy.<br>
Details how to implement the environment map filtering described in Karis and Lagarde publications (see below), then how to optimize it by reducing the number of samples thanks to importance sampling and rejecting samples that don’t contribute.</li>
<li><a href="https://chetanjags.wordpress.com/2015/08/26/image-based-lighting/">Image Based Lighting</a>, 2015, Chetan Jaggi.<br>
Focused on specular reflections, the article presents the implementation of image based lighting (IBL) using the split sum approximation from <em>Unreal Engine 4</em> (described below), and how to improve quality for several cases.</li>
<li><a href="https://www.jordanstevenstechart.com/physically-based-rendering">Physically Based Rendering Algorithms: A Comprehensive Study In Unity3D</a>, 2017?, Jordan Stevens.<br>
This tutorial explains what the different parts of the Bidirectional Reflection Distribution Function (BRDF) mean, lists many available bricks, and shows them in isolation. It is directed at Unity, but translates easily to other environments.</li>
<li>LearnOpenGL’s <a href="https://learnopengl.com/PBR/Theory">PBR series</a> (<a href="https://learnopengl.com/PBR/Theory">theory</a>, <a href="https://learnopengl.com/PBR/Lighting">lighting</a>, <a href="https://learnopengl.com/PBR/IBL/Diffuse-irradiance">diffuse irradiance</a>, <a href="https://learnopengl.com/PBR/IBL/Specular-IBL">specular IBL</a>), 2017, Joey de Vries.<br>
An excellent introduction that explains the basics and walks the reader through the implementation of a shader based on the same model as <em>Unreal Engine 4</em> (detailed below). There seems to be a confusion between albedo and base colour, but it’s otherwise clear and well structured.</li>
</ul>

<ul>
<li>The <a href="http://www.merl.com/brdf/">MERL BRDF database</a>, 2003, Wojciech Matusik et al.<br>
Measured BRDF from 100 materials. This is a major reference.</li>
<li>The <a href="https://refractiveindex.info/">Refractive index database</a>, 2008 until now, Mikhail Polyanskiy.<br>
A trove of materials, with their index of refraction (in complex form) and reflectance per wavelength, polarized or not, with a reference to the original source material.</li>
<li><a href="http://www.pauldebevec.com/Probes/">Light probe images</a>, 1998, Paul Debevec.<br>
Paul Debevec’s captured high dynamic range (HDR) environment maps are famous images useful to test IBL.</li>
<li>There are now many more light probes available, like the <a href="http://gl.ict.usc.edu/Data/HighResProbes/">High-Resolution Lightprobe Image Gallery released by the University of Southern California</a> or the <a href="http://www.hdrlabs.com/sibl/archive.html">sIBL Archive</a>, even including public domain ones like the <a href="https://hdrihaven.com/hdris/">360 HDR photos captured by Greg Zaal</a>. We should be mindful of whether (understand: I haven’t checked myself) the recorded light intensities are reliable.</li>
</ul>

<p>The following publications all describe the work done by teams who had to do an inventory of the existing options, and choose a model for their particular needs.</p>
<ul>
<li><a href="https://disney-animation.s3.amazonaws.com/library/s2012_pbs_disney_brdf_notes_v2.pdf">Physically-Based Shading at Disney</a> (<a href="https://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_slides_v2.pdf">slides</a>), 2012, Brent Burley et al.<br>
What came to be known as the <em>“Disney BRDF”</em> was a milestone in PBR literature, and a reference many other works are built upon. It compares different existing models to the <a href="http://www.merl.com/brdf/">MERL database</a> (see previous section), notes their strengths and weaknesses, discusses in length the observed behaviour, especially the diffuse response at grazing angles, and proceeds to define their own empirical shading model to mimic that behaviour. The Disney BRDF is designed to be robust and expressive but also simple and intuitive for artists.<br>
In the annex, a brief overview of the history of BRDF is given.<br>
The publication proposes a tool, the <em><a href="https://www.disneyanimation.com/technology/brdf.html">BRDF Explorer</a></em>, to visualize and compare analytic BRDF models or measured ones.<br>
(In 2015, a <a href="https://blog.selfshadow.com/publications/s2015-shading-course/burley/s2015_pbs_disney_bsdf_notes.pdf">follow up publication extended their model to a full BSDF</a> in order to support refraction and scattering, but this falls out of the scope of this already long list.)</li>
<li><a href="https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf">Real Shading in Unreal Engine 4</a> (<a href="https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_slides.pdf">slides</a>), 2013, Brian Karis.<br>
Strongly inspired by the Disney BRDF, it presents a similar shading model. It prefers a simple Lambert diffuse BRDF due to both the cost and the integration with spherical harmonics, and uses other approximations for realtime. The course notes mention that a lot of work was done to compare the various available bricks, but doesn’t list them. Karis lists them in a separate publication, listed next.<br>
For image based lighting, the famous “split sum” approximation of the integral is introduced, allowing to convolve a part of the integral, and precompute the rest in a 2D look-up table (LUT).<br>
When explaining how the workflow adapted to this new model, the course notes stress the importance of having linear parameters for material interpolation.<br>
Warning: I was told a year ago by <span>Yusuke Tokuyoshi </span>that there was an error in a derivation, but my understanding of it is not sufficient to spot it. Apparently the error is only in the publication, and was fixed in the actual code though.</li>
<li><a href="http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html">Specular BRDF Reference</a>, 2013, Brian Karis.<br>
Lists various available bricks for the Cook-Torrance BRDF, using the same naming convention.</li>
<li><a href="https://seblagarde.wordpress.com/2015/07/14/siggraph-2014-moving-frostbite-to-physically-based-rendering/">Moving Frostbite to Physically Based Rendering 3.0</a>, 2014, Sébastien Lagarde.<br>
The biggest publication in this list, with over 120 pages of course notes. I haven’t finished reading it yet, but this is an outstanding piece of work, that goes deep into details for many of the aspects involved.</li>
<li><a href="https://google.github.io/filament/Filament.html">Physically Based Rendering in Filament</a>, 2018, Romain Guy et al.<br>
This documentation presents the shading model used in <em><a href="https://github.com/google/filament">Filament</a></em>, the choices that were made, which are similar to Frostbite in many ways, and the alternatives that were available. The quality of this document is outstanding, and it seems it is becoming a reference for PBR implementations.</li>
<li><a href="http://www.materialx.org/Specification.html">MaterialX Physically-Based Shading Nodes</a>, 2019, Niklas Harrysson, Doug Smythe and Jonathan Stone.<br>
This specification is meant as a transfer format in the VFX industry. It describes a wide range of materials, not limited to BRDF, but also including emissive and volumetric materials, and allows to choose between a variety of such functions.<br>
Reading this document can help solidify or confirm the understanding of how all these different functions contribute to the rendering ecosystem. However I would only recommend it to readers who already have a fairly good understanding of the PBR models.</li>
</ul>
<h2>Disney BRDF and BRDF Explorer implementations</h2>
<p>The Disney BRDF is so popular that many implementations can be found in the wild. Here are a few of them.</p>
<ul>
<li>Implementations of ShaderToy:
<ul>
<li><a href="https://www.shadertoy.com/view/4dBGRK">Real-time implementation with IBL</a>, by Maxwell Planck.</li>
<li><a href="https://www.shadertoy.com/view/XlKSDR">Real-time implementation</a>, by Romain Guy.</li>
<li><a href="https://www.shadertoy.com/view/XdyyDd">Path tracer implementation</a>, by Markus Moenig.</li>
<li><a href="https://www.shadertoy.com/view/llGyRd">Attempt at a single pass implementation</a>, by Markus Moenig.</li>
<li><a href="https://www.shadertoy.com/view/Ml2yDG">Anisotropic implementation for a single light source</a>, by an anonymous user.</li>
</ul>
</li>
<li><a href="https://forum.unity.com/threads/disney-principled-brdf-shader.675697/">Straightforward implementation in Unity</a>, by Przemyslaw Zaworski.</li>
<li>Web based BRDF explorers:
<ul>
<li><a href="https://patapom.com/topics/WebGL/BRDF/">WebGL BRDF Explorer</a>, by Benoît Mayaux.</li>
<li>Another <a href="https://depot.floored.com/brdf_explorer">BRDF Explorer</a>, by Nick Brancaccio.</li>
</ul>
</li>
</ul>

<p>It seems that in litterature, diffuse BRDF are a lot less covered than specular ones. I suppose this is because it is harder to solve, while the low frequency nature of the diffuse component makes its quality less noticeable. Therefore, many realtime implementations consider the Lambert model sufficient. However, the following publications explore the topic.</p>
<ul>
<li><a href="https://disney-animation.s3.amazonaws.com/library/s2012_pbs_disney_brdf_notes_v2.pdf">Physically-Based Shading at Disney</a> (<a href="https://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_slides_v2.pdf">slides</a>), 2012, Brent Burley et al.<br>
One of the contribution of the<em> “Disney BRDF”</em> is its diffuse model. It compares several existing diffuse models with the measured data of the <a href="http://www.merl.com/brdf/">MERL database</a> (see earlier section) but, unsatisfied with their response, it proposes its own, empirical one. One of the features of that model is the retroreflection at grazing angles.<br>
I have read multiple times that this model is not energy conserving. Yet Disney uses it for offline rendering, which I assume is path tracing (?), so I am not sure of what is the impact of that decision.</li>
<li><a href="https://seblagarde.wordpress.com/2015/07/14/siggraph-2014-moving-frostbite-to-physically-based-rendering/">Moving Frostbite to Physically Based Rendering 3.0</a>, 2014, Sébastien Lagarde.<br>
The diffuse BRDF described is a normalized version of the Disney BRDF to make it energy conserving.</li>
<li><a href="http://research.tri-ace.com/Data/DesignReflectanceModel_notes.pdf">Designing Reflectance Models for New Consoles</a> (<a href="http://research.tri-ace.com/Data/DesignReflectanceModel_slides.pptx">slides</a>), 2014, Yoshiharu Gotanda.<br>
Gotanda explains here several weaknesses of the Oren-Nayar model for PBR (its geometry term is different than the one used for the specular term, and it’s not energy conserving), and proceeds to propose a modified version. Since there is no analytic solution, he suggests a fitted approximation.<br>
He also reminds his own improvement over Schlick’s Fresnel approximation, but concludes that both models fail for complex indices of refraction.</li>
<li><a href="https://www.gdcvault.com/play/1024478/PBR-Diffuse-Lighting-for-GGX">PBR Diffuse Lighting for GGX+Smith Microsurfaces</a>, 2017, Earl Hammon, Jr.<br>
This presentation tries to combine the Oren-Nayar diffuse model (originally a Gaussian normal distribution) with the GGX normal distribution. It studies the Smith geometry fonction (G), proposes a BRDF to use for testing with path tracing, and concludes with an approximation for a diffuse GGX.<br>
On a side note, a few final slides give some identities that are useful for shader optimization.</li>
</ul>

<p>One of the pillars of PBR is to make sure to respect the energy conservation law. When designing a BRDF, there shouldn’t be more energy out than comes in. This is especially important for path tracing to converge. The following links explain how to take that constraint into account.</p>
<ul>
<li><a href="http://www.rorydriscoll.com/2009/01/25/energy-conservation-in-games/">Energy Conservation In Games</a>, 2009, Rory Driscoll.<br>
Explains briefly the problem of energy conservation, and details how to obtain the normalization factor for diffuse Lambert. It’s a good example of how to get started.<br>
The comments discuss the case of the Phong and Blinn-Phong specular lobe.</li>
<li><a href="http://www.farbrausch.de/~fg/stuff/phong.pdf">Phong Normalization Factor derivation</a>, 2009, Fabian Giesen.<br>
Demonstrates the derivation to obtain the normalization factor for the Phong and Blinn-Phong specular lobe.</li>
<li><a href="http://www.thetenthplanet.de/archives/255">The Blinn-Phong Normalization Zoo</a>, 2011, Christian Schüler.<br>
Lists various normalization factors that exist for variants of Phong and Blinn-Phong.<br>
Also proposes a crude approximation for Cook-Torrance.</li>
<li><a href="http://www.reedbeta.com/blog/hows-the-ndf-really-defined/">How Is The NDF Really Defined?</a>, 2013, Nathan Reed.<br>
Explains conceptually what the Normal Distribution Function (NDF) is, and how this affects the region to integrate over for normalization.</li>
<li><a href="https://seblagarde.wordpress.com/2011/08/17/hello-world/">Adopting a physically based shading model</a>, 2011, Sébastien Lagarde et al.<br>
Starts by reminding a few normalization factors (Lambert, Phong and Blinn-Phong). Includes a quick paragraph on the factor to use to combine diffuse with specular.</li>
<li><a href="https://computergraphics.stackexchange.com/questions/2285/how-to-properly-combine-the-diffuse-and-specular-terms">How to properly combine the diffuse and specular terms?</a>, 2016, CG Stack Exchange.<br>
A question I candidly asked on how to combine diffuse and specular so the energy lost to specular is taken into account in the diffuse term.</li>
<li><a href="http://research.tri-ace.com/Data/DesignReflectanceModel_notes.pdf">Designing Reflectance Models for New Consoles</a> (<a href="http://research.tri-ace.com/Data/DesignReflectanceModel_slides.pptx">slides</a>), 2014, Yoshiharu Gotanda.<br>
The third section explains that a Fresnel term should be taken into account for the diffuse part, but also why this is problematic. This Fresnel term should take into account all microfacets, not only the perfect reflection ones that contribute to the specular component.<br>
This is an answer to my Stack Exchange question above.</li>
<li><a href="https://www.gdcvault.com/play/1024478/PBR-Diffuse-Lighting-for-GGX">PBR Diffuse Lighting for GGX+Smith Microsurfaces</a>, 2017, Earl Hammon, Jr.<br>
Among the other topics it covers, this presentation shows the derivation to normalize a BRDF.</li>
<li><a href="https://blog.selfshadow.com/publications/s2017-shading-course/dreamworks/s2017_pbs_dreamworks_notes.pdf">Physically Based Shading at DreamWorks Animation</a>, 2017, Feng Xie and Jon Lanz.<br>
In the appendix of these course notes, the derivation to normalize their fabric BRDF is shown.</li>
</ul>
<h2>Wrapped diffuse</h2>
<p>It is a common trick in video games to represent certain diffuse materials that have a lot of scattering with a custom diffuse that “wraps” around and brings light in the shadowed part. When PBR became popular, several people looked into how to make their wrapped diffuse PBR compliant.</p>
<ul>
<li><a href="http://blog.stevemcauley.com/2011/12/03/energy-conserving-wrapped-diffuse/">Energy-Conserving Wrapped Diffuse</a>, 2011, Steve McAuley.<br>
Like the title says, it presents an energy-conserving wrapped diffuse.</li>
<li><a href="http://blog.stevemcauley.com/2013/01/30/extension-to-energy-conserving-wrapped-diffuse/">Extension to Energy-Conserving Wrapped Diffuse</a>, 2013, Steve McAuley.<br>
Proposes a new, more generic, energy-conserving model for wrapped diffuse.</li>
<li><a href="https://blog.selfshadow.com/2011/12/31/righting-wrap-part-1/">Righting Wrap, part 1</a> and <a href="https://blog.selfshadow.com/2012/01/07/righting-wrap-part-2/">part 2</a>, 2011, Stephen Hill.<br>
The sibling of Steve McAuley’s article, shows how to use wrapped diffuse with spherical harmonics, and how to optimize from a naive 16 instructions implementation down to a tight 2 instructions one.</li>
</ul>
<h2>Multiple scattering</h2>
<p>A recently tackled problem is the energy loss due to ignoring multiple scattering. In many BRDF models, rays occluded by geometry are simply discarded. This tends to cause a noticeable darkening as roughness increases, visible in many of the charts showing material appearance for various roughnesses. However the trend is changing and this is why we see more and more references to the “furnace test”, which is a way to highlight energy loss.</p>
<ul>
<li><a href="https://eheitzresearch.wordpress.com/240-2/">Multiple-Scattering Microfacet BSDFs with the Smith Model</a>, 2016, Eric Heitz et al.<br>
I haven’t read that paper except for the abstract, but the reception it received indicates that it’s an important publication. Recently, <a href="https://twitter.com/CasualEffects/status/1207309423087095810">Morgan McGuire even said about it</a>:
<blockquote><p><em>“It is such a beautifully complete piece of work, a short, careful, and clear book on microfacets of the form that typically only arrives out of a complete Ph.D. thesis.”</em>.</p></blockquote>
<p>If I understand correctly, they extended the Smith model to take multiple scattering into account, and compared their results with a simulation, by raytracing a surface at the micro-facet level.<br>
Károly Zsolnai-Fehér of <em><a href="https://www.youtube.com/channel/UCbfYPyITQ-7l4upoX8nvctg">Two Minute Papers</a></em> did a <a href="https://www.youtube.com/watch?v=JtBTffVVa-c">video abstract of their paper</a>.</p></li>
<li><a href="https://blog.selfshadow.com/2018/05/13/multi-faceted-part-1/">A Multi-Faceted Exploration, part 1</a>, <a href="https://blog.selfshadow.com/2018/06/04/multi-faceted-part-2/">part 2</a>, <a href="https://blog.selfshadow.com/2018/08/05/multi-faceted-part-3/">part 3</a>, <a href="https://blog.selfshadow.com/2019/03/30/multi-faceted-part-4/">part 4</a>&nbsp; 2018-2019, Stephen Hill.<br>
This series of articles explores the feasibility of using in real-time rendering a model used by Sony Pictures Imageworks for offline rendering. <a href="https://blog.selfshadow.com/2018/05/13/multi-faceted-part-1/">The first part</a> explains and illustrates what the problem is. <a href="https://blog.selfshadow.com/2018/06/04/multi-faceted-part-2/">The second part</a> presents the solution from Heitz, and uses it as a ground truth reference, before presenting the Sony Pictures Imageworks solution and comparing the two. It then proposes an improvement of the latter. <a href="https://blog.selfshadow.com/2018/08/05/multi-faceted-part-3/">The third part</a> gives a brief and clear reminder of the idea behind the split integral technique from UE4 and others, and uses it to propose a further improvement by precomputing a 2D LUT (instead of a 3D one). <a href="https://blog.selfshadow.com/2019/03/30/multi-faceted-part-4/">The fourth part</a> details the precomputation step and shows the results in a WebGL demo.<br>
The series is not concluded yet, so I imagine one or more articles are coming.</li>
</ul>

<p>I haven’t explored this topic yet, but I bookmarked some publications that spent time on the topic.</p>
<ul>
<li><a href="https://www.guerrilla-games.com/read/killzone-shadow-fall-creating-art-tools-for-a-new-generation">Lighting of KillZone Shadowfall</a>, 2013, Michal Drobot.<br>
A part of the presentation is dedicated to area lights. It observes that point lights are inadequate for artists and that they tend to tweak roughness to compensate. It then briefly explains the technique, which consist in analytically integrating over the area light. Unfortunately the full derivation is not shown.</li>
<li><a href="https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf">Real Shading in Unreal Engine 4</a> (<a href="https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_slides.pdf">slides</a>), 2013, Brian Karis.<br>
A part covers the area lights. Like Drobot, Karis observes a tendency of artists to use roughness to compensate the small reflection highlight of point lights. The course notes list their requirements, some solutions that were considered (including Drobot’s) and why they were rejected. They then present a method based on a “representative point”, and how it applies to spherical lights and tube lights.</li>
<li><a href="https://eheitzresearch.wordpress.com/415-2/">Real-Time Polygonal-Light Shading with Linearly Transformed Cosines</a>, 2016, Eric Heitz et al.<br>
The current state of the art. This technique approximates physically based lighting from polygonal lights by transforming a cosine distribution (which is simpler to integrate) so it matches the BRDF properties. A demo with the code as well as a WebGL demo showing the result are provided.</li>
</ul>

<p>Many thanks to Calvin Simpson, Dimitri Diakopoulos, Jeremy Cowles, Jonathan Stone, Julian Fong, Sébastien Lagarde, Stefan Werner, Yining Karl Li and the computer graphics community at large for your contributions and suggestions of material to read.</p>
					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1412 -->

				
					
	<article id="post-1392">
		<!-- .entry-header -->

				<div>
			<p>Last week I was lucky enough to attend <a href="https://s2018.siggraph.org/conference/conference-overview/">SIGGRAPH 2018</a>, in Vancouver. My colleagues and I were presenting on a booth the work we had done, a VR story with a distinctive comic book look. I was also <a href="http://www.ctrl-alt-test.fr/2018/demoscene-session-at-siggraph-2018/">invited to participate to a panel session on demoscene</a>, where I shared some lessons learned while making the 64k intro <em><a href="http://www.ctrl-alt-test.fr/productions/h-immersion/">H – Immersion</a></em>. The event brought a certain sense of conclusion to this work, aside from filling me with inspiration and motivation to try new things.</p>
<p>It has been a long time since I last posted anything here. For the last two years the majority of my spare time went into making that 64k intro. In fact the last post, <em><a href="http://lousodrome.net/blog/light/2017/01/03/intersection-of-a-ray-and-a-cone/">“Intersection of a ray and a cone”</a></em>, was related to it. I was implementing volumetric lighting for the underwater scenes, and wanted to resolve cones of light with ray tracing, before marching inside those cones. LLB and I have talked about the creation process in two making-of articles: <em><a href="http://www.ctrl-alt-test.fr/2018/a-dive-into-the-making-of-immersion/">“A dive into the making of Immersion”</a></em>, and <em><a href="http://www.ctrl-alt-test.fr/2018/texturing-in-a-64kb-intro/">“Texturing in a 64kB intro”</a></em>.</p>
<p>During that time, a lot of new things have happened in the computer graphics community. It has been difficult to keep track of everything. The last topic I started experimenting with is point cloud and mesh capture from photos; I might expend on it here in the future. I also want to experiment with DIY motion capture. Anyway, it’s time to resume posting here.</p>
<p><iframe src="https://www.youtube.com/embed/27PN1SsXbjM" allowfullscreen="allowfullscreen" width="600" height="338" frameborder="0"></iframe></p>
					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1392 -->

				
					
	<article id="post-1264">
		<!-- .entry-header -->

				<div>
			<p>Some time ago I needed to solve analytically the intersection of a ray and a cone. I was surprised to see that there are not that many resources available; there are some, but not nearly as many as on the intersection of a ray and a sphere for example. Add to it that they all use their own notation and that I lack math exercise, after a bit of browsing I decided I needed to write a proof by myself to get a good grasp of the result.</p>
<p>So here goes, the solution to the intersection of a ray and a cone, in vector notation.</p>
<ol>
<li>We define a ray with its origin  and its direction as a unit vector .<br>
Any point  on the ray at a signed distance  from the origin of the ray verifies: .<br>
When  is positive  is in the direction of the ray, and when  is negative  is in the opposite direction.</li>
<li>We define a cone with its tip , its axis as a unit vector  in the direction of increasing radius, and  the half angle between the axis and the surface.<br>
Any point  on the cone verifies: </li>
<li>Finally we define  the intersection or the ray and the cone, and which we are interested in finding.</li>
</ol>
<p><img src="http://lousodrome.net/blog/wp-content/images/cone-ray-intersection.png" width="400" height="306"></p>
<p> verifies both equations, so we can write:</p>

<p>We can multiply the second equation by itself to work with it, then reorder things a bit.</p>


<p>Remember the mouthful earlier about  being in the direction of increasing radius? By elevating  to square, we’re making negative values of  positive: values of  beyond 90° become indistinguishable from values below 90°. This has the side effect of turning it into the equation of not one, but two cones sharing the same axis, tip and angle, but in opposite directions. We’ll fix that later.</p>
<p>We replace  with  and work the equation until we get a good old quadratic function that we can solve.</p>





<p>Reorder a bit:</p>

<p>There we go, we have our  equation, with:</p>

<p>From there, you know the drill: calculate the determinant  then depending on its value:</p>
<ul>
<li>If , the ray is not intersecting the cone.</li>
<li>If , the ray is intersecting the cone once at .</li>
<li>If , the ray is intersecting the cone twice, at  and .</li>
</ul>
<p>But wait! We don’t have one cone but two, so we have to reject solutions that intersect with the shadow cone.  must still verify , or simply, if : .</p>
<p>Note that there is also the corner case of the ray tangent to the cone and having an infinity of solutions to consider. I’ve completely swept it under the rug since it doesn’t matter in the context I was, but if it does to you, you’ve been warned about it. Also remember to check the sign of  to know whether  is in the direction of the ray. You may need to determine which of  or  you want to use, which depends on your use case. For example is your ray origin inside or outside of the cone?</p>
<hr>
<p>Now for a little sanity test, let’s consider the corner case , where the ray origin is the tip of the cone (thanks Rubix for the suggestion!). We have  and  thus  and  which is the expected result.</p>
<p>I also tried the cases  and , but expanding  proved too tedious to proceed to the end. So this is left as an exercise, as they say. :)</p>
<hr>
<p>Finally, to demonstrate that the result is indeed correct, here is a glorious ray traced cone scene on ShaderToy:</p>

<p>I hope this can prove useful to others too.</p>
<p>Oh, and Happy New Year by the way!</p>
					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1264 -->

				
					
	<article id="post-1256">
		<!-- .entry-header -->

				<div>
			<p>In this 2014 talk, one of the designers of the original <a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM processor</a>, <a href="https://en.wikipedia.org/wiki/Sophie_Wilson">Sophie Wilson</a>, gives an overview of the history of processors and what to expect in future.</p>
<p>The presentation covers in layman’s terms topics like Moore’s law (obviously), <a href="https://en.wikipedia.org/wiki/Instruction_pipelining">pipelining</a>, <a href="https://en.wikipedia.org/wiki/Amdahl's_law">parallelism</a>, power consumption, heat dissipation, processor specialization and cost of production among other things. As explained, all those aspects are facing difficult challenges that are likely to shape the future of microprocessors, which in turns impacts both hardware and software engineers.</p>
<p><iframe width="500" height="281" src="https://www.youtube.com/embed/b5j_Y-ML3dg" frameborder="0" allowfullscreen=""></iframe></p>
<p>Here is the same presentation in 2016:</p>
<p><iframe width="500" height="281" src="https://www.youtube.com/embed/_9mzmvhwMqw" frameborder="0" allowfullscreen=""></iframe></p>
					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1256 -->

				
					
	<article id="post-1247">
		<!-- .entry-header -->

				<div>
			<p>Following yesterday’s post about a music video featuring modern dance and computer visual effects, here is a video featuring classical dance and a robot controlled camera.</p>
<p><iframe src="https://player.vimeo.com/video/96039099" width="500" height="281" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></p>
<p><a href="https://en.wikipedia.org/wiki/Francesca_da_Rimini">Francesca Da Rimini</a> was a historical figure portrayed in the Divine Comedy and numerous works of art, including a <a href="https://en.wikipedia.org/wiki/Francesca_da_Rimini_%28Tchaikovsky%29">symphonic poem by Tchaikovsky</a>. In 2014 the director Tarik Abdel-Gawad and his team recorded a performance by two dancers of the <a href="https://www.sfballet.org/">San Francisco Ballet</a>,&nbsp;Maria Kochetkova and Joan Boada, using a robot controlled camera. Tarik was also the technical and creative director of the demonstration video featuring the same Bot&amp;Dolly robots (a company <a href="http://google-acquisitions.silk.co/page/Bot-%26-Dolly">acquired by Google in 2013</a>) and which turned viral, <a href="https://www.youtube.com/watch?v=lX6JcybgDFo">“Box”</a>.</p>
<p>In the accompanying back stage video, he explains how seeing dancers rehearse over and over gave him the idea of experimenting with a pre-programmed robot, in order to make the camera part of the choregraphy, and allow the viewer to have a closer, more intimate, view of the performance.</p>
<p><iframe src="https://player.vimeo.com/video/96030980" width="500" height="281" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></p>
					</div><!-- .entry-content -->
		
		<!-- .entry-meta -->
	</article><!-- #post-1247 -->

				
						<nav id="nav-below">
			<h3>Post navigation</h3>
			
			
		</nav><!-- #nav-above -->
	
			
			</div><!-- #content -->
		</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>