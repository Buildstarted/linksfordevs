<!DOCTYPE html>
<html lang="en">
<head>
    <title>
RUB-NDS/TLS-Padding-Oracles - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="RUB-NDS/TLS-Padding-Oracles - linksfor.dev(s)"/>
    <meta property="article:author" content="jurajsomorovsky"/>
    <meta property="og:description" content="New TLS Padding Oracles. Contribute to RUB-NDS/TLS-Padding-Oracles development by creating an account on GitHub."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/RUB-NDS/TLS-Padding-Oracles"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - RUB-NDS/TLS-Padding-Oracles</title>
<div class="readable">
        <h1>RUB-NDS/TLS-Padding-Oracles</h1>
        <p>
by jurajsomorovsky <br/>Reading time: 12-15 minutes        </p>
        <p><a href="https://github.com/RUB-NDS/TLS-Padding-Oracles">https://github.com/RUB-NDS/TLS-Padding-Oracles</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
        

      <div>
        <article itemprop="text">
<p>The TLS protocol provides encryption, data integrity, and authentication on the modern Internet. Despite the protocolâ€™s importance, currently-deployed TLS versions use obsolete cryptographic algorithms which have been broken using various attacks. One prominent class of such attacks is CBC padding oracle attacks. These attacks allow an adversary to decrypt TLS traffic by observing different server behaviors which depend on the validity of CBC padding.</p>
<p>We evaluated the Alexa Top Million Websites for CBC padding oracle vulnerabilities in TLS implementations and revealed vulnerabilities in 1.83% of them, detecting nearly 100 different vulnerabilities. These padding oracles stem from subtle differences in server behavior, such as responding with different TLS alerts, or with different TCP header flags.
We suspect the subtlety of different server responses is the reason these padding oracles were not detected previously.</p>
<h2>Full Technical Paper</h2>
<p>Robert Merget, Juraj Somorovsky, Nimrod Aviram, Craig Young, Janis Fliegenschmidt, JÃ¶rg Schwenk, Yuval Shavitt: <em>Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities.</em> USENIX Security 2019</p>
<p><a href="https://www.usenix.org/system/files/sec19-merget.pdf" rel="nofollow">Link</a></p>
<h2>Presentations</h2>
<ul>
<li>Blackhat Asia 2019. Zombie POODLE, GOLDENDOODLE, and How TLSv1.3 Can Save Us All. <a href="https://www.blackhat.com/asia-19/" rel="nofollow">website</a>, <a href="http://i.blackhat.com/asia-19/Fri-March-29/bh-asia-Young-Zombie-Poodle-Goldendoodle-and-How-TLSv13-Can-Save-Us-All.pdf" rel="nofollow">slides</a></li>
<li>Summer School on real-world crypto and privacy 2019. Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities. <a href="https://summerschool-croatia.cs.ru.nl/2019/" rel="nofollow">website</a>, <a href="https://summerschool-croatia.cs.ru.nl/2019/slides/somorovsky1.pdf" rel="nofollow">slides</a></li>
</ul>
<h2>Who Is Affected?</h2>
<p>Since the identification of different vendors is fairly difficult and requires the cooperation of the scanned websites, a lot of our vulnerabilities are not attributed yet. On this Github page, we collect the current status of the responsible disclosure process and give an overview of the revealed vulnerabilities.</p>
<p>The currently identified and fixed vulnerabilities are:</p>
<ul>
<li>OpenSSL. CVE-2019-1559. <a href="https://www.openssl.org/news/secadv/20190226.txt" rel="nofollow">OpenSSL Security Advisory: 0-byte record padding oracle</a></li>
<li>Citrix. CVE-2019-6485. <a href="https://support.citrix.com/article/CTX240139" rel="nofollow">TLS Padding Oracle Vulnerability in Citrix Application Delivery Controller (ADC) and NetScaler Gateway</a>.</li>
<li>F5. CVE-2019-6593. <a href="https://support.f5.com/csp/article/K10065173" rel="nofollow">TMM TLS virtual server vulnerability CVE-2019-6593</a>.</li>
<li>SonicWall SonicOs. CVE-2019-7477. <a href="https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2019-0003" rel="nofollow">SonicOS &amp; SonicOSv CBC Cipher TLS Padding Vulnerability</a>.</li>
<li>Oracle HTTP Server. <a href="https://www.oracle.com/technetwork/security-advisory/cpujul2019-5072835.html" rel="nofollow">Oracle Critical Patch Update Advisory - July 2019</a></li>
</ul>
<p>The disclosure process is still running with a handful of vendors. Some of them consider to disable or even completely remove CBC cipher suites from their products.</p>
<h2>Recommendations for TLS Implementations Developers</h2>
<p>If you are developing a TLS implementation, this is obviously a good reminder to review your CBC code and make sure it does not expose a padding oracle; obviously, this is easier said than done.
We therefore invite developers of TLS implementations to contact us in this matter. We will evaluate your implementation and if you are vulnerable, work with you to understand the nature of the vulnerability (<a href="https://www.nds.ruhr-uni-bochum.de/chair/people/merget/" rel="nofollow">contact</a>).</p>
<p>You can now also use our <a href="https://github.com/RUB-NDS/TLS-Scanner">TLS-Scanner</a> directly to evaluate your implementation. TLS-Scanner also includes a vulnerability fingerprint, which allows you to detect the underlying vulnerable implementation, see an example below.</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/RUB-NDS/TLS-Padding-Oracles/blob/master/img/fingerprint.png"><img src="https://github.com/RUB-NDS/TLS-Padding-Oracles/raw/master/img/fingerprint.png" alt="TLS vulnerability fingerprint"></a></p>
<p>If you find a vulnerable implementation, which is not known to our tool, please contact us.</p>
<h2>Background</h2>
<h3>Cipher Block Chaining (CBC) mode of operation</h3>
<p>The CBC mode of operation allows one to encrypt plaintexts of arbitrary length with block ciphers like AES or 3DES. In CBC mode, each  plaintext  block  is  XORâ€™ed  to  the  previous  ciphertext block before being encrypted by the block cipher. We simply refer to <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC" rel="nofollow">Wikipedia</a> for more information.</p>
<p>Padding oracle attacks exploit the CBC  malleability. The problem of CBC is that it allows  an  attacker to perform meaningful plaintext modifications without knowing the symmetric key. More concretely, it allows an attacker to flip a specific plaintext bit by flipping a bit in the previous ciphtertext block. This CBC property has already been exploited in many attacks, for example, most recently in the <a href="https://efail.de/" rel="nofollow">Efail attack</a>.</p>
<h3>CBC and its usage in the TLS record layer</h3>
<p>In order to protect messages (records) exchanged between TLS peers, it is possible to use different cryptographic primitives. One of them is a MAC combined with AES in CBC mode of operation. Unfortunately, TLS decided to use the MAC-then-PAD-then-Encrypt mechanism, which means that the encryptor first computes a MAC over the plaintext, then pads the message to achieve a multiple of block length, and finally uses AES-CBC to encrypt the ciphertext.</p>
<p>For example, if we want to encrypt five bytes of data and use HMAC-SHA (with 20 bytes long output), we end up with two blocks. The second block needs to be padded with 7 bytes 0x06.
<a target="_blank" rel="noopener noreferrer" href="https://github.com/RUB-NDS/TLS-Padding-Oracles/blob/master/img/valid-mac-padding.png"><img src="https://github.com/RUB-NDS/TLS-Padding-Oracles/raw/master/img/valid-mac-padding.png" alt="Validly formatted MAC and padding"></a></p>
<h3>Padding oracle attacks</h3>
<p>In 2002, Vaudenay showed that revealing padding failures after message decryption could have severe consequences for the security of the application. Since the CBC malleability allows an attacker to flip arbitrary message bytes, the attacker is also able to modify specific padding bytes. If the application decrypts the modified message and reports problems related to padding validity, the attacker is able to learn the underlying plaintext. We refer to <a href="https://www.youtube.com/watch?v=VQRHSecu_aw&amp;feature=youtu.be&amp;t=1033" rel="nofollow">this explanation by Erlend Oftedal</a> for more details.</p>
<p>In TLS, the attack is a bit more complex because the targeted TLS connection is always closed once invalid padding is triggered. Nevertheless, the vulnerability is practically exploitable in <a href="https://nerdoholic.org/uploads/dergln/beast_part2/ssl_jun21.pdf" rel="nofollow">BEAST</a> scenarios and allows the attacker to decrypt repeated secrets like session cookies.</p>
<p>Therefore, it is very important that the TLS implementations do not reveal any information about padding validity. This includes different TLS alerts, connection states, or even timing behavior.</p>
<h2>Vulnerability Details</h2>
<h3>OpenSSL (CVE-2019-1559)</h3>
<p>With  the  help  of  the  Amazon  security  team,  we  identified  a  vulnerability which was mostly found on Amazon servers and  Amazon  Web  Services  (AWS).  Hosts  affected  by  this vulnerability  immediately  respond  to  most  records  with BAD_RECORD_MAC and CLOSE_NOTIFY alerts, and then close the connection. However, if  the  hosts  encounter  a  zero-length record with valid padding and a MAC present, they do not immediately close the TCP connection, regardless of the validity of the MAC. Instead, they keep the connection alive for  more  than  4  seconds  after  sending  the CLOSE_NOTIFY alert.  This difference in behavior is easily observable over the network.  Note that the MAC value does not need to be correct for triggering this timeout,  it is sufficient to create valid padding which causes the decrypted data to be of zero length.</p>
<p>Further  investigations  revealed  that  the  Amazon  servers were running an implementation which uses the OpenSSL 1.0.2 API. In some cases, the function calls to the API return different error codes depending on whether a MAC or padding error occurred.  The Amazon application then takes different code paths based on these error codes, and the different  paths  result  in  an  observable  difference  in  the  TCP layer. The vulnerable behavior only occurs when AES-NI is not used.</p>
<h3>Citrix (CVE-2019-6485)</h3>
<p>The vulnerable Citrix implementations first check the last padding byte and then verify the MAC. If the MAC is invalid, the server closes the connection.   This  is  done  with  either  a  connection  timeout  or  an RST,  depending  on  the  validity  of  the  remaining  padding bytes. However,  if the MAC is valid, the server checks whether all  other  remaining  padding  bytes  are  correct. If  they  are not,  the  server  responds  with  a BAD_RECORD_MAC and an RST (if they are valid, the record is well-formed and is accepted). This behavior can be exploited with an attack similar to POODLE.</p>
<h2>FAQ</h2>
<h3>Can these vulnerabilities be exploited?</h3>
<p>Yes, but exploitation is fairly difficult. If you use one of the above implementations, you should still make sure you have patched.</p>
<p>To be more specific, the attack can be exploited in <a href="https://nerdoholic.org/uploads/dergln/beast_part2/ssl_jun21.pdf" rel="nofollow">BEAST</a> scenarios. There are two prerequisites for the attack. First, the attacker must be able to run a script in the victim's browser which sends requests to a vulnerable website. This can be achieved tempting the victim to visit a malicious website. Second, the attacker must be able to modify requests sent by the browser and observe the server behavior. The second prerequisite is much harder to achieve, because the attacker must be an active Man-in-the-Middle.</p>
<h3>Have these vulnerabilities actually been exploited?</h3>
<p>We have no reason to believe these vulnerabilities have been exploited in the wild so far.</p>
<h3>I used a vulnerable implementation. Do I need to revoke my certificate?</h3>
<p>No, this attack does not recover the server's private key.</p>
<h3>Do I need to update my browser?</h3>
<p>No. These are server-side vulnerabilities, and can only be fixed by deploying a fix on the server.</p>
<h3>How many implementations are vulnerable?</h3>
<p>Our Alexa scans identified more than 90 different server behaviors triggered in our padding oracle scans. Some of them will probably be caused by outdated servers. However, we assume many of the newest servers will need fixes.</p>
<h3>How is this related to previous research?</h3>
<p>In 2002, Vaudenay presented an
<a href="https://link.springer.com/content/pdf/10.1007/3-540-46035-7_35.pdf" rel="nofollow">attack</a>
which targets messages encrypted with the CBC mode of operation. The attack exploits the malleability of the CBC mode, which allows altering the ciphertext such that specific cleartext bits are flipped, without knowledge of the encryption key. The attack requires a server that decrypts a message and responds with 1 or 0 based on the message validity. This behavior essentially provides the attacker with a cryptographic oracle which can be used to mount an adaptive chosen-ciphertext attack. The attacker exploits this behavior to decrypt messages by executing adaptive queries. Vaudenay exploited a specific form of vulnerable behavior, where implementations validate the CBC padding structure and respond with 1 or 0 accordingly.</p>
<p>This class of attacks has been termed padding oracle attacks. Different types of CBC padding oracles have been used to break the confidentiality of TLS connections. These include
<a href="http://www.isg.rhul.ac.uk/tls/TLStiming.pdf" rel="nofollow">Lucky Thirteen</a>,
<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.738.4741&amp;rep=rep1&amp;type=pdf" rel="nofollow">Lucky Microseconds</a>,
<a href="http://v.wpi.edu/wp-content/uploads/Papers/Publications/asiaccs2015_lucky.pdf" rel="nofollow">Lucky 13 Strikes Back</a>,
and <a href="https://eprint.iacr.org/2018/747.pdf" rel="nofollow">Ronen et al</a>.</p>
<p>Another important attack is <a href="https://www.openssl.org/~bodo/ssl-poodle.pdf" rel="nofollow">POODLE</a> (Padding Oracle On Downgraded Legacy Encryption) which targets SSLv3 and its specific padding scheme. In SSLv3 only the last padding byte is checked. MÃ¶ller, Duong and Kotowicz exploited this behavior and showed that for implementation it is necessary to correctly verify <em>all</em> padding bytes. Similar behaviors were found in several TLS implementations.</p>
<h3>How is it possible that such an old vulnerability is still present in 2019?</h3>
<p>Writing this code correctly is very hard, even for experts.
For example, in one instance experts have introduced
<a href="https://www.nds.ruhr-uni-bochum.de/media/nds/veroeffentlichungen/2016/10/19/tls-attacker-ccs16.pdf" rel="nofollow">a severe form of this vulnerability</a>
while attempting to patch the code to eliminate it.</p>
<p>Identifying these vulnerabilities is also hard since some of them only manifest under a combination of specific conditions. For example, the OpenSSL vulnerability only manifests in OpenSSL version 1.0.2, only for non-stitched [1] cipher suites, when AES-NI is not used.
It also requires subtle interactions between external code that calls the OpenSSL API, and the OpenSSL code itself.</p>
<p>We take this opportunity to suggest deprecating CBC cipher suites in TLS altogether.</p>
<p>[1]: Stitched ciphersuites is an OpenSSL term for optimised implementations of certain commonly used ciphersuites.
See <a href="https://software.intel.com/en-us/articles/improving-openssl-performance" rel="nofollow">here</a> for more details.</p>
<h3>Why are you not submitting your findings via BugBounty websites?</h3>
<p>We tried to get in contact with security teams via common BugBounty sites but had very bad experiences. Man-in-the-Middle attacks are usually out of scope for most website owners, and security teams did not know how to deal with this kind of issue. We lost a lot of "Points" on Hackerone and BugCrowd for reporting such issues (with the intention to learn the vendor) and learned absolutely nothing by doing this. All in all a very frustrating experience. We hope that our new approach of disclosure is more useful to get in contact with developers and vendors.</p>
<h3>Can this attack be used against Bitcoin?</h3>
<p>No. This attack is based on the vulnerability present in the Cipher Block Chaining (CBC) mode of operation. Bitcoin does not use CBC. However, if you are a blockchain designer, we strongly recommend you to evaluate the security of your block chaining technology and, especially, its padding scheme.</p>
<h3>Do you have a name or a logo for this vulnerability?</h3>
<p>No. Sorry, not this time.</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>