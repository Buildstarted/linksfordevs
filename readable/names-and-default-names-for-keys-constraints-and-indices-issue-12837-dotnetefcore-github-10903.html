<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Names and default names for keys, constraints and indices &#xB7; Issue #12837 &#xB7; dotnet/efcore - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Names and default names for keys, constraints and indices &#xB7; Issue #12837 &#xB7; dotnet/efcore - linksfor.dev(s)"/>
    <meta property="article:author" content="roji"/>
    <meta property="og:description" content="While working on #12821, I noticed some that may merit some discussion. When scaffolding, RelationalScaffoldingModelFactory checks the database name for keys, constraints and indices, comparing the..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/aspnet/EntityFrameworkCore/issues/12837"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Names and default names for keys, constraints and indices &#xB7; Issue #12837 &#xB7; dotnet/efcore</title>
<div class="readable">
        <h1>Names and default names for keys, constraints and indices &#xB7; Issue #12837 &#xB7; dotnet/efcore</h1>
            <div>by roji</div>
            <div>Reading time: 15-18 minutes</div>
        <div>Posted here: 26 Mar 2019</div>
        <p><a href="https://github.com/aspnet/EntityFrameworkCore/issues/12837">https://github.com/aspnet/EntityFrameworkCore/issues/12837</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-channel="marked-as-read:issue:345507594">

              
<div data-gid="MDU6SXNzdWUzNDU1MDc1OTQ=" data-url="/_render_node/MDU6SXNzdWUzNDU1MDc1OTQ=/issues/body" data-channel="issue:345507594">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issue-345507594">
  <div data-body-version="a0a985de6b1d08fab6110a33dbcdbdaf" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>While working on <a data-error-text="Failed to load issue title" data-id="345098317" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/12821" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/12821/hovercard" href="https://github.com/dotnet/efcore/issues/12821">#12821</a>, I noticed some that may merit some discussion.</p>
<p>When scaffolding, RelationalScaffoldingModelFactory checks the database name for keys, constraints and indices, comparing them against the default name EF Core would assign to this index. The idea is presumably to avoid useless scaffolding <code>HasName()</code> calls which would bloat <code>OnModelCreating()</code>.</p>
<p>Now, at least in the PostgreSQL case (but I think also the others), a name is always returned for keys/constraints/indices. PostgreSQL has its own defaults: primary keys that haven't been explicitly named are called <code>{table}_pkey</code>, etc. This means that for a typical database that has been created without specifying names, <code>HasName()</code> will be scaffolded everywhere because the PostgreSQL defaults aren't the same as the EF Core defaults (<code>PK_{table}</code>).</p>
<p>There seem to be two options:</p>
<ul>
<li>Current behavior: always take the name reported by the database. This bloats <code>OnModelCreating()</code> with <code>HasName()</code> calls on every single key, constraint and index. But it does have the advantage of round-trippability (exact names are preserved from the scaffolded database).</li>
<li>Alternative behavior: have the database model factories omit names when those names are the database defaults, leading to null names and less <code>HasName()</code> everywhere. Since EF Core must specify names when creating keys/indices, it would see nullls and default create indexes and keys with its own defaults.</li>
</ul>
<p>Basically it's a choice between round-trippability (current behavior) and a leaner <code>OnModelCreating()</code>. I'm not sure to what extent the former is an actual goal.</p>
<p>What do you guys think?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>

</div>


              

  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODkzODU0Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODkzODU0Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwODkzODU0Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers"><img height="40" width="40" alt="@ajcvickers" src="https://avatars0.githubusercontent.com/u/1430078?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-408938546">
    <div>
      

  

<details data-body-version="eda5025ecd9ea061faf7e9a04ad79563">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="eda5025ecd9ea061faf7e9a04ad79563" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji">@roji</a> If I remember rightly, I think the idea was that the names generated by EF by default for PostgreSQL would match the "most common convention" for names created in that database. It sounds like for PostgreSQL this would be to match the names that the database will use if no name is provided.</p>
<p>However, it would be a breaking change to start generating the names in this way now, in that a new migration would be generated to rename all the constraints to their new values. We will discuss in triage what options there might be here.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODk3MzcyNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODk3MzcyNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwODk3MzcyNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers"><img height="40" width="40" alt="@ajcvickers" src="https://avatars0.githubusercontent.com/u/1430078?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-408973725">
    <div>
      

  

<details data-body-version="3f4f9a0ccd461ca2fffe4f6dbbf5a3ba">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODk3OTAwMQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwODk3OTAwMQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwODk3OTAwMQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-408979001">
    <div>
      

  

<details data-body-version="299c4cd24f55a9c060e5e9d3acc90357">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="299c4cd24f55a9c060e5e9d3acc90357" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I see... If I read the code right, that isn't possible currently, is it? I mean, the default name generation seems to be static methods which the providers cannot override etc.</p>
<p>Regardless yeah, it would be a breaking change but it definitely seems like the most correct way to deal with this... Maybe for 3.0?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTI5Njk2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTI5Njk2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwOTI5Njk2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers"><img height="40" width="40" alt="@ajcvickers" src="https://avatars0.githubusercontent.com/u/1430078?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-409296966">
    <div>
      

  

<details data-body-version="7183e9c5d3c8c9e4194d48667583610b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="7183e9c5d3c8c9e4194d48667583610b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji">@roji</a> I looked into this code and we effectively broke the extensiblity model here when we simplified the service provider and model building process in 2.0--dumping "one model to rule them all". This is definitely something we should look at for 3.0.</p>
<p>We also discussed this in triage, and I believe there is a desire to be able to reverse engineer in two ways:</p>
<ul>
<li>To a model that contains all information needed to then continue managing that database with Migrations. This mode would require thinks like constraint names to be included.</li>
<li>To a model that will only be used by the EF runtime and therefore can be smaller because it doesn't include things that EF doesn't care about.</li>
</ul>
<p><a data-hovercard-type="user" data-hovercard-url="/users/bricelam/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/bricelam">@bricelam</a> is going to link issues related to this. I don't think we have decided exactly how APIs, switches, etc will look, nor what the default will be.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTI5OTYwNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTI5OTYwNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwOTI5OTYwNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ"><img height="40" width="40" alt="@ErikEJ" src="https://avatars0.githubusercontent.com/u/4169187?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-409299604">
    <div>
      

  

<details data-body-version="a78e97fe632d433f401f7918b82601c4">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a78e97fe632d433f401f7918b82601c4" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I only care about: "To a model that will only be used by the EF runtime and therefore can be smaller because it doesn't include things that EF doesn't care about."</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTMwNDY3Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTMwNDY3Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwOTMwNDY3Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-409304673">
    <div>
      

  

<details data-body-version="028c38ee55d445ee54901b1570658f5a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="028c38ee55d445ee54901b1570658f5a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I guess this is the right discussion to also think about round-trippability, which is related but not exactly identical to the first reverse-engineering "mode".</p>
<p>Personally having two different reverse-engineering modes (command-line switch?) seems a bit complicated too me, it will probably be difficult for users to understand etc. My gut feeling is that a bit of bloat in the model (stuff like constraint and index names) isn't that bad, or at least not bad enough to warrant a whole new mode. After all, if users don't care about that stuff they can just manually delete it from the model (although if you're working on "iterative" reverse-engineering to continue to update models that might get tricky as false changes get detected).</p>
<p>Just my two cents...</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTMxMjAyMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTMxMjAyMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwOTMxMjAyMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/bricelam/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/bricelam"><img height="40" width="40" alt="@bricelam" src="https://avatars1.githubusercontent.com/u/1226749?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-409312023">
    <div>
      

  

<details data-body-version="f2d8ea94c3d6381dacb471f1e7802561">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="f2d8ea94c3d6381dacb471f1e7802561" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Some notes:</p>
<p>With <a data-error-text="Failed to load issue title" data-id="294863437" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/10890" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/10890/hovercard" href="https://github.com/dotnet/efcore/issues/10890">#10890</a> we could make the default reverse engineering experience not include constrint names. Part of <a data-error-text="Failed to load issue title" data-id="75644535" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/2167" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/2167/hovercard" href="https://github.com/dotnet/efcore/issues/2167">#2167</a> is to add a gesture to <code>Scaffold-Database</code> to indicate you want to start using Migrations with it; this would signal that we should reverse engineer things like constraint names. The update model from database feature probably doesn't need the names since it doesn't need to rename anything (it just re-scaffolds everything) and a structural comparison is probably sufficient.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTc0MDQyMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQwOTc0MDQyMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQwOTc0MDQyMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers"><img height="40" width="40" alt="@ajcvickers" src="https://avatars0.githubusercontent.com/u/1430078?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-409740422">
    <div>
      

  

<details data-body-version="47a1ca7c7a5af1b5720c5d1fe6d5dc70">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="47a1ca7c7a5af1b5720c5d1fe6d5dc70" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Triage: keeping this open for 3.0 to look at:</p>
<ul>
<li>Re-enabling extensibility point for provider default constraint names</li>
<li>Considering then what to do with the PostgreSQL provider, and possibly others--i.e. should they take a breaking change in 3.0?</li>
</ul>
<p>Other aspects discussed here are tracked by <a data-error-text="Failed to load issue title" data-id="294863437" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/10890" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/10890/hovercard" href="https://github.com/dotnet/efcore/issues/10890">#10890</a>, <a data-error-text="Failed to load issue title" data-id="75644535" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/2167" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/2167/hovercard" href="https://github.com/dotnet/efcore/issues/2167">#2167</a>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ1NzcyMDIyNw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ1NzcyMDIyNw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ1NzcyMDIyNw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers"><img height="40" width="40" alt="@ajcvickers" src="https://avatars0.githubusercontent.com/u/1430078?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-457720227">
    <div>
      

  

<details data-body-version="3edb068edbe74ae6880fea3dadfbcfb0">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="3edb068edbe74ae6880fea3dadfbcfb0" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji">@roji</a> to investigate what we should do here.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjU3MjEwMQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjU3MjEwMQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NjU3MjEwMQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/JonPSmith/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/JonPSmith"><img height="40" width="40" alt="@JonPSmith" src="https://avatars2.githubusercontent.com/u/4509872?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-476572101">
    <div>
      

  

<details data-body-version="56862a21ecb47aaf752c82badf287ea5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="56862a21ecb47aaf752c82badf287ea5" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Can I add something to this debate. In summary I would like the following two options added to reverse engineering:</p>
<ol>
<li>Have an option that includes the constraint names in the reverse engineering process</li>
<li>Add a feature like <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> <code>ExtraOnModelCreating</code> method that can be overridden in another partial class.</li>
</ol>
<p>My use case for asking for this is as follows:</p>
<p>I am reverse engineering a couple of my client's database which were created via SQL scripts. To ensure that any changes to the database (which happens often) the plan is to run a unit test in the build process that uses my <a href="https://github.com/JonPSmith/EfCore.TestSupport/wiki/9.-EfSchemaCompare">CompareEfSql</a> class to check that the EF Core's Model is still in step with the database it accesses. Because my CompareEfSql class checks everything it throws out errors because the primary key constraint names are not the same.</p>
<p>I could use <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> <a href="https://marketplace.visualstudio.com/items?itemName=ErikEJ.EFCorePowerTools" rel="nofollow">EF Core Power Tools</a> and use his <code>ExtraOnModelCreating</code> method to alter the primary keys using the approach <a href="https://andrewlock.net/customising-asp-net-core-identity-ef-core-naming-conventions-for-postgresql/" rel="nofollow">suggested by Andrew Lock</a> (I tried that and it worked great - Andrew's suggestion opens up some really useful features). The problem is the client wants a single command that they can run, which rules out EF Core Power Tools. I also have a big list of tables that should be scaffolded, so a command they can copy/paste is better.</p>
<p>Mt CompareEfSql tool has a feature to suppress errors so I can get around this, but I would prefer to either get the Primary Key constraint name to be set from the database, or (and!) have <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> overridable <code>ExtraOnModelCreating</code> method added to the created <code>OnModelCreating</code>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjY1NTgyMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjY1NTgyMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NjY1NTgyMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-476655820">
    <div>
      

  

<details data-body-version="beab048682275baf62b48489c400c70d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="beab048682275baf62b48489c400c70d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/JonPSmith/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/JonPSmith">@JonPSmith</a> as <a data-hovercard-type="user" data-hovercard-url="/users/ajcvickers/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajcvickers">@ajcvickers</a> <a href="https://github.com/aspnet/EntityFrameworkCore/issues/12837#issuecomment-408938546" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/12837/hovercard">wrote above</a>, we probably want to have EF generate default constraint names that match the database's default. In other words, if you don't explicitly set constraint names in a code model, a PostgreSQL database created from that model would have PostgreSQL default constraint names, while an SQL Server database would have SQL Server's default constraint names.</p>
<p>If we go this way, then reverse engineering would probably behave accordingly - a default constraint name wouldn't result in a <code>HasName()</code>. This would provide both round-trippability and a lean model.</p>
<p>Unless I'm mistaken, there's nothing in the above that prevents something like CompareEfSql from comparing an EF Core model to an existing database - as long as the tool interprets the lack of an explicit constraint name in the model as a database default. Providers would possibly expose logic for letting tools such as CompareEfSql know what the default name generation strategy is, allowing your tool to understand if a constraint name encountered in the database is a default name or not.</p>
<p>Note that all this isn't finalized, just my idea of where we may want to go.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjY3MDcxNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NjY3MDcxNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NjY3MDcxNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/JonPSmith/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/JonPSmith"><img height="40" width="40" alt="@JonPSmith" src="https://avatars2.githubusercontent.com/u/4509872?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-476670715">
    <div>
      

  

<details data-body-version="63670940d8d294042fa91649660be2be">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="63670940d8d294042fa91649660be2be" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Hi <a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji">@roji</a>,</p>
<p>Thanks for the quick feedback. Adding the constraint name if its not the default sound like a good idea and it would also solve my problem.</p>
<p>You might also consider what <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> does in his EF Core Power Tools, i.e. providing a method at the end of the <code>OnModelCreating</code> which calls an overridable method (<a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> - can you provide info. I only found it by using your tool and I couldn't find it in your docs). That just gives you lots of room for doing complex things.</p>
<p>One minor point. CompareEfSql uses the DbContext's <code>Model</code> property, with <code>entityType.GetIndexes()</code> to get the indexes and then <code>...Relational().Name</code> to get the constraint name. This always returns a constraint name - either the default or one provided by <code>HasName()</code>. That means I don't need to do anything in CompareEfSql special - it just works.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3Njc5NDEzNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3Njc5NDEzNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3Njc5NDEzNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-476794134">
    <div>
      

  

<details data-body-version="a82212ee91e0d110fbf6cd7dc3898695">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a82212ee91e0d110fbf6cd7dc3898695" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Thanks for the quick feedback. Adding the constraint name if its not the default sound like a good idea and it would also solve my problem.</p>
</blockquote>
<p>Great, I hope I'll get around to looking at this issue soon.</p>
<blockquote>
<p>You might also consider what <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> does in his EF Core Power Tools, i.e. providing a method at the end of the OnModelCreating which calls an overridable method (<a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> - can you provide info. I only found it by using your tool and I couldn't find it in your docs). That just gives you lots of room for doing complex things.</p>
</blockquote>
<p>I assume you're asking for this because you want to re-scaffoled an existing context from a database which has changed, and want to make sure some configuration isn't overwritten. If so, take a look at <a data-error-text="Failed to load issue title" data-id="329561653" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/12245" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/12245/hovercard" href="https://github.com/dotnet/efcore/issues/12245">#12245</a> which seems to be the same, but more in general, at <a data-error-text="Failed to load issue title" data-id="45309329" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/831" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/831/hovercard" href="https://github.com/dotnet/efcore/issues/831">#831</a> which is a more general approach to updating the model. This would definitely be out of scope for this issue.</p>
<blockquote>
<p>One minor point. CompareEfSql uses the DbContext's Model property, with entityType.GetIndexes() to get the indexes and then ...Relational().Name to get the constraint name. This always returns a constraint name - either the default or one provided by HasName(). That means I don't need to do anything in CompareEfSql special - it just works.</p>
</blockquote>
<p>I understand, but I'm not sure if that's the right behavior for default names. Imagine a model scaffolded from one database (e.g. SQL Server), used to create another (e.g. PostgreSQL); is seems ideal if the default constraint names from SQL Server are <em>not</em> scaffolded in any way, allowing PostgreSQL's default names to be used. In other words, in my current mental model (which may change) you would see null as the constraint name, and would need to reconstruct the database's default name, possibly with the provider's help.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3Njg4ODc0NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3Njg4ODc0NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3Njg4ODc0NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/smitpatel/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/smitpatel"><img height="40" width="40" alt="@smitpatel" src="https://avatars2.githubusercontent.com/u/1528107?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-476888745">
    <div>
      

  

<details data-body-version="9bd283f33594d9f03425b2bc194b6fe7">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzAxMjc4Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzAxMjc4Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NzAxMjc4Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji"><img height="40" width="40" alt="@roji" src="https://avatars1.githubusercontent.com/u/1862641?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-477012786">
    <div>
      

  

<details data-body-version="e9dc464e78b3f607f9f3e0e0c4b7122d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e9dc464e78b3f607f9f3e0e0c4b7122d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/smitpatel/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/smitpatel">@smitpatel</a> yeah, this is one reason this would be a breaking change. I'll think about this more in-depth and then we can discuss.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzA0NjI0Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzA0NjI0Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NzA0NjI0Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/JonPSmith/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/JonPSmith"><img height="40" width="40" alt="@JonPSmith" src="https://avatars2.githubusercontent.com/u/4509872?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-477046247">
    <div>
      

  

<details data-body-version="d5584081fd396498d096eef72276cde5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d5584081fd396498d096eef72276cde5" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/roji/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/roji">@roji</a>,</p>
<p>Thanks for the link to  <a data-error-text="Failed to load issue title" data-id="329561653" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/efcore/issues/12245" data-hovercard-type="issue" data-hovercard-url="/dotnet/efcore/issues/12245/hovercard" href="https://github.com/dotnet/efcore/issues/12245">#12245</a>, with <a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ">@ErikEJ</a> <code>OnModelCreatingPartial</code>. I do think that is a useful idea.</p>
<blockquote>
<p>I understand, but I'm not sure if that's the right behavior for default names. Imagine a model scaffolded from one database (e.g. SQL Server), used to create another (e.g. PostgreSQL); is seems ideal if the default constraint names from SQL Server are not scaffolded in any way, allowing PostgreSQL's default names to be used. In other words, in my current mental model (which may change) you would see null as the constraint name, and would need to reconstruct the database's default name, possibly with the provider's help.</p>
</blockquote>
<p>From my point of view EF Core's <code>Model</code> has to be database specific to be any use. It contains things like the <code>ColumnType</code>, <code>DefaultValueSql</code> and many more that have to be for the current database. I can't speak for others but I use <code>Model</code> to find out things about the database I'm trying to access, so it needs to reflect that database's schema.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzE2NDI0OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ3NzE2NDI0OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ3NzE2NDI0OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ErikEJ/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ErikEJ"><img height="40" width="40" alt="@ErikEJ" src="https://avatars0.githubusercontent.com/u/4169187?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-477164248">
    <div>
      

  

<details data-body-version="24d955732dc91fc7d0a7772589889299">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  




    
  


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MTQzNDE1Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MTQzNDE1Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MTQzNDE1Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/AndriySvyryd/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AndriySvyryd"><img height="40" width="40" alt="@AndriySvyryd" src="https://avatars3.githubusercontent.com/u/6539701?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-491434157">
    <div>
      

  

<details data-body-version="18cb5578ddee3b02b549849120a42814">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


    
  





<!-- Rendered timeline since 2019-05-10 14:34:10 -->



            </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>