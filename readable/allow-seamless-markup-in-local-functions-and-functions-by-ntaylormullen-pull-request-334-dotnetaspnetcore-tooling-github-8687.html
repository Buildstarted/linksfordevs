<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Allow seamless markup in local functions and @functions. by NTaylorMullen &#xB7; Pull Request #334 &#xB7; dotnet/aspnetcore-tooling - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Allow seamless markup in local functions and @functions. by NTaylorMullen &#xB7; Pull Request #334 &#xB7; dotnet/aspnetcore-tooling - linksfor.dev(s)"/>
    <meta property="article:author" content="NTaylorMullen"/>
    <meta property="og:description" content="New inline Html in code blocks:&#xA;&#xA;One thing to note: You can have your method declare its return type and then return null to enable the local functions/@functions methods to be used in implicit exp..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/aspnet/AspNetCore-Tooling/pull/334"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Allow seamless markup in local functions and @functions. by NTaylorMullen &#xB7; Pull Request #334 &#xB7; dotnet/aspnetcore-tooling</title>
<div class="readable">
        <h1>Allow seamless markup in local functions and @functions. by NTaylorMullen &#xB7; Pull Request #334 &#xB7; dotnet/aspnetcore-tooling</h1>
            <div>by NTaylorMullen</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 15 Mar 2019</div>
        <p><a href="https://github.com/aspnet/AspNetCore-Tooling/pull/334">https://github.com/aspnet/AspNetCore-Tooling/pull/334</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-commit-hovercards-enabled="">
        <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode">
    <main id="js-repo-pjax-container" data-pjax-container="">
      
<!-- base sha1: &quot;cfee40a19eb42f0c02365104c0a460e1025ad84c&quot; -->
<!-- head sha1: &quot;b1a640b9056eae57e68d8524d40e2687e4c7eec2&quot; -->

  




  









  


<div>
  <div>

    
    
  <div data-pjax="">
    
      <div data-prompt="signup">
    <div>
      <div>
        <h3>Join GitHub today</h3>
        <p>GitHub is home to over 40 million developers working together to host and review code, manage projects, and build software together.</p>
        <p><a data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;files signup prompt&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;SIGN_UP&quot;,&quot;originating_url&quot;:&quot;https://github.com/dotnet/aspnetcore-tooling/pull/334&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="ac809811161d75e9cf5e5fc113993c6f4a93c0ddf9caab8b8e65451758f85315" data-ga-click="(Logged out) Sign up prompt, clicked Sign up, text:sign-up" href="https://github.com/join?source=prompt-pr-show&amp;source_repo=dotnet%2Faspnetcore-tooling">Sign up</a>
      </p></div>
    </div>
  </div>



  


  <div>
    
  


      




    <h2>Conversation</h2>
    <div id="discussion_bucket" data-channel="pull_request:261368176:timeline">
      
<div>

  <div>
        <div data-quote-markdown=".js-comment-body" data-issue-and-pr-hovercards-enabled="" data-team-hovercards-enabled="">
      <div data-channel="marked-as-read:pull-request:261368176">

        



        

  


  
  


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE0ODIzMTM2">
  
      

<div>
  
<div id="pullrequestreview-214823136" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE0ODIzMTM2" data-channel="pull_request_review:214823136" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE0ODIzMTM2/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/NTaylorMullen/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NTaylorMullen"><img height="40" width="40" alt="@NTaylorMullen" src="https://avatars0.githubusercontent.com/u/2008729?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  



  
  



  
  



  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NjU4">
  
      

<div>
  
<div id="pullrequestreview-215327658" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NjU4" data-channel="pull_request_review:215327658" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NjU4/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/rynowak/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/rynowak"><img height="40" width="40" alt="@rynowak" src="https://avatars1.githubusercontent.com/u/1430011?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3Njc3">
  
      

<div>
  
<div id="pullrequestreview-215327677" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3Njc3" data-channel="pull_request_review:215327677" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3Njc3/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/rynowak/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/rynowak"><img height="40" width="40" alt="@rynowak" src="https://avatars1.githubusercontent.com/u/1430011?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzA0">
  
      

<div>
  
<div id="pullrequestreview-215327704" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzA0" data-channel="pull_request_review:215327704" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzA0/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/rynowak/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/rynowak"><img height="40" width="40" alt="@rynowak" src="https://avatars1.githubusercontent.com/u/1430011?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzMz">
  
      

<div>
  
<div id="pullrequestreview-215327733" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzMz" data-channel="pull_request_review:215327733" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MzI3NzMz/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/rynowak/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/rynowak"><img height="40" width="40" alt="@rynowak" src="https://avatars1.githubusercontent.com/u/1430011?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MTM4ODQ1">
  
      

<div>
  
<div id="pullrequestreview-215138845" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MTM4ODQ1" data-channel="pull_request_review:215138845" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1MTM4ODQ1/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/ajaybhargavb/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ajaybhargavb"><img height="40" width="40" alt="@ajaybhargavb" src="https://avatars2.githubusercontent.com/u/1579269?s=88&amp;v=4"></a>

</p>


    


    


    </div>
    
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1OTE5NDI3">
  
      

<div>
  
<div id="pullrequestreview-215919427" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1OTE5NDI3" data-channel="pull_request_review:215919427" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE1OTE5NDI3/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/rynowak/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/rynowak"><img height="40" width="40" alt="@rynowak" src="https://avatars1.githubusercontent.com/u/1430011?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        


</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0MjYxMzY4MTc2OmIxYTY0MGI5MDU2ZWFlNTdlNjhkODUyNGQ0MGUyNjg3ZTRjN2VlYzI=">
  
      <div>
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:159564733:commit:b1a640b9056eae57e68d8524d40e2687e4c7eec2" data-url="/dotnet/aspnetcore-tooling/pull/334/commits/b1a640b9056eae57e68d8524d40e2687e4c7eec2/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/NTaylorMullen/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NTaylorMullen">
          <img height="20" width="20" alt="@NTaylorMullen" src="https://avatars1.githubusercontent.com/u/2008729?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    <div>
      <pre>- Allow markup to exist in all code blocks. Prior to this change whenever we'd see nested curly braces we would do dumb brace matching to skip over any potentially risky code; now we treat every curly brace as an opportunity to intermingle Markup.
- One fix I had to introduce was now that functions blocks are parsed like `@{}` blocks I ran into cases where certain reserved keywords would get improperly parsed. This exposed a bug in our parsing where weâ€™d treat **class** and **namespace** as directives without a transition in a `@{}` block. For instance this:
```
@{
    class
}
```
would barf in the old parser by treating the `class` piece as a directive even though it did not have a transition. To account for this I changed our reserved directives to be parsed as directives instead of keywords (it's how they should have been parsed anyhow). This isn't a breaking change because the directive parsing logic is a subset of how keywords get parsed.

- One quirk this change introduces is a difference in behavior in regards to one error case. Before this change if you were to have `@if (foo)) { var bar = foo; }` the entire statement would be classified as C# and you'd get a C# error on the trailing `)`. With my changes we try to keep group statements together more closely and allow for HTML in unexpected or end of statement scenarios. So, with these new changes the above example would only have `@if (foo))` classified as C# and the rest as markup because the original was invalid.
- Added lots of tests,
- Modified the feature flag to maintain the old behavior when disabled.

<a data-error-text="Failed to load issue title" data-id="391250851" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/aspnetcore/issues/5110" data-hovercard-type="issue" data-hovercard-url="/dotnet/aspnetcore/issues/5110/hovercard" href="https://github.com/dotnet/aspnetcore/issues/5110">dotnet/aspnetcore#5110</a></pre>
    </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE2NTI3MjMx">
  
      

<div>
  
<div id="pullrequestreview-216527231" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE2NTI3MjMx" data-channel="pull_request_review:216527231" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjE2NTI3MjMx/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/NTaylorMullen/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NTaylorMullen"><img height="40" width="40" alt="@NTaylorMullen" src="https://avatars0.githubusercontent.com/u/2008729?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE1OlJlZmVyZW5jZWRFdmVudDIyMTc2NTg2MjQ=">
  
        
  <div id="event-2217658629">
  
  <div>

      <p>

      <a data-hovercard-type="user" data-hovercard-url="/users/NTaylorMullen/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NTaylorMullen"><img height="20" width="20" alt="@NTaylorMullen" src="https://avatars1.githubusercontent.com/u/2008729?s=60&amp;v=4"></a>
  <a data-hovercard-type="user" data-hovercard-url="/users/NTaylorMullen/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NTaylorMullen">NTaylorMullen</a>
  


      merged commit <a href="https://github.com/dotnet/aspnetcore-tooling/commit/5ffd84e56dd3d21b48d55feea5bc1493d0293fd1"><code>5ffd84e</code></a>
    into
    <span>
      <span title="dotnet/aspnetcore-tooling:master">
        <span>master</span>
      </span>
    </span></p><a href="https://github.com/dotnet/aspnetcore-tooling/pull/334#event-2217658629"><relative-time datetime="2019-03-20T17:38:51Z" title="Mar 20, 2019, 10:38 AM PDT">on Mar 20, 2019</relative-time></a>

      <p>
        9 checks passed
      </p>

      <div>
        
        <div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci
                </strong>
                Build #20190319.12 had test failures
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81598923">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (Code check)
                </strong>
                Code check succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254313">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (Linux debug)
                </strong>
                Linux debug succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254317">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (Linux release)
                </strong>
                Linux release succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254322">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (Windows debug)
                </strong>
                Windows debug succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254312">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (Windows release)
                </strong>
                Windows release succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81598781">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (macOS debug)
                </strong>
                macOS debug succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254320">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  AspNetCore-Tooling-ci (macOS release)
                </strong>
                macOS release succeeded
              </p>

                <p><a href="https://github.com/dotnet/aspnetcore-tooling/runs/81254325">Details</a>
            </p></div>
            <div>
              
              <p><strong>
                  license/cla
                </strong>
                All CLA requirements met.
              </p>

                <p><a href="https://cla.dotnetfoundation.org/aspnet/AspNetCore-Tooling?pullRequest=334">Details</a>
            </p></div>
        </div>
      </div>
  </div>
</div>



  




</div>






<!-- Rendered timeline since 2019-03-20 10:38:55 -->



      </div>

      
    </div>

</div>

    
</div>



    </div>
  </div>
  


  </div>


  </div>
</div>

    </main>
  </div>
  

  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>