<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Private Key Extraction from Qualcomm Hardware-backed Keystore -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Private Key Extraction from Qualcomm Hardware-backed Keystore</h1><div><div id="" class=""><h1 class="article-heading">Technical Advisory: Private Key Extraction from Qualcomm Hardware-backed Keystores</h1><h1>&nbsp;</h1><pre><code>Vendor: Qualcomm
Vendor URL: <a href="https://www.qualcomm.com/" target="_blank">https://www.qualcomm.com/</a>
Systems Affected: <a href="https://www.qualcomm.com/company/product-security/bulletins#_CVE-2018-11976" target="_blank">Listed here</a>
Author: Keegan Ryan 
CVE Identifier: CVE-2018-11976
Risk: Critical (Key extraction from secure world to normal world possible)
</code></pre><h2 id="summary">Summary</h2><p>A side-channel attack can extract private keys from certain versions of Qualcomm's secure keystore. Recent Android devices include a <a href="https://source.android.com/security/keystore" target="_blank"> hardware-backed keystore</a>, which developers can use to protect their cryptographic keys with secure hardware. On some devices, Qualcomm's TrustZone-based keystore leaks sensitive information through the branch predictor and memory caches, enabling recovery of 224 and 256-bit ECDSA keys. We demonstrate this by extracting an ECDSA P-256 private key from the hardware-backed keystore on the Nexus 5X.</p><p>More details are available in our <a title="paper" href="/globalassets/our-research/us/whitepapers/2019/hardwarebackedhesit.pdf" target="_blank">paper</a>.</p><h2 id="location">Location</h2><p>Elliptic curve point multiplication in Qualcomm's QSEE code.</p><h2 id="impact">Impact</h2><p>It is possible to extract certain ECDSA keys from the hardware-backed keystore. This could affect application developers who rely on the <a href="https://developer.android.com/training/articles/keystore#ExtractionPrevention" target="_blank"> extraction-prevention</a> of the keystore when authenticating a user on a particular device.</p><h2 id="details">Details</h2><p>Qualcomm's ECDSA implementation leaks sensitive data from the secure world to the normal world, enabling recovery of private keys. This should not be possible, since the hardware-backed keystore is supposed to prevent any sort of key extraction, even against an attacker who has fully compromised the Android OS.</p><p>Hardware-backed keystores often rely on ARM TrustZone for these protections. TrustZone splits execution on many cell phones and embedded devices into a secure world and a normal world; highly-sensitive data and code can be placed within a Trusted Execution Environment (TEE) in the secure world, and everything else, like the Android OS, can be run within the normal world. Even if an attacker exploits the normal world, the secrets remain safe in the secure world.</p><p>However, the two worlds often share the same microarchitectural structures, making side-channel attacks possible. We previously discussed how to perform side-channel attacks on TrustZone TEEs at <a href="https://www.youtube.com/watch?v=G8-3G_cep4M" target="_blank">34C3</a> and released <a href="/us/about-us/newsroom-and-events/blog/2017/december/34C3-Tool-Release-Cachegrab/" target="_blank">Cachegrab</a>, an open-source tool for these attacks. These attacks target both the memory caches and the branch predictor, and they reveal control-flow and data-flow information with greater temporal resolution, spatial resolution, and less noise than previous methods.</p><p>These techniques can be used to exploit the ECDSA signing in QSEE, Qualcomm's TEE implementation. Using Cachegrab, we can capture side-channel data that reveals the overall structure of Qualcomm's ECDSA implementation.</p><p><img title="Captured traces from full ECDSA Signature" alt="Using Cachegrab, we can capture side-channel data that reveals the overall structure of Qualcomm's ECDSA implementation" src="/contentassets/a7701186abb0443db89092400b0dfa33/full_ecdsa_1.png" height="600" width="2000"></p><p>Most of the ECDSA signing is spent in a multiplication loop which processes a per-signature <i>nonce</i>. If an attacker can recover just a few bits of information about this nonce, they can use existing analysis techniques to recover the full private key, successfully extracting it from the device.</p><p>We found two locations in the multiplication algorithm which leak information about the nonce. The first location is a table lookup operation, and the second is a conditional subtraction based on the last bit of the nonce. Both of these locations contain countermeasures against side-channel attacks, but due to the spatial and temporal resolution of our microarchitectural attacks, it is possible to overcome these countermeasures and distinguish a few bits of the nonce.</p><p><img title="Table lookup comparison" alt="We found two locations in the multiplication algorithm which leak information about the nonce. The first location is a table lookup operation." src="/contentassets/a7701186abb0443db89092400b0dfa33/lookup_2.png" height="600" width="1000"><img title="Last Bit BTB Comparison" alt="the second is a conditional subtraction based on the last bit of the nonce. Both of these locations contain countermeasures against side-channel attacks" src="/contentassets/a7701186abb0443db89092400b0dfa33/last_bit_3.png" height="600" width="1000"></p><p>These few bits are enough to recover 256-bit ECDSA keys. To prove that this is a viable attack, we demonstrate the full exploit against an unknown P-256 key in the hardware-backed keystore of the Nexus 5X.</p><p>A full explanation of the vulnerability, our methods, and the exploitation can be found in our new <a title="Hardware backed " href="/us/our-research/extracting-ecdsa-keys-from-qualcomms-trustzone/" target="_blank">paper</a>.</p><h2 id="recommendation">Recommendation</h2><p>Qualcomm has already designed and distributed a patch to address this issue. Ensure that your devices are running the most recent firmware version.</p><p>Android developers who use the keystore in their applications can also take advantage of the <a href="https://developer.android.com/training/articles/keystore#UserAuthentication" target="_blank"> user authentication requirements</a> and <a href="https://developer.android.com/training/articles/security-key-attestation" target="_blank">key attestation</a> offered by the keystore. These defense-in-depth mitigations increase the complexity of compromising keystore keys, making difficult-to-perform side-channel attacks even more challenging to pull off.</p><h2 id="communication">Vendor Communication</h2><ul><li><strong>March 19, 2018:</strong> Contact Qualcomm Product Security with issue; receive confirmation of receipt</li><li><strong>April, 2018:</strong> Request update on analysis of issue</li><li><strong>May, 2018:</strong> Qualcomm confirms the issue and begins working on a fix</li><li><strong>July, 2018:</strong> Request update on the fix; Qualcomm responds that the fix is undergoing internal review</li><li><strong>November, 2018:</strong> Request update on the timeline for disclosure; Qualcomm responds that customers have been notified in October, beginning a six-month carrier recertification process. Agree to April 2019 disclosure date.</li><li><strong>March, 2019:</strong> Discuss publication plans for April 23</li><li><strong>April, 2019:</strong> Share draft of paper with Qualcomm</li><li><strong>April 23, 2019:</strong> Public Disclosure</li></ul><h2 id="about">About NCC Group</h2><p>NCC Group is a global expert in cyber security and risk mitigation, working with businesses to protect their brand, value and reputation against the ever-evolving threat landscape. With our knowledge, experience and global footprint, we are best placed to help businesses identify, assess, mitigate and respond to the risks they face. We are passionate about making the Internet safer and revolutionizing the way in which organizations think about cybersecurity.</p><p><strong>Published date:</strong>&nbsp;23 April 2019
                                 </p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>