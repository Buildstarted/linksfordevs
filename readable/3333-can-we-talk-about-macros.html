<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Can we talk about macros? -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Can we talk about macros?</h1><div><div class="contents overflow-x-auto"><p class="readability-styled" style="display: inline;">
            I've been thinking about what macros in 4coder should be like, and I realize I have unanswered questions about what a macro system should do in a lot of cases.
</p><p><strong><span class="underline">The most basic use case</span></strong><br>If I have the code:
<br></p><div class="code"><table class="codeblocktable"><tbody><tr><td class="linenos"></td><td class="code"><div class="codeblock"><pre><span></span>    init_a_thingy(thingy_ctx, "Foo", 0, foo_func);
    init_a_thingy(thingy_ctx, "Bar", 0, bar_func);
    init_a_thingy(thingy_ctx, "Fiz", 1, foo_func);
    init_a_thingy(thingy_ctx, "Faz", 2, faz_func);
    init_a_thingy(thingy_ctx, "Bat", 1, bar_func);
    init_a_thingy(thingy_ctx, "Foo Big", 3, foo_func);
    init_a_thingy(thingy_ctx, "Bar Big", 3, bar_func);
    init_a_thingy(thingy_ctx, "Fiz Gigantic", 100, foo_func);
    init_a_thingy(thingy_ctx, "Faz Tiny", -1, faz_func);
    init_a_thingy(thingy_ctx, "Bat Goofy", 10, foo_func);
</pre></div></td></tr></tbody></table></div><p>And if I want to turn it into this code:
<br></p><div class="code"><table class="codeblocktable"><tbody><tr><td class="linenos"></td><td class="code"><div class="codeblock"><pre><span></span>    {"Foo", 0, foo_func,},
    {"Bar", 0, bar_func,},
    {"Fiz", 1, foo_func,},
    {"Faz", 2, faz_func,},
    {"Bat", 1, bar_func,},
    {"Foo Big", 3, foo_func,},
    {"Bar Big", 3, bar_func,},
    {"Fiz Gigantic", 100, foo_func,},
    {"Faz Tiny", -1, faz_func,},
    {"Bat Goofy", 10, foo_func,},
</pre></div></td></tr></tbody></table></div><p>Then I have a fairly basic use case for a macro system.  I should be able to record a macro for editing the first line and then apply it to all the lines.  So how does that process look for me as I literally type?
</p><ol><li>Navigate to the beginning of the line; this is important because when I don't want the recorded macro to start with some arbitrary navigation.</li><li>Begin macro recording.</li><li>Set Mark.</li><li>I-Search.
<br><br></li><li>Delete range.</li><li>Type { .</li><li>I-Search.
<br><br></li><li>Delete.</li><li>Delete.</li><li>Type } .</li><li>Type , .</li><li>Navigate to the the beginning of the next line.</li><li>Complete macro recording.</li></ol><p>This is not the case that confounds me, but it does raise an interesting question, which is "What is meant to happen when a macro replays a command that takes sub-inputs?"  It could either be that we only replay command streams, but then this basic use case would require the user to re-type ", enter, ), enter for each application of the macro.  Obviously the most useful thing would be to recreate the intention of the command.  In this case the intention of the those commands are to search for " and ), no question about that.  But now that I know there is some need to recreate the "intention" of each command, I can't help but wonder if I can come up with a case where I wouldn't know how 4coder should interpret the intention.
</p><p><strong><span class="underline">A case where I don't know how 4coder should interpret the intention</span></strong></p><p>It's a little bit hard to imagine the <em>use case</em> that would lead to an ambiguous user intention, not impossible, but it's easier to come up with the <em>input case</em> that is ambiguous, and maybe we can talk about the use case that gives rise to this later.
</p><ol><li>Navigate to a good anchor point (like before).</li><li>Begin macro recording.</li><li>I-Search to ( .</li><li>Navigate one character right.</li><li>Paste.</li><li>Type , .</li><li>Type &lt;space&gt; .</li><li>Navigate to the next good anchor point.</li><li>Finish macro recording.</li></ol><p>This could mean one of two things at the "Paste" command.  It could mean insert whatever string is currently at the top of the clipboard stack, which would be the easiest thing to implement.  It could also mean insert whatever string <em>was</em> at the top of the clipboard stack when the macro was recorded.  I could see the second being an easy expectation and even sometimes a useful thing to have available.
</p><p>If you're not convinced that this is ambiguous, then imagine sticking the output of paste into a sub-input to an I-Search, and then copy pasting something within the macro recording (forgive me for not writing out the beat for beat inputs for this case).
</p><p><strong><span class="underline">My question is</span></strong></p><p>What does everyone else think about macros?  In the case of the paste command how should things work?  I'm not exactly sure what the best way to generalize this concept is, but my theory is that this ambiguity is coming from indirection.  It is unclear when the macro system records a paste command whether the the intention was to record inserting the "value" pulled from the clipboard or inserting the "reference" to the clipboard.  So in the general case how should a macro system be implemented around these ambiguities?
        </p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>