<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using External Inputs in Azure Durable functions - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Using External Inputs in Azure Durable functions - linksfor.dev(s)"/>
    <meta property="article:author" content="damienbod"/>
    <meta property="og:description" content="This post shows how to implement an The state of the flow can be viewed using the statusQueryGetUri link. Links:"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Using External Inputs in Azure Durable functions</title>
<div class="readable">
        <h1>Using External Inputs in Azure Durable functions</h1>
            <div>by damienbod</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 07 Jul 2020</div>
        <p><a href="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/">https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

							<p>This post shows how to implement an <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/">Azure Durable function flow</a> with an external HTTP API input. The flow is started using a HTTP request, runs an activity, waits for the external input from a HTTP API which could be any Azure function input and then runs a second activity. The application is implemented using C# and uses Version 3 Azure functions.</p>
<p><strong>Code:</strong> <a href="https://github.com/damienbod/AzureDurableFunctions" rel="nofollow">https://github.com/damienbod/AzureDurableFunctions</a></p>
<p><strong>Azure Durable Functions</strong></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/">Azure Durable functions</a> provides a simple way of implementing workflows in a serverless architecture. Durable functions are built on top of Azure functions and supports chaining, Fan-out/fan-in, external inputs, stateful flows, eternal flows with excellent diagnostic and monitoring APIs. </p>
<p><strong>Durable function Orchestration</strong></p>
<p>Orchestrations connect the activities of workflows or sub orchestrations together. The flows can be stateful and are slightly uncharacteristic to normal application code execution. The code in the orchestration can be re-run many times, but the activities are only run once. The results of the activities are always returned. The orchestration function code must be deterministic. The orchestrations are durable and reliable. When the code is run the first time, it is not replaying and after this, the part of the code is replaying. This can be checked with the IsReplaying property of the IDurableOrchestrationContext context. Every time the orchestration is started, it uses an instance ID to connect to the future steps , past steps. You can provide your own instance ID or auto generate this.</p>
<p>Further docs can be found <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-orchestrations?tabs=csharp">here</a>.</p>
<div><div id="highlighter_269461"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p></td><td><div><p><code>using</code> <code>System.Collections.Generic;</code></p><p><code>using</code> <code>System.Threading.Tasks;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.DurableTask;</code></p><p><code>using</code> <code>Microsoft.Extensions.Logging;</code></p><p><code>using</code> <code>MyAzureFunctions.Model;</code></p><p><code>namespace</code> <code>MyAzureFunctions.Orchestrations</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>MyOrchestration</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[FunctionName(Constants.MyOrchestration)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>async</code> <code>Task&lt;MyOrchestrationDto&gt; RunOrchestrator(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[OrchestrationTrigger] IDurableOrchestrationContext context,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ILogger log)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>myOrchestrationDto = </code><code>new</code> <code>MyOrchestrationDto</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>InputStartData = context.GetInput&lt;</code><code>string</code><code>&gt;()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!context.IsReplaying)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogWarning($</code><code>"begin MyOrchestration with input {context.GetInput&lt;string&gt;()}"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>myActivityOne = </code><code>await</code> <code>context.CallActivityAsync&lt;</code><code>string</code><code>&gt;(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Constants.MyActivityOne, context.GetInput&lt;</code><code>string</code><code>&gt;());</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>myOrchestrationDto.MyActivityOneResult = myActivityOne;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code><code>(!context.IsReplaying)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogWarning($</code><code>"myActivityOne completed {myActivityOne}"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>myActivityTwoInputEvent = </code><code>await</code> <code>context.WaitForExternalEvent&lt;</code><code>string</code><code>&gt;(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Constants.MyExternalInputEvent);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>myOrchestrationDto.ExternalInputData = myActivityTwoInputEvent;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>myActivityTwo = </code><code>await</code> <code>context.CallActivityAsync&lt;</code><code>string</code><code>&gt;(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Constants.MyActivityTwo, myActivityTwoInputEvent);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>myOrchestrationDto.MyActivityTwoResult = myActivityTwo;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!context.IsReplaying)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogWarning($</code><code>"myActivityTwo completed {myActivityTwo}"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>myOrchestrationDto;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Durable function Activities</strong></p>
<p>Activities are normally only executed once for each run of a flow. The activity can use the IDurableActivityContext as an input parameter, or some typed parameter. You can only pass a single param to an activity. This is where you can implement the business of the flow. The orchestration glues this together. The result of the activity can be used many times, but the activity itself is only run once, unless using the ContinueAsNew method.</p>
<div><div id="highlighter_714062"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p></td><td><div><p><code>using</code> <code>Microsoft.Azure.WebJobs;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.DurableTask;</code></p><p><code>using</code> <code>Microsoft.Extensions.Logging;</code></p><p><code>namespace</code> <code>MyAzureFunctions.Activities</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>MyActivities</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[FunctionName(Constants.MyActivityOne)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>MyActivityOne([ActivityTrigger] IDurableActivityContext context, ILogger log)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>name = context.GetInput&lt;</code><code>string</code><code>&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogInformation($</code><code>"Activity {Constants.MyActivityOne} {name}."</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>$</code><code>"{Constants.MyActivityOne} {name}!"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[FunctionName(Constants.MyActivityTwo)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>MyActivityTwo([ActivityTrigger] IDurableActivityContext context, ILogger log)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>name = context.GetInput&lt;</code><code>string</code><code>&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogInformation($</code><code>"Activity {Constants.MyActivityTwo} {name}."</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>$</code><code>"{Constants.MyActivityTwo} {name}!"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>External Input</strong></p>
<p>External inputs in a workflow are extremely useful when waiting for an HTTP call, any UI user event, or any external events. A timer can be set to execute a separate flow result if the event is not called or completed within a certain time limit. This can be very useful. The example below is waiting for an API call with the instance ID and raises the event with the data intended for the flow. The orchestration would then continue with the next part of the flow using the data from this event code.</p>
<div><div id="highlighter_809650"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></td><td><div><p><code>using</code> <code>System.Threading.Tasks;</code></p><p><code>using</code> <code>Microsoft.AspNetCore.Mvc;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.Http;</code></p><p><code>using</code> <code>Microsoft.AspNetCore.Http;</code></p><p><code>using</code> <code>Microsoft.Extensions.Logging;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.DurableTask;</code></p><p><code>namespace</code> <code>MyAzureFunctions.Apis</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>ExternalHttpPostInput</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[FunctionName(Constants.ExternalHttpPostInput)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>async</code> <code>Task&lt;IActionResult&gt; Run(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[HttpTrigger(AuthorizationLevel.Anonymous, </code><code>"get"</code><code>, </code><code>"post"</code><code>, Route = </code><code>null</code><code>)] HttpRequest req,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[DurableClient] IDurableOrchestrationClient client,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ILogger log)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>instanceId = req.Query[</code><code>"instanceId"</code><code>];</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>status = </code><code>await</code> <code>client.GetStatusAsync(instanceId);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>await</code> <code>client.RaiseEventAsync(instanceId, Constants.MyExternalInputEvent, </code><code>"inputDataTwo"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogInformation(</code><code>"C# HTTP trigger function processed a request."</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>responseMessage = </code><code>string</code><code>.IsNullOrEmpty(instanceId)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>? </code><code>"This HTTP triggered function executed successfully. Pass an instanceId in the query string"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>: $</code><code>"Received, processing, {instanceId}"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>new</code> <code>OkObjectResult(responseMessage);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Start the flow with an HTTP API call</strong></p>
<p>The orchestration is started using the StartNewAsync method. The example starts this with a null for the instance ID so that a new ID is auto generated.</p>
<div><div id="highlighter_994692"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p></td><td><div><p><code>using</code> <code>System.Threading.Tasks;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.Http;</code></p><p><code>using</code> <code>Microsoft.Extensions.Logging;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.DurableTask;</code></p><p><code>using</code> <code>System.Net.Http;</code></p><p><code>namespace</code> <code>MyAzureFunctions.Apis</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>BeginFlowWithHttpPost</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[FunctionName(Constants.BeginFlowWithHttpPost)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>async</code> <code>Task&lt;HttpResponseMessage&gt; HttpStart(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[HttpTrigger(AuthorizationLevel.Anonymous, </code><code>"get"</code><code>, </code><code>"post"</code><code>)] HttpRequestMessage req,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[DurableClient] IDurableOrchestrationClient starter,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ILogger log)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>instanceId = </code><code>await</code> <code>starter.StartNewAsync(Constants.MyOrchestration, </code><code>null</code><code>, </code><code>"input data to start flow"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>log.LogInformation($</code><code>"Started orchestration with ID = '{instanceId}'."</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>starter.CreateCheckStatusResponse(req, instanceId);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>When the API is requested, the flow starts and the durable function details are returned. This would need to be changed in a production app, security would be required, only a post request should be supported and properly logging, diagnostics would need to be supported.</p>
<p><img data-attachment-id="14023" data-permalink="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/durable_azure_01/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png" data-orig-size="1039,615" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="durable_azure_01" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=640&amp;h=379" alt="" width="640" height="379" srcset="https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=640&amp;h=379 640w, https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=150&amp;h=89 150w, https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=600&amp;h=355 600w, https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=768&amp;h=455 768w, https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png?w=1024&amp;h=606 1024w, https://damienbod.files.wordpress.com/2020/07/durable_azure_01.png 1039w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>The state of the flow can be viewed using the statusQueryGetUri link.</p>
<p><img data-attachment-id="14024" data-permalink="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/durable_azure_02/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png" data-orig-size="1050,657" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="durable_azure_02" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=640&amp;h=400" alt="" width="640" height="400" srcset="https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=640&amp;h=400 640w, https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=150&amp;h=94 150w, https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=600&amp;h=375 600w, https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=768&amp;h=481 768w, https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png?w=1024&amp;h=641 1024w, https://damienbod.files.wordpress.com/2020/07/durable_azure_02.png 1050w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>After the external HTTP is called, the flow continues. The state is then updated, and the end result can be viewed, used in any way.</p>
<p><img data-attachment-id="14025" data-permalink="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/durable_azure_03/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png" data-orig-size="1118,767" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="durable_azure_03" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=640&amp;h=439" alt="" width="640" height="439" srcset="https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=640&amp;h=439 640w, https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=150&amp;h=103 150w, https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=600&amp;h=412 600w, https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=768&amp;h=527 768w, https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png?w=1024&amp;h=703 1024w, https://damienbod.files.wordpress.com/2020/07/durable_azure_03.png 1118w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p><strong>Links:</strong></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/" rel="nofollow">https://docs.microsoft.com/en-us/azure/azure-functions/durable/</a></p>
<p><a href="https://github.com/Azure/azure-functions-durable-extension" rel="nofollow">https://github.com/Azure/azure-functions-durable-extension</a></p>
<p><a href="https://damienbod.com/2019/03/14/running-local-azure-functions-in-visual-studio-with-https/" rel="nofollow">https://damienbod.com/2019/03/14/running-local-azure-functions-in-visual-studio-with-https/</a></p>
<p><a href="https://azure.microsoft.com/en-us/features/storage-explorer/">Microsoft Azure Storage Explorer</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-emulator">Microsoft Azure Storage Emulator</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local">Install the Azure Functions Core Tools</a></p>
<p><a href="https://nodejs.org/en/">NodeJS</a></p>
<p><a href="https://docs.microsoft.com/en-us/cli/azure/">Azure CLI</a></p>
<p><a href="https://azure.microsoft.com/en-us/downloads/">Azure SDK</a></p>
<p><a href="http://install%20the%20azure%20development%20extensions/">Visual Studio zure development extensions</a></p>

							
							
						</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>