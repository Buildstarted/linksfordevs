<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Blazor Shopping Cart Sample using Local Storage to Persist State &#x2014; App vNext - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Blazor Shopping Cart Sample using Local Storage to Persist State &#x2014; App vNext - linksfor.dev(s)"/>
    <meta property="article:author" content="Carl Franklin"/>
    <meta property="og:description" content="This little demo is based on a  Gist written by Steve Sanderson  where he shows how to persist state in the browser using sessionStorage. His demo shows how to persist the counter value but I wanted to try something a bit more real-world, a very simple shopping cart, and also to use  localStorage  r"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://www.appvnext.com/blog/2020/3/7/blazor-shopping-cart-sample-using-local-storage-to-persist-state"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Blazor Shopping Cart Sample using Local Storage to Persist State &#x2014; App vNext</title>
<div class="readable">
        <h1>Blazor Shopping Cart Sample using Local Storage to Persist State &#x2014; App vNext</h1>
            <div>by Carl Franklin</div>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 11 Mar 2020</div>
        <p><a href="http://www.appvnext.com/blog/2020/3/7/blazor-shopping-cart-sample-using-local-storage-to-persist-state">http://www.appvnext.com/blog/2020/3/7/blazor-shopping-cart-sample-using-local-storage-to-persist-state</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="yui_3_17_2_1_1583935064686_89">
      
      <div data-layout-label="Post Body" data-type="item" data-updated-on="1583640534037" id="item-5e646fd59369fa095302690e"><div id="yui_3_17_2_1_1583935064686_88"><div id="yui_3_17_2_1_1583935064686_87"><div data-block-type="2" id="block-17e571c7c57875f19c4e"><div><p>This little demo is based on a <a href="https://gist.github.com/SteveSandersonMS/ba16f6bb6934842d78c89ab5314f4b56" target="_blank">Gist written by Steve Sanderson</a> where he shows how to persist state in the browser using sessionStorage. His demo shows how to persist the counter value but I wanted to try something a bit more real-world, a very simple shopping cart, and also to use <a href="https://www.w3schools.com/html/html5_webstorage.asp" target="_blank">localStorage</a> rather than sessionStorage. <a href="https://drive.google.com/file/d/1olEdDc6F5JG6gnbWSW6jn_Zm23br9f6j/view?usp=sharing" target="_blank">You can download the project here</a>.</p><p>Here’s how it works. Select an item from the store (in this case a list). The details of that item are shown below the list. Enter a quantity and add it to your cart. The contents of your cart are shown below that, including the grand total. Now refresh the browser (or close and re-open). If you refresh within 30 seconds, your cart is still there. If you wait longer than 30 seconds before refreshing the browser, the cart data is no longer there.</p></div></div><div data-block-type="5" id="block-yui_3_17_2_1_1583860095592_15006"><div id="yui_3_17_2_1_1583935064686_86">
  
  

    
      <div id="yui_3_17_2_1_1583935064686_85">
      
        <div id="yui_3_17_2_1_1583935064686_84">
          
            <p><img data-src="https://images.squarespace-cdn.com/content/v1/56056b47e4b043d49b646e7e/1583860415129-5AOS8CF5V95UM3CJNDAC/ke17ZwdGBToddI8pDm48kJByspMdSfv7m9ZIGPyubZ4UqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYxCRW4BPu10St3TBAUQYVKc2vgkZ2QIgbTK1BQeV_tRCso9CWjtqas5JBrO9-S9udg7cgrhQsm4I6GTmRW-Icv4/image-asset.gif" data-image="https://images.squarespace-cdn.com/content/v1/56056b47e4b043d49b646e7e/1583860415129-5AOS8CF5V95UM3CJNDAC/ke17ZwdGBToddI8pDm48kJByspMdSfv7m9ZIGPyubZ4UqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYxCRW4BPu10St3TBAUQYVKc2vgkZ2QIgbTK1BQeV_tRCso9CWjtqas5JBrO9-S9udg7cgrhQsm4I6GTmRW-Icv4/image-asset.gif" data-image-dimensions="1024x638" data-image-focal-point="0.5,0.5" alt="" data-load="false" data-image-id="5e67cabd247a9f24d44bf840" data-type="image" data-image-resolution="750w" src="https://images.squarespace-cdn.com/content/v1/56056b47e4b043d49b646e7e/1583860415129-5AOS8CF5V95UM3CJNDAC/ke17ZwdGBToddI8pDm48kJByspMdSfv7m9ZIGPyubZ4UqsxRUqqbr1mOJYKfIPR7LoDQ9mXPOjoJoqy81S2I8N_N4V1vUb5AoIIIbLZhVYxCRW4BPu10St3TBAUQYVKc2vgkZ2QIgbTK1BQeV_tRCso9CWjtqas5JBrO9-S9udg7cgrhQsm4I6GTmRW-Icv4/image-asset.gif?format=750w">
            </p>
          

          

        </div>
      
      </div>
    

  


</div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_19056"><div><p>My top level class is called Cart. Every time you update the cart, the contents are serialized and stored in the browser’s local storage using a not-as-yet-released package, Microsoft.AspNetCore.ProtectedBrowserStorage. </p><p>I have added a couple fields to the Cart class to support expiration:</p></div></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_41957"><div id="yui_3_17_2_1_1583935064686_44"><pre>    <span><span>public</span></span> <span>DateTime</span> <span>LastAccessed</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
    <span><span>public</span></span> <span><span>int</span></span> <span>TimeToLiveInSeconds</span> { <span><span>get</span></span>; <span><span>set</span></span>; } <span>=</span> <span><span>30</span></span>; </pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_43208"><div><p>Whenever the Cart is persisted to localStorage, the LastAccessed time stamp is saved. When loading the cart from localStorage, a check is made to see if the cart has expired based on the LastAccessed and TimeToLiveInSeconds properties. I set it to 30 seconds by default so you could easily test it without having to wait around for a long period of time to elapse.</p><h2>The Code</h2><p>I created a Blazor Server project in Visual Studio 2019 called BlazorStateTest1.</p><p>Let’s start with the three models:</p></div></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_79558"><div id="yui_3_17_2_1_1583935064686_47"><pre>    <span><span>public</span></span> <span><span>class</span></span> <span><span>Product</span></span>
    {
        <span><span>public</span></span> <span><span>int</span></span> <span>Id</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
        <span><span>public</span></span> <span><span>string</span></span> <span>Name</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
        <span><span>public</span></span> <span><span>string</span></span> <span>Description</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
        <span><span>public</span></span> <span><span>decimal</span></span> <span>Price</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
    }
    
    <span><span>public</span></span> <span><span>class</span></span> <span><span>CartProduct</span></span>
    {
        <span><span>public</span></span> <span><span>int</span></span> <span>Quantity</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
        <span><span>public</span></span> <span>Product</span> <span>Product</span> { <span><span>get</span></span>; <span><span>set</span></span>; }

        <span><span>public</span></span> <span><span>decimal</span></span> <span>Total</span>
        {
            <span><span>get</span></span>
            {
                <span><span>return</span></span> <span>Product</span>.<span>Price</span> <span>*</span> <span>Quantity</span>;
            }
        }
    }
    
    <span><span>public</span></span> <span><span>class</span></span> <span><span>Cart</span></span> 
    {
        <span><span>public</span></span> <span>List</span><span>&lt;</span><span>CartProduct</span><span>&gt;</span> <span>Items</span> { <span><span>get</span></span>; <span><span>set</span></span>; } <span>=</span> <span><span>new</span></span> <span>List</span><span>&lt;</span><span>CartProduct</span><span>&gt;</span>();

        <span><span>public</span></span> <span>Decimal</span> <span>Total</span>
        {
            <span><span>get</span></span>
            {
                <span><span>decimal</span></span> <span>total</span> <span>=</span> (<span><span>decimal</span></span>)<span><span>0.0</span></span>;
                <span><span>foreach</span></span> (<span><span>var</span></span> <span>item</span> <span><span>in</span></span> <span>Items</span>)
                {
                    <span>total</span> <span>+=</span> <span>item</span>.<span>Total</span>;
                }
                <span><span>return</span></span> <span>total</span>;
            }
        }
        <span><span>public</span></span> <span>DateTime</span> <span>LastAccessed</span> { <span><span>get</span></span>; <span><span>set</span></span>; }
        <span><span>public</span></span> <span><span>int</span></span> <span>TimeToLiveInSeconds</span> { <span><span>get</span></span>; <span><span>set</span></span>; } <span>=</span> <span><span>30</span></span>; 
    }    </pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_81464"><div><p>At the very bottom of the food chain is Product. Simple enough. Then we have a CartProduct which represents a Product and Quantity, and has a Total property that multiplies the product price by the quantity.</p><p>Finally, the Cart object has a list of CartProducts and the aforementioned properties to support expiration. This is a greatly simplified shopping cart. The focus here should be on the persistence patterns. </p><p>Following Steve’s instruction, I added the Microsoft.AspNetCore.ProtectedBrowserStorage package to the project.</p><p>Next, I added this line to my ConfigureServices method in Startup.cs:</p></div></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_108888"><div id="yui_3_17_2_1_1583935064686_50"><pre>    <span><span>services</span></span><span>.</span><span><span>AddProtectedBrowserStorage</span></span>();</pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_110059"><p>Next, I created a component called CartStateProvider.razor to handle loading and saving the cart:</p></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_110757"><div id="yui_3_17_2_1_1583935064686_53"><pre>@<span>inject</span> <span>ProtectedLocalStorage</span> <span>ProtectedLocalStore</span>

@<span><span>if</span></span> (<span>hasLoaded</span>)
{
    <span>&lt;</span><span>CascadingValue</span> <span>Value</span><span>=</span><span><span>"@this"</span></span><span>&gt;</span>
        @<span>ChildContent</span>
    <span>&lt;</span><span>/CascadingValue&gt;</span>
}
<span><span>else</span></span>
{
    <span>&lt;</span><span>p</span><span>&gt;</span><span>Loading</span><span>...</span><span>&lt;</span><span>/p&gt;</span>
}

@<span>code</span> {

    [<span>Parameter</span>] 
    <span><span>public</span></span> <span>RenderFragment</span> <span>ChildContent</span> { <span><span>get</span></span>; <span><span>set</span></span>; }

    <span><span>public</span></span> <span>Cart</span> <span>ShoppingCart</span> { <span><span>get</span></span>; <span><span>set</span></span>; }

    <span><span>bool</span></span> <span>hasLoaded</span>;

    <span><span><span>protected</span></span></span><span> </span><span><span><span>override</span></span></span><span> </span><span><span><span>async</span></span></span><span> </span><span><span>Task</span></span><span> </span><span><span><span>OnParametersSetAsync</span></span></span><span>(<span></span>)
    </span>{
        
        <span>ShoppingCart</span> <span>=</span> <span><span>await</span></span> <span>ProtectedLocalStore</span>.<span>GetAsync</span><span>&lt;</span><span>Cart</span><span>&gt;</span>(<span><span>"MyShoppingCart"</span></span>);

        
        <span><span>if</span></span> (<span>ShoppingCart</span> <span>==</span> <span><span>null</span></span> <span>||</span> <span>ShoppingCart</span>.<span>Items</span>.<span>Count</span> <span>==</span> <span><span>0</span></span>)
        {
            
            <span>ShoppingCart</span> <span>=</span> <span><span>new</span></span> <span>Cart</span>();
        }
        <span><span>else</span></span>
        {
            
            <span><span>if</span></span> (<span>DateTime</span>.<span>Now</span> <span>&gt;</span> <span>ShoppingCart</span>.<span>LastAccessed</span>.<span>AddSeconds</span>(<span>ShoppingCart</span>.<span>TimeToLiveInSeconds</span>))          
            {
                
                <span>ShoppingCart</span> <span>=</span> <span><span>new</span></span> <span>Cart</span>();
            }
        }
        <span>ShoppingCart</span>.<span>LastAccessed</span> <span>=</span> <span>DateTime</span>.<span>Now</span>;
        <span>hasLoaded</span> <span>=</span> <span><span>true</span></span>;
    }

    <span><span><span>public</span></span></span><span> </span><span><span><span>async</span></span></span><span> </span><span><span>Task</span></span><span> </span><span><span><span>SaveChangesAsync</span></span></span><span>(<span></span>) 
    </span>{
        
        <span>ShoppingCart</span>.<span>LastAccessed</span> <span>=</span> <span>DateTime</span>.<span>Now</span>;
        <span><span>await</span></span> <span>ProtectedLocalStore</span>.<span>SetAsync</span>(<span><span>"MyShoppingCart"</span></span>, <span>ShoppingCart</span>);
    }
}</pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_127576"><div><p>This component has an instance of Cart (ShoppingCart) which it loads and saves to localStorage. </p><p>Rather than just instantiating a CartStateProvider in index, I took Steve’s advice and made it a Cascading Parameter so it could be used everywhere. To do that, I wrapped the Router in App.razor in an instance of CartStateProvider:</p></div></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_128742"><div id="yui_3_17_2_1_1583935064686_56"><pre><span><span>&lt;</span></span><span><span><span>BlazorStateTest1.Shared.CartStateProvider</span></span></span><span><span>&gt;</span></span>
    <span><span>&lt;</span></span><span><span><span>Router</span></span></span><span> </span><span><span><span>AppAssembly</span></span></span><span>=</span><span><span><span>"@typeof(Program).Assembly"</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>Found</span></span></span><span> </span><span><span><span>Context</span></span></span><span>=</span><span><span><span>"routeData"</span></span></span><span><span>&gt;</span></span>
            <span><span>&lt;</span></span><span><span><span>RouteView</span></span></span><span> </span><span><span><span>RouteData</span></span></span><span>=</span><span><span><span>"@routeData"</span></span></span><span> </span><span><span><span>DefaultLayout</span></span></span><span>=</span><span><span><span>"@typeof(MainLayout)"</span></span></span><span> </span><span><span>/&gt;</span></span>
        <span><span>&lt;/</span></span><span><span><span>Found</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>NotFound</span></span></span><span><span>&gt;</span></span>
            <span><span>&lt;</span></span><span><span><span>LayoutView</span></span></span><span> </span><span><span><span>Layout</span></span></span><span>=</span><span><span><span>"@typeof(MainLayout)"</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>p</span></span></span><span><span>&gt;</span></span>Sorry, there's nothing at this address.<span><span>&lt;/</span></span><span><span><span>p</span></span></span><span><span>&gt;</span></span>
            <span><span>&lt;/</span></span><span><span><span>LayoutView</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;/</span></span><span><span><span>NotFound</span></span></span><span><span>&gt;</span></span>
    <span><span>&lt;/</span></span><span><span><span>Router</span></span></span><span><span>&gt;</span></span>
<span><span>&lt;/</span></span><span><span><span>BlazorStateTest1.Shared.CartStateProvider</span></span></span><span><span>&gt;</span></span></pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_145865"><p>Finally, we can use it in the Index page (the default page for Blazor projects):</p></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_146399"><div id="yui_3_17_2_1_1583935064686_59"><pre>@page "/"

@if (AllProducts != null)
{
    // This demo is based on a technique Steve Sanderson Showed in the following Github Gist:
    // https://gist.github.com/SteveSandersonMS/ba16f6bb6934842d78c89ab5314f4b56

    <span><span>&lt;</span></span><span><span><span>h2</span></span></span><span><span>&gt;</span></span>Select an item<span><span>&lt;/</span></span><span><span><span>h2</span></span></span><span><span>&gt;</span></span>
    //Display the list of products. Call ProductSelected when one is selected
    <span><span>&lt;</span></span><span><span><span>select</span></span></span><span> </span><span><span><span>size</span></span></span><span>=</span><span><span><span>"4"</span></span></span><span> </span><span><span><span>style</span></span></span><span>=</span><span><span><span>"width:100%;"</span></span></span><span> </span><span><span>@<span>onchange</span></span></span><span>=</span><span><span><span>"ProductSelected"</span></span></span><span><span>&gt;</span></span>
        @foreach (var product in AllProducts)
        {
            <span><span>&lt;</span></span><span><span><span>option</span></span></span><span> </span><span><span><span>value</span></span></span><span>=</span><span><span><span>"@product.Id.ToString()"</span></span></span><span><span>&gt;</span></span>@product.Name<span><span>&lt;/</span></span><span><span><span>option</span></span></span><span><span>&gt;</span></span>
        }
    <span><span>&lt;/</span></span><span><span><span>select</span></span></span><span><span>&gt;</span></span>
    <span><span>&lt;</span></span><span><span><span>br</span></span></span><span> </span><span><span>/&gt;</span></span>

    // Show the selected product
    @if (SelectedProduct != null <span>&amp;</span><span>&amp;</span> ShowItem == true)
    {
        <span><span>&lt;</span></span><span><span><span>div</span></span></span><span> </span><span><span><span>style</span></span></span><span>=</span><span><span><span>"padding:1vw;background-color:lightgray;"</span></span></span><span><span>&gt;</span></span>
            <span><span>&lt;</span></span><span><span><span>table</span></span></span><span> </span><span><span><span>cellpadding</span></span></span><span>=</span><span><span><span>"5"</span></span></span><span> </span><span><span><span>cellspacing</span></span></span><span>=</span><span><span><span>"5"</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Name:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>@SelectedProduct.Name<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Description:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>@SelectedProduct.Description<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Price:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>$@SelectedProduct.Price<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Add To Cart:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>
                        Quantity:
                        <span><span>&lt;</span></span><span><span><span>input</span></span></span><span> </span><span><span>@<span>bind</span></span></span><span>=</span><span><span><span>"Quantity"</span></span></span><span> </span><span><span>/&gt;</span></span>
                        <span><span>&lt;</span></span><span><span><span>button</span></span></span><span> </span><span><span>@<span>onclick</span></span></span><span>=</span><span><span><span>"AddToCart"</span></span></span><span><span>&gt;</span></span>Add<span><span>&lt;/</span></span><span><span><span>button</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
            <span><span>&lt;/</span></span><span><span><span>table</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;/</span></span><span><span><span>div</span></span></span><span><span>&gt;</span></span>
    }

    // Show the cart contents if there are items in it.
    @if (CartStateProvider != null <span>&amp;</span><span>&amp;</span> CartStateProvider.ShoppingCart.Items.Count &gt; 0)
    {
        <span><span>&lt;</span></span><span><span><span>br</span></span></span><span> </span><span><span>/&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>h3</span></span></span><span><span>&gt;</span></span>Your Cart:<span><span>&lt;/</span></span><span><span><span>h3</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>h4</span></span></span><span><span>&gt;</span></span>Total: $@CartStateProvider.ShoppingCart.Total<span><span>&lt;/</span></span><span><span><span>h4</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>table</span></span></span><span> </span><span><span><span>cellpadding</span></span></span><span>=</span><span><span><span>"5"</span></span></span><span> </span><span><span><span>cellspacing</span></span></span><span>=</span><span><span><span>"5"</span></span></span><span><span>&gt;</span></span>
            @foreach (var item in CartStateProvider.ShoppingCart.Items)
            {
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>colspan</span></span></span><span>=</span><span><span><span>"2"</span></span></span><span><span>&gt;</span></span>
                        <span><span>&lt;</span></span><span><span><span>hr</span></span></span><span> </span><span><span>/&gt;</span></span>
                    <span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Name:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>@item.Product.Name<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Description:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>@item.Product.Description<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Price:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>$@item.Product.Price<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Quantity:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>@item.Quantity<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"right"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span><span><span>&lt;</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span>Total:<span><span>&lt;/</span></span><span><span><span>strong</span></span></span><span><span>&gt;</span></span><span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>align</span></span></span><span>=</span><span><span><span>"left"</span></span></span><span> </span><span><span><span>valign</span></span></span><span>=</span><span><span><span>"top"</span></span></span><span><span>&gt;</span></span>$@item.Total<span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;</span></span><span><span><span>td</span></span></span><span> </span><span><span><span>colspan</span></span></span><span>=</span><span><span><span>"2"</span></span></span><span><span>&gt;</span></span>
                        @*Clicking this button passes the item so we can remove it*@
                        <span><span>&lt;</span></span><span><span><span>button</span></span></span><span> </span><span><span>@<span>onclick</span></span></span><span>=</span><span><span><span>"@(() =&gt; RemoveItem(@item))"</span></span></span><span><span>&gt;</span></span>Remove<span><span>&lt;/</span></span><span><span><span>button</span></span></span><span><span>&gt;</span></span>
                    <span><span>&lt;/</span></span><span><span><span>td</span></span></span><span><span>&gt;</span></span>
                <span><span>&lt;/</span></span><span><span><span>tr</span></span></span><span><span>&gt;</span></span>
            }
        <span><span>&lt;/</span></span><span><span><span>table</span></span></span><span><span>&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>br</span></span></span><span> </span><span><span>/&gt;</span></span>
        <span><span>&lt;</span></span><span><span><span>h4</span></span></span><span><span>&gt;</span></span>Total: $@CartStateProvider.ShoppingCart.Total<span><span>&lt;/</span></span><span><span><span>h4</span></span></span><span><span>&gt;</span></span>
    }

}

@code {

    // Cascading Parameters and Values flow down the entire component tree
    [CascadingParameter] CartStateProvider CartStateProvider { get; set; }

    bool ShowItem = false;
    string Quantity = "1";
    List<span><span>&lt;</span></span><span><span><span>Product</span></span></span><span><span>&gt;</span></span> AllProducts;
    Product SelectedProduct;

    void ProductSelected(ChangeEventArgs args)
    {
        // User clicked on an item in the list.
        // Show the product and give them an option to add to cart.
        SelectedProduct = (from x in AllProducts
                           where x.Id == Convert.ToInt32(args.Value)
                           select x).First();
        Quantity = "1";
        ShowItem = true;
    }

    async Task AddToCart()
    {
        // Create a new item for the shopping cart
        var item = new CartProduct
        {
            Product = SelectedProduct,
            Quantity = Convert.ToInt32(Quantity)
        };
        // Add it to the cart
        CartStateProvider.ShoppingCart.Items.Add(item);
        // Save to local storage
        await CartStateProvider.SaveChangesAsync();
        // Stop displaying the selected item
        ShowItem = false;
    }

    async Task RemoveItem(CartProduct Item)
    {
        // User clicked a Remove button to remove an item from the cart.
        CartStateProvider.ShoppingCart.Items.Remove(Item);
        // Update the cart - save to localstorage
        await CartStateProvider.SaveChangesAsync();
    }

    protected override void OnInitialized()
    {
        // Create the products we can purchase
        AllProducts = new List<span><span>&lt;</span></span><span><span><span>Product</span></span></span><span><span>&gt;</span></span>();

        AllProducts.Add(new Product
        {
            Id = 1,
            Name = "1 lb. Bag of Yirgacheffe Coffee Beans",
            Description = "Yirgacheffe is a rich Ethiopian coffee that will poke your eye out",
            Price = (decimal)10.99
        });

        AllProducts.Add(new Product
        {
            Id = 2,
            Name = "Tablet Show Coffee Mug",
            Description = "Back by popular demand for a limited time, the long-coveted Tablet Show Coffee Mug",
            Price = (decimal)4.99
        });
    }
}</pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_148433"><div><p>Everything starts at the OnInitialized method. That’s where I create two products and add them to the AllProducts list.</p><p>Now look at the top of the page. If the AllProducts list is loaded, we show the products in a select element.</p><p>When an item is selected, the ProductSelected method fires, and the SelectedProduct is set.</p><p>Next, we have logic that shows the product info if SelectedProduct isn’t null and the boolean ShowItem is set to true. That table includes an input element for the quantity and an Add button that calls the AddToCart method when clicked.</p><p>The AddToCart method then creates a CartProduct, adds it to the CartStateProvider.ShoppingCart, and persists it.</p><p>Next, if the CartStateProvider.ShoppingCart isn’t null and actually contains items, it is shown below, again in a table element. Each item has a Remove button that when clicked calls RemoveItem, which removes the item from the cart and again saves the cart.</p><p>Take a look at the expiry code in the CartStateProvider’s OnParametersSetAsync method. This happens when the page loads and the cart gets instantiated. This is the critical check right here:</p></div></div><div data-block-type="23" id="block-yui_3_17_2_1_1583860095592_181158"><div id="yui_3_17_2_1_1583935064686_62"><pre><span><span>if</span></span> (<span><span>DateTime</span></span><span>.</span><span><span>Now</span></span> <span>&gt;</span> <span><span>ShoppingCart</span></span><span>.</span><span><span>LastAccessed</span></span><span>.</span><span><span>AddSeconds</span></span>(<span><span>ShoppingCart</span></span><span>.</span><span><span>TimeToLiveInSeconds</span></span>)) </pre></div></div><div data-block-type="2" id="block-yui_3_17_2_1_1583860095592_184458"><div><p>If this statement is true, then the cart has expired and a new empty cart is returned.</p><h2>Summary</h2><p>LocalStorage is good for small amounts of data - Steve says storing a few K of data there is probably okay - but you should be thinking about server-side storage of state if the amount of data going over the wire is hindering performance. For small bits, however, localStorage is the perfect solution.</p></div></div></div></div></div>
      
    </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>