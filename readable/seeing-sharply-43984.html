<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Seeing Sharply - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Seeing Sharply - linksfor.dev(s)"/>
    <meta property="article:author" content="James Hickey"/>
    <meta property="og:description" content="Technical blog of Microsoft certified developer James Hickey. Helping you reach the next step of your career as a software developer!"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.blog.jamesmichaelhickey.com/How-To-Build-Modular-Monoliths-With-NETCore-Razor-Class-Libraries/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Seeing Sharply</title>
<div class="readable">
        <h1>Seeing Sharply</h1>
            <div>by James Hickey</div>
            <div>Reading time: 13-16 minutes</div>
        <div>Posted here: 10 Dec 2019</div>
        <p><a href="https://www.blog.jamesmichaelhickey.com/How-To-Build-Modular-Monoliths-With-NETCore-Razor-Class-Libraries/">https://www.blog.jamesmichaelhickey.com/How-To-Build-Modular-Monoliths-With-NETCore-Razor-Class-Libraries/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><div><div><article role="main"><p><strong>Microservices are all the rage now.</strong> </p>
<p>But, many are (finally) realizing that it’s not for everyone. Most of us aren’t at the scale of Netflix, LinkedIn, etc. and therefore don’t have the organizational manpower to offset the overhead of a full-blown microservices architecture.</p>
<p>An alternative to a full-blown microservices architecture that’s been getting a lot of press lately is called “modular monoliths.”</p>
<a id="more"></a>
<blockquote>
<p>Shouldn’t well-written monoliths be modular anyways?</p>
</blockquote>
<p>Sure. But modular monoliths are done in a <strong>very intentional</strong> way that usually follows a domain-driven approach.</p>
<h2 id="Summary-Table-Of-Contents"><a href="#Summary-Table-Of-Contents" title="Summary / Table Of Contents"></a>Summary / Table Of Contents</h2><p>This is part of the 2019 C# Advent! <a href="https://crosscuttingconcerns.com/The-Third-Annual-csharp-Advent" target="_blank" rel="noopener">Take a look at all the other awesome articles for this year!</a></p>
<p>Here are the main sections in the article in case you would like to skip certain parts:</p>
<ul>
<li><a href="#Why-Modular-Monoliths">Introduction / Why Modular Monoliths?</a></li>
<li><a href="#Creating-Our-Skeleton">Building A Modular Monolith With .NET Core Razor Class Libraries</a></li>
<li><a href="#Composite-UIs-With-Blazor-Components">Building A Composite UI With Blazor/Razor Components</a></li>
</ul>
<p><strong>The GitHub repo for everything in this article <a href="https://github.com/jamesmh/net-core-modular-monolith-razor-lib" target="_blank" rel="noopener">is here</a>.</strong></p>
<h2 id="Why-Modular-Monoliths"><a href="#Why-Modular-Monoliths" title="Why Modular Monoliths?"></a>Why Modular Monoliths?</h2><p>The biggest benefits that microservices give us (loose coupling, code ownership, etc.) can be had in a well-designed modular monolith. By leveraging the domain-driven concept of bounded contexts, we can treat each context as an isolated application. </p>
<p>But, instead of hosting each context as an independent process (like with microservices), we can extract each bounded context as a module within a larger system or web of modules. </p>
<p>For example, each module might be a .NET project/assembly. These assemblies would be combined at run-time and hosted within one main process.</p>
<p>Each module would own everything from UI components, back-end business/domain logic to persistence.</p>
<p>Compared to microservices, the benefits of modular monoliths include:</p>
<ul>
<li>In-memory communication between contexts are more performant and reliable than doing it on the network</li>
<li>A much simpler deployment process for smaller teams</li>
<li>Retain boundaries and ownership around specific contexts</li>
<li>Simplified upgrades to contexts/services</li>
<li>Modules are “ready” to be extracted as services if needed</li>
</ul>
<p>I see modular monoliths as a step within the potential evolution of a system’s architecture:</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/699dfe10b669268825a7ea15bccc66edb9d3034f/d29ea/img/architecture/architecturespectrum.png" alt="spectrum"></p>
<p>For domain-driven approaches, starting with a modular monolith might make the most sense and is definitely worth considering.</p>
<p>Here’s a more in-depth <a href="https://www.kamilgrzybek.com/design/modular-monolith-primer/" target="_blank" rel="noopener">primer on modular monoliths</a> by Kamil Grzybek if you’re interested.</p>
<h2 id="How-Can-I-Build-Them"><a href="#How-Can-I-Build-Them" title="How Can I Build Them?"></a>How Can I Build Them?</h2><p>There are many ways to build modular monoliths!</p>
<p>For example, Kamil Grzybek has created <a href="https://github.com/kgrzybek/modular-monolith-with-ddd" target="_blank" rel="noopener">a production-ready modular monolith sample</a>.</p>
<p>I personally prefer less separation within each bounded context / module, but his example is super detailed and worth looking at!</p>
<p>And, of course, Kamil says it well in his repo’s disclaimer:</p>
<blockquote>
<p>The architecture and implementation presented in this repository is one of the many ways to solve some problems</p>
</blockquote>
<p>In this article, we’ll be looking at a much simpler approach to building modular monoliths. Again, the direction and implementation depends on your needs (business requirements, team experience, time-to-market required, etc.)</p>
<p>We’ll be looking at one way that’s unique to .NET Core by using a new-ish feature of .NET Core called <a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages/ui-class?view=aspnetcore-3.0&amp;tabs=visual-studio" target="_blank" rel="noopener">razor class libraries</a>. Razor class libraries allow you to build entire UI pages, controllers and components inside of a sharable library! It’s the approach I’ve used for <a href="https://www.pro.coravel.net/" target="_blank" rel="noopener">Coravel Pro</a> and enables some exciting possibilities.</p>
<h2 id="Life-Insurance-Application"><a href="#Life-Insurance-Application" title="Life Insurance Application"></a>Life Insurance Application</h2><p>I recently wrote <a href="https://www.blog.jamesmichaelhickey.com/DDD-Use-Case-Life-Insurance-Platform/" target="_blank" rel="noopener">an article</a> about using some domain-driven approaches to think about and re-design an insurance selling platform I once worked on.</p>
<p>To keep things simple for now, let’s imagine we’ve determined two bounded contexts from this domain:</p>
<ul>
<li>Insurance Application</li>
<li>Medical Questionnaire</li>
</ul>
<p>The specific details are not so important since the remainder of this article will look at implementation and code.</p>
<p>The structure of our solution will roughly look like the following - with a .NET Core web application as the host:</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/ca868341ca37c67c393d196d8610555faac5591f/01a02/img/razormodules/modules.png" alt="modules"></p>
<h2 id="Creating-Our-Skeleton"><a href="#Creating-Our-Skeleton" title="Creating Our Skeleton"></a>Creating Our Skeleton</h2><p>Let’s implement the skeleton for our modular monolith and use razor class libraries as a way to implement our bounded contexts.</p>
<p>First, create a new root host process:</p>
<p><code>dotnet new webapp -o HostApp</code></p>
<p>Next, we’ll create our two modules as razor class libraries:</p>
<p><code>dotnet new razorclasslib -o Modules/InsuranceApplication</code></p>
<p><code>dotnet new razorclasslib -o Modules/MedicalQuestions</code></p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/a1a7ae3b28b6ff8d7b0dba341371c68253473527/ebc74/img/razormodules/folders1.png" alt="folder structure"></p>
<p>Then, we’ll reference our modules from the host project.</p>
<p>From within the host project:</p>
<p><code>dotnet add reference ../Modules/InsuranceApplication/InsuranceApplication.csproj</code></p>
<p><code>dotnet add reference ../Modules/MedicalQuestions/MedicalQuestions.csproj</code></p>
<h2 id="Building-Our-First-Module"><a href="#Building-Our-First-Module" title="Building Our First Module"></a>Building Our First Module</h2><p>Navigate to the Insurance Application module at <code>Modules/InsuranceApplication</code>.</p>
<p>Your razor class library will have some sample Blazor files, <code>www</code> folder, etc. You can remove all those generated files.</p>
<p>Let’s build a couple of Razor Pages that will be used as this bounded context’s UI:</p>
<p><code>dotnet new page -o Areas/InsuranceApplication/Pages -n ContactInfo</code></p>
<p><code>dotnet new page -o Areas/InsuranceApplication/Pages -n InsuranceSelection</code></p>
<blockquote>
<p>You might have to go into your razor pages and adjust the generated namespaces. In my example, I changed them to <code>InsuranceApplication.Areas.InsuranceApplication.Pages</code>.</p>
</blockquote>
<h2 id="Oops-It-Doesn’t-Work"><a href="#Oops-It-Doesn’t-Work" title="Oops! It Doesn’t Work!"></a>Oops! It Doesn’t Work!</h2><p>Navigate back to the <code>HostApp</code> web project and try to build it. </p>
<p><em>It will fail!</em></p>
<p>Our razor class libraries are trying to use razor pages - which is a web function. This requires referencing the appropriate reference assemblies.</p>
<p>Before .NET Core 3.0, we would have added a reference to some extra NuGet packages like <code>Microsoft.AspNetCore.Mvc</code>, etc. As of .NET Core 3.0, many of these ASP related packages are actually included in the .NET Core SDK.</p>
<blockquote>
<p>For some projects, this breaking change can cause issues and confusion! For more details, check out Andrew Lock’s <a href="https://andrewlock.net/converting-a-netstandard-2-library-to-netcore-3/" target="_blank" rel="noopener">in-depth look at this issue.</a></p>
</blockquote>
<p>So, let’s change the project files of our two razor class libraries to the following:</p>
<pre><code><span><span><span><span>&lt;</span></span><span><span>Project</span></span></span><span> </span><span><span><span>Sdk</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>Microsoft.NET.Sdk.Razor</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>

 <span><span><span><span>&lt;</span></span><span><span>PropertyGroup</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>TargetFramework</span></span></span><span><span>&gt;</span></span></span>netcoreapp3.0<span><span><span><span>&lt;/</span></span><span><span>TargetFramework</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>AddRazorSupportForMvc</span></span></span><span><span>&gt;</span></span></span>True<span><span><span><span>&lt;/</span></span><span><span>AddRazorSupportForMvc</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;/</span></span><span><span>PropertyGroup</span></span></span><span><span>&gt;</span></span></span>

 <span><span><span><span>&lt;</span></span><span><span>ItemGroup</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>FrameworkReference</span></span></span><span> </span><span><span><span>Include</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>Microsoft.AspNetCore.App</span></span><span><span><span>"</span></span></span></span><span> </span><span><span>/&gt;</span></span></span>
 <span><span><span><span>&lt;/</span></span><span><span>ItemGroup</span></span></span><span><span>&gt;</span></span></span>

<span><span><span><span>&lt;/</span></span><span><span>Project</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<blockquote>
<p>Yes, I removed all the boilerplate Blazor code since the appropriate references are included in the <code>FrameworkReference</code>.</p>
</blockquote>
<h2 id="It’s-Alive"><a href="#It’s-Alive" title="It’s Alive!"></a>It’s Alive!</h2><p>Go into the razor pages you created and add some dummy HTML.</p>
<p>For example:</p>
<pre><code>@page
@model InsuranceApplication.Areas.InsuranceApplication.Pages.ContactInfoModel
@{
}

<span><span><span><span>&lt;</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>Insurance Contact Info<span><span><span><span>&lt;/</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<p>Try running your host application and navigate to <code>/InsuranceApplication/ContactInfo</code> and <code>/InsuranceApplication/InsuranceSelection</code>.</p>
<p>Both pages should display. Cool!</p>
<h2 id="UI-Flow-Beginning-The-Insurance-Application"><a href="#UI-Flow-Beginning-The-Insurance-Application" title="UI Flow: Beginning The Insurance Application"></a>UI Flow: Beginning The Insurance Application</h2><p>Let’s look at building out a basic flow between our two modules.</p>
<p>First, in the <code>HostApp</code> project, in your <code>Pages/Index.cshtml</code> file add the following HTML:</p>
<pre><code><span><span><span><span>&lt;</span></span><span><span>a</span></span></span><span> </span><span><span><span>href</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>/InsuranceApplication/ContactInfo</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>Begin Your Application!<span><span><span><span>&lt;/</span></span><span><span>a</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<p>That will give us a link to click from our home screen to begin the flow through our application logic.</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/46134834a357eaec1d693b1829d0f2bc97d04fdb/38b38/img/razormodules/flow1.png" alt="screen 1"></p>
<h2 id="UI-Flow-Inside-The-Insurance-Application-Module"><a href="#UI-Flow-Inside-The-Insurance-Application-Module" title="UI Flow: Inside The Insurance Application Module"></a>UI Flow: Inside The Insurance Application Module</h2><p>In your <code>ContactInfo.cshtml</code> file within the <code>InsuranceApplication</code> project, insert the following:</p>
<pre><code>@page
@model InsuranceApplication.Areas.InsuranceApplication.Pages.ContactInfoModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<span><span><span><span>&lt;</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>Insurance Contact Info<span><span><span><span>&lt;/</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>

<span><span><span><span>&lt;</span></span><span><span>form</span></span></span><span> </span><span><span><span>method</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>post</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>label</span></span></span><span><span>&gt;</span></span></span>Email:<span><span><span><span>&lt;/</span></span><span><span>label</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>input</span></span></span><span> </span><span><span><span>asp-for</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>EmailAddress</span></span><span><span><span>"</span></span></span></span><span> </span><span><span><span>required</span></span></span><span> </span><span><span><span>type</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>email</span></span><span><span><span>"</span></span></span></span><span> </span><span><span>/&gt;</span></span></span>

 <span><span><span><span>&lt;</span></span><span><span>button</span></span></span><span> </span><span><span><span>type</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>submit</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>submit<span><span><span><span>&lt;/</span></span><span><span>button</span></span></span><span><span>&gt;</span></span></span>
<span><span><span><span>&lt;/</span></span><span><span>form</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<p>In <code>ContactInfo.cshtml.cs</code>, add the following:</p>
<pre><code><span><span>using</span></span> System<span>;</span>
<span><span>using</span></span> System<span>.</span>Collections<span>.</span>Generic<span>;</span>
<span><span>using</span></span> System<span>.</span>Linq<span>;</span>
<span><span>using</span></span> System<span>.</span>Threading<span>.</span>Tasks<span>;</span>
<span><span>using</span></span> Microsoft<span>.</span>AspNetCore<span>.</span>Mvc<span>;</span>
<span><span>using</span></span> Microsoft<span>.</span>AspNetCore<span>.</span>Mvc<span>.</span>RazorPages<span>;</span>

<span><span>namespace</span></span> <span>InsuranceApplication</span><span><span>.</span></span><span>Areas</span><span><span>.</span></span><span>InsuranceApplication</span><span><span>.</span></span><span>Pages</span>
<span>{</span>
  <span><span>public</span></span> <span><span>class</span></span> <span><span>ContactInfoModel</span></span> <span>:</span> <span>PageModel</span>
  <span>{</span>
    <span>[</span><span>BindProperty</span><span>]</span>
    <span><span>public</span></span> <span><span>string</span></span> EmailAddress <span>{</span> <span><span>get</span></span><span>;</span> <span><span>set</span></span><span>;</span> <span>}</span>

    <span><span><span>public</span></span></span><span> IActionResult </span><span><span><span>OnPostAsync</span></span></span><span><span>(</span></span><span><span><span></span>)</span></span>
    <span>{</span>
      Console<span>.</span><span>WriteLine</span><span>(</span><span>$</span><span><span>"Email Address is <span>{<span>this</span>.EmailAddress}</span>."</span></span><span>)</span><span>;</span>
      <span><span>return</span></span> <span>RedirectToPage</span><span>(</span><span><span>"./InsuranceSelection"</span></span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span>
</code></pre>
<p>This will allow us to enter an email address and move to the next page in our flow.</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/ddb4726b15b0f5ffa285044c15afd8646dd624af/8a2df/img/razormodules/flow2.png" alt="screen 2"></p>
<p>In the <code>InsuranceSelection.cshtml</code> page - just add a link to keep things simple:</p>
<pre><code><span><span><span><span>&lt;</span></span><span><span>a</span></span></span><span> </span><span><span><span>href</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>/MedicalQuestionnaire/Questions</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>Next<span><span><span><span>&lt;</span></span><span><span>a</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<blockquote>
<p>You can imagine that this page would allow the user to select a specific insurance plan they want to apply for.</p>
</blockquote>
<h2 id="UI-Flow-Medical-Questionnaire-Module"><a href="#UI-Flow-Medical-Questionnaire-Module" title="UI Flow: Medical Questionnaire Module"></a>UI Flow: Medical Questionnaire Module</h2><p>You might have noticed that we never created any razor pages in the Medical Questionnaire module. Let’s do that now.</p>
<p>Navigate to the root of the <code>MedicalQuestions</code> project and enter the following from your terminal:</p>
<p><code>dotnet new page -o Areas/MedicalQuestionnaire/Pages -n Questions</code></p>
<blockquote>
<p>Again, you might need to adjust the generated namespaces.</p>
</blockquote>
<p>Within the <code>Questions.cshtml</code> file, add a link:</p>
<pre><code><span><span><span><span>&lt;</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>Medical Questionnaire<span><span><span><span>&lt;/</span></span><span><span>h1</span></span></span><span><span>&gt;</span></span></span>

<span><span><span><span>&lt;</span></span><span><span>a</span></span></span><span> </span><span><span><span>href</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>/</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>Finish<span><span><span><span>&lt;</span></span><span><span>a</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<p>Try running your host project with <code>dotnet run</code> and run through the entire UI!</p>
<h2 id="Composite-UIs-With-Blazor-Components"><a href="#Composite-UIs-With-Blazor-Components" title="Composite UIs With Blazor Components"></a>Composite UIs With Blazor Components</h2><p>When working with these kinds of loosely coupled modules a question arises: </p>
<p><strong>What happens when we need to display information from multiple bounded contexts on the same screen?</strong></p>
<p>Usually, we resort to building composite UIs. </p>
<p>These are UIs where various parts of the UI are rendered and controlled by components owned by a specific bounded context, service or module.</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/7b279caa1494db6af4c110c391072c92ec5e0e47/6fb82/img/razormodules/compositeui.png" alt="composite ui"></p>
<p>As you can see in the image above, each component might be owned by a different back-end module and would be isolated from and loosely coupled to the other modules.</p>
<p>Let’s build a simple composite UI using some exciting new .NET Core 3.0 technologies!</p>
<h3 id="Configure-Blazor-Components"><a href="#Configure-Blazor-Components" title="Configure Blazor Components"></a>Configure Blazor Components</h3><p>We need to configure our host application to support the new blazor/razor components.</p>
<ol>
<li>Add the following script to <code>Pages/Shared/_Layout.cshtml</code>:</li>
</ol>
<pre><code><span><span><span><span>&lt;</span></span><span><span>script</span></span></span><span> </span><span><span><span>src</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>_framework/blazor.server.js</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span><span></span><span><span><span><span></span><span>&lt;/</span></span><span><span>script</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<ol start="2">
<li>In <code>Startup.cs</code> in <code>ConfigureServices</code> add:</li>
</ol>
<pre><code>services<span>.</span><span>AddServerSideBlazor</span><span>(</span><span>)</span><span>;</span>
</code></pre>
<ol start="3">
<li>In the <code>Configure</code> method:</li>
</ol>
<pre><code>app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=</span><span>&gt;</span>
<span>{</span>
 endpoints<span>.</span><span>MapRazorPages</span><span>(</span><span>)</span><span>;</span>
 endpoints<span>.</span><span>MapBlazorHub</span><span>(</span><span>)</span><span>;</span> 
<span>}</span><span>)</span><span>;</span>
</code></pre>
<h3 id="Create-Insurance-Application-Component"><a href="#Create-Insurance-Application-Component" title="Create Insurance Application Component"></a>Create Insurance Application Component</h3><p>Navigate to the <code>InsuranceApplication</code> project’s root directory and execute the following:</p>
<p><code>dotnet new razorcomponent -o ./Components -n ApplicationDashboard</code></p>
<p>Replace the contents of your new razor component with the following:</p>
<pre><code>@using Microsoft.AspNetCore.Components.Web

<span><span><span><span>&lt;</span></span><span><span>h3</span></span></span><span><span>&gt;</span></span></span>Application Dashboard<span><span><span><span>&lt;/</span></span><span><span>h3</span></span></span><span><span>&gt;</span></span></span>

<span><span><span><span>&lt;</span></span><span><span>p</span></span></span><span><span>&gt;</span></span></span>
    Time: @currentTime
<span><span><span><span>&lt;/</span></span><span><span>p</span></span></span><span><span>&gt;</span></span></span>

<span><span><span><span>&lt;</span></span><span><span>button</span></span></span><span> </span><span><span>@<span>onclick</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>Update</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>Update<span><span><span><span>&lt;/</span></span><span><span>button</span></span></span><span><span>&gt;</span></span></span>

@code {
    private string currentTime = DateTime.Now.ToString();

    private void Update()
    {
        currentTime = DateTime.Now.ToString();       
    }
}
</code></pre>
<h3 id="Create-Medical-Questions-Component"><a href="#Create-Medical-Questions-Component" title="Create Medical Questions Component"></a>Create Medical Questions Component</h3><p>Do the same steps within the <code>MedicalQuestions</code> module to create a dummy razor component (but change the title of the component).</p>
<h3 id="Putting-It-Together"><a href="#Putting-It-Together" title="Putting It Together"></a>Putting It Together</h3><p>Now, back in your host application project, within the <code>Pages/Index.cshtml</code> page, add the following to the top of the file:</p>
<pre><code>@page
@<span><span>using</span></span> InsuranceApplication<span>.</span>Components 
@<span><span>using</span></span> MedicalQuestions<span>.</span>Components 
@model IndexModel
</code></pre>
<p>Then, in the middle of your HTML page, add:</p>
<pre><code><span><span><span><span>&lt;</span></span><span><span>div</span></span></span><span> </span><span><span><span>class</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>row</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>div</span></span></span><span> </span><span><span><span>class</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>col-6</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>
 @(await Html.RenderComponentAsync<span><span><span><span>&lt;</span></span><span><span>ApplicationDashboard</span></span></span><span><span>&gt;</span></span></span>(RenderMode.ServerPrerendered))
 <span><span><span><span>&lt;/</span></span><span><span>div</span></span></span><span><span>&gt;</span></span></span>
 <span><span><span><span>&lt;</span></span><span><span>div</span></span></span><span> </span><span><span><span>class</span></span></span><span><span><span>=</span></span><span><span><span>"</span></span></span><span><span>col-6</span></span><span><span><span>"</span></span></span></span><span><span>&gt;</span></span></span>
 @(await Html.RenderComponentAsync<span><span><span><span>&lt;</span></span><span><span>QuestionsDashboard</span></span></span><span><span>&gt;</span></span></span>(RenderMode.ServerPrerendered))
 <span><span><span><span>&lt;/</span></span><span><span>div</span></span></span><span><span>&gt;</span></span></span>
<span><span><span><span>&lt;/</span></span><span><span>div</span></span></span><span><span>&gt;</span></span></span>
</code></pre>
<p>Finally… start your host project using <code>dotnet run</code>!</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/f3af4ea59b1f6125636630d2a9f893ab0f3c598a/b768e/img/razormodules/compositeuiscreenshot.png" alt="composite ui"></p>
<p>Any time one of the components needs to be changed, the host application will (most likely) not need to change. Both bounded contexts are still isolated from each other but our architecture allows us to be smart about how we display that information.</p>
<p><em>Note: There are other ways to build these types of components: <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/view-components?view=aspnetcore-3.1" target="_blank" rel="noopener">view components</a>, <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/intro?view=aspnetcore-3.1" target="_blank" rel="noopener">tag helpers</a>, <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/th-components?view=aspnetcore-3.1" target="_blank" rel="noopener">tag helper components</a>, javascript components, etc.</em></p>
<h2 id="Other-Considerations"><a href="#Other-Considerations" title="Other Considerations"></a>Other Considerations</h2><ol>
<li><p>Modules can be deployed as NuGet packages so that they ultimately can be managed by independent teams and be isolated as true modules.</p>
</li>
<li><p>Each bounded context can:</p>
<ul>
<li>Use its own isolated database</li>
<li>Have its own self-contained business logic</li>
<li>Communicate with other bounded contexts by using messaging and domain events</li>
<li>etc.</li>
</ul>
</li>
<li><p>In terms of service/module interaction, any calls between modules could use a shared abstractions library which would be configured in DI at run-time to use the concrete service from the appropriate bounded context:</p>
</li>
</ol>
<p><img src="https://d33wubrfki0l68.cloudfront.net/b5f869a0dc6d29438370e4e987bb11d32626b9fc/8a03e/img/razormodules/references.png" alt="references"></p>
<p>It doesn’t show on the diagram, but the Medical Questions context might need to get some information from the Insurance Application context in some scenarios where using messaging isn’t appropriate.</p>
<p>In this case, the Medical Questions code would use the <code>IInsuranceApplicationService</code> interface (from DI) to make those calls.</p>
<p>Then, at run-time, the host process would configure the concrete implementation (<code>InsuranceApplicationFacade</code>) to be given to anyone who asks for the interface.</p>
<p>This technique keeps each module loosely coupled and enforces a strict contract in terms of what one bounded context can be explicitly be “asked for”.</p>
<p><em>However, some might say the need to make direct calls to another bounded context is a sign that the boundaries are incorrect…a topic for another day.</em></p>
<h2 id="Conclusion"><a href="#Conclusion" title="Conclusion"></a>Conclusion</h2><p>I hope you found this article helpful and informative. I’m sure you can see that razor class libraries are a really exciting feature of .NET Core that hasn’t been talked about too much.</p>
<p>This is one way to use them and for some cases it might work really well!</p>
<p>Here are some resources about the topics we covered:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/?view=aspnetcore-3.1" target="_blank" rel="noopener">Blazor</a></li>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components?view=aspnetcore-3.1" target="_blank" rel="noopener">Razor Components</a></li>
<li><a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/view-components?view=aspnetcore-3.1" target="_blank" rel="noopener">View Components</a></li>
<li><a href="https://www.youtube.com/watch?v=kbKxmEeuvc4" target="_blank" rel="noopener">Modular Monoliths Talk By Simon Brown</a></li>
<li><a href="https://jimmybogard.com/composite-uis-for-microservices-a-primer/" target="_blank" rel="noopener">Composite UIs for Microservices - A Primer By Jimmy Bogard</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/architecture/microservices/architect-microservice-container-applications/microservice-based-composite-ui-shape-layout" target="_blank" rel="noopener">Microsoft: Creating composite UI based on microservices</a></li>
</ul>
<p>Check out my book about keeping your code healthy!</p>
<p><a href="https://leanpub.com/refactoringtypescript" target="_blank" rel="noopener"><img src="https://d33wubrfki0l68.cloudfront.net/778622a4824e6cce931683619ad66a6d6ce78d57/78dba/img/refactoringts.png" alt="Refactoring TypeScript book">
</a></p>
<p>Don’t forget to connect with me on:</p>
<ul>
<li><a href="https://twitter.com/jamesmh_dev" target="_blank" rel="noopener">Twitter</a></li>
<li><a href="https://www.linkedin.com/in/jamesmhickey/" target="_blank" rel="noopener">LinkedIn</a></li>
</ul>
</article></div></div></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>