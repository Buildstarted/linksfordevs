<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Python Typosquatting for Fun not Profit - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Python Typosquatting for Fun not Profit - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@williambengtson"/>
    <meta property="og:description" content="by William Bengtson | @__muscles"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/@williambengtson/python-typosquatting-for-fun-not-profit-99869579c35d"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Python Typosquatting for Fun not Profit</title>
<div class="readable">
        <h1>Python Typosquatting for Fun not Profit</h1>
            <div>by https://medium.com/@williambengtson</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 10 Aug 2020</div>
        <p><a href="https://medium.com/@williambengtson/python-typosquatting-for-fun-not-profit-99869579c35d">https://medium.com/@williambengtson/python-typosquatting-for-fun-not-profit-99869579c35d</a></p>
        <hr/>
<div id="readability-page-1" class="page"><article><span></span><div><section><div><div><div><div><div><div><p><a rel="noopener" href="https://medium.com/@williambengtson?source=post_page-----99869579c35d----------------------"><img alt="William Bengtson" src="https://miro.medium.com/fit/c/96/96/0*ftl4ntL7TEioMeZm." width="48" height="48"></a></p></div></div></div></div><p id="00b6" data-selectable-paragraph="">by <a href="https://www.linkedin.com/in/william-bengtson" target="_blank" rel="noopener nofollow">William Bengtson</a> | <a href="https://twitter.com/@__muscles" target="_blank" rel="noopener nofollow">@__muscles</a></p><p id="a5d9" data-selectable-paragraph="">Two years ago a few colleagues (shoutout to <a href="https://twitter.com/helloarbit" target="_blank" rel="noopener nofollow">helloarbit</a>, <a href="https://twitter.com/travismcpeak" target="_blank" rel="noopener nofollow">travismcpeak</a>, and <a href="https://twitter.com/coffeetocode" target="_blank" rel="noopener nofollow">coffeetocode</a>) and I were talking about supply chain attacks which led to this work being completed. A supply chain attack is an attack that targets dependencies of a company in hopes that they can leverage a weakness in the supply chain to damage the target company. For a company that produces software, the supply chain attack typically targets the software that is used in development of the software product.</p><p id="8262" data-selectable-paragraph="">With this is mind, the software dependencies are packages/libraries in popular languages like Python, Java, Ruby, and Golang. Each language has their own way of packaging and retrieving dependencies which over the years has led to some having more proactive measures to protect against certain types of supply chain attacks than others.</p><p id="b638" data-selectable-paragraph="">I decided to take a look at what typosquatting in Python looks like and first started to look at Levenshtein to calculate the distance between two package names to determine if one thing is a typosquat of another. This can be useful to detecting a package that has been squatted and used as a tool to prevent packages from being squatted. With this in mind I wanted to see how many packages of the top installed Python packages can be squatted by removing underscores (<code>_</code>) or dashes (<code>-</code>).</p><p id="060c" data-selectable-paragraph="">One of the most fascinating pieces for me is that the Python Package Index (<a href="https://pypi.org/" target="_blank" rel="noopener nofollow">PyPI</a>) makes data available about each Python package. This data can be very powerful when determining which packages are the most popular packages in the Python ecosystem. For more on analyzing PyPI downloads, checkout their guide <a href="https://packaging.python.org/guides/analyzing-pypi-package-downloads/" target="_blank" rel="noopener nofollow">here</a>.</p><p id="2342" data-selectable-paragraph="">The goal of this exercise was to understand how many packages could be squatted and if possible prevent the future squat by registering them myself. Using the data mentioned above, I performed a query to tell me the top 10,000 installed Python packages using the package installer <code>pip</code>. Having a list of the top 10,000 <code>pip</code> installed packages allowed me to come up with a list of which packages could potentially be squatted by removing any<code>_</code> or <code>-</code> from the package name as mentioned above.</p><p id="a2d0" data-selectable-paragraph="">I wanted to squat the potential packages so I needed to come up with a strategy for squatting them. There were a few options to choose from:</p><ol><li id="95b4" data-selectable-paragraph="">Clone the existing packages, change the name to the squatted name and register them.</li><li id="4c23" data-selectable-paragraph="">Register the packages with a package that does nothing.</li><li id="149e" data-selectable-paragraph="">Register the packages with a package that could potentially educate the person installing the squatted package.</li></ol><p id="32bd" data-selectable-paragraph="">Looking at the different options, I chose number three. The goal of the project has always been to be a <em>“Guardian”</em> and the other options seemed less than ideal in achieving the goal. Number two would have left developers wasting a lot of time trying to understand why their software doesn’t work if they installed the squatted package instead of the real package and number one seemed shady and could lead people to believe the intent behind this project had a malicious future.</p></div></div></section><hr><section><div><div><p id="6acc" data-selectable-paragraph="">Initially I decided to squat around 1,100 or so packages. In order to do this, I first needed to create the package to push to PyPI and then create some automation around this to make squatting this many packages achievable in a short amount of time.</p><p id="d5dc" data-selectable-paragraph="">I decided to create a simple package that when installed would fail and print out an error message letting you know the actual package name you probably meant to install. Below is an example of what happens when you try to install <code>pythonjsonlogger</code> instead of the real package <code>python-json-logger</code>.</p><pre><span id="db30" data-selectable-paragraph="">pip install pythonjsonlogger<br>Collecting pythonjsonlogger<br>  Downloading pythonjsonlogger-0.1.1.tar.gz (1.3 kB)<br>Building wheels for collected packages: pythonjsonlogger<br>  Building wheel for pythonjsonlogger (setup.py) ... error<br>  ERROR: Command errored out with exit status 1:<br>.<br>.<br>.  <br>Complete output (29 lines):<br>  running bdist_wheel<br>  running build<br>  running build_py<br>  creating build<br>  creating build/lib<br>.<br>.<br>.<br>.<br>    File "/private/var/folders/cy/kc766fxx37b5rf87qxkt8hj00000gp/T/pip-install-kp4jab6f/pythonjsonlogger/setup.py", line 20, in run<br>      raise Exception("You probably meant to install and run python-json-logger")<br>  Exception: You probably meant to install and run python-json-logger<br>  ----------------------------------------<br>  ERROR: Failed building wheel for pythonjsonlogger</span></pre><p id="3790" data-selectable-paragraph="">Now that I had the package setup and automation written, I kicked off the squatting and sat back. With over 1,100 packages registered, I now needed to wait to see if anyone would actually install these accidentally. What I found over the next two years is the most interesting piece of this project in my opinion.</p><p id="df3d" data-selectable-paragraph="">I originally meant to do a post on this after 6 months or a year, but here we are two years later and I have some data and stories to share. I’ll start with the data on 1,131 packages, and end with the stories.</p><p id="8cde" data-selectable-paragraph="">Top 10 squatted package downloads from July 16, 2018 until August 4, 2020:</p><figure><div><div><div><p><img alt="Image for post" src="https://miro.medium.com/max/60/1*XXIrNsBKac65FGTw7YGndA.png?q=20" width="399" height="326"></p><p><img alt="Image for post" width="399" height="326"></p></div></div></div></figure><p id="9034" data-selectable-paragraph="">In a little over two years there have been 530,950 total <code>pip install</code> commands run on 1,131 packages! This does not include any mirrors or internal package registries that have cloned these packages privately. Malicious packages in PyPI have been know to <a href="https://www.zdnet.com/article/two-malicious-python-libraries-removed-from-pypi/" target="_blank" rel="noopener nofollow">steal credentials</a> stored on the local file system such as SSH credentials in <code>~/.ssh/</code>, GPG keys, or perhaps AWS credentials stored in <code>~/.aws/credentials</code>. If these typosquat packages were written with malicious intent and we assume one attempt per install, that would mean 530,950 machines could have been compromised over the two year period.</p></div></div></section><hr><section><div><div><p id="0cc4" data-selectable-paragraph="">While the data is incredibly interesting and you can draw your own conclusions on what could have happened if these were malicious packages, the encounters/stories I find are the most interesting.</p><p id="ff04" data-selectable-paragraph="">Over the two years I received the following encounters:</p><ul><li id="0a66" data-selectable-paragraph="">Help installing my package</li><li id="f28d" data-selectable-paragraph="">Thanks for protecting the Python community</li><li id="f18c" data-selectable-paragraph="">Text from a friend asking if I owned a certain package</li><li id="23eb" data-selectable-paragraph="">Researchers finding my work</li><li id="baf3" data-selectable-paragraph="">Company asking to confirm the license on one of my squatted packages</li></ul><p id="300d" data-selectable-paragraph="">Over the course of the last two years I have received numerous emails asking for help installing my package or reporting that my package is broken. Each time I’d simply reply with the correct package they should install.</p><p id="fadb" data-selectable-paragraph="">A few times I received emails from people who have installed my squatted package accidentally and either read the error print out or saw my package registration clearly stating it is package to prevent exploit.</p><figure><div><div><div><div><p><img alt="Image for post" src="https://miro.medium.com/max/60/1*QjJ_Ki3hyar2CYAgzpXg5A.png?q=20" width="435" height="241"></p><p><img alt="Image for post" width="435" height="241"></p></div></div></div></div></figure><p id="4e70" data-selectable-paragraph="">In a few cases it was both a research finding my work and thanking me.</p><blockquote><p id="5dd2" data-selectable-paragraph="">I am working on a project for my security class related to attacks on the Python ecosystem. We kept stumbling upon your packages while trying to identify typo-squatting attempts.</p><p id="d69c" data-selectable-paragraph="">I just thought I would say thanks for helping out the community! :)</p></blockquote><p id="2926" data-selectable-paragraph="">I told a few friends about this work and I don’t quite remember how the interaction went down, but it was something along the lines of:</p><blockquote><p id="0b12" data-selectable-paragraph="">Friend: Hey! Do you own pythonjsonlogger?</p><p id="0cca" data-selectable-paragraph="">Me: Yeah why?</p><p id="34a7" data-selectable-paragraph="">Friend: Dammit!</p></blockquote><p id="c77e" data-selectable-paragraph="">You know who you are :)</p><p id="0d19" data-selectable-paragraph="">I have really enjoyed each occurrence of a researcher finding my work because it typically involved a conversation around typosquatting. The example above ended up with my work being included in a symposium paper for the University of Maryland CMSC 8180 class called <em>PYed PIPer</em> by Josiah Wedgwood and Aadesh Bagmar.</p><p id="6430" data-selectable-paragraph="">In the most recent case I met with the creator of <a href="https://github.com/jspeed-meyers/pypi-scan" target="_blank" rel="noopener nofollow">pypi-scan</a>, John Speed Myers, on Zoom for about an hour on our work and we talked about potential future collaborations in this area. Most importantly, this conversation got me excited about the topic again and prompted me to finally write this post as well as do another round of squatting 3,000+ more packages to continue to protect the Python ecosystem.</p><p id="9d19" data-selectable-paragraph="">The one I find most scary is an email from a large company asking to confirm the license on one of my squatted packages for use.</p><figure><div><div><div><div><p><img alt="Image for post" src="https://miro.medium.com/max/60/1*a_D3RbRCKyLQOTqSymheIQ.png?q=20" width="1190" height="270"></p><p><img alt="Image for post" width="1190" height="270"></p></div></div></div></div></figure><p id="0cd6" data-selectable-paragraph="">All in all this was a fun project that I never meant to take two years to actually write about. Over the last year or so, I have discussed this work with the folks at PyPI and they will actually be taking ownership of my packages once I can confirm a final list of which packages are squatted versus the real packages I actually contribute to or own.</p><p id="ce58" data-selectable-paragraph="">All language ecosystems are vulnerable to this type of attack with some being harder to achieve due to things like package namespace. This work was very targeted and did not expand into squatting future libraries for evolution of projects. Supply chain security is very difficult and has been challenging companies with large pockets for many many years.</p><p id="a4f6" data-selectable-paragraph="">Most importantly, THANKS to the folks at PyPI for what they do in making Python packages available to enable folks to develop each day!</p></div></div></section></div></article></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>