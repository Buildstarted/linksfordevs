<!DOCTYPE html>
<html lang="en">
<head>
    <title>
A Simple and Fast Object Mapper -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>A Simple and Fast Object Mapper</h1><div><div class="entry-content"><p>I have a confession to make…I don’t use <a href="https://github.com/AutoMapper/AutoMapper">Automapper</a>. For those who don’t know Automapper is the number one object to object mapper library on NuGet by far. It takes properties from one object and copies them to another. I couldn’t name the second place contender and looking on NuGet, nothing else comes close. This post talks about object mappers, why you <strong>might</strong> not want to use Automapper and introduces a faster, simpler object mapper that you <strong>might</strong> want to use instead.</p><h1>Why use an Object Mapper</h1><p>This is a really good question. Most of the time, it boils down to using Entity Framework. Developers want to be good citizens and not expose their EF Core models in the API surface area because this can have really bad security implications (See overposting <a href="https://docs.microsoft.com/en-us/aspnet/mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application">here</a>).</p><p>I’ve recieved a lot of comments at this point in the conversation saying “Why don’t you use <a href="https://github.com/StackExchange/Dapper">Dapper</a> instead. Then you don’t need model classes for your data layer, you can just go direct to your view model classes via Dapper”. Dapper is really great, don’t get me wrong but it’s not always the right tool for the job, there are distinct disadvantages to using Dapper instead of EF Core:</p><ol><li>I have to write SQL. That’s not so bad (You should learn SQL!) but it takes time to context switch and you often find yourself copying and pasting code back and forth from SQL Management Studio or <a href="https://docs.microsoft.com/en-us/sql/azure-data-studio/what-is?view=sql-server-2017">Azure Data Studio</a> (I’ve started using it, you should too). It just makes development a bit slower, thats all.</li><li>EF Core can be run in-memory, making for very fast unit tests. With Dapper, I have to run functional tests against a real SQL Server database which is slow, brittle and a pain to setup. Before each test, you need to ensure the database is setup with just the right data, so your tests are repeatable, otherwise you end up with flaky tests. Don’t underestimate the power of this point.</li><li>EF Core Migrations can automatically generate the database for me. With Dapper, I have to use external tools like Visual Studio Database Projects, DbUp or Flyway to create my database. That’s an extra headache at deployment time. EF Core lets you cut out the extra time required to manage all of that.</li><li>EF Core Migrations can automatically handle database migrations for me. Migrating databases is hard! Keeping track of what state the database is in and making sure you’ve written the right ALTER TABLE scripts is extra work that can be automated. EF Core handles all that for me. Alternatively, Visual Studio Database Projects can also get around this problem.</li><li>I can switch database provider easily. Ok…ok…nobody does this in the real world and I can only think of one case where this happened. People always mention this point though for some reason.</li><li>EF Core defaults to using the right data types, while on the other hand human beings…have too often chosen the wrong data types and then paid the penalties later on when the app is in production. Use NVARCHAR instead of VARCHAR and DATETIMEOFFSET instead of DATETIME2 or even DATETIME people! I’ve seen professional database developers make these mistakes all the time. Automating this ensures that the correct decision is made all the time.</li><li>EF Core is not that much slower than using Dapper. We’re not talking about orders of magnitude slower as it was with EF6. Throwing away all of the above benefits for slightly better speed is not a tradeoff that everyone can make though, it depends on the app and situation.</li></ol><p>You need to use the right tool for the right job. I personally use Dapper, where there is an existing database with all the migrations etc. already handled by external tools and use EF Core where I’m working with a brand new database.</p><h1>What is good about Automapper?</h1><p>Automapper is great when you have a small project that you want to throw together quickly and the objects you are mapping to and from have the same or similar property names and structure. </p><p>It’s also great for unit testing because once you’ve written your mapper, testing it is just a matter of adding a one liner to test that all the properties in your object have a mapping setup for them. </p><p>Finally if you use Automapper with Entity Framework, you can use the ProjectTo method which uses the property mapping information to limit the number of fields pulled back from your database making the query a lot more efficient. I think this is probably the biggest selling point of Automapper. The alternative is to write your own Entity Framework Core projection.</p><h1>What is wrong with Automapper?</h1><p>Cezary Piatek writes a <a href="https://cezarypiatek.github.io/post/why-i-dont-use-automapper/">very good rundown</a> of some of the problems when using Automapper. I’m not going to repeat what he says but here is a short summary:</p><ol><li>In the real world, mapping between identical or similar classes is not that common.</li><li>If you have similar classes you are mapping between, there is no guarantee that they will not diverge, requiring you to write increasingly complex Automapper code or rewriting the mapping logic without Automapper.</li><li>Finding all usages of a property no longer works when using Automapper unless you explicitly map every property, lowering discoverability.</li><li>If you have a complex scenario, <a href="https://jimmybogard.com/">Jimmy Bogard</a> (the author of the tool) <a href="https://jimmybogard.com/automapper-usage-guidelines/">suggests not using Automapper</a>:<ul><li>“DO NOT use AutoMapper except in cases where the destination type is a flattened subset of properties of the source type”</li><li>“DO NOT use AutoMapper to support a complex layered architecture”</li><li>“AVOID using AutoMapper when you have a significant percentage of custom configuration in the form of Ignore or MapFrom”</li></ul></li><li>If you’re mapping from database models to view models in an API, then dumping your database schema out as JSON makes for a bad API. You usually want more complex nested objects.</li><li>How much time does it really save? Object mapping code is the simplest code a developer can write, I can do it without thinking and knock a few mappings out in a couple of minutes.</li><li>Automapper is complex, it has a massive <a href="https://automapper.readthedocs.io">documentation</a> site just to show you how to use it and just checkout the 29 point list of <a href="https://jimmybogard.com/automapper-usage-guidelines/">guidelines</a> on how to use it. Why should copying values from one object to another need to be so complex?</li></ol><h1>A Simple and Fast Object Mapper</h1><p>I wrote an object mapper library that consists of a couple of interfaces and a handful of extension methods to make mapping objects slightly easier. The API is super simple and very light and thus fast. You can use the <a href="https://www.nuget.org/packages/Boxed.Mapping/">Boxed.Mapping</a> NuGet package or look at the code at on GitHub in the <a href="https://github.com/Dotnet-Boxed/Framework">Dotnet-Boxed/Framework</a> project. Lets look at an example. I want to map to and from instances of these two classes: </p><div id="crayon-5e41fe874ea78751727466" class="crayon-syntax crayon-theme-vs2012-black crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly">public class MapFrom
{
    public bool BooleanFrom { get; set; }
    public DateTimeOffset DateTimeOffsetFrom { get; set; }
    public int IntegerFrom { get; set; }
    public string StringFrom { get; set; }
}

public class MapTo
{
    public bool BooleanTo { get; set; }
    public DateTimeOffset DateTimeOffsetTo { get; set; }
    public int IntegerTo { get; set; }
    public string StringTo { get; set; }
}</textarea></p><div class="crayon-main"><table class="crayon-table"><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-5e41fe874ea78751727466-1"><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">class</span><span class="crayon-h"></span><span class="crayon-e">MapFrom</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">bool</span><span class="crayon-h"></span><span class="crayon-e">BooleanFrom</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-e">DateTimeOffset</span><span class="crayon-h"></span><span class="crayon-e">DateTimeOffsetFrom</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">int</span><span class="crayon-h"></span><span class="crayon-e">IntegerFrom</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">string</span><span class="crayon-h"></span><span class="crayon-e">StringFrom</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-7"><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-9"><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">class</span><span class="crayon-h"></span><span class="crayon-e">MapTo</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-10"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">bool</span><span class="crayon-h"></span><span class="crayon-e">BooleanTo</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-e">DateTimeOffset</span><span class="crayon-h"></span><span class="crayon-e">DateTimeOffsetTo</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">int</span><span class="crayon-h"></span><span class="crayon-e">IntegerTo</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">string</span><span class="crayon-h"></span><span class="crayon-e">StringTo</span><span class="crayon-h"></span><span class="crayon-sy">{</span><span class="crayon-h"></span><span class="crayon-st">get</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-st">set</span><span class="crayon-sy">;</span><span class="crayon-h"></span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea78751727466-15"><span class="crayon-sy">}</span></p></div></td></tr></tbody></table></div></div><p>The implementation for an object mapper using the .NET Boxed Mapper is shown below. Note the IMapper interface which is the heart of the .NET Boxed Mapper. There is also an IAsyncMapper if for any reason you need to map between two objects asynchronously, the only difference being that it returns a Task.</p><div id="crayon-5e41fe874ea9c810383058" class="crayon-syntax crayon-theme-vs2012-black crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly">public class DemoMapper : IMapper&lt;MapFrom, MapTo&gt;
{
    public void Map(MapFrom source, MapTo destination)
    {
        destination.BooleanTo = source.BooleanFrom;
        destination.DateTimeOffsetTo = source.DateTimeOffsetFrom;
        destination.IntegerTo = source.IntegerFrom;
        destination.StringTo = source.StringFrom;
    }
}</textarea></p><div class="crayon-main"><table class="crayon-table"><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-1"><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">class</span><span class="crayon-h"></span><span class="crayon-v">DemoMapper</span><span class="crayon-h"></span><span class="crayon-o">:</span><span class="crayon-h"></span><span class="crayon-v">IMapper</span><span class="crayon-o">&lt;</span><span class="crayon-v">MapFrom</span><span class="crayon-sy">,</span><span class="crayon-h"></span><span class="crayon-e">MapTo</span><span class="crayon-o">&gt;</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">void</span><span class="crayon-h"></span><span class="crayon-e">Map</span><span class="crayon-sy">(</span><span class="crayon-e">MapFrom </span><span class="crayon-v">source</span><span class="crayon-sy">,</span><span class="crayon-h"></span><span class="crayon-e">MapTo </span><span class="crayon-v">destination</span><span class="crayon-sy">)</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">destination</span><span class="crayon-sy">.</span><span class="crayon-v">BooleanTo</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">BooleanFrom</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">destination</span><span class="crayon-sy">.</span><span class="crayon-v">DateTimeOffsetTo</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">DateTimeOffsetFrom</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">destination</span><span class="crayon-sy">.</span><span class="crayon-v">IntegerTo</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">IntegerFrom</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">destination</span><span class="crayon-sy">.</span><span class="crayon-v">StringTo</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">.</span><span class="crayon-v">StringFrom</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></p><p class="crayon-line" id="crayon-5e41fe874ea9c810383058-10"><span class="crayon-sy">}</span></p></div></td></tr></tbody></table></div></div><p>And here is an example of how you would actually map a single object, array or list:</p><div id="crayon-5e41fe874eab4660088534" class="crayon-syntax crayon-theme-vs2012-black crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly">public class UsageExample
{
    private readonly IMapper&lt;MapFrom, MapTo&gt; mapper = new DemoMapper();
    
    public MapTo MapOneObject(MapFrom source) =&gt; this.mapper.Map(source);
    
    public MapTo[] MapArray(List&lt;MapFrom&gt; source) =&gt; this.mapper.MapArray(source);
    
    public List&lt;MapTo&gt; MapList(List&lt;MapFrom&gt; source) =&gt; this.mapper.MapList(source);
}</textarea></p><div class="crayon-main"><table class="crayon-table"><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-5e41fe874eab4660088534-1"><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-t">class</span><span class="crayon-h"></span><span class="crayon-e">UsageExample</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-2"><span class="crayon-sy">{</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"></span><span class="crayon-m">readonly</span><span class="crayon-h"></span><span class="crayon-v">IMapper</span><span class="crayon-o">&lt;</span><span class="crayon-v">MapFrom</span><span class="crayon-sy">,</span><span class="crayon-h"></span><span class="crayon-v">MapTo</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-v">mapper</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-h"></span><span class="crayon-r">new</span><span class="crayon-h"></span><span class="crayon-e">DemoMapper</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-e">MapTo </span><span class="crayon-e">MapOneObject</span><span class="crayon-sy">(</span><span class="crayon-e">MapFrom </span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">mapper</span><span class="crayon-sy">.</span><span class="crayon-e">Map</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-v">MapTo</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"></span><span class="crayon-e">MapArray</span><span class="crayon-sy">(</span><span class="crayon-v">List</span><span class="crayon-o">&lt;</span><span class="crayon-v">MapFrom</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">mapper</span><span class="crayon-sy">.</span><span class="crayon-e">MapArray</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"></span><span class="crayon-v">List</span><span class="crayon-o">&lt;</span><span class="crayon-v">MapTo</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-e">MapList</span><span class="crayon-sy">(</span><span class="crayon-v">List</span><span class="crayon-o">&lt;</span><span class="crayon-v">MapFrom</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-h"></span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"></span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">mapper</span><span class="crayon-sy">.</span><span class="crayon-e">MapList</span><span class="crayon-sy">(</span><span class="crayon-v">source</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></p><p class="crayon-line" id="crayon-5e41fe874eab4660088534-10"><span class="crayon-sy">}</span></p></div></td></tr></tbody></table></div></div><p>I told you it was simple! Just a few convenience extension methods bundled together with an interface that makes it just ever so slightly quicker to write object mapping than rolling your own implementation. If you have more complex mappings, you can compose your mappers in the same way that your models are composed.</p><h1>Performance</h1><p>Keeping things simple makes the .NET Boxed Mapper fast. I put together some benchmarks using Benchmark.NET which you can find <a href="https://github.com/Dotnet-Boxed/Framework/tree/master/Benchmarks/Boxed.Mapping.Benchmark">here</a>. The baseline is hand written mapping code and I compare that to Automapper and the .NET Boxed Mapper.</p><p>I even got <a href="https://stackoverflow.com/questions/46500630/how-to-improve-performance-of-c-sharp-object-mapping-code">a bit of help from the great Jon Skeet himself</a> on how to improve the performance of instantiating an instance when using the generic new() constraint which it turns out is pretty slow because it uses Activator.CreateInstance under the hood.</p><h2>Object to Object Mapping Benchmark</h2><p>This benchmark measures the time taken to map from a MapFrom object to the MapTo object which I show above.</p><figure class="wp-block-image"><img src="https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-1024x1024.png" alt="Simple object to object mapping benchmark" class="wp-image-15648 jetpack-lazy-image" data-lazy-srcset="https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-1024x1024.png 1024w, https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-150x150.png 150w, https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-300x300.png 300w, https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-768x768.png 768w" data-lazy-sizes="(max-width: 1024px) 100vw, 1024px" data-lazy-src="https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-Object-Benchmark-1024x1024.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><figcaption>Simple object to object mapping benchmark</figcaption></figure><div id="crayon-5e41fe874eacc212854409" class="crayon-syntax crayon-theme-vs2012-black crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly">Method       Runtime        Mean  Ratio  Gen 0/1k Op  Allocated Memory/Op
Baseline     Clr        7.877 ns   1.00       0.0178                 56 B
BoxedMapper  Clr       25.431 ns   3.07       0.0178                 56 B
Automapper   Clr      264.934 ns  31.97       0.0277                 88 B
Baseline     Core       9.327 ns   1.00       0.0178                 56 B
BoxedMapper  Core      17.174 ns   1.84       0.0178                 56 B
Automapper   Core     158.218 ns  16.97       0.0279                 88 B</textarea></p><div class="crayon-main"><table class="crayon-table"><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-5e41fe874eacc212854409-1"><span class="crayon-e">Method&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Runtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Mean&nbsp;&nbsp;</span><span class="crayon-e">Ratio&nbsp;&nbsp;</span><span class="crayon-i">Gen</span><span class="crayon-h"></span><span class="crayon-cn">0</span><span class="crayon-o">/</span><span class="crayon-cn">1k</span><span class="crayon-h"></span><span class="crayon-e">Op&nbsp;&nbsp;</span><span class="crayon-e">Allocated </span><span class="crayon-v">Memory</span><span class="crayon-o">/</span><span class="crayon-e">Op</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-2"><span class="crayon-e">Baseline&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">7.877</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.00</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0178</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">56</span><span class="crayon-h"></span><span class="crayon-i">B</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-3"><span class="crayon-e">BoxedMapper&nbsp;&nbsp;</span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">25.431</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">3.07</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0178</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">56</span><span class="crayon-h"></span><span class="crayon-i">B</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-4"><span class="crayon-e">Automapper&nbsp;&nbsp; </span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">264.934</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">31.97</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0277</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">88</span><span class="crayon-h"></span><span class="crayon-i">B</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-5"><span class="crayon-e">Baseline&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">9.327</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.00</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0178</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">56</span><span class="crayon-h"></span><span class="crayon-i">B</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-6"><span class="crayon-e">BoxedMapper&nbsp;&nbsp;</span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">17.174</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.84</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0178</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">56</span><span class="crayon-h"></span><span class="crayon-i">B</span></p><p class="crayon-line" id="crayon-5e41fe874eacc212854409-7"><span class="crayon-e">Automapper&nbsp;&nbsp; </span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">158.218</span><span class="crayon-h"></span><span class="crayon-i">ns</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">16.97</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0.0279</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">88</span><span class="crayon-h"></span><span class="crayon-v">B</span></p></div></td></tr></tbody></table></div></div><h2>List Mapping Benchmark</h2><p> This benchmark measures the time taken to map a List of MapFrom objects to a list of MapTo objects. </p><figure class="wp-block-image"><img src="https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-List-Benchmark-1024x1024.png" alt="alt" class="wp-image-15650 jetpack-lazy-image" data-lazy-srcset="https://rehansaeed.com/wp-content/uploads/sites/2/2019/02/Boxed.Mapping-List-Benchmark-1024x1024.png 1024w, https://rehansaeed.com/wp-content/uploads/sites/2/2019/02/Boxed.Mapping-List-Benchmark-150x150.png 150w, https://rehansaeed.com/wp-content/uploads/sites/2/2019/02/Boxed.Mapping-List-Benchmark-300x300.png 300w, https://rehansaeed.com/wp-content/uploads/sites/2/2019/02/Boxed.Mapping-List-Benchmark-768x768.png 768w" data-lazy-sizes="(max-width: 1024px) 100vw, 1024px" data-lazy-src="https://media.rehansaeed.com/rehansaeed/2019/02/Boxed.Mapping-List-Benchmark-1024x1024.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><figcaption> object list to object list mapping benchmark </figcaption></figure><div id="crayon-5e41fe874eae2030101109" class="crayon-syntax crayon-theme-vs2012-black crayon-font-consolas crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover"><p class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="readonly">Method       Runtime        Mean  Ratio  Gen 0/1k Op  Allocated Memory/Op
Baseline     Clr        1.833 us   1.00       2.0542              6.31 KB
BoxedMapper  Clr        3.295 us   1.80       2.0523              6.31 KB
Automapper   Clr       10.569 us   5.77       2.4872              7.65 KB
Baseline     Core       1.735 us   1.00       2.0542              6.31 KB
BoxedMapper  Core       2.237 us   1.29       2.0523              6.31 KB
Automapper   Core       3.220 us   1.86       2.4872              7.65 KB</textarea></p><div class="crayon-main"><table class="crayon-table"><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"></td><td class="crayon-code"><div class="crayon-pre"><p class="crayon-line" id="crayon-5e41fe874eae2030101109-1"><span class="crayon-e">Method&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">Runtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Mean&nbsp;&nbsp;</span><span class="crayon-e">Ratio&nbsp;&nbsp;</span><span class="crayon-i">Gen</span><span class="crayon-h"></span><span class="crayon-cn">0</span><span class="crayon-o">/</span><span class="crayon-cn">1k</span><span class="crayon-h"></span><span class="crayon-e">Op&nbsp;&nbsp;</span><span class="crayon-e">Allocated </span><span class="crayon-v">Memory</span><span class="crayon-o">/</span><span class="crayon-e">Op</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-2"><span class="crayon-e">Baseline&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">1.833</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.00</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.0542</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">6.31</span><span class="crayon-h"></span><span class="crayon-e">KB</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-3"><span class="crayon-e">BoxedMapper&nbsp;&nbsp;</span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">3.295</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.80</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.0523</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">6.31</span><span class="crayon-h"></span><span class="crayon-e">KB</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-4"><span class="crayon-e">Automapper&nbsp;&nbsp; </span><span class="crayon-i">Clr</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">10.569</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">5.77</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.4872</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">7.65</span><span class="crayon-h"></span><span class="crayon-e">KB</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-5"><span class="crayon-e">Baseline&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">1.735</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.00</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.0542</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">6.31</span><span class="crayon-h"></span><span class="crayon-e">KB</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-6"><span class="crayon-e">BoxedMapper&nbsp;&nbsp;</span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.237</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.29</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.0523</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">6.31</span><span class="crayon-h"></span><span class="crayon-e">KB</span></p><p class="crayon-line" id="crayon-5e41fe874eae2030101109-7"><span class="crayon-e">Automapper&nbsp;&nbsp; </span><span class="crayon-i">Core</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">3.220</span><span class="crayon-h"></span><span class="crayon-i">us</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-cn">1.86</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">2.4872</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">7.65</span><span class="crayon-h"></span><span class="crayon-v">KB</span></p></div></td></tr></tbody></table></div></div><h2>Speed</h2><p>It turns out that Automapper does a really good job on .NET Core in terms of speed but is quite a bit slower on .NET Framework. This is probably down to the intrinsic improvements in .NET Core itself. .NET Boxed is quite a bit faster than Automapper on .NET Framework but the difference on .NET Core is much less at around one and a half times. The .NET Boxed Mapper is also very close to the baseline but is a bit slower. I believe that this is due to the use of method calls on interfaces, whereas the baseline mapping code is only using method calls on concrete classes.</p><h2>Zero Allocations</h2><p>.NET Boxed has zero allocations of memory while Automapper allocates a small amount per mapping. Since object mapping is a fairly common operation these small differences can add up over time and cause pauses in the app while the garbage collector cleans up the memory. There seems to be a trend I’ve seen in .NET for having zero allocation code. If you care about that, then this might help.</p><h1>Conclusions</h1><p>What I’ve tried to do with the .NET Boxed Mapper is fill a niche which I thought that Automapper was not quite filling. A super simple and fast object mapper that’s just a couple of interfaces and extension methods to help you along the way and provide a skeleton on which to hang your code. If Automapper fits your app better, go ahead and use that. If you think it’s useful, you can use the <a href="https://www.nuget.org/packages/Boxed.Mapping/">Boxed.Mapping</a> NuGet package or look at the code at on GitHub in the <a href="https://github.com/Dotnet-Boxed/Framework">Dotnet-Boxed/Framework</a> project.</p><h3 class="jp-relatedposts-headline"><em>Related</em></h3></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>