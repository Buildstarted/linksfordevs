<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Stealing Secrets from Developers using Websockets - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Stealing Secrets from Developers using Websockets - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@stestagg"/>
    <meta property="og:description" content="This is a story of a convoluted, not-very-useful method for extracting codez from unwitting JavaScript developers working on top secret&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/@stestagg/stealing-secrets-from-developers-using-websockets-254f98d577a0"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Stealing Secrets from Developers using Websockets</title>
<div class="readable">
        <h1>Stealing Secrets from Developers using Websockets</h1>
            <div>by https://medium.com/@stestagg</div>
            <div>Reading time: 6-8 minutes</div>
        <div>Posted here: 21 May 2020</div>
        <p><a href="https://medium.com/@stestagg/stealing-secrets-from-developers-using-websockets-254f98d577a0">https://medium.com/@stestagg/stealing-secrets-from-developers-using-websockets-254f98d577a0</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><div><div><div><div><div><p><a rel="noopener" href="https://medium.com/@stestagg?source=post_page-----254f98d577a0----------------------"><img alt="Steve Stagg" src="https://miro.medium.com/fit/c/96/96/1*D_oslcN6GAGj7MfmhZVaew.png" width="48" height="48"></a></p></div></div></div></div><p id="6486" data-selectable-paragraph="">This is a story of a convoluted, not-very-useful method for extracting codez from unwitting JavaScript developers working on top secret projects.</p><p id="073e" data-selectable-paragraph="">A couple of articles have hit the sites recently about websites abusing websocket functionality to port-scan user’s computers’. For example: <a href="https://nullsweep.com/why-is-this-website-port-scanning-me/" target="_blank" rel="noopener nofollow">https://nullsweep.com/why-is-this-website-port-scanning-me/</a>.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*wvWTcXDRaBGg3cxB1bhbHw.jpeg?q=20" width="14600" height="12000" role="presentation"></p><p><img width="14600" height="12000" srcset="https://miro.medium.com/max/552/1*wvWTcXDRaBGg3cxB1bhbHw.jpeg 276w, https://miro.medium.com/max/1000/1*wvWTcXDRaBGg3cxB1bhbHw.jpeg 500w" sizes="500px" role="presentation" src="https://miro.medium.com/max/14600/1*wvWTcXDRaBGg3cxB1bhbHw.jpeg"></p></div></div></div></div></figure><p id="8e88" data-selectable-paragraph="">The reason these techniques work is because browsers allow websockets from public origins to open websockets connections to localhost without many protections.</p><p id="8ed4" data-selectable-paragraph="">This got me thinking. I know that popular JavaScript frameworks use websockets in development to automatically reload pages when content changes. Could a malicious website eaves-drop on that traffic, and find out when developers are saving their code?</p><p id="83db" data-selectable-paragraph="">The reality was slightly worse than I had thought.</p><ol><li id="1bd0" data-selectable-paragraph="">Either set-up, or inject advertising malware into a popular site that front-end developers tend to frequent. Let’s say <a href="http://frontend-overflowstack.com/" target="_blank" rel="noopener nofollow">http://frontend-overflowstack.com/</a></li><li id="df06" data-selectable-paragraph="">On this page, add code that tries to open websockets connections to common ports (scanning 10k ports takes a second or so, so you can be quite generous here)</li><li id="eb6d" data-selectable-paragraph="">If the page manages to open a connection, hold it open, and forward all messages received to your secret database of nefariousness.</li><li id="e511" data-selectable-paragraph="">?</li><li id="a5ef" data-selectable-paragraph="">Profit</li></ol><p id="c550" data-selectable-paragraph="">I’ve hosted a very simple page at: <a href="http://frontend-overflowstack.com/" target="_blank" rel="noopener nofollow">http://frontend-overflowstack.com/</a>. On load, it tries to connect a websocket to every port between 2,000 and 10,000 on the visitors computer (barring a few that Firefox doesn’t allow). If a port connects, then it listens to that port and outputs any messages received. <strong>This page does not save or otherwise transmit any captured data, it is only displayed temporarily on screen.</strong></p><p id="09d9" data-selectable-paragraph="">If any output appears on this page, an actually malicious site could easily send that output to any server it wants.</p><h2 id="aeb9" data-selectable-paragraph=""><strong>Generating Data</strong></h2><p id="8bda" data-selectable-paragraph="">To test this concept out, we need a simple web server that uses hot-reloading. This is the simplest I could come up with:</p><figure><div></div></figure><p id="c62b" data-selectable-paragraph="">Which, when run, starts up a server on port 3000, a websocket server on port 9856, and sends a message: <code>reload</code> to any connected websocket clients every 5 seconds.</p><p id="b1ec" data-selectable-paragraph="">If we fire up our sniffer site, the following appears:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*tlQa-JTHf2dR_AztcmsbTA.png?q=20" width="756" height="671" role="presentation"></p><p><img width="756" height="671" srcset="https://miro.medium.com/max/552/1*tlQa-JTHf2dR_AztcmsbTA.png 276w, https://miro.medium.com/max/1104/1*tlQa-JTHf2dR_AztcmsbTA.png 552w, https://miro.medium.com/max/1280/1*tlQa-JTHf2dR_AztcmsbTA.png 640w, https://miro.medium.com/max/1400/1*tlQa-JTHf2dR_AztcmsbTA.png 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="c47b" data-selectable-paragraph="">So frontend-overflowstack.com is directly eaves-dropping on reload messages being sent by a local dev server to my local browser.</p><p id="7f9d" data-selectable-paragraph="">At this stage, it’s possible to sit back and gleefully count how many times each visitor to our site makes changes to their local JavaScript code, but can we use this to get more info?</p><h2 id="c3c4" data-selectable-paragraph="">The plot thickens</h2><p id="7e1b" data-selectable-paragraph="">The majority of front-end development these days seems to involve using React, and typically this involves running the <em>webpack-dev</em> server, which includes its own, more fancy web-socket interface.</p><p id="fab2" data-selectable-paragraph="">This server shares much more, only slightly interesting, data over its websocket. Demonstrating this is as simple as invoking create-react-app:</p><pre><span id="7962" data-selectable-paragraph="">$ npx create-react-app test<br>$ cd test/<br>$ npm start</span></pre><p id="eeff" data-selectable-paragraph="">If we run this, and look at our evil site again:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*Pf5GvjHGE78GkFsGwU3CfQ.png?q=20" width="757" height="414" role="presentation"></p><p><img width="757" height="414" srcset="https://miro.medium.com/max/552/1*Pf5GvjHGE78GkFsGwU3CfQ.png 276w, https://miro.medium.com/max/1104/1*Pf5GvjHGE78GkFsGwU3CfQ.png 552w, https://miro.medium.com/max/1280/1*Pf5GvjHGE78GkFsGwU3CfQ.png 640w, https://miro.medium.com/max/1400/1*Pf5GvjHGE78GkFsGwU3CfQ.png 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="cbe4" data-selectable-paragraph="">Instantly there’s more data being shown, we’re getting hashes and status messages, all the useless infos.</p><p id="7a42" data-selectable-paragraph="">But what happens when the developer makes a typo? The webpack dev server helpfully tries to send a bunch of debugging and stack information to the developer’s screen, by way of its websocket connection.</p><p id="f73e" data-selectable-paragraph="">Luckily, our evil site can see this too:</p></div></div><div><div><p id="5504" data-selectable-paragraph="">Now things are getting juicy. We’ve got code snippets, paths to files, locations, all sorts of bits of useful info.</p><p id="ee83" data-selectable-paragraph="">It gets even better if eventually the Dev accidentally typos on a line containing useful data:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*AYuqFr8n8-_nhrqxCc0LqA.png?q=20" width="782" height="558" role="presentation"></p><p><img width="782" height="558" srcset="https://miro.medium.com/max/552/1*AYuqFr8n8-_nhrqxCc0LqA.png 276w, https://miro.medium.com/max/1104/1*AYuqFr8n8-_nhrqxCc0LqA.png 552w, https://miro.medium.com/max/1280/1*AYuqFr8n8-_nhrqxCc0LqA.png 640w, https://miro.medium.com/max/1400/1*AYuqFr8n8-_nhrqxCc0LqA.png 700w" sizes="700px" role="presentation"></p></div></div></div></div></figure><p id="4a8d" data-selectable-paragraph="">Now we’ve got a copy of this developer’s AWS Dev credentials. Quick, fire up the bitcoin miners!</p><p id="b4e7" data-selectable-paragraph="">Anatomy of the “Attack”</p><p id="2fa7" data-selectable-paragraph="">No technical design is complete without some form of diagram. Here’s how this works, graphically:</p></div></div><div><div><p id="f812" data-selectable-paragraph="">(To simplify the diagram, I have omitted the local web server running, and pretended that the websocket server originates from within the editor directly)</p><p id="633d" data-selectable-paragraph="">A malicious web page on some browser tab silently connects to open websockets on the user’s machine. When sensitive data is sent over that socket (from a process that expects to be communicating over a local-only channel) the website can receive that message data, and forward it on to any external database.</p><h2 id="41cb" data-selectable-paragraph="">Limiting factors</h2><p id="5186" data-selectable-paragraph="">In all seriousness, this attack vector is pretty slim. You’ve got to tempt unwitting users to visit your site, and to stay on it while they’re developing JS code.</p><p id="ffac" data-selectable-paragraph="">You’ve then got to wait to get lucky to glean morsels of data from their coding mistakes, to maybe find an opening that allows you to profit from this data.</p><h2 id="ee08" data-selectable-paragraph="">Compounding Considerations</h2><p id="79bb" data-selectable-paragraph="">However, we’ve already seen that various sites are already using websocket port-scanning technology without much in the way of general developer awareness. Given that JS tooling tends to use a small number of well-known ports, writing a script to exfiltrate react Dev traffic subtly would not be particularly hard.</p><p id="8b2b" data-selectable-paragraph="">Imagine an internal developer working for <strong>Twitbook</strong> just pressing save in their editor and causing that access token or internal server address to be leaked to the wrong audience.</p><p id="6e1d" data-selectable-paragraph="">The <em>slightly</em> scary aspect of this is that a reasonable developer should have a general expectation that pressing save in their code editor of choice should have effectively 0 chance of causing data to be leaked to a third-party web service. This attack raises that chance enough to be a tiny bit concerning.</p><h2 id="4310" data-selectable-paragraph="">Remediation</h2><p id="1832" data-selectable-paragraph="">I pursued this vector of trying to intercept JavaScript hot-reloading mechanisms because it’s really the only general use of websockets that I’m familiar with. <em>Discord also uses websockets, but a passing glance at that didn’t yield any obvious results, as that channel is designed with the public internet in mind.</em></p><p id="1cac" data-selectable-paragraph="">It’s worrying that just this one simple use-case of a one-way communication channel for reloading has exposed so much potential information to bad websites.</p><p id="b5d9" data-selectable-paragraph="">Given this, it’s likely that other uses of websockets (for data not designed for the public internet) may be similarly compromised.</p><p id="b423" data-selectable-paragraph="">Arguably the webpack-dev server should do some authentication or that alternate browser communication channels be used for hot-reloading (I believe this is already being planned for other reasons).</p><p id="60c7" data-selectable-paragraph="">It certainly feels like it’s the way that browsers/web standards implement origin policies for websockets is surprising, and is resulting in software designed for local-only development to be exposed to the public internet in a non-ideal way.</p><p id="86d1" data-selectable-paragraph="">I would expect any fix to focus on implementing extra controls in the browsers.</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>