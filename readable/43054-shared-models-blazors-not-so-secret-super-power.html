<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Shared models - Blazor&#x27;s (not so) secret super power -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Shared models - Blazor's (not so) secret super power</h1><div><div id="" class="post-content"><p>If you’ve built applications using javascript and some form of Web API, you’ve probably run into the “separate models” problem.</p><p>This is where you define one model in the backend (in .NET, typically a C# class) and return instances of it via your API (serialised to JSON to send over the network).</p><pre><code class="language-csharp">public class CartLineItem
{
    public int Id { get; set; }
    public string Title { get; set; }
    public string Image { get; set; }
    public decimal Price { get; set; }
}
</code></pre><p>So far, so simple.</p><p>Now you want to retrieve that data and use it in your javascript application.</p><p>So you make your network call, retrieve the model as JSON and whack it into a javascript (or indeed Typescript) object…</p><pre><code class="language-javascript">const cartLineItem = await httpGet('/api/cart/line/1');
</code></pre><p>This example uses a little httpGet helper, but essentially takes the JSON and deserializes it into a javascript object.</p><p>If you’re using Typescript, you might even specify the structure of that object (so you get handy intellisense and compile errors if you try to access a property that doesn’t exist).</p><pre><code class="language-typescript">interface ICartLineItem {
    Id: number;
    Title: string;
    Image: string;
    Price: number;
}
</code></pre><p>Now at this point, everything works and all is well with the world.</p><p>But, you may have noticed web applications have this nasty habit of changing and this architecture makes changes a little difficult.</p><p>We’ve ended up with two versions of our model, separated by that funny thing called the internet, sitting between your browser and your API and this is where things get a bit… messy.</p><h2 id="what-if-your-backend-model-changes">What if your backend model changes?</h2><p>Say you decide Image is a terrible property name and want to change it to ImagePath; if you’re feeling a bit cavalier you might just go ahead, say to hell with the consequences and use the refactoring tools in your IDE to change it there and then (after all, I’m all for improving the readability of code)…</p><p>But what now for your poor javascript application?</p><p>It doesn’t know you’ve improved your model; all it knows is it suddenly can’t find anything called Image on your object.</p><p>The result? A sea of errors in your browser console…</p><p>A simple change has turned into some kind of crazy game of whack-a-mole; bugs are popping up all over the place and the only way to fix them is to hunt each one down and update the reference to Image.</p><h2 id="how-does-blazor-handle-it">How does Blazor handle it?</h2><p>Blazor has an obvious answer to this problem of keeping two models in sync; don’t use two models!</p><p>Remember that CartLineItem class we mentioned earlier?</p><p>In Blazor, you would populate that model with data (presumably from a database or some-such) but then, when it comes to using the model in your components, you can reference <code>CartLineItem</code> directly.</p><p>Here’s an example with Blazor Server:</p><pre><code class="language-csharp">&lt;h3&gt;Your Shopping Cart&lt;/h3&gt;
    
@foreach (var line in Lines)
{
    &lt;Item details="@line"/&gt;
}

@code {

    public List&lt;CartLineItem&gt; Lines;

    protected override void OnInitialized()
    {
        Lines = _cartService.ForLoggedInCustomer();
    }
}
</code></pre><p>We can retrieve a list of lines using <code>_cartService</code> then assign those to a field. In our markup we can loop over that list of lines and bind each one to whatever we like (a component called Item in this case).</p><p>Blazor WebAssembly manages a similar trick even though it’s using network calls to retrieve the data:</p><pre><code class="language-csharp">@inject HttpClient Http

&lt;h3&gt;Your Shopping Cart&lt;/h3&gt;

@foreach (var line in Lines)
{
    &lt;Item details="@line"/&gt;
}

@code {

    public CartLineItem[] Lines;

    protected override async Task OnInitializedAsync()
    {
        Lines = await Http.GetJsonAsync&lt;CartLineItem[]&gt;("api/cart");
    }
}
</code></pre><p>This will take the JSON returned via the network call and cast it to an array of <code>CartLineItem</code>.</p><p>In either case, if you decide to rename the Image property on <code>CartLineItem</code> now, the compiler will catch any code which is still using the old property name and your application won’t even compile.</p><p>Plus, you can use your IDE’s refactoring tools to rename Image and automatically fix all references to it.</p><p>Give it a go for yourself; spin up a new Blazor project and you’ll find a class called <code>WeatherForecast</code>. Try just renaming one of the properties and then try to compile your application.</p><p>You’ll see an error like this:</p><p><strong>‘WeatherForecast’ does not contain a definition for ImagePath’</strong></p><p>In Visual Studio you can double-click the error and it will take you straight to the place you need to change:</p><p><img src="https://jonhilton.net/img/1-shared-model/2019-11-24-17-09-31.png" alt=""></p><p>Fix the red squiggle and you’re done!</p><h3>Next up</h3></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>