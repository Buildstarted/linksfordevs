<!DOCTYPE html>
<html lang="en">
<head>
    <title>
A Quantum Random Number Generator for .NET: The quantum measurement problem and many-worlds approach -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>A Quantum Random Number Generator for .NET: The quantum measurement problem and many-worlds approach</h1>
    <div class="post-content">
<p>I&apos;ve been listening to a lot of <a href="https://www.preposterousuniverse.com">Sean Carroll&apos;s Mindscape podcast</a> recently, and in <a href="https://www.preposterousuniverse.com/podcast/2019/07/15/55-a-conversation-with-rob-reid-on-quantum-mechanics-and-many-worlds/">a recent episode with Rob Reid</a> he discussed the Everettian or &quot;many-worlds&quot; approach to explaining the measurement problem in quantum mechanics. </p>
<p>Towards the end of the episode they discussed an <a href="https://apps.apple.com/us/app/universe-splitter/id329233299">iPhone app</a> that uses a quantum device connected to an HTTP API to &quot;split the universe&quot; by triggering a quantum measurement. Whether you believe the many-worlds theory or not, there&apos;s something very cool about having a quantum device just an HTTP call away&#x2026; So I threw together an <code>HttpClient</code> to call the HTTP API to generate <em>truly random</em> numbers. </p>
<p>And voila: you have a quantum random generator! And as an added bonus, you&apos;ve split the universe multiple times to get it. The focus of this post isn&apos;t the <code>HttpClient</code> itself - that&apos;s a toy to scratch an itch more than anything else. Instead, I&apos;m trying to put down my (exceedingly-basic) understanding of the quantum measurement problem, and the many-worlds approach.</p>
<blockquote>
<p>This is obviously a departure from my usual posts. I&apos;ve always been casually interested in physics but I&apos;m absolutely not a physicist, so I strongly suggest taking everything I say with a pinch of salt and imprecision! It&apos;s also a <em>very</em> brief consideration of the subject matter - I&apos;ve added some podcast references at the end of the post from where I gleaned most of my understanding in this area!</p>
</blockquote> <p>So what is quantum mechanics? </p>
<p>Quantum mechanics is the single most successful theory we have to explain the world. There&apos;s no evidence from experimental physics that suggests there&apos;s a flaw in its description of the way the world works. It seems to be the way nature <em>works</em>.</p>
<p>At its heart is the <a href="https://en.wikipedia.org/wiki/Wave_function"><em>wave equation</em></a> that describes the &quot;quantum state&quot; of the system. In classic Newtonian mechanics, the &quot;state&quot; of a system (e.g. a particle) is its location and its velocity - if you know those two properties, then you can completely determine the behaviour of the system by following Newton&apos;s laws. The wave equation is the quantum state, and it evolves according to the <a href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger_equation">Schr&#xF6;dinger equation</a>.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/b/b0/Wave_packet_%28dispersion%29.gif" alt="A wave function corresponding to a particle traveling freely through empty space"></p>
<p>You can think of the wave equation as a cloud of possibilities. <a href="https://www.preposterousuniverse.com/podcast/2019/07/15/55-a-conversation-with-rob-reid-on-quantum-mechanics-and-many-worlds/">As Sean puts it</a>:</p>
<blockquote>
<p>The wave function you should think of as a sort of a machine. You ask it a question, &#x201C;Where is the electron?&#x201D; For example. And it will say, &#x201C;With a certain probability you will find the following answers to your question.&#x201D; If all you care about is the position of one electron, then the wave function at every point in space has a value, and that value tells you the probability of seeing the electron there.</p>
</blockquote>
<p>One of the big questions is: what actually _is_ the wave function? Is it describing a behaviour we observe, or is it something more fundamental? </p>
<p>One of the biggest shifts for me was understanding that electrons aren&apos;t little balls. You can&apos;t think of it as a little ball that has a 90% chance to be in one place, and a 10% chance in the other place. That implies that the ball is always <em>somewhere</em> we just don&apos;t know where. The answer is that it&apos;s not really a ball. It&apos;s a weird wave thing that&apos;s everywhere at once (with varying possibilities).</p>
<p><img srcset="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Hydrogen_Density_Plots.png/264px-Hydrogen_Density_Plots.png 264w, https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Hydrogen_Density_Plots.png/660px-Hydrogen_Density_Plots.png 660w, https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Hydrogen_Density_Plots.png/1126px-Hydrogen_Density_Plots.png 1126w, https://upload.wikimedia.org/wikipedia/commons/e/e7/Hydrogen_Density_Plots.png 2200w" sizes="(max-width: 800px) 100vw, 780px" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Hydrogen_Density_Plots.png/660px-Hydrogen_Density_Plots.png" alt="2d cross sections of the probability density of various states of the hydrogen atom"></p>
<p>But how can that be so? We have huge amounts of technology that rely on our ability to manipulate electrons and other particles just as though they <em>are</em> little balls. How can both descriptions be correct? </p>
<p>That brings us to the measurement problem.</p> <p>The wave equation isn&apos;t just a fancy way of thinking about probabilities &#x2013; the implication is that the electron <em>actually is in both places at once</em>. It&apos;s in a &quot;superposition&quot; of all the possible states. But it&apos;s never possible for us to &quot;see&quot; an electron in that superposition state. When you <em>measure</em> or <em>observe</em> the electron, you only ever see it in a single place. You only ever <em>see</em> it as a particle. </p>
<p>It seems then, that the act of looking at an electron causes it to behave differently, it &quot;collapses the wave function&quot;. It&apos;s like a game of musical statues - everything is different (people are moving / the electron is behaving like a wave) until you look at it, and suddenly everyone acts casual (people freeze / the electron behaves like a particle).</p>
<p><img src="https://media.giphy.com/media/10bSDvU0lpSous/giphy.gif" alt="Wayne acting casual"></p>
<p>One of the big problems with this is it makes an &quot;observer&quot; a first-class citizen in physics. But what are the requirements to be an observer? Does it have to be a person? Is a camera an observer? What about a cat, or an amoeba? It&apos;s weird&#x2026;</p>
<p>The question of how (of <strong>if</strong>) the wave function collapses when you measure a quantum system is termed <a href="https://en.wikipedia.org/wiki/Measurement_problem">the measurement problem</a>. There are a number of different approaches that attempt to address this problem, for example:</p>
<ul>
<li>The <a href="https://en.wikipedia.org/wiki/Copenhagen_interpretation">Copenhagen interpretation</a> which appears to say &quot;it doesn&apos;t matter, the math works, stop complaining and do some real work&quot; &#x1F937;&#x200D;&#x2642;&#xFE0F;.</li>
<li><a href="https://en.wikipedia.org/wiki/De_Broglie%E2%80%93Bohm_theory">Bohmian mechanics</a> suggests the wave function is only <em>part</em> of the solution - there&apos;s extra hidden variables we don&apos;t know about.</li>
<li><a href="https://en.wikipedia.org/wiki/Ghirardi%E2%80%93Rimini%E2%80%93Weber_theory">Dynamical collapse theories</a> suggest that wave function collapse happens spontaneously, but that the collapse of a single particle initiates the collapse of the entire measurement apparatus.</li>
<li><a href="https://en.wikipedia.org/wiki/Many-worlds_interpretation">Hugh Everett&apos;s many-worlds interpretation</a> suggests the wave function never collapses, rather that the universe &quot;splits in two&quot; - one in which the electron is in position A, one in which the electron is in position B.</li>
</ul>
<p>This many-worlds approach is the one favoured by Sean Carroll, and is the one of interest here.</p> <p>The many-worlds approach is in many ways the most mind-bending option. Don&apos;t be surprised if your gut reaction is that it&apos;s prosperous mumbo-jumbo! I&apos;ll try and explain as I best I understand it.</p>
<p>The many-worlds approach suggests that when you see the wave function <em>appear</em> to collapse (due to an observation) it is actually the universe &quot;splitting&quot; into two branches. One in which the electron was in position A and one in which it was in position B.</p>
<p>So what is an observation in the many-worlds approach? Everett said that the universe splits when a system <a href="https://en.wikipedia.org/wiki/Quantum_entanglement">becomes entangled</a> with its environment (it <a href="https://en.wikipedia.org/wiki/Quantum_decoherence">decoheres</a>). Any interaction between two systems will cause decoherance, and hence will cause the universe to split.</p>
<p>But seeing as we&apos;re part of this universe, we (and our measuring equipment) are inherently quantum too! So any interaction we have with fundamental particles will inevitably be a quantum interaction, and the universe splits in two. In this universe, you observe the electron in position A for example, but in the other branch of the universe you observe it in position B. So in summary an &quot;observation&quot; is any time you cause a quantum interaction Or to use the famous <a href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger%27s_cat">Schr&#xF6;dinger&apos;s cat thought experiment</a>, in one universe the cat is alive, in the other it&apos;s asleep (no cats are harmed in my thought experiments).</p>
<picture>
<source srcset="https://upload.wikimedia.org/wikipedia/commons/c/c8/Schroedingers_cat_film.svg" type="image/svg+xml">
<img src="/content/images/2019/qrng_banner.png" alt="Schr&#xF6;dinger&apos;s Cat, many worlds interpretation, with universe branching">
</picture>
<p>I haven&apos;t succeeded in getting my head fully around this yet. Both of the universes are &quot;here&quot; in some sense. The theory is not suggesting the universes are spatially distant (as in some multiverse theories), or that they&apos;re &quot;wrapped up&quot; in some higher dimensions (as in string theory). They&apos;re in the same &quot;place&quot; but evolving separately, and can&apos;t contact each other. Technically, they&apos;re two different vectors in Hilbert space, but that doesn&apos;t mean a lot to me conceptually!</p>
<p>There&apos;s a <em>lot</em> more to the theory that is way beyond my capabilities, but the interesting notion is that <em>every</em> time you have a quantum interaction, you branch the wave function and the universe &quot;splits in two&quot;. </p>
<p>This is the principle that the <a href="https://apps.apple.com/us/app/universe-splitter/id329233299">Universe Splitter iPhone app</a> relies on.</p> <p>The Universe Splitter app is essentially a front-end to a <a href="http://www.idquantique.com/random-number-generation/">&quot;Quantis&quot; brand quantum device made by ID Quantique</a>. This device sends a photon towards a semi-reflective mirror, so that 50% of the time the photon passes through the mirror, and 50% of the time it is reflected. </p>
<figure>
<picture>
<source srcset="https://buff.ly/content/images/2019/qrng.svg" type="image/svg+xml">
<img src="/content/images/2019/qrng.png" alt="QRNG based on a Polarising Beam Splitter (PBS)">
</picture>
<figcaption>QRNG based on a Polarising Beam Splitter (PBS). Figure from <a href="https://arxiv.org/abs/1311.4547">arXiv:1311.4547 [quant-ph]</a>.</figcaption>
</figure>
<p>Since this is a quantum observation, then every time the device fires the universe splits in two &#x2013; one branch in which the photon was reflected, and one in which it passed through! That&apos;s the premise of the Universe Splitter app. If you commit to doing action A if the photon is reflected, and action B if it transmits, then you have created two separate universes: one in which you did action A, and one in which you did action B!</p>
<p>This is quite a cute concept, but quantum randomness has a &quot;real life&quot; use too. It is the best (and only) source of <em>true</em> randomness. Radioactive decay is another source of randomness that can be traced back to the same quantum origin.</p>
<p>So I got thinking - why don&apos;t we have a quantum random generator in .NET? Sure, you can purchase a quantum random generator, and communicate with it over USB etc. But I want a web service! After a bit of hunting, I found (what I assume) is the back-end the universe splitter app is using - an API provided by <a href="https://ethz.ch/en.html">ETH Z&#xFC;rich</a>.</p> <p><a href="http://qrng.ethz.ch/">The &quot;quantum random numbers as a service, QRNGaaS&quot;</a> allows you to call a very simple rest API and obtain random numbers generated using a <a href="http://www.idquantique.com/random-number-generation/">Quantis random number generator</a>.</p>
<p>The API is <em>very</em> simple - you send a GET request, and you get back random numbers. For example, you can request 10 numbers between 0 and 9 (inclusive)</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> http://random.openqu.org/api/randint?size<span class="token operator">=</span>10<span class="token operator">&amp;</span>min<span class="token operator">=</span>0<span class="token operator">&amp;</span>max<span class="token operator">=</span>9
</code></pre>
<p>And you&apos;ll get JSON similar to the following</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>There&apos;s also an API for <a href="http://qrng.ethz.ch/http_api/#floating-point-numbers">returning floating point numbers</a>, and <a href="http://qrng.ethz.ch/http_api/#random-bytes">base64 encoded bytes</a>. Unfortunately, I couldn&apos;t get the bytes API to work (<code>500</code> Internal Server Error).</p>
<p>Creating a .NET API to call this endpoint is pretty trivial. The code below is very much thrown together - it doesn&apos;t have any error checking, it creates its own <code>HttpClient</code> instead of having one injected via the constructor, it assumes the content will always be the expected format etc. But it works! </p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuantumRandomNumberGenerator</span>
<span class="token punctuation">{</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">HttpClient</span> _httpClient<span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token function">QuantumRandomNumberGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> _httpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClient</span> <span class="token punctuation">{</span> BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;http://random.openqu.org/api/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">GetIntegers</span><span class="token punctuation">(</span><span class="token keyword">int</span> min<span class="token punctuation">,</span> <span class="token keyword">int</span> max<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> url <span class="token operator">=</span> $<span class="token string">&quot;randint?size={size}&amp;min={min}&amp;max={max}&quot;</span><span class="token punctuation">;</span> <span class="token keyword">var</span> stream <span class="token operator">=</span> <span class="token keyword">await</span> _httpClient<span class="token punctuation">.</span><span class="token function">GetStreamAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> document <span class="token operator">=</span> <span class="token keyword">await</span> JsonDocument<span class="token punctuation">.</span><span class="token function">ParseAsync</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> document <span class="token punctuation">.</span>RootElement <span class="token punctuation">.</span><span class="token function">GetProperty</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">EnumerateArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span><span class="token function">GetInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This example uses the new System.Text.Json library in .NET Core 3.0 to efficiently parse the JSON response and return the array of integers. If you want to learn more about System.Text.Json I suggest <a href="https://devblogs.microsoft.com/dotnet/try-the-new-system-text-json-apis/">reading the intro blog post</a>. I also liked <a href="https://stu.dev/a-look-at-jsondocument/">Stuart Lang&apos;s introduction</a>.</p>
<p>With our new <code>QuantumRandomNumberGenerator</code> defined, we can now generate truly random numbers:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> qrng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QuantumRandomNumberGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token keyword">await</span> qrng<span class="token punctuation">.</span><span class="token function">GetIntegers</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
<p>So, should you replace all your calls to <code>RandomNumberGenerator</code> with your shiny new <code>QuantumRandomNumberGenerator</code>. No, please don&apos;t. You really don&apos;t need true randomness in most places + the cost of calling an HTTP API for every new random number is clearly an issue. Add in the fact that it&apos;s a free service, no doubt exposed as a curiosity rather than providing any sorts of guarantees. Plus the fact you can only call the API over HTTP, not HTTPS. So please, don&apos;t put this into production. &#x1F609;</p>
<p>But do have fun thinking about <em>all those universes you&apos;re creating</em>. In one of them, the random list of numbers I generated above is all 0s, and in another, they&apos;re all 255s! &#x1F92F;</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>