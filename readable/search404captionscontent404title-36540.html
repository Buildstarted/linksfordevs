<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Out-of-memory exception in a managed application that&#x27;s running on the 64-bit .NET Framework - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Out-of-memory exception in a managed application that&#x27;s running on the 64-bit .NET Framework - linksfor.dev(s)"/>
    <meta property="og:description" content="Describes an issue that causes a managed application that targets the .NET Framework 4.6.1 to throw an out-of-memory exception from the CLR. Workarounds are provided."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://support.microsoft.com/en-gb/help/3152158/out-of-memory-exception-in-a-managed-application-that-s-running-on-the"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Out-of-memory exception in a managed application that&#x27;s running on the 64-bit .NET Framework</title>
<div class="readable">
        <h1>Out-of-memory exception in a managed application that&#x27;s running on the 64-bit .NET Framework</h1>
            <div>Reading time: 5-7 minutes</div>
        <div>Posted here: 19 Sep 2019</div>
        <p><a href="https://support.microsoft.com/en-gb/help/3152158/out-of-memory-exception-in-a-managed-application-that-s-running-on-the">https://support.microsoft.com/en-gb/help/3152158/out-of-memory-exception-in-a-managed-application-that-s-running-on-the</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div ng-class="{'container-fluid': fluidContainer}" ng-if="article &amp;&amp; !isHtmlSnippet">

        <div data-grid="container stack-2">
            <div data-grid="col-10">

                <!-- ngIf: isGwt -->

                <!-- ngIf: isGenericArticle --><div ng-if="isGenericArticle" generic-article="" article="article"><div data-grid="col-12 pad-12x">
    <div data-grid="container">
        <!-- ngIf: !noChrome && $root.isBannerInlineFlight -->
        <header data-grid="col-12" role="presentation">
            <!-- ngIf: article.details.heading --><!-- end ngIf: article.details.heading -->
            <!-- ngIf: !article.details.heading -->
            
            <!-- ngIf: article.details.products.length || article.details.supportAreaPathNodes.length --><applies-to products="article.details.products" saps="article.details.supportAreaPathNodes" ng-if="article.details.products.length || article.details.supportAreaPathNodes.length"><!-- ngIf: vm.appliesTo.length --><div id="applies-to" ng-if="vm.appliesTo.length"> 
    <p><span ng-bind-html="(vm.contentProperties.appliesToProductsFormat | compassFormat: {'products': ''})">Applies to: </span></p><!-- ngRepeat: productName in vm.appliesTo track by $index --><p><span ng-repeat="productName in vm.appliesTo track by $index" itemprop="about" ng-show="$index < 3 || vm.showMore" aria-hidden="false">Microsoft .NET Framework 4.6.1</span></p><!-- end ngRepeat: productName in vm.appliesTo track by $index -->
    <!-- ngIf: vm.appliesTo.length > 3 --> 
</div><!-- end ngIf: vm.appliesTo.length --></applies-to><!-- end ngIf: article.details.products.length || article.details.supportAreaPathNodes.length -->
            <hr>
        </header>
    </div>
</div>

<div data-grid="col-12 pad-12x">
    <div data-grid="container">

        <!-- ngIf: !noChrome && ($root.showDeeplinkExperience && $root.isDeeplinkBelowTitleFlight) -->

        <!-- ngIf: article.details.subType === 'release-notes' -->

        <!-- ngIf: article.details.subType === 'error-status-code' && article.errorStatusCodes && article.errorStatusCodes.length > 5 -->

        <!-- ngIf: hotfixLink -->

        <!-- ngIf: article.details.isMachineTranslated === true || article.details.isMachineTranslated === 'true' -->
        <!-- ngIf: article.details.isInternalContent === true || article.details.isInternalContent === 'true' -->

        <!-- ngIf: article.gdsProducts.length > 0 -->
        <!-- ngIf: isRetired -->

        <!-- ngIf: article.details.supportAreaPathNodes.length --><!-- end ngIf: article.details.supportAreaPathNodes.length -->

        <div>
            <div content-section-list="article.details.body" itemprop="articleBody"><!-- ngRepeat: section in contentSectionList track by $index --><!-- ngIf: !isString && hasContent() --><div ng-repeat="section in contentSectionList track by $index" ng-if="!isString &amp;&amp; hasContent()">
    <div content-section="section"><!-- ngIf: typeof(contentSection) !== 'string' --><section data-grid="col-12" ng-if="typeof(contentSection) !== 'string'" ng-show="shouldShow" applies-to-saps="[]" ng-attr-id="{{contentSection.meta.id}}" ng-class="{'internal-content': isInternalSection(), 'flighted-content': shouldHighlightFlight }" data-before="" aria-hidden="false">
    <!-- ngIf: isInternalSection() -->
    <!-- ngIf: contentSection.title --><p id="section-0" ng-if="contentSection.title" data-js-in-page-navigation-anchor="section-0">
        <h2 ng-bind-html="contentSection.title"> Symptoms</h2>
        <hr>
        <!-- ngIf: contentSection.subtitle -->
    </p><!-- end ngIf: contentSection.title -->
    <!-- ngIf: contentSection.content && contentSection.content.length > 0 --><div ng-if="contentSection.content &amp;&amp; contentSection.content.length > 0">
        <!-- ngRepeat: content in contentSection.content track by $index --><div ng-attr-data-grid="{{getStyleClass()}}" ng-repeat="content in contentSection.content track by $index" data-grid="col-12">
            <div compile="content" data-grid="col-12"><div><p>You have a managed application that targets the 64-bit Microsoft .NET Framework 4.6.1. This application throws an out-of-memory exception from the CLR with the following specific message:</p><p>OutOfMemoryException: "Insufficient memory within specified address space range to continue the execution of the program."</p></div></div>
            <!-- ngIf: contentSection.meta.type != 'single-column' && !$last -->
        </div><!-- end ngRepeat: content in contentSection.content track by $index -->
    </div><!-- end ngIf: contentSection.content && contentSection.content.length > 0 -->
</section><!-- end ngIf: typeof(contentSection) !== 'string' --></div>
</div><!-- end ngIf: !isString && hasContent() --><!-- end ngRepeat: section in contentSectionList track by $index --><!-- ngIf: !isString && hasContent() --><div ng-repeat="section in contentSectionList track by $index" ng-if="!isString &amp;&amp; hasContent()">
    <div content-section="section"><!-- ngIf: typeof(contentSection) !== 'string' --><section data-grid="col-12" ng-if="typeof(contentSection) !== 'string'" ng-show="shouldShow" applies-to-saps="[]" ng-attr-id="{{contentSection.meta.id}}" ng-class="{'internal-content': isInternalSection(), 'flighted-content': shouldHighlightFlight }" data-before="" aria-hidden="false">
    <!-- ngIf: isInternalSection() -->
    <!-- ngIf: contentSection.title --><p id="section-1" ng-if="contentSection.title" data-js-in-page-navigation-anchor="section-1">
        <h2 ng-bind-html="contentSection.title"> Cause</h2>
        <hr>
        <!-- ngIf: contentSection.subtitle -->
    </p><!-- end ngIf: contentSection.title -->
    <!-- ngIf: contentSection.content && contentSection.content.length > 0 --><div ng-if="contentSection.content &amp;&amp; contentSection.content.length > 0">
        <!-- ngRepeat: content in contentSection.content track by $index --><div ng-attr-data-grid="{{getStyleClass()}}" ng-repeat="content in contentSection.content track by $index" data-grid="col-12">
            <div compile="content" data-grid="col-12"><p>This out-of-memory exception is propagated by the CLR when the code manager subsystem cannot allocate memory within a specific address space range for jump stubs. (These jump stubs correspond to the method that calls among DLLs that are located 2 GB or more apart in the address space.) There must be space within a 2-GB radius of the calling method to store the jump stub for a 64-bit method call. There is no safe way for an application to recover from this specific error.&nbsp;Therefore, the state of the application after it encounters this error is unknown and it should be considered corrupted. The only way to recover is to restart the application.</p></div>
            <!-- ngIf: contentSection.meta.type != 'single-column' && !$last -->
        </div><!-- end ngRepeat: content in contentSection.content track by $index -->
    </div><!-- end ngIf: contentSection.content && contentSection.content.length > 0 -->
</section><!-- end ngIf: typeof(contentSection) !== 'string' --></div>
</div><!-- end ngIf: !isString && hasContent() --><!-- end ngRepeat: section in contentSectionList track by $index --><!-- ngIf: !isString && hasContent() --><div ng-repeat="section in contentSectionList track by $index" ng-if="!isString &amp;&amp; hasContent()">
    <div content-section="section"><!-- ngIf: typeof(contentSection) !== 'string' --><section data-grid="col-12" ng-if="typeof(contentSection) !== 'string'" ng-show="shouldShow" applies-to-saps="[]" ng-attr-id="{{contentSection.meta.id}}" ng-class="{'internal-content': isInternalSection(), 'flighted-content': shouldHighlightFlight }" data-before="" aria-hidden="false">
    <!-- ngIf: isInternalSection() -->
    <!-- ngIf: contentSection.title --><p id="section-2" ng-if="contentSection.title" data-js-in-page-navigation-anchor="section-2">
        <h2 ng-bind-html="contentSection.title"> Workaround</h2>
        <hr>
        <!-- ngIf: contentSection.subtitle -->
    </p><!-- end ngIf: contentSection.title -->
    <!-- ngIf: contentSection.content && contentSection.content.length > 0 --><div ng-if="contentSection.content &amp;&amp; contentSection.content.length > 0">
        <!-- ngRepeat: content in contentSection.content track by $index --><div ng-attr-data-grid="{{getStyleClass()}}" ng-repeat="content in contentSection.content track by $index" data-grid="col-12">
            <div compile="content" data-grid="col-12"><div><p>To work around this issue, use one of the following setting methods:</p><ul><li>Implement a machine-wide setting by adding the following registry key and value: <p><strong>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework</strong><br><span>NGenReserveForjumpStubs</span>=dword:00000005</p></li><li>Implement an application-level setting by adding (or merging) the following section to your application config file:<div><pre><code>&lt;configuration&gt;<br>    &lt;runtime&gt;<br> &lt;NGenReserveForJumpStubs value="5" /&gt;<br>    &lt;/runtime&gt;<br>&lt;/configuration&gt;</code></pre></div></li></ul><p><span>Explanation</span>: NGenReserveForJumpStubs causes the CLR to reserve a percentage of the address space for jump stubs near each loaded NGen image. We recommend that you use a value of 5 or greater if you are experiencing this OutOfMemory exception.</p></div></div>
            <!-- ngIf: contentSection.meta.type != 'single-column' && !$last -->
        </div><!-- end ngRepeat: content in contentSection.content track by $index -->
    </div><!-- end ngIf: contentSection.content && contentSection.content.length > 0 -->
</section><!-- end ngIf: typeof(contentSection) !== 'string' --></div>
</div><!-- end ngIf: !isString && hasContent() --><!-- end ngRepeat: section in contentSectionList track by $index --><!-- ngIf: !isString && hasContent() --><div ng-repeat="section in contentSectionList track by $index" ng-if="!isString &amp;&amp; hasContent()">
    <div content-section="section"><!-- ngIf: typeof(contentSection) !== 'string' --><section data-grid="col-12" ng-if="typeof(contentSection) !== 'string'" ng-show="shouldShow" applies-to-saps="[]" ng-attr-id="{{contentSection.meta.id}}" ng-class="{'internal-content': isInternalSection(), 'flighted-content': shouldHighlightFlight }" data-before="" aria-hidden="false">
    <!-- ngIf: isInternalSection() -->
    <!-- ngIf: contentSection.title --><p id="section-3" ng-if="contentSection.title" data-js-in-page-navigation-anchor="section-3">
        <h2 ng-bind-html="contentSection.title"> More Information</h2>
        <hr>
        <!-- ngIf: contentSection.subtitle -->
    </p><!-- end ngIf: contentSection.title -->
    <!-- ngIf: contentSection.content && contentSection.content.length > 0 --><div ng-if="contentSection.content &amp;&amp; contentSection.content.length > 0">
        <!-- ngRepeat: content in contentSection.content track by $index --><div ng-attr-data-grid="{{getStyleClass()}}" ng-repeat="content in contentSection.content track by $index" data-grid="col-12">
            <div compile="content" data-grid="col-12"><div><h3>For developers</h3><ul><li>The .NET Framework encodes method calls as relative 32-bit jumps for performance reasons. On a 64-bit system, caller and callee can be further apart than 2 GB (in address space). Because this exceeds the address range of a signed 32-bit offset, .NET will create a jump stub within 2 GB of the caller. This jump stub can then make the “long” jump to anywhere in the 64-bit address space.</li><li>The JIT and NGen mitigations work slightly differently. Both of them reserve extra address space up front, but the point where this reservation is made differs between the two.</li><li>NGenReserveForJumpStubs is a percentage of virtual NGen image size (<a id="kb-link-1" href="https://github.com/dotnet/coreclr/blob/master/src/vm/pefile.cpp#l1690" target="_self">percentReserveForJumpStubs</a>).</li><li>A typical jump stub is 12 bytes. For more information, see <a id="kb-link-2" href="https://github.com/dotnet/coreclr/blob/a8192fbc7064ed96cfeb8872bcb6479c217f7b5f/src/vm/amd64/cgencpu.h#l49" target="_self">JUMP_ALLOCATE_SIZE</a>.</li><li>The memory is allocated and reserved close to the address where the NGen image was loaded (the exact algorithm is <a id="kb-link-3" href="https://github.com/dotnet/coreclr/blob/a8192fbc7064ed96cfeb8872bcb6479c217f7b5f/src/vm/codeman.cpp#l1892" target="_self">EEJitManager::EnsureJumpStubReserve</a>). The memory is committed when there is a need to allocate a jump stub, and when there is no other suitable address space available.</li><li>The previously mentioned mitigation doesn’t modify the content of NGen images. The NGen images have the same disk footprint both with and without mitigation.</li><li>There is currently no good way to detect when the application is getting close to the limit. You must monitor for the OutOfMemoryException to determine whether the reserved space is sufficient.</li><li>You may receive the OutOfMemoryException even if there is a lot of unused memory because this specific error is related to the availability of memory within a 2-GB address range radius of the caller.</li><li>You shouldn’t change the default value of CodeHeapReserveForJumpStubs,&nbsp;because it may not be related to the issue described above. We have not seen case where the actual application would have to adjust this setting as a workaround.</li><li>Setting NGenReserveForJumpStubs to a significantly higher value may lead to reduced performance and the risk of exposing other subtle issues.</li></ul><h3>For IT users</h3><ul><li>This issue may also occur on other versions of the .NET Framework. However, the workaround is currently applicable only to the .NET Framework 4.6.1.</li><li>This is a very rare issue that only affects very large workloads that have a very particular execution pattern. More than 99 percent of all workloads will ever experience this issue.</li><li>After the application throws an OutOfMemory exception, the only recommended way to recover is to restart the application.</li></ul></div></div>
            <!-- ngIf: contentSection.meta.type != 'single-column' && !$last -->
        </div><!-- end ngRepeat: content in contentSection.content track by $index -->
    </div><!-- end ngIf: contentSection.content && contentSection.content.length > 0 -->
</section><!-- end ngIf: typeof(contentSection) !== 'string' --></div>
</div><!-- end ngIf: !isString && hasContent() --><!-- end ngRepeat: section in contentSectionList track by $index -->
<!-- ngIf: !isString --><!-- end ngIf: !isString --></div>
        </div>

        <!-- ngIf: article.details.subType === 'error-status-code' -->
    </div>

    <div data-grid="container">
        <!-- ngInclude: '/app/content/PartialViews/Content/ArticleFooter.html' --><div ng-include="'/app/content/PartialViews/Content/ArticleFooter.html'"><div>
    <hr>
    <p><time ng-attr-datetime="{{article.details.publishedOn || article.details.createdOn}}" ng-bind-html="(contentProperties.lastUpdatedFormat | compassFormat: {'lastModified': (article.details.publishedOn || article.details.createdOn | date : 'mediumDate')})" datetime="2016-05-10T16:38:14.487">Last Updated: 10 May 2016</time></p><contact-us-bridge article="article"><!-- ngIf: !bridge.noChrome && bridge.display && !bridge.inDeeplinkExp --></contact-us-bridge>
</div>
<related-articles article="article"><!-- ngIf: ra.addRelatedArticles && ra.isExperimentArticle && ra.inSearchFlight --></related-articles>

<!-- ngIf: !article --></div>
    </div>

    <!-- ngIf: (article.details.subType === 'side-nav' || article.details.subType === 'error-status-code' || article.details.subType === 'release-notes') && article.sideNav -->
</div></div><!-- end ngIf: isGenericArticle -->

                <!-- ngIf: isInstantAnswer -->
            </div>

            <!-- ngIf: !$root.isIframe --><!-- end ngIf: !$root.isIframe -->
        </div>
        <!-- ngIf: article && (!$root.isIframe || $root.isInternal) --><div content-survey="" ng-if="article &amp;&amp; (!$root.isIframe || $root.isInternal)">
<!-- ngIf: !closed --><div ng-class="{'survey-background' : !$root.isIframe}" ng-if="!closed">
    <div ng-class="{'container-fluid': fluidContainer}" data-grid="container pad-12x">
        <div data-grid="col-10">
            <div>
                <section ng-show="contentSurvey" aria-hidden="false">
                    <form ng-submit="OnSubmit()" role="complementary" aria-label="Content survey">
                        <div ng-show="showSurvey" aria-hidden="false">
                            <div ng-show="showButtons" aria-hidden="false">
                                <p><label ng-class="choiceCaptionClass">Was this information helpful?</label></p>
                            </div>
                            
                        </div>
                        
                    </form>
                </section>
            </div>
        </div>
    </div>
</div><!-- end ngIf: !closed -->
</div><!-- end ngIf: article && (!$root.isIframe || $root.isInternal) -->
    </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>