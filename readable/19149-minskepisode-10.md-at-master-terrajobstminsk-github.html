<!DOCTYPE html>
<html lang="en">
<head>
    <title>
minsk/episode-10.md at master &#xB7; terrajobst/minsk &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>minsk/episode-10.md at master · terrajobst/minsk · GitHub</h1><div><div id="" class="markdown-body entry-content p-3 p-md-6"><p><a href="https://www.youtube.com/watch?v=VkFNanrdvLc&amp;list=PLRAdsfhKI4OWNOSfS7EUu5GRAVmze1t2y&amp;index=10" rel="nofollow">Video</a> |
<a href="https://github.com/terrajobst/minsk/pull/49">Pull Request</a> |
<a href="/terrajobst/minsk/blob/master/docs/episode-09.md">Previous</a> |
<a href="/terrajobst/minsk/blob/master/docs/episode-11.md">Next</a></p><h2><a id="user-content-completed-items" class="anchor" aria-hidden="true" href="#completed-items"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Completed items</h2><p>We added support for string literals and type symbols.</p><h2><a id="user-content-interesting-aspects" class="anchor" aria-hidden="true" href="#interesting-aspects"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interesting aspects</h2><h3><a id="user-content-string-literals" class="anchor" aria-hidden="true" href="#string-literals"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>String literals</h3><p>We now <a href="https://github.com/terrajobst/minsk/blob/ad8a988567021330da9b5b4d26518cee6595055b/src/Minsk/CodeAnalysis/Syntax/Lexer.cs#L201-L241">support strings</a> like so:</p><pre><code>let hello = "Hello"
</code></pre><p>Strings need to be terminated on the same line (in other words, we don't support
line breaks in them). We also don't support any escape sequences yet (such <code>\n</code>
or <code>\t</code>). We do, however, support quotes which are escaped by <a href="https://github.com/terrajobst/minsk/blob/ad8a988567021330da9b5b4d26518cee6595055b/src/Minsk/CodeAnalysis/Syntax/Lexer.cs#L221-L225">doubling them</a>:</p><pre><code>let message = "Hello, ""World""!"
</code></pre><p>I did forget to add an operator for joining string literals, but we'll add that in
the next episode :-)</p><h2><a id="user-content-type-symbols" class="anchor" aria-hidden="true" href="#type-symbols"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Type symbols</h2><p>In the past, we've used .NET's <code>System.Type</code> class to represent type information
in the binder. This is inconvenient because most languages have their own notion
of types, so we replaced this with a new <a href="https://github.com/terrajobst/minsk/blob/cb03bb0f7277097e1507868ef722c16bdc22006a/src/Minsk/CodeAnalysis/Symbols/TypeSymbol.cs"><code>TypeSymbol</code></a> class. To make symbols
first class, we also added an abstract <a href="https://github.com/terrajobst/minsk/blob/cb03bb0f7277097e1507868ef722c16bdc22006a/src/Minsk/CodeAnalysis/Symbols/Symbol.cs"><code>Symbol</code></a> class and a <a href="https://github.com/terrajobst/minsk/blob/cb03bb0f7277097e1507868ef722c16bdc22006a/src/Minsk/CodeAnalysis/Symbols/SymbolKind.cs"><code>SymbolKind</code></a>.</p><h2><a id="user-content-cascading-errors" class="anchor" aria-hidden="true" href="#cascading-errors"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cascading errors</h2><p>Expressions are generally bound inside-out, for example, in order to bind a
binary expression one first binds the left hand side and right hand side in
order to know their types so that the operator can be resolved. This can lead to
cascading errors, like in this case:</p><pre><code>(10 * false) - 10
</code></pre><p>There is no <code>*</code> operator defined for <code>int</code> and <code>bool</code>, so the left hand side
cannot be bound. This makes it impossible to bind the <code>-</code> operator as well. In
general, you don't want to drown the developer in error messages so a good
compiler will try to avoid generating cascading errors. For example, you don't
don't want to generators two errors here but only one -- namely that the <code>*</code>
cannot be bound because that's the root cause. Maybe you didn't mean to type
<code>false</code> but <code>faults</code> which would actually resolve to a variable of type <code>int</code>,
in which case the <code>-</code> operator could be bound.</p><p>In the past, we've either returned the left hand side when a binary expression
cannot be bound or fabricated a fake literal expression with a value of <code>0</code>,
both of which can lead to cascading errors. To fix this, we've introduced an
<a href="https://github.com/terrajobst/minsk/blob/6365e15151ad5e59d3d8ac3c6a703b0d5fd7fb63/src/Minsk/CodeAnalysis/Symbols/TypeSymbol.cs#L5"><em>error type</em></a> to indicate the absense of type information. We also
added a <a href="https://github.com/terrajobst/minsk/blob/6365e15151ad5e59d3d8ac3c6a703b0d5fd7fb63/src/Minsk/CodeAnalysis/Binding/BoundErrorExpression.cs"><code>BoundErrorExpression</code></a> that is returned whenever we cannot resolve an
expression. This allows to handle the binary expression as follows:</p><div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span><span class="pl-en">BoundExpression</span><span class="pl-en">BindBinaryExpression</span>(<span class="pl-en">BinaryExpressionSyntax</span><span class="pl-smi">syntax</span>)
{
    <span class="pl-k">var</span><span class="pl-smi">boundLeft</span><span class="pl-k">=</span><span class="pl-en">BindExpression</span>(<span class="pl-smi">syntax</span>.<span class="pl-smi">Left</span>);
    <span class="pl-k">var</span><span class="pl-smi">boundRight</span><span class="pl-k">=</span><span class="pl-en">BindExpression</span>(<span class="pl-smi">syntax</span>.<span class="pl-smi">Right</span>);

    <span class="pl-c"><span class="pl-c">//</span> If either left or right couldn't be bound, let's bail to avoid cascading</span><span class="pl-c"><span class="pl-c">//</span> errors.</span><span class="pl-k">if</span> (<span class="pl-smi">boundLeft</span>.<span class="pl-smi">Type</span><span class="pl-k">==</span><span class="pl-smi">TypeSymbol</span>.<span class="pl-smi">Error</span><span class="pl-k">||</span><span class="pl-smi">boundRight</span>.<span class="pl-smi">Type</span><span class="pl-k">==</span><span class="pl-smi">TypeSymbol</span>.<span class="pl-smi">Error</span>)
        <span class="pl-k">return</span><span class="pl-k">new</span><span class="pl-en">BoundErrorExpression</span>();

    <span class="pl-k">var</span><span class="pl-smi">boundOperator</span><span class="pl-k">=</span><span class="pl-smi">BoundBinaryOperator</span>.<span class="pl-en">Bind</span>(<span class="pl-smi">syntax</span>.<span class="pl-smi">OperatorToken</span>.<span class="pl-smi">Kind</span>, <span class="pl-smi">boundLeft</span>.<span class="pl-smi">Type</span>, <span class="pl-smi">boundRight</span>.<span class="pl-smi">Type</span>);

    <span class="pl-k">if</span> (<span class="pl-smi">boundOperator</span><span class="pl-k">==</span><span class="pl-c1">null</span>)
    {
        <span class="pl-smi">_diagnostics</span>.<span class="pl-en">ReportUndefinedBinaryOperator</span>(<span class="pl-smi">syntax</span>.<span class="pl-smi">OperatorToken</span>.<span class="pl-smi">Span</span>, <span class="pl-smi">syntax</span>.<span class="pl-smi">OperatorToken</span>.<span class="pl-smi">Text</span>, <span class="pl-smi">boundLeft</span>.<span class="pl-smi">Type</span>, <span class="pl-smi">boundRight</span>.<span class="pl-smi">Type</span>);
        <span class="pl-k">return</span><span class="pl-k">new</span><span class="pl-en">BoundErrorExpression</span>();
    }

    <span class="pl-k">return</span><span class="pl-k">new</span><span class="pl-en">BoundBinaryExpression</span>(<span class="pl-smi">boundLeft</span>, <span class="pl-smi">boundOperator</span>, <span class="pl-smi">boundRight</span>);
}</pre></div><p>We also could have decided that the operator of <code>BoundBinaryExpression</code> is
<code>null</code> when it can't be bound but this would mean that all later phases have to
be prepared to handle a <code>null</code> operator, which seems more prone to errors.</p><h2><a id="user-content-dealing-with-inserted-tokens" class="anchor" aria-hidden="true" href="#dealing-with-inserted-tokens"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dealing with inserted tokens</h2><p>Peter <a href="https://github.com/terrajobst/minsk/issues/30">filed an issue</a> noticing that we crash when declaring variables
whose identifier was inserted by the parser (because its text is <code>null</code>).</p><p>The general philosophy is that the binder needs to be able to work on any trees,
even if the parser reported diagnostics. Otherwise, it's basically impossible to
develop something like an IDE where code is virtually always in a state of being
halfway written but semantic questions still need to be answered (for example,
when showing tool tips or providing code completion).</p><p>To address the particular issue, we've extracted a <a href="https://github.com/terrajobst/minsk/blob/ad8a988567021330da9b5b4d26518cee6595055b/src/Minsk/CodeAnalysis/Binding/Binder.cs#L267-L277"><code>BindVariable()</code></a> method
that will not add variables to the scope when their name was inserted by the
parser. However, it will still construct a variable. This might bite us later
because we can now find variables in the bound tree that don't exist in the
scope but if it turns out that this approach doesn't work, we can choose a
different one.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>