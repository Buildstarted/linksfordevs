<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Add methods to convert between hexadecimal strings and bytes &#xB7; Issue #17837 &#xB7; dotnet/runtime &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Add methods to convert between hexadecimal strings and bytes · Issue #17837 · dotnet/runtime · GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><p>It is quite common to need to convert bytes to hex strings and back. The .NET Framework does not have an API to do that. Look at what lengths people have gone to to solve this problem for them: <a href="http://stackoverflow.com/questions/311165/how-do-you-convert-byte-array-to-hexadecimal-string-and-vice-versa" rel="nofollow">How do you convert Byte Array to Hexadecimal String, and vice versa?</a> Many of those solutions are somehow bad (e.g. slow or broken or not validating).</p><p><code>BitConverter.ToString(byte[])</code> generates strings of a practically useless format: <code>BitConverter.ToString(new byte[] { 0x00, 0x01, 0xAA, 0xFF })</code> =&gt; <code>00-01-AA-FF</code>. I don't understand how this decision was made. This seems to be a special solution for some specific purpose (debug output?). Using this API requires <code>Replace(str, "-", "")</code> which is ugly and slow. Also, this API is not discoverable because it does not have "hex" in it's name.</p><p>I propose adding an API that does the following:</p><ul><li>Supports char[] and string</li><li>Supports specifying the output buffer to support zero-allocation scenarios</li><li>Supports upper- and lowercase</li><li>Fast (probably, this means working in-place using unsafe code)</li><li>Validates input</li><li><em>No</em> support for any kind of hex prefix (such as "0x"), whitespace or digit separator (such as "-" or "\n"). This is out of scope.</li></ul><p>The use case for char[] in- and outputs is low-allocation scenarios.</p><p>The API could look like this:</p><div class="highlight highlight-source-cs"><pre><span class="pl-k">static</span><span class="pl-k">class</span><span class="pl-en">HexConvert</span> {
 <span class="pl-k">byte</span>[] <span class="pl-en">ToBytes</span>(<span class="pl-k">string</span><span class="pl-smi">input</span>, <span class="pl-k">int</span><span class="pl-smi">start</span>, <span class="pl-k">int</span><span class="pl-smi">count</span>, <span class="pl-en">HexFormat</span><span class="pl-smi">hexFormat</span>);
 <span class="pl-k">void</span><span class="pl-en">ToBytes</span>(<span class="pl-k">string</span><span class="pl-smi">input</span>, <span class="pl-k">int</span><span class="pl-smi">start</span>, <span class="pl-k">int</span><span class="pl-smi">count</span>, <span class="pl-en">ArraySegment</span>&lt;<span class="pl-k">byte</span>&gt; <span class="pl-smi">outputBuffer</span>, <span class="pl-en">HexFormat</span><span class="pl-smi">hexFormat</span>);
 <span class="pl-c"><span class="pl-c">//</span>Repeat the same for ArraySegment&lt;char&gt; as input</span><span class="pl-k">string</span><span class="pl-en">ToString</span>(<span class="pl-en">ArraySegment</span>&lt;<span class="pl-k">byte</span>&gt; <span class="pl-smi">bytes</span>);
 <span class="pl-k">char</span>[] <span class="pl-en">ToChars</span>(<span class="pl-en">ArraySegment</span>&lt;<span class="pl-k">byte</span>&gt; <span class="pl-smi">bytes</span>);
 <span class="pl-k">void</span><span class="pl-en">ToChars</span>(<span class="pl-en">ArraySegment</span>&lt;<span class="pl-k">byte</span>&gt; <span class="pl-smi">bytes</span>, <span class="pl-en">ArraySegment</span>&lt;<span class="pl-k">char</span>&gt; <span class="pl-smi">outputBuffer</span>);

 <span class="pl-c"><span class="pl-c">//</span>Plus obvious convenience overloads</span><span class="pl-k">int</span><span class="pl-en">HexDigitToInteger</span>(<span class="pl-k">char</span><span class="pl-smi">val</span>); <span class="pl-c"><span class="pl-c">//</span>0-9A-F =&gt; 0-15.</span><span class="pl-k">char</span><span class="pl-en">IntegerToHexDigit</span>(<span class="pl-k">int</span><span class="pl-smi">value</span>, <span class="pl-en">HexFormat</span><span class="pl-smi">hexFormat</span>); <span class="pl-c"><span class="pl-c">//</span>0-15 =&gt; 0-9A-F</span>
}

[<span class="pl-en">Flags</span>]
<span class="pl-k">enum</span><span class="pl-en">HexFormat</span> { <span class="pl-en">UseDefaults</span><span class="pl-k">=</span><span class="pl-c1">0</span>, <span class="pl-en">Lowercase</span><span class="pl-k">=</span><span class="pl-c1">1</span> } <span class="pl-c"><span class="pl-c">//</span>extensible</span></pre></div><p>A possible extension would be to support <code>Stream</code> and <code>IEnumerable&lt;byte&gt;</code> as sources and destinations. I would consider this out of scope.</p><p>I feel that converting hexadecimal strings is an important and frequent enough thing that this should be supported well. Of course, a "light" version of this proposal is also feasible (just support for string and byte[] with no user-provided output buffer). Not sure if anyone wants/needs lowercase hex, I don't but others might.</p><p>This seems cheap enough to implement. Testing should be easily automatable. I don't see any particular usability problems. This is suitable for community contribution.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>