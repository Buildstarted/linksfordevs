<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using NSwag to Generate Blazor Server Client for an ASP.NET Core 3.1 API -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Using NSwag to Generate Blazor Server Client for an ASP.NET Core 3.1 API</h1>
    <article id="post-4533" class="post-4533 post type-post status-publish format-standard hentry category-net-core category-asp-net-core category-blazor category-tool-spotlight tag-net-core tag-asp-net-core tag-blazor tag-nswag-tool-spotlight tag-web-api"> <div class="entry-content">
<p>This week we are going to add a Blazor Server project that will utilize the contacts API we created a few weeks ago. This post is part of the revamp of the ASP.NET Core Basics repo that was kicked off when .NET Core 3.0 was released. For details on how the associated sample got to the current point in the application check out the following posts.</p>
<p><a href="https://elanderson.net/2019/10/swagger-openapi-with-nswag-and-asp-net-core-3/">Swagger/OpenAPI with NSwag and ASP.NET Core 3</a><br>
<a href="https://elanderson.net/2019/11/asp-net-core-3-add-entity-framework-core-to-existing-project/">ASP.NET Core 3: Add Entity Framework Core to Existing Project</a><br>
<a href="https://elanderson.net/2019/12/new-razor-pages-application-backed-with-an-api/">New Razor Pages Project Backed with an API</a><br>
<a href="https://elanderson.net/2019/12/using-nswag-to-generate-angular-client-for-an-asp-net-core-3-api/">Using NSwag to Generate Angular Client for an ASP.NET Core 3 API</a><br>
<a href="https://elanderson.net/2019/12/using-nswag-to-generate-react-client-for-an-asp-net-core-3-api/">Using NSwag to Generate React Client for an ASP.NET Core 3 API</a></p>
<p>The sample code before any of the changes in this post can be found <a href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/3d754e9a249118bd1b5697a0b88de5aba169451a">here</a>.</p>
<h3>Create the Blazor Server Project</h3>
<p>Add a new directory for the Blazor Server project and then open a terminal set to that directory. The following command can be used to create a new Blazor Server project.</p>
<pre class="EnlighterJSRAW">dotnet new blazorserver</pre>
<p>Next, use the following command to add the new project to the solution file which is in the root of the repo. Your filenames and paths will vary of course.</p>
<pre class="EnlighterJSRAW">dotnet sln ..\..\BasicsRefresh.sln add ContactsBlazorServerApp.csproj</pre>
<h3>Using NSwageStudio to Generate an API Client</h3>
<p>NSwag provides multiple options for client generation including a CLI option, code, and a Windows application. This post is going to use the Windows application which is called NSwagStudio. Download and install NSwagStudio from <a href="http://rsuter.com/Projects/NSwagStudio/installer.php">here</a>.</p>
<p>Next, make sure your API is running and get the URL of its OpenAPI/Swagger specification URL. For example, I am using a local instance of my API and the URL I need is https://localhost:5001/swagger/v1/swagger.json. If you are using the Swagger UI you can find a link to your swagger.json under the API title.</p>
<p><img class="aligncenter size-full wp-image-4354 jetpack-lazy-image" src="https://i1.wp.com/elanderson.net/wp-content/uploads/2019/10/swaggerUiSpecLinkSelected.png?resize=339%2C202&amp;is-pending-load=1#038;ssl=1" alt width="339" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></p>
<p>Now that we have the OpenAPI/Swager specification URL for the API switch over to NSwagStudio. The application will open with a new document ready to go. There are a few options we will need to set. First, we want to use the NetCore30 <strong>Runtime</strong>. Next, select the&#xA0;<strong>OpenAPI/Swagger Specification</strong> tab and enter your API&#x2019;s specification URL in the&#xA0;<strong>Specification URL</strong> box.</p>
<p><img class="aligncenter size-full wp-image-4355 jetpack-lazy-image" src="https://i0.wp.com/elanderson.net/wp-content/uploads/2019/10/nswagStudioInputSetup.png?resize=525%2C342&amp;is-pending-load=1#038;ssl=1" alt width="525" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></p>
<p>In the&#xA0;<strong>Outputs</strong> section check the&#xA0;<strong>CSharp Client</strong> checkbox and then select the&#xA0;<strong>CSharp Client</strong> tab. For this example, we are taking the defaults for all of the options except for <strong>Namespace</strong>, which is set to ContactsApi,&#xA0;<strong>Generate interfaces for Client classes</strong>, which should be check, and <strong>Output file path</strong>, which is only needed if you use the&#xA0;<strong>Generate Files</strong> option. Click the <strong>Generate Files</strong> button and NSwagStudio will create a file that contains all the code needed to access the API described in the OpenAPI/Swager specification selected in the Input section.</p>
<p><img class="aligncenter size-full wp-image-4356 jetpack-lazy-image" src="https://i0.wp.com/elanderson.net/wp-content/uploads/2019/10/nswagStudioOutputCSharpClientSetup.png?resize=443%2C576&amp;is-pending-load=1#038;ssl=1" alt width="443" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></p>
<p>The <strong>Generate Outputs</strong> button can be used if to populate the <strong>Output</strong> tab with the same code that the <strong>Generate Files</strong> process creates which provides a nice way to play with settings to and see the output without having to open another file.</p>
<h3>Setting Up the Generated Client in the Blazor Server Project</h3>
<p>In the sample project, create an <strong>APIs</strong> directory and dropped the <strong>ContactsApi.cs</strong> created with NSwagStudio there. The files generated with NSwagStudio are expecting JSON.NET to be present so the sample project will need a reference to the&#xA0;<a href="https://nuget.org/packages/Microsoft.AspNetCore.Mvc.NewtonsoftJson">Microsoft.AspNetCore.Mvc.NewtonsoftJson</a> NuGet package.</p>
<p>With the client-generated and in our local Apis directory in the Razor Pages project we can now work on getting it configured and registered for use in our new project. First, open the <strong>apppsetting.json</strong> file and add a setting for the URL of our API, which is the&#xA0;<strong>ContactsApi</strong> value in the following sample.</p>
<pre class="EnlighterJSRAW">{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  &quot;AllowedHosts&quot;: &quot;*&quot;,
  &quot;ContactsApi&quot;: &quot;https://localhost:5001&quot;
}</pre>
<p>Now that the project has the configuration change and a reference to JSON.NET in the <strong>ConfigureServices</strong> function of the&#xA0;<strong>Startup</strong> class we need to tell the app to make JSON.NET available via dependency injection by using <strong>AddNewtonsoftJson</strong> as in the following example.</p>
<pre class="EnlighterJSRAW">services.AddRazorPages()
        .AddNewtonsoftJson();</pre>
<p>Also in the <strong>ConfigureServices</strong> function, we need to register our API client.</p>
<pre class="EnlighterJSRAW">services.AddHttpClient&lt;IContactsClient, 
                       ContactsClient&gt;(client =&gt; 
         client.BaseAddress = new Uri(Configuration.GetSection(&quot;ContactsApi&quot;).Value));</pre>
<h3>Create the UI and Usage of the Generated Client</h3>
<p>Now that all the setup work is done we can add the contact list UI which will show the usage of the API client. The following is the full code which for the sample is in a new&#xA0;<strong>ContactList.razor</strong> file in the <strong>Pages</strong> directory. The specific lines related to the API client are highlighted.</p>
<pre class="EnlighterJSRAW">@page &quot;/contactlist&quot;

@using Apis
@inject IContactsClient ContactClient

&lt;h1&gt;Contact List&lt;/h1&gt;

@if (_contacts == null)
{
    &lt;p&gt;&lt;em&gt;Loading...&lt;/em&gt;&lt;/p&gt;
}
else
{
    &lt;table className=&apos;table table-striped&apos; aria-labelledby=&quot;tabelLabel&quot;&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Name&lt;/th&gt;
                &lt;th&gt;Address&lt;/th&gt;
                &lt;th&gt;City&lt;/th&gt;
                &lt;th&gt;State&lt;/th&gt;
                &lt;th&gt;Postal Code&lt;/th&gt;
                &lt;th&gt;Phone&lt;/th&gt;
                &lt;th&gt;Email&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            @foreach (var contact in _contacts)
            {
                &lt;tr&gt;
                    &lt;td&gt;@contact.Name&lt;/td&gt;
                    &lt;td&gt;@contact.Address&lt;/td&gt;
                    &lt;td&gt;@contact.City&lt;/td&gt;
                    &lt;td&gt;@contact.State&lt;/td&gt;
                    &lt;td&gt;@contact.PostalCode&lt;/td&gt;
                    &lt;td&gt;@contact.Phone&lt;/td&gt;
                    &lt;td&gt;@contact.Email&lt;/td&gt;
                &lt;/tr&gt;
            }
        &lt;/tbody&gt;
    &lt;/table&gt;
}

@code {
    private ICollection&lt;Contact&gt; _contacts;

    protected override async Task OnInitializedAsync()
    {
        _contacts = await ContactClient.GetContactsAsync();
    }
}</pre>
<p>Finally to add our new page to the navbar open the <strong>NavMenu.razor</strong> file found in the <strong>Shared</strong> directory. Add the following list item to the unordered list.</p>
<pre class="EnlighterJSRAW">&lt;li class=&quot;nav-item px-3&quot;&gt;
    &lt;NavLink class=&quot;nav-link&quot; href=&quot;contactlist&quot;&gt;
        &lt;span class=&quot;oi oi-list&quot; aria-hidden=&quot;true&quot;&gt;&lt;/span&gt; Contacts
    &lt;/NavLink&gt;
&lt;/li&gt;</pre>
<h3>Wrapping Up</h3>
<p>As with the other posts I have been doing utilizing NSwag for client generation this process is pretty easy and simplifies API consumption.</p>
<p>The sample code in its final state can be found <a href="https://github.com/elanderson/ASP.NET-Core-Basics-Refresh/tree/0ac0e84ca999545e5cac7764a019b14ce76353c8">here</a>.</p> </div> </article>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>