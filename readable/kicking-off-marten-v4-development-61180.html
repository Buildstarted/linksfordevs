<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Kicking off Marten v4 Development - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Kicking off Marten v4 Development - linksfor.dev(s)"/>
    <meta property="article:author" content="by jeremydmiller"/>
    <meta property="og:description" content="If you&#x2019;re not familiar with Marten, it&#x2019;s a library that allows .Net developers to treat Postgresql as a Document Database and also as an Event Store. For a quick background on Marten, h&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://jeremydmiller.com/2020/04/28/kicking-off-marten-v4-development/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Kicking off Marten v4 Development</title>
<div class="readable">
        <h1>Kicking off Marten v4 Development</h1>
            <div>by by jeremydmiller</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 29 Apr 2020</div>
        <p><a href="https://jeremydmiller.com/2020/04/28/kicking-off-marten-v4-development/">https://jeremydmiller.com/2020/04/28/kicking-off-marten-v4-development/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
			<p data-adtags-visited="true"><img data-attachment-id="5583" data-permalink="https://jeremydmiller.com/2016/09/14/marten-1-0-is-here/banner/" data-orig-file="https://jeremydmiller.files.wordpress.com/2016/09/banner.png" data-orig-size="1493,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="banner" data-image-description="" data-medium-file="https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=300" data-large-file="https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=625" src="https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=625" alt="banner" srcset="https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=625 625w, https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=1250 1250w, https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=150 150w, https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=300 300w, https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=768 768w, https://jeremydmiller.files.wordpress.com/2016/09/banner.png?w=1024 1024w" sizes="(max-width: 625px) 100vw, 625px"></p>
<p data-adtags-visited="true">If you’re not familiar with <a href="https://martendb.io/">Marten</a>, it’s a library that allows .Net developers to treat Postgresql as a Document Database and also as an Event Store. For a quick background on Marten, here’s <a href="https://channel9.msdn.com/Events/dotnetConf/2018/S315">my presentation on Marten from Dotnetconf 2018</a>.</p>
<p data-adtags-visited="true">The <a href="https://martendb.io/">Marten</a> community is gearing up to work on the long awaited v4.0 release, which I think is going to be the most ambitious release of Marten since the original v1.0 release in September of 2016. Marten is blessed with a strong user community, and we’ve got a big backlog of issues, feature requests, and suggestions for improvements that have been building up for quite some time.</p>
<p data-adtags-visited="true">First, some links for anyone who wants to be a part of that conversation:</p>
<ul>
<li><a href="https://github.com/JasperFx/marten/pull/1457">The big Marten v4 discussion is happening right now on GitHub</a></li>
<li><a href="https://github.com/JasperFx/marten/milestone/28">The v4 issue milestone list on GitHub</a></li>
<li><a href="https://gitter.im/JasperFx/marten">The Marten Gitter room for ongoing discussions</a></li>
</ul>
<p data-adtags-visited="true">Now would be a perfect time to add any kind of feedback or requests for Marten. We do have an unofficial “F# advisory board” this time around, but the more the merrier on that side. There’ll be plenty of opportunities for folks to contribute, whether that’s in coding, experimenting with early alphas, or just being heard in the discussions online.</p>
<p data-adtags-visited="true">Now, on to the release plans:</p>
<h3>Event Sourcing Improvements</h3>
<p data-adtags-visited="true">The biggest area of focus in Marten v4.0 is likely going to be the event store functionality. At the risk of being (rightly) mocked, I’d sum up our goals here as “Make the Marten Event Store be Web Scale!”</p>
<p data-adtags-visited="true">There’s a lot of content on the aforementioned Marten v4.0 discussion, and also on an older GitHub discussion on <a href="https://github.com/JasperFx/marten/issues/1307">Event Store improvements for v4.0</a>. The highlights (I think) are:</p>
<ul>
<li><a href="https://github.com/JasperFx/marten/issues/780">Event metadata</a> (a long running request)</li>
<li><a href="https://github.com/JasperFx/marten/issues/770">Partitioning Support</a></li>
<li>Improved projection support, including the option to project event data to flat database tables</li>
<li>A lot of improvements (near rewrite) to the existing support for asynchronous projections including multi-tenancy support, running across multiple application nodes, performance optimizations, and projection rebuild improvements</li>
<li>New support for asynchronous projection builders using messaging as an alternative to the polling async daemon. The first cut of this is very likely to be based around <a href="https://jasperfx.github.io/">Jasper</a> (I’m using this as a way to push Jasper forward too of course) and either Rabbit MQ or Azure Service Bus. If things go well, I’d hope that that expands to at least Jasper + Kafka and maybe parallel support for NServiceBus and MassTransit.</li>
<li>Snapshotting</li>
<li>The ability to rebuild projections with zero downtime</li>
</ul>
<h3>Linq Support Improvements</h3>
<p data-adtags-visited="true">I can’t overstate how complex building and maintaining a comprehensive Linq provider can be just out of the sheer number of usage permutations.</p>
<p data-adtags-visited="true">Marten v4.0 is going to include a pretty large <a href="https://github.com/JasperFx/marten/issues/1201">overhaul of the Linq support</a>. Along the way, we’re hopefully going to:</p>
<ul>
<li>Rewrite the functionality to <a href="https://martendb.io/documentation/documents/querying/include/">include related documents</a> altogether and finally <a href="https://github.com/JasperFx/marten/issues/460">support <code>Include()</code> on collections</a> that’s been a big user request for 3+ years.</li>
<li>Improve the efficiency of the generated SQL</li>
<li>More variable data type behavior within the Linq support. You can read more about the mechanics on <a href="https://github.com/JasperFx/marten/issues/1243">this issue</a>. This also includes being quite a bit smarter about the Json serialization and how that varies for different .Net data types. As an example, I think these changes will allow Marten’s Linq support to finally deal with things like <a href="https://github.com/JasperFx/marten/issues/1283">F# Discriminator Union types</a>.</li>
<li>Improve the internals by making it more modular and a little more performant in how it handles marshaling data from the database to C# objects.</li>
<li>Improve Marten’s ability to query within child collections</li>
<li>More flexibility in event stream identifier strateggies</li>
</ul>

<h3>Other Improvements</h3>
<ul>
<li>Document Metadata improvements, both exposing Marten’s metadata and user customizable metadata for things like user id or correlation identifiers</li>
<li>An option to stream JSON directly to .Net <code>Stream</code> objects like HTTP responses without going through serialization first or even a JSON string.</li>
<li>Optimizing the Partial update support to use Postgresql native operators when possible</li>
<li>Formal support for .Net Core integration through the generic <code>HostBuilder</code> mechanism</li>
</ul>

<h3>Planning</h3>
<p data-adtags-visited="true">Right now it’s all about the discussions and approach, but that’s going pretty well right now. The first thing I’m personally going to jump into is a round of automated test performance just to make everything go faster later.</p>
<p data-adtags-visited="true">The hope is that a subsequent V5 release might finally take Marten into supporting other database engines besides Postgresql, with Sql Server being the very obvious next step. We might take some preliminary steps with V4 to make the multi-database engine support be more feasible later with fewer breaking API changes, but don’t hold me to that.</p>
<p data-adtags-visited="true">I don’t have any idea about timing yet, sorry.</p>
			
			
								</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>