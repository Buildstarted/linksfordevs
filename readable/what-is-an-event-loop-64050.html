<!DOCTYPE html>
<html lang="en">
<head>
    <title>
What is an event loop? - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="What is an event loop? - linksfor.dev(s)"/>
    <meta property="article:author" content="https://phuaxueyong.com"/>
    <meta property="og:description" content="JavaScript&#x27;s core component - the event loop"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://blog.phuaxueyong.com/post/2020-07-08-what-is-event-loop-javascript/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - What is an event loop?</title>
<div class="readable">
        <h1>What is an event loop?</h1>
            <div>by https://phuaxueyong.com</div>
            <div>Reading time: 10-12 minutes</div>
        <div>Posted here: 09 Jul 2020</div>
        <p><a href="https://blog.phuaxueyong.com/post/2020-07-08-what-is-event-loop-javascript/">https://blog.phuaxueyong.com/post/2020-07-08-what-is-event-loop-javascript/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div> <p><span><p>What is the event loop inside javascript? Being a javascript engineer, I find it utterly humorous I only found out about this after so many months. So here is your chance to redeem yourself. It is never too late to learn something! This article is curated with reference to the youtube video you can find at the bottom of this page. He is an awesome speaker; eloquent and clear.</p>

<p>In Javascript, we do hear this term called the V8 Engine. It is used as during Chrome’s runtime but what exactly is it? You can find out more <a ref="nofollow" target="_blank" href="https://v8.dev/">here</a>. But here’s a short description of that:</p>
<br>
<blockquote>
<p>V8 is Google’s open source high-performance JavaScript and WebAssembly engine, written in C++.</p>
</blockquote>

<p>As it is widely known, Javascript is basically a single-threaded non-blocking asynchronous concurrent language. Javascript have a call stack, an event loop, a callback queue and some other apis. Lets dive in to understand what are the different components.</p>

<p>In this article, we will just briefly go through 3 key components</p>
<br>
<h3>1. What are the different components of a javascript environment</h3>

<p>What are the different components of the JS environment. Briefly, what is the v8 engine? Every thing you see around you are a composition of many other smaller things. Take the example of a guitar. There are many components: strings, wood, etc. Each of these components plays their individual roles. In the same way, JS environment is beautifully made by its components.</p>

<p><img src="https://bestbeginnerguitartoday.com/wp-content/uploads/2018/08/The-Parts-of-An-Acoustic-Guitar.jpg" alt=""></p>
<br>
<h3>2. What is the call stack</h3>

<p>we will go through what exactly does it do? An example to help us to understand. And what is the common error when a function is called recursively (a function calling itself). A stack of cards. One piece on top of another, we can better understand the role and implementation of a JS callstack with this analogy.</p>
<br>
<h3>3. What is an event loop</h3>

<p>What is its definition? What happens when we call a setTimeout function? What happens when we actually call a function with setTimout, t=0? We will find out how how the event loop handles such an implementation. I know of a really interesting beatboxer video and at 7:40mins, it goes: Loop loop loop loop loop. Describing just what an event loop does. Haha</p>

<p>
<iframe src="https://www.youtube.com/embed/-gHgXmMXvAg&amp;&amp;t=460" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p>
<br>
<hr>
<br>
<h2>#1. What are the different components of a javascript environment?</h2>

<p>Fundamentally, from the most basic level of understanding JavaScript (I know that are a whole lot more components behind the JavaScript engine &amp; environment), there are 3 key components in the JavaScript environment. The first component will be the Memory heap and Call stack. This is where the Chrome V8 engine resides in as well. Here’s a brief description of what the V8 engine does.</p>
<br>
<blockquote>
<p>V8 compiles and executes JavaScript source code, handles memory allocation for objects, and garbage collects objects it no longer needs. V8’s stop-the-world, generational, accurate garbage collector is one of the keys to V8’s performance</p>
</blockquote>

<p>Call stack is used for static memory allocation and Heap for dynamic memory allocation, both stored in the computer’s RAM. Did some research into the differences and it is way more technical than I expected it to be; which feels like one going down a rabbit hole. Will definitely savour this knowledge another time!</p>

<p><img src="https://cdn.psychologytoday.com/sites/default/files/styles/article-inline-half/public/blogs/50685/2014/05/151134-154379.jpg?itok=xU-6hhyp" alt="rabbit hole"></p>

<p>For now, a basic understanding that heap is used for memory allocation of the variables created in your function. And stack is used for the execution of functions that are called. If you wish to find out more, i’ve found a really insightful medium article talking about it. You can check them out <a ref="nofollow" target="_blank" href="https://medium.com/fhinkel/confused-about-stack-and-heap-2cf3e6adb771">here</a></p>

<p>￼<img src="https://blog.phuaxueyong.com/img/2020-07-07-what-is-event-server-javascript/js1.png" alt="png1"></p>

<p>Second component is the WebAPIs component. Here is where your browser ajax functions and DOM components actually reside in. Generally Application Programming Interfaces (APIs) are constructs made available in programming languages to allow developers to create complex functionality more easily. It is a form of abstraction to keep complex code away from the user, providing easier syntax to be used in place of it.</p>

<p>￼<img src="https://blog.phuaxueyong.com/img/2020-07-07-what-is-event-server-javascript/js2.png" alt="png1"></p>

<p>A fun fact about Nodejs: If you are aware of nodejs being a javascript language, it basically has similar components but swapping out the WebAPIs with C++ APIs.</p>
<br>
<hr>
<br>
<h2>#2. What is the call stack</h2>

<p>A call stack is a mechanism for an interpreter to keep track of its place in a script that calls multiple functions. If you have a code file that has 5 functions called, it will keep track of which function has been called and will be called next. Imagine that to be like a pile of cards. When you call a function, you put a card onto the top of the pile. When another function is called, then another card. The top most card is the function the interpreter is currently executing.</p>

<p>Once the function is completed, it will be removed from the top of the pile until there is none left.</p>

<p><img src="https://www.wikihow.com/images/b/b9/Make-a-Card-Come-Back-to-the-Top-of-the-Deck-Step-6-Version-2.jpg" alt="wiki how"> <em>Source from wikihow</em></p>

<p>In a slightly more technical term, the stack keeps track of execution contexts.</p>

<p>When developers mention that JavaScript is a single thread language. What  single threaded means is it only has one call stack and can only do one thing at any one time. When a function is called, it is added on top of a stack like a stack of cards. When the function completes, it will be removed from the call stack from the top.</p>
<br>
<blockquote>
<p>One thread == one call stack == one thing at a time</p>
</blockquote>
<br>
<h3>Here’s an example of an actual call stack:</h3>
<br>
<ol>
<li>Baz is called. Adding a call named baz to the empty pile of cards.</li>
<li>In function Baz, we called bar. Adding a card named bar on top of baz.</li>
<li>bar called foo, Adding a card named foo on top of bar.</li>
<li>foo threw an error, and this entire stack was returned to the browser and printed on the console log.</li>
</ol>

<p><img src="https://blog.phuaxueyong.com/img/2020-07-07-what-is-event-server-javascript/callstack.png" alt="callstack png"></p>

<p>The bottom most card: anonymous function is basically your main function that the application has to run to even start calling baz (the first function call)</p>
<br>
<h3>What happens when a function calls itself? When will it end?</h3>

<p>When a function ends up in a recursive loop, like a function calling itself. And it looks just like this. It goes on and on.</p>

<p><img src="https://miro.medium.com/max/1200/1*gSHrSNZK0bx-X7m1RraA6A.jpeg" alt="Recursion"></p>

<p>But all good things must come to an end. So when the recursive function goes on, you will hit a hard dead end; the limit of the stack. Then you will get an error call the Maximum call stack size exceeded. In different JavaScript environments, there are different limits:</p>
<br>
<ul>
<li>Node.js: 11034</li>
<li>Firefox: 50994</li>
<li>Chrome: 10402</li>
</ul>

<p>Cool facts thus far? Nothing works magically and when you decompose an application you can see its gears putting everything together like a master piece. Found a little cartoon, share with you.</p>

<p><img src="https://theburningmonk.com/wp-content/uploads/2017/08/recursion-01.png" alt="recursion"> <em>credit: theburningmonk</em></p>
<br>
<hr>
<br>
<h2>#3. What is event loop?</h2>
<br>
<blockquote>
<p>The Event Loop has one job — to monitor the Call Stack and the Callback Queue. If the Call Stack is empty, it will take the first event from the queue and push it to the Call Stack, and effectively runs it.</p>
</blockquote>

<p>What happens when things are slow? Anything that is slow on the stack are blocking</p>

<p>I love how this speaker talks about these functions with relevant context of usage. In Javascript, it is every common to use this tool called Promises and asynchronous functions. There are just so much we can learn from these two concepts alone so we will not go into through right now. I may even consider doing a different article just about them. Until then, here’s a guide about promises I find really insightful. Check it out <a ref="nofollow" target="_blank" href="https://javascript.info/promise-basics">here</a>.</p>
<br>
<h3>Here’s an example:</h3>

<p>When we do a setTimeout, and you can check out the setTimeout function <a ref="nofollow" target="_blank" href="https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_win_settimeout">here</a>:</p>
<br>
<ol>
<li>It first goes to the stack.</li>
<li>Then it goes to the webapi. It is sent to the WebAPI because the V8 engine does not have the setTimeout function.</li>
<li>Then once the timeout is cleared, it will use your callback function to the task queue</li>
<li>Then the event loop will check both the stack and task queue.</li>
<li>If the stack is empty, it will take the first thing on the task queue and push it to the stack.</li>
</ol>

<p>I’ve found a really interesting site that can actually help us to visualize the entire code. You can click <a ref="nofollow" target="_blank" href="http://latentflip.com/loupe/?code=CnNldFRpbWVvdXQoZnVuY3Rpb24gdGltZW91dCgpIHsKICAgIGNvbnNvbGUubG9nKCJDbGljayB0aGUgYnV0dG9uISIpOwp9LCA1MDAwKTsKCmNvbnNvbGUubG9nKCJXZWxjb21lIHRvIGxvdXBlLiIpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">here</a> to check out the code. One simple click of a button and there are so many steps that are executed eloquently for you under the hoop.</p>

<p><img src="https://i.imgflip.com/4/3r9zbt.jpg" alt="love button clicks"></p>

<p>So for the engineers out there, what is the difference between immediate execution of a function as compared to putting a setTimeout, t=0 to execute the function?</p>

<p>Here’s the answer: When you put setTimeout with time = 0, it doesn’t actually get executed immediately. Instead, it will wait until the stack is cleared before that event gets called.</p>

<p>From an asynchronous function is called, that function actually leaves the call stack, and thus needs to be requeued back into the stack, and that is the role of the event loop. Once again:</p>
<br>
<blockquote>
<p>The Event Loop has one job — to monitor the Call Stack and the Callback Queue. If the Call Stack is empty, it will take the first event from the queue and push it to the Call Stack, and effectively runs it.</p>
</blockquote>

<p>Another fun fact: setTimeout does not set the time delayed before the function gets executed. Rather, it is the minimum time before the function gets called.</p>

<p>Lets check out what is happening visually. You can check out the code <a ref="nofollow" target="_blank" href="http://latentflip.com/loupe/?code=c2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewpjb25zb2xlLmxvZygiV2VsY29tZSB0byBsb3VwZSBhZnRlciBzZXRUaW1lb3V0LiIpOwp9LCAwKTsKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUgMS4iKTsKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUgMi4iKTsKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUgMy4iKTsKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUgNC4iKTsKCgoK!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">here</a>.</p>

<p>Just to end of the article with a brief touch-and-go about web browser events - in this example we will use the form of a button click.</p>

<p>When you do a button click, it does not get pushed into the stack immediately. Instead, when you click, there is a click even that is executed by the Web APIs, then that function will get pushed into the callback queue, and it will be pushed into the stack by the event loop when the call stack is empty. This is the original page with a set of code that allows you to click the button and find out the sequence of events that happened upon that click. You can check it out in this <a ref="nofollow" target="_blank" href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">url</a></p>
<br>
<hr>
<br>
<h2>TLDR;</h2>

<p>So when people mention not to block the event loop, that means don’t put slow blocking code on the call stack and thus the event loop cannot do anything before the call stack gets cleared out.</p>

<p>Neither do you want to flood the callback queue, thats when you can consider using debounce to only queue one slow function call every X millisecond to avoid flooding the callback queue.</p>

<p>Even after all is said and done, this is merely just the tip of the iceberg to the JavaScript engine and environment. The V8 engine has so many capabilities including garbage collection, translator and interpreter. We can find out more about this topic <a ref="nofollow" target="_blank" href="https://blog.appsignal.com/2020/07/01/a-deep-dive-into-v8.html">here</a>.</p>
<br>
<hr>

<p>Reference:</p>

<p>
<iframe src="https://www.youtube.com/embed/8aGhZQkoFbQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p>
<br>
<ul>
<li><a ref="nofollow" target="_blank" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Client-side_web_APIs/Introduction">WebAPI definitions</a></li>
<li><a ref="nofollow" target="_blank" href="https://javascript.info/promise-basics">What is a JavaScript promise</a></li>
<li><a ref="nofollow" target="_blank" href="https://medium.com/fhinkel/confused-about-stack-and-heap-2cf3e6adb771">Difference between stack and heap</a></li>
<li><a ref="nofollow" target="_blank" href="https://glebbahmutov.com/blog/javascript-stack-size/">JavaScript Stack size</a></li>
<li><a ref="nofollow" target="_blank" href="http://latentflip.com/loupe/?code=CnNldFRpbWVvdXQoZnVuY3Rpb24gdGltZW91dCgpIHsKICAgIGNvbnNvbGUubG9nKCJDbGljayB0aGUgYnV0dG9uISIpOwp9LCA1MDAwKTsKCmNvbnNvbGUubG9nKCJXZWxjb21lIHRvIGxvdXBlLiIpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D">Visual example of event loop</a></li>
</ul>
</span></p> </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>