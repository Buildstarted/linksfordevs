<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Introducing EF Core 5 Features: Using ToQueryString to get generated&#xA0;SQL -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Introducing EF Core 5 Features: Using ToQueryString to get generated&#xA0;SQL</h1>
    <article id="post-522" class="post-522 post type-post status-publish format-standard hentry category-ef-core category-entity-framework"> <div class="entry-content"> <p>The EF team has been publishing <a href="https://github.com/dotnet/efcore/issues/19549">weekly status updates</a> since the <a href="https://github.com/dotnet/efcore/issues/15403">middle of last year</a>. Recently I have started including brief introductions for newly implemented enhancements. I&#x2019;m going to experiment with blogging these brief intros to help make them more visible.</p>
<h2>ToQueryString: A simple way to get generated SQL</h2>
<p>EF Core 5.0 introduces the <code>ToQueryString</code> extension method which will return the SQL generated by EF Core when executing a LINQ query. For example, the code:</p>
<pre class="brush: csharp; title: ; notranslate">
var city = &quot;London&quot;;
var query = context.Customers.Where(c =&gt; c.City == city);

Console.WriteLine(query.ToQueryString());
</pre>
<p>results in this output when using the SQL Server database provider:</p>
<pre class="brush: sql; title: ; notranslate">
DECLARE @__city_0 nvarchar(4000) = N&apos;London&apos;;

SELECT [c].[Id], [c].[City], [c].[CompanyName], [c].[Email], [c].[Fax], [c].[Name], [c].[Phone]
FROM [Customers] AS [c]
WHERE [c].[City] = @__city_0
</pre>
<h3>The SQL can be executed!</h3>
<p>Notice that declarations for parameters of the correct type are also included in the output. This allows copy/pasting to SQL Server Management Studio, or similar tools, such that the query can be executed for debugging/analysis.</p>
<p><a href="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=640" alt width="640" class="alignright size-full wp-image-528" srcset="https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=640&amp;h=277 640w, https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=150&amp;h=65 150w, https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=300&amp;h=130 300w, https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=768&amp;h=333 768w, https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png?w=1024&amp;h=443 1024w, https://oneunicorn.files.wordpress.com/2020/01/annotation-2020-01-12-095104.png 1150w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<h3>The SQL is database-specific</h3>
<p>Other database providers can generate parameter declarations suitable for their ecosystems. For example, the SQLite provider generates output suitable for the SQLite CLI tool:</p>
<pre class="brush: sql; title: ; notranslate">
.param set @__city_0 &apos;London&apos;

SELECT &quot;c&quot;.&quot;Id&quot;, &quot;c&quot;.&quot;City&quot;, &quot;c&quot;.&quot;CompanyName&quot;, &quot;c&quot;.&quot;Email&quot;, &quot;c&quot;.&quot;Fax&quot;, &quot;c&quot;.&quot;Name&quot;, &quot;c&quot;.&quot;Phone&quot;
FROM &quot;Customers&quot; AS &quot;c&quot;
WHERE &quot;c&quot;.&quot;City&quot; = @__city_0
</pre>
<h3>The SQL is visible in the debugger</h3>
<p>EF Core 5 also introduces a &#x201C;debug view&#x201D; to easily see the generated SQL and associated expression tree in your debugger of choice. Just drill down into the EF query object and expand <code>DebugView</code>.</p>
<p><a href="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png"><img src="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=640" alt width="640" class="alignright size-full wp-image-541" srcset="https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=640&amp;h=475 640w, https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=1280&amp;h=950 1280w, https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=150&amp;h=111 150w, https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=300&amp;h=223 300w, https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=768&amp;h=570 768w, https://oneunicorn.files.wordpress.com/2020/01/querydebugview.png?w=1024&amp;h=760 1024w" sizes="(max-width: 640px) 100vw, 640px"></a></p> <p>Note: I do not monitor comments on my blogs for several reasons. Please go through the normal process on <a href="https://github.com/dotnet/efcore">EF Core GutHub repo</a> if you have questions or comments on these enhancements.</p> </div> </article>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>