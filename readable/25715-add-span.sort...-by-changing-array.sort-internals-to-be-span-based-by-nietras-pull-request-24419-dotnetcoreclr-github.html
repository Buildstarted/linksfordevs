<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Add Span.Sort(...) by changing Array.Sort internals to be Span based by nietras &#xB7; Pull Request #24419 &#xB7; dotnet/coreclr &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Add Span<t>.Sort(...) by changing Array.Sort internals to be Span based by nietras · Pull Request #24419 · dotnet/coreclr · GitHub</t></h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><blockquote><p>a simple, safe, less-optimized implementation is a good way to start</p></blockquote><p><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> good :) Your initial thoughts mirror mine, we are facing two issues with changing the "backbone" of sort with Span-based versions:</p><ul><li>Co-variant arrays</li><li>Possible performance regressions</li></ul><blockquote><p>array to Span conversion throws for co-variant array. There may be a bit of unsafe code needed to avoid throwing for Sort on co-variant arrays.</p></blockquote><p><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> yes exactly, which is why I was wondering if this was a viable path, could you expand on the "bit of unsafe code" needed? I assume we have to convert to a Span with the same type as the underlying array, but what about the custom comparers then?</p><blockquote><p>as long as it can be done without regressing array sorting perf</p></blockquote><p><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> right that is the question. Lets for now assume that the creation of the Spans for the input arrays has neglible overhead even for small numbers of elements. The biggest problem here then is whether the Span based sorting code will not regress performance.</p><p>I haven't done a lot <code>coreclr</code> based development so I will have to get into how to do benchmarks of this first. :)</p><p>One thing I can say though, from the experience from the previous PRs, if Span API methods does not call <code>TrySZSort</code>, which is what <a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> is suggesting and I think is a good start, then the performance for Span for the types supported by <code>TrySZSort</code> will be significantly slower will high likelihood. This could be addressed later I think that is a good plan.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>