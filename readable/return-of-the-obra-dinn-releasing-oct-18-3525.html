<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Return of the Obra Dinn [Releasing Oct 18] - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Return of the Obra Dinn [Releasing Oct 18] - linksfor.dev(s)"/>
    <meta property="og:description" content="Return of the Obra Dinn [Releasing Oct 18]"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://forums.tigsource.com/index.php?topic=40832.msg1359120"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Return of the Obra Dinn [Releasing Oct 18]</title>
<div class="readable">
        <h1>Return of the Obra Dinn [Releasing Oct 18]</h1>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="https://forums.tigsource.com/index.php?topic=40832.msg1359120">https://forums.tigsource.com/index.php?topic=40832.msg1359120</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><p><b><span size="5">PAX West 2017</span></b></p><p><img src="http://3909.co/dev/od/img/Pax2017-Booth.png" alt=""></p><p>Showing the game at the IMB Minibooth went great. My goal was to test out the new book and game flow and it seems the changes worked well. Some players embraced the book and some players ignored it but just about everyone was able to proceed through the game without getting stuck. Visually, the presentation was helped by the small-ish monitor mounted away from players' faces. Small physical pixels means the dithering works as it should and the low resolution isn't a distraction. As far as I was concerned, everything was hunky dory.</p><p>Having finished the script and sent out character audition scripts before PAX, the moment I got back home&nbsp;there were hundreds of voice actor auditions. That kept me busy for a while but I was able to stop by TGS in mid&nbsp;September to chat with a few fellow indies. One of those indies was Justin from Gattai Games. They're making a black &amp; white horror VR game,&nbsp;<a href="http://stifledgame.com/" target="_blank">"Stifled"</a>, which at first glance looks similar to Obra Dinn. I played their demo at PAX and it was great fun. They were showing the same build at TGS and I had a chance to ask Justin what he thought of the&nbsp;Obra Dinn build&nbsp;he played at PAX. His main comment was that it gave him a headache after a few minutes so suit up b/c there's nothing I love more than a problem that needs solving.&nbsp;</p><p><span size="4">Shark Jumping</span></p><p>This is the point where, as I put this post together, I wonder wtf I'm doing and why&nbsp;I don't just finish the damn game already. Moving on.</p><p><b><span size="5">Fullscreen Still Looks Bad</span></b></p><p><a href="https://forums.tigsource.com/index.php?topic=40832.msg1065470#msg1065470" target="_blank"><img src="http://3909.co/dev/od/img/Scale-Done.png" alt=""></a></p><p><del>A few months</del>&nbsp;Three years ago&nbsp;I made a <a href="https://forums.tigsource.com/index.php?topic=40832.msg1065470#msg1065470" target="_blank">long post</a> about how the game looks bad&nbsp;in fullscreen. I addressed this problem in a few ways (better dither, optional soft filter, etc) but resisted actually increasing the resolution, the obvious choice. The main reason for that is that&nbsp;I'm leaning heavily into the grungy&nbsp;dither-punk presentation through all levels of the art direction. Everything was designed with a minimum size for details and adding extra fidelity makes the game look worse.</p><p>Still though, it's a valid complaint that the game is all-day headaches&nbsp;and I really wanted to spend a little more time on that.</p><p><span size="5"><b>Shades and Lines</b></span></p><p>Broadly, the game's visuals are split into two separate elements: 1)&nbsp;Dithered texture, and 2) Wireframe lines.</p><p><img src="http://3909.co/dev/od/img/Scale-Basics.png" alt=""></p><p>The basic visual components</p><p><img src="http://3909.co/dev/od/img/Scale-SingleRes.png" alt=""></p><p>Zoomed</p><div><p>The game renders natively at 640x360. Doubling to 1280x720 gets finer geometry, more effective&nbsp;dithering, and thinner wireframe lines:</p></div><p><a href="http://3909.co/dev/od/img/Scale-DoubleRes.png" target="_blank"><img src="http://3909.co/dev/od/img/Scale-DoubleResZoom.png" alt=""></a></p><p>As mentioned I don't like the extra detail, but I also don't like the thinner wireframe lines. The chunkiness is almost totally gone and that's just no good. You can also just start to see how low-poly the geometry is, which I'd rather avoid.</p><p>Now's a good time to reiterate that the visuals are really only a problem at fullscreen, large physical sizes. It's hard to communicate it clearly in little screenshots like this so just take my word for it. You can get a slightly better sense by seeing the swimming, flickering pixels in motion while zoomed.</p><p><img src="http://3909.co/dev/od/img/Scale-SwayOriginal.gif" alt=""></p><p>Flickering dither and swimming lines</p><p>After thinking about this, it seemed to me that it should be possible to make the visuals more comfortable without adding actual detail, and without giving up the 1-bit limitation. My previous attempts were limited to upscaling the final buffer. That didn't give great results so I expected to try a little harder this time. It occurred to me that I could upscale&nbsp;each visual element (texture, lines) separately and combine them afterwards. Sounds harder already; good start.</p><p><b><span size="5">Upscaling Dithered Texture</span></b></p><p>At 640x360, the game uses&nbsp;three separate dithering techniques: error diffusion, bayer pattern, and blue noise pattern:</p><p><img src="http://3909.co/dev/od/img/Scale-Dithers.png" alt=""></p><p>The three dither techniques at 640x360</p><p>Each dithering technique is appropriate for different circumstances and their selection&nbsp;is important at these super low resolutions. With low res and bigger individual pixels, the eye has a harder time merging the dot patterns into shades of gray and I expect this is a major cause of eye strain. Doubling the resolution of the dithering (but not the underlying render) gives a much easier time of combining the dots into shades of gray:</p><p><img src="http://3909.co/dev/od/img/Scale-DitherUpscale.png" alt=""></p><p>Nearest-neighbor scaled from 640x360 to 1280x720, then dithered</p><p><img src="http://3909.co/dev/od/img/Scale-DitherUpscale2.png" alt=""></p><p>.. Easier to see the grays, RIP chunkiness. It all looks a bit soft and the contrast between small dither pixels and thick line pixels clashes.&nbsp;Now that we've decided it's ok to cheat with mixed resolutions, and&nbsp;we've got all these extra pixels, why not try a coarser and more stylish dither pattern?</p><p><img src="http://3909.co/dev/od/img/Scale-DitherGrain.png" alt=""></p><p>WB,&nbsp;chunk.</p><p><img src="http://3909.co/dev/od/img/Scale-DitherGrain2.png" alt=""></p><p>Looks rough but still captures the texture well, even without error diffusion</p><p><img src="http://3909.co/dev/od/img/Scale-DitherGrainAnim.gif" alt=""></p><p>Rotating the dither pattern. Bad printer, classic&nbsp;newsprint, or tasteful woodcut?&nbsp;Choices.</p><p>Ok well that looks great and was a lot easier than I expected. Job half done.</p><p><b><span size="5">Upscaling Lines</span></b></p><p>The wireframe lines were&nbsp;a little trickier. The goal was&nbsp;to upscale the lines into something that looks better and&nbsp;A) is still 1-bit (no blending) and B) doesn't add any information (no higher-res rendering). Since I played around with pixel-based scalers before I started by trying those again:</p><p><img src="http://3909.co/dev/od/img/Scale-LineMethods.png" alt=""></p><p>Upscaling the wireframes with pixel-scalers</p><p>There's a lot more algorithms than Scale2x and xBR but the others I tried end up with pretty similar results. Scale2x has the benefit of being fast and simple, xBR is slow and complex. Scale2x doesn't look good here, xBR is promising. After some research I found that xBR is a rule-based technique,&nbsp;designed for general&nbsp;color content. A significant amount of the work is spent on color separation and edge detection. 1-bit wireframes should be faster to handle, and if you're willing to write a custom pixel scaler, indeed they are.</p><p><span size="4">Custom Line Scaler</span></p><p>I made a brief stab at simplifying the xBR algorithm but quickly decided there was too much going on there and it'd be better to just design something new&nbsp;from scratch.&nbsp;Without going into too many details, the algorithm I came up with does a case-by-case&nbsp;matching of the 3x3 pixel neighborhood to determine what the 4 new subpixels would be if the line was rendered at x2 with the same endpoints.</p><p><img src="http://3909.co/dev/od/img/Scale-LineCustomAlgo.png" alt=""></p><p>Pixels that match a left-hand pattern are expanded into the right-hand subpixels</p><p>I wrote a small Python tool to work this out and there are 24 possible left-hand patterns to match, which is perfectly manageable in shader code. The game takes the x1 wireframe render (640x360) and expands it to x2 (1280x720) in one shader pass.&nbsp;After this initial match-and-expand pass a little more cleanup is required. Line endpoints can be a lot more varied than just the 3x3 square neighborhood, and the border between matched patterns in these lines&nbsp;can leave out&nbsp;subpixels here and there. These missing subpixels can be hack-patched in a following pass that compares new and old pixel positions.</p><p><img src="http://3909.co/dev/od/img/Scale-LineSpinner.gif" alt=""></p><p>Original x1&nbsp;line on the left, upscaled x2 on the right</p><p>The algorithm handles short lines well and long lines less-well. It rounds corners and when summing all possible matches in each 3x3 neighborhood, adds a satisfying "bleed" around joints:</p><p><img src="http://3909.co/dev/od/img/Scale-LineCustom.png" alt=""></p><p>Custom line scaler result</p><p><img src="http://3909.co/dev/od/img/Scale-LineCustomAnim.gif" alt=""></p><p>Comparison with nearest neighbor and xBR</p><p>If&nbsp;we&nbsp;just wanted a higher resolution line we'd be done but in Obra Dinn's case pixels carry information about wireframe color (inDarkness or not) separate from the wireframe on/off channel. This means that the changes to the wireframe channel need to be back-applied to the other channels. That's again a fairly simple pass that updates the subpixel colors based on neighboring&nbsp;wireframe values.</p><p>All told, the custom method is much faster than xBR and looks better for this special case.&nbsp;I have a hunch the technique could be modified to handle full color data and used as a general-purpose pixel scaler. Maybe I'll play around with that after the game is done. </p><p><span size="1">So, never.</span></p><p><b><span size="5">Putting It All Together</span></b></p><p>Combining the higher resolution dither pattern with the custom line scaler makes a big difference. There's still swimming during motion due to the low resolution input data but it's way more comfortable to look at. The old display mode will remain as a&nbsp;selectable option and this new business will probably be the default. </p><p>I'm gonna gently close the book on this again. The final result:</p><p><a href="http://3909.co/dev/od/img/Scale-Final.png" target="_blank"><img src="http://3909.co/dev/od/img/Scale-FinalZoom.png" alt=""></a></p><p><img src="http://3909.co/dev/od/img/Scale-FinalAnim.gif" alt=""></p><p>Old/new comparison</p><p><img src="http://3909.co/dev/od/img/Scale-SwayFinal2.gif" alt=""></p><p>Moving</p></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>