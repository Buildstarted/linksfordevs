<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Try out Nullable Reference Types | .NET Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Try out Nullable Reference Types | .NET Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Phillip CarterProgram Manager,&#xA0;.NET and LanguagesFollow Phillip"/>
    <meta property="og:description" content="Try out Nullable Reference Types&#xA;With the release of .NET Core 3.0 Preview 7, C# 8.0 is considered &quot;feature complete&quot;. That means that the biggest feature of them all, Nullable Reference Types, is also locked down behavior-wise for the .NET Core release."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/try-out-nullable-reference-types/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Try out Nullable Reference Types | .NET Blog</title>
<div class="readable">
        <h1>Try out Nullable Reference Types | .NET Blog</h1>
            <div>by Phillip CarterProgram Manager,&#xA0;.NET and LanguagesFollow Phillip</div>
            <div>Reading time: 32-40 minutes</div>
        <div>Posted here: 07 Aug 2019</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/try-out-nullable-reference-types/">https://devblogs.microsoft.com/dotnet/try-out-nullable-reference-types/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2018/10/Phillip-Carter-150x150.png" width="58" height="58" alt="Phillip Carter"></p><p>Phillip</p></div></div></div><p>August 6th, 2019</p><p>With the release of .NET Core 3.0 Preview 7, C# 8.0 is considered "feature complete". That means that the biggest feature of them all, <a href="https://docs.microsoft.com/dotnet/csharp/nullable-references" target="_blank">Nullable Reference Types</a>, is also locked down behavior-wise for the .NET Core release. It will continue to improve after C# 8.0, but it is now considered stable with the rest of C# 8.0.</p><p>At this time, our aim is to collect as much feedback about the process of adopting nullability as possible, catch any issues, and collect feedback on further improvements to the feature that we can do after .NET Core 3.0. This is one of the largest features ever built for C#, and although we’ve done our best to get things right, we need your help!</p><p>It is at this junction that we especially call upon .NET library authors to try out the feature and begin annotating your libraries. We’d love to hear your feedback and help resolve any issues you come across.</p><h2 id="familiarize-yourself-with-the-feature">Familiarize yourself with the feature<a href="#familiarize-yourself-with-the-feature"></a></h2><p>We recommend reading some of the <a href="https://docs.microsoft.com/dotnet/csharp/nullable-references" target="_blank">Nullable Reference Types documentation</a> before getting started with the feature. It covers essentials like:</p><ul><li>A conceptual overview</li><li>How to specify a nullable reference type</li><li>How to control compiler analysis or override compiler analysis</li></ul><p>If you’re unfamiliar with these concepts, please give the documentation a quick read before proceeding.</p><h2 id="turn-on-nullable-reference-types">Turn on Nullable Reference Types<a href="#turn-on-nullable-reference-types"></a></h2><p>The first step in adopting nullability for your library is to turn it on. Here’s how:</p><h3 id="make-sure-youre-using-c-80">Make sure you’re using C# 8.0</h3><p>If your library explicitly targets <code>netcoreapp3.0</code>, you’ll get C# 8.0 by default. When we ship Preview 8, you’ll get C# 8.0 by default if you target <code>netstandard2.1</code> too.</p><p>.NET Standard itself doesn’t have any nullable annotations yet. If you’re targeting .NET Standard, then you can use multi-targeting for .NET Standard and <code>netcoreapp3.0</code>, even if you don’t need .NET Core specific APIs. The benefit is that the compiler will use the nullable annotations from CoreFX to help you get your own annotations right.</p><p>If you cannot update your TFM for some reason, you can set the <code>LangVersion</code> explicitly:</p><pre><code><span>&lt;PropertyGroup&gt;</span><span>
    </span><span>&lt;LangVersion&gt;</span><span>8.0</span><span>&lt;/LangVersion&gt;</span><span>
</span><span>&lt;/PropertyGroup&gt;</span></code></pre><p>Note that C# 8.0 is not meant for older targets, such as .NET Core 2.x or .NET Framework 4.x. So some additional language features may not work unless you are targeting .NET Core 3.0 or .NET Standard 2.1</p><p>From here, we recommend two general approaches to adopting nullability.</p><h3 id="opt-in-a-project-opt-out-files">Opt in a project, opt out files</h3><p>This approach is best for projects where you’ll be adding new files over time. The process is straightforward:</p><ol><li><p>Apply the following property to your project file:</p><pre><code><span>&lt;PropertyGroup&gt;</span><span>
    </span><span>&lt;Nullable&gt;</span><span>enable</span><span>&lt;/Nullable&gt;</span><span>
</span><span>&lt;/PropertyGroup&gt;</span></code></pre></li><li><p>Disable nullability in every file for that project by adding this to the top of every existing file in the project:</p><pre><code><span>#nullable disable</span></code></pre></li><li><p>Pick a file, remove the <code>#nullable disable</code> directive, and fix the warnings. Repeat until all <code>#nullable disable</code> directives are gone.</p></li></ol><p>This approach requires a bit more up front work, but it means that you can continue working in your library while you’re porting and ensure that any new files are automatically opted-in to nullability. This is the approach we generally recommend, and we are currently using it in <a href="https://github.com/dotnet/project-system/blob/master/src/Directory.Build.props#L28" target="_blank">some of our own codebases</a>.</p><p>Note that you can also apply the <code>Nullable</code> property to a <code>Directory.build.props</code> file if that fits your workflow better.</p><h3 id="opt-in-files-one-at-a-time">Opt in files one at a time</h3><p>This approach is the inverse of the previous one.</p><ol><li><p>Enable nullability in a file for a project by adding this to the top of the file:</p><pre><code><span>#nullable enable</span></code></pre></li><li><p>Continue adding this to files until all files are annotated and all nullability warnings are addressed.</p></li><li><p>Apply the following property to your project file:</p><pre><code><span>&lt;PropertyGroup&gt;</span><span>
    </span><span>&lt;Nullable&gt;</span><span>enable</span><span>&lt;/Nullable&gt;</span><span>
</span><span>&lt;/PropertyGroup&gt;</span></code></pre></li><li><p>Remove all <code>#nullable enable</code> directives in source.</p></li></ol><p>This approach requires more work at the end, but it allows you to start fixing nullability warnings immediately.</p><p>Note that you can also apply the <code>Nullable</code> property to a <code>Directory.build.props</code> file if that fits your workflow better.</p><h2 id="whats-new-in-nullable-reference-types-for-preview-7">What’s new in Nullable Reference Types for Preview 7<a href="#whats-new-in-nullable-reference-types-for-preview-7"></a></h2><p>The most critical additions to the feature are tools for working with generics and more advanced API usage scenarios. These were derived from our experience in beginning to annotate .NET Core.</p><h3 id="the-notnull-generic-constraint">The <code>notnull</code> generic constraint</h3><p>It is quite common to intend that a generic type is specifically not allowed to be nullable. For example, given the following interface:</p><div id="gist97640546">
    <div>
      <div>
        <div>
  <div id="file-nulls-1-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-1-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-1-cs-LC1"><span>interface</span> <span>IDoStuff</span>&lt;<span>TIn</span>, <span>TOut</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-1-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-1-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-1-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-1-cs-LC3">    <span>TOut</span> <span>DoStuff</span>(<span>TIn</span> <span>input</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-1-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-1-cs-LC4">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>It may be desirable to only allow non-nullable reference and value types. So substituting with <code>string</code> or <code>int</code> should be fine, but substituting with <code>string?</code> or <code>int?</code> should not.</p><p>This can be accomplished with the <code>notnull</code> constraint:</p><div id="gist97640568">
    <div>
      <div>
        <div>
  <div id="file-nulls-2-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-2-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-2-cs-LC1">#nullable enable</td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-2-cs-LC2">
</td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-2-cs-LC3"><span>interface</span> <span>IDoStuff</span>&lt;<span>TIn</span>, <span>TOut</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-2-cs-LC4">    <span>where</span> <span>TIn</span> : <span>notnull</span></td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-2-cs-LC5">    <span>where</span> <span>TOut</span> : <span>notnull</span></td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-2-cs-LC6">{</td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-2-cs-LC7">    <span>TOut</span> <span>DoStuff</span>(<span>TIn</span> <span>input</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-2-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-2-cs-LC8">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>This will then generate a warning if any implementing class does not also apply the same <code>notnull</code> constraints:</p><div id="gist97640578">
    <div>
      <div>
        <div>
  <div id="file-nulls-3-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-3-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-3-cs-LC1"><span><span>//</span> Warning: CS8714 - Nullability of type argument 'TIn' doesn't match 'notnull' constraint.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-3-cs-LC2"><span><span>//</span> Warning: CS8714 - Nullability of type argument 'TOut' doesn't match 'notnull' constraint.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-3-cs-LC3"><span>public</span> <span>class</span> <span>DoStuffer</span>&lt;<span>TIn</span>, <span>TOut</span>&gt; : <span>IDoStuff</span>&lt;<span>TIn</span>, <span>TOut</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-3-cs-LC4">{</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-3-cs-LC5">    <span>public</span> <span>TOut</span> <span>DoStuff</span>(<span>TIn</span> <span>input</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-3-cs-LC6">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-3-cs-LC7">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-3-cs-LC8">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-3-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-3-cs-LC9">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>To fix it, we need to apply the same constraints:</p><div id="gist97640590">
    <div>
      <div>
        <div>
  <div id="file-nulls-4-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-4-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-4-cs-LC1"><span><span>//</span> No warnings!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-4-cs-LC2"><span>public</span> <span>class</span> <span>DoStuffer</span>&lt;<span>TIn</span>, <span>TOut</span>&gt; : <span>IDoStuff</span>&lt;<span>TIn</span>, <span>TOut</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-4-cs-LC3">    <span>where</span> <span>TIn</span> : <span>notnull</span></td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-4-cs-LC4">    <span>where</span> <span>TOut</span> : <span>notnull</span></td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-4-cs-LC5">{</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-4-cs-LC6">    <span>TOut</span> <span>DoStuff</span>(<span>TIn</span> <span>input</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-4-cs-LC7">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-4-cs-LC8">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-4-cs-LC9">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-4-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-4-cs-LC10">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>And when creating an instance of that class, if you substitute it with a nullable reference type, a warning will also be generated:</p><div id="gist97640613">
    <div>
      <div>
        <div>
  <div id="file-nulls-5-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-5-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-5-cs-LC1"><span><span>//</span> Warning: CS8714 - Nullability of type argument 'string?' doesn't match 'notnull' constraint</span></td>
      </tr>
      <tr>
        <td id="file-nulls-5-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-5-cs-LC2"><span>var</span> <span>doStuffer</span> <span>=</span> <span>new</span> <span>DoStuff</span>&lt;<span>string</span>?, <span>string</span>?&gt;();</td>
      </tr>
      <tr>
        <td id="file-nulls-5-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-5-cs-LC3">
</td>
      </tr>
      <tr>
        <td id="file-nulls-5-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-5-cs-LC4"><span><span>//</span> No warnings!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-5-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-5-cs-LC5"><span>var</span> <span>doStufferRight</span> <span>=</span> <span>new</span> <span>DoStuff</span>&lt;<span>string</span>, <span>string</span>&gt;();</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>It also works for value types:</p><div id="gist97640626">
    <div>
      <div>
        <div>
  <div id="file-nulls-6-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-6-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-6-cs-LC1"><span><span>//</span> Warning: CS8714 - Nullability of type argument 'int?' doesn't match 'notnull' constraint</span></td>
      </tr>
      <tr>
        <td id="file-nulls-6-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-6-cs-LC2"><span>var</span> <span>doStuffer</span> <span>=</span> <span>new</span> <span>DoStuff</span>&lt;<span>int</span>?, <span>int</span>?&gt;();</td>
      </tr>
      <tr>
        <td id="file-nulls-6-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-6-cs-LC3">
</td>
      </tr>
      <tr>
        <td id="file-nulls-6-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-6-cs-LC4"><span><span>//</span> No warnings!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-6-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-6-cs-LC5"><span>var</span> <span>doStufferRight</span> <span>=</span> <span>new</span> <span>DoStuff</span>&lt;<span>int</span>, <span>int</span>&gt;();</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>This constraint is useful for generic code where you want to ensure that only non-nullable reference types can be used. One prominent example is <code>Dictionary&lt;TKey, TValue</code>, where <code>TKey</code> is now constrained to be <code>notnull</code>, which disallows using <code>null</code> as a key:</p><div id="gist97640635">
    <div>
      <div>
        <div>
  <div id="file-nulls-7-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-7-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-7-cs-LC1"><span><span>//</span> Warning: CS8714 - Nullability of type argument 'string?' doesn't match 'notnull' constraint</span></td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-7-cs-LC2"><span>var</span> <span>d1</span> <span>=</span> <span>new</span> <span>Dictionary</span>&lt;<span>string</span>?, <span>string</span>&gt;(<span>10</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-7-cs-LC3">
</td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-7-cs-LC4"><span><span>//</span> And as expected, using 'null' as a key for a non-nullable key type is a warning...</span></td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-7-cs-LC5"><span>var</span> <span>d2</span> <span>=</span> <span>new</span> <span>Dictionary</span>&lt;<span>string</span>, <span>string</span>&gt;(<span>10</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-7-cs-LC6">
</td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-7-cs-LC7"><span><span>//</span> Warning: CS8625 - Cannot convert to non-nullable reference type.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-7-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-7-cs-LC8"><span>var</span> <span>nothing</span> <span>=</span> <span>d2</span>[<span>null</span>];</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>However, not all nullability problems with generics can be solved in this way. This is where we’ve added some new attributes to allow you to influence nullable analysis in the compiler.</p><h3 id="the-issue-with-t">The issue with <code>T?</code></h3><p>So you have have wondered: why not "just" allow <code>T?</code> when specifying a generic type that could be substituted with a nullable reference or value type? The answer is, unfortunately, complicated.</p><p>A natural definition of <code>T?</code> would mean, "any nullable type". However, this would imply that <code>T</code> would mean "any non-nullable type", and that is not true! It is possible to substitute a <code>T</code> with a nullable value type today (such as <code>bool?</code>). This is because <code>T</code> is already an unconstrained generic type. This change in semantics would likely be unexpected and cause some grief for the vast amount of existing code that uses <code>T</code> as an unconstrained generic type.</p><p>Next, it’s important to note that a nullable reference type is <em>not</em> the same thing as a nullable value type. Nullable value types map to a concrete class type in .NET. So <code>int?</code> is actually <code>Nullable&lt;int&gt;</code>. But for <code>string?</code>, it’s actually the same <code>string</code> but with a compiler-generated attribute annotating it. This is done for backwards compatibility. In other words, <code>string?</code> is kind of a "fake type", whereas <code>int?</code> is not.</p><p>This distinction between nullable value types and nullable reference types comes up in a pattern such as this:</p><pre><code><span>void</span><span> M</span><span>&lt;</span><span>T</span><span>&gt;(</span><span>T</span><span>?</span><span> t</span><span>)</span><span> </span><span>where</span><span> T</span><span>:</span><span> notnull</span></code></pre><p>This would mean that the parameter is the nullable version of <code>T</code>, and <code>T</code> is constrained to be <code>notnull</code>. If <code>T</code> were a <code>string</code>, then the actual signature of <code>M</code> would be <code>M&lt;string&gt;([NullableAttribute] T t)</code>, but if <code>T</code> were an <code>int</code>, then <code>M</code> would be <code>M&lt;int&gt;(Nullable&lt;int&gt; t)</code>. These two signatures are fundamentally different, and this difference is not reconcilable.</p><p>Because of this issue between the concrete representations of nullable reference types and nullable value types, any use of <code>T?</code> must also require you to constrain the <code>T</code> to be either <code>class</code> or <code>struct</code>.</p><p>Finally, the existence of a <code>T?</code> that worked for both nullable reference types and nullable value types does not address every issue with generics. You may want to allow for nullable types in a single direction (i.e., as only an input or only an output) and that is not expressible with either <code>notnull</code> nor a <code>T</code> and <code>T?</code> split unless you artificially add separate generic types for inputs and outputs.</p><h3 id="nullable-preconditions-allownull-and-disallownull">Nullable preconditions: <code>AllowNull</code> and <code>DisallowNull</code></h3><p>Consider the following example:</p><div id="gist97640648">
    <div>
      <div>
        <div>
  <div id="file-nulls-8-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-8-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-8-cs-LC1"><span>public</span> <span>class</span> <span>MyClass</span></td>
      </tr>
      <tr>
        <td id="file-nulls-8-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-8-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-8-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-8-cs-LC3">    <span>public</span> <span>string</span> <span>MyValue</span> { <span>get</span>; <span>set</span>; }</td>
      </tr>
      <tr>
        <td id="file-nulls-8-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-8-cs-LC4">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>This might have been an API that we supported prior to C# 8.0. However, the meaning of <code>string</code> now means non-nullable <code>string</code>! We may wish to actually still allow <code>null</code> values, but always give back some <code>string</code> value with the <code>get</code>. Here’s where <code>AllowNull</code> can come in and let you get fancy:</p><div id="gist97640652">
    <div>
      <div>
        <div>
  <div id="file-nulls-9-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-9-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-9-cs-LC1"><span>public</span> <span>class</span> <span>MyClass</span></td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-9-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-9-cs-LC3">    <span>private</span> <span>string</span> <span>_innerValue</span> <span>=</span> <span>string</span>.<span>Empty</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-9-cs-LC4">
</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-9-cs-LC5">    [<span>AllowNull</span>]</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-9-cs-LC6">    <span>public</span> <span>string</span> <span>MyValue</span></td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-9-cs-LC7">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-9-cs-LC8">        <span>get</span></td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-9-cs-LC9">        {</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-9-cs-LC10">            <span>return</span> <span>_innerValue</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-9-cs-LC11">        }</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-9-cs-LC12">        <span>set</span></td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-9-cs-LC13">        {</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-9-cs-LC14">            <span>_innerValue</span> <span>=</span> <span>value</span> <span>??</span> <span>string</span>.<span>Empty</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-9-cs-LC15">        }</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L16" data-line-number="16"></td>
        <td id="file-nulls-9-cs-LC16">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-9-cs-L17" data-line-number="17"></td>
        <td id="file-nulls-9-cs-LC17">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>Since we always make sure that we get no <code>null</code> value with the getter, I’d like the type to remain <code>string</code>. But we want to still accept <code>null</code> values for backwards compatibility. The <code>AllowNull</code> attribute lets you specify that the setter accepts <code>null</code> values. Callers are then affected as you’d expect:</p><div id="gist97640659">
    <div>
      <div>
        <div>
  <div id="file-nulls-10-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-10-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-10-cs-LC1"><span>void</span> <span>M1</span>(<span>MyClass</span> <span>mc</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-10-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-10-cs-LC3">    <span>mc</span>.<span>MyValue</span> <span>=</span> <span>null</span>; <span><span>//</span> Allowed because of AllowNull</span></td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-10-cs-LC4">}</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-10-cs-LC5">
</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-10-cs-LC6"><span>void</span> <span>M2</span>(<span>MyClass</span> <span>mc</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-10-cs-LC7">{</td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-10-cs-LC8">    <span>Console</span>.<span>WriteLine</span>(<span>mc</span>.<span>MyValue</span>.<span>Length</span>); <span><span>//</span> Also allowed, note there is no warning</span></td>
      </tr>
      <tr>
        <td id="file-nulls-10-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-10-cs-LC9">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>Note: there is currently <a href="https://github.com/dotnet/roslyn/issues/37313" target="_blank">a bug</a> where assignment of <code>null</code> conflicts with nullable analysis. This will be addressed in a future update of the compiler.</p><p>Consider another API:</p><div id="gist97640664">
    <div>
      <div>
        <div>
  <div id="file-nulls-11-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-11-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-11-cs-LC1"><span>public</span> <span>static</span> <span>HandleMethods</span></td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-11-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-11-cs-LC3">    <span>public</span> <span>static</span> <span>void</span> <span>DisposeAndClear</span>(<span>ref</span> <span>MyHandle</span> <span>handle</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-11-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-11-cs-LC5">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-11-cs-LC6">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-11-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-11-cs-LC7">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>In this case, <code>MyHandle</code> refers to some handle to a resource. Typical use for this API is that we have a non-<code>null</code> instance that we pass by reference, but when it is cleared, the reference is <code>null</code>. We can get fancy and represent this with <code>DisallowNull</code>:</p><div id="gist97640677">
    <div>
      <div>
        <div>
  <div id="file-nulls-12-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-12-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-12-cs-LC1"><span>public</span> <span>static</span> <span>HandleMethods</span></td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-12-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-12-cs-LC3">    <span>public</span> <span>static</span> <span>void</span> <span>DisposeAndClear</span>([<span>DisallowNull</span>] <span>ref</span> <span>MyHandle</span>? <span>handle</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-12-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-12-cs-LC5">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-12-cs-LC6">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-12-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-12-cs-LC7">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>This will affect any caller by emitting a warning if they pass <code>null</code>, but will warn if you attempt to "dot" into the <code>handle</code> after the method is called:</p><div id="gist97640685">
    <div>
      <div>
        <div>
  <div id="file-nulls-13-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-13-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-13-cs-LC1"><span>void</span> <span>M</span>(<span>MyHandle</span> <span>handle</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-13-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-13-cs-LC3">    <span>MyHandle</span>? <span>local</span> <span>=</span> <span>null</span>; <span><span>//</span> Create a null value here</span></td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-13-cs-LC4">    <span>HandleMethods</span>.<span>DisposeAndClear</span>(<span>ref</span> <span>local</span>); <span><span>//</span> Warning: CS8601 - Possible null reference assignment</span></td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-13-cs-LC5">    </td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-13-cs-LC6">    <span><span>//</span> Now pass the non-null handle</span></td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-13-cs-LC7">    <span>HandleMethods</span>.<span>DisposeAndClear</span>(<span>ref</span> <span>handle</span>); <span><span>//</span> No warning! ... But the value could be null now</span></td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-13-cs-LC8">    </td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-13-cs-LC9">    <span>Console</span>.<span>WriteLine</span>(<span>handle</span>.<span>SomeProperty</span>); <span><span>//</span> Warning: CS8602 - Dereference of a possibly null reference</span></td>
      </tr>
      <tr>
        <td id="file-nulls-13-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-13-cs-LC10">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>These two attributes allow us single-direction nullability or non-nullability for those cases where we need them.</p><p>More formally:</p><p>The <code>AllowNull</code> attribute allows callers to pass <code>null</code> even if the type doesn’t allow it. The <code>DisallowNull</code> attribute disallows callers to pass <code>null</code> even if the type allows it. They can be specified on anything that takes input:</p><ul><li>Value parameters</li><li><code>in</code> parameters</li><li><code>ref</code> parameters</li><li>fields</li><li>properties</li><li>indexers</li></ul><p><strong>Important:</strong> These attributes only affect nullable analysis for the <em>callers</em> of methods that are annotated with them. The bodies of annotated methods  and things like interface implementation do not respect these attributes. We may add support for that in the future.</p><h3 id="nullable-postconditions-maybenull-and-notnull">Nullable postconditions: <code>MaybeNull</code> and <code>NotNull</code></h3><p>Consider the following example API:</p><div id="gist97640697">
    <div>
      <div>
        <div>
  <div id="file-nulls-14-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-14-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-14-cs-LC1"><span>public</span> <span>class</span> <span>MyArray</span></td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-14-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-14-cs-LC3">    <span><span>//</span> Result is the default of T if no match is found</span></td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-14-cs-LC4">    <span>public</span> <span>static</span> <span>T</span> <span>Find</span>&lt;<span>T</span>&gt;(<span>T</span>[] <span>array</span>, <span>Func</span>&lt;<span>T</span>, <span>bool</span>&gt; <span>match</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-14-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-14-cs-LC6">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-14-cs-LC7">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-14-cs-LC8">
</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-14-cs-LC9">    <span><span>//</span> Never gives back a null when called</span></td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-14-cs-LC10">    <span>public</span> <span>static</span> <span>void</span> <span>Resize</span>&lt;<span>T</span>&gt;(<span>ref</span> <span>T</span>[] <span>array</span>, <span>int</span> <span>newSize</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-14-cs-LC11">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-14-cs-LC12">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-14-cs-LC13">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-14-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-14-cs-LC14">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>Here we have another problem. We’d like <code>Find</code> to give back <code>default</code> if nothing is found, which is <code>null</code> for reference types. We’d like <code>Resize</code> to accept a possibly <code>null</code> input, but we want to ensure that after <code>Resize</code> is called, the <code>array</code> value passed by reference is always non-<code>null</code>. Again, applying the <code>notnull</code> constraint doesn’t solve this. Uh-oh!</p><p>Enter <code>[MaybeNull]</code> and <code>[NotNull]</code>. Now we can get fancy with the nullability of the outputs! We can modify the example as such:</p><div id="gist97640710">
    <div>
      <div>
        <div>
  <div id="file-nulls-15-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-15-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-15-cs-LC1"><span>public</span> <span>class</span> <span>MyArray</span></td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-15-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-15-cs-LC3">    <span><span>//</span> Result is the default of T if no match is found</span></td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-15-cs-LC4">    [<span>return</span>: <span>MaybeNull</span>]</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-15-cs-LC5">    <span>public</span> <span>static</span> <span>T</span> <span>Find</span>&lt;<span>T</span>&gt;(<span>T</span>[] <span>array</span>, <span>Func</span>&lt;<span>T</span>, <span>bool</span>&gt; <span>match</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-15-cs-LC6">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-15-cs-LC7">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-15-cs-LC8">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-15-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-15-cs-LC10">    <span><span>//</span> Never gives back a null when called</span></td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-15-cs-LC11">    <span>public</span> <span>static</span> <span>void</span> <span>Resize</span>&lt;<span>T</span>&gt;([<span>NotNull</span>] <span>ref</span> <span>T</span>[]? array, <span>int</span> <span>newSize</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-15-cs-LC12">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-15-cs-LC13">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-15-cs-LC14">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-15-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-15-cs-LC15">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>And these can now affect call sites:</p><div id="gist97640715">
    <div>
      <div>
        <div>
  <div id="file-nulls-16-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-16-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-16-cs-LC1"><span>void</span> <span>M</span>(<span>string</span>[] <span>testArray</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-16-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-16-cs-LC3">    <span>var</span> <span>value</span> <span>=</span> <span>MyArray</span>.<span>Find</span>&lt;<span>string</span>&gt;(<span>testArray</span>, <span>s</span> <span>=&gt;</span> <span>s</span> <span>==</span> <span><span>"</span>Hello!<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-16-cs-LC4">    <span>Console</span>.<span>WriteLine</span>(<span>value</span>.<span>Length</span>); <span><span>//</span> Warning: Dereference of a possibly null reference.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-16-cs-LC5">
</td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-16-cs-LC6">    <span>MyArray</span>.<span>Resize</span>&lt;<span>string</span>&gt;(<span>ref</span> <span>testArray</span>, <span>200</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-16-cs-LC7">    <span>Console</span>.<span>WriteLine</span>(<span>testArray</span>.<span>Length</span>); <span><span>//</span> Safe!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-16-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-16-cs-LC8">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>The first method specifies that the <code>T</code> that is returned could be a <code>null</code> value. This means that callers of this method must check for <code>null</code> when using its result.</p><p>The second method has a trickier signature: <code>[NotNull] ref T[]? array</code>. This means that <code>array</code> could be <code>null</code> as an input, but when <code>Resize</code> is called, <code>array</code> will not be <code>null</code>. This means that if you "dot" into <code>array</code> after calling <code>Resize</code>, you will not get a warning. But after <code>Resize</code> is called, <code>array</code> will no longer be <code>null</code>.</p><p>More formally:</p><p>The <code>MaybeNull</code> attribute allows for a return type to be <code>null</code>, even if its type doesn’t allow it. The <code>NotNull</code> attribute disallows <code>null</code> results even if the type allows it. They can be specified on anything that produces output:</p><ul><li>Method returns</li><li><code>out</code> parameters (after a method is called)</li><li><code>ref</code> parameters (after a method is called)</li><li>fields</li><li>properties</li><li>indexers</li></ul><p><strong>Important:</strong> These attributes only affect nullable analysis for the <em>callers</em> of methods that are annotated with them. The bodies of annotated methods  and things like interface implementation do not respect these attributes. We may add support for that in the future.</p><h3 id="conditional-postconditions-maybenullwhenbool-and-notnullwhenbool">Conditional postconditions: <code>MaybeNullWhen(bool)</code> and <code>NotNullWhen(bool)</code></h3><p>Consider the following example:</p><div id="gist97640725">
    <div>
      <div>
        <div>
  <div id="file-nulls-17-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-17-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-17-cs-LC1"><span>public</span> <span>class</span> <span>MyString</span></td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-17-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-17-cs-LC3">    <span><span>//</span> True when 'value' is null</span></td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-17-cs-LC4">    <span>public</span> <span>static</span> <span>bool</span> <span>IsNullOrEmpty</span>(<span>string</span>? <span>value</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-17-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-17-cs-LC6">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-17-cs-LC7">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-17-cs-LC8">}</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-17-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-17-cs-LC10"><span>public</span> <span>class</span> <span>MyVersion</span></td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-17-cs-LC11">{</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-17-cs-LC12">    <span><span>//</span> If it parses successfully, the Version will not be null.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-17-cs-LC13">    <span>public</span> <span>static</span> <span>bool</span> <span>TryParse</span>(<span>string</span>? <span>input</span>, <span>out</span> <span>Version</span>? <span>version</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-17-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-17-cs-LC15">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L16" data-line-number="16"></td>
        <td id="file-nulls-17-cs-LC16">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L17" data-line-number="17"></td>
        <td id="file-nulls-17-cs-LC17">}</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L18" data-line-number="18"></td>
        <td id="file-nulls-17-cs-LC18">
</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L19" data-line-number="19"></td>
        <td id="file-nulls-17-cs-LC19"><span>public</span> <span>class</span> <span>MyQueue</span>&lt;<span>T</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L20" data-line-number="20"></td>
        <td id="file-nulls-17-cs-LC20">{</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L21" data-line-number="21"></td>
        <td id="file-nulls-17-cs-LC21">    <span><span>//</span> 'result' could be null if we couldn't Dequeue it.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L22" data-line-number="22"></td>
        <td id="file-nulls-17-cs-LC22">    <span>public</span> <span>bool</span> <span>TryDequeue</span>(<span>out</span> <span>T</span> <span>result</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L23" data-line-number="23"></td>
        <td id="file-nulls-17-cs-LC23">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L24" data-line-number="24"></td>
        <td id="file-nulls-17-cs-LC24">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L25" data-line-number="25"></td>
        <td id="file-nulls-17-cs-LC25">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-17-cs-L26" data-line-number="26"></td>
        <td id="file-nulls-17-cs-LC26">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>Methods like this are everywhere in .NET, where the return value of <code>true</code> or <code>false</code> corresponds to the nullability (or possible nullability) of a parameter. The <code>MyQueue</code> case is also a bit special, since it’s generic. <code>TryDequeue</code> should give a <code>null</code> for <code>result</code> if the result is <code>false</code>, but only if <code>T</code> is a reference type. If <code>T</code> is a struct, then it won’t be <code>null</code>.</p><p>So, we want to do three things:</p><ol><li>Signal that if <code>IsNullOrEmpty</code> returns <code>false</code>, then <code>value</code> is non-<code>null</code></li><li>Signal that if <code>TryParse</code> returns <code>true</code>, then <code>version</code> is non-<code>null</code></li><li>Signal that if <code>TryDequeue</code> returns <code>false</code>, then <code>result</code> <em>could</em> be <code>null</code>, provided it’s a reference type</li></ol><p>Unfortunately, the C# compiler does not associate the return value of a method with the nullability of one of its parameters! Uh-oh!</p><p>Enter <code>NotNullWhen(bool)</code> and <code>MaybeNullWhen(bool)</code>. Now we can get <em>even fancier</em> with parameters:</p><div id="gist97640730">
    <div>
      <div>
        <div>
  <div id="file-nulls-18-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-18-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-18-cs-LC1"><span>public</span> <span>class</span> <span>MyString</span></td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-18-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-18-cs-LC3">    <span><span>//</span> True when 'value' is null</span></td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-18-cs-LC4">    <span>public</span> <span>static</span> <span>bool</span> <span>IsNullOrEmpty</span>([<span>NotNullWhen</span>(<span>false</span>)] <span>string</span>? <span>value</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-18-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-18-cs-LC6">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-18-cs-LC7">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-18-cs-LC8">}</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-18-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-18-cs-LC10"><span>public</span> <span>class</span> <span>MyVersion</span></td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-18-cs-LC11">{</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-18-cs-LC12">    <span><span>//</span> If it parses successfully, the Version will not be null.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-18-cs-LC13">    <span>public</span> <span>static</span> <span>bool</span> <span>TryParse</span>(<span>string</span>? <span>input</span>, [<span>NotNullWhen</span>(<span>true</span>)] <span>out</span> <span>Version</span>? <span>version</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-18-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-18-cs-LC15">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L16" data-line-number="16"></td>
        <td id="file-nulls-18-cs-LC16">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L17" data-line-number="17"></td>
        <td id="file-nulls-18-cs-LC17">}</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L18" data-line-number="18"></td>
        <td id="file-nulls-18-cs-LC18">
</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L19" data-line-number="19"></td>
        <td id="file-nulls-18-cs-LC19"><span>public</span> <span>class</span> <span>MyQueue</span>&lt;<span>T</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L20" data-line-number="20"></td>
        <td id="file-nulls-18-cs-LC20">{</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L21" data-line-number="21"></td>
        <td id="file-nulls-18-cs-LC21">    <span><span>//</span> 'result' could be null if we couldn't Dequeue it.</span></td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L22" data-line-number="22"></td>
        <td id="file-nulls-18-cs-LC22">    <span>public</span> <span>bool</span> <span>TryDequeue</span>([<span>MaybeNullWhen</span>(<span>false</span>)] <span>out</span> <span>T</span> <span>result</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L23" data-line-number="23"></td>
        <td id="file-nulls-18-cs-LC23">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L24" data-line-number="24"></td>
        <td id="file-nulls-18-cs-LC24">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L25" data-line-number="25"></td>
        <td id="file-nulls-18-cs-LC25">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-18-cs-L26" data-line-number="26"></td>
        <td id="file-nulls-18-cs-LC26">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>And these can now affect call sites:</p><div id="gist97640737">
    <div>
      <div>
        <div>
  <div id="file-nulls-19-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-19-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-19-cs-LC1"><span>void</span> <span>StringTest</span>(<span>string</span>? <span>s</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-19-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-19-cs-LC3">    <span>if</span> (<span>MyString</span>.<span>IsNullOrEmpty</span>(<span>s</span>))</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-19-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-19-cs-LC5">        <span><span>//</span> This would generate a warning:</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-19-cs-LC6">        <span><span>//</span> Console.WriteLine(s.Length);</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-19-cs-LC7">        <span>return</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-19-cs-LC8">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-19-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-19-cs-LC10">    <span>Console</span>.<span>WriteLine</span>(<span>s</span>.<span>Length</span>); <span><span>//</span> Safe!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-19-cs-LC11">}</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-19-cs-LC12">
</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-19-cs-LC13"><span>void</span> <span>VersionTest</span>(<span>string</span>? <span>s</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-19-cs-LC14">{</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-19-cs-LC15">    <span>if</span> (<span>!</span><span>MyVersion</span>.<span>TryParse</span>(<span>s</span>, <span>out</span> <span>var</span> <span>version</span>))</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L16" data-line-number="16"></td>
        <td id="file-nulls-19-cs-LC16">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L17" data-line-number="17"></td>
        <td id="file-nulls-19-cs-LC17">        <span><span>//</span> This would generate a warning:</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L18" data-line-number="18"></td>
        <td id="file-nulls-19-cs-LC18">        <span><span>//</span> Console.WriteLine(version.Major);</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L19" data-line-number="19"></td>
        <td id="file-nulls-19-cs-LC19">        <span>return</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L20" data-line-number="20"></td>
        <td id="file-nulls-19-cs-LC20">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L21" data-line-number="21"></td>
        <td id="file-nulls-19-cs-LC21">
</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L22" data-line-number="22"></td>
        <td id="file-nulls-19-cs-LC22">    <span>Console</span>.<span>WriteLine</span>(<span>version</span>.<span>Major</span>); <span><span>//</span> Safe!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L23" data-line-number="23"></td>
        <td id="file-nulls-19-cs-LC23">}</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L24" data-line-number="24"></td>
        <td id="file-nulls-19-cs-LC24">
</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L25" data-line-number="25"></td>
        <td id="file-nulls-19-cs-LC25"><span>void</span> <span>QueueTest</span>(<span>MyQueue</span>&lt;<span>string</span>&gt; <span>q</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L26" data-line-number="26"></td>
        <td id="file-nulls-19-cs-LC26">{</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L27" data-line-number="27"></td>
        <td id="file-nulls-19-cs-LC27">    <span>if</span> (<span>!</span><span>q</span>.<span>TryDequeue</span>(<span>out</span> <span>var</span> <span>s</span>))</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L28" data-line-number="28"></td>
        <td id="file-nulls-19-cs-LC28">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L29" data-line-number="29"></td>
        <td id="file-nulls-19-cs-LC29">        <span><span>//</span> This would generate a warning:</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L30" data-line-number="30"></td>
        <td id="file-nulls-19-cs-LC30">        <span><span>//</span> Console.WriteLine(s.Length);</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L31" data-line-number="31"></td>
        <td id="file-nulls-19-cs-LC31">        <span>return</span>;</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L32" data-line-number="32"></td>
        <td id="file-nulls-19-cs-LC32">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L33" data-line-number="33"></td>
        <td id="file-nulls-19-cs-LC33">
</td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L34" data-line-number="34"></td>
        <td id="file-nulls-19-cs-LC34">    <span>Console</span>.<span>WriteLine</span>(<span>s</span>.<span>Length</span>); <span><span>//</span> Safe!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-19-cs-L35" data-line-number="35"></td>
        <td id="file-nulls-19-cs-LC35">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>This enables callers to work with APIs using the same patterns that they’ve used before, without any spurious warnings from the compiler:</p><ul><li>If <code>IsNullOrEmpty</code> is true, it’s safe to "dot" into <code>value</code></li><li>If <code>TryParse</code> is true, then <code>version</code> was parsed and is safe to "dot" into</li><li>If <code>TryDequeue</code> is false, then <code>result</code> might be <code>null</code> and a check is needed (example: returning <code>false</code> when the type is a struct is non-<code>null</code>, but <code>false</code> for a reference type means it could be <code>null</code>)</li></ul><p>More formally:</p><p>The <code>NotNullWhen(bool)</code> signifies that a parameter is not null even if the type allows it, conditional on the <code>bool</code> returned value of the method. The <code>MaybeNullWhen(bool)</code> signifies that a parameter could be null even if the type disallows it, conditional on the <code>bool</code> returned value of the method. They can be specified on any parameter type.</p><h3 id="nullness-dependence-between-inputs-and-outputs-notnullifnotnullstring">Nullness dependence between inputs and outputs: <code>NotNullIfNotNull(string)</code></h3><p>Consider the following example:</p><div id="gist97640743">
    <div>
      <div>
        <div>
  <div id="file-nulls-20-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-20-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-20-cs-LC1"><span>class</span> <span>MyPath</span></td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-20-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-20-cs-LC3">    <span>public</span> <span>static</span> <span>string</span>? <span>GetFileName</span>(<span>string</span>? <span>path</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-20-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-20-cs-LC5">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-20-cs-LC6">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-20-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-20-cs-LC7">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>In this case, we’d like to return a possibly <code>null</code> string, and we should also be able to accept a <code>null</code> value as input. So the signature accomplishes what I’d like to express.</p><p>However, if <code>path</code> is not <code>null</code>, we’d like to ensure that we always give back a string. That is, we want the return value of <code>GetFileName</code> to be non-null, conditional on the nullness of <code>path</code>. There’s no way to express this as-is. Uh-oh!</p><p>Enter <code>NotNullIfNotNull(string)</code>. This attribute can make your code the <em>fanciest</em>, so use it with care! Here’s how we’ll use it in my API:</p><div id="gist97640749">
    <div>
      <div>
        <div>
  <div id="file-nulls-21-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-21-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-21-cs-LC1"><span>class</span> <span>MyPath</span></td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-21-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-21-cs-LC3">    [<span>return</span>: <span>NotNullIfNotNull</span>(<span><span>"</span>path<span>"</span></span>)]</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-21-cs-LC4">    <span>public</span> <span>static</span> <span>string</span>? <span>GetFileName</span>(<span>string</span>? <span>path</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-21-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-21-cs-LC6">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-21-cs-LC7">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-21-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-21-cs-LC8">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>And this can now affect call sites:</p><div id="gist97640752">
    <div>
      <div>
        <div>
  <div id="file-nulls-22-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-22-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-22-cs-LC1"><span>void</span> <span>PathTest</span>(<span>string</span>? <span>path</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-22-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-22-cs-LC3">    <span>var</span> <span>possiblyNullPath</span> <span>=</span> <span>MyPath</span>.<span>GetFileName</span>(<span>path</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-22-cs-LC4">    <span>Console</span>.<span>WriteLine</span>(<span>possiblyNullPath</span>.<span>Length</span>); <span><span>//</span> Warning: Dereference of a possibly null reference</span></td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-22-cs-LC5">    </td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-22-cs-LC6">    <span>if</span> (<span>!</span><span>string</span>.<span>IsNullOrEmpty</span>(<span>path</span>))</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-22-cs-LC7">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-22-cs-LC8">        <span>var</span> <span>goodPath</span> <span>=</span> <span>MyPath</span>.<span>GetFileName</span>(<span>path</span>);</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-22-cs-LC9">        <span>Console</span>.<span>WriteLine</span>(<span>goodPath</span>.<span>Length</span>); <span><span>//</span> Safe!</span></td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-22-cs-LC10">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-22-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-22-cs-LC11">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>More formally:</p><p>The <code>NotNullIfNotNull(string)</code> attribute signifies that any output value is non-<code>null</code> conditional on the nullability of a given parameter whose name is specified. They can be specified on the following constructs:</p><ul><li>Method returns</li><li><code>ref</code> parameters</li></ul><h3 id="flow-attributes-doesnotreturn-and-doesnotreturnifbool">Flow attributes: <code>DoesNotReturn</code> and <code>DoesNotReturnIf(bool)</code></h3><p>You may work with multiple methods that affect control flow of your program. For example, an exception helper method that will throw an exception if called, or an assertion method that will throw an exception if an input is <code>true</code> or <code>false</code>.</p><p>You may wish to do something like <em>assert</em> that a value is non-null, and we think you’d also like it if the compiler could understand that.</p><p>Enter <code>DoesNotReturn</code> and <code>DoesNotReturnIf(bool)</code>. Here’s an example of how you could use either:</p><div id="gist97640758">
    <div>
      <div>
        <div>
  <div id="file-nulls-23-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8">
      <tbody><tr>
        <td id="file-nulls-23-cs-L1" data-line-number="1"></td>
        <td id="file-nulls-23-cs-LC1"><span>internal</span> <span>static</span> <span>class</span> <span>ThrowHelper</span></td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L2" data-line-number="2"></td>
        <td id="file-nulls-23-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L3" data-line-number="3"></td>
        <td id="file-nulls-23-cs-LC3">    [<span>DoesNotReturn</span>]</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L4" data-line-number="4"></td>
        <td id="file-nulls-23-cs-LC4">    <span>public</span> <span>static</span> <span>void</span> <span>ThrowArgumentNullException</span>(<span>ExceptionArgument</span> <span>arg</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L5" data-line-number="5"></td>
        <td id="file-nulls-23-cs-LC5">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L6" data-line-number="6"></td>
        <td id="file-nulls-23-cs-LC6">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L7" data-line-number="7"></td>
        <td id="file-nulls-23-cs-LC7">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L8" data-line-number="8"></td>
        <td id="file-nulls-23-cs-LC8">}</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L9" data-line-number="9"></td>
        <td id="file-nulls-23-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L10" data-line-number="10"></td>
        <td id="file-nulls-23-cs-LC10"><span>public</span> <span>static</span> <span>class</span> <span>MyAssertionLibrary</span></td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L11" data-line-number="11"></td>
        <td id="file-nulls-23-cs-LC11">{</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L12" data-line-number="12"></td>
        <td id="file-nulls-23-cs-LC12">    <span>public</span> <span>static</span> <span>void</span> <span>MyAssert</span>([<span>DoesNotReturnIf</span>(<span>false</span>)] <span>bool</span> <span>condition</span>)</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L13" data-line-number="13"></td>
        <td id="file-nulls-23-cs-LC13">    {</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L14" data-line-number="14"></td>
        <td id="file-nulls-23-cs-LC14">        ...</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L15" data-line-number="15"></td>
        <td id="file-nulls-23-cs-LC15">    }</td>
      </tr>
      <tr>
        <td id="file-nulls-23-cs-L16" data-line-number="16"></td>
        <td id="file-nulls-23-cs-LC16">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>When <code>ThrowArgumentNullException</code> is called in a method, it throws an exception. The <code>DoesNotReturn</code> it is annotated with will signal to the compiler that no nullable analysis needs to happen after that point, since that code would be unreachable.</p><p>When <code>MyAssert</code> is called and the condition passed to it is <code>false</code>, it throws an exception. The <code>DoesNotReturnIf(false)</code> that annotates the <code>condition</code> parameter lets the compiler know that program flow will not continue if that condition is false. This is helpful if you want to assert the nullability of a value. In the code path following <code>MyAssert(value != null);</code> the compiler can assume <code>value</code> is not null.</p><p><code>DoesNotReturn</code> can be used on methods. <code>DoesNotReturnIf(bool)</code> can be used on input parameters.</p><h2 id="evolving-your-annotations">Evolving your annotations<a href="#evolving-your-annotations"></a></h2><p>Once you annotate a public API, you’ll want to consider the fact that updating an API can have downstream effects:</p><ul><li>Adding nullable annotations where there weren’t any may introduce warnings to user code</li><li>Removing nullable annotations can also introduce warnings (e.g., interface implementation)</li></ul><p>Nullable annotations are an integral part of your public API. Adding or removing annotations introduce new warnings. We recommend starting with a preview release where you solicit feedback, with aims to not change any annotations after a full release. This isn’t always going to be possible, but we recommend it nonetheless.</p><h2 id="current-status-of-microsoft-frameworks-and-libraries">Current status of Microsoft frameworks and libraries<a href="#current-status-of-microsoft-frameworks-and-libraries"></a></h2><p>Because Nullable Reference Types are so new, the large majority of Microsoft-authored C# frameworks and libraries have not yet been appropriately annotated.</p><p>That said, the "Core Lib" part of .NET Core, which represents about ~20% of the .NET Core shared framework, has been fully updated. It includes namespaces like <code>System</code>, <code>System.IO</code>, and <code>System.Collections.Generic</code>. We’re looking for feedback on our decisions so that we can make appropriate tweaks as soon as possible, and before their usage becomes widespread.</p><p>Although there is still ~80% CoreFX to still annotate, the most-used APIs are fully annotated.</p><h2 id="roadmap-for-nullable-reference-types">Roadmap for Nullable Reference Types<a href="#roadmap-for-nullable-reference-types"></a></h2><p>Currently, we view the <em>full</em> Nullable Reference Types experience as being in preview. It’s stable, but the feature involves spreading nullable annotations throughout our own technologies and the greater .NET ecosystem. This will take some time to complete.</p><p>That said, we’re encouraging library authors to start annotating their libraries now. The feature will only get better as more libraries adopt nullability, helping .NET become a more <code>null</code>-safe place.</p><p>Over the coming year or so, we’re going to continue to improve the feature and spread its use throughout Microsoft frameworks and libraries.</p><p>For the language, especially compiler analysis, we’ll be making numerous enhancements so that we can minimize your need to do things like use the null-forgiveness (<code>!</code>) operator. Many of these enhancements are <a href="https://github.com/dotnet/roslyn/issues?q=is%3Aissue+is%3Aopen+label%3A%22New+Language+Feature+-+Nullable+Reference+Types%22" target="_blank">already tracked on the Roslyn repo</a>.</p><p>For CoreFX, we’ll be annotating the remaining ~80% of APIs and making appropriate tweaks based on feedback.</p><p>For ASP.NET Core and Entity Framework, we’ll be annotating public APIs once some new additions to CoreFX and the compiler are added.</p><p>We haven’t yet planned how to annotate WinForms and WPF APIs, but we’d love to hear your feedback on what kinds of things matter!</p><p>Finally, we’re going to continue enhancing C# tooling in Visual Studio. We have multiple ideas for features to help using the feature, but we’d love your input as well!</p><h2 id="next-steps">Next steps<a href="#next-steps"></a></h2><p>If you’re still reading and haven’t tried out the feature in your code, especially your library code, give it a try and please give us feedback on anything you feel ought to be different. The journey to make unanticipated <code>NullReferenceException</code>s in .NET go away will be lengthy, but we hope that in the long run, developers simply won’t have to worry about getting bitten by implicit <code>null</code> values anymore. You can help us. Try out the feature and begin annotating your libraries. Feedback on your experience will help shorten that journey.</p><p>Cheers, and happy hacking!</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>