<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Announcing 8.0 for .NET Core 3.1 -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Announcing 8.0 for .NET Core 3.1</h1>
    <div class="col"> <p>If you&apos;ve already create a new web project for .NET Core <code>3.0</code> or <code>3.1</code> you know there are some differences between how the new version is configured in <code>Startup.cs</code>, this of course also reflects on Piranha. Let&apos;s take it step by step on how to upgrade your existing application.<br></p><h3>Project File and References<br></h3><p>When upgrading to <code>netcoreapp3.1</code> one of the major differences is that all <code>ASP.Net</code> references are now included as <strong>Framework References</strong> and nuget references for these packages should be removed from your project. Let&apos;s take a look at the project file for the blog template as an example:<br></p><p><strong>Piranha 7.1 for .NET Core 2.2</strong><br></p><pre>&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt; &lt;PropertyGroup&gt; &lt;TargetFramework&gt;netcoreapp2.2&lt;/TargetFramework&gt; &lt;AspNetCoreHostingModel&gt;InProcess&lt;/AspNetCoreHostingModel&gt; &lt;/PropertyGroup&gt; &lt;ItemGroup&gt; &lt;Folder Include=&quot;wwwroot\&quot; /&gt; &lt;/ItemGroup&gt; &lt;ItemGroup&gt; &lt;PackageReference Include=&quot;Microsoft.AspNetCore.App&quot; /&gt; &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Sqlite&quot; Version=&quot;2.2.4&quot; /&gt; &lt;PackageReference Include=&quot;Piranha&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AspNetCore&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AspNetCore.Identity.SQLite&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AttributeBuilder&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Data.EF&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.ImageSharp&quot; Version=&quot;7.1.0-rc1&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Local.FileStorage&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Manager&quot; Version=&quot;7.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Manager.TinyMCE&quot; Version=&quot;7.1.0&quot; /&gt; &lt;/ItemGroup&gt;<p>&lt;/Project&gt;</p></pre><p><strong>Piranha 8.0 for .NET Core 3.1</strong><br></p><pre>&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt; &lt;PropertyGroup&gt; &lt;TargetFramework&gt;netcoreapp3.1&lt;/TargetFramework&gt; &lt;/PropertyGroup&gt; &lt;ItemGroup&gt; &lt;Folder Include=&quot;wwwroot\&quot; /&gt; &lt;/ItemGroup&gt; &lt;ItemGroup&gt; &lt;PackageReference Include=&quot;Microsoft.EntityFrameworkCore.Sqlite&quot; Version=&quot;3.1.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AspNetCore&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AspNetCore.Identity.SQLite&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.AttributeBuilder&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Data.EF&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.ImageSharp&quot; Version=&quot;8.0.0-rc1&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Local.FileStorage&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Manager&quot; Version=&quot;8.0.0&quot; /&gt; &lt;PackageReference Include=&quot;Piranha.Manager.TinyMCE&quot; Version=&quot;8.0.0&quot; /&gt; &lt;/ItemGroup&gt;<p>&lt;/Project&gt;</p></pre><h3>Configure Services<br></h3><p>In <code>ConfigureServices</code> the main difference is how the <code>ASP.NET</code> services are added. <code>AddMvc</code> has now been split into separate methods for Razor Pages and MVC.<br></p><p><strong>Piranha 7.1 for .NET Core 2.2</strong><br></p><pre>public void ConfigureServices(IServiceCollection services){    services.AddLocalization(options =&gt;        options.ResourcesPath = &quot;Resources&quot;    );    services.AddMvc()        .AddPiranhaManagerOptions()        .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);    services.AddPiranha();    services.AddPiranhaApplication();    services.AddPiranhaFileStorage();    services.AddPiranhaImageSharp();    services.AddPiranhaManager();    services.AddPiranhaTinyMCE();    services.AddPiranhaMemoryCache();    services.AddPiranhaEF(options =&gt;        options.UseSqlite(Configuration.GetConnectionString(&quot;piranha&quot;)));    services.AddPiranhaIdentityWithSeed&lt;IdentitySQLiteDb&gt;(options =&gt;        options.UseSqlite(Configuration.GetConnectionString(&quot;piranha&quot;)));}</pre><p><strong>Piranha 8.0 for .NET Core 3.0</strong><br></p><pre>public void ConfigureServices(IServiceCollection services){ services.AddLocalization(options =&gt; options.ResourcesPath = &quot;Resources&quot; ); services.AddControllersWithViews(); services.AddRazorPages() .AddPiranhaManagerOptions(); services.AddPiranha(); services.AddPiranhaApplication(); services.AddPiranhaFileStorage(); services.AddPiranhaImageSharp(); services.AddPiranhaManager(); services.AddPiranhaTinyMCE(); services.AddPiranhaMemoryCache(); services.AddPiranhaEF(options =&gt; options.UseSqlite(Configuration.GetConnectionString(&quot;piranha&quot;))); services.AddPiranhaIdentityWithSeed&lt;IdentitySQLiteDb&gt;(options =&gt; options.UseSqlite(Configuration.GetConnectionString(&quot;piranha&quot;)));<p>}</p></pre><h3>Configure<br></h3><p>Again <code>UseMvc</code> has been split up into a number of components that needs to be registered differenctly. Pay attention to the order of the middleware, and especially to the position of the <strong>Authorization</strong> and <strong>Authentication</strong> components.<br></p><p><strong>Piranha 7.1 for .NET Core 2.2</strong><br></p><pre>public void Configure(IApplicationBuilder app, IHostingEnvironment env, IApi api){    // Initialize Piranha    App.Init(api);    // Configure cache level    App.CacheLevel = Piranha.Cache.CacheLevel.Basic;    // Build content types    var pageTypeBuilder = new Piranha.AttributeBuilder.PageTypeBuilder(api)        .AddType(typeof(Models.BlogArchive))        .AddType(typeof(Models.StandardPage));    pageTypeBuilder.Build()        .DeleteOrphans();    var postTypeBuilder = new Piranha.AttributeBuilder.PostTypeBuilder(api)       .AddType(typeof(Models.BlogPost));    postTypeBuilder.Build()        .DeleteOrphans();    // Configure Tiny MCE    EditorConfig.FromFile(&quot;editorconfig.json&quot;);    // Register middleware    app.UseStaticFiles();    app.UseAuthentication();    app.UsePiranha();    app.UsePiranhaManager();    app.UsePiranhaTinyMCE();    app.UseMvc(routes =&gt;    {        routes.MapRoute(name: &quot;areaRoute&quot;,        template: &quot;{area:exists}/{controller}/{action}/{id?}&quot;,        defaults: new { controller = &quot;Home&quot;, action = &quot;Index&quot; });        routes.MapRoute(        name: &quot;default&quot;,        template: &quot;{controller=home}/{action=index}/{id?}&quot;);    });}</pre><p><strong>Piranha 8.0 for .NET Core 3.1</strong><br></p><pre>public void Configure(IApplicationBuilder app, IWebHostEnvironment env, IApi api){ // Initialize Piranha App.Init(api); // Configure cache level App.CacheLevel = Piranha.Cache.CacheLevel.Basic; // Build content types var pageTypeBuilder = new Piranha.AttributeBuilder.PageTypeBuilder(api) .AddType(typeof(Models.BlogArchive)) .AddType(typeof(Models.StandardPage)); pageTypeBuilder.Build() .DeleteOrphans(); var postTypeBuilder = new Piranha.AttributeBuilder.PostTypeBuilder(api) .AddType(typeof(Models.BlogPost)); postTypeBuilder.Build() .DeleteOrphans(); // Configure Tiny MCE EditorConfig.FromFile(&quot;editorconfig.json&quot;); // Register middleware app.UseStaticFiles(); app.UsePiranha(); app.UseRouting(); app.UseAuthentication(); app.UseAuthorization(); app.UsePiranhaIdentity(); app.UsePiranhaManager(); app.UsePiranhaTinyMCE(); app.UseEndpoints(endpoints =&gt; { endpoints.MapControllerRoute( name: &quot;default&quot;, pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;); endpoints.MapPiranhaManager(); });<p>}</p></pre> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>