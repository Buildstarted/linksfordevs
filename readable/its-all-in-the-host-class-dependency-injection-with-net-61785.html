<!DOCTYPE html>
<html lang="en">
<head>
    <title>
It&#x2019;s all in the Host Class &#x2013; Dependency Injection with .NET - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="It&#x2019;s all in the Host Class &#x2013; Dependency Injection with .NET - linksfor.dev(s)"/>
    <meta property="article:author" content="Published by&#xA;&#x9;Christian Nagel"/>
    <meta property="og:description" content="In the first article of this series, dependency injection is introduced, and I&#x2019;m showing how a dependency injection container can be created with the Host class."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://csharp.christiannagel.com/2020/05/15/dependencyinjection-2/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - It&#x2019;s all in the Host Class &#x2013; Dependency Injection with .NET</title>
<div class="readable">
        <h1>It&#x2019;s all in the Host Class &#x2013; Dependency Injection with .NET</h1>
            <div>by Published by&#xA;&#x9;Christian Nagel</div>
            <div>Reading time: 11-14 minutes</div>
        <div>Posted here: 18 May 2020</div>
        <p><a href="https://csharp.christiannagel.com/2020/05/15/dependencyinjection-2/">https://csharp.christiannagel.com/2020/05/15/dependencyinjection-2/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		<p data-adtags-visited="true">I’ve written several articles about <strong>dependency injection</strong> with .NET Core. With changes since .NET Core 3, an update is necessary. This is an article of a services taking advantage of the <code>Host</code> class.</p>
<p data-adtags-visited="true">In the first article of this series, <em>dependency injection</em> is introduced, and I’m showing how a dependency injection container can be created with the <code>Host</code> class.</p>
<p data-adtags-visited="true"><img src="https://csharpdotchristiannageldotcom.files.wordpress.com/2020/05/breakingchains2.jpg?w=672" alt="Breaking Chains"></p>
<h2>Without Dependency Injection</h2>
<p data-adtags-visited="true">Let’s start with a small sample where dependency injection is not used. Here, the <code>GreetingService</code> class offers a simple <code>Greet</code> method to return a string:</p>
<div><div id="highlighter_960019"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>public</code> <code>class</code> <code>GreetingService</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Greet(</code><code>string</code> <code>name) =&gt; $</code><code>"Hello, {name}"</code><code>;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">This <code>GreetingService</code> class is used from the <code>Action</code> method in the <code>HelloController</code>:</p>
<div><div id="highlighter_701933"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>public</code> <code>class</code> <code>HelloController</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Action(</code><code>string</code> <code>name)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>service = </code><code>new</code> <code>GreetingService();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>message = service.Greet(name);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>message.ToUpper();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">Finally, the <code>Main</code> method of the <code>Program</code> class instantiates the <code>HelloController</code> and invokes the <code>Action</code> method.</p>
<div><div id="highlighter_88683"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>class</code> <code>Program</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>static</code> <code>void</code> <code>Main()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>controller = </code><code>new</code> <code>HelloController();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>result = controller.Action(</code><code>"Stephanie"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Console.WriteLine(result);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">The application runs writing a greeting message to the console. What’s the issue with this implementation? The <code>HelloController</code> has a string dependency on the <code>GreetingService</code> class. If the implementation of the GreetingService should be changed, e.g. offering one impementation where a database is accessed, or a REST service invoked, the <code>HelloController</code> needs to be changed as well. Also, creating a unit test for the <code>Action</code>method of the <code>HelloController</code>, the test shouldn’t cover the <code>GreetingService</code>. With a unit test of the <code>Action</code> method we only want to test the implementation of this method, and no other dependencies. Let’s solve this in the next step.</p>
<h2>Inversion of Control – With Dependency Injection</h2>
<p data-adtags-visited="true">Inversion of control is a design principle where – as the name says – the one who has control is inverted. Instead of a method (typically one within a library) that defines the complete functionality on its own, the caller can supply code. This code in turn is invoked by the called method.</p>
<p data-adtags-visited="true">Using .NET, inversion of control can be implemented by using delegates or interfaces. To allow the <code>HelloController</code> not to take a dependency of the <code>GreetingService</code> class, the <code>IGreetingService</code> interface is introduced. This interface defines all the requirements for the <code>HelloController</code>, the <code>Greet</code> method:</p>
<div><div id="highlighter_885166"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>public</code> <code>interface</code> <code>IGreetingService</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>Greet(</code><code>string</code> <code>name);</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">The <code>GreetingService</code> class implements this interface:</p>
<div><div id="highlighter_294933"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>public</code> <code>class</code> <code>GreetingService : IGreetingService</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Greet(</code><code>string</code> <code>name) =&gt; $</code><code>"Hello, {name}"</code><code>;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">Now the <code>HelloController</code> class can be changed to take a dependency only on the interface <code>IGreetingService</code>. This interface is injected in the constructor of the <code>HelloController</code>.</p>
<div><div id="highlighter_890028"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p></td><td><div><p><code>public</code> <code>class</code> <code>HelloController</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>readonly</code> <code>IGreetingService _greetingService;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>HelloController(IGreetingService greetingService)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>=&gt; _greetingService = greetingService;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Action(</code><code>string</code> <code>name)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>message = _greetingService.Greet(name);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>message.ToUpper();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">The class to be used for the interface <code>IGreetingService</code> now needs to be defined outside of the <code>HelloController</code> – passing an object implementing the interface <code>IGreetingService</code> on instantiating of the object <code>HelloController</code>. This is where the term <em>inversion of control</em> is used: The control what type is used is now passed to the outside.</p>
<blockquote><p>
  Inversion of control is also known by the name “Hollywood principle” – don’t call us, we’ll call you.
</p></blockquote>
<p data-adtags-visited="true">The <code>Program</code> class is now changed to pass a instance of the <code>GreetingService</code> to the constructor of the <code>HelloController</code>. Other than that, the implementation does not differ:</p>
<div><div id="highlighter_352002"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>class</code> <code>Program</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>static</code> <code>void</code> <code>Main()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>controller = </code><code>new</code> <code>HelloController(</code><code>new</code> <code>GreetingService());</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>result = controller.Action(</code><code>"Matthias"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Console.WriteLine(result);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<blockquote><p>
  With dependency injection, a dependency such as a type implementing the IGreetingService is injected.
</p></blockquote>
<h2>Using a Container</h2>
<p data-adtags-visited="true">The issue with injecting dependencies, is that it’s usually not that simple. As the application grows, it’s not just one object that needs to be passed to the constructor. And sometimes state need to be kept, and probably the same instance of one service needs to be passed to multiple controllers or services. To reduce the complexity, a <strong>dependency injection container</strong> can be used. With .NET, you can use the NuGet package <strong>Microsoft.Extensions.DependencyInjection</strong>. This DI container is used with ASP.NET Core and EF Core. This container can also be used with UWP, Xamarin, and WPF.</p>
<p data-adtags-visited="true">With the next change, the NuGet package <code>Microsoft.Extensions.DependencyInjection</code> is added. In the <code>GetContainer</code> method, the services that should be injected are added to the service ecollection. The <code>ServiceCollection</code> class keeps a list of the services. On invoking the <code>BuildServiceProvider</code> method, a <code>ServiceProvider</code> object that can be used to access the registered services is returned. The greeting service is registered passing the contract and the implementation types to the generic parameters of the <code>AddTransient</code> method. With the constructor of the <code>HelloController</code> class, the contract type is used for injection. The <code>HelloController</code> class itself doesn’t implement an interface, and this type will be retrieved from the DI container.</p>
<p data-adtags-visited="true">In the <code>Main</code> method, the <code>HelloController</code> is retrieved from the DI container using the <code>GetService</code> method. The constructor of the <code>HelloController</code> requires an object implementing <code>IGreetingService</code>. Because the DI container knows this type, it can create a new instancde of the <code>HelloController</code> and pass an instance of the <code>GreetingService</code>type. In case the DI container does not know the type it needs, it throws an exception of type <code>InvalidOperationException</code> with the information <em>unable to resolve service for type IGreetingService while attempting to activate HelloController</em>. With this message it’s clear that the <code>IGreetingService</code> interface is not registered with the DI container.</p>
<div><div id="highlighter_376820"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p></td><td><div><p><code>class</code> <code>Program</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>static</code> <code>void</code> <code>Main()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>using</code> <code>var</code> <code>container = GetContainer();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>controller = container.GetService&lt;HelloController&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>result = controller.Action(</code><code>"Katharina"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Console.WriteLine(result);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>static</code> <code>ServiceProvider GetContainer()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>services = </code><code>new</code> <code>ServiceCollection();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddTransient&lt;IGreetingService, GreetingService&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddTransient&lt;HelloController&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>services.BuildServiceProvider();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<blockquote><p>
  Several extension methods can be used to register services: <code>AddSingleton</code>, <code>AddTransient</code>, and <code>AddScoped</code>. Registering a service into the DI container with the method <code>AddTransient</code> returns a new object every time the type is injected. With the method <code>AddSingleton</code>, the same object is returned with every injection. The method <code>AddScoped</code> is somewhere in between. In the same scope, the same instance is returned. In a different scope, a new instance is created. What is a scope? With ASP.NET Core applications, a HTTP request creates a new scope. Injecting services based on the HTTP request, with scoped services the same object is returned.
</p></blockquote>
<h2>Using Parameters</h2>
<p data-adtags-visited="true">In case a service needs some parameters, you cannot define a constructor with just the types you need. The DI container doesn’t know how to pass these parameters. However, you can use a type that is known by the DI container to instantiate – e.g. a custom interface that is registered with the DI container. Instead of creating a custom interface, you can make use of the <code>IOptions</code> interface. This is a generic interface that allows passing a type, such as the <code>GreetingServiceOptions</code> class. This class is used to specify the values needed for the new <code>GreetingService</code> class:</p>
<div><div id="highlighter_425977"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>public</code> <code>class</code> <code>GreetingServiceOptions</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>From { </code><code>get</code><code>; </code><code>set</code><code>; } = </code><code>string</code><code>.Empty;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">The <code>GreetingService</code> class now has a constructor that receives <code>IOptions</code>.</p>
<div><div id="highlighter_62349"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>public</code> <code>class</code> <code>GreetingService : IGreetingService</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>readonly</code> <code>string</code> <code>_from;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>GreetingService(IOptions&lt;GreetingServiceOptions&gt; options)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>=&gt; _from = options.Value.From;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Greet(</code><code>string</code> <code>name) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>=&gt; $</code><code>"Hello, {name}, greetings from {_from}"</code><code>;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">To remove the requirement to invoke the <code>AddTransient</code> method and to configure the service calling the <code>Configure</code> method, the extension method <code>AddGreetingService</code> is defined. This method extends the interfacde <code>IServcieCollection</code>, and thus can be used on configuration of the DI container. In the implementation, the <code>Configure</code> method is invoked passing a method that returns the type to specify the configuration for the service: <code>GreetingServiceOptions</code>. After the configuration is done, the service is registered to the DI container with the <code>AddTransient</code> method:</p>
<div><div id="highlighter_78999"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p></td><td><div><p><code>public</code> <code>static</code> <code>class</code> <code>GreetingServiceCollectionExtensions</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>static</code> <code>IServiceCollection AddGreetingServce(</code><code>this</code> <code>IServiceCollection services,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Action&lt;GreetingServiceOptions&gt;? setupAction = </code><code>default</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(setupAction != </code><code>null</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.Configure(setupAction);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>services.AddTransient&lt;IGreetingService, GreetingService&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">The configuration of the DI container can now be adapted to invoke the method <code>AddGreetingsService</code>, and to pass a method returning <code>GreetingServiceOptions</code>.</p>
<div><div id="highlighter_215950"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p></td><td><div><p><code>class</code> <code>Program</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>static</code> <code>void</code> <code>Main(</code><code>string</code><code>[] args)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>using</code> <code>var</code> <code>host = Host.CreateDefaultBuilder()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.ConfigureServices(services =&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddGreetingServce(options =&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>options.From = </code><code>"Christian"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>});</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddTransient&lt;HelloController&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>})</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Build();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>controller = host.Services.GetService&lt;HelloController&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>result = controller.Action(</code><code>"Matthias"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Console.WriteLine(result);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p data-adtags-visited="true">There’s also an extension method <code>AddOptions</code> to register an implementation of the <code>IOptions</code> interface with the DI container, so the container knows how to create instances of types that need this interface with construction. Using the <code>CreateDefaultBuilder</code> of the host factory to create a <code>Host</code> instance, this is not needed, as this method already specifies a few interfaces that are commonly needed with the DI container, e.g. for logging and configuration. You can already run the application and see the results.</p>
<h2>Take away</h2>
<p data-adtags-visited="true">Dependency injection reduces strong dependencies. Instead of having strong references to concrete types, constructor injection can be used to pass the concrete implementations from the outside. A dependency injection container becomes handsome when multiple services probably with different lifetimes need to be configured with the container. The configuration of the <code>Host</code> class already has a DI container built-in, and registers some commonly used services. If you add a breakpoint to the invocation of the <code>ConfigureServices</code> method, you’ll see that already 31 services are registered befor the call to <code>AddGreetingService</code>. Among these are <code>IHostEnvironment</code>, <code>IConfiguration</code>, <code>IApplicationLifetime</code>, <code>ILogger</code>, and others.</p>
<p data-adtags-visited="true">Expect to read more about the <code>Host</code> class in future articles.</p>
<p data-adtags-visited="true">If you’ve read this far, consider buying me a coffee which helps me staying up longer and writing more articles.</p>
<p data-adtags-visited="true"><a href="https://www.buymeacoffee.com/christiannagel" target="_blank"><img src="https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png" alt="Buy Me A Coffee"></a></p>
<p data-adtags-visited="true">You can get the <a href="https://github.com/ProfessionalCSharp/MoreSamples">complete sample code</a>.</p>
<p data-adtags-visited="true">Enjoy learning and programming!</p>
<p data-adtags-visited="true">Christian</p>
<h2>More Information</h2>
<p data-adtags-visited="true"><a href="https://csharp.christiannagel.com/2019/08/06/azurefunctionsdi/">Azure Functions with Dependency Injection</a></p>
<p data-adtags-visited="true"><a href="https://csharp.christiannagel.com/2018/08/29/scopes/">Disposing Injected Services</a></p>
<p data-adtags-visited="true"><a href="https://csharp.christiannagel.com/2018/06/05/httpclient/">HTTP Client Factory with .NET Core</a></p>
<p data-adtags-visited="true">More information on C# and programming .NET Core applications is in my book <a href="https://csharp.christiannagel.com/2018/04/16/professionalcsharp7/">Professional C# 7 and .NET Core 2.0</a>, and in my <a href="https://cninnovation.com/Training/">workshops</a>.</p>
<p data-adtags-visited="true">ID 143279026 © Rodolphe Trider | Dreamstime.com<br>
Breaking Chains <a href="https://www.dreamstime.com/triderrodolphe_info">ID 143279026 © Rodolphe Trider</a> | <a href="https://www.dreamstime.com/">Dreamstime.com</a></p>
			
			
						</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>