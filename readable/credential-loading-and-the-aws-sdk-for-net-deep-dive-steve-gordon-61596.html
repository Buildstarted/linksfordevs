<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Credential Loading and the AWS SDK for .NET (Deep Dive) - Steve Gordon - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Credential Loading and the AWS SDK for .NET (Deep Dive) - Steve Gordon - linksfor.dev(s)"/>
    <meta property="article:author" content="Steve Gordon"/>
    <meta property="og:description" content="In this post, I explore the locations and search order used to load credentials by the AWS SDK for .NET by diving deep into the SDK code."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.stevejgordon.co.uk/credential-loading-and-the-aws-sdk-for-dotnet-deep-dive"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Credential Loading and the AWS SDK for .NET (Deep Dive) - Steve Gordon</title>
<div class="readable">
        <h1>Credential Loading and the AWS SDK for .NET (Deep Dive) - Steve Gordon</h1>
            <div>by Steve Gordon</div>
            <div>Reading time: 28-35 minutes</div>
        <div>Posted here: 12 May 2020</div>
        <p><a href="https://www.stevejgordon.co.uk/credential-loading-and-the-aws-sdk-for-dotnet-deep-dive">https://www.stevejgordon.co.uk/credential-loading-and-the-aws-sdk-for-dotnet-deep-dive</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="pryc-wp-acctp-original-content">
<p>In this post, I want to dive into how the AWS SDK for .NET attempts to load credentials for any service clients which you use in your applications. I’m going to focus specifically on .NET Core applications, where the SDK client(s) are resolved from the dependency injection (DI) container. However, the steps are relatively consistent, even if you are creating the client instances directly (not from the DI container) and even on .NET Framework.</p>
<h2>tl;dr;</h2>
<h3>From where and in what order does the AWS .NET SDK load credentials?</h3>
<ol>
<li>From the <strong>Credentials</strong> property of AWSOptions, if an instance of AWSOptions is provided during registration.</li>
<li><strong>Shared Credentials File (Custom Location)</strong>. When an instance of AWSOptions is provided, and both the profile and profile location are specified.</li>
<li><strong>SDK Store (Windows Only)</strong>. When an instance of AWSOptions is provided and only the profile is set (profile location is null).</li>
<li><strong>Shared Credentials File (Default Location)</strong>. When an instance of AWSOptions is provided and only the profile is set (profile location is null).</li>
<li><strong>AWS Web Identity Federation Credentials</strong>. When an OIDC token file exists and is set in the environment variables.</li>
<li><strong>CredentialsProfileStoreChain</strong>.
<ol>
<li>SDK Store (if on Windows) encrypted using Windows Data Protection API.</li>
<li>Shared Credentials File in the default location.</li>
</ol>
</li>
<li><strong>Environment variables</strong>. When the Access Key ID and Secret Access Key environment variables are set.</li>
<li><strong>ECS Task Credentials or EC2 Instance Credentials</strong>. When using IAM roles with ECS tasks and ECS instances.</li>
</ol>
<p>The above is correct as of version 3.3.101 of the AWS SDK for .NET. Merely knowing this order is usually enough when consuming the library in your applications. If you’re like me though, you may be curious to understand a little more about the credential loading internals.</p>
<h2>How AWS Credentials Are Loaded</h2>
<p>The <a href="https://www.nuget.org/packages/AWSSDK.Extensions.NETCore.Setup/" target="_blank" rel="noopener noreferrer">AWSSDK.Extensions.NETCore.Setup NuGet package</a> supports the integration of the AWS SDK for .NET with the .NET Core configuration and dependency injection frameworks. This package allows us to register the AWS service clients we need to use in our application so that they may be resolved from the dependency injection container. It’s also possible to create an instance of the SDK service clients directly, in which case, many of the same steps for credential loading are also applied.</p>
<p>Internally, the extensions library uses a ClientFactory to create new instances of the service clients when they are required. This type, combined with some core internal mechanisms, will configure the service client instance by following several steps.</p>



<div><figure><img src="https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps.png" alt="" srcset="https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps.png 736w, https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps-300x251.png 300w" sizes="(max-width: 736px) 100vw, 736px"></figure></div>



<h3><span data-preserver-spaces="true">1: AWSOptions.Credentials</span><span data-preserver-spaces="true">&nbsp;</span></h3>
<p><span data-preserver-spaces="true">When registering a service client with the DI container, we call the AddAWSService&lt;T&gt; extension method on the IServiceCollection. This method has a few overloads, one of which accepts an AWSOptions instance used to configure the service client.&nbsp;</span></p>



<div id="gist103005883">
    <div>
      <div>
        <div>
  <div id="file-startup-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-startup-cs-L1" data-line-number="1"></td>
        <td id="file-startup-cs-LC1"><span>services</span>.<span>AddAWSService</span>&lt;<span>IAmazonSQS</span>&gt;(<span>new</span> <span>AWSOptions</span></td>
      </tr>
      <tr>
        <td id="file-startup-cs-L2" data-line-number="2"></td>
        <td id="file-startup-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-startup-cs-L3" data-line-number="3"></td>
        <td id="file-startup-cs-LC3">    <span>Credentials</span> <span>=</span> <span>new</span> <span>BasicAWSCredentials</span>(<span><span>"</span>123<span>"</span></span>, <span><span>"</span>456<span>"</span></span>)</td>
      </tr>
      <tr>
        <td id="file-startup-cs-L4" data-line-number="4"></td>
        <td id="file-startup-cs-LC4">});</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>In the preceding example, we set the Credentials on the AWSOptions using an instance of BasicAWSCredentials. This is really bad idea since we’re directly exposing our credentials in the source code and likely our source control history. Don’t use it in this way for real applications!</p>
<p>AddAWSService adds a ServiceDescriptor to the IServiceCollection as follows:</p>



<div id="gist103005903">
    <div>
      <div>
        <div>
  <div id="file-servicecollectionextensions-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-servicecollectionextensions-cs-L1" data-line-number="1"></td>
        <td id="file-servicecollectionextensions-cs-LC1"><span>public</span> <span>static</span> <span>IServiceCollection</span> <span>AddAWSService</span>&lt;<span>T</span>&gt;(<span>this</span> <span>IServiceCollection</span> <span>collection</span>, <span>AWSOptions</span> <span>options</span>, <span>ServiceLifetime</span> <span>lifetime</span> <span>=</span> <span>ServiceLifetime</span>.<span>Singleton</span>) <span>where</span> <span>T</span> : <span>IAmazonService</span></td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L2" data-line-number="2"></td>
        <td id="file-servicecollectionextensions-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L3" data-line-number="3"></td>
        <td id="file-servicecollectionextensions-cs-LC3">    <span>Func</span>&lt;<span>IServiceProvider</span>, <span>object</span>&gt; <span>factory</span> <span>=</span></td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L4" data-line-number="4"></td>
        <td id="file-servicecollectionextensions-cs-LC4">        <span>new</span> <span>ClientFactory</span>(<span>typeof</span>(<span>T</span>), <span>options</span>).<span>CreateServiceClient</span>;</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L5" data-line-number="5"></td>
        <td id="file-servicecollectionextensions-cs-LC5">
</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L6" data-line-number="6"></td>
        <td id="file-servicecollectionextensions-cs-LC6">    <span>var</span> <span>descriptor</span> <span>=</span> <span>new</span> <span>ServiceDescriptor</span>(<span>typeof</span>(<span>T</span>), <span>factory</span>, <span>lifetime</span>);</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L7" data-line-number="7"></td>
        <td id="file-servicecollectionextensions-cs-LC7">    <span>collection</span>.<span>Add</span>(<span>descriptor</span>);</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L8" data-line-number="8"></td>
        <td id="file-servicecollectionextensions-cs-LC8">    <span>return</span> <span>collection</span>;</td>
      </tr>
      <tr>
        <td id="file-servicecollectionextensions-cs-L9" data-line-number="9"></td>
        <td id="file-servicecollectionextensions-cs-LC9">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<div><p>This method provides a factory registration, Func&lt;IServiceProvider, object&gt;, which gets called anytime a new instance of the service client is required. Note that by default, service clients are registered with the singleton lifetime, so only a single instance is created when it is first needed to fulfil a dependency. The Func registered here, creates a new ClientFactory which accepts an AWSOptions parameter. AWSOptions may be null or may be an instance provided in the registration as I showed above. The service client is then created by calling the CreateServiceClient method. Don’t worry about this detail too much for this post; we’ll focus on what comes next.</p><p>When creating the service client, the first step the ClientFactory completes is to load the AWS credentials, which it will provide to the service client. This takes place inside a CreateCredentials method.</p></div>



<div id="gist103005945">
    <div>
      <div>
        <div>
  <div id="file-clientfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-clientfactory-cs-L1" data-line-number="1"></td>
        <td id="file-clientfactory-cs-LC1"><span>private</span> <span>static</span> <span>AWSCredentials</span> <span>CreateCredentials</span>(<span>ILogger</span> <span>logger</span>, <span>AWSOptions</span> <span>options</span>)</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L2" data-line-number="2"></td>
        <td id="file-clientfactory-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L3" data-line-number="3"></td>
        <td id="file-clientfactory-cs-LC3">    <span>if</span> (<span>options</span> <span>!=</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L4" data-line-number="4"></td>
        <td id="file-clientfactory-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L5" data-line-number="5"></td>
        <td id="file-clientfactory-cs-LC5">        <span>if</span> (<span>options</span>.<span>Credentials</span> <span>!=</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L6" data-line-number="6"></td>
        <td id="file-clientfactory-cs-LC6">        {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L7" data-line-number="7"></td>
        <td id="file-clientfactory-cs-LC7">            <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>"</span>Using AWS credentials specified with the AWSOptions.Credentials property<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L8" data-line-number="8"></td>
        <td id="file-clientfactory-cs-LC8">            <span>return</span> <span>options</span>.<span>Credentials</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L9" data-line-number="9"></td>
        <td id="file-clientfactory-cs-LC9">        }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L10" data-line-number="10"></td>
        <td id="file-clientfactory-cs-LC10">        <span>if</span> (<span>!</span><span>string</span>.<span>IsNullOrEmpty</span>(<span>options</span>.<span>Profile</span>))</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L11" data-line-number="11"></td>
        <td id="file-clientfactory-cs-LC11">        {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L12" data-line-number="12"></td>
        <td id="file-clientfactory-cs-LC12">            <span>var</span> <span>chain</span> <span>=</span> <span>new</span> <span>CredentialProfileStoreChain</span>(<span>options</span>.<span>ProfilesLocation</span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L13" data-line-number="13"></td>
        <td id="file-clientfactory-cs-LC13">            <span>AWSCredentials</span> <span>result</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L14" data-line-number="14"></td>
        <td id="file-clientfactory-cs-LC14">            <span>if</span> (<span>chain</span>.<span>TryGetAWSCredentials</span>(<span>options</span>.<span>Profile</span>, <span>out</span> <span>result</span>))</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L15" data-line-number="15"></td>
        <td id="file-clientfactory-cs-LC15">            {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L16" data-line-number="16"></td>
        <td id="file-clientfactory-cs-LC16">                <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>$"</span>Found AWS credentials for the profile {<span>options</span>.<span>Profile</span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L17" data-line-number="17"></td>
        <td id="file-clientfactory-cs-LC17">                <span>return</span> <span>result</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L18" data-line-number="18"></td>
        <td id="file-clientfactory-cs-LC18">            }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L19" data-line-number="19"></td>
        <td id="file-clientfactory-cs-LC19">            <span>else</span></td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L20" data-line-number="20"></td>
        <td id="file-clientfactory-cs-LC20">            {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L21" data-line-number="21"></td>
        <td id="file-clientfactory-cs-LC21">                <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>$"</span>Failed to find AWS credentials for the profile {<span>options</span>.<span>Profile</span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L22" data-line-number="22"></td>
        <td id="file-clientfactory-cs-LC22">            }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L23" data-line-number="23"></td>
        <td id="file-clientfactory-cs-LC23">        }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L24" data-line-number="24"></td>
        <td id="file-clientfactory-cs-LC24">    }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L25" data-line-number="25"></td>
        <td id="file-clientfactory-cs-LC25">
</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L26" data-line-number="26"></td>
        <td id="file-clientfactory-cs-LC26">    <span>var</span> <span>credentials</span> <span>=</span> <span>FallbackCredentialsFactory</span>.<span>GetCredentials</span>();</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L27" data-line-number="27"></td>
        <td id="file-clientfactory-cs-LC27">    <span>if</span> (<span>credentials</span> <span>==</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L28" data-line-number="28"></td>
        <td id="file-clientfactory-cs-LC28">    {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L29" data-line-number="29"></td>
        <td id="file-clientfactory-cs-LC29">        <span>logger</span><span>?</span>.<span>LogError</span>(<span><span>"</span>Last effort to find AWS Credentials with AWS SDK's default credential search failed<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L30" data-line-number="30"></td>
        <td id="file-clientfactory-cs-LC30">        <span>throw</span> <span>new</span> <span>AmazonClientException</span>(<span><span>"</span>Failed to find AWS Credentials for constructing AWS service client<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L31" data-line-number="31"></td>
        <td id="file-clientfactory-cs-LC31">    }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L32" data-line-number="32"></td>
        <td id="file-clientfactory-cs-LC32">    <span>else</span></td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L33" data-line-number="33"></td>
        <td id="file-clientfactory-cs-LC33">    {</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L34" data-line-number="34"></td>
        <td id="file-clientfactory-cs-LC34">        <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>"</span>Found credentials using the AWS SDK's default credential search<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L35" data-line-number="35"></td>
        <td id="file-clientfactory-cs-LC35">    }</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L36" data-line-number="36"></td>
        <td id="file-clientfactory-cs-LC36">
</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L37" data-line-number="37"></td>
        <td id="file-clientfactory-cs-LC37">    <span>return</span> <span>credentials</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L38" data-line-number="38"></td>
        <td id="file-clientfactory-cs-LC38">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>If an AWSOptions instance were provided when registering the AWS service client, it would be not null at the point that this method is called. The Credentials property on the AWSOptions class may hold a reference to a manually created AWSCredentials instance, which will be used by the service client if it is available. This is, therefore, the first choice for credentials which may be applied to the service client.</p>
<h3>2: Shared Credentials File (Custom profile name and location)</h3>
<p>The next conditional occurs if the Profile property on the AWSOptions has a value. This is expected to be the name of a profile from which to load the credentials. AWS supports declaring multiple named profiles in some of the possible credential files.</p>
<p>We could, for example, register our service with AWSOptions specifying the use of a profile named custom.</p>



<div id="gist103005998">
    <div>
      <div>
        <div>
  <div id="file-startup-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-startup-cs-L1" data-line-number="1"></td>
        <td id="file-startup-cs-LC1"><span>services</span>.<span>AddAWSService</span>&lt;<span>IAmazonSQS</span>&gt;(<span>new</span> <span>AWSOptions</span></td>
      </tr>
      <tr>
        <td id="file-startup-cs-L2" data-line-number="2"></td>
        <td id="file-startup-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-startup-cs-L3" data-line-number="3"></td>
        <td id="file-startup-cs-LC3">    <span>Profile</span> <span>=</span> <span><span>"</span>custom<span>"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-startup-cs-L4" data-line-number="4"></td>
        <td id="file-startup-cs-LC4">    <span>ProfilesLocation</span> <span>=</span> <span><span>@"</span>c:\temp\credentials<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-startup-cs-L5" data-line-number="5"></td>
        <td id="file-startup-cs-LC5">});</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>In this scenario, an instance of the CredentialProfileStoreChain class is created within the CreateCredentials method on the ClientFactory. As a reminder, here’s the relevant code again.</p>



<div id="gist103006018">
    <div>
      <div>
        <div>
  <div id="file-clientfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-clientfactory-cs-L1" data-line-number="1"></td>
        <td id="file-clientfactory-cs-LC1"><span>var</span> <span>chain</span> <span>=</span> <span>new</span> <span>CredentialProfileStoreChain</span>(<span>options</span>.<span>ProfilesLocation</span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L2" data-line-number="2"></td>
        <td id="file-clientfactory-cs-LC2"><span>AWSCredentials</span> <span>result</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L3" data-line-number="3"></td>
        <td id="file-clientfactory-cs-LC3"><span>if</span> (<span>chain</span>.<span>TryGetAWSCredentials</span>(<span>options</span>.<span>Profile</span>, <span>out</span> <span>result</span>))</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L4" data-line-number="4"></td>
        <td id="file-clientfactory-cs-LC4">{</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L5" data-line-number="5"></td>
        <td id="file-clientfactory-cs-LC5">    <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>$"</span>Found AWS credentials for the profile {<span>options</span>.<span>Profile</span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L6" data-line-number="6"></td>
        <td id="file-clientfactory-cs-LC6">    <span>return</span> <span>result</span>;</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L7" data-line-number="7"></td>
        <td id="file-clientfactory-cs-LC7">}</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L8" data-line-number="8"></td>
        <td id="file-clientfactory-cs-LC8"><span>else</span></td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L9" data-line-number="9"></td>
        <td id="file-clientfactory-cs-LC9">{</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L10" data-line-number="10"></td>
        <td id="file-clientfactory-cs-LC10">    <span>logger</span><span>?</span>.<span>LogInformation</span>(<span><span>$"</span>Failed to find AWS credentials for the profile {<span>options</span>.<span>Profile</span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-clientfactory-cs-L11" data-line-number="11"></td>
        <td id="file-clientfactory-cs-LC11">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>The CredentialProfileStoreChain is created passing in the ProfilesLocation (which may be null) from the AWSOptions. The TryGetAWSCredentials method is called passing in the specified profile name. This, in turn, calls down to a method named TryGetProfile.</p>



<div id="gist103006039">
    <div>
      <div>
        <div>
  <div id="file-credentialprofilestorechain-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-credentialprofilestorechain-cs-L1" data-line-number="1"></td>
        <td id="file-credentialprofilestorechain-cs-LC1"><span>public</span> <span>bool</span> <span>TryGetProfile</span>(<span>string</span> <span>profileName</span>, <span>out</span> <span>CredentialProfile</span> <span>profile</span>)</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L2" data-line-number="2"></td>
        <td id="file-credentialprofilestorechain-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L3" data-line-number="3"></td>
        <td id="file-credentialprofilestorechain-cs-LC3">    <span>if</span> (<span>string</span>.<span>IsNullOrEmpty</span>(<span>ProfilesLocation</span>) <span>&amp;&amp;</span> <span>UserCrypto</span>.<span>IsUserCryptAvailable</span>)</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L4" data-line-number="4"></td>
        <td id="file-credentialprofilestorechain-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L5" data-line-number="5"></td>
        <td id="file-credentialprofilestorechain-cs-LC5">        <span>var</span> <span>netCredentialsFile</span> <span>=</span> <span>new</span> <span>NetSDKCredentialsFile</span>();</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L6" data-line-number="6"></td>
        <td id="file-credentialprofilestorechain-cs-LC6">        <span>if</span> (<span>netCredentialsFile</span>.<span>TryGetProfile</span>(<span>profileName</span>, <span>out</span> <span>profile</span>))</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L7" data-line-number="7"></td>
        <td id="file-credentialprofilestorechain-cs-LC7">        {</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L8" data-line-number="8"></td>
        <td id="file-credentialprofilestorechain-cs-LC8">            <span>return</span> <span>true</span>;</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L9" data-line-number="9"></td>
        <td id="file-credentialprofilestorechain-cs-LC9">        }</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L10" data-line-number="10"></td>
        <td id="file-credentialprofilestorechain-cs-LC10">    }</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L11" data-line-number="11"></td>
        <td id="file-credentialprofilestorechain-cs-LC11">
</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L12" data-line-number="12"></td>
        <td id="file-credentialprofilestorechain-cs-LC12">    <span>var</span> <span>sharedCredentialsFile</span> <span>=</span> <span>new</span> <span>SharedCredentialsFile</span>(<span>ProfilesLocation</span>);</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L13" data-line-number="13"></td>
        <td id="file-credentialprofilestorechain-cs-LC13">    <span>if</span> (<span>sharedCredentialsFile</span>.<span>TryGetProfile</span>(<span>profileName</span>, <span>out</span> <span>profile</span>))</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L14" data-line-number="14"></td>
        <td id="file-credentialprofilestorechain-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L15" data-line-number="15"></td>
        <td id="file-credentialprofilestorechain-cs-LC15">        <span>return</span> <span>true</span>;</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L16" data-line-number="16"></td>
        <td id="file-credentialprofilestorechain-cs-LC16">    }</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L17" data-line-number="17"></td>
        <td id="file-credentialprofilestorechain-cs-LC17">
</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L18" data-line-number="18"></td>
        <td id="file-credentialprofilestorechain-cs-LC18">    <span>profile</span> <span>=</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L19" data-line-number="19"></td>
        <td id="file-credentialprofilestorechain-cs-LC19">    <span>return</span> <span>false</span>;</td>
      </tr>
      <tr>
        <td id="file-credentialprofilestorechain-cs-L20" data-line-number="20"></td>
        <td id="file-credentialprofilestorechain-cs-LC20">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>When the ProfilesLocation is not null, then this will used to try to access a shared credentials file at that location. The shared credentials file stores credentials in plain text and can be accessed by various AWS tools such as any of the AWS SDKs, the AWS CLI and AWS Tools for PowerShell. It includes credentials for one or more profiles.</p>



<div id="gist103006051">
    <div>
      <div>
        <div>
  <div id="file-credentials">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-credentials-L1" data-line-number="1"></td>
        <td id="file-credentials-LC1">[default]</td>
      </tr>
      <tr>
        <td id="file-credentials-L2" data-line-number="2"></td>
        <td id="file-credentials-LC2">aws_access_key_id = 1111</td>
      </tr>
      <tr>
        <td id="file-credentials-L3" data-line-number="3"></td>
        <td id="file-credentials-LC3">aws_secret_access_key = 2222</td>
      </tr>
      <tr>
        <td id="file-credentials-L4" data-line-number="4"></td>
        <td id="file-credentials-LC4">
</td>
      </tr>
      <tr>
        <td id="file-credentials-L5" data-line-number="5"></td>
        <td id="file-credentials-LC5">[custom]</td>
      </tr>
      <tr>
        <td id="file-credentials-L6" data-line-number="6"></td>
        <td id="file-credentials-LC6">aws_access_key_id = 1234</td>
      </tr>
      <tr>
        <td id="file-credentials-L7" data-line-number="7"></td>
        <td id="file-credentials-LC7">aws_secret_access_key = 9999</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>The credentials file from the supplied profiles location will be loaded and searched for a profile matching the Profile property from the AWSOptions. It’s possible that a matching section for the profile will not be found in the shared credentials file.</p>
<h3>3: SDK Store (.NET SDK Credentials File) – Windows Only (Custom profile name)</h3>
<p>When the TryGetProfile method (above) is called on a CredentialProfileStoreChain that was created with a null profile location, its preference, when the platform supports it, is to attempt to load credentials from the .NET SDK credentials file (SDK Store). Credentials in the SDK Store are encrypted and reside in the current user’s home directory. This helps to limit the risk of accidental exposure of the credentials. This functionality depends on the Windows Crypt32.dll module being available. Credentials contained within the SDK Store can be used by the AWS SDK for .NET, AWS Tools for Windows PowerShell and the AWS Toolkit for Visual Studio.</p>
<p>If cryptography is available (on Windows), a new instance of NetSDKCredentialsFile is created. This supports loading credentials which have been stored under the current users AppData folder encrypted using Windows Data Protection API. A profile with a matching name (or default) will be located if it exists in the store and be returned. The SDK Store is located in the C:\Users\&lt;username&gt;\AppData\Local\AWSToolkit folder in the RegisteredAccounts.json file.</p>
<h3>4: Shared Credentials File (Custom profile name and default location)</h3>
<p>In cases, where the ProfilesLocation is null, and the platform does not support the SDK Store, then the shared credentials file in the default location will be searched for a matching profile. The default location for the credentials file is within a directory named “.aws” in the home directory of the current user. For example:</p>
<p>C:\Users\stevejgordon\.aws\credentials</p>
<p>When present, the file from this default location will be loaded and parsed to see if it contains a matching profile name. If the profile is located, the SDK attempts to create the credentials instance from the loaded values.</p>
<h2>FallbackCredentialsFactory</h2>
<p>If no profile name was supplied to the CreateCredentials method, then the process continues and uses a class named FallbackCredentialsFactory to attempt to load credentials from several fall back options.</p>
<p>FallbackCredentialsFactory is a static class, which includes a static ctor which calls a static Reset() method.</p>
<p>Here is some of the relevant code inside FallbackCredentialsFactory.cs</p>



<div id="gist103006119">
    <div>
      <div>
        <div>
  <div id="file-fallbackcredentialsfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-fallbackcredentialsfactory-cs-L1" data-line-number="1"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC1"><span>public</span> <span>delegate</span> <span>AWSCredentials</span> <span>CredentialsGenerator</span>();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L2" data-line-number="2"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC2"><span>public</span> <span>static</span> <span>List</span><span>&lt;</span><span>CredentialsGenerator</span><span>&gt;</span> <span>CredentialsGenerators</span> { <span>get</span>; <span>set</span>; }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L3" data-line-number="3"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC3">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L4" data-line-number="4"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC4"><span>public</span> <span>static</span> <span>void</span> <span>Reset</span>()</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L5" data-line-number="5"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC5">{</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L6" data-line-number="6"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC6">    <span>Reset</span>(<span>null</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L7" data-line-number="7"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC7">}</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L8" data-line-number="8"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC8">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L9" data-line-number="9"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC9"><span>public</span> <span>static</span> <span>void</span> <span>Reset</span>(<span>IWebProxy</span> <span>proxy</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L10" data-line-number="10"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC10">{</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L11" data-line-number="11"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC11">    <span>cachedCredentials</span> <span>=</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L12" data-line-number="12"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC12">    <span>CredentialsGenerators</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>CredentialsGenerator</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L13" data-line-number="13"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC13">    {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L14" data-line-number="14"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC14">        () <span>=&gt;</span> <span>AssumeRoleWithWebIdentityCredentials</span>.<span>FromEnvironmentVariables</span>(),</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L15" data-line-number="15"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC15">        <span><span>//</span> Attempt to load the default profile.  It could be Basic, Session, AssumeRole, or SAML.</span></td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L16" data-line-number="16"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC16">        () <span>=&gt;</span> <span>GetAWSCredentials</span>(<span>credentialProfileChain</span>),</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L17" data-line-number="17"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC17">        () <span>=&gt;</span> <span>new</span> <span>EnvironmentVariablesAWSCredentials</span>(), <span><span>//</span> Look for credentials set in environment vars.</span></td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L18" data-line-number="18"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC18">        () <span>=&gt;</span> <span>ECSEC2CredentialsWrapper</span>(<span>proxy</span>),      <span><span>//</span> either get ECS credentials or instance profile credentials</span></td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L19" data-line-number="19"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC19">    };</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L20" data-line-number="20"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC20">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>During reset, any cached credentials are cleared.</p>
<p>FallbackCredentialsFactory includes a delegate member “CredentialsGenerator” which defines a method which accepts no arguments and returns an instance of AWSCredentials. A list of these delegates is populated by the reset method.</p>
<p>In the NetStandard case (which we’ll focus on here) four delegates are added to the list in a specific order (we’ll come to that very shortly). After creating an instance of the FallbackCredentialsFactory, the ClientFactory.CreateCredentials code, calls its GetCredentials method. Its code is as follows.</p>



<div id="gist103006146">
    <div>
      <div>
        <div>
  <div id="file-fallbackcredentialsfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-fallbackcredentialsfactory-cs-L1" data-line-number="1"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC1"><span>public</span> <span>static</span> <span>AWSCredentials</span> <span>GetCredentials</span>(<span>bool</span> <span>fallbackToAnonymous</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L2" data-line-number="2"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L3" data-line-number="3"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC3">    <span>if</span> (<span>cachedCredentials</span> <span>!=</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L4" data-line-number="4"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC4">        <span>return</span> <span>cachedCredentials</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L5" data-line-number="5"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC5">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L6" data-line-number="6"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC6">    <span>List</span>&lt;<span>Exception</span>&gt; <span>errors</span> <span>=</span> <span>new</span> <span>List</span>&lt;<span>Exception</span>&gt;();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L7" data-line-number="7"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC7">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L8" data-line-number="8"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC8">    <span>foreach</span> (<span>CredentialsGenerator</span> <span>generator</span> <span>in</span> <span>CredentialsGenerators</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L9" data-line-number="9"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC9">    {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L10" data-line-number="10"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC10">        <span>try</span></td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L11" data-line-number="11"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC11">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L12" data-line-number="12"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC12">            <span>cachedCredentials</span> <span>=</span> <span>generator</span>();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L13" data-line-number="13"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC13">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L14" data-line-number="14"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC14">        <span>catch</span> (<span>ProcessAWSCredentialException</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L15" data-line-number="15"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC15">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L16" data-line-number="16"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC16">            <span>throw</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L17" data-line-number="17"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC17">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L18" data-line-number="18"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC18">        <span>catch</span> (<span>Exception</span> <span>e</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L19" data-line-number="19"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC19">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L20" data-line-number="20"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC20">            <span>cachedCredentials</span> <span>=</span> <span>null</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L21" data-line-number="21"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC21">            <span>errors</span>.<span>Add</span>(<span>e</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L22" data-line-number="22"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC22">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L23" data-line-number="23"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC23">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L24" data-line-number="24"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC24">        <span>if</span> (<span>cachedCredentials</span> <span>!=</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L25" data-line-number="25"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC25">            <span>break</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L26" data-line-number="26"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC26">    }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L27" data-line-number="27"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC27">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L28" data-line-number="28"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC28">    <span>if</span> (<span>cachedCredentials</span> <span>==</span> <span>null</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L29" data-line-number="29"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC29">    {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L30" data-line-number="30"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC30">        <span>if</span> (<span>fallbackToAnonymous</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L31" data-line-number="31"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC31">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L32" data-line-number="32"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC32">            <span>return</span> <span>new</span> <span>AnonymousAWSCredentials</span>();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L33" data-line-number="33"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC33">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L34" data-line-number="34"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC34">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L35" data-line-number="35"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC35">        <span>using</span> (<span>StringWriter</span> <span>writer</span> <span>=</span> <span>new</span> <span>StringWriter</span>(<span>CultureInfo</span>.<span>InvariantCulture</span>))</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L36" data-line-number="36"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC36">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L37" data-line-number="37"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC37">            <span>writer</span>.<span>WriteLine</span>(<span><span>"</span>Unable to find credentials<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L38" data-line-number="38"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC38">            <span>writer</span>.<span>WriteLine</span>();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L39" data-line-number="39"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC39">            <span>for</span> (<span>int</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>errors</span>.<span>Count</span>; <span>i</span><span>++</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L40" data-line-number="40"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC40">            {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L41" data-line-number="41"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC41">                <span>Exception</span> <span>e</span> <span>=</span> <span>errors</span>[<span>i</span>];</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L42" data-line-number="42"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC42">                <span>writer</span>.<span>WriteLine</span>(<span><span>"</span>Exception {0} of {1}:<span>"</span></span>, <span>i</span> <span>+</span> <span>1</span>, <span>errors</span>.<span>Count</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L43" data-line-number="43"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC43">                <span>writer</span>.<span>WriteLine</span>(<span>e</span>.<span>ToString</span>());</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L44" data-line-number="44"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC44">                <span>writer</span>.<span>WriteLine</span>();</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L45" data-line-number="45"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC45">            }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L46" data-line-number="46"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC46">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L47" data-line-number="47"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC47">            <span>throw</span> <span>new</span> <span>AmazonServiceException</span>(<span>writer</span>.<span>ToString</span>());</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L48" data-line-number="48"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC48">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L49" data-line-number="49"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC49">    }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L50" data-line-number="50"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC50">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L51" data-line-number="51"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC51">    <span>return</span> <span>cachedCredentials</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L52" data-line-number="52"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC52">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>This code loops over each registered CredentialsGenerator delegate and invokes it. The delegates will either return an instance of AWSCredentials or will throw an exception. If and when one of the generators successfully provides the AWSCredentials, the instance is cached (stored in the cachedCredentials field) and the foreach loop breaks, returning the credentials.</p>
<h3>5: AWS Web Identity Federation Credentials</h3>
<p>In AWS, it’s possible to allow login through an OpenID Connect (OIDC)-compatible identity provider. In such cases, you will be issued a token by the OIDC IdP which is expected to be stored in a file.</p>
<p>The first delegate, which is added, calls the AssumeRoleWithWebIdentityCredentials.FromEnvironmentVariables method. This expects to load values from the environment variables which define the user of an OIDC provider for temporary, token-based access by assuming a role.</p>
<p>When any of the required environment variables are missing, an exception will is thrown, most probably an ArgumentNullException because the “AWS_WEB_IDENTITY_TOKEN_FILE” variable will not contain a value. Should all valid values be in place, an instance of AssumeRoleWithWebIdentityCredentials will be properly constructed. This provides refreshing credentials which will be refreshed every 5 minutes.</p>
<h3>6: CredentialProfileStoreChain</h3>
<p>The second delegate in the list will attempt to load a profile using the CredentialProfileStoreChain. The registered delegate calls into the FallbackCredentialsFactory.GetAWSCredentials method, passing in a CredentialProfileStoreChain. A shared, static instance of the CredentialProfileStoreChain is stored in a private field of the FallbackCredentialsFactory. You’ll recall that we saw the CredentialProfileStoreChain used earlier as well. In that case, it was only called if a custom profile name had been provided on the AWSOptions. At this stage, the profile name will either by the value of the “AWS_PROFILE” environment variable, if present, or will be “default”.</p>



<div id="gist103006226">
    <div>
      <div>
        <div>
  <div id="file-fallbackcredentialsfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-fallbackcredentialsfactory-cs-L1" data-line-number="1"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC1"><span>private</span> <span>static</span> <span>AWSCredentials</span> <span>GetAWSCredentials</span>(<span>ICredentialProfileSource</span> <span>source</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L2" data-line-number="2"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L3" data-line-number="3"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC3">    <span>var</span> <span>profileName</span> <span>=</span> <span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>AWS_PROFILE_ENVIRONMENT_VARIABLE</span>) <span>??</span> <span>DefaultProfileName</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L4" data-line-number="4"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC4">
</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L5" data-line-number="5"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC5">    <span>CredentialProfile</span> <span>profile</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L6" data-line-number="6"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC6">    <span>if</span> (<span>source</span>.<span>TryGetProfile</span>(<span>profileName</span>, <span>out</span> <span>profile</span>))</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L7" data-line-number="7"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC7">        <span>return</span> <span>profile</span>.<span>GetAWSCredentials</span>(<span>source</span>, <span>true</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L8" data-line-number="8"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC8">    <span>throw</span> <span>new</span> <span>AmazonClientException</span>(<span><span>"</span>Unable to find the '<span>"</span></span> <span>+</span> <span>profileName</span> <span>+</span> <span><span>"</span>' profile in CredentialProfileStoreChain.<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L9" data-line-number="9"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC9">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>GetAWSCredentials will attempt to load credentials from various sources by providing the profile name. The code will then try to load a profile from the CredentialProfileStoreChain. On Windows, this will first search the SDK Store (as above) and after that, the Shared Credentials File. On Linux, only the Shared Credentials File will be searched. If a profile is found, the code will return the credentials for that profile. If a profile could not be found in the chain, an exception is thrown.</p>
<h3>7: Environment Variables</h3>
<p>The third delegate that is added attempts to create an instance of EnvironmentVariablesAWSCredentials which derives from the AWSCredentials class. The constructor for this type calls a FetchCredentials method which searches for configured environment variables.</p>



<div id="gist103006247">
    <div>
      <div>
        <div>
  <div id="file-environmentvariablesawscredentials-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-environmentvariablesawscredentials-cs-L1" data-line-number="1"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC1"><span>public</span> <span>ImmutableCredentials</span> <span>FetchCredentials</span>()</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L2" data-line-number="2"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L3" data-line-number="3"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC3">    <span>string</span> <span>accessKeyId</span> <span>=</span> <span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>ENVIRONMENT_VARIABLE_ACCESSKEY</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L4" data-line-number="4"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC4">    <span>string</span> <span>secretKey</span> <span>=</span> <span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>ENVIRONMENT_VARIABLE_SECRETKEY</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L5" data-line-number="5"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC5">    <span>if</span> (<span>string</span>.<span>IsNullOrEmpty</span>(<span>secretKey</span>))</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L6" data-line-number="6"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC6">    {</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L7" data-line-number="7"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC7">        <span>secretKey</span> <span>=</span> <span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>LEGACY_ENVIRONMENT_VARIABLE_SECRETKEY</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L8" data-line-number="8"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC8">        <span>if</span> (<span>!</span><span>string</span>.<span>IsNullOrEmpty</span>(<span>secretKey</span>))</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L9" data-line-number="9"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC9">            <span>logger</span>.<span>InfoFormat</span>(<span><span>"</span>AWS secret key found using legacy and non-standard environment variable '{0}', consider updating to the cross-SDK standard variable '{1}'.<span>"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L10" data-line-number="10"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC10">                              <span>LEGACY_ENVIRONMENT_VARIABLE_SECRETKEY</span>, <span>ENVIRONMENT_VARIABLE_SECRETKEY</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L11" data-line-number="11"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC11">    }</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L12" data-line-number="12"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC12">
</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L13" data-line-number="13"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC13">    <span>if</span> (<span>string</span>.<span>IsNullOrEmpty</span>(<span>accessKeyId</span>) <span>||</span> <span>string</span>.<span>IsNullOrEmpty</span>(<span>secretKey</span>))</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L14" data-line-number="14"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L15" data-line-number="15"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC15">        <span>throw</span> <span>new</span> <span>InvalidOperationException</span>(<span>string</span>.<span>Format</span>(<span>CultureInfo</span>.<span>InvariantCulture</span>,</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L16" data-line-number="16"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC16">            <span><span>"</span>The environment variables {0}/{1}/{2} were not set with AWS credentials.<span>"</span></span>,</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L17" data-line-number="17"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC17">            <span>ENVIRONMENT_VARIABLE_ACCESSKEY</span>, <span>ENVIRONMENT_VARIABLE_SECRETKEY</span>, <span>ENVIRONMENT_VARIABLE_SESSION_TOKEN</span>));</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L18" data-line-number="18"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC18">    }</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L19" data-line-number="19"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC19">
</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L20" data-line-number="20"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC20">    <span>string</span> <span>sessionToken</span> <span>=</span> <span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>ENVIRONMENT_VARIABLE_SESSION_TOKEN</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L21" data-line-number="21"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC21">
</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L22" data-line-number="22"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC22">    <span>logger</span>.<span>InfoFormat</span>(<span><span>"</span>Credentials found using environment variables.<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L23" data-line-number="23"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC23">
</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L24" data-line-number="24"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC24">    <span>return</span> <span>new</span> <span>ImmutableCredentials</span>(<span>accessKeyId</span>, <span>secretKey</span>, <span>sessionToken</span>);</td>
      </tr>
      <tr>
        <td id="file-environmentvariablesawscredentials-cs-L25" data-line-number="25"></td>
        <td id="file-environmentvariablesawscredentials-cs-LC25">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>The access key is expected to be stored in an environment variable “AWS_ACCESS_KEY_ID”. The secret access key is expected in the environment variable “AWS_SECRET_ACCESS_KEY” or the legacy “AWS_SECRET_KEY” environment variable. This code also looks for an “AWS_SESSION_TOKEN” environment variable which may be set if you are using temporary credentials. This can be the case if you use the AWS Security Token Service to provide short-lived credentials. AWS uses the session token to validate the temporary security credentials.</p>
<p>At a minimum, the access key ID and the secret key must be located. An instance of ImmutableCredentials is then created and returned.</p>
<h3>8: ECS Task Credentials or EC2 Instance Credentials</h3>
<p>The last generator attempts to load credentials from locations which may be available if you have deployed your service on AWS using either ECS (Elastic Container Service) or an EC2 instance. When running your services in production, a best practice is not to manually provide credentials but to rely on IAM roles which can be assigned to EC2 instances and ECS tasks. This allows AWS to manage the credentials for the instance or task by providing credentials that are granted access permissions from an IAM role. This gets into some deeper security territory about how these features work which I will gloss over here.</p>
<p>The code which loads the ECS/EC2 credentials is as follows:</p>



<div id="gist103006270">
    <div>
      <div>
        <div>
  <div id="file-fallbackcredentialsfactory-cs">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-fallbackcredentialsfactory-cs-L1" data-line-number="1"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC1"><span>private</span> <span>static</span> <span>AWSCredentials</span> <span>ECSEC2CredentialsWrapper</span>(<span>IWebProxy</span> <span>proxy</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L2" data-line-number="2"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L3" data-line-number="3"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC3">    <span>try</span></td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L4" data-line-number="4"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L5" data-line-number="5"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC5">        <span>string</span> <span>uri</span> <span>=</span> <span>System</span>.<span>Environment</span>.<span>GetEnvironmentVariable</span>(<span>ECSTaskCredentials</span>.<span>ContainerCredentialsURIEnvVariable</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L6" data-line-number="6"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC6">        <span>if</span> (<span>!</span><span>string</span>.<span>IsNullOrEmpty</span>(<span>uri</span>))</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L7" data-line-number="7"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC7">        {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L8" data-line-number="8"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC8">            <span>return</span> <span>new</span> <span>ECSTaskCredentials</span>(<span>proxy</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L9" data-line-number="9"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC9">        }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L10" data-line-number="10"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC10">    }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L11" data-line-number="11"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC11">    <span>catch</span> (<span>SecurityException</span> <span>e</span>)</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L12" data-line-number="12"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC12">    {</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L13" data-line-number="13"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC13">        <span>Logger</span>.<span>GetLogger</span>(<span>typeof</span>(<span>ECSTaskCredentials</span>)).<span>Error</span>(<span>e</span>, <span><span>"</span>Failed to access environment variable {0}<span>"</span></span>, <span>ECSTaskCredentials</span>.<span>ContainerCredentialsURIEnvVariable</span>);</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L14" data-line-number="14"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC14">    }</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L15" data-line-number="15"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC15">    <span>return</span> <span>DefaultInstanceProfileAWSCredentials</span>.<span>Instance</span>;</td>
      </tr>
      <tr>
        <td id="file-fallbackcredentialsfactory-cs-L16" data-line-number="16"></td>
        <td id="file-fallbackcredentialsfactory-cs-LC16">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>




<p>In short, when your service is running as a container on ECS, and a task role is applied, the Amazon ECS agent populates an environment variable “AWS_CONTAINER_CREDENTIALS_RELATIVE_URI” for all containers that belong to the task with a relative URI. The code above checks to see if this environment variable is set with a relative URI and if so uses a URIBasedRefreshingCredentialHelper to load the credentials.</p>
<p>When running directly on an EC2 instance, the instance role will be used to fetch credentials from the ECS instance metadata. The DefaultInstanceProfileAWSCredentials is used to access a cached instance of the credentials which refreshes every two minutes based on the EC2 instance metadata.</p>
<p>IAM roles for EC2 instances and ECS tasks are the recommended way to supply credentials. In both of these cases, you should not need to load the credentials manually. Instead, allow the SDK to load them for you. This will occur automatically unless you have provided credentials using any of the methods which are checked first.</p>
<h2>Summary</h2>
<p>That’s way more information than you probably needed. If you’ve reached this far, well done indeed! While the internal implementation for credential loading is not something you need to know to this depth, I find this useful background knowledge to understand the sources which may supply credentials. If your service is failing to load credentials or is using credentials which do not grant the expected access, understanding how these resolve can be useful.</p>
<p>Here are the steps, one more time.</p>



<div><figure><img src="https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps.png" alt="Steps for Credential Loading with the AWS SDK for .NET" srcset="https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps.png 736w, https://www.stevejgordon.co.uk/wp-content/uploads/2020/05/Credential-Loading-and-the-AWS-SDK-for-.NET-Steps-300x251.png 300w" sizes="(max-width: 736px) 100vw, 736px"></figure></div>
<!-- PRyC WP: Add custom content to bottom of post/page: Standard Content START --></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>