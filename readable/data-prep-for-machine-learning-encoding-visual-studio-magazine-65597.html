<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Data Prep for Machine Learning: Encoding -- Visual Studio Magazine - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Data Prep for Machine Learning: Encoding -- Visual Studio Magazine - linksfor.dev(s)"/>
    <meta property="article:author" content="By James McCaffrey08/12/2020"/>
    <meta property="og:description" content="Dr. James McCaffrey of Microsoft Research uses a full code program and screenshots to explain how to programmatically encode categorical data for use with a machine learning prediction model such as a neural network classification or regression system."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://visualstudiomagazine.com/articles/2020/08/12/ml-data-prep-encoding.aspx"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Data Prep for Machine Learning: Encoding -- Visual Studio Magazine</title>
<div class="readable">
        <h1>Data Prep for Machine Learning: Encoding -- Visual Studio Magazine</h1>
            <div>by By James McCaffrey08/12/2020</div>
            <div>Reading time: 14-17 minutes</div>
        <div>Posted here: 13 Aug 2020</div>
        <p><a href="https://visualstudiomagazine.com/articles/2020/08/12/ml-data-prep-encoding.aspx">https://visualstudiomagazine.com/articles/2020/08/12/ml-data-prep-encoding.aspx</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="level0">
    <div id="article"> 
        
        <p id="ph_pcontent2_0_KickerText"><a href="https://visualstudiomagazine.com/Articles/List/Neural-Network-Lab.aspx">The Data Science Lab</a></p>
        
        <h3 id="ph_pcontent2_0_MainHeading">Data Prep for Machine Learning: Encoding</h3>
        <p id="ph_pcontent2_0_Deck">Dr. James McCaffrey of Microsoft Research uses a full code program and screenshots to explain how to programmatically encode categorical data for use with a machine learning prediction model such as a neural network classification or regression system.</p>
        
        <ul>
                    
                <li>
                    <a id="ph_pcontent2_0_ListViewAssociatedFiles_AssociatedURL_0" href="https://visualstudiomagazine.com/~/media/ECG/visualstudiomagazine/Code%20Download/2020/08/data_encode.zip">Get Code Download</a>                               
                    
                </li>
            
                </ul>

        <p><img alt="" src="https://visualstudiomagazine.com/articles/2020/08/12/~/media/ECG/visualstudiomagazine/Images/introimages/BigData.ashx"> </p>





<p>
  This article explains how to programmatically encode categorical data for use with a machine learning (ML) prediction model such as a neural network classification or regression system. Suppose you are trying to predict voting behavior from a file of people data. Your data might include predictor variables like each person's sex (male or female) and region where they live (eastern, western, central), and a dependent variable to predict like political leaning (conservative, moderate, liberal). 

</p>
  


<p>
  Neural networks are essentially complex math functions which work with numeric values. Therefore, categorical predictor variables and categorical dependent variables must be converted to a numeric form. This is called data encoding. There are dozens of types of encoding. The type of encoding to use depends on several factors, including specific ML library being used (such as PyTorch or scikit-learn), and whether a value is a predictor (sometimes called a feature or an independent variable) or a value to predict (sometimes called a class label or a dependent variable).

</p>
  


<p>
  In situations where your source data file is small, about 500 lines or less, you can usually encode your categorical data manually using a text editor or spreadsheet. But in almost all realistic scenarios with large datasets you must encode data programmatically.

</p>
  


<p>
  Preparing data for use in an ML system is time consuming, tedious, and error prone. A reasonable rule of thumb is that data preparation requires at least 80 percent of the total time needed to create an ML system. At the large tech company I work for, I oversee a series of 12-week ML projects. It's not uncommon for project teams to spend 11 of the 12 weeks on data preparation and just one week on all other activities combined. There are three main phases of data preparation: cleaning, normalizing and encoding, and splitting. Each of the three phases has several steps.

</p>
  


<p>
  A good way to understand data encoding and see where this article is headed is to take a look at the screenshot of a demo program in <b>Figure 1</b>. The demo uses a small text file named people_normalized.txt where each line represents one person. There are five columns/fields: sex, age, region, income, and political leaning. The data has been processed by removing missing values, editing bad data, and normalizing the numeric age and income values. The sex, region, and political leaning fields must be encoded.

</p>

    

  


<p>
  The ultimate goal of a hypothetical ML system is to use the demo data to create a neural network that predicts political leaning from sex, age, region, and income. The demo analyzes the sex and region predictor fields, then encodes those fields using a technique called one-hot encoding. The political leaning field is encoded using ordinal encoding.

</p>
  
 


<div><figure> <a href="https://visualstudiomagazine.com/articles/2020/08/12/~/media/ECG/visualstudiomagazine/Images/2020/08/dataprep_encoding1.asxh" target="_blank">
<img alt="Figure 1: Programmatically Encoding Categorical Data" src="https://visualstudiomagazine.com/articles/2020/08/12/~/media/ECG/visualstudiomagazine/Images/2020/08/dataprep_encoding1_s.asxh"> </a>
<figcaption> <b>[Click on image for larger view.]</b> <em>Figure 1:</em> Programmatically Encoding Categorical Data
 </figcaption>
</figure></div>





<p>
  The demo is a Python language program but programmatic data encoding can be implemented using any language. The first five lines of the demo source data are:

</p>
  


<pre>M  0.171429  eastern 0.802905  moderate
F  0.485714  central 0.371369  moderate
M  0.257143  central 0.213693  liberal
M  0.000000  western 0.690871  conservative
M  0.057143  central 1.000000  liberal
. . .</pre>




<p>
  The demo begins by displaying the source data file. Next, the demo scans through the sex, region, and political leaning columns and constructs a Dictionary object for each of those columns. Then the demo uses the Dictionary objects to compute a one-hot encoding for the sex and region columns, and an ordinal encoding for the political leaning column. For example, "M" is encoded as (1, 0), "central" is encoded as (0, 1, 0), and "liberal" is encoded as 2.

</p>
  


<p>
  This article assumes you have intermediate or better skill with a C-family programming language. The demo program is coded using Python but you shouldn't have too much trouble refactoring the demo code to another language if you wish. The complete source code for the demo program is presented in this article. The source code is also available in the accompanying file download.

</p>
  


<p><span><b>The Data Preparation Pipeline</b></span><br>
Although data preparation is different for every problem scenario, in general the data preparation pipeline for most ML systems usually follows something similar to the steps shown in <b>Figure 2</b>.</p>


 


<div><figure> <a href="https://visualstudiomagazine.com/articles/2020/08/12/~/media/ECG/visualstudiomagazine/Images/2020/08/dataprep_encoding2.asxh" target="_blank">
<img alt="Figure 2: Data Preparation Pipeline Typical Tasks" src="https://visualstudiomagazine.com/articles/2020/08/12/~/media/ECG/visualstudiomagazine/Images/2020/08/dataprep_encoding2_s.asxh"> </a>
<figcaption> <b>[Click on image for larger view.]</b> <em>Figure 2:</em> Data Preparation Pipeline Typical Tasks
 </figcaption>
</figure></div>

 



<p>
  Data preparation for ML is deceptive because the process is conceptually easy. However, there are many steps, and each step is much more complicated than you might expect if you're new to ML. This article explains the eighth and ninth steps in <b>Figure 2</b>. Other Data Science Lab articles explain the other seven steps. The data preparation series of articles can be found <a href="https://visualstudiomagazine.com/Articles/List/Neural-Network-Lab.aspx" target="_blank">here</a>.

</p>
  


<p>
  The tasks in <b>Figure 2</b> are usually not followed in a strictly sequential order. You often have to backtrack and jump around to different tasks. But it's a good idea to follow the steps shown in order as much as possible. For example, it's better to normalize data before encoding because encoding generates many additional numeric columns which makes it a bit more complicated to normalize the original numeric data.

</p>
  


<p><span><b>Understanding Encoding Techniques</b></span><br>
A complete explanation of the many different types of data encoding would literally require an entire book on the subject. But there are a few encoding techniques that are used in the majority of ML problem scenarios. Understanding these few key techniques will allow you to understand the less-common techniques if you encounter them.</p>




<p>
  In most situations, predictor variables that have three or more possible values are encoded using one-hot encoding, also called 1-of-N or 1-of-C encoding. Suppose you have a predictor variable color which can be one of three values: red, blue, green. You encode red as (1, 0, 0), blue as (0, 1, 0), and green as (0, 0, 1). The ordering of the encoding is arbitrary.

</p>
  


<p>
  An important alternative encoding technique is called effect coding, also known as 1-of-(N-1) or 1-of-(C-1) encoding. You would encode red as (1, 0), blue as (0, 1), and green as (-1, -1). Another closely related technique is called dummy coding. Dummy coding is often used for classical statistics models but is not used very often for neural-based ML models.

</p>
  


<p>
  Predictor variables that have just two possible values (binary predictors) are commonly encoded in one of three ways. Suppose you have a predictor variable sex which can be male or female. You can use one-hot encoding: male is encoded as (1, 0) and female is encoded as (0, 1). You can use minus-one-plus-one encoding: male is encoded as -1 and female is encoded as +1. You can use zero-one encoding: male is encoded as 0 and female is encoded as 1.

</p>
  


<p>
  A dependent variable that has three or more possible values is usually encoded using one-hot encoding or ordinal encoding. If you are trying to predict color, which can be red, blue or green, ordinal encoding is red = 0, blue = 1, green =2.

</p>
  


<p>
  A dependent variable that has just two possible values is usually encoded using one-hot encoding, or minus-one-plus-one encoding, or zero-one encoding. In many ML scenarios, one specific type of encoding is required. For example, when using the Keras neural network code library, dependent variables with three or more values must be encoded using the one-hot technique. But when using the PyTorch library, dependent variables with three or more values must be encoded using the ordinal encoding technique.

</p>
  


<p>
  In some ML scenarios, you have a choice of which type of encoding to use. For example, when using the Keras library, you can encode a binary dependent variable using zero-one encoding in conjunction with logistic sigmoid activation, or you can use one-hot encoding in conjunction with softmax activation. When using the PyTorch library, you can encode a binary predictor variable using zero-one encoding in conjunction with one input node, or you can use one-hot encoding in conjunction with two input nodes.

</p>
  


<p>
  In short, deciding how to encode categorical data for use in an ML system is not trivial. There are many types of encoding. If you are using a code library, you must read the documentation carefully to determine if a specific type of encoding is required.

</p>
  


<p><span><b>The Demo Program</b></span><br>
The structure of the demo program, with a few minor edits to save space, is shown in <b>Listing 1</b>. I indent my Python programs using two spaces, rather than the more common four spaces or a tab character, as a matter of personal preference. The program has seven worker functions plus a main() function to control program flow. The purpose of worker functions line_count() and show_file() should be clear from their names. Function encode_file() does most of the work. Helper functions make_col_dict(), make_dicts_arr(), one_hot_str(), and ord_str() will be explained when their implementations are presented.</p>





<p><b>Listing 1: Data Encoding Demo Program</b></p>




<pre># data_encode.py
# Python 3.7.6  NumPy 1.18.1

import numpy as np

def show_file(fn, start, end, indices=False,
 strip_nl=False): . . . 

def line_count(fn): . . . 

def make_col_dict(data, col, delim): . . .

def make_dicts_arr(fn, col_types,
  delim): . . . 

def one_hot_str(sv, dict, delim): . . .

def ord_str(sv, dict): . . . 

def encode_file(src, dest, col_types,
  dicts_arr, delim): . . . 

def main():
  print("
Begin data encoding ")

  src = ".\people_normalized.txt"
  dest = ".\people_encoded.txt"

  print("
Source file: ")
  show_file(src, 1, 9999, indices=True,
    strip_nl=True)  

  print("
Column types: ")
  col_types = ["c", "n", "c", "n", "dc"] 
  print(col_types)

  print("
Creating dictionaries for c cols")
  dicts_arr = make_dicts_arr(src,
    col_types, "	")

  print("
Apply one-hot + ordinal encoding")
  encode_file(src, dest, col_types,
    dicts_arr, "	")
  print("Done")

  print("
Result file: ")
  show_file(dest, 1, 9999, indices=True,
    strip_nl=True)

  print("
End 
")

if __name__ == "__main__":
  main()</pre>





<p>
  The execution of the demo program begins with:

</p>
  


<pre>def main():
  print("
Begin data encoding ")
  src = ".\people_normalized.txt"
  dest = ".\people_encoded.txt"
  print("
Source file: ")
  show_file(src, 1, 9999, indices=True,
    strip_nl=True) 
 . . .</pre>




<p>
  The first step when working with any ML data file is to examine the file. The source data is named people_normalized.txt and has only 12 lines to keep the main ideas of data encoding as clear as possible. The number of lines in the file could have been determined by a call to the line_count() function. The entire data file is examined by a call to show_file() with arguments start=1 and end=9999. In most cases with large data files, you'll examine just specified lines of your data file rather than the entire file.

</p>
  


<p>
  The indices=True argument instructs show_file() to display 1-based line numbers. With some data preparation tasks it's more natural to use 1-based indexing, but with other tasks it's more natural to use 0-based indexing. Either approach is OK but you've got to be careful of off-by-one errors. The strip_nl=True argument instructs function show_file() to remove trailing newlines from the data lines before printing them to the console shell so that there aren't blank lines between data lines in the display.

</p>
  


<p>
  The demo continues with:

</p>





<pre>  print("
Column types: ")
  col_types = ["c", "n", "c", "n", "dc"] 
  print(col_types)
  print("
Creating dictionaries for c columns")
  dicts_arr = make_dicts_arr(src, col_types, "	")
. . .</pre>




<p>
  The demo identifies the type of each column because different types of columns must be normalized and encoded in different ways. There is no standard way to identify columns so you can use whatever scheme is suited to your problem scenario. The demo uses "c" for the two categorical predictor data columns sex and region, "n" for the two numeric predictor columns age and income, and "dc" for the categorical dependent variable column political leaning.

</p>
  


<p>
  The demo uses program-defined function make_dicts_arr() to compute a dicts_arr array object. The resulting dicts_arr is a NumPy array of references to Dictionary objects, one Dictionary per data column. If a column is not categorical, the corresponding array cell is set to None (roughly equivalent to null in other languages). The categorical columns have a corresponding cell in dicts_arr that is a reference to a Dictionary where the keys are column values like "eastern", "western", "central" and the Dictionary values are a 0-based indexes like 0, 1, 2. For example, for column [0], dicts_arr[0]["M"] is 0 and dicts_arr[0]["F"] is 1. For column [1], dicts_arr[1] is None because column [1] is the age variable, which is numeric. 

</p>
  


<p>
  The demo program concludes with:

</p>
  


<pre>. . .
  print("
Applying one-hot + ordinal encoding")
  encode_file(src, dest, col_types,
    dicts_arr, "	")
  print("Done")

  print("
Result file: ")
  show_file(dest, 1, 9999, indices=True,
    strip_nl=True)

  print("
End 
")
if __name__ == "__main__":
  main()</pre>




<p>
  The source file is one-hot encoded on the sex and region columns, and ordinal encoded on the dependent political leaning column. The results are saved to a destination file, and then displayed. As you'll see shortly, you can easily modify encode_file() so that it will use other types of encoding such as zero-one encoding or effect coding.

</p>
  


<p><span><b>Examining the Data</b></span><br>
When working with data for an ML system you always need to determine how many lines there are in the data, how many columns/fields there are on each line, and what type of delimiter is used. The demo defines a function line_count() as:</p>
<br>
        
        
        
        
        
        
        
        <!-- pager start -->
        

        <!-- pager end -->
        
        
            
        
                
            

        
    </div>
</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>