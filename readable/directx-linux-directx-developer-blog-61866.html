<!DOCTYPE html>
<html lang="en">
<head>
    <title>
DirectX &#x2764; Linux | DirectX Developer Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="DirectX &#x2764; Linux | DirectX Developer Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Steve PronovostPartner Development LeadFollow"/>
    <meta property="og:description" content="DirectX 12, NVIDIA CUDA, OpenGL and OpenCL acceleration are coming to the Windows Subsystem for Linux."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/directx/directx-heart-linux/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - DirectX &#x2764; Linux | DirectX Developer Blog</title>
<div class="readable">
        <h1>DirectX &#x2764; Linux | DirectX Developer Blog</h1>
            <div>by Steve PronovostPartner Development LeadFollow</div>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 19 May 2020</div>
        <p><a href="https://devblogs.microsoft.com/directx/directx-heart-linux/">https://devblogs.microsoft.com/directx/directx-heart-linux/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/IMG_0586-150x150.jpg" width="58" height="58" alt="Steve Pronovost"></p><p>Steve</p></div></div></div><p>May 19th, 2020</p><p>At <strong>//build</strong> <strong>2020</strong> we announced that GPU hardware acceleration is coming to the Windows Subsystem for Linux 2 (WSL 2).</p><p>What is WSL? <a href="https://aka.ms/wsl" target="_blank">WSL</a> is an environment in which users can run their Linux applications from the comfort of their Windows PC. If you are a developer working on containerized workload that will be deployed in the cloud inside of Linux containers, you can develop and test these workloads locally on your Windows PC using the same native Linux tools you are accustomed to. In response to <a href="https://github.com/microsoft/WSL/issues/829" target="_blank">popular</a> <a href="https://github.com/Microsoft/WSL/issues/3789" target="_blank">demand</a>, these Linux applications and tools can now benefit from GPU acceleration.</p><p>The purpose of this blog is to give you a glimpse of how this support is achieved and how the various pieces fit together.</p><p>Over the last few Windows releases, we have been busy developing client GPU virtualization technology. This technology is integrated into WDDM (Windows Display Driver Model) and all WDDMv2.5 or later drivers have native support for GPU virtualization. This technology is referred to as WDDM GPU Paravirtualization, or GPU-PV for short. GPU-PV is now a foundational part of Windows and is used in scenarios like <a href="https://docs.microsoft.com/en-us/deployedge/microsoft-edge-security-windows-defender-application-guard" target="_blank">Windows Defender Application Guard</a>, the <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-sandbox/windows-sandbox-overview" target="_blank">Windows Sandbox</a> or the <a href="https://docs.microsoft.com/en-us/windows/mixed-reality/install-the-tools" target="_blank">Hololens 2 emulator</a>. Today this technology is limited to Windows guests, i.e. Windows running inside of a VM or container.</p><p>To bring support for GPU acceleration to WSL 2, WDDMv2.9 will expand the reach of GPU-PV to Linux guests. This is achieved through a new Linux kernel driver that leverages the GPU-PV protocol to expose a GPU to user mode Linux. The projected abstraction of the GPU follows closely the WDDM GPU abstraction model, allowing API and drivers built against that abstraction to be easily ported for use in a Linux environment.</p><h2>Introducing dxgkrnl (Linux Edition)</h2><p>Dxgkrnl is a brand-new kernel driver for Linux that exposes the <strong>/dev/dxg</strong> device to user mode Linux. <strong>/dev/dxg</strong> exposes a set of IOCTL that closely mimic the native WDDM D3DKMT kernel service layer on Windows. Dxgkrnl inside of the Linux kernel connects over the VM Bus to its big brother on the Windows host and uses this VM bus connection to communicate with the physical GPU.</p><p><a href="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-7.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-7.png" srcset="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-7.png 800w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-7-300x169.png 300w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-7-768x432.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a></p><p>If the host has multiple GPUs, all GPUs are projected and available to the Linux environment (assuming all of these GPUs are running WDDMv2.9 drivers).</p><p>Applications running inside of the Linux environment have the same access to the GPU as native applications on Windows. There is no partitioning of resources between Linux and Windows or limit imposed on Linux applications. The sharing is completely dynamic based on who needs what. There are basically no differences between two Windows applications sharing a GPU versus a Linux and a Windows application sharing the same GPU. If a Linux application is alone on a GPU, it can consume all its resources!</p><p>Assuming you have the right GPU driver installed on the Windows host, <strong>/dev/dxg</strong> is automatically exposed and available to any WSL distro installed without having to install any additional packages. Note that the distro needs to be running in WSL version 2 mode (<em>wsl â€“set-version &lt;Distro&gt; 2</em>) in order to get access to the GPU.</p><p>Although they share a name, the version of dxgkrnl inside of the Linux kernel is a clean room implementation of a Linux GPU driver based on our GPU-PV protocol and doesnâ€™t share anything else in common with its similarly named Windows counterpart. Dxgkrnl Linux edition is being made open source and shared back with the community. As we work on upstreaming this new driver, source code is available in Microsoftâ€™s official Linux kernel branch for WSL 2.</p><p><a href="https://github.com/microsoft/WSL2-Linux-Kernel/tree/linux-msft-wsl-4.19.y/drivers/gpu/dxgkrnl" target="_blank">https://github.com/microsoft/WSL2-Linux-Kernel/tree/linux-msft-wsl-4.19.y/drivers/gpu/dxgkrnl</a></p><p>Projecting a WDDM compatible abstraction for the GPU inside of Linux allowed us to recompile and bring our premiere graphics API to Linux when running in WSL.</p><p>This is the real and full D3D12 API, no imitations, pretender or reimplementation hereâ€¦ this is the real deal. libd3d12.so is compiled from the same source code as d3d12.dll on Windows but for a Linux target. It offers the same level of functionality and performance (minus virtualization overhead). The only exception is Present(). There is currently no presentation integration with WSL as WSL is a console only experience today. The D3D12 API can be used for offscreen rendering and compute, but there is no swapchain support to copy pixels directly to the screen (yet ðŸ˜Š).</p><p>DxCore (libdxcore.so) is a simplified version of dxgi where legacy aspects of the API have been replaced by modern versions. DxCore is available on both Windows and Linux. DxCore is also used to host a flat version of the D3DKMT API used by a WDDM based driver on Windows to talk with the GPU. This API abstracts the differences in how the various WDDM services make their way to the kernel (service table on Windows versus IOCTL on Linux).</p><p>libd3d12.so and libdxcore.so are closed source, pre-compiled user mode binaries that ship as part of Windows. These binaries are compatible with glibc based distros and are automatically mounted under <em>/usr/lib/wsl/lib</em> and made visible to the loader. In other words, these APIs work right out of the box without the need to install additional packages or tweak the distroâ€™s configuration. Support is currently limited to glibc based distros such as Ubuntu, Debian, Fedora, Centos, SUSE, etcâ€¦</p><p>D3D12 wouldnâ€™t be able to operate without a GPU specific user mode driver (UMD) provided by our GPU manufacturer partners. The UMD is responsible for things like compiling shaders to hardware specific byte code and translating API rendering requests into actual GPU instructions in command buffers to be executed by the GPU. Working closely with our partners, they have recompiled their D3D12 UMD to a Linux target, enabling execution of these drivers in a WSL environment. This support is being integrated in upcoming WDDMv2.9 drivers such that GPU support in WSL is seamless to the end user. WDDMv2.9 drivers will carry a version of the DX12 UMD compiled for Linux. The host driver package is mounted inside of WSL at /usr/lib/wsl/drivers and directly accessible to the d3d12 API. If you have a WDDMv2.9 driverâ€¦ the GPU magically shows up in WSL and becomes fully usable.</p><p><a href="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-8.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-8.png" srcset="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-8.png 800w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-8-300x169.png 300w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-8-768x432.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a></p><p>In addition to D3D12 and DxCore, we ported our machine learning API, DirectML to work on Linux when running in WSL. We brought DirectMLâ€™s performant machine learning inferencing capabilities to Linux and expanded its functionality in support of training workflows too! DirectML sits on top of our D3D12 API and provides a collection of compute operations and optimizations for machine learning workloads.</p><p><a href="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-9.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-9.png" srcset="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-9.png 800w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-9-300x169.png 300w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-9-768x432.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a></p><p>The DirectML team has a goal of integrating these hardware accelerated inferencing and training capabilities with popular ML tools, libraries, and frameworks. In supporting training workflows with DirectML, weâ€™re placing an initial focus on the ML workflows of students and beginners. We want to ensure university students and in-industry engineers can leverage the breadth of Windows hardware to learn and gain new ML skills. Utilizing DirectML provides these students and beginners with a simple path to leverage hardware acceleration in their existing systems, by tapping into their DirectX 12 capable GPU from their Linux-based ML tools running inside WSL 2.</p><p>As weâ€™ve invested in expanding DirectMLâ€™s capabilities, the awesome co-engineering with our silicon partners has been essential for ensuring the breadth of GPUs in the Windows ecosystem benefit from these ML focused investments. This is why we are excited to announce training with DirectML will enter preview starting this summer!</p><p>In order to make it even easier for our customers to get started training with DirectML, we are releasing a preview package of TensorFlow with an integrated DirectML backend. Students and beginners will be able to get started with TensorFlow tutorials and build the foundation for their future. Plus, weâ€™re engaging with TensorFlow community and are going through the <a href="https://github.com/tensorflow/community/pull/243" target="_blank">RFC</a>&nbsp;process! Once the preview is publicly available, we will continue to make investments, adding new functionality to DirectML as well as continue to improve on its end-to-end training capability with TensorFlow, making your training workflows even better.</p><p>If you are interested in a sneak-peak of DirectML hardware acceleration for training in action, check out the <strong>//build</strong> Skilling Session titled <a href="http://aka.ms/M365sk130" target="_blank">Windows AI: hardware-accelerated ML on Windows devices</a>.</p><p>On Linux, users typically use Khronos APIs for graphics.&nbsp; So, what about support for GPU acceleration for OpenGL, OpenCL or Vulkan?</p><p>We have recently <a href="https://devblogs.microsoft.com/directx/in-the-works-opencl-and-opengl-mapping-layers-to-directx/">announced</a> work on mapping layers that will bring hardware acceleration for OpenCL and OpenGL on top of DX12. We will be using these layers to provide hardware accelerated OpenGL and OpenCL to WSL through the Mesa library. After our work is done, WSL distro will need to update Mesa in order to light up this acceleration. For distros picking up this Mesa update, acceleration will automatically be enabled whenever a WDDMv2.9 driver or above is installed on the Windows host.</p><p><a href="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-10.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-10.png" srcset="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-10.png 800w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-10-300x169.png 300w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-10-768x432.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a></p><p>What about Vulkan? We are still exploring how best to support Vulkan in WSL and will share more details in the future. Besides, we canâ€™t reveal all our plans at one time ðŸ˜Š.</p><p>What about the most popular compute API out there today, you ask?</p><p>We are pleased to announce that NVIDIA CUDA acceleration is also coming to WSL! CUDA is a cross-platform API and can communicate with the GPU through either the WDDM GPU abstraction on Windows or the NVIDIA GPU abstraction on Linux.</p><p>We worked with NVIDIA to build a version of CUDA for Linux that directly targets the WDDM abstraction exposed by <strong>/dev/dxg</strong>. This is a fully functional version of libcuda.so which enables acceleration of CUDA-X libraries such as cuDNN, cuBLAS, TensorRT.</p><p>Support for CUDA in WSL will be included with NVIDIAâ€™s WDDMv2.9 driver. Similar to D3D12 support, support for the CUDA API will be automatically installed and available on any glibc-based WSL distro if you have an NVIDIA GPU. The libcuda.so library gets deployed on the host alongside libd3d12.so, mounted and added to the loader search path using the same mechanism described previously.</p><p>In addition to CUDA support, we are also bringing support for NVIDIA-docker tools within WSL. The same containerized GPU workload that executes in the cloud can run as-is inside of WSL. The NVIDIA-docker tools will not be pre-installed, instead remaining a user installable package just like today, but the package will now be compatible and run in WSL with hardware acceleration.</p><p>For more details and the latest on the upcoming NVIDIA CUDA support in WSL, please visit <a href="http://developer.nvidia.com/cuda/wsl" target="_blank">http://developer.nvidia.com/cuda/wsl</a>.</p><p><a href="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-11.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-11.png" srcset="https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-11.png 800w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-11-300x169.png 300w, https://devblogs.microsoft.com/directx/wp-content/uploads/sites/42/2020/05/word-image-11-768x432.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a></p><p>At <strong>//build</strong> we announced that support for Linux GUI applications is coming to WSL. While today WSL is a console only experience, soon youâ€™ll be able to use your favorite Linux IDE or other GUI application alongside your other Windows applications on your Windows desktop.</p><p>How are the pixels going to flow between Linux applications and the Windows desktop hosting them and how are the various window going to be integrated into unified and seamless experience? Thatâ€™s going to be a story for another time ðŸ˜Š.</p><p>If you have read all the way to this point, youâ€™re probably excited about all this stuff and now wondering when youâ€™ll actually be able to start playing with it!</p><p>Support for DxCore, D3D12, DirectML and NVIDIA CUDA is coming to a <a href="https://insider.windows.com/en-us/" target="_blank">Windows Insider</a> Fast build soon. The Fast ring is currently on our Manganese (Mn) OS branch. We expect the Fast ring to switch over to our Iron (Fe) branch toward the later part of June which will expose this new functionality to Insiders. The preview of TensorFlow will become available at about the same time as an installable PyPI package alongside the existing TensorFlow packages in PyPI.org. At that point youâ€™ll be able to replicate all of those cool <strong>//build</strong> demos ðŸ˜Š. For preview availability stay tuned to <a href="http://aka.ms/gpuinwsl" target="_blank">aka.ms/gpuinwsl</a> and if youâ€™re interested in refining our future investments in ML, take a moment and complete <a href="http://aka.ms/gpu4mlsurvey" target="_blank">our survey</a>.</p><p>Support for the OpenGL/OpenCL mapping layer and GUI applications will be coming at a later time through Insider build flighting. As we get closer to having these technologies ready, we will keep you informed through the Windows Insider build release notes and blog updates.</p><p>Hope you found this interesting! Please try this out and share your feedback!</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>