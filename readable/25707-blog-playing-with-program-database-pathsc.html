<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Blog Playing with Program database paths&#x2026; -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Blog Playing with Program database paths&#x2026;</h1>
    <div class="entry"> <p>Many executables include references (typically .pdb file names) to the program database paths used by the software. I actually tried to <a href="http://www.hexacorn.com/blog/2013/05/08/and-the-most-popular-windows-account-for-compiling-malware-is/">cluster these paths</a> in the past to build a list of account names used by malware authors. Of course, today it&#x2019;s much harder &#x2013; many modern malware authors randomize this path so it can evade signatures/yara rules.</p> <p>These paths are used only by programs that actually use them &#x2013; primarily debuggers. It is a limitation, but it crossed my mind that we could still try to modify a PDB path to point it to any file really. </p> <p>After test change and loading the program into Olly debugger I immediately saw that it tries to read the file from various locations. Interestingly, Olly tries to locate the pdb file based on a file name first. It looks for it in a debuggee&#x2019;s current directory, then in &#x2018;.\exe&#x2019; subdirectory, then &#x2018;.\symbols\exe&#x2019;, then comes back to the current directory and checks the same file name, but with a &#x2018;.pdb&#x2019; extension, and finally in the fullpath provided inside the debug section:</p> <figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1.png" alt class="wp-image-6404" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1.png 468w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1-300x86.png 300w" sizes="(max-width: 468px) 100vw, 468px"></figure> <p>This is interesting.</p> <p>My first thought was to try to DoS Olly by making a reference to c:\pagefile.sys. This didn&#x2019;t work, because Olly only reads a chunk at the top of the file, then bails out when the file is not present/proper. Also, it doesn&#x2019;t seem to &#x2018;see&#x2019; files with hidden/system attributes.</p> <p>Another option I looked at was to point it to a file that could be e.g. including EICAR file. Any program reading such file will most likely trigger AV detection &#x2013; as such killing and quarantining the debugger &#x2013; &#x2013; this could act as a truly naive anti-debug technique. Of course, such decoy EICAR file needs to exist first, so program would need to create it after first run. In such case tho, AV would pick the program instead! A perfect catch 22.</p> <p>Then I thought of another option, we could use it as a beacon. This actually seemed to work pretty fine:</p> <figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2.png" alt class="wp-image-6405" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2.png 439w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2-300x69.png 300w" sizes="(max-width: 439px) 100vw, 439px"></figure> <p>&#x2013; I could see the request going out to the specified IP:</p> <figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3.png" alt class="wp-image-6406" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3.png 515w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3-300x28.png 300w" sizes="(max-width: 515px) 100vw, 515px"></figure> <p>This could affect not only debuggers, but also any vendor tools that load files and leverage these debug sections by default (e.g. any sort of more advanced automation). As a result, it could flag attackers that the file is &#x2018;burnt&#x2019;, or the red team&#x2019;s activity got discovered. </p> <p>The chances for it being really practically useful are pretty low, but again, there maybe other ideas on how to leverage it that I have not thought of.</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>