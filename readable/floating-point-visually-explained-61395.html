<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Floating Point Visually Explained - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Floating Point Visually Explained - linksfor.dev(s)"/>
    <meta property="og:description" content="August 29, 2017"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://fabiensanglard.net/floating_point_visually_explained/index.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Floating Point Visually Explained</title>
<div class="readable">
        <h1>Floating Point Visually Explained</h1>
            <div>Reading time: 5-7 minutes</div>
        <div>Posted here: 06 May 2020</div>
        <p><a href="http://fabiensanglard.net/floating_point_visually_explained/index.html">http://fabiensanglard.net/floating_point_visually_explained/index.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><br><center>
    
</center><p>
August 29, 2017</p><p><b>Floating Point Visually Explained</b></p>
 <hr>




 <div>
  <picture>
<source srcset="fp.webp" type="image/webp">
    <img src="http://fabiensanglard.net/floating_point_visually_explained/fp.png" width="40%">
</picture><p> 

  While I was writing a book about Wolfenstein 3D<a name="back_1" href="#footnote_1"><sup>[1]</sup></a>, I wanted to vividly demonstrate how much of a handicap it was to work without floating points. My personal attempts at 
    understanding floating points using canonical<a name="back_2" href="#footnote_2"><sup>[2]</sup></a> articles<a name="back_3" href="#footnote_3"><sup>[3]</sup></a> were met with significant resistance from my brain.
</p><p>
     I tried to find a different way. Something
  far from <span id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>)</mo><mi>S</mi></msup><mo>&amp;#x2217;</mo><mn>1.</mn><mi>M</mi><mo>&amp;#x2217;</mo><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>E</mi><mo>&amp;#x2212;</mo><mn>127</mn><mo stretchy=&quot;false&quot;>)</mo></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>∗</mo><mn>1.</mn><mi>M</mi><mo>∗</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mo>−</mo><mn>127</mn><mo stretchy="false">)</mo></mrow></msup></math></span></span> and </p><!-- (-1)<sup>S</sup> * 1.M * 2<sup>(E-127)</sup> --><p> its mysterious exponent/mantissa. Possibly a drawing since they seem to flow through my brain effortlessly.</p><p> 
 
I ended up with what follows and I decided to include it in the book. I am not claiming this is my invention but I have never seen floating points explained this way so far.
I hope it will helps a few people like me who are a bit allergic to mathematic notations.
  </p></div>




  <p><b>How Floating Point are usually explained</b></p><hr>

<p>
In the C language, floats
are 32-bit container following the IEEE 754 standard. Their purpose is to store and allow
operations on approximation of real numbers. The way I have seen them explained so far is as follow. The 32 bits are divided in three sections:
</p><ul>
  <li>1 bit S for the sign 
  </li><li>8 bits E for the exponent
  </li><li>23 bits for the mantissa
</li></ul>
<div>
<p><img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_layout.svg"><br>
<span><i><small>Floating Point internals.</small></i></span>

<img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_math.svg"><br>
<span><i><small>The three sections of a floating Point number.</small></i></span>

So far, so good. Now, how numbers are interpreted is usually explained with the formula:</p></div>
<span><i><small>How everybody hates floating point to be explained to them.</small></i></span>
<p>
This is usually where I flip the table. Maybe I am allergic to mathematic notation but something just doesn't click in my brain when I read this. It feels like learning
to <a href="http://fabiensanglard.net/floating_point_visually_explained/01.jpg">draw a owl</a>.<br>
</p><blockquote>
    Floating-point arithmetic is considered an esoteric subject by many people.
    <p>- David Goldberg</p>
</blockquote> 




  <p><b>A different way to explain...</b></p><hr>
 <div><p>
Although correct, this way of explaining floating point usually leaves some of us completely
clueless. I blame this dreadful notation for discouraging legions of programmers,
scaring them to the point where they never looked back to understand how floating point
actually works.

</p><p> Fortunately, there is a different way to explain it. Instead of Exponent, think
of a Window between two consecutive power of two integers. Instead of a Mantissa, think
of an Offset within that window.</p><p>

<img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_intuitive.svg"><br>
<span><i><small>The three sections of a floating Point number.</small></i></span>

The window tells within which two consecutive power-of-two the number will be: [0.5,1], [1,2], [2,4], [4,8] and so on (up to [<span id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>127</mn></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow><mn>127</mn></mrow></msup></math></span></span>,<span id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>128</mn></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow><mn>128</mn></mrow></msup></math></span></span>]). The offset divides the window in <span id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>23</mn></mrow></msup><mo>=</mo><mn>8388608</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow><mn>23</mn></mrow></msup><mo>=</mo><mn>8388608</mn></math></span></span>  buckets. With the window and the offset you can approximate a number. The window is an excellent mechanism to protect from overflowing. Once you have reached the maximum in a window (e.g [2,4]), you can "float" it right and represent the number within the next window (e.g [4,8]). It only costs a little bit of precision since the window becomes twice as large.</p><p>

The next figure illustrates how the number 6.1 would be encoded. The window must start at 4 and span to next power of two, 8. The offset is about half way down the window.</p><p>



<img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_window.svg"></p><p>

<span><i><small>Value 6.1 approximated with floating point.</small></i></span></p></div>

<p><b>Precision</b></p><hr>
  <p>
How much precision is lost when the window covers a wider range? Let's take an example with window [1,2] where the 8388608 offsets cover a range of 1 which gives a precision of <span id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mo stretchy=&quot;false&quot;>(</mo><mn>2</mn><mo>&amp;#x2212;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mn>8388608</mn></mfrac><mo>=</mo><mn>0.00000011920929</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mo stretchy="false">(</mo><mn>2</mn><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><mn>8388608</mn></mfrac><mo>=</mo><mn>0.00000011920929</mn></math></span></span>. In the window [2048,4096] the 8388608 offsets cover a range of <span id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>4096</mn><mo>&amp;#x2212;</mo><mn>2048</mn><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mn>2048</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>4096</mn><mo>−</mo><mn>2048</mn><mo stretchy="false">)</mo><mo>=</mo><mn>2048</mn></math></span></span> which gives a 
precision <span id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mo stretchy=&quot;false&quot;>(</mo><mn>4096</mn><mo>&amp;#x2212;</mo><mn>2048</mn><mo stretchy=&quot;false&quot;>)</mo></mrow><mn>8388608</mn></mfrac><mo>=</mo><mn>0.0002</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mo stretchy="false">(</mo><mn>4096</mn><mo>−</mo><mn>2048</mn><mo stretchy="false">)</mo></mrow><mn>8388608</mn></mfrac><mo>=</mo><mn>0.0002</mn></math></span></span>.<br>
</p>




<p><b>An other example</b></p><hr>
  <p>
  
Let's take an other example with the detailed calculations of the floating point representation of a number we all know well: 3.14.<br>
</p><ul>
 <li>The number 3.14 is positive  <span id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo><mi>S</mi><mo>=</mo><mn>0</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo><mi>S</mi><mo>=</mo><mn>0</mn></math></span></span>.
 </li><li>The number 3.14 is between the power of two 2 and 4 so the floating window must start at <span id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mn>1</mn></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mn>1</mn></msup></math></span></span>  <span id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>&amp;#x2192;</mo><mi>E</mi><mo>=</mo><mn>128</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">→</mo><mi>E</mi><mo>=</mo><mn>128</mn></math></span></span> (see formula where window is <span id="MathJax-Element-12-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>(</mo><mi>E</mi><mo>&amp;#x2212;</mo><mn>127</mn><mo stretchy=&quot;false&quot;>)</mo></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mo>−</mo><mn>127</mn><mo stretchy="false">)</mo></mrow></msup></math></span></span>).
 </li><li>Finally there are <span id="MathJax-Element-13-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>23</mn></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow><mn>23</mn></mrow></msup></math></span></span> offsets available to express where 3.14 falls within the interval [2-4]. It is at <span id="MathJax-Element-14-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mrow><mn>3.14</mn><mo>&amp;#x2212;</mo><mn>2</mn></mrow><mrow><mn>4</mn><mo>&amp;#x2212;</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mn>0.57</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mrow><mn>3.14</mn><mo>−</mo><mn>2</mn></mrow><mrow><mn>4</mn><mo>−</mo><mn>2</mn></mrow></mfrac><mo>=</mo><mn>0.57</mn></math></span></span> within the interval which makes the offset <span id="MathJax-Element-15-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>M</mi><mo>=</mo><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>23</mn></mrow></msup><mo>&amp;#x2217;</mo><mn>0.57</mn><mo>=</mo><mn>4781507</mn></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>=</mo><msup><mn>2</mn><mrow><mn>23</mn></mrow></msup><mo>∗</mo><mn>0.57</mn><mo>=</mo><mn>4781507</mn></math></span></span>
</li></ul>
<p>
Which in binary translates to:

</p><ul>
<li> S = 0 = 0b
</li><li> E = 128 = 10000000b
</li><li> M = 4781507 = 10010001111010111000011b
</li></ul>
<p>

<img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_layout_pi.svg"><br>
<span><i><small>3.14 floating point binary representation.</small></i></span>

The value 3.14 is therefore approximated to 3.1400001049041748046875. The corresponding value with the ugly formula:<br>

</p><div>
<p><span id="MathJax-Element-16-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mn>3.14</mn><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>)</mo><mn>0</mn></msup><mo>&amp;#x2217;</mo><mn>1.57</mn><mo>&amp;#x2217;</mo><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>128</mn><mo>&amp;#x2212;</mo><mn>127</mn><mo stretchy=&quot;false&quot;>)</mo></mrow></msup></math>" role="presentation"><span role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mn>3.14</mn><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>0</mn></msup><mo>∗</mo><mn>1.57</mn><mo>∗</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mn>128</mn><mo>−</mo><mn>127</mn><mo stretchy="false">)</mo></mrow></msup></math></span></span></p>
</div>

<br>
<div><p>
And finally the graphic representation with window and offset:</p><p>

<img src="http://fabiensanglard.net/floating_point_visually_explained/floating_point_window_pi.svg"><br>
    <span><i><small>3.14 window and offset.</small></i></span></p></div><p>
<br>
I hope that helped :) ! 


  </p><p><b>Blast from the past</b></p><hr>
  <div>
      <picture>
<source srcset="BOX_IntelBOX387SX20.webp" type="image/webp">
<img src="http://fabiensanglard.net/floating_point_visually_explained/BOX_IntelBOX387SX20.jpg">
</picture><p> 

Since floating point units were so slow, why did the C language end up with </p><tt>float</tt><p> and </p><tt>double</tt><p> types ? After all, the machine used to invent the language (PDP-11) did not have a floating point unit! The manufacturer (DEC) had promised to Dennis Ritchie and Ken Thompson the next model would have one. Being astronomy enthusiasts they decided to add those two types to their language.</p><p>



<b><u>Trivia:</u></b>  People who really wanted a hardware floating point unit in 1991 could buy one. The only people who could possibly want one back then would have been scientists (as per Intel understanding of the market). They were marketed as "Math CoProcessor". Performance were average and price was outrageous (200 USD in 1993 equivalent to 350 USD in 2016.). As a result, sales were mediocre.</p></div>

<p><b>References</b></p><hr><p id="paperbox"><table><tbody><tr><td><a name="footnote_1"></a><a href="#back_1">^</a></td><td> [1]</td><td>Source&nbsp;:</td><td><a href="http://fabiensanglard.net/gebb/index.html">Game Engine Black Book: 
    Wolfenstein 3D</a></td></tr><tr><td><a name="footnote_2"></a><a href="#back_2">^</a></td><td> [2]</td><td>Source&nbsp;:</td><td><a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic">Wikipedia, Floating-point arithmetic</a></td></tr><tr><td><a name="footnote_3"></a><a href="#back_3">^</a></td><td> [3]</td><td>Source&nbsp;:</td><td><a href="http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a></td></tr></tbody></table></p> <hr>
 <center>*</center></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>