<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Layering domains and microservices using API Gateways | Kislay Verma - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Layering domains and microservices using API Gateways | Kislay Verma - linksfor.dev(s)"/>
    <meta property="og:description" content="Microservice hell? Systems thinking and API gateways can help"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://kislayverma.com/software-architecture/layering-domains-and-microservices-using-api-gateways/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Layering domains and microservices using API Gateways | Kislay Verma</title>
<div class="readable">
        <h1>Layering domains and microservices using API Gateways | Kislay Verma</h1>
            <div>Reading time: 13-16 minutes</div>
        <div>Posted here: 05 Aug 2020</div>
        <p><a href="https://kislayverma.com/software-architecture/layering-domains-and-microservices-using-api-gateways/">https://kislayverma.com/software-architecture/layering-domains-and-microservices-using-api-gateways/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><article>

<div>
<p>TL;DR ‚Äì Hierarchically arranged API gateways can be used to build ‚Äúmacro‚Äù bounded contexts. This can make microservices ‚Äúless‚Äùof a problem by reducing them to an implementation detail within that macro context. This results in a simplified architecture composed of stable interactions between hierarchical domain boundaries.</p>
<hr>
<p>Microservice architectures have many advantages as well disadvantages, and the internet is rife with debate about the size of a ‚Äúmicro‚Äù-service. A less talked about problem is the ‚Äúconceptual sprawl‚Äù that individual microservices modelling a rich problem space create. There can be dozens or hundreds of well-defined bounded contexts each represented by a microservice.</p>
<p>However, discovering the right combination of these services to fulfil a new business requirement becomes an increasing challenge. Each individual part (service) may be well designed, but we start losing our way in the exponential number of interactions between them.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1024x842.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1024x842.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1024x842.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-300x247.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-768x631.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1070x880.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services.jpg 1202w" data-sizes="(max-width: 1024px) 100vw, 1024px" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1024x842.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-300x247.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-768x631.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services-1070x880.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/too-many-services.jpg 1202w" data-was-processed="true"></figure>
<h3>Case Study : Backend for Frontend</h3>
<p>A ‚Äúbackend for frontend‚Äù is a service supporting a frontend by combining data from multiple underlying services. This is the node server backing a react app, the controller layer behind thymeleaf/JSP pages and so on.<br>Let‚Äôs walk through how new UIs are often built. The first version almost always directly calls existing APIs across many services (likely because there aren‚Äôt many such calls). As more and more services need to be called and their data merged into each other in more complicated ways, a debate arises as to whether all this should be done in the frontend or the backend and which team should do this.</p>
<p>The typical response these days is to spin off a ‚Äúservice‚Äù which does whatever the frontend team wants it to do.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1024x888.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1024x888.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1024x888.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-300x260.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-768x666.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1070x928.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend.jpg 1330w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1024x888.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-300x260.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-768x666.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend-1070x928.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/custom-backend-for-frontend.jpg 1330w"></figure>
<p>While we can think of this new service as a system that supports a particular UI, what it is actually doing is providing an abstraction that allows the frontend to have only a limited exposure to the full complexity of the backend.</p>
<h3>The Cognitive Overhead Problem</h3>
<p>The problem described above happens because a single frontend team cannot possibly deal with a microservice-based backend fragmented into tiny ‚Äúdomain‚Äù capsules exposed all at once. The cognitive overhead in combining these tiny pieces into larger things is tremendous. One has to understand all of them as they relate to each other and the ways they communicate with each other (e.g. are they eventually consistent with each other? Do they have independent state machines and how do they relate to each other?).</p>
<p>The other problem is that the underlying architecture is constantly shifting, with more microservices coming up, services getting deprecated and changing contracts etc. All this makes our ‚Äúabstraction service‚Äù brittle. The microservice owners have to be on the lookout for all consumers lest they break them with any change. Service users are always tinkering with their service to keep it in line with the underlying services. Migrations become a permanent fixture on the sprint board.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1024x671.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1024x671.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1024x671.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-300x197.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-768x503.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1070x701.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse.jpg 1267w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1024x671.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-300x197.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-768x503.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse-1070x701.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/custom-means-no-reuse.jpg 1267w"></figure>
<p>Given this scenario, a specialized solution in the form of one service for one UI is actually a good solution ‚Äì it is the only way to move forward! Anyone looking to combine information across multiple domains as defined by each microservice has to create a solution of their own because that is all they can do.</p>
<p>But in the larger scheme of things, this is clearly not a good place to be in. How can we reduce this complexity in combining things so that we are better able to leverage the existing systems?</p>
<div>
<div>
<h4>Support this blog on Patreon</h4>

</div>
<div>
<div><figure><a href="https://www.patreon.com/bePatron?u=29760145"><img src="https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1024x1024.png" data-src="https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1024x1024.png" alt="" width="100" height="100" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1024x1024.png 1024w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-300x300.png 300w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-150x150.png 150w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-768x768.png 768w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1070x1070.png 1070w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral.png 1080w" data-sizes="(max-width: 100px) 100vw, 100px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1024x1024.png 1024w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-300x300.png 300w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-150x150.png 150w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-768x768.png 768w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral-1070x1070.png 1070w, https://kislayverma.com/wp-content/uploads/2020/08/Digital-Patreon-Logo_FieryCoral.png 1080w"></a></figure></div>
</div>
</div>

<h3>Organization in Complex Systems</h3>
<p>Here‚Äôs a quick, shallow recap of organization in complex systems.<br>Complex systems are made of hierarchies of independent subsystems. The hierarchical arrangement emerges as an evolutionary response to changing environment and leads to more and more sophisticated features. Each level is a response to needs faced by one or more lower level systems and it abstracts their details while still facilitating their functioning. The overall system is therefore partially resilient to failure of its somewhat independent subsystems. Collectively, this gives to an ever rising dynamic complexity which is highly resilient and adaptive.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1024x878.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1024x878.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1024x878.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-300x257.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-768x658.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1536x1317.jpg 1536w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1070x917.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems.jpg 1697w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1024x878.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-300x257.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-768x658.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1536x1317.jpg 1536w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems-1070x917.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/organization-in-complex-systems.jpg 1697w"></figure>
<p>If this sounds remarkably similar to distributed system design (buzzwords et al) because it is. Large distributed systems are rich complex systems with all constituent parts interacting with each other and triggering concurrent changes in each other. So let‚Äôs try to bring some systems thinking to bear on the problem of custom backends-for-frontends.</p>
<p>The custom backend-for-frontend we just saw is the microservice architecture‚Äôs highly specialized evolutionary response to the pressure of the external world, viz. the functional requirements of the frontend and the limited time in which to meet those requirements. Evolutionary timescales are generally long because the system tries out many combinations before ‚Äúdiscovering‚Äù what works best in the new environment. However, by putting a timeline on ‚Äúsurvival‚Äù we have hamstrung the usual mechanics resulting in a system response much like growing corns to protect against shoes that pinch instead of allowing better shoes to ‚Äúemerge‚Äù.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1024x826.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1024x826.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1024x826.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-300x242.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-768x620.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1070x863.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment.jpg 1490w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1024x826.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-300x242.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-768x620.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment-1070x863.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/coevolving-systems-and-environment.jpg 1490w"></figure>
<p>The evolutionary pressure is also intense because there is no sense of hierarchy in our microservice architecture. The entire complexity of the domain is laid bare all at once to everyone. While upstream-downstream relationships can be inferred between domains looking at data and call flow, there is no concept of hierarchy of ideas that can simplify comprehension for new users.</p>
<p>So while domains are the building blocks of our systems, we have not yet managed to layer these building blocks in layers of increasing complexity in representation and function.</p>
<h3>Domain Modelling is Hierarchical</h3>
<p>Bounded contexts are the philosophical building blocks of microservice architectures. If we want to layer our architecture, we need to layer our concepts. And as you might imagine, this is not difficult at all! We have the entire organization‚Äôs structure to be inspired, and since domain driven systems tie in very closely with how organizations are organized, there is plenty of opportunity to copy-paste.</p>
<p>Our organization‚Äôs structure clearly tells us that a ‚Äúdomain‚Äù can mean very different things at different levels of abstractions. As soon as we say ‚Äúabstraction‚Äù, we know that we are in a hierarchical world.</p>
<p>If you have ever seen a junior developer try to explain a production outage to a senior manager, you know what I am talking about. The minutiae of system implementation don‚Äôt matter to the senior manager because at his level of operation, ‚Äúoutage due to timeout in calling payment authentication service from checkout validator service‚Äù is interpreted as ‚Äúoutage in checkout due to payment system‚Äù. He doesn‚Äôt care about ‚Äútimeout‚Äù, ‚Äúauthentication‚Äù, ‚Äúvalidator‚Äù or ‚Äúservice‚Äù ‚Äì he cares about ‚Äúcheckout‚Äù, ‚Äúoutage‚Äù, and ‚Äúpayment‚Äù. The CEO doesn‚Äôt even care about ‚Äúcheckout‚Äù and ‚Äúpayment‚Äù, he probably just hears ‚Äútech‚Äù and ‚Äúoutage‚Äù.</p>
<p>This gives us a direct line to solving our problem ‚Äì let‚Äôs bundle our bounded contexts in a way that all contexts in one group can be represented by one word. This is the reverse process of how we break down the system into microservices; a microservice-to-monolith migration, if you will.</p>
<h3>Representing domain hierarchies</h3>
<p>So we want to bundle multiple closely allied domains (physically represented by their corresponding microservices) into a single umbrella.and then those umbrellas into a larger umbrella and so on. Note that the bundling process is subjective because people can disagree with what ‚Äúclosely allied‚Äù means. An instinct for naming is a good guide ‚Äì the collective name should not sound dissonant from the individuals.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1024x760.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1024x760.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1024x760.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-300x223.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-768x570.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1070x794.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries.jpg 1417w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1024x760.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-300x223.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-768x570.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries-1070x794.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/domain-boundaries.jpg 1417w"></figure>
<p>In the real world, a higher level domain can be represented by a separate team (Payment Coordination Team) or a separate manager at a certain level (VP, Director, Architect etc). How do we do this in the technical world? If we want to build an interface that can span across multiple internal systems and combine them into a cohesive experience wrt system vocabulary and capabilities, then we need not look farther than an API Gateway.</p>
<h3>API Gateways</h3>
<p>API gateways are used as single points of ingress and egress of data from the system. They are typically the points where administrative functions like authentication, rate limiting etc are applied. Companies often employ ‚Äúpublic‚Äù API gateways to expose a limited subset of their tech stack to external users (external meaning any software not running on the company‚Äôs servers, including mobile apps).</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1024x938.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1024x938.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1024x938.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-300x275.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-768x703.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1070x980.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway.jpg 1462w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1024x938.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-300x275.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-768x703.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway-1070x980.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/api-gateway.jpg 1462w"></figure>
<p>The traditional role of API gateways has been that of gatekeepers of all traffic coming into the company. They are meant to be lightweight with no business logic (though they may contain minimal schema transformations), and they often expose an aggregate of the capabilities of multiple internal components as a single unit. E.g. Signing up for a website via its API gateway might create an account in the ‚ÄúUser Service‚Äù and create a newsletter subscription in the ‚ÄúNewsletter Service‚Äù in one go.</p>
<h3>API Gateway as domain boundaries</h3>
<p>The backend-for-frontend we saw earlier is essentially an API gateway designed from the wrong side, i.e., by consumers of the API rather than publishers of APIs. The consumer is compelled to do so because no standard conceptual hierarchies exist for them to leverage.</p>
<p>We can apply this API gateway‚Äôs aggregation capability in an internal context to develop coarse-grained system boundaries between our microservices to model hierarchical domains. We can hide the microsevices we had previously put under the same umbrella behind an API gateway which now represents the new domain boundary. No one is allowed to call these services directly. Any capabilities that need to be exposed must be exposed via the API gateway.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1024x669.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1024x669.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1024x669.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-300x196.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-768x502.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1070x699.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries.jpg 1474w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1024x669.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-300x196.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-768x502.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries-1070x699.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/use-api-gateway-for-building-domain-boundaries.jpg 1474w"></figure>
<p>Let‚Äôs take the example of an order being created in a typical order management system. An order entity has to be created in ‚ÄúOrder service‚Äù, tracking its fulfilment has to be started in ‚ÄúOrder tracking service‚Äù, an invoice has to be created in ‚ÄúInvoicing Service‚Äù. A request to fulfil this is then sent to ‚ÄúFulfilment Request Service‚Äù which invokes the actual fulfilment mechanism implemented inside ‚ÄúFulfilment Orchestration Service‚Äù. The ‚Äúcheckout‚Äù system creating the order has to understand all of these things to understand how the order should be placed.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1024x600.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1024x600.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1024x600.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-300x176.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-768x450.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1070x627.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains.jpg 1469w" data-sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1024x600.jpg 1024w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-300x176.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-768x450.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains-1070x627.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-without-composite-domains.jpg 1469w"></figure>
<p>Let‚Äôs define two aggregate domains : Order and Warehousing. The order domain abstract the Order Service, order tracking service, and invoicing service. The warehousing domain abstracts the fulfilment request service and fulfillment orchestration service, packing service. It doesn‚Äôt matter exactly what these services do. What matters is that the two API gateways dropped in to represent the domain boundaries abstract the system creating the order (perhaps checkout service) from the multiple operations required to create an order completely. Instead, that system only sees a single createOrder(Order) interface.</p>
<figure><img src="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1020x1024.jpg" data-src="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1020x1024.jpg" alt="" data-srcset="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1020x1024.jpg 1020w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-300x300.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-150x150.jpg 150w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-768x771.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1070x1074.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains.jpg 1159w" data-sizes="(max-width: 1020px) 100vw, 1020px" srcset="https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1020x1024.jpg 1020w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-300x300.jpg 300w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-150x150.jpg 150w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-768x771.jpg 768w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains-1070x1074.jpg 1070w, https://kislayverma.com/wp-content/uploads/2020/08/creating-order-with-composite-domains.jpg 1159w"></figure>
<p>This is a massive reduction in the amount of domain language and complexity that new upstream systems have to deal with. The warehousing domain has, in fact, vanished from the view of the checkout system completely. This is the concept of layered domains at play.</p>
<h3>Architecture informs the Organization</h3>
<p>As you keep applying this principle to build progressively larger domains which contain smaller domains which in turn contain even smaller domains, the picture that emerges is one of how your technology capabilities are organized. This is the true representation of the technology landscape in the real world, and hopefully this is how the technology organization is set up too.</p>
<p>If this is not so, big red flags should be waved immediately because now you are fighting Conway‚Äôs law(‚ÄúAn organization ships its org chart‚Äù). If the org chart and domain models are not aligned, then somewhere, some teams are definitely struggling with massive communication overheads and friction with other teams.</p>
<p>So modelling domains is an exercise in organization management just as much as it is an exercise in technical decoupling.The emergent architecture of our system truly has the power to inform the structure of the organization, just as the organization structure was used to identify domain boundaries in the first place. What a beautiful, co-evolving world üôÇ</p>
<h3>Drawbacks</h3>
<p>The biggest objection I have heard when proposing this approach is that it adds one extra network hop when crossing boundaries. This is a legitimate problem for latency sensitive applications.<br>However, I usually dismiss this problem in favour of the far larger problem of not being able to make sense of a large scale microservice architecture. If you have many well-defined (assumption) microservices then communication across them is anyway inevitable. Paying the one-extra-hop tax is far better than paying the I-don‚Äôt-know-which-service-to-call tax.</p>
<h3>Conclusion</h3>
<p>I hope this article has given you food for thought about how evolutionary and systems thinking can be applied to manage the conceptual sprawl created by microservice architecture. API gateways, or home grown ‚Äúaggregator services‚Äù, or any other approach which can physically represent domain boundaries (crazy idea ‚Äì separate VPNs for each domain!) can be powerful tools in defining the external as well as internal boundaries of our systems.</p>
</div>
</article></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>