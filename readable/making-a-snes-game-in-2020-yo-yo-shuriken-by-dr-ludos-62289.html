<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Making a SNES game in 2020 - Yo-Yo Shuriken by Dr. Ludos - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Making a SNES game in 2020 - Yo-Yo Shuriken by Dr. Ludos - linksfor.dev(s)"/>
    <meta property="og:description" content="Making new games for retro consoles is something that amateur developers can do quite easily thanks to today&#x27;s technology. Last year, I released a new game for my favorite console: the Super Nintendo..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://drludos.itch.io/yo-yo-shuriken/devlog/147478/making-a-snes-game-in-2020"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Making a SNES game in 2020 - Yo-Yo Shuriken by Dr. Ludos</title>
<div class="readable">
        <h1>Making a SNES game in 2020 - Yo-Yo Shuriken by Dr. Ludos</h1>
            <div>Reading time: 36-45 minutes</div>
        <div>Posted here: 31 May 2020</div>
        <p><a href="https://drludos.itch.io/yo-yo-shuriken/devlog/147478/making-a-snes-game-in-2020">https://drludos.itch.io/yo-yo-shuriken/devlog/147478/making-a-snes-game-in-2020</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section><p>Making new games for retro consoles is something that amateur developers can do quite easily thanks to today's technology. Last year, I released a new game for my favorite console: <em>the Super Nintendo (SNES)</em>. The project went as far as an <strong>actual physical release</strong>, with a cartridge and a cardboard box like the 90's. In this article, I'll present you the numerous steps of this incredible journey: <em>designing the game, overcoming SNES-related technical issues while programming it, manufacturing new SNES cartridges, and creating the manual and box</em>.</p>
<h2>The game : Yo-Yo Shuriken</h2>
<p><a href="https://drludos.itch.io/yo-yo-shuriken" target="_blank">Yo-Yo Shuriken</a> is a <strong>fast-paced arcade game for 1 or 2 players</strong> on Super Nintendo (SNES). <br></p>
<p><a href="https://drludos.itch.io/yo-yo-shuriken" target="_blank"><img src="https://img.itch.zone/aW1nLzM0NzUxMTMuanBn/original/iA%2BMG8.jpg"></a>&nbsp;</p>
<p>The core gameplay revolves around <strong>shooting a single shuriken that you can magically recall at any time</strong>, so you can<strong> hit enemies from the front or from behind</strong>! You can even focus energy into the shuriken to deliver a<strong> powerful charged attack</strong> that can cut through several enemies at once.</p>
<p><iframe src="//www.youtube.com/embed/rv4nUlAEt9w" allowfullscreen="" frameborder="0"></iframe></p>
<p>The game is <strong>available on cartridge with a beautiful cardboard box and a manual </strong>from Catskull Games: <br><a href="https://catskullgames.com/yo-yo-shuriken" rel="nofollow noopener">https://catskullgames.com/yo-yo-shuriken</a></p>
<p>And if you prefer to play it on emulators, you can also<strong> get the ROM</strong> of the game here: <br><a href="https://drludos.itch.io/yo-yo-shuriken">https://drludos.itch.io/yo-yo-shuriken</a></p>
<p>Now that you are more familiar with the game itself, let's explore how it was designed.</p>


<p>Making Yo-Yo Shuriken was quite an organic process. I <strong>tested gameplay ideas as I came up with them</strong>, and tried to refine them until I had a "fun" game in hand. Let's start with the initial idea. For a long time, I wanted to make a<strong> shooting game with a single bullet</strong>. So the player must retrieve it each time he shoots. Besides the "one bullet" idea, I also wanted to <strong>make a game that could be enjoyed with a friend</strong>, in co-op. With both ideas in mind, I created the game step-by-step. Each major progress I made was labelled as a new "version" and playtested heavily. If the current version was good, I continued to add new features. Else, I kept working on the current features until the game was fun to play again before adding anything new. <strong>Here is a rundown of the major game prototypes</strong>, with screenshots<strong>. If you want to play the actual ROMs of these prototypes, they are one of the many perks available to <a href="https://www.patreon.com/drludos" target="_blank" rel="nofollow noopener">my Patreon supporters</a>.</strong><br></p>
<h3>1) Cyber Ninja - version 1</h3>
<p>The first thing to do when making a game on a platform you don't know is to <strong>display something onscreen!</strong> So I drew a robotic ninja sprite and tried to have the SNES to display it onscreen. When it worked, I added code to make the sprite moves with the D-Pad. And then&nbsp; I made a walking animation when the sprite moved. These firsts steps may look simple. But remember that it was <strong>my first time making a game for the SNES!</strong> So it actually took quite some time to do, as I was learning how the machine worked while making the game. As the current project only displayed a robotic ninja, I named it <em>"Cyber Ninja."</em></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExODEucG5n/original/MDy6oG.png"><br></p>
<h3>2) Cyber Ninja - version 2</h3>
<p>The actual player sprite, a ninja, appeared in this second version. So the robot sprites naturally became their enemies, as everyone know that ninja and robots hate each other! As a proud ninja, the player can throw a single shuriken. The shuriken can get stuck on the screen border, and the player must pick it up to be able to shoot again. The robot enemies can move aimlessly on screen, but no collision detection is performed yet.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExODIucG5n/original/cZEgQS.png"><br></p>
<h3>3) Yo-Yo Shuriken - version 1</h3>
<p>After several tests, I thought that the <strong>shuriken could come back to the ninja automatically when the player pressed the button a second time</strong>. I had a lot of fun while testing this mechanic, so it became the core of the whole game! I also changed the project title to reflect this evolution:<strong> say goodbye to "Cyber Ninja", and welcome to "Yo-Yo Shuriken"!</strong> Indeed, in the game the shuriken goes back-and-forth, much like a yo-yo.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExODMucG5n/original/0ST9kk.png"><br></p>
<p>I also added collisions detection. Now the robots disappear when the shuriken hits them. But if a robot hits the player, he's the one who disappear. While everything is still in a very basic state, <strong>the core gameplay of the game is almost complete</strong> in this third game prototype. So I decided to "stress test" the engine to see how far I could push it before the game lags. <strong>I managed to have up to 80 enemies</strong> walking and interacting on screen. Remember that a SNES can display a grand total of 128 sprites, so having 80 of them updated 60 times per second with collisions and animations is some kind of achievement.</p>
<h3>4) Yo-Yo Shuriken - version 2</h3>
<p>In this fourth version, the enemies are no longer limited to straight line movements. They can now move in several directions. They also bounce off the screen borders to avoid exiting the game area. The game became more interesting as a result.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExODQucG5n/original/6FWU6z.png"><br></p>
<h3>5) Yo-Yo Shuriken - version 3</h3>
<p>I added a different background color, and a system to spawn enemies endlessly. In the previous version, once the 80 robots were destroyed, the game was empty. <strong>Here an endless army of robots is generated!</strong> The enemies can also follow the player, to force him to keep moving. Indeed, in this fifth version, the game became&nbsp; quickly boring if the player remained static.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExODcucG5n/original/Y4cjmQ.png"><br></p>
<h3>6) Yo-Yo Shuriken - version 4</h3>
<p>In this version, I faced my<strong> first big technical difficulty</strong>: displaying large explosion sprites whenever a robot dies. I chose to have&nbsp;quite small player and enemies sprites : <em>16x16 pixels</em>. That way, I could<strong> display loads of them</strong> on screen while keeping enough empty space for the player to move around and avoid hitting enemies <em>(the SNES screen resolution is 256x224 pixels)</em>. However, I decided to draw my explosions at larger size: <em>32x32 pixels</em>. The Super Nintendo is capable of displaying <strong>two different sprites size</strong> at the same time. The developer can choose a "small" and a "large" sprite size from a short list of sizes <em>(8x8, 16x16, 32x32 and 64x64)</em> and the console will use this information when accessing the video ram to display the sprite data onscreen. This is one of the many graphical features that make game developers' life easier. But as any technical feature, it can become daunting when you don't know how to use it!</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExOTEucG5n/original/hGqNyJ.png"><br></p>
<p>In my case, in this current prototype, I was only able to display a small portion of the explosion sprites, no matter what I did. The issue was actually quite simple:<strong> I wasn't uploading the sprite data where needed in the SNES video memory</strong>. So the machine couldn't read them back. I did find the solution after spending several hours on the <a href="https://problemkaputt.de/fullsnes.htm" target="_blank" rel="nofollow noopener">wonderful</a> <a href="https://wiki.superfamicom.org/" target="_blank" rel="nofollow noopener">documentations</a> made by the homebrew community over the years. <strong>I thank them a lot for their hard work on creating and sharing all this precious knowledge</strong>: without them, amateurs like me wouldn't be able to make SNES games!<br></p>
<h3>7) Yo-Yo Shuriken - version 5</h3>
<p>This prototype marks the addition of another key feature:<strong> the two players co-op mode!</strong></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExOTMucG5n/original/hN4RSg.png"><br></p>
<p><strong>New kinds of enemies</strong> join the fray too: the <strong>orange robots</strong> can take several hits before exploding, and the<strong> blue robots</strong> can chase the player anywhere. I also added <strong>coins that you have to collect</strong> to score points. This mecanic greatly improves the gameplay. Indeed<strong>, the only way to score points is to collect coins</strong>. Killing robots doesn't bring you any "reward" per se, it's just a way to prevent your avatar from dying. The robots drop coins when they die. But the coins disappear after a few seconds. And there are always loads of robots on screen, that will kill you instantly when touched.<strong> To earn points, player must thus take a lot of risks and move among the robots, else he won't be able to make a high score</strong>. But sometimes, it's better to let some coins disappear to avoid losing a life. This is what game designers call a <strong>"risk / reward" choice</strong>, and it's a great way to make a game interesting. Here, this mecanic allows Yo-Yo Shuriken to offer a <strong>smooth difficulty progression </strong>to players. Usually, a rookie player will tend to stay static, and will solely focus on destroying the robots. He won't get points, but he will be able to continue through the game and defeat the final boss. Once a player starts to get more confident, he'll be able to collect coins to make a highscore. And of course, experienced players can try to make a "perfect run" by collecting all the coins, although it means taking an insane amount of risks!<br></p>
<h3>8) Yo-Yo Shuriken - version 6</h3>
<p>As playtesting went on, I realized that the game was becoming quite repetitive. I tested several ideas to solve this issue. The one I found the most interesting was to hold down the shoot button to "charge" your shuriken. When you release the button, it triggers a<strong> "super shot" that can cut through several enemies</strong>. This mecanic brings a bit of strategic thinking to the game. Now, the player can choose to perform several simple shots to kill the enemies one by one. Or he can choose to perform a charged shot to kill several enemies at once. But then he'll be vulnerable while the super shot is charging.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExOTQucG5n/original/wq5QM3.png"><br></p>
<h3>9) Yo-Yo Shuriken - version 7</h3>
<p>Starting with this version, all the game mecanics that defines the core gameplay were in. So the project entered the longest and most tedious phase: <strong>adding content and polishing the game</strong>. First, I added sound effects, that I created with <a href="https://www.bfxr.net/" target="_blank" rel="nofollow noopener">BFXR</a>. I also included the<strong> wonderful music tracks composed by </strong><a href="https://soundcloud.com/xracecar" target="_blank" rel="nofollow noopener"><strong>XRACECAR</strong>.</a> I also modified the game GUI and moved it to the top of the screen.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODExOTYucG5n/original/fHZCM%2F.png"><br></p>
<p>Regarding graphics, I added<strong> a pattern to the game background</strong>. As my artistic skills are limited, I had an hard time drawing a convincing background. I made several attempts, including this one, before settling on a "wood planks floor" to emphasize that the game takes place inside a dojo <em>(see next version)</em>.</p>
<p>Last but not least, I started to<strong> create the various game levels</strong>. Each level is composed by several enemies waves, with increasing strength and numbers. I spent an insane amount of time testing and balancing those enemies waves to make the game entertaining. Each game designer does this his own way. Personally, for an arcade game, I like to <strong>mix intense and challenging moments with easier moments</strong> so the player can catch his breath. For example if the player manage to pass a moment with fast moving robots chasing him while the dojo is already filled with slow moving enemies, I'll reward him with a slower-paced moment. Like 4-5 basic enemies moving very slowly so you can easily kill them and collect their coins.</p>
<p>On a side note, you may notice that the explosions graphics are still <em>particularly hideous</em> at this stage.<br></p>
<h3>10) Yo-Yo Shuriken - version 8</h3>
<p>In this version, a <strong>new type of enemy joined the fray: the "shield" robot</strong>. They can only be hit from behind. The "yo-yo shuriken" mecanic becomes even more meaningful here. Indeed, the best way to kill shield robots is to shoot around them first. Then, you'll have to call the shuriken back and to try to hit them by controlling its return trajectory. I also made new explosions sprites, and the background image is better looking. I even added an <strong>invincibility bonus</strong> pickup<em> (a white ninja head, replaced by a star in the final game)</em>.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODEyMjcucG5n/original/TaFXj3.png"><br></p>
<h3>11) Yo-Yo Shuriken - version 9</h3>
<p>The last major feature arrived in this version:<strong> the game bosses</strong>. I spend a lot time designing and testing numerous bosses. This was <strong>one of the most enjoyable part</strong> of the game development process!</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODEyMzAucG5n/original/qJqCJo.png"><br></p>
<p>In the screenshots, you can see a<strong> prototype of the "snake" boss</strong>, and a boss not present in the final version: <strong>the tank</strong>. The tank boss must be destroyed in several steps. It has several weak points <em>(the orange balls)</em> that have to be hit one after the other. Once a weak point is destroyed, it removes part of the tanks structure, exposing new weak points. This was a challenging boss. For example, one weak point is at the end of a tunnel, so it requires a very precise aiming.</p>
<p>&nbsp;<img src="https://img.itch.zone/aW1nLzM0ODEyMzEucG5n/original/%2BHcI7n.png"></p>
<p>On paper, this boss idea was quite interesting. It took me quite several days to program it. But after many play sessions, I decided to removed it from the game as it was boring. Indeed, it was sometimes quite hard to destroy the boss because of its huge size. Also, if the boss managed to block you into a corner, you were dead as you couldn't hit any of its weak points. In the end, facing this boss was a more frustrating than fun experience. As you can see, even in amateur game projects, <strong>sometimes you have to cut disappointing content despite the time you spent making it!</strong>&nbsp;</p>
<h3>12) Yo-Yo Shuriken - version 10</h3>
<p>The key word of this final version was <strong>"polish."</strong> I added the title screen, the introduction and ending animations, and a screen to explain how the game plays. The final touch was to include a <strong>hidden bonus mode</strong>: the "double ninja" mode, where you can control two ninjas with a single controller. To unlock this mode, you simply need to finish the game once <em>(or use a cheat code!)</em>.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODEyMzIucG5n/original/%2Fewv%2Fk.png"><br></p>
<p>So, after <strong>more that one year of development </strong>and 5491 lines of code,<strong> Yo-Yo Shuriken was finally completed!</strong> The game ROM works perfectly. It was tested on several versions of the original game console<em> (Japanese Super Famicom, US Super NES, PAL Super Nintendo);</em> on modern versions <em>(PAL modded with the 50/60hz kit from FFVIMan, Analogue Super NT); </em>and on many emulators <em>(Higan/BSNES, SNES9X, ZSNES, No$SNS, RetroArch, etc.)</em> for various platforms<em> (PC, smartphone, PSP, Raspberry Pi, etc.).</em></p>
<p>Once the <strong>game software final version was validated</strong><em> (all bugs fixed after an extensive beta testing phase)</em>,<strong> the hardware part of the project could begin</strong>. In other word, we needed to make the game available on actual cartridges with a beautiful cardboard box! But before exploring that part of the process, I'd like to give you<strong> more details on developing this game for a SNES</strong>.<br></p>


<p>Making games on retro platforms comes with<strong> a lot of technical constraints</strong>. Using modern tools does simplify the task compared to what the developers from the 90's faced. But you still have many constraints related to the limited specifications of the hardware. Like all the other homebrew developers, I struggled with these limitations while making Yo-Yo Shuriken. Here are the<strong> tools I used </strong>and the <strong>main issues I faced</strong>. I hope they'll help you figure how the SNES works under the hood.<br></p>
<h3>Tools of the trade</h3>
<p>Back in the 90's, game programmers had to learn and use assembly for each machine they were working on. <strong>The SNES was a difficult machine to work on</strong> because you had to learn not one, but two assembly languages: The 65816 assembly for the CPU, and the SPC700 assembly for the audio chip.</p>
<p>Nowadays, you can still use assembly, and it's actually the only route to get the most power from any retro machine. But you can also make some really cool games with easier to learn languages, like C or Basic.<strong> For the SNES, you have only one C compiler available</strong>: tcc816. It's far from perfect, as you have to use some python script to optimize / fix bugs in the code it outputs, but it works. A talented coder named Alekmaul took this compiler and built a full framework to ease the creation of games: the <a href="https://github.com/alekmaul/pvsneslib" target="_blank" rel="nofollow noopener">PVSNESlib</a>.</p>
<p>I used this library to make Yo-Yo Shuriken, so I could code it in C language. For graphics, I drew BMP images that were converted to the SNES graphics format. For audio the framework accepted wav files for sound effects and .it files <em>(Impulse Tacker format)</em> for music. It was still quite a challenge to make a game running on the SNES, but <strong>PVSNESlib made it a "hard but fun challenge"!</strong><br></p>
<h3>How does a SNES works anyway?</h3>
<p>Compared to other machines like the Mega Drive / Genesis or the PC-Engine / TurboGrafx16, the <strong>SNES is quite a complex machine</strong>, with a lot of different graphics modes. But it's <strong>general workflow is actually quite simple</strong>. Basically, a SNES can display graphics data using two channels: the <em>"background"</em> and the <em>"sprites".</em> The<strong> background is a full screen image made of 8x8 tiles</strong>. The background can have <strong>several layers</strong> <em>(from 1 to 4)</em> that can be scrolled independently. The video RAM is limited, so you usually have to stream graphic data from the cartridge ROM to the video RAM in real time in order to display some endless or large scrolling areas.</p>
<p>For the sprites, the SNES can display different sizes: 8x8, 16x16, 32x32 and 64x64 -<em> only two of such sizes can be on screen at the same time</em>. To animate sprites you have to manually set their position on screen and modify the graphical data that they will display, 60 times per second. To do that, like with the background, you first have to copy the graphical data <em>(i.e. part of your spritesheet)</em> from the cartridge ROM chip to the video RAM of the console.</p>
<p>The SNES can also play audio using a dedicated chip (SPC700). For input, it's quite easy to read what buttons players pressed on the SNES gamepads. (the best gamepad ever designed!)</p>
<p>In the end, even if you use a tool like PVSNESLib, you'll <strong>need to be familiar with how the SNES works</strong> in order to make actual games for it. Hopefully the wonderful homebrew community have consolidated some very extensive documentation. I'll recommend:</p>
<ul><li>The <strong>PVSNESLib wiki</strong>, that will guide you on how to set up the tools and how to make simple SNES programs: <a href="https://github.com/alekmaul/pvsneslib/wiki" rel="nofollow noopener">https://github.com/alekmaul/pvsneslib/wiki</a></li><li>The<strong> NoCash SNES specs</strong> (technical, but thorough) <a href="https://problemkaputt.de/fullsnes.htm" rel="nofollow noopener">https://problemkaputt.de/fullsnes.htm</a></li><li>The <strong>SNESdev section</strong> of the NESdev forum: <a href="https://forums.nesdev.com/viewforum.php?f=12" rel="nofollow noopener">https://forums.nesdev.com/viewforum.php?f=12</a> <br>The community is very helpful and skilled. They saved my life more than once when I was making Yo-Yo Shuriken!</li></ul>
<p>Now that we have covered some basics, let's dig into<strong> some technical issues I faced</strong>. <br></p>
<h3>How many enemies can we display on screen?</h3>
<p>In a game like Yo-Yo Shuriken, the more sprites on screen <em>(enemies, explosions, etc.)</em>, the better the game will be! However, the game cannot afford to lag. So you have to find the <strong>maximum number of enemies that the CPU can handle while keeping a smooth 60 fps display</strong>. The SNES is often touted as "slow" compared to the Genesis / Mega Drive <em>("Blast Processing" anyone?)</em>. And, in a way, this is true. While the SNES can display more colorful images and higher quality sound, the CPU time available is usually lower than the Genesis. In other words, the Genesis could usually moves more sprites on screen that the SNES. The best example of this difference are Contra III (SNES) and IV (Genesis). And more specifically, how each game handle explosions: <br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODEzNjIuanBn/original/N7JJ40.jpg">&nbsp;<img src="https://img.itch.zone/aW1nLzM0ODEzNzguanBn/original/ax2QeB.jpg">&nbsp;&nbsp; <br></p>
<p>Explosion on SNES' Contra III <em>(left)</em> are made with a<strong> few sprites alongside a special graphical effect</strong> <em>(transparency)</em>, while Genesis' Contra IV <em>(right)</em> renders them with an<strong> insane amount of sprites</strong> on screen. When programming each console like they are meant to be, directly in assembler, you can feel this difference in processing power. But when using a C compiler like I did for Yo-Yo Shuriken, the difference becomes even more obvious. So the t<strong>otal number of enemies I could display was limited by the CPU time available</strong>. But the CPU tasks are not limited to sprites management. It must also handle animations, upload graphical data to the video ram, manage collisions, read controller inputs, trigger sounds and music on the audio chip, etc. <strong>Developing Yo-Yo Shuriken was a constant struggle to keep as many enemies as possible onscreen</strong>, while all the other elements were eating the total CPU time available. Hence, I had to decrease the number of enemies several times as I added new features to the game. <br></p>
<p>At first, when there was only standard robots moving in straight line without collision detection, I was able to display <strong>80 enemies</strong> onscreen <em>(plus 1 player and his shuriken)</em>. When I added collisions detection between enemies, player and shuriken, I had to reduce this number to<strong> 40 enemies</strong>. Adding the second player, explosions, sound effects and music also took a big chunk of the CPU time available. In the end, the final game can only display up to <strong>24 enemies</strong> onscreen in order to maintain a smooth 60 fps display rate. While it may sound little on paper, when you'll play the game you'll see that 24 enemies are more than enough to offer a though challenge, especially in the later levels of the game!</p>
<p>Honestly, being able to manage <strong>38 animated sprites on screen</strong> <em>(24 enemies + 2 players + 2 shurikens + 10 explosions)</em> without any slowdown is still an achievement. But there is a trick behind this achievement: <strong>not all the sprites are updated every frame</strong>. Indeed, while the player and shuriken are updated 60 times per second, the <strong>enemies and explosions are updated only every two frames</strong>, and even every fourth frame in some cases. This programming trick was quite common during the 90's. It allows spreading the collision-related computations over several frames in order to display more sprites on screen without slowing down the game frame rate.<br></p>
<h3>LUT makes sprites go round!</h3>
<p>While the standard enemies have simple movement patterns, with straight or diagonal movement, the bosses move in more complex fashion. For example,<strong> many bosses have balls spinning around them</strong>. <br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODEzODgucG5n/original/FV3ZGz.png">&nbsp;</p>
<p>From a mathematical standpoint, you simply need to <strong>compute the sine and cosine of each ball angle to move them in a circular motion</strong>. On a modern platform, such computations are easy and fast to do. But on retro platforms, this is quite a challenge! The <strong>8/16 bits machines CPU don't have inner functions</strong> to compute sine and cosine in hardware. So you have to compute them in software by combining a lot of more complex calculations. This obviously takes a significant amount of time. The <strong>SNES wouldn't be able to compute</strong> the sine and cosine for 24 enemies at a 60 fps rate in addition to everything else. As the balls move slowly, they are actually updated only<strong> once every 4 frames</strong>, bringing the number of calculations from 24 to 6. But in this particular case, this is still too much: <strong>the CPU can't compute 6 sine and 6 cosine every frame</strong> in addition to all the other tasks.</p>
<p>Of course, <strong>there is a trick to solve this particular issue</strong>, one that was also very common in the 90's. To reduce the load on the CPU, you can simply <strong>use a "Look-Up Table"</strong> instead of doing the sine and cosine calculations every frame. Simply put, I<strong> calculated the values of sine and cosine for a large range of angles in advance</strong>, using a spreadsheet program on my modern machine. Then, I<strong> stored all these values in a giant table inside the game ROM</strong>. That way, the CPU can now read the values of sine and cosine it needs to move the balls in the ROM, instead of wasting time to compute them every frame.<strong> This giant table of precomputed data is called a "Look-Up Table"</strong>, or LUT. LUTs were very common in games made before the 32 bits era. And they are not limited to sine and cosine! Anything that is "slow to compute" on a CPU will usually be computed in advance so the results can be stored in a LUT:<em> trigonometry, color effects, random number generation, raster scan effects, etc.</em></p>
<p>When the 32 bits consoles arrived, this issue was solved because their CPU featured hardware function to perform trigonometry calculations in a flash. Indeed, trigonometry is an essential part of any 3D based rendering. So machines like the PlayStation and the Saturn needed to be able to do it quickly and repeatedly every frame. When reading this, you might be wondering: if this is true, h<strong>ow can the SNES render 3D graphics in a game like Starfox?</strong></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE0MDkucG5n/original/nttGWz.png"><br></p>
<p>In this case, a LUT wouldn't be enough: there are too many calculations to do. So the creators of Starfox simply<strong> added a new processor</strong> that can compute trigonometry quickly inside the cartridge: the famous<strong> "Super FX" chip</strong>! The SNES wouldn't be able to compute and display of all these 3D objects without the Super FX. But Starfox isn't the only game to use such a chip.<strong> Super Mario Kart and Pilotwings use another chip</strong> for the same purpose, the "DPS-1". Like the Super FX, it can perform trigonometry calculations faster than the SNES CPU. While the DPS-1 is only used to do calculations, the Super FX is much more powerful and can actually render polygons onto a 2D framebuffer, like the PlayStation and the Saturn do.<br></p>
<h3>Watch out for VBLANK!</h3>
<p>Once the CPU has finished to compute, it must tell the graphic chip to display the result of its computation on screen. This how any console work, whatever its release date. But the ones from the 8/16 bits era have a specific behaviour:<strong> the CPU can only send data to the graphic chip during a specific time period</strong>: the "VBLANK." But <strong>what is the VBLANK?</strong></p>
<p>On a standard CRT television, the <strong>image is drawn though an electron beam that moves from top to bottom and from left to right</strong>. While the electron beam moves behind the screen to draw the image, it paints "pixels" of a specific color by using instructions from the console graphic chip. Without this graphic chip, the electron beam wouldn't know what color to paint, and thus no image would show onscreen. Once the electron beam has finished to paint an image, it reaches the bottom of the screen. It must then go back to the top of the screen to start painting a new image, using the new instructions sent by the graphic chip. The<strong> t</strong><strong>ime period while the electron beam is off so it can moves back to the top of the screen is called the "Vertical Blanking", or VBLANK</strong>.</p>
<p><img src="https://img.itch.zone/aW1nLzM1Mjg4NzQucG5n/original/8WBQ5Z.png"><br></p>
<p>On a SNES, when the graphic chip sends instructions to the electron beam,<strong> it cannot do anything else</strong>. Moreover, you can't even modify the video memory at this time, as it contains the image to display on screen. Indeed, the graphic chip needs it to control the electron beam. If we somehow manage to modify the video memory while the graphic chip is displaying a image on screen, it would display a corrupt image, or worse. So the SNES is designed to prevent this: the <strong>CPU simply cannot access the video memory while the graphic chip is displaying an image</strong>. The CPU needs to wait for the VBLANK period to be able to send the graphical data of the new image to display onscreen in the video memory. And <strong>this period of time is quite short</strong>.</p>
<p>So, what are the <strong>actual consequences of all these VBLANK related limitations?</strong> Simply put, it's another <strong>harsh limitation on the total time available </strong>for game developer to display their game onscreen. First of all, to prevent the game from lagging, you need to<strong> perform all the gameplay calculations</strong><em> (collisions, movement, animations, etc.)</em> <strong>between two VBLANK periods</strong>. If the game code takes more time to compute, you won't be able to display the resulting frame on time, and thus the game will visibly be lagging onscreen.</p>
<p>But an even harder limitation is that <strong>you can only send very few graphical data to the video memory during every VBLANK</strong>. Indeed, the graphical data transfer speed is limited by what is called a "bus". The "bus" is the actual electronic line connecting all the chips together. If you try to send more data than what is possible to transfer during the VBLANK period, the additional data will simply be cut off and not displayed.</p>

<h3>A vicious bug: the 50hz/60hz trap!</h3>
<p>I experienced the VBLANK limitations first-hand while making Yo-Yo Shuriken. It was the cause of the one the <strong>most vicious bug I encountered during the whole project</strong>. During beta tests, using the ZSNES emulator and <strong>my own console, everything was displaying fine</strong>. But, when I tested the game on other emulators that are known to be more accurate than ZSNES, namely SNES9X and <strong>Higan/BSNES, some sprites weren't displayed</strong>. More specifically, the explosions were "cut" as you can see in the images below:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE0MzQucG5n/original/pMawfZ.png"> &nbsp;<img src="https://img.itch.zone/aW1nLzM0ODE0MzUucG5n/original/oiSrMQ.png"> &nbsp;&nbsp;&nbsp; <br>ZSNES and my console<em> (left)</em> / BSNES-Higan <em>(right)</em></p>
<p>For weeks, I tried to solve this issue, without success. I was finally able to fix it thanks to the <a href="https://forums.nesdev.com/viewforum.php?f=12" target="_blank" rel="nofollow noopener">help of wizards from the SNESDev forum</a>. the SNESDev community helped me more than once during this project, and I couldn't be more grateful for all the help they provided! They found that the cause of this issue was simply that<strong> I was sending too much data to the graphic chip every frame</strong>. The time needed to transfer all the data was exceeding the VBLANK period. So the explosions animation didn't have the time to reach the graphic chip before the end of VBLANK, and was simply cut off. But you may wonder: <strong>why was this bug only happening on some accurate emulator, and not on the real console?</strong></p>
<p>This is where the bug becomes vicious. As all SNES lovers living in Europe, my childhood console works in <strong>"PAL" TV format</strong>, running in 50hz. In other words, the graphic chip of the console displays a <strong>new image onscreen 50 times per second</strong>. In the US and in Japan, the TV format is different: it's "NTSC", running in 60hz. Thus the <strong>NTSC consoles display a new image on screen 60 times per second</strong>. Does it means that <strong>American and Japanese games run faster than European ones?</strong> Sadly, yes! <em>(but we didn't knew it during the 90's...).</em> Ask any fighting game fan, and they'll explain you why the NTSC versions are better to play: <em>faster, smoother, no black border, etc.</em></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE0NjgucG5n/original/phkqPJ.png"><br></p>
<p>Nevertheless, the<strong> PAL format does have one advantage over the NTSC</strong> one. As PAL TVs displays 50 images per second instead of 60, the electron beam moves slower. Therefore, the <strong>VBLANK period is longer on PAL consoles</strong> than on NTSC ones. So you can transfer more graphical data every frame on a PAL console compared to a NTSC model. And this was the <strong>root cause of my bug</strong>. When I tested the game on my childhood console, running in 50hz, the explosions sprites were perfectly displayed because the VBLANK period was long enough for all the data to transfer correctly. But on BSNES/Higan, an extremely accurate emulator running in 60hz, the sprites were cut off as the VBLANK is shorter, and all the data couldn't transfer in time. But <strong>why does ZSNES, also running in 60hz, did display the sprites without issue? </strong><br></p>
<p>Well, simply because <strong>ZSNES is an older emulator, with less accuracy</strong> when it comes to reproducing all the technical limitations of the SNES. For instance, ZSNES doesn't prevent you to modify the content of the video memory outside of VBLANK - a major technical difference compared to the real console! In the end, this issue proved me how important it was to<strong> use accurate emulators when developing homebrews</strong>, and that <strong>nothing can replace testing on actual hardware</strong>, and on all the hardware versions. So I did have to buy an extra SNES running in "60hz" to be able to test the game more thoroughly!</p>


<p>To me, an homebrew project isn't completed until <strong>players are able to put an actual cartridge of the game in their own childhood console</strong>. But how can we create a physical release for a console that the sole cartridge manufacturer, Nintendo, have ceased production about 20 years ago?</p>
<p>The answer is simple: <strong>you have to manufacture them yourself!</strong> For this part, I partnered with an electronics wizard named <a href="https://catskullgames.com/" target="_blank" rel="nofollow noopener">Catskul</a>l, who already designed cartridges for my Game Boy games. For this project,<strong> Catskull designed a new SNES PCB from scratch</strong>. He used new components only, namely Flash ROM.<strong> All the cartridges are built by hand</strong>. Here is a <strong>detail of the full assembly process</strong> with pictures:<br></p>
<h3>1) Bare PCB</h3>
<p>Let's start with the beginning: the bare PCB. Catskull have the PCBs professionally manufactured. He receives them "naked", as shown in the picture below:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MDEuanBn/original/HM5IEy.jpg"><br></p>
<h3>2) Applying solder paste</h3>
<p>To add components <em>(i.e. electronic chips)</em> to the PCB, you first need to apply the solder paste. It's a<strong> "glue" that will tie the chips onto the PCB</strong>. This is a meticulous task. Catskull uses a mask to apply the paste to the required areas only:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MDkuanBn/original/1ayvaZ.jpg"><br></p>
<p>As a result, the PCB now have paste on all the part that will host components:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MTAuanBn/original/CrFnNG.jpg"><br></p>
<h3>3) Laying down components</h3>
<p>This is another meticulous task. All the components (chips) must be placed on the PCB. <strong>Catskull builds 5 PCBs at a time</strong> <em>(you'll see why in the next step)</em>. Here are the PCBs without components:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MTEuanBn/original/8knWiv.jpg">&nbsp;</p>
<p>And the same PCBs with all the chips laid down where they belong:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MTMuanBn/original/us5Xc8.jpg"><br></p>
<h3>4) Baking cartridges!</h3>
<p>The solder paste is like a cement for electronics chips. When applied, it's still "wet", so you can reposition the chips if needed. To finalize the PCBs, you need to<strong> dry the paste with an oven</strong>. So technically, the last step of the build process is to "bake" the cartridges:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MTUuanBn/original/A%2BqDuU.jpg">&nbsp;</p>
<h3>5) Flashing the game ROM</h3>
<div><p>Now that the electronic circuit is ready and working, we can<strong> write the game ROM onto the memory chip</strong>. To do this, Catskull uses the wonderful <a href="http://www.infiniteneslives.com/inlretro.php" target="_blank" rel="nofollow noopener">INLretro Dumper-Programmer</a> by Infinite NES Lives. For those who don't know him, <strong>Infinite NES Life is another electronics wizard who created many hardware components for NES and SNES</strong>. He published several high profile NES homebrew, he's sponsoring the annual NESDev competition, and he sells NES and SNES PCBs and carts for people who want to produce homebrew: <a href="http://www.infiniteneslives.com/" rel="nofollow noopener">http://www.infiniteneslives.com</a></p><p>&nbsp;Both<strong> Catskull and I would like to thanks a lot Infinite NES Lives for his support on this project</strong>. First of all, he helped Catskull to fix the PCB pinout. Then, he added support for Catskull PCB on his flasher, so we could use it to manufacture our game. And, last but not least, he supplied us with the CIC chip that is required to build cartridges that can boot on original consoles! So thanks to INL, Catskull can now easily transform his hand-assembled PCB into a working SNES game cartridge running Yo-Yo Shuriken:</p></div>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MjQuanBn/original/Fm4grt.jpg">&nbsp;</p>
<h3>6) Housing the PCB into the shell</h3>
<p>To complete the cartridge assembly, <strong>Catskull puts the PCB inside a cartridge shell</strong>. As you may know, the SNES commercial releases from the 90's had<strong> two cartridge shells variants.</strong> The Japanese and European ones had rounded edges, while the US ones were a bit larger and more rectangular. Of course, you can't plug a Japanese/European cartridge in a US console, and vice-versa.</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1MzkuanBn/original/HP3mvr.jpg"> <br></p>
<p>For Yo-Yo Shuriken, <strong>we wanted to make a single worldwide version</strong>. So we had to use a <strong>shell that could be plugged into both consoles variants</strong>. Luckily, there are people who designed "universal shells" that can be plugged into all consoles models. For example, you can easily find such shells in China for a low price. But <strong>we wanted higher quality materials</strong>. Hopefully, Catskull managed to find an <strong>US-based supplier who designed his own universal SNES shells</strong>, made with a high quality plastic. These shells obviously cost more, but when you have them in hand they offer a nice "sturdy" feel, like the original cartridges. This justified the extra cost in our eyes. Moreover,<strong> those high quality shells also bring a unique touch</strong> to the Yo-Yo Shuriken release: they are only available in red color. While I was surprised at first, I now find it very cool as it's a nod the bright red eyes of the numerous robots enemies in the game! Here are pictures of these shells <em>(front / back)</em>:<br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1NTUuanBn/original/9Tgh92.jpg"> <br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1NTYuanBn/original/vSXeJX.jpg">&nbsp;</p>
<p>Of course, the <strong>cartridge shell also needs a label with the game name</strong> applied on it, but we'll see that step in the next section. To end this rundown of the PCB assembly process, here is an issue that Catskull faced when making the first unit:&nbsp;</p>
<p><em>"The one thing is that SNES PCBs have their components on the rear side (facing away from you when it's in the console). So in all those pictures, I'm working on the rear of the PCB. The first one I accidentally plugged in backwards in the console because I didn't have it in a shell, and it fried the components on the PCB!"<br></em></p>


<p><strong>Having a PCB is only the first step</strong> towards a full cartridge release. These PCBs needs to be housed in shells, with a neat label, and packaged into a beautiful cardboard box with manual. While Catskull was busy designing and hand-assembling the cartridges, <strong>I designed the cartridge label, manual and cardboard box myself</strong>. <br></p>
<h3>Cover art</h3>
<p>I'm far form being an artist. But one of <strong>the pleasure of amateur / homebrew project is doing as many things as possible yourself!</strong> So I fully embraced the "amateurish" side of this project, and I decided to draw the covert art myself! I started by doodling on paper:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1NzcuanBn/original/T9RQUm.jpg"><br></p>
<p>Then I scanned this doodle and I redraw it on the computer using a vector drawing program:</p>
<p>&nbsp;<img src="https://img.itch.zone/aW1nLzM0ODE1NzgucG5n/original/%2FF6Tvw.png"></p>
<p>Once the covert art was done, I used it to design the cardboard box, the manual and the cartridge label. <strong>The final version of all these elements are professionally printed in the US</strong>. But during the design phase, I had to <strong>print the prototypes with my own means</strong>!</p>
<h3>Manual</h3>
<p>For the manual,<strong> I used commercial games releases from the 90's as reference</strong>, in order to produce something as authentic as possible. But we made some compromise as we wanted to produce a single version for all the countries <strong>(no US/Japan/Europe variants like the old days)</strong>. The end result is a <strong>mix of US and European design</strong> style from the 90's. For example, most US releases had black boxes and manuals, while the European ones used a colored background. Here are sample pages from the manual:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1OTEuanBn/original/zXu4%2Bq.jpg">&nbsp;&nbsp; <br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE1OTYucG5n/original/A%2FkqDH.png"><br></p>
<h3>Box</h3>
<p>For the cardboard box, I also used <strong>a mix of European and US design</strong>, with the same color as the manual. I had to print prototypes with own means to be sure that the size was right. For the manual, I could easily print it on my own printer. But for the box, it used an A3 paper size. I also had to print the box on cardboard to be able to build it. So<strong> I went to a local print shop</strong> in my neighborhood to print the box on a A3 cardboard sheet. Then I went back home to build it. I had to make <strong>several versions before getting the exact size</strong> of an original SNES game from the 90's, but I finally made it. Here is a picture of the last box prototype:<br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE2MTIuanBn/original/1BB3A5.jpg"> <br></p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE2MTQuanBn/original/cJ8TF8.jpg">&nbsp;</p>
<p>Once the box prototype was completed and validated by both Catskull and I, we <strong>found a supplier in the US that could build them using professional materials</strong>. We were very happy to found a supplier that could print the boxes on a cardboard material close to the ones from the 90's. <strong>If you open a Yo-Yo Shuriken box, you'll see that the inside is gray/brown</strong>, like the 90's releases, and not white like most retail cardboard stock.<strong> Each box is actually printed and hand assembled in the US by our supplie</strong>r <em>(a two-man operation)</em>, who ships them already assembled to Catskull. Catskull then adds in the manual and the cartridge, to obtain the <strong>final physical release of Yo-Yo Shuriken that can you see here</strong>:</p>
<p><img src="https://img.itch.zone/aW1nLzM0ODE2MjAucG5n/original/jzjjJc.png"><br></p>


<p>In the end, with all these steps, <strong>making Yo-Yo Shuriken took almost 2 years of hard work!</strong> I hope you enjoyed reading this article.<strong> It was quite a journey for me</strong>, and I'm happy to share it online with the hope that it will<strong> inspire and motivate other developers to make new SNES games!</strong></p>
<p>If you want to <strong>play Yo-Yo Shuriken on your own console</strong>, or simply support my work, you can <strong>buy the beautiful boxed cartridge release</strong> directly from Catskul Games: <a href="https://catskullgames.com/yo-yo-shuriken" rel="nofollow noopener"><br>https://catskullgames.com/yo-yo-shuriken</a></p>
<p>If you prefer <strong>to play it on emulators</strong>, you can <strong>buy the ROM version</strong> from here: <br><a href="https://drludos.itch.io/yo-yo-shuriken">https://drludos.itch.io/yo-yo-shuriken</a></p>
<p><strong>If you enjoy my work </strong>and can afford it<strong>, you can </strong><a href="https://www.patreon.com/drludos" target="_blank" rel="nofollow noopener"><strong>support me financially on Patreon</strong></a>. My games usually end up being released as freeware online, while some of them are also sold on actual cartridges. By supporting me on Patreon, you'll also <strong>gain an unique access to the beta versions of my games</strong>, and even to the various prototypes I create <em>(including cancelled projects)</em>:<br><a href="https://www.patreon.com/drludos]." rel="nofollow noopener">https://www.patreon.com/drludos</a><br></p>
<p>If you <strong>simply want to be notified of my latest games and articles releases</strong>, you can<strong> </strong><a href="https://ludoscience.us17.list-manage.com/subscribe/post?u=75ad2256496b82df9f9c498a2&amp;id=12fc75b764" target="_blank" rel="nofollow noopener"><strong>sign-up to my newsletter</strong></a> <em>(I only use it to announce games and articles releases, so except about one email every 1-2 months at maximum)</em>.<a href="https://ludoscience.us17.list-manage.com/subscribe/post?u=75ad2256496b82df9f9c498a2&amp;id=12fc75b764]." rel="nofollow noopener"></a></p></section></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>