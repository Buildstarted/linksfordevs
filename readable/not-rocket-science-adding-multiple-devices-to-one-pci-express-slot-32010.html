<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Not Rocket Science &#xBB; Adding multiple devices to one PCI Express Slot - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Not Rocket Science &#xBB; Adding multiple devices to one PCI Express Slot - linksfor.dev(s)"/>
    <meta property="og:description" content="Most ATX Mainboards have somewhere between 3 and 5 PCI Express slots. Generally, an x16, x8 and some x1&#x27;s, but if you have e.g., a Threadripper X399 board you might have several x8 and x16 slots."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.stum.de/2019/08/01/adding-multiple-devices-to-one-pci-express-slot/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Not Rocket Science &#xBB; Adding multiple devices to one PCI Express Slot</title>
<div class="readable">
        <h1>Not Rocket Science &#xBB; Adding multiple devices to one PCI Express Slot</h1>
            <div>Reading time: 6-8 minutes</div>
        <div>Posted here: 02 Aug 2019</div>
        <p><a href="https://www.stum.de/2019/08/01/adding-multiple-devices-to-one-pci-express-slot/">https://www.stum.de/2019/08/01/adding-multiple-devices-to-one-pci-express-slot/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="container">

	

	
	
	<div id="wrapper">
<div id="content">

	
		<div id="post-1968">
			

			
<p>Most ATX Mainboards have somewhere between 3 and 5 PCI Express slots. Generally, an x16, x8 and some x1's, but if you have e.g., a Threadripper X399 board you might have several x8 and x16 slots.</p>



<p>But what if you want more devices than you have slots? Let's say you want a whole bunch of M.2 NVMe drives, which are only x4 each. Ignoring any motherboard M.2 slots, you can use adapter cards that just adapt the different slots:</p>



<figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image.png 601w, https://www.stum.de/wp-content/uploads/2019/08/image-300x172.png 300w" sizes="(max-width: 601px) 100vw, 601px"></figure>



<p>But now you're wasting an entire x16 slot for just one x4 card. Worse, if you're out of x16/x8 slots and have to use a x1 slot, you're not running at proper speeds. And what's the point of having 64 PCI Express Lanes on a Threadripper CPU if you can't connect a ton of devices at full speed to it?</p>



<p>The thing is that PCI Express lanes can be combined in different ways. If a CPU has 16 PCI Express lanes, a mainboard manufacturer could in theory put 16 x1 Slots on the board (like some <a href="https://www.asus.com/us/Motherboards/B250-MINING-EXPERT/">mining boards</a>), or 1 x16 slot. There are some limitations, and chipsets offer their own additional PCI Express lanes. See for example <a href="https://www.anandtech.com/show/9483/intel-skylake-review-6700k-6600k-ddr4-ddr3-ipc-6th-generation/5">this diagram from Anandtech/Intel</a>:</p>



<figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image-1.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image-1.png 600w, https://www.stum.de/wp-content/uploads/2019/08/image-1-300x201.png 300w" sizes="(max-width: 600px) 100vw, 600px"></figure>



<p>So, to circle back to the topic: Can we just connect more than one device to a PCI Express slot? After all, treating a PCI Express x16 slot as 4 individual x4 slots would solve the NVMe problem, as this would allow 4 NVMe on a single x16 slot with no speed penalty.</p>



<p>And it turns out, this option exists. Actually, there are multiple options.</p>



<h2>Using a PCI Express Switch</h2>



<p>Like a Network Switch, a PCI Express Switch connects multiple PCI Express devices to a shared bus. A popular example is the <a href="https://www.anandtech.com/show/13022/asmedia-preps-asm2824-pcie-30-switch">ASM2824</a>.</p>



<div><figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image-9.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image-9.png 347w, https://www.stum.de/wp-content/uploads/2019/08/image-9-200x300.png 200w" sizes="(max-width: 347px) 100vw, 347px"></figure></div>



<p>The advantage of a PCI Express Switch is that it's compatible with pretty much any mainboard and are thus a great option - if it weren't for the price. A Quad NVMe card with a PCI Express Switch costs around $200 at the moment.</p>



<p>I do not know if there are any performance deficits, though assuming you're using a PCI Express x16 slot, you should be fine. It should be possible to use these cards in x8, x4, and even x1 slots, though of course now your 16 NVMe lanes have to go through the bottleneck that's the slot.</p>







<h2>Using Bifurcation</h2>



<p>Beef-o-what? From <a href="https://en.wiktionary.org/wiki/bifurcate">Wiktionary</a>:</p>



<blockquote><div><p><strong>Verb</strong><br><em>bifurcate </em>(third-person singular simple present <em>bifurcates</em>, present participle <em>bifurcating</em>, simple past and past participle <em>bifurcated</em>)</p><p>     (intransitive) To divide or fork into two channels or branches.<br>     (transitive) To cause to bifurcate.</p><p> <em>Synonyms</em><br>     branch, fork</p></div></blockquote>



<p>Bifurcation is the act in which you take 4 lanes of an x16 slot and turn them into a separate x4 slot, then take another 4 lanes and turn it into another x4 slot, etc.</p>



<div><figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image-10.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image-10.png 347w, https://www.stum.de/wp-content/uploads/2019/08/image-10-262x300.png 262w" sizes="(max-width: 347px) 100vw, 347px"><figcaption> Look ma, no bridge! </figcaption></figure></div>



<p>In theory, you would be able to split an x16 slot into 16 individual x1 slots, or into 1x4, 1x8, and 4x1 though I'm not aware of any mainboard that supports this.</p>



<p>And that's the important part here: The mainboard needs to support this. There would need to be an option somewhere to tell the mainboard how to bifurcate the slot. Here's an example from the BIOS of the <a href="https://www.gigabyte.com/Motherboard/X399-AORUS-PRO-rev-10">X399 AORUS Pro</a>:</p>



<div><figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image-4.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image-4.png 602w, https://www.stum.de/wp-content/uploads/2019/08/image-4-300x97.png 300w" sizes="(max-width: 602px) 100vw, 602px"></figure></div>



<p>This board offers to bifurcate an x16 slot into either 1x16, 2x8, or 4x4. For x8 slots, I can choose 1x8 or 2x4. With this, I can use a card like the <a href="https://www.asus.com/Motherboard-Accessories/HYPER-M-2-X16-CARD-V2/">ASUS Hyper M.2 X16 Card V2</a>, which is basically 4 of those NVMe-PCI-Express cards on one PCB.</p>



<div><figure><img src="https://www.stum.de/wp-content/uploads/2019/08/image-5.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/image-5.png 602w, https://www.stum.de/wp-content/uploads/2019/08/image-5-300x141.png 300w" sizes="(max-width: 602px) 100vw, 602px"><figcaption>In comparison to the $199 card above, this Quad NVMe adapter costs $55 at the time of writing.</figcaption></figure></div>



<p>The card itself has some electronics on it for power regulation, fan control and the like, but no PCI Express Bridge. The system gets presented with 4 individual PCI Express x4 buses.</p>



<div><figure><img src="https://www.stum.de/wp-content/uploads/2019/08/Bifurcated.png" alt="" srcset="https://www.stum.de/wp-content/uploads/2019/08/Bifurcated.png 311w, https://www.stum.de/wp-content/uploads/2019/08/Bifurcated-300x202.png 300w" sizes="(max-width: 311px) 100vw, 311px"><figcaption>Individual PCI Express x4 Buses</figcaption></figure></div>



<p>It's important that bifurcation does not "add" PCI Express lanes like a Switch could - you can't bifurcate an x8 slot into 4x4 slots, and using the above card in such an x8 slot will only show one or two drives (if using x8 or x4x4) mode.</p>



<p>Bifurcation is not usually supported in "consumer" platforms, mainly because there aren't a lot of PCI Express lanes on most CPUs. Intel's flagship <a href="https://www.intel.com/content/www/us/en/products/processors/core/i9-processors/i9-9900k.html">Core i9-9900K CPU</a> has 16 total lanes. Sixteen. Total. AMD is a bit more generous on their <a href="https://en.wikipedia.org/wiki/Ryzen">Ryzen CPUs</a>, offering 24 Lanes (Fewer on APUs). Now, some of those lanes are connected to the Chipset to provide things like SATA, USB, OnBoard Sound and Networking. With your graphics card (likely x16), an NVMe boot SSD (x4), you're already somewhere in the realm of 28 PCI Express lanes, though of course because they don't always use the full bandwidth, the PCI Express Switch in the CPU can handle this without performance loss.</p>



<p>But still, with so few lanes, Birfurcation doesn't make sense. It does come into play on HEDT Platforms however. AMD's Threadripper boasts 64 PCI Express Lanes, while EPYC has 128 of them. Intel's product lineup is a bit more segregated, with their <a href="https://en.wikipedia.org/wiki/LGA_2066">LGA 2066</a> platform offering 16, 28, 44, or 48 lanes. <a href="https://ark.intel.com/content/www/us/en/ark/products/series/125035/intel-xeon-w-processor.html">Cascade Lake-W</a> offers 64 PCI Express Lanes.</p>



<h2>HEDT - more than just more Cores</h2>



<p>With AMD now offering 16 Cores at 3.5 GHz in their <a href="https://www.amd.com/en/products/cpu/amd-ryzen-9-3950x">Ryzen 9 3950X</a>, and Intel bringing the Core i9-9900K to the LGA1151v3 platform, there is a question whether LGA 2066 and Threadripper still make sense. Why pay so much more money on the CPU and Mainboard?</p>



<p>However, as important as Core Count/Speed is in many cases, if you're building a fast storage server with SSD/NVMe Storage and up to <a href="https://en.wikipedia.org/wiki/100_Gigabit_Ethernet">100 Gigabit Ethernet</a>, you need those extra PCI Express lanes.</p>



<p>Four NVMe drives is already 16 PCIe 3.0 Lanes, a single 10 Gigabit Ethernet port would require 2 more PCIe 3.0 Lanes and the chipset also usually takes 4 lanes for its stuff, bringing the total to 22. So you're already scraping the limit of Ryzen Desktop CPUs, without much room for additional growth. SATA and USB are part of the Chipset, but if you want SAS Drives, more/faster network ports, a graphics card, additional NVMe storage - you're back in the land of PCI Express Switches and compromising on bandwidth.</p>



<p>As said before, currently there is an actual choice of CPUs for different use cases. Do you want more cores, or faster cores? Two, Four, Six, or Eight memory channels? NVMe storage and/or RAID? A bleeding edge platform, or one that's around for years but likely on its way out soon?</p>



<p>After a decade of stagnation, Building PCs is fun again!</p>

						
			<div><p>
				August 1st, 2019 in
				<a href="https://www.stum.de/category/hardware/" rel="category tag">Hardware</a>											</p></div>
		</div>

		

	
</div>

	</div>
	
	
	
	
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>