<!DOCTYPE html>
<html lang="en">
<head>
    <title>
You don&#x27;t need to be a rocket-scientist to contribute to .NET Core! -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>You don&#x27;t need to be a rocket-scientist to contribute to .NET Core!</h1>
    <div class="post-content">
<p>Sometimes when I&apos;m talking with other .NET developers, the &quot;I don&apos;t understand why Microsoft doesn&apos;t provide X functionality&quot; or &quot;Why hasn&apos;t Microsoft fixed Y yet?&quot; topic comes up. Also &quot;The documentation for Z really sucks&quot; comes often up as well.</p><p>Guess what? You can fix all this yourself! Because .NET Core is open source. You can even contribute documentation since that is open source as well. And in many cases it&apos;s not even hard at all.</p><p>But why should you? Doesn&apos;t Microsoft have people that should be doing this? They do, but those people are just like you and me. They work normal hours, they have prioritized tasks and things simply might not be on their radar. That&apos;s why open source is so awesome, because it allows us to take part and fix stuff that we really want fixed if it isn&apos;t high on the priority list.</p><p>I&apos;m going to demonstrate this with an example of a contribution I did myself a few weeks ago.</p><p>I decided to try out the new Microsoft.Data.SqlClient library, whose purpose is to replace the SQL Server client library which is built into .NET Framework and .NET Core to be shipped out-of-band, bringing new features earlier. Adding it to our product was easy, however, when I was trying to gather SQL dependency data for Application Insights, I noticed that I wasn&apos;t receiving any. That&apos;s when I found this error message in our logs: <code>ERROR: Exception in Command Processing for EventSource Microsoft-AdoNet-SystemData: Event BeginExecute is givien event ID 2 but 1 was passed to WriteEvent.</code> </p><p>Ok, obviously something wasn&apos;t working and after googling the error message I found that &#xA0;it was coming from Application Insights, and after looking at the code it was immediately clear what had happened. It was a simple typo, a typical copy-paste error that we have all done many many times in our coding careers.</p><p>This was the offending code:</p><pre><code class="language-csharp">[Event(SqlEventSource.EndExecuteEventId, Keywords = Keywords.SqlClient, Task = Tasks.ExecuteCommand, Opcode = EventOpcode.Stop)]
public void BeginExecute(int objectId, string dataSource, string database, string commandText)
{
    // we do not use unsafe code for better performance optization here because optimized helpers make the code unsafe where that would not be the case otherwise. 
    // This introduces the question of partial trust, which is complex in the SQL case (there are a lot of scenarios and SQL has special security support).   
    WriteEvent(SqlEventSource.BeginExecuteEventId, objectId, dataSource, database, commandText);
}

// unfortunately these are not marked as Start/Stop opcodes.  The reason is that we dont want them to participate in 
// the EventSource activity IDs (because they currently don&apos;t use tasks and this simply confuses the logic) and 
// because of versioning requirements we don&apos;t have ActivityOptions capability (because mscorlib and System.Data version 
// at different rates)  Sigh...
[Event(SqlEventSource.EndExecuteEventId, Keywords = Keywords.SqlClient, Task = Tasks.ExecuteCommand, Opcode = EventOpcode.Stop)]
public void EndExecute(int objectId, int compositeState, int sqlExceptionNumber)
{
    WriteEvent(SqlEventSource.EndExecuteEventId, objectId, compositeState, sqlExceptionNumber);
}</code></pre><p>Spotted that pretty quickly right? It doesn&apos;t seem right that BeginExecute would be using the EndExecuteEventId, and sure enough, if you <a href="https://github.com/dotnet/SqlClient/commit/de6e901c8c24f5fa55f1aaaee5f60380416ad3e8">look at the diff</a> from my changes, it seems to have been a copy paste left-over from the EndExecute event right below. I simply changed that to the correct event id, verified by compiling the library and running it locally, created a pull request, and within days, <a href="https://github.com/dotnet/SqlClient/pull/241">it was accepted and merged</a>!</p><p>And since I&apos;d found this process to be so wonderfully simple I continued. I decided to fix a long standing pet-peeve of mine where the old System.Data.SqlClient only sent the SQL Command Text for stored procedure but omitted it for standard queries when running on the old .NET Framework but it worked fine in .NET Core. So I found that code and fixed that as well. <a href="https://github.com/dotnet/SqlClient/pull/242">That pull request was also accepted and merged</a>.</p><pre><code class="language-csharp">// I simply removed this logic!
string commandText = CommandType == CommandType.StoredProcedure ? CommandText : string.Empty;
SqlEventSource.Log.BeginExecute(GetHashCode(), Connection.DataSource, Connection.Database, commandText);</code></pre><p>You see?</p><p>None of these changes were big, they weren&apos;t overly complex, and I was able to fix them myself and submit the changes upstream for others to benefit.</p><p>You can even <a href="https://docs.microsoft.com/en-us/contribute/">make changes to docs.microsoft.com</a> if you want to add information or code samples, and it&apos;s as simple as clicking an &quot;Edit&quot; button to get started.</p></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>