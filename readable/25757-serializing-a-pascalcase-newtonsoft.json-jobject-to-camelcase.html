<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Serializing a PascalCase Newtonsoft.Json JObject to camelCase -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Serializing a PascalCase Newtonsoft.Json JObject to camelCase</h1>
    <div class="post-content">
<p>In this post I describe one of the quirks of serializing JSON.NET <code>JObject</code> (contract resolvers are not honoured), and show how to get camelCase names when serializing a <code>JObject</code> that stored its property names in PascalCase.</p> <p>I was working with some code the other day that stored objects in PostgreSQL <a href="https://www.postgresql.org/docs/11/datatype-json.html">using the built-in JSON support</a>. The code that used it was deserializing the data to a JSON.NET <code>JObject</code> in code. So the data class looked something like the following, with a <code>JObject</code> property, <code>Details</code>:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span>
<span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token class-name">Guid</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">string</span> Genus <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token class-name">JObject</span> Details <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this case, the <code>JObject</code> was a &quot;serialized&quot; version of a data class:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SlothDetails</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token keyword">int</span> NumberOfToes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">int</span> NumberOfCervicalVertebrae <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>So an instance of the <code>Animal</code> class was created using code similar to the following:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> sloth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span>
<span class="token punctuation">{</span> Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;Three-toed sloth&quot;</span><span class="token punctuation">,</span> Genus <span class="token operator">=</span> <span class="token string">&quot;Bradypus&quot;</span><span class="token punctuation">,</span> Details <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SlothDetails</span> <span class="token punctuation">{</span> NumberOfToes <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> NumberOfCervicalVertebrae <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>In this code we take the strongly-typed <code>SlothDetails</code> and turn it into a <code>JObject</code>. There&apos;s nothing very special here - we&apos;re using <code>JObject</code> as a pseudo-dynamic type, to allow us to store different types of data in the <code>Details</code> property. For example, we could create an entirely different type and assign it to the <code>Details</code> property:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DogDetails</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token keyword">bool</span> IsGoodBoy <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">int</span> NumberOfLegs <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">var</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;Dog&quot;</span><span class="token punctuation">,</span> Genus <span class="token operator">=</span> <span class="token string">&quot;Canis&quot;</span><span class="token punctuation">,</span> Details <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DogDetails</span> <span class="token punctuation">{</span> IsGoodBoy <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span> NumberOfLegs <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>We can work with both <code>Animal</code> instances in the same way, even though the <code>Details</code> property contains different data. </p>
<p>So why would you want to do this? The type system is one of the strong points of C#, and if you need truly dynamic data, there&apos;s always the <code>dynamic</code> type from C# 4.0? Why not create <code>Animal&lt;T&gt;</code> and make <code>Details</code> a <code>T</code>? Or we could have just made <code>Details</code> a <code>string</code>, and stored a serialized version of the data?</p>
<p>All of those might be valid approaches for your situation. In our case, we know that we&apos;re storing JSON in the database, and that the <code>Details</code> object must serialize to JSON, so it made sense to use a type that most accurately represents that data: <code>JObject</code>. <a href="https://www.newtonsoft.com/json/help/html/LINQtoJSON.htm">LINQ to JSON</a> provides a convenient API to query the data, and we get <em>some</em> type safety from knowing that anything passed to <code>Details</code> is a valid JSON object.</p>
<p>All of this works perfectly, until you try exposing one of these <code>JObject</code> from an ASP.NET Web API. </p> <p>Lets start by seeing what you get if you Serialize the <code>dog</code> instance above, by returning it from an ASP.NET Core controller:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token class-name">ApiController</span><span class="token punctuation">,</span> <span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalsController</span>
<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token class-name">HttpGet</span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token keyword">object</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">&quot;Dog&quot;</span><span class="token punctuation">,</span> Genus <span class="token operator">=</span> <span class="token string">&quot;Canis&quot;</span><span class="token punctuation">,</span> Details <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DogDetails</span> <span class="token punctuation">{</span> IsGoodBoy <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span> NumberOfLegs <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ASP.NET Core uses a camelCase formatter by default (instead of the PascalCase used for C# property names) so the resulting JSON is camelCase:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;96ca7c68-7550-4809-86c5-4d784f3b3f87&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Dog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;genus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Canis&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;IsGoodBoy&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">&quot;NumberOfLegs&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This looks <em>nearly</em> right, but there&apos;s a problem - the <code>IsGoodBoy</code> and <code>NumberOfLegs</code> properties of the serialized <code>JObject</code> are all <code>PascalCase</code> - that&apos;s a problem!</p>
<p>This all comes down to an early design-decision (<a href="https://web.archive.org/web/20171005181503/http://json.codeplex.com/workitem/23853">since lamented</a>) that means that <a href="https://codeopinion.com/asp-net-core-mvc-json-output-camelcase-pascalcase/">contract resolvers</a> are ignored by default when serializing <code>JObject</code> as part of an object graph (as we have here).</p>
<p>This is clearly an issue if you&apos;re using a <code>JObject</code> in your object graph. I only found a few ways to work around the limitation, depending on your situation.</p> <p>The first option is to change the global serialization options to use camelCase. This option has been available for a long time (<a href="http://james.newtonking.com/archive/2013/05/08/json-net-5-0-release-5-defaultsettings-and-extension-data">since version 5.0 of JSON.NET</a>), and will globally configure the JSON.NET serializer to use camelCase, even for a <code>JObject</code> created using PasalCase property names:</p>
<pre class="language-csharp"><code class="language-csharp">
JsonConvert<span class="token punctuation">.</span>DefaultSettings <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">JsonSerializerSettings</span>
<span class="token punctuation">{</span> ContractResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CamelCasePropertyNamesContractResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>If you add this code to your project, your <code>JObject</code> will be serialized to camelCase, with no other changes required to your project:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;96ca7c68-7550-4809-86c5-4d784f3b3f87&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Dog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;genus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Canis&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;isGoodBoy&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">&quot;numberOfLegs&quot;</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The obvious downside to this approach is that affects <em>all</em> serialization in your app. If you have a new (or small app) that might not be a problem, but for a large, legacy app that might cause issues. Subtle changes in casing in client-side JavaScript apps could cause a multitude of bugs if you have code relying on the existing <code>JObject</code> serialization behaviour. </p> <p>The serialization problem we&apos;re seeing stems from two things: </p>
<ol>
<li><code>JObject</code> serialization doesn&apos;t honour contract resolvers (unless you set <code>JsonConvert.DefaultSettings</code>)</li>
<li>We have a PascalCase <code>JObject</code> instead of camelCase.</li>
</ol>
<p>The first approach (changing the default serializer) addresses point 1., but the other option is to never get ourselves into this situation! This approach is easier to introduce to large apps, as it allows you to change the &quot;stored format&quot; in a single location, instead of affecting a whole large app.</p>
<p>The <code>JObject.FromObject()</code> method takes a second parameter, which allows you to control how the <code>JObject</code> is created from the C# object. We can use that to ensure the <code>JObject</code> we create uses camelCase names already, so we don&apos;t have to worry when it comes to serialization.</p>
<p>To do this, create a <code>JsonSerializer</code> with the required settings. You can store this globally and reuse it throughout your app:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">static</span> <span class="token class-name">JsonSerializer</span> _camelCaseSerializer <span class="token operator">=</span> JsonSerializer<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">JsonSerializerSettings</span> <span class="token punctuation">{</span> ContractResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CamelCasePropertyNamesContractResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Now, when creating the <code>JObject</code> from a .NET object, pass in the <code>_camelCaseSerializer</code>:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">var</span> details <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DogDetails</span>
<span class="token punctuation">{</span> IsGoodBoy <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span> NumberOfLegs <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> _camelCaseSerializer<span class="token punctuation">)</span> 
</code></pre>
<p>This will use camelCase for the internal names, so when the <code>JObject</code> is serialized, it will give the output we want:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">&quot;isGoodBoy&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token property">&quot;numberOfLegs&quot;</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This approach is probably the best in general - it addresses the problem at its source, and doesn&apos;t have to impact your app globally. Unfortunately, if you&apos;re already storing objects using PascalCase, this approach might not be feasible to adopt. In which case you&apos;re left with the following approach.</p> <p>In some cases, you might just be stuck with a PascalCase <code>JObject</code> as part of an object graph, that needs to be serialized using camelCase. The only solution I could find to this is to create a new camelCase <code>JObject</code> from the existing PascalCase <code>JObject</code>. </p>
<p>The following extension method (and helpers) show how to create a new <code>JObject</code> that has camelCase property names, from one that has PascalCase names.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Contracts<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">JTokenExtensions</span>
<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token class-name">Pure</span><span class="token punctuation">]</span> <span class="token keyword">static</span> <span class="token class-name">JObject</span> <span class="token function">ToCamelCase</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">JObject</span> original<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> property <span class="token keyword">in</span> original<span class="token punctuation">.</span><span class="token function">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> newPropertyName <span class="token operator">=</span> property<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">ToCamelCaseString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> newObj<span class="token punctuation">[</span>newPropertyName<span class="token punctuation">]</span> <span class="token operator">=</span> property<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToCamelCaseJToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> newObj<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">Pure</span><span class="token punctuation">]</span> <span class="token keyword">static</span> <span class="token class-name">JToken</span> <span class="token function">ToCamelCaseJToken</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">JToken</span> original<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>original<span class="token punctuation">.</span>Type<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">case</span> JTokenType<span class="token punctuation">.</span>Object<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>JObject<span class="token punctuation">)</span>original<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToCamelCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">case</span> JTokenType<span class="token punctuation">.</span>Array<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>JArray<span class="token punctuation">)</span>original<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span><span class="token function">ToCamelCaseJToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> original<span class="token punctuation">.</span><span class="token function">DeepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">Pure</span><span class="token punctuation">]</span> <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">ToCamelCaseString</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">string</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">char</span><span class="token punctuation">.</span><span class="token function">ToLowerInvariant</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">return</span> str<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>ToCamelCase()</code> method starts by creating a new (empty) <code>JObject</code> instance. It then loops through the original object, converting each property name to camelCase. It then recursively converts the <code>Value</code> of the property to a camelCase <code>JToken</code>. This is important, as the properties could also contain <code>JObject</code>s, or <code>JArray</code>s of <code>JObject</code>s, and we need to make sure <em>all</em> the properties are converted to camelCase, not just the &quot;top-level&quot; properties. </p>
<blockquote>
<p>For objects other than <code>JObject</code> and <code>JArray</code>, (e.g. number, string), I create a copy of the <code>JToken</code> using <code>DeepClone()</code>. I don&apos;t believe that&apos;s strictly necessary, but decided to play it safe.</p>
</blockquote>
<p>You can use the <code>ToCamelCase()</code> extension method at the &quot;edges&quot; of your system, when you need to serialize a <code>JObject</code> that is stored in PascalCase. This creates a clone of the object, but using camelCase properties.</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token class-name">ApiController</span><span class="token punctuation">,</span> <span class="token function">Route</span><span class="token punctuation">(</span><span class="token string">&quot;api/[controller]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnimalsController</span>
<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token class-name">HttpGet</span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token keyword">object</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> details <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DogDetails</span> <span class="token punctuation">{</span> IsGoodBoy <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span> NumberOfLegs <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> details<span class="token punctuation">.</span><span class="token function">ToCamelCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This approach feels pretty hacky, but it gets the job done when the other approaches are no good for you. For completeness, the following set of xUnit <code>Theory</code> tests show the behaviour in action:</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> FluentAssertions<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> Xunit<span class="token punctuation">;</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JTokenExtensionTests</span>
<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token class-name">Theory</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">MemberData</span><span class="token punctuation">(</span><span class="token function">nameof</span><span class="token punctuation">(</span>GetTokenData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ToCamelCase_WhenNotJObject_DoesNotChangeOutput</span><span class="token punctuation">(</span><span class="token class-name">JToken</span> original<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> newToken <span class="token operator">=</span> original<span class="token punctuation">.</span><span class="token function">ToCamelCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> originalSerialized <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> newSerialized <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>newToken<span class="token punctuation">)</span><span class="token punctuation">;</span> newSerialized<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Be</span><span class="token punctuation">(</span>originalSerialized<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">Theory</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">MemberData</span><span class="token punctuation">(</span><span class="token function">nameof</span><span class="token punctuation">(</span>GetJobjectData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ToCamelCase_WhenJObject_ConvertsToCamelCase</span><span class="token punctuation">(</span><span class="token class-name">JObject</span> original<span class="token punctuation">,</span> <span class="token class-name">JObject</span> expected<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">var</span> newObject <span class="token operator">=</span> original<span class="token punctuation">.</span><span class="token function">ToCamelCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> expectedSerialized <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>expected<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">var</span> newSerialized <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>newObject<span class="token punctuation">)</span><span class="token punctuation">;</span> newSerialized<span class="token punctuation">.</span><span class="token function">Should</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Be</span><span class="token punctuation">(</span>expectedSerialized<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">GetTokenData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">GetTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>token <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> JToken<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">GetJobjectData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">GetJObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>pair <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span>pair<span class="token punctuation">.</span>Original<span class="token punctuation">)</span><span class="token punctuation">,</span> JObject<span class="token punctuation">.</span><span class="token function">FromObject</span><span class="token punctuation">(</span>pair<span class="token punctuation">.</span>Expected<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">object</span> Original<span class="token punctuation">,</span> <span class="token keyword">object</span> Expected<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token function">GetJObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> MyVal <span class="token operator">=</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> myVal <span class="token operator">=</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> MyVal <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> myVal <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> MyVal <span class="token operator">=</span> <span class="token string">&quot;this is my string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> myVal <span class="token operator">=</span> <span class="token string">&quot;this is my string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> MyVal <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> myVal <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> MyVal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> A <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> NESTED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> Another <span class="token operator">=</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> EEK <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> myVal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> nESTED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> another <span class="token operator">=</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> eEK <span class="token operator">=</span> <span class="token keyword">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span><span class="token keyword">object</span><span class="token operator">&gt;</span> <span class="token function">GetTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;this is my string&quot;</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;This is my string&quot;</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span> <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token number">23.5</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>In this post I described some of the quirks of using <code>JObject</code>, in particular the way it doesn&apos;t honour the contract resolver settings used to serialize a given object graph. I described three different ways to work around the behaviour: set the global serializations settings, store the <code>JObject</code> using camelCase property names, or convert from a PascalCase <code>JObject</code> to a camelCase <code>JObject</code>. For the final option, a provided an extension method and unit tests to demonstrate the behaviour.</p>
</div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>