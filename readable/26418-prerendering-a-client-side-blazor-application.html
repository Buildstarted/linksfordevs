<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Prerendering a Client-side Blazor Application -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Prerendering a Client-side Blazor Application</h1>
    <div class="post-content"> <p>While prerendering is now the default for server-side Blazor applications, I only recently discovered (as in the last 48 hours) that client-side Blazor applications can take advantage of this as well. In this post, I&apos;m going to show you how you can setup your client-side Blazor application for prerendering.</p><blockquote>The example project for this post can be found on <a href="https://github.com/chrissainty/ClientSideBlazorPrerendering">GitHub</a>.</blockquote><h2 id="what-is-prerendering">What is prerendering?</h2><p>Prerendering is a process where all the elements of a web page are compiled on the server and static HTML is served to the client. This technique is used to help SPAs (Single Page Applications) improve their SEO (Search Engine Optimisation). Another benefit is that sites appear to load much faster. </p><p>What this means for a Blazor application is that the requested page will be built on the server and compiled to static HTML. This static HTML will include the <code>blazor.webassembly.js</code> file which is present in the standard client-side Blazor template. When the client receives this static HTML it will be processed and rendered as normal.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/06/blazor-client-side-prerender.jpg" class="kg-image"></figure><p>When the <code>blazor.webassembly.js</code> file is executed the mono runtime will be downloaded along with the application dlls and your application will be run. At this point all of the static prerendered elements will be replaced with interactive components and the application will become interactive. </p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/06/blazor-client-side-prerender-interactive.jpg" class="kg-image"></figure><p>Now, this may sound like a lot has to happen before your application becomes usable. But this all happens in a very short space of time and is impersevablse to most end users.</p><h2 id="the-prerendering-trade-off">The Prerendering Trade-off</h2><p>Before we look at how to enable prerendering I want to point out that there is a trade-off with using it. You will no longer be able to deploy your Blazor application as static files. </p><p>As we&apos;ll see in a second, prerendering requires a razor page, and that means a .NET runtime is required. While this is probably not a big issue, I do want to make sure you&apos;re aware of it.</p><h2 id="enabling-prerendering">Enabling Prerendering</h2><p>We&apos;re going to start with a stand alone Blazor application and go though the steps to enable prerendering. I&apos;ve created a new stand alone Blazor application using the dotnet CLI. You can also use the template in Visual Studio.</p><pre><code>dotnet new blazor -o BlazorPrerendering.Client
</code></pre>
<p>If you are looking to enable prerendering on a client-side Blazor app that is already using the &quot;Hosted&quot; template. Then you can just add in the bits of configuration as we go along.</p><h3 id="adding-a-host-project">Adding a Host Project</h3><p>The first thing we are going to do is add a new empty ASP.NET Core Web App. Again, I&apos;m using the dotnet CLI but you can use the templates in Visual Studio if you prefer.</p><pre><code>dotnet new web -o BlazorPrerendering.Server
</code></pre>
<p>Our solution should now look like this.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/06/solution-structure.JPG" class="kg-image"></figure><p>Then we need to add a project reference from the server project to the client project as well as a couple of NuGet packages. We also need to add in some additional sources for loading the Blazor.Server package. So the easiest thing to do is edit the <code>csproj</code> file directly.</p><pre><code class="language-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;

  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp3.0&lt;/TargetFramework&gt;
    &lt;RestoreAdditionalProjectSources&gt;
      https://dotnet.myget.org/F/aspnetcore-dev/api/v3/index.json;
      https://dotnet.myget.org/F/blazor-dev/api/v3/index.json;
    &lt;/RestoreAdditionalProjectSources&gt;
    &lt;LangVersion&gt;7.3&lt;/LangVersion&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Blazor.Server&quot; Version=&quot;3.0.0-preview5-19227-01&quot; /&gt;
    &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Mvc.NewtonsoftJson&quot; Version=&quot;3.0.0-preview5-19227-01&quot; /&gt;
  &lt;/ItemGroup&gt;

  &lt;ItemGroup&gt;
    &lt;ProjectReference Include=&quot;..\BlazorPrerendering.Client\BlazorPrerendering.Client.csproj&quot; /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre>
<p>Once you&apos;re done, your project file should look like the code above. </p><h3 id="configuring-the-host">Configuring The Host</h3><p>Now our projects are setup, we are going to make some changes to the server projects <code>Startup.cs</code>. </p><p>First, add the following code to the <code>ConfigureServices</code> method.</p><pre><code class="language-csharp">public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc().AddNewtonsoftJson();
    services.AddResponseCompression(opts =&gt;
    {
        opts.MimeTypes = ResponseCompressionDefaults.MimeTypes.Concat(
            new[] { &quot;application/octet-stream&quot; });
    });
}
</code></pre>
<p>We&apos;ll also need to add a using statement.</p><pre><code class="language-csharp">using Microsoft.AspNetCore.ResponseCompression;
</code></pre>
<p>Then replace the code in the <code>Configure</code> method with the code below.</p><pre><code class="language-csharp">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    app.UseResponseCompression();

    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
        app.UseBlazorDebugging();
    }
    
    app.UseHttpsRedirection();

    app.UseStaticFiles();

    app.UseRouting();

    app.UseEndpoints(endpoints =&gt;
    {
        endpoints.MapDefaultControllerRoute();
        endpoints.MapFallbackToPage(&quot;/_Host&quot;);
    });

    app.UseBlazor&lt;Client.Startup&gt;();
}
</code></pre>
<p>We&apos;re going to add a folder called <code>wwwroot</code> to the root of the server project. Inside this folder we also need to create another called <code>js</code>. &#xA0;Then inside the <code>js</code> folder we are going to create a file called <code>blazor.webassembly.js</code> and <a href="https://github.com/chrissainty/ClientSideBlazorPrerendering/blob/master/src/BlazorPrerendering.Server/wwwroot/js/blazor.webassembly.js">copy in this code</a>.</p><p>Once that is done we need to copy the contents of the <code>css</code> folder in the Client projects <code>wwwroot</code> folder to server projects <code>wwwroot</code> folder. Once thats all done things should look like this.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/06/prerendering-folder-structure.JPG" class="kg-image"></figure><p>Finally, we need to create a folder called <code>Pages</code> in the root of the server project and create a file called <code>_Host.cshtml</code> with the following code.</p><pre><code class="language-html">@page &quot;/&quot;
@namespace BlazorPrerendering.Server.Pages
@using BlazorPrerendering.Client
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Prerendering client-side Blazor&lt;/title&gt;
    &lt;base href=&quot;~/&quot; /&gt;
    &lt;environment include=&quot;Development&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap/bootstrap.min.css&quot; /&gt;
    &lt;/environment&gt;
    &lt;environment exclude=&quot;Development&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;
              asp-fallback-href=&quot;css/bootstrap/bootstrap.min.css&quot;
              asp-fallback-test-class=&quot;sr-only&quot; asp-fallback-test-property=&quot;position&quot; asp-fallback-test-value=&quot;absolute&quot;
              crossorigin=&quot;anonymous&quot;
              integrity=&quot;sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot; /&gt;
    &lt;/environment&gt;
    &lt;link href=&quot;css/site.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;app&gt;@(await Html.RenderStaticComponentAsync&lt;App&gt;())&lt;/app&gt;

    &lt;script src=&quot;~/js/blazor.webassembly.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="testing-prerendering">Testing Prerendering</h2><p>We should now be able to start up the server project and launch the application. Once the application has loaded, the easiest way to test prerendering is to disable JavaScript in your browser. Then reload the page, if the page loads then prerendering is working.</p><p>To achieve this in Chrome or Edgeium, open the dev tools and press <code>ctrl+shift+p</code> or <code>cmd+shift+p</code>, depending on your OS. The start typing javascript, you should see the option appear to disable javascript.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/06/chrome-dev-tools.jpg" class="kg-image"></figure><p>You should still be able to navigate around the app but you will find components will not be interactive. Go ahead and enable JavaScript again (just repeat the steps to disable but now the option will be to <em>Enable JavaScript</em>) and refresh the page, you should now have an interactive application once more.</p><p>Prerendering is a really useful tool to have available and it&apos;s great that we can now use it with both server-side and client-side Blazor. In this post, I&apos;ve shown how you can enable prerendering of your client-side Blazor applications by use of a hosted server project.</p> <div class="post-tags"> Tagged in: <a href="/blazor-client-side/">Blazor (client-side)</a> | <a href="/blazor/">Blazor</a> | <a href="/prerendering/">Prerendering</a> </div> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>