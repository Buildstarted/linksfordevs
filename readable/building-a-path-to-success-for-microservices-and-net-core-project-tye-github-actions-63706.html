<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Building a path to success for microservices and .NET Core - Project Tye &#x2B; GitHub Actions - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Building a path to success for microservices and .NET Core - Project Tye &#x2B; GitHub Actions - linksfor.dev(s)"/>
    <meta property="article:author" content="https://techcommunity.microsoft.com/t5/user/viewprofilepage/user-id/212082"/>
    <meta property="og:description" content="Project Tye is an experimental developer tool that the .NET team is working on to make the experience of creating, testing and deploying microservices and distributed apps easier.&#xA0;&#xA0; &#xA0; If you&#x27;ve done any work in this space over the past many years you&#x27;ve no doubt seen the changes in technology and to..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://techcommunity.microsoft.com/t5/apps-on-azure/building-a-path-to-success-for-microservices-and-net-core/ba-p/1502270"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Building a path to success for microservices and .NET Core - Project Tye &#x2B; GitHub Actions</title>
<div class="readable">
        <h1>Building a path to success for microservices and .NET Core - Project Tye &#x2B; GitHub Actions</h1>
            <div>by https://techcommunity.microsoft.com/t5/user/viewprofilepage/user-id/212082</div>
            <div>Reading time: 8-11 minutes</div>
        <div>Posted here: 02 Jul 2020</div>
        <p><a href="https://techcommunity.microsoft.com/t5/apps-on-azure/building-a-path-to-success-for-microservices-and-net-core/ba-p/1502270">https://techcommunity.microsoft.com/t5/apps-on-azure/building-a-path-to-success-for-microservices-and-net-core/ba-p/1502270</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		<div itemprop="text" id="bodyDisplay">
	
		<div>
			
				
					
					
						<p><a href="https://github.com/dotnet/tye" target="_self" rel="noopener noreferrer">Project Tye</a> is an experimental developer tool that the .NET team is working on to make the experience of creating, testing and deploying microservices and distributed apps easier.&nbsp;&nbsp;</p>

<p>If you've done any work in this space over the past many years you've no doubt seen the changes in technology and tools; Docker Swarm, Mesosphere, Kubernetes, and various tools and configuration options that more than likely caused some sort of pain.</p>

<p>The goals of Tye are to help make the development easier by running many services with a <strong>single command</strong>, options for using containers or not, service discovery by convention, and simplifying deployment to Kubernetes with minimal knowledge and/or configuration.</p>

<p>In March, the team gave a quick overview during the <a href="https://youtu.be/yzNEHrWM78o" target="_self" rel="nofollow noopener noreferrer">.NET Community StandUp</a></p>

<p><iframe src="https://www.youtube.com/embed/yzNEHrWM78o" width="560" height="315" frameborder="0" allowfullscreen="" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe></p>

<p><span size="5">Getting Started</span></p>
<p>There are a number of resources for getting up and running.&nbsp;&nbsp;</p>

<ul>
<li>GitHub Project Page : <a href="https://github.com/dotnet/tye" target="_blank" rel="noopener noopener noreferrer">dotnet/tye</a>
<ul>
<li><a href="https://github.com/dotnet/tye/blob/master/docs/getting_started.md" target="_blank" rel="noopener noopener noreferrer">Getting Started Tutorial</a></li>
<li><a href="https://github.com/dotnet/tye/blob/master/docs/tutorials/hello-tye/00_run_locally.md" target="_blank" rel="noopener noopener noreferrer">Hello World Tutorial</a>&nbsp;</li>
</ul>
</li>
<li>Project Announcement post : <a href="https://devblogs.microsoft.com/aspnet/introducing-project-tye/?WT.mc_id=blog-appsonazure-shboyer" target="_blank" rel="noopener noopener noreferrer">Introducing Project Tye</a></li>
<li>MS Build : <a href="https://channel9.msdn.com/Events/Build/2020/BOD105?ocid=AID3012654&amp;WT.mc_id=blog-appsonazure-shboyer" target="_blank" rel="noopener noopener noreferrer">Cloud Native Apps with .NET and AKS</a></li>
<li>MS Build: <a href="https://channel9.msdn.com/Events/Build/2020/BOD106?ocid=AID3012654&amp;WT.mc_id=blog-appsonazure-shboyer" target="_blank" rel="noopener noopener noreferrer">Journey to one .NET</a></li>
</ul>

<p>Tye is a .NET global tool and is installed using the command</p>

<pre><code>dotnet tool <span>install</span> -g Microsoft.Tye --version <span>"0.3.0-alpha.20319.3"</span></code></pre>


<p>After installing the tye global tool, we can now create and run single and multiple services using the dotnet CLI commands.</p>

<pre><code>
dotnet new razor -n frontend 


dotnet new webapi -n backend


dotnet new sln -n microservices
dotnet sln <span>add</span> frontend backend</code></pre>


<p>Typically when creating multiple applications and wanting to run them all together there is usually some Dockerfile(s) involved, references, nginx.conf files etc.</p>

<p>With tye, that is handled for you. Just use the following:</p>

<pre><code>tye run --dashboard</code></pre>


<p>Using the<em> --dashboard<strong>&nbsp;</strong></em>option automatically opens the tye dashboard web application and displayed the two applications, ports, logs and other information running.&nbsp;</p>
<p><span image-alt="image.png"><span><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/202672iE606A4514506E876/image-size/large?v=1.0&amp;px=999" title="image.png" alt="image.png" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/202672iE606A4514506E876?v=1.0" li-image-display-id="'202672iE606A4514506E876'" li-message-uid="'1502270'" li-messages-message-image="true" li-bindable="" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false" li-compiled="true"><!----></span></span></p>

<p>There is some work to be done to connect the backend and frontend applications, see <a href="https://github.com/dotnet/tye/blob/master/docs/tutorials/hello-tye/00_run_locally.md#getting-the-frontend-to-communicate-with-the-backend" target="_blank" rel="noopener noopener noreferrer">the steps here</a> for that work.</p>

<p><span size="6">Deploying your application</span></p>
<p>Once you've successfully run the applications locally, the next step is to push your services and apps to your cluster. There are a few requirements:</p>
<ul>
<li><a href="https://docs.docker.com/install/" target="_blank" rel="noopener nofollow noopener noreferrer">Docker</a> for your OS</li>
<li>Container registry for the images that are produced, tagged and pushed prior to deployment to the cluster. i.e. <a href="https://docs.microsoft.com/azure/container-registry/?WT.mc_id=blog-appsonazure-shboyer" target="_self" rel="noopener noreferrer">Azure Container Registry</a>, Docker Hub, GitHub etc.</li>
<li>A Kubernetes Cluster like <a href="https://docs.microsoft.com/azure/aks/?WT.mc_id=blog-appsonazure-shboyer" target="_self" rel="noopener noreferrer">AKS</a> for example.</li>
</ul>
<p>Once all of these are setup, use the <code>deploy</code> command with the <code>--interactive</code> option.</p>

<pre><code>tye deploy --interactive</code></pre>


<p>You'll be prompted for your container registry and if you have configured an <a href="https://github.com/dotnet/tye/blob/master/docs/recipes/ingress.md" target="_blank" rel="noopener noopener noreferrer">ingress controller</a>; you may be asked about deployment options for this as well.</p>

<p>Once complete, you can use the standard commands from kubectl to inspect pods, services and deployments.</p>

<pre><code><span>&gt;</span> kubectl get pods

NAME                                             READY   STATUS    RESTARTS   AGE
backend-ccdfd756f-xk2w2                          <span>1</span>/1     Running   <span>0</span>          5m
frontend-84dfdf4f7d-6r5vb                        <span>1</span>/1     Running   <span>0</span>          5m</code></pre>


<p>Using <code>tye deploy</code> is a quick and easy motion to publish your things to the cloud, but is it the method we'd want to continually do for production? Or even QA and Test? What would it look like to use tye and a CI/CD system together?</p>

<p><span size="6">Deploying your application with GitHub Actions</span></p>
<p>This sample uses the&nbsp;<strong>frontend/backend</strong> sample from a above but also adds an ingress controller to the cluster to expose a public IP address for the frontend application. The GitHub action will use tye in conjunction with an <a href="https://docs.microsoft.com/azure/aks/?WT.mc_id=blog-appsonazure-shboyer" target="_self" rel="noopener noreferrer">Azure Kubernetes Service (AKS)</a> cluster and <a href="https://docs.microsoft.com/azure/container-registry/?WT.mc_id=blog-appsonazure-shboyer" target="_self" rel="noopener noreferrer">Azure Container Registry (ACR)</a>.</p>

<p>Before setting up the action, create the AKS with the proper integration with the ACR instance.</p>

<pre><code>az aks create -n mytyecluster -g mytyegroup --generate-ssh-keys --attach-acr myregistry --node-count <span>3</span></code></pre>


<p>Below is the <a href="https://github.com/dotnet/tye/blob/master/docs/reference/commandline/tye-init.md" target="_blank" rel="noopener noopener noreferrer">tye.yaml</a> configuration file created using <code>tye init</code> allowing for specifying the registry name as well as the ingress instance and routes to deploy.</p>

<pre><code><span>name</span><span>:</span> microservice
<span>registry</span><span>:</span> myregistry.azurecr.io
<span>ingress</span><span>:</span>
  <span>-</span> <span>name</span><span>:</span> ingress
    <span>bindings</span><span>:</span>
      <span>-</span> <span>port</span><span>:</span> <span>8080</span>
    <span>rules</span><span>:</span>
      <span>-</span> <span>path</span><span>:</span> /
        <span>service</span><span>:</span> frontend
      <span>-</span> <span>path</span><span>:</span> /backend
        <span>service</span><span>:</span> backend
<span>services</span><span>:</span>
<span>-</span> <span>name</span><span>:</span> frontend
  <span>project</span><span>:</span> frontend/frontend.csproj
  <span>replicas</span><span>:</span> <span>2</span>
<span>-</span> <span>name</span><span>:</span> backend
  <span>project</span><span>:</span> backend/backend.csproj</code></pre>


<p><span>Running locally using&nbsp;</span><code>tye run</code><span>&nbsp;works as we'd expect, browsing the tye dashboard you should see the applications and the ingress similar to the following.</span></p>
<p><span><span image-alt="actions_recipe_dash"><span><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/202742i0FFEDB0BEF362DB5/image-size/large?v=1.0&amp;px=999" title="actions_recipe_dash" alt="actions_recipe_dash" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/202742i0FFEDB0BEF362DB5?v=1.0" li-image-display-id="'202742i0FFEDB0BEF362DB5'" li-message-uid="'1502270'" li-messages-message-image="true" li-bindable="" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false" li-compiled="true"><!----></span></span></span></p>
<p><span>GitHub Action</span></p>
<p>Setting up the GitHub Action requires a few actions to compose the complete integration.</p>
<p>First, the name of the AKS cluster, resource group, and container registry are set as Environment variables.</p>

<pre><code><span>env</span><span>:</span>
  <span>AZURE_AKS_CLUSTER</span><span>:</span> mytyecluster
  <span>AKS_RESOURCE_GROUP</span><span>:</span> mytyegroup
  <span>ACR_RESOURCE_URI</span><span>:</span> myregistry.azurecr.io</code></pre>


<p><span>Next, ensure that the version of .NET Core and tye are installed.</span></p>

<pre><code><span>-</span> <span>name</span><span>:</span> 🧰 Setup .NET Core
    <span>uses</span><span>:</span> actions/setup<span>-</span>dotnet@v1.5.0
    <span>with</span><span>:</span>
    <span>dotnet-version</span><span>:</span> 3.1.300

<span>-</span> <span>name</span><span>:</span>  Install Tye tools
    <span>run</span><span>:</span> <span>|</span><span>
    dotnet tool install -g Microsoft.Tye --version "0.2.0-alpha.20258.3"</span></code></pre>


<p><span>Using the name of the registry and the&nbsp;</span><a href="https://github.com/Azure/docker-login" target="_blank" rel="noopener noopener noreferrer">Azure docker action</a><span>&nbsp;to login to your registry. This step is needed prior to running the&nbsp;</span><code>deploy</code><span>&nbsp;command which will build and push the images to the registry.</span></p>

<pre><code><span>-</span> <span>name</span><span>:</span>  Login to ACR
    <span>uses</span><span>:</span> Azure/docker<span>-</span>login@v1  
    <span>with</span><span>:</span>  
    <span>login-server</span><span>:</span> $<span>{</span><span>{</span> env.ACR_RESOURCE_URI <span>}</span><span>}</span>
    <span>username</span><span>:</span> $<span>{</span><span>{</span> secrets.ACR_USER <span>}</span><span>}</span>  
    <span>password</span><span>:</span> $<span>{</span><span>{</span> secrets.ACR_PASSWORD <span>}</span><span>}</span></code></pre>


<p><span>Next, we need to set the current context for our AKS cluster. Use&nbsp;</span><a href="https://github.com/Azure/aks-set-context" target="_blank" rel="noopener noopener noreferrer">Azure aks-set-context action</a><span>&nbsp;for this.</span></p>

<pre><code><span>-</span> <span>name</span><span>:</span>  Set AKS context
    <span>uses</span><span>:</span> azure/aks<span>-</span>set<span>-</span>context@v1
    <span>with</span><span>:</span>
    <span>creds</span><span>:</span> <span>'${{ secrets.AZURE_CREDENTIALS }}'</span>
    <span>cluster-name</span><span>:</span> $<span>{</span><span>{</span> env.AZURE_AKS_CLUSTER <span>}</span><span>}</span>
    <span>resource-group</span><span>:</span> $<span>{</span><span>{</span> env.AKS_RESOURCE_GROUP <span>}</span><span>}</span></code></pre>


<p>When deploying manually you can use the<span>&nbsp;</span><code>--interactive</code><span>&nbsp;</span>option and the tye CLI will detect the configuration, inspect the cluster and ask/prompt for deployment. However, in this case it is automated and we need to deploy it as a part of the action.</p>

<p>We can just use a run action and apply the standard ingress from tye.</p>

<pre><code><span>-</span> <span>name</span><span>:</span>  Install ingress<span>-</span>nginx
    <span>run</span><span>:</span> <span>|</span><span>
    kubectl apply -f https://aka.ms/tye/ingress/deploy</span></code></pre>


<p>&nbsp;<span>Finally, deploy the application!</span></p>

<pre><code><span>-</span> <span>name</span><span>:</span> ☸ tye deploy
    <span>run</span><span>:</span> <span>|</span><span>
    tye deploy -v Debug</span></code></pre>


<p>The complete action looks like the following snippet:</p>

<pre><code><span>name</span><span>:</span> Build and Deploy

<span>on</span><span>:</span> <span>[</span>push<span>]</span>

<span>env</span><span>:</span>
  <span>AZURE_AKS_CLUSTER</span><span>:</span> mytyecluster
  <span>AKS_RESOURCE_GROUP</span><span>:</span> mytyegroup
  <span>ACR_RESOURCE_URI</span><span>:</span> myregistry.azurecr.io

<span>jobs</span><span>:</span>
  <span>build</span><span>:</span>
    <span>if</span><span>:</span> github.event_name == 'push' <span>&amp;&amp;</span> contains(toJson(github.event.commits)<span>,</span> '<span>***NO_CI***')</span> == false <span>&amp;&amp;</span> contains(toJson(github.event.commits)<span>,</span> '<span>[</span>ci skip<span>]</span>') == false <span>&amp;&amp;</span> contains(toJson(github.event.commits)<span>,</span> '<span>[</span>skip ci<span>]</span>') == false
    <span>name</span><span>:</span> tye deploy
    <span>runs-on</span><span>:</span> ubuntu<span>-</span>latest
    <span>steps</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> ✔ Checkout
      <span>uses</span><span>:</span> actions/checkout@v2

    <span>-</span> <span>name</span><span>:</span> 🧰 Setup .NET Core
      <span>uses</span><span>:</span> actions/setup<span>-</span>dotnet@v1.5.0
      <span>with</span><span>:</span>
        <span>dotnet-version</span><span>:</span> 3.1.300

    <span>-</span> <span>name</span><span>:</span>  Install Tye tools
      <span>run</span><span>:</span> <span>|</span><span>
        dotnet tool install -g Microsoft.Tye --version "0.3.0-alpha.20319.3"</span>

    <span>-</span> <span>name</span><span>:</span>  Login to ACR
      <span>uses</span><span>:</span> Azure/docker<span>-</span>login@v1  
      <span>with</span><span>:</span>  
        <span>login-server</span><span>:</span> $<span>{</span><span>{</span> env.ACR_RESOURCE_URI <span>}</span><span>}</span>
        <span>username</span><span>:</span> $<span>{</span><span>{</span> secrets.ACR_USER <span>}</span><span>}</span>  
        <span>password</span><span>:</span> $<span>{</span><span>{</span> secrets.ACR_PASSWORD <span>}</span><span>}</span>

    <span>-</span> <span>name</span><span>:</span>  Set AKS context
      <span>uses</span><span>:</span> azure/aks<span>-</span>set<span>-</span>context@v1
      <span>with</span><span>:</span>
        <span>creds</span><span>:</span> <span>'${{ secrets.AZURE_CREDENTIALS }}'</span>
        <span>cluster-name</span><span>:</span> $<span>{</span><span>{</span> env.AZURE_AKS_CLUSTER <span>}</span><span>}</span>
        <span>resource-group</span><span>:</span> $<span>{</span><span>{</span> env.AKS_RESOURCE_GROUP <span>}</span><span>}</span>

    <span>-</span> <span>name</span><span>:</span>  Install ingress<span>-</span>nginx
      <span>run</span><span>:</span> <span>|</span><span>
        kubectl apply -f https://aka.ms/tye/ingress/deploy</span>

    <span>-</span> <span>name</span><span>:</span> ☸ tye deploy
      <span>run</span><span>:</span> <span>|</span><span>
        tye deploy -v Debug</span></code></pre>



<p><span size="5">Viewing the deployed application</span></p>
<p>Using kubectl, look for the ingress-nginx namespace and LoadBalancer TYPE to find the external IP address for the frontend application.</p>

<pre><code><span>&gt;</span> kubectl get all -n ingress-nginx

NAME                                         TYPE           CLUSTER-IP     EXTERNAL-IP    PORT<span>(</span>S<span>)</span>                      AGE
service/ingress-nginx-controller             LoadBalancer   <span>10.0</span>.125.110   <span>52.142</span>.9.218   <span>80</span>:31128/TCP,443:31740/TCP   9m
service/ingress-nginx-controller-admission   ClusterIP      <span>10.0</span>.103.118   <span>&lt;</span>none<span>&gt;</span>         <span>443</span>/TCP                      9m

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/ingress-nginx-controller   <span>1</span>/1     <span>1</span>            <span>1</span>           9m</code></pre>


<p><span size="6">Feedback</span></p>
<p>Please file any issues on the <a href="https://github.com/dotnet/tye/issues" target="_self" rel="noopener noreferrer">dotnet/tye</a> repo, feel free to reach out to me on twitter&nbsp;<a href="https://twitter.com/spboyer" target="_self" rel="nofollow noopener noreferrer">@spboyer</a> or ask questions here in post!&nbsp;</p>
					
				
			
			
			
				
			
			
			
			
			
			
		</div>
		
		
	

	
	
</div>
	</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>