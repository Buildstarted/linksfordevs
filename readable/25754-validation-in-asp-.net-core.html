<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Validation in ASP .NET Core -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Validation in ASP .NET Core</h1>
    <div class="entry-content"> <p>This is&#xA0;the&#xA0;<strong>twenty-second&#xA0;</strong>of a&#xA0;<a href="https://wakeupandcode.com/aspnetcore/#aspnetcore2019">series of posts</a>&#xA0;on ASP .NET Core in 2019. In this series, we&#x2019;ll cover 26 topics over a span of 26 weeks from January through June 2019, titled&#xA0;<strong>A-Z of ASP .NET Core!</strong></p> <h2>In this Article:</h2> <h2>V is for Validation</h2>
<p>To build upon a previous post on <a href="https://wakeupandcode.com/forms-and-fields-in-asp-net-core/">Forms and Fields in ASP .NET Core</a>, this post covers Validation in ASP .NET Core.&#xA0;When a user submits form field values, proper validation can help build a more user-friendly and&#xA0;secure web application. Instead of coding each view/page individually, you can simply use server-side attributes in your models/viewmodels.</p>
<p><strong><span>NOTE</span></strong>: As of ASP .NET Core 2.2, validation may be skipped automatically if ASP .NET Core decides that validation is not needed. According to the <a href="https://docs.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-2.2?view=aspnetcore-2.2#validation-performance">&#x201C;What&#x2019;s New&#x201D; release notes</a>, this includes primitive collections (e.g. a byte[] array or a Dictonary&lt;string, string&gt; key-value pair collection)</p>
<p><a href="https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation.png"><img class="alignnone size-full wp-image-4071" src="https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation.png" alt="Blog-Diagram-Validation" width="1728" srcset="https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation-300x125.png 300w, https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation-1024x427.png 1024w, https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation-624x260.png 624w, https://wakeupandcode.com/wp-content/uploads/2019/06/Blog-Diagram-Validation.png 1728w" sizes="(max-width: 1728px) 100vw, 1728px"></a></p>
<p>This article will refer to the following sample code on GitHub:</p>
<p><img class="alignnone size-full wp-image-409" src="https://wakeupandcode.com/wp-content/uploads/2013/06/Network-Download-icon.png" alt="Web" width="32">&#xA0;Validation Sample App:&#xA0;<a href="https://github.com/shahedc/ValidationSampleApp">https://github.com/shahedc/ValidationSampleApp</a></p> <h2>Validation Attributes</h2>
<p>To implement model validation with [Attributes], you will typically use Data Annotations&#xA0;from the&#xA0;<a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations">System.ComponentModel.DataAnnotations</a> namespace. The list of attribute does go beyond just validation functionality though. For example, the DataType attribute takes a datatype parameter, used for inferring the data type and used for displaying the field on a view/page (but does not provide validation for the field).</p>
<p>Common attributes include the following</p>
<ul>
<li><strong>Range</strong>: lets you specify min-max values, inclusive of min and max</li>
<li><strong>RegularExpression</strong>: useful for pattern recognition, e.g. phone numbers, zip/postal codes</li>
<li><strong>Required</strong>: indicates that a field is required</li>
<li><strong>StringLength</strong>: sets the maximum length for the string entered</li>
<li><strong>MinLength</strong>: sets the minimum length of an array or string&#xA0;data</li>
</ul>
<p>From the sample code, here is an example from the <a href="https://github.com/shahedc/ValidationSampleApp/blob/master/ValidationMvc/Models/CinematicItem.cs">CinematicItem model</a>&#xA0;class:</p>
<pre>public class <strong>CinematicItem</strong> { public int <strong>Id</strong> { get; set; } <strong>[Range(1,100)]</strong> public int <strong>Score</strong> { get; set; } <strong>[Required]</strong> <strong>[StringLength(100)]</strong> public string <strong>Title</strong> { get; set; } <strong>[StringLength(255)]</strong> public string <strong>Synopsis</strong> { get; set; } [<strong>DataType</strong>(DataType.Date)] [<strong>DisplayName</strong>(&quot;Available Date&quot;)] public DateTime <strong>AvailableDate</strong> { get; set; } [<strong>Required</strong>] [<strong>DisplayName</strong>(&quot;Movie/Show/etc&quot;)] public CIType <strong>CIType</strong> { get; set; }
}</pre>
<p>From the above code, you can see that:</p>
<ul>
<li>The value for <strong>Score</strong> can be 1 or 100 or any integer in between</li>
<li>The value for <strong>Title</strong> is a required string, needs to be less than 100 characters</li>
<li>The value for <strong>Synopsis</strong> can be left blank, but has to be less than 100 characters.</li>
<li>The value for <strong>AvailableDate</strong> is displayed as &#x201C;Available Date&#x201D; (with a space)</li>
<li>Because of the <strong>DataType</strong> provided, <strong>AvailableDate</strong> is displayed as a selectable date in the browser</li>
<li>The&#xA0;value for <strong>CIType</strong> (short for Cinematic Item Type) is displayed as &#x201C;Movie/Show/etc&#x201D; and is displayed as a selectable value obtained from the CIType data type (which happens to be an enumerator. (shown below)</li>
</ul>
<pre>public enum <strong>CIType</strong>
{
   Movie,
   Series,
   Short
}</pre>
<p>Here&#x2019;s what it looks like in a browser when validation fails:</p>
<p><a href="https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors.png"><img class="alignnone size-full wp-image-4072" src="https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors.png" alt="Validation-Fields-Errors" width="1993" srcset="https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors-300x196.png 300w, https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors-1024x671.png 1024w, https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors-624x409.png 624w, https://wakeupandcode.com/wp-content/uploads/2019/06/Validation-Fields-Errors.png 1993w" sizes="(max-width: 1993px) 100vw, 1993px"></a></p>
<p>The validation rules make it easier for the user to correct their entries before submitting the form.</p> <h2>Server-Side Validation</h2>
<p>Validation occurs before an MVC controller action (or equivalent handler method for Razor Pages) takes over. As a result, you should check to see if the validation has passed before continuing next steps.</p>
<p>e.g. in an MVC controller</p>
<pre>[<strong>HttpPost</strong>] [<strong>ValidateAntiForgeryToken</strong>] public async Task&lt;IActionResult&gt; <strong>Create</strong>(...) { if (<strong>ModelState.IsValid</strong>)
   {
      // ... 
      return RedirectToAction(nameof(Index));
   }
   return View(cinematicItem);
}</pre>
<p>e.g. in a Razor Page&#x2019;s handler code:</p>
<pre>public async Task&lt;IActionResult&gt; <strong>OnPostAsync</strong>() { if (!<strong>ModelState.IsValid</strong>)
   {
      return Page();
   }

   //... 
   return RedirectToPage(&quot;./Index&quot;);
}</pre>
<p>Note that <strong>ModelState</strong>.<strong>IsValid</strong> is checked in both the <strong>Create</strong>() action method of an MVC Controller&#xA0;or the <strong>OnPostAsync</strong>() handler method of a Razor Page&#x2019;s handler code. If <strong>IsValid</strong> is true, perform actions as desired. If false, reload the current view/page as is.</p> <h2>Client-Side Validation</h2>
<p>It goes without saying that you should always have server-side validation. All the client-side validation in the world won&#x2019;t prevent a malicious user from sending a GET/POST request to your form&#x2019;s endpoint. Cross-site request forgery in the <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/working-with-forms#the-form-tag-helper">Form tag helper</a> does provide&#xA0;a certain level of protection, but you still need server-side validation. That being said, client-side validation helps to catch the problem before your server receives the request, while providing a better user experience.</p>
<p>When you create a new ASP .NET Core project using one of the built-in templates, you should see a shared partial view called&#xA0;<a href="https://github.com/shahedc/ValidationSampleApp/blob/master/ValidationMvc/Views/Shared/_ValidationScriptsPartial.cshtml">_ValidationScriptsPartial.cshtml</a>. This partial view should include references to <a href="https://github.com/aspnet/jquery-validation-unobtrusive">jQuery unobtrusive validation</a>, as shown below:</p>
<pre>&lt;environment include=&quot;Development&quot;&gt; &lt;script src=&quot;~/lib/jquery-validation/dist/<strong>jquery.validate.js</strong>&quot;&gt;&lt;/script&gt; &lt;script src=&quot;~/lib/jquery-validation-unobtrusive/<strong>jquery.validate.unobtrusive.js</strong>&quot;&gt;&lt;/script&gt;
&lt;/environment&gt;</pre>
<p>If you create a scaffolded controller with views/pages, you should see the following reference at the bottom of your page or view.</p>
<p>e.g. at the bottom of <a href="https://github.com/shahedc/ValidationSampleApp/blob/master/ValidationMvc/Views/CinematicItem/Create.cshtml">Create.cshtml</a> view</p>
<pre>@section Scripts { @{await Html.RenderPartialAsync(&quot;<strong>_ValidationScriptsPartial</strong>&quot;);}
}</pre>
<p>e.g. at the bottom of the <a href="https://github.com/shahedc/ValidationSampleApp/blob/master/ValidationRazor/Pages/CinematicItems/Create.cshtml">Create.cshtml</a> page</p>
<pre>@section Scripts { @{await Html.RenderPartialAsync(&quot;<strong>_ValidationScriptsPartial</strong>&quot;);}
}</pre>
<p>Note that the syntax is identical whether it&#x2019;s an MVC view or a Razor page. That being said, you may want to disable client-side validation. This is accomplished in different ways, whether it&#x2019;s for an MVC view or a Razor page.</p>
<p>From the official <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-2.2#disable-client-side-validation">docs</a>, the following code should be used within the <strong>ConfigureServices</strong>() method of your Startup.cs&#xA0;class, to set <strong>ClientValidationEnabled</strong> to false in your HTMLHelperOptions configuration.</p>
<pre>services.<strong>AddMvc</strong>().<strong>AddViewOptions</strong>(options =&gt; { if (_env.IsDevelopment()) { options.HtmlHelperOptions.<strong>ClientValidationEnabled</strong> = false;
   }
});</pre>
<p>Also mentioned in the official docs, the following code can be used for your Razor Pages, within the <strong>ConfigureServices</strong>() method of your Startup.cs class.</p>
<pre>services.Configure&lt;<strong>HtmlHelperOptions</strong>&gt;(o =&gt; o.<strong>ClientValidationEnabled</strong> = false);</pre> <h2>Client to Server with Remote Validation</h2>
<p>If you need to call a server-side method while performing client-side validation, you can&#xA0;use the [<strong>Remote</strong>] attribute on a model property. You would then pass it the name of a server-side action method which returns an <strong>IActionResult&#xA0;</strong>with a true boolean result for a valid field. This [<strong>Remote</strong>] attribute is available in the&#xA0;Microsoft.AspNetCore.Mvc namespace, from the&#xA0;<a href="https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.ViewFeatures">Microsoft.AspNetCore.Mvc.ViewFeatures</a> NuGet package.</p>
<p>The model property would look something like this:</p>
<pre>[<strong>Remote</strong>(action: &quot;<strong>MyActionMethod</strong>&quot;, controller: &quot;<strong>MyControllerName</strong>&quot;)] public string <strong>MyProperty</strong> { get; set; }</pre>
<p>In the controller class, (e.g.&#xA0;<strong>MyControllerName</strong>),&#xA0;you would define an action method with the name specified in the [<strong>Remote</strong>] attribute parameters, e.g. <strong>MyActionMethod.&#xA0;</strong></p>
<pre>[<strong>AcceptVerbs</strong>(&quot;Get&quot;, &quot;Post&quot;)] public IActionResult <strong>MyActionMethod</strong>(...) { if (TestForFailureHere()) { return <strong>Json</strong>(&quot;Invalid Error Message&quot;); } return <strong>Json(true)</strong>;
}</pre>
<p>You may notice that if the validation fails, the controller action method returns a JSON response with an appropriate error message in a string. Instead of a text string, you can also use a false, null, or undefined value to indicate an invalid result. If validation has passed, you would use <strong>Json(true)</strong> to indicate that the validation has passed.</p>
<p><em>So, when would you actually use something like this?</em> Any scenario where a selection/entry needs to be validated by the server can&#xA0;provide a better user experience by providing a result as the user is typing, instead of waiting for a form submission. For example: imagine that a user is buying online tickets for an event, and&#xA0;selecting a seat number displayed on a seating chart. The selected seat could then be displayed in an input field and then sent back to the server to determine whether the seat is still available or not.</p> <h2>Custom Attributes</h2>
<p>In addition to all of the above, you can simply build your own custom attributes. If you take a look at the classes for the built-in attributes, e.g. <a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations.requiredattribute">RequiredAttribute</a>, you will notice that they also extend the same parent class:</p>
<ul>
<li>System.ComponentModel.DataAnnotations.ValidationAttribute</li>
</ul>
<p><span class="hljs-keyword">You can do the same thing with your custom attribute&#x2019;s class definition:</span></p>
<pre><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <strong><span class="hljs-title">MyCustomAttribute</span></strong>: <span class="hljs-title">ValidationAttribute</span> 
{
   // ...
}</pre>
<p>The parent class <a href="https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations.validationattribute">ValidationAttribute</a>, has a virtual <strong>IsValid</strong>() method that you can override to return whether validation has been calculated successfully (or not).</p>
<pre><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <strong><span class="hljs-title">MyCustomAttribute</span></strong>: <strong><span class="hljs-title">ValidationAttribute</span> </strong> { // ... protected override ValidationResult <strong>IsValid</strong>( object value, ValidationContext validationContext) { if (TestForFailureHere()) { <span class="hljs-keyword"> return</span> <span class="hljs-keyword">new</span> <strong>ValidationResult</strong>(&quot;Invalid Error Message&quot;); } <span class="hljs-keyword">return</span> <strong>ValidationResult.Success</strong>;
   }
}</pre>
<p>You may notice that if the validation fails, the&#xA0;<strong>IsValid(</strong>) method returns a <strong>ValidationResult</strong>() with an appropriate error message in a string. If validation has passed, you would&#xA0;return&#xA0;<strong>ValidationResult.Success</strong>&#xA0;to indicate that the validation has passed.</p> <h2>References</h2> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>