<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Building ASP.NET Core 3.1 Apps To Organizational Standards Using Extension Methods -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Building ASP.NET Core 3.1 Apps To Organizational Standards Using Extension Methods</h1><div><div id="" class=""><p class="freshness" data-freshness-datetime="2020-01-22T09:00:00-05:00"><i class="icon heartbeat freshness-icon-js"></i><em>This post is <span class="freshness-days-old-js"></span> days old.</em></p><p>We’ve been working through upgrading our core applications from ASP.NET full framework to ASP.NET Core. Over the years we’ve assembled an opinionated library for assembling full framework APIs named <code class="language-plaintext highlighter-rouge">RimDev.WebApi</code>. It includes various items to aid our team in building consistent API experiences without needing to reinvent the wheel in each repository. With migrating to ASP.NET Core 3.1 we need to keep this same functionality where it impacts responses.</p><p>As we were working through this upgrade <a href="/authors/khalid-abuhakmeh/">Khalid Abuhakmeh</a> had a great idea – rather than baking everything into methods like <code class="language-plaintext highlighter-rouge">.AddRimDev()</code> and <code class="language-plaintext highlighter-rouge">.UseRimDev()</code> we should create a collection of incremental building blocks that apps can use (or, not use). This strategy helped us get to the finish line.</p><p>Here’s an example:</p><div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span><span class="nn">Microsoft.AspNetCore.Builder</span><span class="p">;</span><span class="k">using</span><span class="nn">Microsoft.AspNetCore.Hosting</span><span class="p">;</span><span class="k">using</span><span class="nn">Microsoft.Extensions.Configuration</span><span class="p">;</span><span class="k">using</span><span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span><span class="k">using</span><span class="nn">RimDev.AspNetCore</span><span class="p">;</span><span class="k">namespace</span><span class="nn">SampleApi</span><span class="p">{</span><span class="k">public</span><span class="k">class</span><span class="nc">Startup</span><span class="p">{</span><span class="k">private</span><span class="k">readonly</span><span class="n">IWebHostEnvironment</span><span class="n">env</span><span class="p">;</span><span class="k">private</span><span class="k">readonly</span><span class="n">IConfiguration</span><span class="n">configuration</span><span class="p">;</span><span class="k">public</span><span class="nf">Startup</span><span class="p">(</span><span class="n">IWebHostEnvironment</span><span class="n">env</span><span class="p">,</span><span class="n">IConfiguration</span><span class="n">configuration</span><span class="p">)</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="n">env</span><span class="p">=</span><span class="n">env</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="n">configuration</span><span class="p">=</span><span class="n">configuration</span><span class="p">;</span><span class="p">}</span><span class="k">public</span><span class="k">void</span><span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span><span class="n">services</span><span class="p">)</span><span class="p">{</span><span class="kt">var</span><span class="n">authPolicy</span><span class="p">=</span><span class="n">AppAuthorization</span><span class="p">.</span><span class="nf">GetRitterRequireScopesAuthorizationPolicy</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span><span class="n">services</span><span class="p">.</span><span class="nf">AddRouting</span><span class="p">()</span><span class="p">.</span><span class="nf">AddApplicationInsightsWithRimDevFilters</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="p">.</span><span class="nf">AddRimDevDistributedDataProtection</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="n">configuration</span><span class="p">)</span><span class="p">.</span><span class="nf">AddRitterApiAuthentication</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="c1">// .AddRitterCookieAuthentication(configuration)</span><span class="p">.</span><span class="nf">AddStandardRitterConfiguration</span><span class="p">(</span><span class="cm">/* authPolicy: authPolicy, */</span><span class="n">hostAssembly</span><span class="p">:</span><span class="k">typeof</span><span class="p">(</span><span class="n">Startup</span><span class="p">).</span><span class="n">Assembly</span><span class="p">)</span><span class="p">.</span><span class="nf">AddEnrichers</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Startup</span><span class="p">).</span><span class="n">Assembly</span><span class="p">);</span><span class="p">}</span><span class="k">public</span><span class="k">void</span><span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span><span class="n">app</span><span class="p">,</span><span class="n">IWebHostEnvironment</span><span class="n">env</span><span class="p">)</span><span class="p">{</span><span class="n">app</span><span class="p">.</span><span class="nf">UseRouting</span><span class="p">()</span><span class="p">.</span><span class="nf">UseAuthentication</span><span class="p">()</span><span class="p">.</span><span class="nf">UseAuthorization</span><span class="p">()</span><span class="p">.</span><span class="nf">UseStandardRitterConfiguration</span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="p">.</span><span class="nf">UseEndpoints</span><span class="p">(</span><span class="n">endpoints</span><span class="p">=&gt;</span><span class="p">{</span><span class="n">endpoints</span><span class="p">.</span><span class="nf">MapGitHash</span><span class="p">(</span><span class="n">env</span><span class="p">);</span><span class="n">endpoints</span><span class="p">.</span><span class="nf">MapSelfInfo</span><span class="p">();</span><span class="n">endpoints</span><span class="p">.</span><span class="nf">MapDefaultControllerRoute</span><span class="p">();</span><span class="p">});</span><span class="p">}</span><span class="p">}</span><span class="p">}</span></code></pre></div></div><p>This strategy keeps control in the hands of application developers to include or not include certain functionality. It’s also much easier to reason about and follow along if you’re unfamiliar with all the facets of our typical strategies.</p><p><code class="language-plaintext highlighter-rouge">AddStandardRitterConfiguration</code> / <code class="language-plaintext highlighter-rouge">UseStandardRitterConfiguration</code> includes things we <strong>always</strong> want: HTTPS, HSTS, <code class="language-plaintext highlighter-rouge">UseDeveloperExceptionPage()</code> in development, CORS, FluentValidation, returning HTTP 422 for validation failures, etc. Wondering whether we have handling for multiple instances? <code class="language-plaintext highlighter-rouge">AddRimDevDistributedDataProtection(env, configuration)</code> covers that with our typical strategy. What special endpoints might be wired up? It’s visible inside <code class="language-plaintext highlighter-rouge">UseEndpoints</code>. Functionality is more discoverable this way.</p><p><strong>Individual extension methods give application developers a better opportunity for success as the individiual components can be easily deconstructed as needed.</strong></p><div class="articles-footer"><time class="ui horizontal divider center aligned">Published Jan 22, 2020 by</time></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>