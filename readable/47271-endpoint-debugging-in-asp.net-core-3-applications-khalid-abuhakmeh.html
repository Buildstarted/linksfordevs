<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Endpoint Debugging in ASP.NET Core 3 Applications | Khalid Abuhakmeh -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Endpoint Debugging in ASP.NET Core 3 Applications  |
      Khalid Abuhakmeh</h1><div><div class="post-content"><p>Nothing can be more frustrating than going into a situation <em>“thinking”</em> you know how a framework works, only to spend the next several hours pulling your hair out and stewing in a pot of unhealthy feelings. I like to consider myself an ASP.NET routing expert with my experience dating back to MVC 1.0. Recently, I’ve started using ASP.NET Core Razor Pages mixed in with MVC and API approaches. I find the combination of all this technology to be a winning one, but it can also add complexity when building views. In this post, <strong>I’ll show you a simple one page Razor Page that can help diagnose route resolution issues quickly.</strong> Quickly see what your ASP.NET Core application sees and what it requires to resolve routes.</p><h2 id="endpoint-routing">Endpoint Routing</h2><p>With .NET Core 3, the responsibility of routing is on the shoulders of the <code class="highlighter-rouge">EndpointMiddlware</code> component. Registrations of the approaches described above, MVC, Razor Pages, and API occur in the <code class="highlighter-rouge">Configure</code> method of the <code class="highlighter-rouge">Startup</code> class. Below, you’ll see the registration of all Razor Pages endpoints.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="p">.</span><span class="nf">UseEndpoints</span><span class="p">(</span><span class="n">endpoints</span><span class="p">=&gt;</span><span class="p">{</span><span class="n">endpoints</span><span class="p">.</span><span class="nf">MapRazorPages</span><span class="p">();</span><span class="p">});</span></code></pre></div></div><p>The method scans the project for all Razor Pages and registers them as individual endpoints. Cool right?</p><p>What you may not realize is that each registration goes into a global bank of endpoints. This data source of endpoints is called the <code class="highlighter-rouge">EndpointDataSource</code>. Luckily, this data source is also registered (on the down-low) with your dependency injection container. The endpoint data source will be critical for our solution.</p><h2 id="solution">Solution</h2><p>When generating links within your application, you’ll end up using helper methods from <code class="highlighter-rouge">Url</code> and <code class="highlighter-rouge">Html</code>.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span><span class="na">class=</span><span class="s">"dropdown-item"</span><span class="na">href=</span><span class="s">"@Url.Page("</span><span class="err">/</span><span class="na">Admin</span><span class="err">/</span><span class="na">Conferences</span><span class="err">/</span><span class="na">Index</span><span class="err">")"</span><span class="nt">&gt;</span>Conferences<span class="nt">&lt;/a&gt;</span><span class="c">&lt;!-- or --&gt;</span><span class="nt">&lt;a</span><span class="na">href=</span><span class="s">"@Url.Page("</span><span class="err">/</span><span class="na">Admin</span><span class="err">/</span><span class="na">Conferences</span><span class="err">/</span><span class="na">Edit</span><span class="err">",</span><span class="na">new</span><span class="err">{</span><span class="err">@</span><span class="na">conference</span><span class="err">.</span><span class="na">Id</span><span class="err">})"</span><span class="na">role=</span><span class="s">"button"</span><span class="nt">&gt;</span>
    Edit
<span class="nt">&lt;/a&gt;</span></code></pre></div></div><p>If you’re like me, you may forget to add a critical route value, which causes ASP.NET Core to give up on route generation. I’ve found the best way to debug these situations, is to see <em>what</em> routes are registered. To do that, I’ve built a Razor page that you can drop into your project right now and get more information. I named my page <code class="highlighter-rouge">_routes.cshtml</code>, and the code-behind is unnecessary.</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@page
@using Microsoft.AspNetCore.Mvc.ApplicationModels
@using Microsoft.AspNetCore.Mvc.RazorPages
@using Microsoft.AspNetCore.Routing
@inject EndpointDataSource EndpointsDataSource

@{
    var endpoints = EndpointsDataSource.Endpoints.ToList();
}

<span class="nt">&lt;table</span><span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span><span class="nt">&lt;thead</span><span class="na">class=</span><span class="s">"thead-dark"</span><span class="nt">&gt;</span><span class="nt">&lt;tr&gt;</span><span class="nt">&lt;th</span><span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Order<span class="nt">&lt;/th&gt;</span><span class="nt">&lt;th</span><span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Display Name<span class="nt">&lt;/th&gt;</span><span class="nt">&lt;th</span><span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Route Pattern<span class="nt">&lt;/th&gt;</span><span class="nt">&lt;th</span><span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Metadata<span class="nt">&lt;/th&gt;</span><span class="nt">&lt;/tr&gt;</span><span class="nt">&lt;/thead&gt;</span><span class="nt">&lt;tbody&gt;</span>
    @foreach (var endpoint in endpoints)
    {
        var routeEndpoint = endpoint as RouteEndpoint;
        <span class="nt">&lt;tr&gt;</span><span class="nt">&lt;td&gt;</span>@routeEndpoint?.Order<span class="nt">&lt;/td&gt;</span><span class="nt">&lt;td&gt;</span>@endpoint.DisplayName<span class="nt">&lt;/td&gt;</span><span class="nt">&lt;td&gt;</span>@routeEndpoint?.RoutePattern.RawText<span class="nt">&lt;/td&gt;</span><span class="nt">&lt;td&gt;</span><span class="nt">&lt;ul&gt;</span>
                    @foreach (var md in endpoint.Metadata)
                    {
                        switch (md)
                        {
                            case PageRouteMetadata prm:
                                <span class="nt">&lt;li&gt;</span><span class="nt">&lt;p&gt;</span>@nameof(PageRouteMetadata)<span class="nt">&lt;/p&gt;</span><span class="nt">&lt;ul&gt;</span><span class="nt">&lt;li&gt;</span>Page Route: @prm.PageRoute<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;li&gt;</span>Route Template: @prm.RouteTemplate<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;/ul&gt;</span><span class="nt">&lt;/li&gt;</span>
                                break;
                            case PageActionDescriptor pad:
                                <span class="nt">&lt;li&gt;</span><span class="nt">&lt;p&gt;</span>@nameof(PageActionDescriptor)<span class="nt">&lt;/p&gt;</span><span class="nt">&lt;ul&gt;</span><span class="nt">&lt;li&gt;</span>Id: @pad.Id<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;li&gt;</span>Area: @pad.AreaName<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;li&gt;</span>Display Name: @pad.DisplayName<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;li&gt;</span>View Engine Path: @pad.ViewEnginePath<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;li&gt;</span>Relative Path: @pad.RelativePath<span class="nt">&lt;/li&gt;</span><span class="nt">&lt;/ul&gt;</span><span class="nt">&lt;/li&gt;</span>
                                break;
                            case RouteNameMetadata rnm:
                                <span class="nt">&lt;li&gt;</span>
                                    Route Name Metadata: @rnm.RouteName
                                <span class="nt">&lt;/li&gt;</span>
                                break;
                            case SuppressLinkGenerationMetadata slg:
                                <span class="nt">&lt;li&gt;</span>
                                    suppress link: @slg.SuppressLinkGeneration;
                                <span class="nt">&lt;/li&gt;</span>
                                break;
                            default:
                                <span class="nt">&lt;li&gt;</span>@md.ToString()<span class="nt">&lt;/li&gt;</span>
                                break;
                        }
                    }
                <span class="nt">&lt;/ul&gt;</span><span class="nt">&lt;/td&gt;</span><span class="nt">&lt;/tr&gt;</span>
    }
    <span class="nt">&lt;/tbody&gt;</span><span class="nt">&lt;/table&gt;</span></code></pre></div></div><p>And here is what it looks like when you visit the page.</p><p><img src="https://d33wubrfki0l68.cloudfront.net/9ff858c94577970d7abe3cdf85ecf01305977017/dffb7/assets/images/generated/routes/debugger-800-121f65.png" srcset="https://d33wubrfki0l68.cloudfront.net/a15e658c57b70c59b85942b6e6c7002df0438467/7afba/assets/images/generated/routes/debugger-400-121f65.png 400w, https://d33wubrfki0l68.cloudfront.net/baf09d97e8a77b8d3dd49819ffcec918312c9659/a7911/assets/images/generated/routes/debugger-600-121f65.png 600w, https://d33wubrfki0l68.cloudfront.net/9ff858c94577970d7abe3cdf85ecf01305977017/dffb7/assets/images/generated/routes/debugger-800-121f65.png 800w, https://d33wubrfki0l68.cloudfront.net/0c812388df96cfe32a8e6f280fce1d7c57b9524a/b7f4b/assets/images/generated/routes/debugger-1000-121f65.png 1000w"></p><p>Awesome right?!</p><h2 id="more-endpoint-information">More Endpoint Information</h2><p>The exciting part of debugging endpoints is that there is a treasure trove of information for each route. You can see what required parameters exist for each route, the expected name for resolution, the view engine path, and much more. The debugger in this post was written to diagnose Razor Page issues, but will also work with any library that registers an endpoint.</p><h2 id="conclusion">Conclusion</h2><p>ASP.NET Core routing is powerful but can be a bit of a black box. Understanding where routes are registered and how you can debug them can save you hours of frustration. Understanding that all endpoints are registered globally and can be accessed via an <code class="highlighter-rouge">EndpointDataSource</code> makes the task of debugging much more straightforward. I hope this post has helped, and please feel free to leave a comment.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>