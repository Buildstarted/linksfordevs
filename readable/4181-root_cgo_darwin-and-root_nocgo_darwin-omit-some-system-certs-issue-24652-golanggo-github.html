<!DOCTYPE html>
<html lang="en">
<head>
    <title>
root_cgo_darwin and root_nocgo_darwin omit some system certs &#xB7; Issue #24652 &#xB7; golang/go &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>root_cgo_darwin and root_nocgo_darwin omit some system certs · Issue #24652 · golang/go · GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><p>OK, performed more digging and diagnostics.</p><p>Here's the overview of my state with the current Go:</p><pre><code>No CGo certs: 176
CGo certs: 161

0 CGo only, 15 non-CGo only, 161 common
</code></pre><p>After running with my modification proposed above, I get:</p><pre><code>No CGo certs: 176
CGo certs: 164

1 CGo only, 13 non-CGo only, 163 common
</code></pre><p>I ran your parsing tool on my output, and indeed for some reason there are 3 certificates that explicitly have an empty trust settings set (only showing one here):</p><pre><code>hash=00C337EA issuer="CN=MSCA-ROOT-01-CA" trustSettings=map[string]string{}
</code></pre><p>I'm not sure how this entry was created for me, but that's clearly the issue. Two of these certificates are valid and are added, and thus increment the "common" count by 2. One of these certificates is expired. This one appears only in the CGo code, which accounts for the "1 CGo only".</p><p>Here are some of the certificates that show up only for non-CGo (out of the 13):</p><pre><code>        Apple Worldwide Developer Relations Certification Authority
        Developer ID Certification Authority
        DigiCert Assured ID CA-1
        DigiCert SHA2 Assured ID CA
        DigiCert SHA2 High Assurance Server CA
</code></pre><p>2 of these have an entry in my <code>user-trust.plist</code> with <code>trustSettings=map[string]string{"kSecTrustSettingsResult":"-2147409654"}</code>:</p><pre><code>hash=20744DE6 issuer="CN=DigiCert SHA2 High Assurance Server CA,OU=www.digicert.com,O=DigiCert Inc,C=US" trustSettings=map[string]string{"kSecTrustSettingsResult":"-2147409654"}
</code></pre><p>None of the other entries show up in my plist. In the keychain, these show up as "no value specified" for trust:</p><p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/4267425/38322454-519fee5a-37ef-11e8-84a9-0556e672d198.png"><img src="https://user-images.githubusercontent.com/4267425/38322454-519fee5a-37ef-11e8-84a9-0556e672d198.png" alt="image"></a></p><p>The one curious thing is the extra certificate that shows up for CGo only after the local modification. That certificate is an old CA certificate I have that is expired:</p><p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/4267425/38322527-825a96d0-37ef-11e8-9ca3-26c27ba29c27.png"><img src="https://user-images.githubusercontent.com/4267425/38322527-825a96d0-37ef-11e8-9ca3-26c27ba29c27.png" alt="image"></a></p><p>It's showing up because before the modification it was in my <code>admin-trust.plist</code> with <code>map[string]string{}</code> as the trustSettings, so the change now includes it. I'm guessing the non-CGo code automatically prunes it based on expiration.</p><p>I don't <em>think</em> this should be an issue since even if the cert is added as a root cert, any code that does validation should properly check the expiration status.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>