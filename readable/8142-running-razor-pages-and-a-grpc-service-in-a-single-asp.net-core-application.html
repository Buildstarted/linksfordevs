<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Running Razor Pages and a gRPC service in a single ASP.NET Core application -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Running Razor Pages and a gRPC service in a single ASP.NET Core application</h1><div><div class="entry-content"><p>This article shows how ASP.NET Core Razor Pages can be run in the same application as a gRPC service. </p><p><strong>Code:</strong><a href="https://github.com/damienbod/Secure_gRpc" rel="nofollow">https://github.com/damienbod/Secure_gRpc</a></p><p><strong>Posts in this series</strong></p><p><strong>History</strong></p><p><strong>2019-12-17:</strong> Updated Nuget packages, .NET Core 3.1, updated grpc implementations<br><strong>2019-09-06:</strong> Updated Nuget packages, .NET Core 3 preview 9<br><strong>2019-08-13:</strong> Updated Nuget packages, .NET Core 3 preview 8<br><strong>2019-07-28:</strong> Updated Nuget packages, .NET Core 3 preview 7</p><p><strong>Adding Razor Pages to an existing gRPC service</strong></p><p>This demo is built using the code created in the previous <a href="https://damienbod.com/2019/03/06/security-experiments-with-grpc-and-asp-net-core-3-0/">post</a>, which is pretty much the gRPC code created from the ASP.NET Core 3.0 templates.</p><p>To support both Razor Pages and gRPC services hosted using a single Kestrel server, both HTTP and HTTP2 needs to be supported. This is done in the Program class of the application using a ConfigureKestrel method. Set the Protocols property to HttpProtocols.Http1AndHttp2.</p><pre class="brush: csharp; title: ; notranslate" title="">public static IHostBuilder CreateHostBuilder(string[] args) =&gt;
 Host.CreateDefaultBuilder(args)
   .ConfigureWebHostDefaults(webBuilder =&gt;
   {
	webBuilder.UseStartup&lt;Startup&gt;()
	.ConfigureKestrel(options =&gt;
	{
		options.Limits.MinRequestBodyDataRate = null;
		options.ListenLocalhost(50051, listenOptions =&gt;
		{
			listenOptions.UseHttps("server.pfx", "1111");
			listenOptions.Protocols = HttpProtocols.Http1AndHttp2;
		});
	});
   });
</pre><p>Now we need to add the MVC middleware and also the Newtonsoft JSON Nuget package ( <em>Microsoft.AspNetCore.Mvc.NewtonsoftJson</em> ) as this is no longer in the default Nuget packages in ASP.NET Core 3.0. You need to add the Nuget package to the project.</p><p>Then add the MVC middleware.</p><pre class="brush: csharp; title: ; notranslate" title="">public void ConfigureServices(IServiceCollection services)
{
	...

	services.AddGrpc(options =&gt;
	{
		options.EnableDetailedErrors = true;
	});

	services.AddMvc()
	   .AddNewtonsoftJson();
}
</pre><p>In the configure method, the static files middleware need to be added so that the css and the Javascript will be supported. The Razor Pages are then added to the routing.</p><pre class="brush: csharp; title: ; notranslate" title="">public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
	...

	app.UseStaticFiles();

	app.UseRouting(routes =&gt;
	{
		routes.MapGrpcService&lt;GreeterService&gt;();
		   
		routes.MapRazorPages();
	});

}
</pre><p>Add the Razor Pages to the application and also the css, Javascript files inside the wwwroot.</p><p>And now both application types are running, hosted on Kestrel in the same APP which is really cool.</p><p><img data-attachment-id="12099" data-permalink="https://damienbod.com/2019/03/08/running-razor-pages-and-a-grpc-service-in-a-single-asp-net-core-application/secure_grpc_pr_03/" data-orig-file="https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png" data-orig-size="1128,796" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Secure_gRpc_PR_03" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=640" src="https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=640&amp;h=452" alt="" width="640" height="452" class="alignnone size-full wp-image-12099" srcset="https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=640&amp;h=452 640w, https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=150&amp;h=106 150w, https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=600&amp;h=423 600w, https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=768&amp;h=542 768w, https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png?w=1024&amp;h=723 1024w, https://damienbod.files.wordpress.com/2019/03/secure_grpc_pr_03.png 1128w" sizes="(max-width: 640px) 100vw, 640px"></p><p><strong>Links:</strong></p><p><a href="https://github.com/grpc/grpc-dotnet/" rel="nofollow">https://github.com/grpc/grpc-dotnet/</a></p><p><a href="https://grpc.io/" rel="nofollow">https://grpc.io/</a></p><blockquote class="wp-embedded-content" data-secret="CVWPtzID3D"><p><a href="https://www.stevejgordon.co.uk/early-look-at-grpc-using-aspnet-core-3">An Early Look at gRPC and ASP.NET Core 3.0</a></p></blockquote><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><h3 class="jp-relatedposts-headline"><em>Related</em></h3></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>