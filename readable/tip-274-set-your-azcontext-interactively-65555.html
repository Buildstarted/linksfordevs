<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Tip 274 - Set Your AzContext Interactively - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Tip 274 - Set Your AzContext Interactively - linksfor.dev(s)"/>
    <meta property="og:description" content="If you are working with Azure, the probability of you having multiple accounts and subscriptions to work with are very high. If I look at myself, I have a personal account, a business account and my workaccount that I often use everyday. Deploying scripts through Powershell requires you to make sure you are in the right context. Especially with the rise of Azure Lighthouse, where you maybe have access to a lot of subscriptions through one account, a simple mistake is easily made."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://microsoft.github.io/AzureTipsAndTricks/blog/tip274.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Tip 274 - Set Your AzContext Interactively</title>
<div class="readable">
        <h1>Tip 274 - Set Your AzContext Interactively</h1>
            <div>Reading time: 3-4 minutes</div>
        <div>Posted here: 12 Aug 2020</div>
        <p><a href="https://microsoft.github.io/AzureTipsAndTricks/blog/tip274.html">https://microsoft.github.io/AzureTipsAndTricks/blog/tip274.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-v-0e4468e2=""><h2 id="azure-contexts-in-powershell"> Azure Contexts in Powershell</h2> <p>If you are working with Azure, the probability of you having multiple accounts and subscriptions to work with are very high. If I look at myself, I have a personal account, a business account and my workaccount that I often use everyday. Deploying scripts through Powershell requires you to make sure you are in the right context. Especially with the rise of Azure Lighthouse, where you maybe have access to a lot of subscriptions through one account, a simple mistake is easily made.</p> <h2 id="switching-between-accounts"> Switching between accounts</h2> <p>The workflow I previously used for executing Powershell scripts was to Disconnect all accounts, logging in with the right one and setting the right subscription with Set-AzContext. It works, but takes a lot of time. To reduce the time I need for switching between contexts, I wrote a simple script which works as follows:</p> <ul><li>It will list all your connected Contexts through Get-AzContext -List</li> <li>You choose an account (No input defaults to 0)</li> <li>It will list all the Enabled Subscriptions accessible through the selected account</li> <li>You choose a subscription (No input defaults to 0)</li> <li>The context will be set</li></ul> <h2 id="how-to-use-it"> How to use it</h2> <p>To access the function everywhere, you can add it to you Powershell profile. By running $profile within powershell you can determine the location of your PowerShell Profile. Prefixing the variable with your favorite editor will open the profile directly. For example:</p> <h2 id="the-code"> The code</h2> <p>Add the following code to your profile:</p> <div><pre><code><span>function</span> azc <span>{</span>
    <span>$allContexts</span> = <span>(</span>Get<span>-</span>AzContext <span>-</span>List <span>|</span> <span>Sort-Object</span> Account<span>)</span>
    <span>$contextArray</span> = @<span>(</span><span>)</span>
    <span>$contextEmailArray</span> = @<span>(</span><span>)</span>
    <span>$contextCount</span> = 0

    <span>Write-Host</span> <span>""</span>
    <span>Foreach</span><span>(</span><span>$context</span> in <span>$allContexts</span><span>)</span><span>{</span>
        <span>if</span><span>(</span><span>!</span><span>$contextEmailArray</span><span>.</span>Contains<span>(</span><span>$context</span><span>.</span>Account<span>.</span>Id<span>)</span><span>)</span><span>{</span>
            <span>$contextArray</span> <span>+=</span> <span>$context</span>
            <span>$contextEmailArray</span> <span>+=</span> <span>$context</span><span>.</span>Account<span>.</span>Id
            <span>Write-Host</span> <span>(</span><span>"["</span> <span>+</span> <span>$contextCount</span> <span>+</span> <span>"] - "</span> <span>+</span> <span>$context</span><span>.</span>Account<span>)</span>
            <span>$contextCount</span>+<span>+</span>
        <span>}</span>
    <span>}</span>

    <span>if</span> <span>(</span><span>!</span><span>(</span><span>$contextInput</span> = <span>Read-Host</span> <span>"Select Context"</span><span>)</span><span>)</span> <span>{</span> <span>$contextInput</span> = 0 <span>}</span>
    <span>$setContext</span> = <span>Set</span><span>-</span>AzContext  <span>-</span>Context <span>$contextArray</span><span>[</span><span>$contextInput</span><span>]</span>

    <span>$allSubscriptions</span> = <span>(</span>Get<span>-</span>AzSubscription <span>|</span> <span>Where-Object</span> <span>{</span><span>$_</span><span>.</span>State <span>-eq</span> <span>"Enabled"</span><span>}</span> <span>|</span> <span>Sort-Object</span> Name<span>)</span>
    <span>$subscriptionArray</span> = @<span>(</span><span>)</span>
    <span>$subscriptionCount</span> = 0

    <span>foreach</span><span>(</span><span>$subscription</span> in <span>$allSubscriptions</span><span>)</span><span>{</span>
        <span>$subscriptionArray</span> <span>+=</span> <span>$subscription</span><span>.</span>Id
        <span>Write-Host</span> <span>(</span><span>"["</span> <span>+</span> <span>$subscriptionCount</span> <span>+</span> <span>"] - "</span> <span>+</span> <span>$subscription</span><span>.</span>Name <span>+</span> <span>" - "</span> <span>+</span> <span>$subscription</span><span>.</span>Id<span>)</span>
        <span>$subscriptionCount</span>+<span>+</span>
    <span>}</span>

    <span>if</span><span>(</span><span>$subscriptionArray</span><span>.</span>Count <span>-gt</span> 1<span>)</span> <span>{</span>
        <span>if</span> <span>(</span><span>!</span><span>(</span><span>$subscriptionInput</span> = <span>Read-Host</span> <span>"Select Subscription"</span><span>)</span><span>)</span> <span>{</span> <span>$subscriptionInput</span> = 0 <span>}</span>
    <span>}</span> <span>else</span> <span>{</span>
        <span>$subscriptionInput</span> = 0
    <span>}</span>
    
    <span>Set</span><span>-</span>AzContext <span>-</span>SubscriptionId <span>$subscriptionArray</span><span>[</span><span>$subscriptionInput</span><span>]</span>
<span>}</span>
</code></pre> <p><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br></p></div><p>This is a quick sketch, but it works very well! If you think the code could more elegant, or you have ideas for functionality, I highly encourage you to improve it!
The code can be found at: https://github.com/stefanpetter/InteractiveAzContext</p> <p>Thank you for reading!</p></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>