<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Securing your Blazor App with Auth0 (client side) -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Securing your Blazor App with Auth0 (client side)</h1>
    <div class="body" id="article-body"> <p>Deal with it, security is difficult and it can be the most complex piece in our applications. Because of this, many of us tend to leave it for last, if we ever implement it.</p> <ul>
<li>JWT</li>
<li>Cookies</li>
<li>IdP</li>
<li>Authentication</li>
<li>Authorization</li>
<li>Password reset</li>
<li>Email confirmation</li>
<li>Etc... </li>
</ul> <p>It can be too much to do it by ourselves.</p> <p>So, why don&apos;t leave it to someone who knows about that complex world and can bring us a complete authentication and authorization platform?</p> <p>That would make our lives less difficult.</p> <h2> <a href="#enters-auth0" class="anchor"> </a> Enters Auth0
</h2> <p>As per <a href="https://auth0.com/">Auth0 site</a>:</p> <blockquote>
<p>Auth0 provides a universal authentication &amp; authorization platform for web, mobile, and legacy applications.</p>
</blockquote> <p>Auth0 will take care of all the complex duties and you only need to take care of the integration.</p> <p>Better of, a library already exists that facilitates its integration with Blazor.</p> <h2> <a href="#blazorauth0" class="anchor"> </a> Blazor.Auth0
</h2> <p><strong>Disclaimer</strong>: Author here.</p> <p><a href="https://github.com/henalbrod/Blazor.Auth0">Blazor.Auth0</a> Is a library for using the <a href="https://auth0.com/blog/oauth2-implicit-grant-and-spa/">Authorization Code Grant with Proof Key for Code Exchange (PKCE)</a> with <a href="https://auth0.com/docs/libraries/when-to-use-lock">Auth0&apos;s Universal Login</a> in Blazor SPAs.</p> <p>The idea behind this is to have an easy way of using Auth0&apos;s services with Blazor (especially the client-side) without relying on javascript libraries.</p> <h2> <a href="#blazor-requirements" class="anchor"> </a> Blazor Requirements
</h2> <p>Blazor is evolving rapidly, especially on the client-side, so you will need to fulfill some requirements before starting to work, the best place to find the latest steps for preparation will always be the <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/get-started?view=aspnetcore-3.1&amp;tabs=visual-studio">official Blazor website</a></p> <blockquote>
<p><strong>Note</strong>: Visual Studio 2019 16.4 Preview 2 or later is a must for working with Client-Side applications (at the time of writing this).</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--Wm4vS2zw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a5ho005i95lo3l53f412.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Wm4vS2zw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/a5ho005i95lo3l53f412.png" alt="Alt Text"></a></p>
</blockquote> <h2> <a href="#creating-the-blazor-clientside-app" class="anchor"> </a> Creating the Blazor Client-Side App
</h2> <p>If you are in the command line, you should use the <strong>.Net Core CLI</strong>:<br>
</p> <div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>dotnet new blazorwasm <span class="nt">-o</span> your_awesome_app_name
</code></pre></div> <p>If you are using VS 2019, please select <strong>Create a new project</strong>, look for <strong>Blazor App</strong>, give a cool name to your project and click on create.</p> <p>Be sure to select the correct project template, in this case, we&apos;ll be working on a Client-Side application, so you need to select <strong>Blazor Webassembly App</strong></p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--HaZoeWQo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/azqo2ajmqh35w8c90rpz.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--HaZoeWQo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/azqo2ajmqh35w8c90rpz.png" alt="Alt Text"></a></p> <h2> <a href="#configuring-the-blazor-clientside-app" class="anchor"> </a> Configuring the Blazor Client-Side App
</h2> <p>First, you&apos;ll want to enable the SSL support, it can be activated by checking the <strong>Enable SSL</strong> checkbox in the application&apos;s properties page.</p> <p>Please take note of the generated SSL URL as you&apos;ll need it when configuring Auth0.</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--n9cnXL0d--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/j197ycyfyp8pdg5rvqpa.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--n9cnXL0d--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/j197ycyfyp8pdg5rvqpa.png" alt="Alt Text"></a></p> <p>Now install the <strong>Blazor.Auth0</strong> library via the NuGet Package console by running the following command:<br>
</p> <div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>Install-Package Blazor-Auth0-ClientSide <span class="nt">-Version</span> 2.0.0-Preview2
</code></pre></div> <p>Another option is opening the <strong>Nuget Package Manager</strong>, look for Blazor-Auth0-ClientSide and click in install.</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ImkTZWJo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9xnqhxzffyglqb4gu2f7.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ImkTZWJo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/9xnqhxzffyglqb4gu2f7.png" alt="Alt Text"></a></p> <p>Once <strong>Blazor.Auth0</strong> is installed, you need to register the AuthenticationService via Dependency Injection, to do it, edit the <code>Startup.cs</code> file as follows:<br>
</p> <div class="highlight"><pre class="highlight csharp"><code> <span class="k">using</span> <span class="nn">Blazor.Auth0</span><span class="p">;</span> <span class="k">using</span> <span class="nn">Microsoft.AspNetCore.Components.Builder</span><span class="p">;</span> <span class="k">using</span> <span class="nn">Microsoft.Extensions.DependencyInjection</span><span class="p">;</span> <span class="k">namespace</span> <span class="nn">Examples.ClientSide</span> <span class="p">{</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span> <span class="p">{</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span> <span class="p">{</span> <span class="n">services</span><span class="p">.</span><span class="nf">AddBlazorAuth0</span><span class="p">(</span><span class="n">options</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">options</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="s">&quot;[Auth0_Domain]&quot;</span><span class="p">;</span> <span class="n">options</span><span class="p">.</span><span class="n">ClientId</span> <span class="p">=</span> <span class="s">&quot;[Auth0_Client_Id]&quot;</span><span class="p">;</span> <span class="n">options</span><span class="p">.</span><span class="n">RequireAuthenticatedUser</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="p">});</span> <span class="n">services</span><span class="p">.</span><span class="nf">AddAuthorizationCore</span><span class="p">();</span> <span class="p">}</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IComponentsApplicationBuilder</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span> <span class="n">app</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">App</span><span class="p">&gt;(</span><span class="s">&quot;app&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>

</code></pre></div> <p><code>services.AddBlazorAuth0</code> is a helper method that will register the required <code>ClientOptions</code> settings, <code>AuthenticationService</code>, and <code>AuthenticationStateProvider</code>.</p> <p>An optional but recommended step is to add the following import statements in <code>_Imports.razor</code><br>
</p> <div class="highlight"><pre class="highlight csharp"><code> <span class="n">@using</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">AspNetCore</span><span class="p">.</span><span class="n">Authorization</span> <span class="n">@using</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">AspNetCore</span><span class="p">.</span><span class="n">Components</span><span class="p">.</span><span class="n">Authorization</span> <span class="n">@using</span> <span class="n">Blazor</span><span class="p">.</span><span class="n">Auth0</span> <span class="n">@using</span> <span class="n">Blazor</span><span class="p">.</span><span class="n">Auth0</span><span class="p">.</span><span class="n">Models</span> <span class="n">@using</span> <span class="n">Blazor</span><span class="p">.</span><span class="n">Auth0</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">Enumerations</span>
</code></pre></div> <p>This will expose these namespaces globally in our Blazor App</p> <p>Replace the content of <code>App.razor</code> with the following:<br>
</p> <div class="highlight"><pre class="highlight html"><code> <span class="nt">&lt;Router</span> <span class="na">AppAssembly=</span><span class="s">&quot;@typeof(Program).Assembly&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;Found</span> <span class="na">Context=</span><span class="s">&quot;routeData&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;AuthorizeRouteView</span> <span class="na">RouteData=</span><span class="s">&quot;@routeData&quot;</span> <span class="na">DefaultLayout=</span><span class="s">&quot;@typeof(MainLayout)&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;Authorizing&gt;</span> <span class="nt">&lt;p&gt;</span>&gt;Determining session state, please wait...<span class="nt">&lt;/p&gt;</span> <span class="nt">&lt;/Authorizing&gt;</span> <span class="nt">&lt;NotAuthorized&gt;</span> <span class="nt">&lt;h1&gt;</span>Sorry<span class="nt">&lt;/h1&gt;</span> <span class="nt">&lt;p&gt;</span>You&apos;re not authorized to reach this page. You may need to log in as a different user.<span class="nt">&lt;/p&gt;</span> <span class="nt">&lt;/NotAuthorized&gt;</span> <span class="nt">&lt;/AuthorizeRouteView&gt;</span> <span class="nt">&lt;/Found&gt;</span> <span class="nt">&lt;NotFound&gt;</span> <span class="nt">&lt;p&gt;</span>Sorry, there&apos;s nothing at this address.<span class="nt">&lt;/p&gt;</span> <span class="nt">&lt;/NotFound&gt;</span> <span class="nt">&lt;/Router&gt;</span>
</code></pre></div> <p>That way you&apos;ll display the appropriate content depending on the current authentication state.</p> <p>More important is, the <code>AuthorizeRouteView</code> component will Set up the <br>
<code>Task &lt;AuthenticationState&gt;</code> cascading parameter.</p> <p>Replace the content of <code>MainLayout.razor</code> with the following:<br>
</p> <div class="highlight"><pre class="highlight html"><code> @inherits LayoutComponentBase @inject Blazor.Auth0.IAuthenticationService authService <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;sidebar&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;NavMenu</span> <span class="nt">/&gt;</span> <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;top-row px-4&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;AuthorizeView&gt;</span> <span class="nt">&lt;Authorized&gt;</span> <span class="nt">&lt;NavLink</span> <span class="na">class=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="err">@</span><span class="na">onclick=</span><span class="s">&quot;authService.LogOut&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oi oi-account-logout&quot;</span> <span class="na">aria-hidden=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/span&gt;</span> Logout <span class="nt">&lt;/NavLink&gt;</span> <span class="nt">&lt;/Authorized&gt;</span> <span class="nt">&lt;NotAuthorized&gt;</span> <span class="nt">&lt;NavLink</span> <span class="na">class=</span><span class="s">&quot;nav-link&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="err">@</span><span class="na">onclick=</span><span class="s">&quot;authService.Authorize&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oi oi-account-login&quot;</span> <span class="na">aria-hidden=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/span&gt;</span> Login <span class="nt">&lt;/NavLink&gt;</span> <span class="nt">&lt;/NotAuthorized&gt;</span> <span class="nt">&lt;/AuthorizeView&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://blazor.net&quot;</span> <span class="na">target=</span><span class="s">&quot;_blank&quot;</span> <span class="na">class=</span><span class="s">&quot;ml-md-auto&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span> <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;content px-4&quot;</span><span class="nt">&gt;</span> @Body <span class="nt">&lt;/div&gt;</span> <span class="nt">&lt;/div&gt;</span>

</code></pre></div> <p>This will display a Login/Logout button in the top-bar for the users to start or finish their sessions.</p> <p>The last view you&apos;ll need to edit is the <code>Index.razor</code>, replace its content with the following:<br>
</p> <div class="highlight"><pre class="highlight html"><code> @page &quot;/&quot; <span class="nt">&lt;h1&gt;</span> Hello, <span class="nt">&lt;AuthorizeView&gt;</span> <span class="nt">&lt;Authorized&gt;</span>@context.User.Identity.Name<span class="nt">&lt;/Authorized&gt;</span> <span class="nt">&lt;NotAuthorized&gt;</span>World<span class="nt">&lt;/NotAuthorized&gt;</span> <span class="nt">&lt;/AuthorizeView&gt;</span> ! <span class="nt">&lt;/h1&gt;</span> Welcome to your new app. <span class="nt">&lt;SurveyPrompt</span> <span class="na">Title=</span><span class="s">&quot;How is Blazor working for you?&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div> <p>The <code>&lt;AuthorizeView&gt;</code> component will detect the authentication state of the user and will display <em>Hello, World</em> in case there&apos;s no active user or <em>Hello, [Name of the user</em>] when a user is authenticated.</p> <h2> <a href="#configuring-auth0" class="anchor"> </a> Configuring Auth0
</h2> <p>If you don&apos;t have an Auth0 account already, please create one by navigating to <a href="https://auth0.com/">Auth0&apos;s home page</a>, hitting the Sign-Up button and following thru the account creation wizard, at the end of the process you&apos;ll end up in the dashboard.</p> <p>Once there, select <strong>Applications</strong> then <strong>Default App</strong> to load the application settings page.</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--ks4Mn6S---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5516nf574o2lmqehvbzb.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--ks4Mn6S---/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/5516nf574o2lmqehvbzb.png" alt="Alt Text"></a></p> <p>Then, look for the <strong>Domain</strong> and <strong>Client ID</strong> fields, and take note of them as you&apos;ll need them in the final step.</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--XLPJzVfN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8uu8arlz5lcaqh9o7isw.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XLPJzVfN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/8uu8arlz5lcaqh9o7isw.png" alt="Alt Text"></a></p> <p>Next look for the <strong>Application Type</strong> field, expand it to see the different client application types supported by Auth0. Select <strong>Single Page Application</strong></p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--HTe6NjLH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mav4jsel8vpsm53x49pz.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--HTe6NjLH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/mav4jsel8vpsm53x49pz.png" alt="Alt Text"></a></p> <p>To finish with the Auth0 configuration you need to indicate the Blazor App SSL URL as one of the valid paths for Auth0 to allow the users to authenticate.</p> <p>To do it, look for the following fields and add the application SSL URL to them. </p> <ul>
<li><p><strong>Allowed Callback URLs</strong>: <br>
To which URLs the user can be redirected to after login in</p></li>
<li><p><strong>Allowed Web Origins</strong>:<br>
Which URLs are allowed to perform Silent Login</p></li>
<li><p><strong>Allowed Logout URLs</strong>:<br>
To which URLs the user can be redirected to after logging off</p></li>
<li><p><strong>Allowed Origins (CORS)</strong>:<br>
Which URLs are allowed to perform POST request to the Auth0 API</p></li>
</ul> <blockquote>
<p>The SSL URL is the one obtained after activating the SSL checkbox in the Blazor application options page.</p>
</blockquote> <p>The final result should look similar to this:</p> <p><a href="https://res.cloudinary.com/practicaldev/image/fetch/s--bt5pQIGH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p66a6twrblder9pn0he5.png" class="article-body-image-wrapper"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--bt5pQIGH--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://thepracticaldev.s3.amazonaws.com/i/p66a6twrblder9pn0he5.png" alt="Alt Text"></a></p> <p>With that we finished configuring our Auth0 account, now we need to go back to our code to give the last touch.</p> <h2> <a href="#back-to-blazor" class="anchor"> </a> Back to Blazor
</h2> <p>Go back to the Blazor application one last time and replace the <code>[Auth0_Domain]</code> and <code>[Auth0_Client_Id]</code> values in <code>Startup.cs</code> with the values that you&apos;ve just got from Auth0&apos;s Application Settings page.<br>
</p> <div class="highlight"><pre class="highlight csharp"><code> <span class="n">options</span><span class="p">.</span><span class="n">Domain</span> <span class="p">=</span> <span class="s">&quot;[Auth0_Domain]&quot;</span><span class="p">;</span> <span class="n">options</span><span class="p">.</span><span class="n">ClientId</span> <span class="p">=</span> <span class="s">&quot;[Auth0_Client_Id]&quot;</span><span class="p">;</span>
</code></pre></div> <h2> <a href="#press-f5-and-enjoy" class="anchor"> </a> Press F5 and enjoy!
</h2> <p><a href="https://i.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif" class="article-body-image-wrapper"><img src="https://i.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif" alt="Alt Text"></a></p> <p>Now you&apos;ve completed the integration of a fully-fledged IDaaS platform into your Brand-new Blazor App, but this is just the beginning, you can take you Application Security to the next level, by implementing:</p> <ul>
<li>RBAC (Role-Based Access Control)</li>
<li>Claims Base Authorization</li>
<li>SSO</li>
<li>Social Connections</li>
<li>Lots more!</li>
</ul> <p>I hope you&apos;ve found this publication interesting, useful or learned something new from it.</p> <p>Two more publications are in the works for covering Server Side and ASP.Net Core Hosted Scenarios, also, a more in-depth sight to the Blazor.Auth0 library internals and capabilities.</p> <p>All comments are welcome, thanks for reading!</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>