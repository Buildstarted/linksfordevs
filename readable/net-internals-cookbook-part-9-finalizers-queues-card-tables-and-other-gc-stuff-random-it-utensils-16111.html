<!DOCTYPE html>
<html lang="en">
<head>
    <title>
.NET Internals Cookbook Part 9 &#x2014; Finalizers, queues, card tables and other GC stuff &#x2013; Random IT Utensils - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content=".NET Internals Cookbook Part 9 &#x2014; Finalizers, queues, card tables and other GC stuff &#x2013; Random IT Utensils - linksfor.dev(s)"/>
    <meta property="og:description" content="This is the ninth part of the .NET Internals Cookbook series. For your convenience you can find other parts in the table of contents in Part 0 &#x2013; Table of contents"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://blog.adamfurmanek.pl/2019/04/13/net-internals-cookbook-part-9/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - .NET Internals Cookbook Part 9 &#x2014; Finalizers, queues, card tables and other GC stuff &#x2013; Random IT Utensils</title>
<div class="readable">
        <h1>.NET Internals Cookbook Part 9 &#x2014; Finalizers, queues, card tables and other GC stuff &#x2013; Random IT Utensils</h1>
            <div>Reading time: 21-26 minutes</div>
        <div>Posted here: 15 Apr 2019</div>
        <p><a href="https://blog.adamfurmanek.pl/2019/04/13/net-internals-cookbook-part-9/">https://blog.adamfurmanek.pl/2019/04/13/net-internals-cookbook-part-9/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
                         <blockquote><p>This is the ninth part of the .NET Internals Cookbook series. For your convenience you can find other parts in the table of contents in <a href="https://blog.adamfurmanek.pl/2019/02/16/net-internals-cookbook-part-0/">Part 0 – Table of contents</a></p></blockquote>
<h6>59. What happens if an exception is thrown in finalizer? What about infinite loop?</h6>
<p>Let’s see this code:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659312783476557" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p></div>
				</td>
						<td><div><p><span>using </span><span>System</span><span>;</span></p><p><span>namespace</span><span> </span><span>Program</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>class</span><span> </span><span>Program</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Testing Foo"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>foo</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Foo</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>foo</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>WaitForPendingFinalizers</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Testing Bar"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>bar</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Bar</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>bar</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>WaitForPendingFinalizers</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Done!"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Foo</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>~</span><span>Foo</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Good destructor"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Bar</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>~</span><span>Bar</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Destructor with exception"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>throw</span><span> </span><span>new</span><span> </span><span>Exception</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->

<p>If you run it in <a href="https://dotnetfiddle.net/FiVjvw">dotnetfiddle</a> you get this:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65931b309863515" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>Run</span><span>-</span><span>time </span><span>exception</span><span> </span><span>(</span><span>line</span><span> </span><span>-</span><span>1</span><span>)</span><span>:</span><span> </span><span>Exception </span><span>of </span><span>type</span><span> </span><span>'System.Exception'</span><span> </span><span>was </span><span>thrown</span><span>.</span></p><p><span>Stack </span><span>Trace</span><span>:</span></p><p><span>[</span><span>System</span><span>.</span><span>Exception</span><span>:</span><span> </span><span>Exception </span><span>of </span><span>type</span><span> </span><span>'System.Exception'</span><span> </span><span>was </span><span>thrown</span><span>.</span><span>]</span></p><p><span>&nbsp;&nbsp; </span><span>at </span><span>Bar</span><span>.</span><span>Finalize</span><span>(</span><span>)</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->

<p>So you don’t see anything printed out but you do see the exception.</p>
<p>If you try it in <a href="https://tio.run/##rVDLTsMwEDzHX2F6Sg/0ByoutKQXkCqB1APi4DpLasnxRl6n4aHy62EdpwUhygnJK8szu@PZ0XSpSfd9S8ZV8v6VAtRzIZyqgRqlQa49Vl7V4l1kTbu1RkttFdEJz5g4MhRU4GuPppR3yricgmfZxyepfEVTbozN2QIdoYXZxpsAt8ZBPnkACtFAgTiZzmNTrL3y8hlRXkkHXeTyxI1Ya@3wXC1mC7QWdBh5BjbKhAL9GlzJuoVxypo38JR/qf9h41r5Hza2XMkGc6PIiP2/jSU6uEgGDoLPQYgUOkfACX4MScQof5ldIZay5D18qwOmNb4psPuoMCxxRmF5GpadCTsJLxqaYNAlR2HnsRuSuDkS@fhJ338C">tio</a>:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65931f521180995" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p></div>
				</td>
						<td><div><p><span>Testing </span><span>Foo</span></p><p><span>Good </span><span>destructor</span></p><p><span>Testing </span><span>Bar</span></p><p><span>Done</span><span>!</span></p><p><span>Destructor </span><span>with </span><span>exception</span></p><p><span>Microsoft</span><span> </span><span>(</span><span>R</span><span>)</span><span> </span><span>Build </span><span>Engine </span><span>version</span><span> </span><span>16.0.0.0</span><span> </span><span>for</span><span> </span><span>Mono</span></p><p><span>Copyright</span><span> </span><span>(</span><span>C</span><span>)</span><span> </span><span>Microsoft </span><span>Corporation</span><span>.</span><span> </span><span>All </span><span>rights </span><span>reserved</span><span>.</span></p><p><span>Unhandled </span><span>Exception</span><span>:</span></p><p><span>System</span><span>.</span><span>Exception</span><span>:</span><span> </span><span>Exception </span><span>of </span><span>type</span><span> </span><span>'System.Exception'</span><span> </span><span>was </span><span>thrown</span><span>.</span></p><p><span>&nbsp;&nbsp;</span><span>at </span><span>Bar</span><span>.</span><span>Finalize</span><span> </span><span>(</span><span>)</span><span> </span><span>[</span><span>0x0000d</span><span>]</span><span> </span><span>in</span><span> </span><span>&lt;</span><span>fb493746d55b41718381c31bf369d391</span><span>&gt;</span><span>:</span><span>0</span><span> </span></p><p><span>[</span><span>ERROR</span><span>]</span><span> </span><span>FATAL </span><span>UNHANDLED </span><span>EXCEPTION</span><span>:</span><span> </span><span>System</span><span>.</span><span>Exception</span><span>:</span><span> </span><span>Exception </span><span>of </span><span>type</span><span> </span><span>'System.Exception'</span><span> </span><span>was </span><span>thrown</span><span>.</span></p><p><span>&nbsp;&nbsp;</span><span>at </span><span>Bar</span><span>.</span><span>Finalize</span><span> </span><span>(</span><span>)</span><span> </span><span>[</span><span>0x0000d</span><span>]</span><span> </span><span>in</span><span> </span><span>&lt;</span><span>fb493746d55b41718381c31bf369d391</span><span>&gt;</span><span>:</span><span>0</span><span> </span></p><p><span>Real </span><span>time</span><span>:</span><span> </span><span>2.698</span><span> </span><span>s</span></p><p><span>User </span><span>time</span><span>:</span><span> </span><span>2.186</span><span> </span><span>s</span></p><p><span>Sys</span><span>.</span><span> </span><span>time</span><span>:</span><span> </span><span>0.489</span><span> </span><span>s</span></p><p><span>CPU </span><span>share</span><span>:</span><span> </span><span>99.17</span><span> </span><span>%</span></p><p><span>Exit </span><span>code</span><span>:</span><span> </span><span>255</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->

<p>So you see all lines and exception thrown out of bands.</p>
<p>And if I try it locally with VS 2017:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659322497848205" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>Testing </span><span>Foo</span></p><p><span>Good </span><span>destructor</span></p><p><span>Testing </span><span>Bar</span></p><p><span>Destructor </span><span>with </span><span>exception</span></p><p><span>Unhandled </span><span>Exception</span><span>:</span><span> </span><span>System</span><span>.</span><span>Exception</span><span>:</span><span> </span><span>Exception </span><span>of </span><span>type</span><span> </span><span>'System.Exception'</span><span> </span><span>was </span><span>thrown</span><span>.</span></p><p><span>&nbsp;&nbsp; </span><span>at </span><span>Bar</span><span>.</span><span>Finalize</span><span>(</span><span>)</span><span> </span><span>in</span><span> </span><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span>:</span><span>line</span><span> </span><span>41</span></p><p><span>Press </span><span>any </span><span>key </span><span>to</span><span> </span><span>continue</span><span> </span><span>.</span><span> </span><span>.</span><span> </span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->

<p>So it looks like your mileage may vary. However, it kills the application, generally, as specified <a href="https://docs.microsoft.com/en-us/dotnet/api/system.object.finalize?redirectedfrom=MSDN&amp;view=netframework-4.7.2#System_Object_Finalize">in documentation</a>:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659324388037800" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>If</span><span> </span><span>Finalize </span><span>or</span><span> </span><span>an </span><span>override </span><span>of </span><span>Finalize </span><span>throws </span><span>an </span><span>exception</span><span>,</span><span> </span><span>and</span><span> </span><span>the </span><span>runtime </span><span>is</span><span> </span><span>not</span><span> </span><span>hosted </span><span>by </span><span>an </span><span>application </span><span>that </span><span>overrides </span><span>the </span><span>default</span><span> </span><span>policy</span><span>,</span><span> </span><span>the </span><span>runtime </span><span>terminates </span><span>the </span><span>process </span><span>and</span><span> </span><span>no </span><span>active </span><span>try</span><span>/</span><span>finally</span><span> </span><span>blocks </span><span>or</span><span> </span><span>finalizers </span><span>are </span><span>executed</span><span>.</span><span> </span><span>This</span><span> </span><span>behavior </span><span>ensures </span><span>process </span><span>integrity </span><span>if</span><span> </span><span>the </span><span>finalizer </span><span>cannot </span><span>free </span><span>or</span><span> </span><span>destroy </span><span>resources</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->

<p>Since finalizers are run on a separate thread, you get <a href="https://dotnetfiddle.net/EDWMjL">deadlock with infinite loop</a>:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659327970131305" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p></div>
				</td>
						<td><div><p><span>using </span><span>System</span><span>;</span></p><p><span>namespace</span><span> </span><span>Program</span></p><p><span>{</span></p><p><span>	</span><span>public</span><span> </span><span>class</span><span> </span><span>Program</span></p><p><span>	</span><span>{</span></p><p><span>		</span><span>public</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span></p><p><span>		</span><span>{</span></p><p><span>			</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Testing Foo"</span><span>)</span><span>;</span></p><p><span>			</span><span>var</span><span> </span><span>foo</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Foo</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>foo</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></p><p><span>			</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>GC</span><span>.</span><span>WaitForPendingFinalizers</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Testing Bar"</span><span>)</span><span>;</span></p><p><span>			</span><span>var</span><span> </span><span>bar</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Bar</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>bar</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></p><p><span>			</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>GC</span><span>.</span><span>WaitForPendingFinalizers</span><span>(</span><span>)</span><span>;</span></p><p><span>			</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Done!"</span><span>)</span><span>;</span></p><p><span>		</span><span>}</span></p><p><span>	</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Foo</span><span>{</span></p><p><span>	</span><span>~</span><span>Foo</span><span>(</span><span>)</span><span>{</span></p><p><span>		</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Good destructor"</span><span>)</span><span>;</span></p><p><span>	</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Bar</span><span>{</span></p><p><span>	</span><span>~</span><span>Bar</span><span>(</span><span>)</span><span>{</span></p><p><span>		</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Destructor with infinite loop"</span><span>)</span><span>;</span></p><p><span>		</span><span>while</span><span>(</span><span>true</span><span>)</span><span>{</span><span>}</span></p><p><span>	</span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65932a371293549" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>Testing </span><span>Foo</span></p><p><span>Good </span><span>destructor</span></p><p><span>Testing </span><span>Bar</span></p><p><span>Destructor </span><span>with </span><span>infinite </span><span>loop</span></p><p><span>Fatal </span><span>Error</span><span>:</span><span> </span><span>Execution </span><span>time </span><span>limit </span><span>was </span><span>exceeded</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->

<h6>60. What is finalization queue? What is f-reachable queue?</h6>
<p>When your object has a destructor (finalizer), it is stored in finalization queue when allocated. Later, when the object is not reachable anymore and GC detects that, it puts it to f-reachable queue. Finalizers are not called directly, they are called on a separate thread which gets the objects to cleanup from f-reachable queue.</p>
<p>Let’s take this code:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65932c743246152" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p></div>
				</td>
						<td><div><p><span>using </span><span>System</span><span>;</span></p><p><span>namespace</span><span> </span><span>Program</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>class</span><span> </span><span>Program</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Allocating"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>foo</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Foo</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Collecting"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>foo</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Finalizing"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>WaitForPendingFinalizers</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Done!"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Foo</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>~</span><span>Foo</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Good destructor"</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->

<p>Let’s start it and attach debugger on first line read:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		
<!-- [Format Time: 0.0001 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659331882220485" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p></div>
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>!</span><span>finalizequeue</span></p><p><span>SyncBlocks </span><span>to</span><span> </span><span>be </span><span>cleaned </span><span>up</span><span>:</span><span> </span><span>0</span></p><p><span>Free</span><span>-</span><span>Threaded </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>MTA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>STA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span></p><p><span>generation</span><span> </span><span>0</span><span> </span><span>has</span><span> </span><span>8</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a038</span><span>)</span></p><p><span>generation</span><span> </span><span>1</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a018</span><span>)</span></p><p><span>generation</span><span> </span><span>2</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a018</span><span>)</span></p><p><span>Ready </span><span>for</span><span> </span><span>finalization</span><span> </span><span>0</span><span> </span><span>objects</span><span> </span><span>(</span><span>0063a038</span><span>-&gt;</span><span>0063a038</span><span>)</span></p><p><span>Statistics </span><span>for</span><span> </span><span>all </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>including </span><span>all </span><span>objects </span><span>ready </span><span>for</span><span> </span><span>finalization</span><span>)</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>MT&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Count&nbsp;&nbsp;&nbsp;&nbsp;</span><span>TotalSize </span><span>Class</span><span> </span><span>Name</span></p><p><span>02484dc0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>12</span><span> </span><span>Foo</span></p><p><span>7253c188</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeFileMappingHandle</span></p><p><span>7253c138</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeViewOfFileHandle</span></p><p><span>7252dde8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafePEFileHandle</span></p><p><span>72531888</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>2</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>40</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeFileHandle</span></p><p><span>725312e0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>44</span><span> </span><span>System</span><span>.</span><span>Threading</span><span>.</span><span>ReaderWriterLock</span></p><p><span>7252f734</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>52</span><span> </span><span>System</span><span>.</span><span>Threading</span><span>.</span><span>Thread</span></p><p><span>Total</span><span> </span><span>8</span><span> </span><span>objects</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->

<p>So we can see that there is a <code>Foo</code> object in finalization queue. We can see its roots:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659334106577371" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>!</span><span>dumpheap</span><span> </span><span>-</span><span>type </span><span>Foo</span></p><p><span> </span><span>Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>MT&nbsp;&nbsp;&nbsp;&nbsp; </span><span>Size</span></p><p><span>02684170</span><span> </span><span>02484dc0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>12</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span></p><p><span>Statistics</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>MT&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Count&nbsp;&nbsp;&nbsp;&nbsp;</span><span>TotalSize </span><span>Class</span><span> </span><span>Name</span></p><p><span>02484dc0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>12</span><span> </span><span>Foo</span></p><p><span>Total</span><span> </span><span>1</span><span> </span><span>objects</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659337214619530" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>!</span><span>gcroot</span><span> </span><span>-</span><span>all</span><span> </span><span>02684170</span><span> </span></p><p><span>Thread</span><span> </span><span>2e74</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>0055f150</span><span> </span><span>025604a0</span><span> </span><span>Program</span><span>.</span><span>Program</span><span>.</span><span>Main</span><span>(</span><span>System</span><span>.</span><span>String</span><span>[</span><span>]</span><span>)</span><span> </span><span>[</span><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>11</span><span>]</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ebp</span><span>+</span><span>8</span><span>:</span><span> </span><span>0055f160</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>-&gt;</span><span>&nbsp;&nbsp;</span><span>02684170</span><span> </span><span>Foo</span></p><p><span>Found</span><span> </span><span>1</span><span> </span><span>roots</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659339118270755" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>!</span><span>gcroot</span><span> </span><span>-</span><span>nostacks</span><span> </span><span>02684170</span><span> </span></p><p><span>Finalizer </span><span>Queue</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>02684170</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>-&gt;</span><span> </span><span>02684170</span><span> </span><span>Foo</span></p><p><span>Warning</span><span>:</span><span> </span><span>These </span><span>roots </span><span>are </span><span>from </span><span>finalizable </span><span>objects </span><span>that </span><span>are </span><span>not</span><span> </span><span>yet </span><span>ready </span><span>for</span><span> </span><span>finalization</span><span>.</span></p><p><span>This</span><span> </span><span>is</span><span> </span><span>to</span><span> </span><span>handle </span><span>the </span><span>case</span><span> </span><span>where </span><span>objects </span><span>re</span><span>-</span><span>register </span><span>themselves </span><span>for</span><span> </span><span>finalization</span><span>.</span></p><p><span>These </span><span>roots </span><span>may </span><span>be </span><span>false</span><span> </span><span>positives</span><span>.</span></p><p><span>Found</span><span> </span><span>1</span><span> </span><span>unique </span><span>roots</span><span> </span><span>(</span><span>run</span><span> </span><span>'!GCRoot -all'</span><span> </span><span>to</span><span> </span><span>see </span><span>all </span><span>roots</span><span>)</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->

<p>So there is one normal root (our variable) and a finalization queue.</p>
<p>Before we move on, let’s freeze the GC thread:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65933b117989230" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>!</span><span>threads</span></p><p><span>ThreadCount</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>2</span></p><p><span>UnstartedThread</span><span>:</span><span>&nbsp;&nbsp;</span><span>0</span></p><p><span>BackgroundThread</span><span>:</span><span> </span><span>1</span></p><p><span>PendingThread</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>0</span></p><p><span>DeadThread</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>0</span></p><p><span>Hosted </span><span>Runtime</span><span>:</span><span>&nbsp;&nbsp; </span><span>no</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>Lock&nbsp;&nbsp;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ID </span><span>OSID </span><span>ThreadOBJ&nbsp;&nbsp;&nbsp;&nbsp;</span><span>State </span><span>GC </span><span>Mode&nbsp;&nbsp;&nbsp;&nbsp; </span><span>GC </span><span>Alloc </span><span>Context&nbsp;&nbsp;</span><span>Domain&nbsp;&nbsp; </span><span>Count </span><span>Apt </span><span>Exception</span></p><p><span>&nbsp;&nbsp; </span><span>0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span> </span><span>2e74</span><span> </span><span>0062a498</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>2a020</span><span> </span><span>Preemptive</span><span>&nbsp;&nbsp;</span><span>02684548</span><span>:</span><span>00000000</span><span> </span><span>006241e8</span><span> </span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>MTA</span><span> </span></p><p><span>&nbsp;&nbsp; </span><span>5</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>2</span><span> </span><span>2464</span><span> </span><span>0063afd0</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>2b220</span><span> </span><span>Preemptive</span><span>&nbsp;&nbsp;</span><span>00000000</span><span>:</span><span>00000000</span><span> </span><span>006241e8</span><span> </span><span>0</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>MTA</span><span> </span><span>(</span><span>Finalizer</span><span>)</span><span> </span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65933e090988072" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>~</span></p><p><span>&nbsp;&nbsp; </span><span>0</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.2e74</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>0021d000</span><span> </span><span>Unfrozen</span></p><p><span>&nbsp;&nbsp; </span><span>1</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.2368</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>00220000</span><span> </span><span>Unfrozen</span></p><p><span>&nbsp;&nbsp; </span><span>2</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.1e10</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>00223000</span><span> </span><span>Unfrozen</span></p><p><span>&nbsp;&nbsp; </span><span>3</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.1ef0</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>00226000</span><span> </span><span>Unfrozen</span></p><p><span>&nbsp;&nbsp; </span><span>4</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.3530</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>00229000</span><span> </span><span>Unfrozen</span></p><p><span>&nbsp;&nbsp; </span><span>5</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.2464</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>0022c000</span><span> </span><span>Unfrozen</span></p><p><span>.</span><span>&nbsp;&nbsp;</span><span>6</span><span>&nbsp;&nbsp;</span><span>Id</span><span>:</span><span> </span><span>484.1c6c</span><span> </span><span>Suspend</span><span>:</span><span> </span><span>1</span><span> </span><span>Teb</span><span>:</span><span> </span><span>0022f000</span><span> </span><span>Unfrozen</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		
<!-- [Format Time: 0.0001 seconds] -->

<p>Let’s carry on and look for a trash (just hit enter twice and get to the third line read), break in debugger and check:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659343263037622" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p></div>
				</td>
						<td><div><p><span>0</span><span>:</span><span>006</span><span>&gt;</span><span> </span><span>g</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>7</span><span> </span><span>threads </span><span>are </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>8</span><span> </span><span>threads </span><span>were </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>8</span><span> </span><span>threads </span><span>are </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>7</span><span> </span><span>threads </span><span>were </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>7</span><span> </span><span>threads </span><span>are </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>8</span><span> </span><span>threads </span><span>were </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>8</span><span> </span><span>threads </span><span>are </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>9</span><span> </span><span>threads </span><span>were </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>9</span><span> </span><span>threads </span><span>are </span><span>frozen</span></p><p><span>System</span><span> </span><span>0</span><span>:</span><span> </span><span>1</span><span> </span><span>of</span><span> </span><span>9</span><span> </span><span>threads </span><span>were </span><span>frozen</span></p><p><span>(</span><span>484.34d0</span><span>)</span><span>:</span><span> </span><span>Break</span><span> </span><span>instruction </span><span>exception</span><span> </span><span>-</span><span> </span><span>code</span><span> </span><span>80000003</span><span> </span><span>(</span><span>first </span><span>chance</span><span>)</span></p><p><span>eax</span><span>=</span><span>00238000</span><span> </span><span>ebx</span><span>=</span><span>00000000</span><span> </span><span>ecx</span><span>=</span><span>772e9e80</span><span> </span><span>edx</span><span>=</span><span>772e9e80</span><span> </span><span>esi</span><span>=</span><span>772e9e80</span><span> </span><span>edi</span><span>=</span><span>772e9e80</span></p><p><span>eip</span><span>=</span><span>772b48b0</span><span> </span><span>esp</span><span>=</span><span>04f4fc80</span><span> </span><span>ebp</span><span>=</span><span>04f4fcac</span><span> </span><span>iopl</span><span>=</span><span>0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>nv </span><span>up </span><span>ei </span><span>pl </span><span>zr </span><span>na </span><span>pe </span><span>nc</span></p><p><span>cs</span><span>=</span><span>0023</span><span>&nbsp;&nbsp;</span><span>ss</span><span>=</span><span>002b</span><span>&nbsp;&nbsp;</span><span>ds</span><span>=</span><span>002b</span><span>&nbsp;&nbsp;</span><span>es</span><span>=</span><span>002b</span><span>&nbsp;&nbsp;</span><span>fs</span><span>=</span><span>0053</span><span>&nbsp;&nbsp;</span><span>gs</span><span>=</span><span>002b</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>efl</span><span>=</span><span>00000246</span></p><p><span>ntdll</span><span>!</span><span>DbgBreakPoint</span><span>:</span></p><p><span>772b48b0</span><span> </span><span>cc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>int</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>3</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659346806605071" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p></div>
				</td>
						<td><div><p><span>0</span><span>:</span><span>008</span><span>&gt;</span><span> </span><span>!</span><span>finalizequeue</span></p><p><span>SyncBlocks </span><span>to</span><span> </span><span>be </span><span>cleaned </span><span>up</span><span>:</span><span> </span><span>0</span></p><p><span>Free</span><span>-</span><span>Threaded </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>MTA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>STA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span></p><p><span>generation</span><span> </span><span>0</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a034</span><span>-&gt;</span><span>0063a034</span><span>)</span></p><p><span>generation</span><span> </span><span>1</span><span> </span><span>has</span><span> </span><span>7</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a034</span><span>)</span></p><p><span>generation</span><span> </span><span>2</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a018</span><span>)</span></p><p><span>Ready </span><span>for</span><span> </span><span>finalization</span><span> </span><span>1</span><span> </span><span>objects</span><span> </span><span>(</span><span>0063a034</span><span>-&gt;</span><span>0063a038</span><span>)</span></p><p><span>Statistics </span><span>for</span><span> </span><span>all </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>including </span><span>all </span><span>objects </span><span>ready </span><span>for</span><span> </span><span>finalization</span><span>)</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>MT&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Count&nbsp;&nbsp;&nbsp;&nbsp;</span><span>TotalSize </span><span>Class</span><span> </span><span>Name</span></p><p><span>02484dc0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>12</span><span> </span><span>Foo</span></p><p><span>7253c188</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeFileMappingHandle</span></p><p><span>7253c138</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeViewOfFileHandle</span></p><p><span>7252dde8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>20</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafePEFileHandle</span></p><p><span>72531888</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>2</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>40</span><span> </span><span>Microsoft</span><span>.</span><span>Win32</span><span>.</span><span>SafeHandles</span><span>.</span><span>SafeFileHandle</span></p><p><span>725312e0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>44</span><span> </span><span>System</span><span>.</span><span>Threading</span><span>.</span><span>ReaderWriterLock</span></p><p><span>7252f734</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>52</span><span> </span><span>System</span><span>.</span><span>Threading</span><span>.</span><span>Thread</span></p><p><span>Total</span><span> </span><span>8</span><span> </span><span>objects</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->

<p>So our object is still there, let’s find its roots:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659349928997662" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>008</span><span>&gt;</span><span> </span><span>!</span><span>gcroot</span><span> </span><span>-</span><span>all</span><span> </span><span>02684170</span><span> </span></p><p><span>Found</span><span> </span><span>0</span><span> </span><span>roots</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65934b349154383" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>008</span><span>&gt;</span><span> </span><span>!</span><span>gcroot</span><span> </span><span>-</span><span>nostacks</span><span> </span><span>02684170</span><span> </span></p><p><span>Found</span><span> </span><span>0</span><span> </span><span>unique </span><span>roots</span><span> </span><span>(</span><span>run</span><span> </span><span>'!GCRoot -all'</span><span> </span><span>to</span><span> </span><span>see </span><span>all </span><span>roots</span><span>)</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659350731254476" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>008</span><span>&gt;</span><span> </span><span>!</span><span>finalizequeue</span><span> </span><span>-</span><span>allReady</span></p><p><span>SyncBlocks </span><span>to</span><span> </span><span>be </span><span>cleaned </span><span>up</span><span>:</span><span> </span><span>0</span></p><p><span>Free</span><span>-</span><span>Threaded </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>MTA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>STA </span><span>Interfaces </span><span>to</span><span> </span><span>be </span><span>released</span><span>:</span><span> </span><span>0</span></p><p><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span><span>--</span></p><p><span>generation</span><span> </span><span>0</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a034</span><span>-&gt;</span><span>0063a034</span><span>)</span></p><p><span>generation</span><span> </span><span>1</span><span> </span><span>has</span><span> </span><span>7</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a034</span><span>)</span></p><p><span>generation</span><span> </span><span>2</span><span> </span><span>has</span><span> </span><span>0</span><span> </span><span>finalizable </span><span>objects</span><span> </span><span>(</span><span>0063a018</span><span>-&gt;</span><span>0063a018</span><span>)</span></p><p><span>Finalizable </span><span>but </span><span>not</span><span> </span><span>rooted</span><span>:</span><span>&nbsp;&nbsp;</span></p><p><span>Ready </span><span>for</span><span> </span><span>finalization</span><span> </span><span>1</span><span> </span><span>objects</span><span> </span><span>(</span><span>0063a034</span><span>-&gt;</span><span>0063a038</span><span>)</span></p><p><span>Statistics </span><span>for</span><span> </span><span>all </span><span>finalizable </span><span>objects </span><span>that </span><span>are </span><span>no </span><span>longer </span><span>rooted</span><span>:</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>MT&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Count&nbsp;&nbsp;&nbsp;&nbsp;</span><span>TotalSize </span><span>Class</span><span> </span><span>Name</span></p><p><span>02484dc0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>1</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>12</span><span> </span><span>Foo</span></p><p><span>Total</span><span> </span><span>1</span><span> </span><span>objects</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->

<p>So it is not held by anything and ready to be cleaned up — it is now in f-reachable queue:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659353521513141" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>008</span><span>&gt;</span><span> </span><span>s</span><span> </span><span>-</span><span>d</span><span> </span><span>0</span><span> </span><span>L</span><span>?</span><span>0xFFFFFFFF</span><span> </span><span>02684170</span><span>	</span></p><p><span>0055f15c</span><span>&nbsp;&nbsp;</span><span>02684170</span><span> </span><span>00000000</span><span> </span><span>026823b4</span><span> </span><span>0055f174</span><span>&nbsp;&nbsp;</span><span>pAh</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>#h.t.U.</span></p><p><span>0063a034</span><span>&nbsp;&nbsp;</span><span>02684170</span><span> </span><span>00000000</span><span> </span><span>00000000</span><span> </span><span>00000000</span><span>&nbsp;&nbsp;</span><span>pAh</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span><span>.</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->

<p>The address <code>0063a034</code> was in a finalization queue (see previous outputs). Since we froze the finalizer thread, the object is not cleaned up.</p>
<h6>61. What is object pinning?</h6>
<p>When you pass an object to some external (non-managed) code it is important to not move the object as the external code may have a pointer to it. Since GC can move the object when compacting the heap, we need to ask GC to not move it. This is called pinning.</p>
<p>To pin an object you can use either <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/fixed-statement">fixed keyword</a> or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.gchandle.alloc?redirectedfrom=MSDN&amp;view=netframework-4.7.2#System_Runtime_InteropServices_GCHandle_Alloc_System_Object_">GC.Alloc</a>.</p>
<h6>62. Does P/Invoke pins objects?</h6>
<p>Yes, but only for the time of the method execution. You need to pin them manually if you pass them to some asynchronous code (which will use the object after P/Invoke call returns).</p>
<h6>63. What is a write barrier?</h6>
<p>This is a general term used in garbage collection, not something internal to .NET. Some GC algorithms need to be aware of any write you perform, for instance to update the card tables or reference counters. So when you perform assignment, you call write barrier doing some bookkeeping. See this code:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659356003574689" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p></div>
				</td>
						<td><div><p><span>using </span><span>System</span><span>;</span></p><p><span>namespace</span><span> </span><span>Program</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>class</span><span> </span><span>Program</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>var</span><span> </span><span>foo</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Foo</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>GC</span><span>.</span><span>GetGeneration</span><span>(</span><span>foo</span><span>)</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>foo</span><span>.</span><span>Bar</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Bar</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Console</span><span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Foo</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>public</span><span> </span><span>Bar </span><span>Bar</span><span>;</span></p><p><span>}</span></p><p><span>class</span><span> </span><span>Bar</span></p><p><span>{</span></p><p><span>}</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->

<p>When you run it you should see that after the collection <code>foo</code> object is in generation 1. Let’s decompile it:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659359993678958" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p><p>67</p><p>68</p><p>69</p><p>70</p><p>71</p><p>72</p><p>73</p><p>74</p><p>75</p><p>76</p><p>77</p><p>78</p><p>79</p><p>80</p><p>81</p><p>82</p><p>83</p><p>84</p><p>85</p><p>86</p><p>87</p><p>88</p><p>89</p><p>90</p><p>91</p><p>92</p><p>93</p><p>94</p><p>95</p><p>96</p><p>97</p><p>98</p><p>99</p><p>100</p><p>101</p><p>102</p><p>103</p><p>104</p><p>105</p><p>106</p></div>
				</td>
						<td><div><p><span>// Metadata version: v4.0.30319</span></p><p><span>.</span><span>assembly </span><span>extern</span><span> </span><span>mscorlib</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>publickeytoken</span><span> </span><span>=</span><span> </span><span>(</span><span>B7</span><span> </span><span>7A</span><span> </span><span>5C</span><span> </span><span>56</span><span> </span><span>19</span><span> </span><span>34</span><span> </span><span>E0</span><span> </span><span>89</span><span> </span><span>)</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>// .z\V.4..</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>ver</span><span> </span><span>4</span><span>:</span><span>0</span><span>:</span><span>0</span><span>:</span><span>0</span></p><p><span>}</span></p><p><span>.</span><span>assembly</span><span> </span><span>'3aecb992-09ec-4656-9a7f-15f021299e85'</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>hash </span><span>algorithm</span><span> </span><span>0x00008004</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>ver</span><span> </span><span>0</span><span>:</span><span>0</span><span>:</span><span>0</span><span>:</span><span>0</span></p><p><span>}</span></p><p><span>.</span><span>module</span><span> </span><span>'3aecb992-09ec-4656-9a7f-15f021299e85.dll'</span></p><p><span>// MVID: {62F0FDE5-D531-4A79-97F4-C94E38ADF85C}</span></p><p><span>.</span><span>imagebase</span><span> </span><span>0x10000000</span></p><p><span>.</span><span>file </span><span>alignment</span><span> </span><span>0x00000200</span></p><p><span>.</span><span>stackreserve</span><span> </span><span>0x00100000</span></p><p><span>.</span><span>subsystem</span><span> </span><span>0x0003</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>// WINDOWS_CUI</span></p><p><span>.</span><span>corflags</span><span> </span><span>0x00000001</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>//&nbsp;&nbsp;ILONLY</span></p><p><span>// Image base: 0x00F00000</span></p><p><span>// =============== CLASS MEMBERS DECLARATION ===================</span></p><p><span>.</span><span>class</span><span> </span><span>private</span><span> </span><span>auto </span><span>ansi </span><span>beforefieldinit </span><span>Foo</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>extends</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>field </span><span>public</span><span> </span><span>class</span><span> </span><span>Bar </span><span>Bar</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>method </span><span>public</span><span> </span><span>hidebysig </span><span>specialname </span><span>rtspecialname </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>instance </span><span>void</span><span>&nbsp;&nbsp;</span><span>.</span><span>ctor</span><span>(</span><span>)</span><span> </span><span>cil</span><span> </span><span>managed</span></p><p><span>&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>// </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>maxstack</span><span>&nbsp;&nbsp;</span><span>8</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0000</span><span>:</span><span>&nbsp;&nbsp;</span><span>ldarg</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0001</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>instance </span><span>void</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span><span>::</span><span>.</span><span>ctor</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0006</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0007</span><span>:</span><span>&nbsp;&nbsp;</span><span>ret</span></p><p><span>&nbsp;&nbsp;</span><span>}</span><span> </span><span>// end of method Foo::.ctor</span></p><p><span>}</span><span> </span><span>// end of class Foo</span></p><p><span>.</span><span>class</span><span> </span><span>private</span><span> </span><span>auto </span><span>ansi </span><span>beforefieldinit </span><span>Bar</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>extends</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>method </span><span>public</span><span> </span><span>hidebysig </span><span>specialname </span><span>rtspecialname </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>instance </span><span>void</span><span>&nbsp;&nbsp;</span><span>.</span><span>ctor</span><span>(</span><span>)</span><span> </span><span>cil</span><span> </span><span>managed</span></p><p><span>&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>// </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>maxstack</span><span>&nbsp;&nbsp;</span><span>8</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0000</span><span>:</span><span>&nbsp;&nbsp;</span><span>ldarg</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0001</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>instance </span><span>void</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span><span>::</span><span>.</span><span>ctor</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0006</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0007</span><span>:</span><span>&nbsp;&nbsp;</span><span>ret</span></p><p><span>&nbsp;&nbsp;</span><span>}</span><span> </span><span>// end of method Bar::.ctor</span></p><p><span>}</span><span> </span><span>// end of class Bar</span></p><p><span>.</span><span>class</span><span> </span><span>public</span><span> </span><span>auto </span><span>ansi </span><span>beforefieldinit </span><span>Program</span><span>.</span><span>Program</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>extends</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span></p><p><span>{</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>method </span><span>public</span><span> </span><span>hidebysig </span><span>static</span><span> </span><span>void</span><span>&nbsp;&nbsp;</span><span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span><span> </span><span>args</span><span>)</span><span> </span><span>cil</span><span> </span><span>managed</span></p><p><span>&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>// </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>maxstack</span><span>&nbsp;&nbsp;</span><span>2</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>locals </span><span>init</span><span> </span><span>(</span><span>[</span><span>0</span><span>]</span><span> </span><span>class</span><span> </span><span>Foo </span><span>foo</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>language</span><span> </span><span>'{3F5162F8-07C6-11D3-9053-00C04FA302A1}'</span><span>,</span><span> </span><span>'{994B45C4-E6E9-11D2-903F-00C04FA302A1}'</span><span>,</span><span> </span><span>'{5A869D0B-6611-11D3-BD2A-0000F80849BD}'</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>8</span><span>,</span><span>8</span><span> </span><span>:</span><span> </span><span>9</span><span>,</span><span>10</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0000</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>9</span><span>,</span><span>9</span><span> </span><span>:</span><span> </span><span>13</span><span>,</span><span>33</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0001</span><span>:</span><span>&nbsp;&nbsp;</span><span>newobj&nbsp;&nbsp;&nbsp;&nbsp; </span><span>instance </span><span>void</span><span> </span><span>Foo</span><span>::</span><span>.</span><span>ctor</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0006</span><span>:</span><span>&nbsp;&nbsp;</span><span>stloc</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>10</span><span>,</span><span>10</span><span> </span><span>:</span><span> </span><span>13</span><span>,</span><span>26</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0007</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>void</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>GC</span><span>::</span><span>Collect</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_000c</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>12</span><span>,</span><span>12</span><span> </span><span>:</span><span> </span><span>13</span><span>,</span><span>54</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_000d</span><span>:</span><span>&nbsp;&nbsp;</span><span>ldloc</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_000e</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>int32</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>GC</span><span>::</span><span>GetGeneration</span><span>(</span><span>object</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0013</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>void</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Console</span><span>::</span><span>WriteLine</span><span>(</span><span>int32</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0018</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>13</span><span>,</span><span>13</span><span> </span><span>:</span><span> </span><span>13</span><span>,</span><span>33</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0019</span><span>:</span><span>&nbsp;&nbsp;</span><span>ldloc</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_001a</span><span>:</span><span>&nbsp;&nbsp;</span><span>newobj&nbsp;&nbsp;&nbsp;&nbsp; </span><span>instance </span><span>void</span><span> </span><span>Bar</span><span>::</span><span>.</span><span>ctor</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_001f</span><span>:</span><span>&nbsp;&nbsp;</span><span>stfld&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>class</span><span> </span><span>Bar </span><span>Foo</span><span>::</span><span>Bar</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>14</span><span>,</span><span>14</span><span> </span><span>:</span><span> </span><span>13</span><span>,</span><span>32</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0024</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>string</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Console</span><span>::</span><span>ReadLine</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0029</span><span>:</span><span>&nbsp;&nbsp;</span><span>pop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>line</span><span> </span><span>15</span><span>,</span><span>15</span><span> </span><span>:</span><span> </span><span>9</span><span>,</span><span>10</span><span> </span><span>''</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_002a</span><span>:</span><span>&nbsp;&nbsp;</span><span>ret</span></p><p><span>&nbsp;&nbsp;</span><span>}</span><span> </span><span>// end of method Program::Main</span></p><p><span>&nbsp;&nbsp;</span><span>.</span><span>method </span><span>public</span><span> </span><span>hidebysig </span><span>specialname </span><span>rtspecialname </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>instance </span><span>void</span><span>&nbsp;&nbsp;</span><span>.</span><span>ctor</span><span>(</span><span>)</span><span> </span><span>cil</span><span> </span><span>managed</span></p><p><span>&nbsp;&nbsp;</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>// </span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>.</span><span>maxstack</span><span>&nbsp;&nbsp;</span><span>8</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0000</span><span>:</span><span>&nbsp;&nbsp;</span><span>ldarg</span><span>.</span><span>0</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0001</span><span>:</span><span>&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>instance </span><span>void</span><span> </span><span>[</span><span>mscorlib</span><span>]</span><span>System</span><span>.</span><span>Object</span><span>::</span><span>.</span><span>ctor</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0006</span><span>:</span><span>&nbsp;&nbsp;</span><span>nop</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>IL_0007</span><span>:</span><span>&nbsp;&nbsp;</span><span>ret</span></p><p><span>&nbsp;&nbsp;</span><span>}</span><span> </span><span>// end of method Program::.ctor</span></p><p><span>}</span><span> </span><span>// end of class Program.Program</span></p><p><span>// =============================================================</span></p><p><span>// </span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->

<p>There is nothing special in line <code>foo.Bar = new Bar();</code>. Let’s see it with WinDBG:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f65935e347709573" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>0</span><span>:</span><span>005</span><span>&gt;</span><span> </span><span>!</span><span>name2ee </span><span>ConsoleApp3</span><span>!</span><span>Program</span><span>.</span><span>Main</span></p><p><span>Module</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>005d4024</span></p><p><span>Assembly</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ConsoleApp3</span><span>.</span><span>exe</span></p><p><span>Token</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>06000003</span></p><p><span>MethodDesc</span><span>:</span><span>&nbsp;&nbsp;</span><span>005d4d34</span></p><p><span>Name</span><span>:</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>Program</span><span>.</span><span>Program</span><span>.</span><span>Main</span><span>(</span><span>System</span><span>.</span><span>String</span><span>[</span><span>]</span><span>)</span></p><p><span>JITTED </span><span>Code </span><span>Address</span><span>:</span><span> </span><span>007a0448</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->

<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659361240970309" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p></div>
				</td>
						<td><div><p><span>0</span><span>:</span><span>005</span><span>&gt;</span><span> </span><span>!</span><span>U</span><span> </span><span>007a0448</span></p><p><span>Normal </span><span>JIT </span><span>generated </span><span>code</span></p><p><span>Program</span><span>.</span><span>Program</span><span>.</span><span>Main</span><span>(</span><span>System</span><span>.</span><span>String</span><span>[</span><span>]</span><span>)</span></p><p><span>Begin</span><span> </span><span>007a0448</span><span>,</span><span> </span><span>size</span><span> </span><span>93</span></p><p><span>*</span><span>*</span><span>*</span><span> </span><span>WARNING</span><span>:</span><span> </span><span>Unable </span><span>to</span><span> </span><span>verify </span><span>checksum </span><span>for</span><span> </span><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>bin</span><span>\</span><span>Debug</span><span>\</span><span>ConsoleApp3</span><span>.</span><span>exe</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>8</span><span>:</span></p><p><span>&gt;&gt;&gt;</span><span> </span><span>007a0448</span><span> </span><span>55</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>push&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ebp</span></p><p><span>007a0449</span><span> </span><span>8bec</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ebp</span><span>,</span><span>esp</span></p><p><span>007a044b</span><span> </span><span>83ec18</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>sub&nbsp;&nbsp;&nbsp;&nbsp; </span><span>esp</span><span>,</span><span>18h</span></p><p><span>007a044e</span><span> </span><span>33c0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>xor</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>eax</span><span>,</span><span>eax</span></p><p><span>007a0450</span><span> </span><span>8945f0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>10h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a0453</span><span> </span><span>8945f8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>8</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a0456</span><span> </span><span>8945ec</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>14h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a0459</span><span> </span><span>8945e8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>18h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a045c</span><span> </span><span>894dfc</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>4</span><span>]</span><span>,</span><span>ecx</span></p><p><span>007a045f</span><span> </span><span>833dd0425d0000</span><span>&nbsp;&nbsp;</span><span>cmp&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr </span><span>ds</span><span>:</span><span>[</span><span>5D42D0h</span><span>]</span><span>,</span><span>0</span></p><p><span>007a0466</span><span> </span><span>7405</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>je</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>007a046d</span></p><p><span>007a0468</span><span> </span><span>e8c33e0d73&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>clr</span><span>!</span><span>JIT_DbgIsJustMyCode</span><span> </span><span>(</span><span>73874330</span><span>)</span></p><p><span>007a046d</span><span> </span><span>33d2</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>xor</span><span>&nbsp;&nbsp;&nbsp;&nbsp; </span><span>edx</span><span>,</span><span>edx</span></p><p><span>007a046f</span><span> </span><span>8955f4</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>0Ch</span><span>]</span><span>,</span><span>edx</span></p><p><span>007a0472</span><span> </span><span>90</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>nop</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>9</span><span>:</span></p><p><span>007a0473</span><span> </span><span>b9bc4d5d00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>5D4DBCh</span><span> </span><span>(</span><span>MT</span><span>:</span><span> </span><span>Foo</span><span>)</span></p><p><span>007a0478</span><span> </span><span>e84b2ce2ff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>005c30c8</span><span> </span><span>(</span><span>JitHelp</span><span>:</span><span> </span><span>CORINFO_HELP_NEWSFAST</span><span>)</span></p><p><span>007a047d</span><span> </span><span>8945f0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>10h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a0480</span><span> </span><span>8b4df0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>10h</span><span>]</span></p><p><span>007a0483</span><span> </span><span>ff15dc4d5d00&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dword </span><span>ptr </span><span>ds</span><span>:</span><span>[</span><span>5D4DDCh</span><span>]</span><span> </span><span>(</span><span>Foo</span><span>.</span><span>.</span><span>ctor</span><span>(</span><span>)</span><span>,</span><span> </span><span>mdToken</span><span>:</span><span> </span><span>06000001</span><span>)</span></p><p><span>007a0489</span><span> </span><span>8b45f0</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>eax</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>10h</span><span>]</span></p><p><span>007a048c</span><span> </span><span>8945f4</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>0Ch</span><span>]</span><span>,</span><span>eax</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>10</span><span>:</span></p><p><span>007a048f</span><span> </span><span>e850f84372&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mscorlib_ni</span><span>+</span><span>0xb5fce4</span><span> </span><span>(</span><span>72bdfce4</span><span>)</span><span> </span><span>(</span><span>System</span><span>.</span><span>GC</span><span>.</span><span>Collect</span><span>(</span><span>)</span><span>,</span><span> </span><span>mdToken</span><span>:</span><span> </span><span>06000e9b</span><span>)</span></p><p><span>007a0494</span><span> </span><span>90</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>nop</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>12</span><span>:</span></p><p><span>007a0495</span><span> </span><span>8b4df4</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>0Ch</span><span>]</span></p><p><span>007a0498</span><span> </span><span>e863abe072&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>clr</span><span>!</span><span>GCInterface</span><span>::</span><span>GetGeneration</span><span> </span><span>(</span><span>735ab000</span><span>)</span></p><p><span>007a049d</span><span> </span><span>8945f8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>8</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a04a0</span><span> </span><span>8b4df8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>8</span><span>]</span></p><p><span>007a04a3</span><span> </span><span>e8547f4372&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mscorlib_ni</span><span>+</span><span>0xb583fc</span><span> </span><span>(</span><span>72bd83fc</span><span>)</span><span> </span><span>(</span><span>System</span><span>.</span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>Int32</span><span>)</span><span>,</span><span> </span><span>mdToken</span><span>:</span><span> </span><span>06000b6e</span><span>)</span></p><p><span>007a04a8</span><span> </span><span>90</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>nop</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>13</span><span>:</span></p><p><span>007a04a9</span><span> </span><span>b9184e5d00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>5D4E18h</span><span> </span><span>(</span><span>MT</span><span>:</span><span> </span><span>Bar</span><span>)</span></p><p><span>007a04ae</span><span> </span><span>e8152ce2ff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call</span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>005c30c8</span><span> </span><span>(</span><span>JitHelp</span><span>:</span><span> </span><span>CORINFO_HELP_NEWSFAST</span><span>)</span></p><p><span>007a04b3</span><span> </span><span>8945ec</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>14h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a04b6</span><span> </span><span>8b4dec</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ecx</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>14h</span><span>]</span></p><p><span>007a04b9</span><span> </span><span>ff15384e5d00&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>dword </span><span>ptr </span><span>ds</span><span>:</span><span>[</span><span>5D4E38h</span><span>]</span><span> </span><span>(</span><span>Bar</span><span>.</span><span>.</span><span>ctor</span><span>(</span><span>)</span><span>,</span><span> </span><span>mdToken</span><span>:</span><span> </span><span>06000002</span><span>)</span></p><p><span>007a04bf</span><span> </span><span>8b55f4</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>edx</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>0Ch</span><span>]</span></p><p><span>007a04c2</span><span> </span><span>8b45ec</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>eax</span><span>,</span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>14h</span><span>]</span></p><p><span>007a04c5</span><span> </span><span>8d5204</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>lea&nbsp;&nbsp;&nbsp;&nbsp; </span><span>edx</span><span>,</span><span>[</span><span>edx</span><span>+</span><span>4</span><span>]</span></p><p><span>007a04c8</span><span> </span><span>e8b3e2d872&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>clr</span><span>!</span><span>JIT_WriteBarrierEAX</span><span> </span><span>(</span><span>7352e780</span><span>)</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>14</span><span>:</span></p><p><span>007a04cd</span><span> </span><span>e82a7e4372&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mscorlib_ni</span><span>+</span><span>0xb582fc</span><span> </span><span>(</span><span>72bd82fc</span><span>)</span><span> </span><span>(</span><span>System</span><span>.</span><span>Console</span><span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>,</span><span> </span><span>mdToken</span><span>:</span><span> </span><span>06000b65</span><span>)</span></p><p><span>007a04d2</span><span> </span><span>8945e8</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>dword </span><span>ptr</span><span> </span><span>[</span><span>ebp</span><span>-</span><span>18h</span><span>]</span><span>,</span><span>eax</span></p><p><span>007a04d5</span><span> </span><span>90</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>nop</span></p><p><span>C</span><span>:</span><span>\</span><span>Users</span><span>\</span><span>adafurma</span><span>\</span><span>source</span><span>\</span><span>repos</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>ConsoleApp3</span><span>\</span><span>Program</span><span>.</span><span>cs</span><span> </span><span>@</span><span> </span><span>15</span><span>:</span></p><p><span>007a04d6</span><span> </span><span>90</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>nop</span></p><p><span>007a04d7</span><span> </span><span>8be5</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>mov&nbsp;&nbsp;&nbsp;&nbsp; </span><span>esp</span><span>,</span><span>ebp</span></p><p><span>007a04d9</span><span> </span><span>5d</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>pop&nbsp;&nbsp;&nbsp;&nbsp; </span><span>ebp</span></p><p><span>007a04da</span><span> </span><span>c3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ret</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0046 seconds] -->

<p>You can see the write barrier here:</p>
<!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5e4a02f659365544037495" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="show">
					
				</td>
						<td><div><p><span>007a04c8</span><span> </span><span>e8b3e2d872&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>call&nbsp;&nbsp;&nbsp;&nbsp;</span><span>clr</span><span>!</span><span>JIT_WriteBarrierEAX</span><span> </span><span>(</span><span>7352e780</span><span>)</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->

<p>See the next question to understand how it can be used in .NET.</p>
<h6>64. What is a card table? Brick table?</h6>
<p>GC is capable of cleaning generation 0 only. What happens if the only reference to some object X (being in generation 0) is in a field of object Y which is in generation 1? How does GC know that it cannot remove X from the memory? This is thanks to the card table.</p>
<p>Object X must have been assigned to field in Y somehow. When this assignment was performed, .NET executed the write barrier (see previous question) which updated the card table.</p>
<p>Card table is a list of bits where each bit maintains 128 (in x86) or 256 (in x64) bytes of memory. When a bit is set, GC knows to include those bytes of memory as roots when performing the marking phase. Since card tables can be pretty big, they are grouped in card bundles (sometimes called card decks).</p>
<p>Brick table is similar structure covering 2kB and 4kB of memory (in x86 and x64 respectively). It is used by the GC to locate objects (technically plugs).</p>
<h6>Bonus — where do I learn more?</h6>
<p><a href="https://prodotnetmemory.com/">Pro .NET Memory Management</a> by Konrad Kokosa is a great book describing .NET GC into a great depth. If you want to learn more about memory reclamation internals then it is a must read.</p>
                                             </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>