<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Getting Started With BenchmarkDotNet &#x2013; The Sharper Dev -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Getting Started With BenchmarkDotNet – The Sharper Dev</h1><div><div class="entry-content"><figure class="wp-block-image size-large"><img src="https://i0.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash.jpg?resize=740%2C441&amp;ssl=1" alt="Rolling green hills." class="wp-image-439" srcset="https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?resize=1024%2C610&amp;ssl=1 1024w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?resize=300%2C179&amp;ssl=1 300w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?resize=768%2C457&amp;ssl=1 768w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?resize=1536%2C915&amp;ssl=1 1536w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?resize=2048%2C1219&amp;ssl=1 2048w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?w=1480&amp;ssl=1 1480w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/qingbao-meng-01_igFr7hd4-unsplash-scaled.jpg?w=2220&amp;ssl=1 2220w" sizes="(max-width: 740px) 100vw, 740px" data-recalc-dims="1"><figcaption> Photo by&nbsp;<a href="https://unsplash.com/@ideasboom?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Qingbao Meng</a>&nbsp;on&nbsp;<a href="https://unsplash.com/s/photos/nature?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption></figure><p><a rel="noreferrer noopener" aria-label="BenchmarkDotNet (opens in a new tab)" href="https://github.com/dotnet/BenchmarkDotNet" target="_blank">BenchmarkDotNet</a> is a great library for performance testing on the dotnet platform. On this blog I’ve used it to <a rel="noreferrer noopener" aria-label="benchmark different lists (opens in a new tab)" href="https://thesharperdev.com/the-cost-of-abstracting-a-list-in-csharp/" target="_blank">benchmark different lists</a>, <a rel="noreferrer noopener" aria-label="for loops (opens in a new tab)" href="https://thesharperdev.com/benchmarking-for-loop-variants/" target="_blank">for loops</a>, and the <a rel="noreferrer noopener" aria-label="cost of synchronous async methods (opens in a new tab)" href="https://thesharperdev.com/the-cost-of-synchronous-async-methods/" target="_blank">cost of synchronous async methods</a>. </p><p>A well written benchmark will help clarify and educate you about the performance of the code in question. Helping you write more performant applications. </p><p>Lets see how easy it is to get started.</p><h2>First Benchmark</h2><p>However you prefer, cli or Visual Studio, create a new C# project.</p><p>Then install the BenchmarkDotNet nuget package, at time of writing 0.12.0 is the latest version:</p><p>Nuget: <code>Install-Package BenchmarkDotNet -Version 0.12.0</code></p><p>CLI: <code>dotnet add package BenchmarkDotNet --version 0.12.0</code></p><p>That’s the only setup required. For our first benchmark lets demonstrate the benefits of using the <a rel="noreferrer noopener" aria-label="StringBuilder (opens in a new tab)" href="https://docs.microsoft.com/en-us/dotnet/api/system.text.stringbuilder?view=netcore-3.1" target="_blank">StringBuilder</a> class.</p><p>Paste this into a new file in your project.</p><figure class="wp-block-embed"><p>We’re just concatenating strings, one using regular string concatenation and the other using a StringBuilder. </p><p>Then change your Program.cs to the following:</p><figure class="wp-block-embed"><p>Then we’ll need to run this from the command line in release mode.</p><blockquote class="wp-block-quote"><p>Release mode is important because there are optimizations applied for release mode that aren’t for debug mode. Benchmarking in debug mode will lead to inconsistent results.</p></blockquote><p>If your project is setup like a normal dotnet project, Issue the following command from the folder that the .sln is in.</p><p><code>dotnet run -p .\BenchmarkIntro\ -c Release</code></p><p><em>The -p indicates which project to run and the -c indicates which mode to run it in (release)</em></p><p>On my machine that took about two minutes to run and at the end output the following chart.</p><figure class="wp-block-image size-large"><img src="https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/image-13.png?w=740&amp;ssl=1" alt="" class="wp-image-436" srcset="https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/image-13.png?w=913&amp;ssl=1 913w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/image-13.png?resize=300%2C47&amp;ssl=1 300w, https://i2.wp.com/thesharperdev.com/wp-content/uploads/2019/12/image-13.png?resize=768%2C120&amp;ssl=1 768w" sizes="(max-width: 740px) 100vw, 740px" data-recalc-dims="1"><figcaption>BenchmarkDotNet Results</figcaption></figure><p> The important columns to note are Method, N, Mean and Allocated. </p><pre class="wp-block-code"><code>|        Method |    N |       Mean | Allocated |
|-------------- |----- |-----------:|----------:|
| RegularString |  100 |   6.331 us |   23736 B |
| StringBuilder |  100 |   2.981 us |    1000 B |
| RegularString | 1000 | 292.629 us | 2849740 B |
| StringBuilder | 1000 |  28.689 us |    9096 B |</code></pre><ul><li>Method – which benchmark this is</li><li>N – what the value of N was.</li><li>Mean – how long the benchmark took</li><li>Allocated – how much memory was allocated during this benchmark.</li></ul><p>As you can see, the performance and memory usage of the Regular String benchmark is pretty terrible compared to the StringBuilder. </p><p>The reason being is C# strings are immutable. Every time we add a new character to our string we have to reallocate the entire string again. StringBuilder is mutable so it avoids all those memory allocations. </p><p>Generally the immutability of strings is beneficial, but if you’re doing a lot of string operations it’s often useful to use StringBuilder.</p><h2>Why Use BenchmarkDotNet</h2><p>I’m sure everyone has at some point broken out the timer to compare how fast a particular method might complete, or to compare two different methods.</p><p>That is at best a rudimentary benchmark, at worst it will lead to inconsistent results. </p><p>BenchmarkDotNet handles a lot of the important details that gives credibility to benchmark results. It will:</p><ol><li>Perform warmp ups benchmarks</li><li>Run the benchmark multiple times to ensure consistent results. </li><li>Automatically remove outliers that don’t conform with the rest of the results</li><li>It can run the benchmark against different .NET versions<ol><li>.NET Framework v .NET Core 2.2 vs .NET Core 3.0 Mono</li></ol></li><li>Run against different garbage collectors</li></ol><p>Basically a lot of ton of useful features.</p><p>Outside of those great features, one of the main benefits of benchmarking is really giving facts for or against a particular belief about programming.</p><p>I’ve picked up a lot of programming knowledge in my 10ish years since first learning Java. I’ve written code in a half dozen languages, at 6 different companies, picking up random bits from who knows where. </p><p>How much of what I believe true? I’d like to say a lot, but I know that’s not true. Benchmarking my beliefs is one of the easiest ways to know if it’s true or not. I’ve honestly been surprised by a benchmark result not agreeing with what I “thought” was true.</p><p>The same goes for you. It’s a great tool to aid in learning and self improvement.</p><p>It’s also a great tool to protect against performance problems in your apps before users encounter them. Ideally each application would have some sort of automated benchmark in their CI or CD pipeline. </p><p>How do you know whether your twenty user stories this sprint severely degraded app performance? You won’t know unless you’re measuring it. </p><h2>Closing Thoughts</h2><p>I strongly advocate that you benchmark more things. Good benchmarks give clarity to code and beliefs. </p><p>Benchmarking is a vital tool in the programmers toolbox. I’m glad tools like BenchmarkDotNet exist to make that task much easier.</p><h5>Links:</h5></figure></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>