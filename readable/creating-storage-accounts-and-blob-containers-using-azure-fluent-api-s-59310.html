<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Creating storage accounts and blob containers using Azure fluent API-s - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Creating storage accounts and blob containers using Azure fluent API-s - linksfor.dev(s)"/>
    <meta property="article:author" content="Gunnar Peipman"/>
    <meta property="og:description" content="Using new Azure fluent API-s to create Azure storage accounts and blob containers in code is easy, resulting in flexible and readable code."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://gunnarpeipman.com/azure-storage-fluent-api/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Creating storage accounts and blob containers using Azure fluent API-s</title>
<div class="readable">
        <h1>Creating storage accounts and blob containers using Azure fluent API-s</h1>
            <div>by Gunnar Peipman</div>
            <div>Reading time: 9-11 minutes</div>
        <div>Posted here: 05 Mar 2020</div>
        <p><a href="https://gunnarpeipman.com/azure-storage-fluent-api/">https://gunnarpeipman.com/azure-storage-fluent-api/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><p> Using Azure fluent API-s it is easy to create storage accounts and blob containers. After experimenting with fluent API of Azure storage I found it to be good match for <a title="Multi-tenant ASP.NET Core" href="https://gunnarpeipman.com/series/multi-tenant-aspnet-core/">multitenant web applications</a> where tenant files are held on Azure blob storage. I was surprised how clean and short code I got using fluent API. Here’s my overview of fluent API for Azure storage with some code samples I wrote.</p><h3>Getting started</h3><p>Before getting to code we need Azure portal account and some configuration parameters:</p><ul><li><strong>TenantId</strong> – ID of Azure AD tenant. Open Azure AD settings in Azure portal to get tenant ID.</li><li><strong>ClientId and ClientSecret</strong> – these are for service principal (or account) we want to use for accessing Azure services. To set up service principal please jump to Azure documentation page <a title="How to: Use the portal to create an Azure AD application and service principal that can access resources" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal">How to: Use the portal to create an Azure AD application and service principal that can access resources</a>.</li><li><strong>SubscriptionId</strong> – ID of Azure subscription where we want to create storage accounts. Open Subscriptions in Azure portal to get subscription ID.</li><li><strong>ResourceGroup</strong> – name of resource group under what storage accounts are created. Make sure the resource group exists already or create new one if you need.</li></ul><p>With settings ready it’s time to get into code.</p><h3>Fluent syntax for Azure blob storage</h3><p>There are few important things to know before implementing class to create storage accounts. Fluent syntax for Azure services uses IAzure interface as a bridge head to row of fluent method calls. When building IAzure instance we need to provide all configuration parameters mentioned above.</p><p>Here’s the example. Azure.Configure() method starts the row of fluent configuring methods to build up client class we will use later.</p><pre><span>var</span>&nbsp;<span>principalLogIn</span> = <span>new</span>&nbsp;<span>ServicePrincipalLoginInformation</span>();<br><span>principalLogIn</span>.ClientId = ClientId;<br><span>principalLogIn</span>.ClientSecret = ClientSecret;<p> <span>var</span>&nbsp;<span>environment</span> = <span>AzureEnvironment</span>.AzureGlobalCloud;<br><span>var</span>&nbsp;<span>credentials</span> = <span>new</span>&nbsp;<span>AzureCredentials</span>(<span>principalLogIn</span>, TenantId, <span>environment</span>);</p><p> _azure = <span>Azure</span>.<span>Configure</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithLogLevel</span>(<span>HttpLoggingDelegatingHandler</span>.<span>Level</span>.Basic)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>Authenticate</span>(<span>credentials</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithSubscription</span>(SubscriptionId);</p></pre><p>To create blob storage account we will use initialized Azure client like shown in the following example.</p><pre><span>await</span> _azure.StorageAccounts.<span>Define</span>(<span>accountName</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithRegion</span>(<span>Region</span>.EuropeWest)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithExistingResourceGroup</span>(ResourceGroup)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithAccessFromAllNetworks</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithGeneralPurposeAccountKindV2</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithOnlyHttpsTraffic</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithSku</span>(<span>StorageAccountSkuType</span>.Standard_LRS)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>CreateAsync</span>();</pre><p>Although fluent methods shown above are just few of those provided, notice how new account is defined using clear and readable fluent methods that specify important aspects of account. Finally CreateAsync() method is called and then new storage account is created.</p><p>Similar fluent API-s are available also for some other Azure services and in big part they follow the same idea as shown here with Azure storage account.</p><h3>Creating storage account and blob containers</h3><p>It’s time to get to code and build something real. Let’s start with NuGet packages we need in our project:</p><ul><li>Microsoft.Azure.Management.Fluent</li><li>Microsoft.Azure.Management.Storage.Fluent</li><li>WindowsAzure.Storage (if you want to manage blobs in containers)</li></ul><p>To try fluent storage API-s out, it doesn’t matter much what kind of application to create – be it console or web application or maybe Azure Function. I decided to go with web application as I’m building demo tenants manager application for some of my blog posts.</p><p>When new tenant is created we need to create also storage account for it and add blob containers that multitenant application expects to exist. Tenant can be created using long spaghetti code but I don’t like chaos and therefore I want more intelligent approach. Let’s try to write simple client class for creating storage accounts for tenants.</p><p>I start with simple interface.</p><pre><span>public</span>&nbsp;<span>interface</span>&nbsp;<span>IStorageManager</span><br>{<br>&nbsp;&nbsp;&nbsp; <span>Task</span>&nbsp;<span>CreateAccountWithFolders</span>(<span>string</span>&nbsp;<span>name</span>, <span>params</span>&nbsp;<span>string</span>[] <span>container</span>);<br>}</pre><p>CreateAccountWithFolders() method takes new storage account name and array of container names that must be created with account. For this blog post this minimalistic interface is enough.</p><p>Let’s add a class called AzureBlobStorageManager to our solution. Here are namespaces used in this class.</p><pre><span>using</span> System;<br><span>using</span> System.Threading.Tasks;<br><span>using</span> Microsoft.Azure.Management.Fluent;<br><span>using</span> Microsoft.Azure.Management.ResourceManager.Fluent;<br><span>using</span> Microsoft.Azure.Management.ResourceManager.Fluent.Authentication;<br><span>using</span> Microsoft.Azure.Management.ResourceManager.Fluent.Core;<br><span>using</span> Microsoft.Azure.Management.Storage.Fluent;<br><span>using</span> Microsoft.Azure.Management.Storage.Fluent.Models;</pre><p>Class to create Azure storage accounts is here. Notice you need all configuration parameter values now to make the class actually work.</p><pre><span>public</span>&nbsp;<span>class</span>&nbsp;<span>AzureBlobStorageManager</span> : <span>IStorageManager</span><br>{<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>const</span>&nbsp;<span>string</span> TenantId = <span>"4dcea3b0-b401-4b25-af70-971068b99d1c"</span>;<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>const</span>&nbsp;<span>string</span> ClientId = <span>"9cce9aed-69eb-45af-9bed-a5d7e403019f"</span>;<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>const</span>&nbsp;<span>string</span> ClientSecret = <span>"74d99bc5-e239-4308-ba15-e3e2acdb7fcf"</span>;<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>const</span>&nbsp;<span>string</span> SubscriptionId = <span>"6ca601d2-417f-4fa4-ae19-cd465102f8de"</span>;<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>const</span>&nbsp;<span>string</span> ResourceGroup = <span>"TestResourceGroup"</span>;<p> &nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>readonly</span>&nbsp;<span>IAzure</span> _azure;</p><p> &nbsp;&nbsp;&nbsp; <span>public</span>&nbsp;<span>AzureBlobStorageManager</span>()<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>principalLogIn</span> = <span>new</span>&nbsp;<span>ServicePrincipalLoginInformation</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>principalLogIn</span>.ClientId = ClientId;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>principalLogIn</span>.ClientSecret = ClientSecret;</p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>environment</span> = <span>AzureEnvironment</span>.AzureGlobalCloud;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>credentials</span> = <span>new</span>&nbsp;<span>AzureCredentials</span>(<span>principalLogIn</span>, TenantId, <span>environment</span>);</p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _azure = <span>Azure</span>.<span>Configure</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithLogLevel</span>(<span>HttpLoggingDelegatingHandler</span>.<span>Level</span>.Basic)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>Authenticate</span>(<span>credentials</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithSubscription</span>(SubscriptionId);<br>&nbsp;&nbsp;&nbsp; }</p><p> &nbsp;&nbsp;&nbsp; <span>public</span>&nbsp;<span>async</span>&nbsp;<span>Task</span>&nbsp;<span>CreateAccountWithFolders</span>(<span>string</span>&nbsp;<span>accountName</span>, <span>params</span>&nbsp;<span>string</span>[] <span>containerNames</span>)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>availabilityResult</span> = <span>await</span> _azure.StorageAccounts.<span>CheckNameAvailabilityAsync</span>(<span>accountName</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>if</span>(!<span>availabilityResult</span>.IsAvailable.Value)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>throw</span>&nbsp;<span>new</span>&nbsp;<span>Exception</span>(<span>"Account name is not available"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>account</span> = <span>await</span> _azure.StorageAccounts.<span>Define</span>(<span>accountName</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithRegion</span>(<span>Region</span>.EuropeWest)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithExistingResourceGroup</span>(ResourceGroup)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithAccessFromAllNetworks</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithGeneralPurposeAccountKindV2</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithOnlyHttpsTraffic</span>()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithSku</span>(<span>StorageAccountSkuType</span>.Standard_LRS)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>CreateAsync</span>();</p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>var</span>&nbsp;<span>containers</span> = <span>account</span>.Manager.BlobContainers;</p><p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>foreach</span> (<span>var</span>&nbsp;<span>containerName</span>&nbsp;<span>in</span>&nbsp;<span>containerNames</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>await</span>&nbsp;<span>containers</span>.<span>DefineContainer</span>(<span>containerName</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithExistingBlobService</span>(ResourceGroup, <span>accountName</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>WithPublicAccess</span>(<span>PublicAccess</span>.None)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .<span>CreateAsync</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp; }<br>}</p></pre><p>For web applications we can register this class in framework-level dependency injection to inject it to controllers. This is how ConfigureServices() method of my Starpup class looks like.</p><pre><span>public</span>&nbsp;<span>void</span>&nbsp;<span>ConfigureServices</span>(<span>IServiceCollection</span>&nbsp;<span>services</span>)<br>{<br>&nbsp;&nbsp;&nbsp; <span>services</span>.<span>AddControllersWithViews</span>();<br>&nbsp;&nbsp;&nbsp; <span>services</span>.<span>AddScoped</span>&lt;<span>IStorageManager</span>, <span>AzureBlobStorageManager</span>&gt;();<br>}</pre><p>And here is the minimalistic example of controller that makes use of IStorageManager.</p><pre><span>public</span>&nbsp;<span>class</span>&nbsp;<span>HomeController</span> : <span>Controller</span><br>{<br>&nbsp;&nbsp;&nbsp; <span>private</span>&nbsp;<span>readonly</span>&nbsp;<span>IStorageManager</span> _storageManager;<p> &nbsp;&nbsp;&nbsp; <span>public</span>&nbsp;<span>HomeController</span>(<span>IStorageManager</span>&nbsp;<span>storageManager</span>)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _storageManager = <span>storageManager</span>;<br>&nbsp;&nbsp;&nbsp; }</p><p> &nbsp;&nbsp;&nbsp; <span>// ...</span></p><p> &nbsp;&nbsp;&nbsp; [<span>HttpPost</span>]<br>&nbsp;&nbsp;&nbsp; <span>public</span>&nbsp;<span>async</span>&nbsp;<span>Task</span>&lt;<span>IActionResult</span>&gt; <span>Edit</span>(<span>string</span>&nbsp;<span>account</span>)<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>await</span> _storageManager.<span>CreateAccountWithFolders</span>(<span>account</span>, <span>"images"</span>, <span>"documents"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span>return</span>&nbsp;<span>View</span>();<br>&nbsp;&nbsp;&nbsp; }</p><p> &nbsp;&nbsp;&nbsp; <span>// ...</span><br>}</p></pre><p>Using the code above I created new storage account with two blob containers – documents and images.</p><p><img width="802" height="355" title="Azure storage account and blob containers" alt="Azure storage account and blob containers" src="https://static.gunnarpeipman.com/wp-content/uploads/2020/03/azure-blob-storage-containers.png" data-src="https://static.gunnarpeipman.com/wp-content/uploads/2020/03/azure-blob-storage-containers.png"></p><p>In practice we don’t get away so easily as we need to read out storage connection string after account is created and probably we also need SAS key for another services that access files on Azure storage. But with simple client class shown here you have good starting point for your own Azure storage management client.</p><h3>Wrapping up</h3><p>Although it was just an experiment to see how fluent API for Azure storage works, it was good find. When creating Azure storage accounts in code it’s important to have a good overview of features that new account will have. With fluent API-s I was able to write the code that looks like specification defining new account to be created. Good news is that there are similar fluent API-s available for other Azure services too.</p></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>