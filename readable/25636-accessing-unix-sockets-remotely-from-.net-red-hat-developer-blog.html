<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Accessing UNIX sockets remotely from .NET - Red Hat Developer Blog -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="grid">
            <h1>Accessing UNIX sockets remotely from .NET - Red Hat Developer Blog</h1>
        
<div class="readable"><article id="post-598497" class="post-598497 post type-post status-publish format-standard has-post-thumbnail hentry category-linux category-operating-system category-security"> <div class="entry-content standard-post"> <img width="1566" src="https://developers.redhat.com/blog/wp-content/uploads/2019/05/ssh-unix-sockets.jpg" class="single-post-featured-img wp-post-image" alt="Accessing UNIX sockets remotely from .NET" srcset="https://developers.redhat.com/blog/wp-content/uploads/2019/05/ssh-unix-sockets.jpg 1566w, https://developers.redhat.com/blog/wp-content/uploads/2019/05/ssh-unix-sockets-300x155.jpg 300w, https://developers.redhat.com/blog/wp-content/uploads/2019/05/ssh-unix-sockets-768x397.jpg 768w, https://developers.redhat.com/blog/wp-content/uploads/2019/05/ssh-unix-sockets-1024x529.jpg 1024w" sizes="(max-width: 1566px) 100vw, 1566px"> <p>Many Linux services (like D-Bus, PostgreSQL, Docker, etc.) are made accessible locally using a UNIX socket. In this article, we&#x2019;ll show how you can access such services remotely from .NET using SSH port forwarding.<span id="more-598497"></span></p>
<h2>UNIX sockets</h2>
<p><a href="http://man7.org/linux/man-pages/man7/unix.7.html">UNIX domain sockets</a> provide a way to exchange data between processes running on the same host. This approach also brings some security features. First, it isn&#x2019;t possible to access them via the network. Second, we can identify the userid of the other process and use that to authorize the user. And, finally, UNIX domain sockets are identified with a path in the file system. To access a service, the user must have permissions to the path. <a href="https://en.wikipedia.org/wiki/Security-Enhanced_Linux">SELinux</a> allows even more fine-grained control.</p>
<p>To access such services remotely, we could make them accessible using TCP sockets instead of UNIX sockets. However, this makes the service responsible for implementing authentication (identifying users) and encryption (ensuring the messages can&#x2019;t be understood by a third party). Alternatively, we can use SSH port forwarding.</p>
<h2>SSH port forwarding</h2>
<p><a href="https://www.ssh.com/ssh/">Secure shell (SSH)</a> is a well-known, secure mechanism for running commands on a remote machine. SSH includes a mechanism for authenticating against the remote system, and it provides an encrypted channel for communication.</p>
<p>A (perhaps less known) feature of SSH is its ability to forward ports. Port forwarding means that a remote socket is made available locally. To do that, the <code>ssh</code> client program will open up a local socket and any connection made to that socket will be forwarded over the secure channel and delivered to the socket on the remote machine by the SSH server.</p>
<p>A port forward can be set up by passing the <code>-L</code> flag to the <code>ssh</code> client:</p>
<pre>-L [bind_address:]port:host:hostport
-L [bind_address:]port:remote_socket
-L local_socket:host:hostport
-L local_socket:remote_socket
</pre>
<p>As you can see, we need to specify the local end and the remote end. We can use UNIX sockets (identified by a file system path) or TCP sockets (identified as a <code>host:port</code>).</p>
<p>For example, to make the remote PostgreSQL server running on <code>mydbserver.org</code> available on the local machine at port <code>1234</code>, we can use the following command:</p>
<pre>ssh -L localhost:1234:/var/run/postgresql/.s.PGSQL.5432 mydbserver.org sleep 10
</pre>
<p>Our <code>-L</code> argument has <code>localhost:1234</code> for the local TCP end and the path <code>/var/run/postgresql/.s.PGSQL.5432</code> as the remote UNIX socket end. We are providing the <code>sleep 10</code> command to make the <code>ssh</code> command exit in case no TCP connections are forwarded in 10 seconds.</p>
<p>The <code>ssh</code> program is not only available on Linux, but it is also part of Windows 10. In the next section, we&#x2019;ll wrap it with a .NET class to provide a cross-platform way to set up a port forward.</p>
<h2>Port forwarding from .NET</h2>
<p><a href="https://raw.githubusercontent.com/tmds/dotnet-linux-howto/master/PortForward/PortForward.cs">PortForward.cs</a> provides a simple <code>PortForward</code> class that wraps the <code>ssh</code> client to do port forwarding.</p>
<p>The following example shows how to use it in combination with the <a href="https://www.nuget.org/packages/Npgsql/">Npgsql package</a> to connect to a PostgreSQL server:</p>
<pre>using (var portForward = await PortForward.ForwardAsync(&quot;tmds@192.168.100.169:/var/run/postgresql/.s.PGSQL.5432&quot;))
{
    var connectionString = $&quot;Server={portForward.IPEndPoint.Address};Port={portForward.IPEndPoint.Port};Database=postgres;User ID=tmds&quot;;
    using (var connection = new NpgsqlConnection(connectionString))
    {
        connection.Open();
        Console.WriteLine($&quot;PostgreSQL version: {connection.PostgreSqlVersion}&quot;);
    }
}
</pre>
<p>In this example, we are using the preconfigured private key of the user. You can also explicitly specify a key file using <code>PortForwardOptions.IdentityFile</code>:</p>
<pre>var portForward = await PortForward.ForwardAsync(..., o =&gt; o.IdentityFile = &quot;mysecretkeyfile&quot;);
</pre>
<h2>Conclusion</h2>
<p>In this article, you&#x2019;ve learned how SSH port forwarding allows you to access remote UNIX sockets. We&#x2019;ve shown how you can set up port forwarding using the <code>ssh</code> client program and use that from a .NET application.</p> <div class="addtoany_share_save_container addtoany_content addtoany_content_bottom"><div class="a2a_kit a2a_kit_size_16 addtoany_list"><a class="a2a_button_facebook" href="https://www.addtoany.com/add_to/facebook?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_twitter" href="https://www.addtoany.com/add_to/twitter?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_google_plus" href="https://www.addtoany.com/add_to/google_plus?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_linkedin" href="https://www.addtoany.com/add_to/linkedin?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_email" href="https://www.addtoany.com/add_to/email?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_print" href="https://www.addtoany.com/add_to/print?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_reddit" href="https://www.addtoany.com/add_to/reddit?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_button_flipboard" href="https://www.addtoany.com/add_to/flipboard?linkurl=https%3A%2F%2Fdevelopers.redhat.com%2Fblog%2F2019%2F05%2F30%2Faccessing-unix-sockets-remotely-from-net%2F&amp;linkname=Accessing%20UNIX%20sockets%20remotely%20from%20.NET"></a><a class="a2a_dd addtoany_share_save addtoany_share" href="https://www.addtoany.com/share"><img src="https://static.addtoany.com/buttons/favicon.png" alt="Share"></a></div></div> </div> </article></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>