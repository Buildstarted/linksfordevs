<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Add System.Text.Json benchmarks for comparison. by NickCraver &#xB7; Pull Request #701 &#xB7; dotnet/performance &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Add System.Text.Json benchmarks for comparison. by NickCraver · Pull Request #701 · dotnet/performance · GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><p>This is an attempt to add System.Text.Json's JSON serialization to the comparison microbenchmarks.  We're trying to get an apples to apples comparison of serializers we can use in .NET Core for ASP.NET Core and async streams. We figured adding them here for everyone is the best course of action.</p><p>Note: this test series fails with one of the generic type payloads. There is an exception in the serialization of <code>Dictionary&lt;int, string&gt;</code> isn't a valid thing for <code>System.Text.Json</code> to handle as of 3.0 preview 7. The rest seems to work well and...I hope I added these correctly</p><p>Here's an error trace from the failing tests on System.Text.Json with the <code>CollectionsOfPrimitives</code> type specifically:</p><pre><code>System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation.
 ---&gt; System.NotSupportedException: The collection type 'System.Collections.Generic.Dictionary`2[System.Int32,System.String]' on 'MicroBenchmarks.Serializers.CollectionsOfPrimitives.Dictionary' is not supported.
   at System.Text.Json.JsonClassInfo.GetElementType(Type propertyType, Type parentType, MemberInfo memberInfo, JsonSerializerOptions options)
   at System.Text.Json.JsonClassInfo.CreateProperty(Type declaredPropertyType, Type runtimePropertyType, PropertyInfo propertyInfo, Type parentClassType, JsonSerializerOptions options)
   at System.Text.Json.JsonClassInfo.AddProperty(Type propertyType, PropertyInfo propertyInfo, Type classType, JsonSerializerOptions options)
   at System.Text.Json.JsonClassInfo..ctor(Type type, JsonSerializerOptions options)
   at System.Text.Json.JsonSerializerOptions.GetOrAddClass(Type classType)
   at System.Text.Json.WriteStackFrame.Initialize(Type type, JsonSerializerOptions options)
   at System.Text.Json.JsonSerializer.WriteCore(Utf8JsonWriter writer, PooledByteBufferWriter output, Object value, Type type, JsonSerializerOptions options)
   at System.Text.Json.JsonSerializer.WriteCore(PooledByteBufferWriter output, Object value, Type type, JsonSerializerOptions options)
   at System.Text.Json.JsonSerializer.WriteCoreString(Object value, Type type, JsonSerializerOptions options)
   at System.Text.Json.JsonSerializer.Serialize[TValue](TValue value, JsonSerializerOptions options)
   at MicroBenchmarks.Serializers.Json_ToString`1.SystemTextJson_() in C:\git\NickCraver\performance\src\benchmarks\micro\Serializers\Json_ToString.cs:line 38
   at BenchmarkDotNet.Autogenerated.Runnable_89.WorkloadActionNoUnroll(Int64 invokeCount) in C:\git\NickCraver\performance\artifacts\bin\MicroBenchmarks\Release\netcoreapp3.0\4645516e-6e5e-4e7e-8b18-05ede5ec7e66\4645516e-6e5e-4e7e-8b18-05ede5ec7e66.notcs:line 58161
   at BenchmarkDotNet.Engines.Engine.RunIteration(IterationData data)
   at BenchmarkDotNet.Engines.EngineFactory.Jit(Engine engine, Int32 jitIndex, Int32 invokeCount, Int32 unrollFactor)
   at BenchmarkDotNet.Engines.EngineFactory.CreateReadyToRun(EngineParameters engineParameters)
   at BenchmarkDotNet.Autogenerated.Runnable_89.Run(IHost host, String benchmarkName) in C:\git\NickCraver\performance\artifacts\bin\MicroBenchmarks\Release\netcoreapp3.0\4645516e-6e5e-4e7e-8b18-05ede5ec7e66\4645516e-6e5e-4e7e-8b18-05ede5ec7e66.notcs:line 57838
   --- End of inner exception stack trace ---
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Object[] arguments, Signature sig, Boolean constructor, Boolean wrapExceptions)
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)
   at BenchmarkDotNet.Autogenerated.UniqueProgramName.AfterAssemblyLoadingAttached(String[] args) in C:\git\NickCraver\performance\artifacts\bin\MicroBenchmarks\Release\netcoreapp3.0\4645516e-6e5e-4e7e-8b18-05ede5ec7e66\4645516e-6e5e-4e7e-8b18-05ede5ec7e66.notcs:line 137
// AfterAll
</code></pre><p>Open questions:</p><ul><li>Is the usage right, or can it be more efficient?</li><li>Is the <code>#if NETCOREAPP3_0</code> correct? (I used <code>Perf.Enumerable.cs</code> as a reference for closest-to-this)</li><li>What do we want to do for the breaking <code>Dictionary&lt;int, string&gt;</code> runs?</li></ul><p>cc <a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/deanward81/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/deanward81">@deanward81</a><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell">@mgravell</a><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/benaadams/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/benaadams">@benaadams</a><a class="user-mention" data-hovercard-type="user" data-hovercard-url="/users/stevejgordon/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stevejgordon">@stevejgordon</a></p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>