<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using Bing Maps in Blazor with JSInterop and TypeScript - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Using Bing Maps in Blazor with JSInterop and TypeScript - linksfor.dev(s)"/>
    <meta property="article:author" content="Louis Hendricks"/>
    <meta property="og:description" content="In this article we are going to work with the Bing Maps web control in a client side Blazor application. As there is not a Blazor native&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://itnext.io/using-bing-maps-in-blazor-with-jsinterop-and-typescript-90e888e0e2fd"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Using Bing Maps in Blazor with JSInterop and TypeScript</title>
<div class="readable">
        <h1>Using Bing Maps in Blazor with JSInterop and TypeScript</h1>
            <div>by Louis Hendricks</div>
            <div>Reading time: 13-16 minutes</div>
        <div>Posted here: 20 May 2019</div>
        <p><a href="https://itnext.io/using-bing-maps-in-blazor-with-jsinterop-and-typescript-90e888e0e2fd">https://itnext.io/using-bing-maps-in-blazor-with-jsinterop-and-typescript-90e888e0e2fd</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><section><div><div><div><div><div><div><p><a href="https://itnext.io/@haywireiv?source=post_page-----90e888e0e2fd----------------------" rel="noopener"><img alt="Louis Hendricks" src="https://miro.medium.com/fit/c/48/48/0*JrTGoB9PgIok59kl.jpg" width="48" height="48"></a></p></div></div></div></div><p id="c86f" data-selectable-paragraph="">In this article we are going to work with the Bing Maps web control in a client side Blazor application. As there is not a Blazor native Bing Maps control we will be using TypeScript to access the Bing Maps API. In order to communicate with TypeScript from C# we will be making use of <code>JSRuntime</code> calls in Blazor.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/30/1*cG6lztM1Z8X8eFm3DtVb6g.png?q=20" width="3000" height="1000" role="presentation"></p><p><img width="3000" height="1000" role="presentation" src="https://miro.medium.com/max/3000/1*cG6lztM1Z8X8eFm3DtVb6g.png"></p></div></div></div></div></figure><p id="9d99" data-selectable-paragraph="">All the work in this article is being done with Visual Studio 2019 Community Edition 16.1 Preview 3. Everything will work with .Net Core 3 Preview 4 or Preview 5. Start a new project using the Blazor (ASP.Net Core Hosted) template.</p><p id="af8e" data-selectable-paragraph="">To use this you will also need your own Bing Maps API key. You can sign up for your own free key at <a href="https://www.bingmapsportal.com/" target="_blank" rel="noopener">https://www.bingmapsportal.com/</a> .</p><p id="14d1" data-selectable-paragraph="">I am doing all of my client side Blazor development using MVVM. That is not part of this article, but if you are wondering why I’m creating folders in my project named Views and Models that is the reason. If you are interested in reading my Blazor MVVM articles the first article is linked below.</p><p id="f8d2" data-selectable-paragraph="">The Bing Maps 8 Web API is a Microsoft Javascript API. To make it accessible to the TypeScript we will be writing we are going to add a <code>&lt;script&gt;</code> tag to the <code>index.html</code> in our <code>wwwroot</code> folder of our client project. Edit <code>index.html</code> and add this line right before <code>&lt;/body&gt;</code>:</p><pre><span id="3060" data-selectable-paragraph="">&lt;script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=MyBingKey' &gt;&lt;/script&gt;</span></pre><p id="857d" data-selectable-paragraph="">Make sure you edit the above line to replace MyBingKey with your actual key you received when you registered. With that in place the Bing Maps API will now be available to your code.</p><p id="edda" data-selectable-paragraph="">Bing Maps requires the name of a <code>&lt;div&gt;</code> to initialize itself. To make this available to Bing we are going to add a new component to the Blazor sample template and put the needed &lt;div&gt; in it. For my project I made a new folder and named it Views and inside of that folder I added a new Razor View and named it <code>SiteMapper.razor</code>. You can use whatever naming you are comfortable with, mine is specific to a mapping project that I am working on. Inside of your new component enter the following code:</p><figure><div></div></figure><p id="558f" data-selectable-paragraph="">For some reason setting height to 100% doesn’t work but using the viewport height relative length does. We now have a <code>&lt;div&gt;</code> with the id myMap which Bing Maps can use.</p><p id="ef2a" data-selectable-paragraph="">After our component is created we need to go add it to <code>NavMenu.razor</code> in the <code>Pages</code> folder to make it appear when we launch our application. We will also need to make a copy of <code>_Imports.razor</code> and place it into our Views folder.</p><p id="eada" data-selectable-paragraph="">Blazor will already compile TypeScript that is added to the built in client project out of the box; we only need to set up our folder structure. We are also going to add the Bing Map 8 TypeScript definition files to our project to give us Intellisense for Bing Maps when we are editing our TypeScript. Underneath our <code>wwwroot</code> folder add a new folder and name it ts. To get our definitions for Intellisense go here and down load the definition files:</p><p id="2b37" data-selectable-paragraph="">Make a new folder under your <code>ts</code> folder and name it <code>types</code>. Copy everything from below the <code>types</code> folder in the definitions you just downloaded into that folder. Also make an <code>interfaces</code> folder below your <code>ts</code> folder which we will use a little bit later. Your folder structure under TS will look like this:</p><figure><div><div><div><p><img src="https://miro.medium.com/max/30/1*MYg-ZQefhZMXZj1DWQV2Qw.png?q=20" width="332" height="161" role="presentation"></p><p><img width="332" height="161" role="presentation"></p></div></div></div></figure><p id="b013" data-selectable-paragraph="">With our folders set up and our definitions in place we can add our first TypeScript file. In the <code>ts</code> folder add a new TypeScript file and name it <code>BingTsInterop.ts</code>. Inside of that TypeScript file add the following content:</p><figure><div></div></figure><p id="b636" data-selectable-paragraph="">The first line is a reference which is similar to a using statement in C#. It is telling our TypeScript about the definition files we have available and providing us with IntelliSense. Line 3 is declaring a single instance of our BingMap class which is defined in lines 5 though 15. The class contains an instance of a <code>Map</code> and a constructor which creates a new map which will be placed in the <code>myMap</code> div. The constructor also specifies some <code>MapLoadOptions</code>, in this case the center of the map, the map type and the zoom level.</p><p id="db78" data-selectable-paragraph="">The <code>loadMap()</code>function on line 17 through 19 assigns a new instance of our <code>BingMap</code> class to <code>bingMap</code>. This is the function we want to call from JSInterop.</p><p id="78ca" data-selectable-paragraph="">If we do a build now we will see that <code>BingTSInterop.ts</code> has been compiled to create <code>BingTSInterop.js</code>. Now that we have our output go back into <code>index.html</code> and make it available to our application with this tag:</p><pre><span id="d13d" data-selectable-paragraph="">&lt;script src="./ts/BingTsInterop.js"&gt;&lt;/script&gt;</span></pre><p id="1852" data-selectable-paragraph="">To add the needed C# to our component lets add a code behind file. In the Views folder add a new C# class and name it <code>SiteMapper.razor.cs</code>. Change the class’ name to <code>SiteMapperBase</code> and have it inherit from <code>ComponentBase</code>. To make a call to TypeScript we will need to also add <code>using MicrosoftJSInterop;</code> to our using statements. Our class will look like this:</p><figure><div></div></figure><p id="a2c3" data-selectable-paragraph="">The class is pretty simple so far. We have one property, <code>JSRuntime</code> which has been injected to our class and we have are overriding <code>OnAfterRenderAsync()</code> to make our call to <code>loadMap</code>. Because there is no return value from <code>loadMap</code> we are using <code>InvokeAsync&lt;Task&gt;.</code> If there had been a return value we would need an appropriate type specified.</p><p id="f247" data-selectable-paragraph="">With our code behind set up we can go back into <code>SiteMapper.razor</code> and add the following line just below the <code>@page</code> directive.</p><pre><span id="d18c" data-selectable-paragraph="">@inherits SiteMapperBase</span></pre><p id="09e6" data-selectable-paragraph="">With that in place our code behind will now be part our View without needing to keep everything in a single file. At this point we can launch our application.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/30/1*TpoRnu8nmU5EMqXDf_o2WQ.png?q=20" width="1439" height="750" role="presentation"></p><p><img width="1439" height="750" role="presentation"></p></div></div></div></div></figure><p id="1918" data-selectable-paragraph="">As soon as our component finishes rendering we now call our TypeScript <code>loadMap</code> function. We can change the view or settings of the map then navigate to a different control and come back and <code>loadMap</code> will be called again and set it back to the default values.</p><p id="f603" data-selectable-paragraph="">Now that we have a map let’s do something with it. A pretty common task with maps is to place a pushpin on it. There is a very large repository of Bing Maps samples at <a href="https://bingmapsv8samples.azurewebsites.net/" target="_blank" rel="noopener">https://bingmapsv8samples.azurewebsites.net/</a> . I’m a fan of the SVG Template Pushpin (it looks clean and the color is easy to set) so let’s look at that code:</p><figure><div></div></figure><p id="f59d" data-selectable-paragraph="">There’s a bit of code but most of it is static code to making the pin. The main points of interest to us are the call to <code>map.getCenter()</code> on the first line which determines the location of the pin in that code sample and then on line 10 where the color gets set to blue. If we can pass in the location and color we will have a reusable pushpin. Our goal is to wire up all of ourTypeScript in a way that we can forget that it is there and focus on doing the real work in Blazor. In order to do that we need a reliable way to pass data in to TypeScript.</p><p id="674c" data-selectable-paragraph="">We can see by looking at the code that <code>color</code> is a string but what is <code>map.getCenter()</code>? If we type that function into our TypeScript file we can mouse hover over it and see that it returns a <code>Microsoft.Maps.Location</code>. We’re already using that type in the <code>BingMap</code> constructor. If we mouse hover over that type we can see <code>constructor Microsoft.Maps.Location(latitude:any, longitude:any)</code> so it looks like we need to pass a color, latitude and longitude into TypeScript to generate a custom pushpin. How do we send all 3 values over using JSInterop? We could send them as 3 objects using <code>args[]</code> but I have a feeling that will make our code harder to read. It would be better if they were all members of one object.</p><p id="c452" data-selectable-paragraph="">TypeScript, just like C#, allows us to write interfaces to use as contracts in our code. We are going to create a Typescript interface for our input and then create the same data structure in C# and pass it in from Blazor. If everything works as expected we’ll be able to create our own object in Blazor and pass it directly to TypeScript.</p><p id="33c3" data-selectable-paragraph="">Go to the <code>wwwroot/ts/interfaces</code> folder we created earlier and create a new TypeScript file in it and name it <code>BingMapsInterfaces.ts</code>. We decided we wanted a string and a location earlier so put this code into the file:</p><figure><div></div></figure><p id="e161" data-selectable-paragraph="">This is the syntax for a TypeScript interface. We first declare an interface and name it and then declare the members. Except for the typing syntax it is really close to C#. In order to make this interface available to our code we will add a new reference to <code>BingTsInterop.ts</code>.</p><pre><span id="5d17" data-selectable-paragraph="">/// &lt;reference path="interfaces/BingMapsInterfaces.ts" /&gt;</span></pre><p id="ec90" data-selectable-paragraph="">That statement makes anything we create in <code>BingMapsInterfaces.ts</code> available to our code. Next we will go back to our Blazor code and create what we hope will be a matching class.</p><p id="e568" data-selectable-paragraph="">Make a <code>Models</code> folder in the client project and then create a new C# class and name it <code>BingMapObjects.cs</code>. First we will create our <code>Location</code> class. In Typescript we had <code>number</code> for latitude and longitude, here we will use <code>double</code>. We will also add a constructor to make our code cleaner when we are assigning values.</p><figure><div></div></figure><p id="d998" data-selectable-paragraph="">With the <code>Location</code> defined we can now make a <code>Pushpin</code> class. This will simply be the color and the location.</p><figure><div></div></figure><p id="706c" data-selectable-paragraph="">If we wired up everything correctly we will be able to add a pushpin to our map from Blazor now. Go back into <code>SiteMapper.razor.cs</code> and add this code to our <code>OnAfterRenderAsync</code> method:</p><figure><div></div></figure><p id="8052" data-selectable-paragraph="">Now create the <code>AddPushpin</code> function in BingTsInterop.ts:</p><figure><div></div></figure><p id="822e" data-selectable-paragraph="">We have created a TypeScript function which accepts a <code>BingPin</code> and has no return value. We can see that we are passing in the location as well as the color from <code>sitePin</code> which we have passed in from our C# code. The second statement of the function simply places the pushpin we created onto the map. If we launch our application again we should now see a green pushpin.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/30/1*TD9GtO4aQGbcHDccom-cag.png?q=20" width="1596" height="790" role="presentation"></p><p><img width="1596" height="790" role="presentation"></p></div></div></div></div></figure><p id="f460" data-selectable-paragraph="">Adding a polygon to the map is another common task. If we look at the code sample for a basic polygon on the github repository it doesn’t look too complicated:</p><figure><div></div></figure><p id="2092" data-selectable-paragraph="">The code gets the center of the map the uses two additional points to define a triangle. These points are put into <code>exteriorRing</code>. Each polygon is made up of one or more rings. The first ring is the exterior ring which defines the polygon and it’s fill area. Each ring after the first one is an interior ring which defines areas inside of the polygon which become holes in the polygon.</p><p id="5328" data-selectable-paragraph="">The actual constructor comes next and it doesn’t look to bad. First is the exterior ring, then a string for the fill color, a string for the stroke color and a number for the stroke thickness. It shouldn’t be too difficult to define the interface and class to pass this information in to Typescript.</p><p id="5cbd" data-selectable-paragraph="">Temporarily adding a polygon constructor to our typescript code and mouse hovering over it shows something interesting.</p><pre><span id="6375" data-selectable-paragraph="">constructor Microsoft.Maps.Polygon(rings: Microsoft.Maps.Location[] | Microsoft.Maps.Location[][], options?: Microsoft.Maps.IPolygonOptions)</span></pre><p id="984d" data-selectable-paragraph="">It looks like the first argument can either be a single ring or an array of rings (a ring is a Location[]). Also the options parameter is not required but we will supply it because we want to make use of it. If we are going to define a single interface which will allow one or multiple rings we will have to define it to be <code>Microsoft.Maps.Location[][]</code> even if we are only passing a single ring. Go back into <code>BingMapsInterfaces.ts</code> and add this code to define an interface for our options:</p><figure><div></div></figure><p id="1926" data-selectable-paragraph="">That was just a straight list of the three options we want to provide. Next we can define the actual polygon object we want to pass in from Blazor:</p><figure><div></div></figure><p id="a86d" data-selectable-paragraph="">As discussed earlier we are always going to use the syntax for multiple rings even if we are only passing a single ring.</p><p id="01b9" data-selectable-paragraph="">With the interfaces defined this way the function to add our polygon to the map becomes pretty short. Go back into BingTsInterop.ts and add this function:</p><figure><div></div></figure><p id="4c44" data-selectable-paragraph="">We just call the constructor and push it to the map and we are done.</p><p id="a22b" data-selectable-paragraph="">Some business requirements necessitated coming up with code that could create a circle roughly 10 miles in diameter centered on a specified point. Instead of picking points by hand we are going to use that code in this article. Create a new class <code>MapCircle.cs</code> in the <code>Models</code> folder and paste in this code:</p><figure><div></div></figure><p id="bfc5" data-selectable-paragraph="">That code uses math to make a circle out of points around a center point. The loop near the bottom uses 3 as the interval so that a circle is only made of 120 points instead of 360 points. That number can be raised or lowered as needed for resolution or performance.</p><p id="0689" data-selectable-paragraph="">We now have to go back to BingMapsObjects.cs and add the classes in there to match our TypeScript interfaces. Looking at the Typescript our C# classes wind up looking like this:</p><figure><div></div></figure><p id="488a" data-selectable-paragraph="">It’s a 1 for 1 mapping and should work when we make the JSInterop call. All that’s left now is to add the code to create our Polygon to <code>SiteMapper.razor.cs</code>. Here is all of the needed code:</p><figure><div></div></figure><p id="c7af" data-selectable-paragraph="">This code first declares a new <code>Polygon</code> then declares a <code>List&lt;Location[]&gt;</code> for the rings. <code>List&lt;T&gt;</code> is easier to work with and has the handy <code>.ToArray()</code> method. In line 3 we call <code>DrawMapCircle</code> and add the circle as our first (the exterior) ring. In lines 4 through 6 we draw a smaller circle and reverse its direction then add it as the second ring. If the interior ring does not go in the opposite direction of the exterior ring it will not render properly. Line 7 turns our <code>List</code> of rings into an <code>Array</code>. The rest of the code instantiates the <code>PolygonOptions</code> and sets the values we want to pass in. Finally line 13 calls the <code>AddPolygon</code> method we created in TypeScript. If we run our application now we should see a donut sort of shape on our map.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/30/1*nLxXBkVI7iQDdiiuQLPOBA.png?q=20" width="1600" height="787" role="presentation"></p><p><img width="1600" height="787" role="presentation"></p></div></div></div></div></figure><p id="7e43" data-selectable-paragraph="">In this article we took our first look at using the Bing Maps 8 web control in a client side Blazor application. We started off with getting an API key and making the API available to our code. We followed that up by setting up our TypeScript folders and adding the Bing Map type definitions to give us Intellisense for Bing in Typescript. Finally we went through how to initialized the map and add pushpins and polygons to it. In that process we also covered using TypeScript interfaces to cleanly pass data from C# to Typescript.</p><p id="ff10" data-selectable-paragraph="">There is a lot more to the Bing Maps 8 API and we have just scratched the surface. Next time we may cover addtional functions of the API or we may dive into the Bing Maps REST API. If you have questions or comments you can leave them here or reach out to me @LouisHendricks on Twitter.</p></div></div></section></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>