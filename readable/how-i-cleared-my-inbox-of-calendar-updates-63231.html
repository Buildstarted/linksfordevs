<!DOCTYPE html>
<html lang="en">
<head>
    <title>
How I cleared my inbox of calendar updates - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="How I cleared my inbox of calendar updates - linksfor.dev(s)"/>
    <meta property="og:description" content="We all tried it. You invited a semi-large group of people to a meeting, and now you are getting spammed with calendar responses."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://blog.cyborch.com/how-i-cleared-my-inbox-of-calendar-updates/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - How I cleared my inbox of calendar updates</title>
<div class="readable">
        <h1>How I cleared my inbox of calendar updates</h1>
            <div>Reading time: 4-5 minutes</div>
        <div>Posted here: 22 Jun 2020</div>
        <p><a href="https://blog.cyborch.com/how-i-cleared-my-inbox-of-calendar-updates/">https://blog.cyborch.com/how-i-cleared-my-inbox-of-calendar-updates/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section>
            <p><em><strong>You just sent out a calendar invite to your team / department / office branch and now the accepted / rejected emails start pouring in.</strong></em></p><figure><img src="http://blog.cyborch.com/content/images/2020/06/calendar.png"></figure><p>We all tried it. You invited a semi-large group of people to a meeting, and now you are getting spammed with calendar responses.</p><p>I finally got enough and created a solution, which Google really should have just built into Gmail from the beginning.</p><p>We want those updates. We want our calendar to get updated with information on who is joining our meeting. What we don't want is an inbox full of information which is meant for a machine and not for a human. We just need to see how many people are attending in our calendar, and the calendar has a perfectly fine mechanism for that already:</p><figure><img src="http://blog.cyborch.com/content/images/2020/06/invited.png"></figure><h2 id="finding-the-calendar-mail-identifiers"><strong>Finding the calendar mail identifiers</strong></h2><p>So I started digging for some unique indicator that an email is a calendar update. The subject is relatively dynamic with only the "accepted" or "rejected" strings being constant but those seem too generic to filter on. Too many false positives.</p><p>So I had a look at the mail headers:</p><pre><code><span>Delivered-To:</span> <span>anders.borch@example.com</span>
<span>Received:</span> <span>by</span> <span>2002</span><span>:a5d:4082:0:0:0:0:0</span> <span>with</span> <span>SMTP</span> <span>id</span> <span>o2csp1438579wrp;</span>
        <span>Thu,</span> <span>18</span> <span>Jun</span> <span>2020</span> <span>03</span><span>:46:50</span> <span>-0700</span> <span>(PDT)</span>
<span>X-Received: by 2002:a2e:9bd2::</span> <span>with</span> <span>SMTP</span> <span>id</span> <span>w18mr1914344ljj.448.1592477210801;</span>
        <span>Thu,</span> <span>18</span> <span>Jun</span> <span>2020</span> <span>03</span><span>:46:50</span> <span>-0700</span> <span>(PDT)</span>

<span>[many,</span> <span>many</span> <span>headers</span> <span>removed</span> <span>for</span> <span>brevity]</span>

<span>MIME-Version:</span> <span>1.0</span>
<span>X-Received: by 2002:a2e:891a::</span> <span>with</span> <span>SMTP</span> <span>id</span> <span>d26mr1988520lji.384.1592477210541;</span>
 <span>Thu,</span> <span>18</span> <span>Jun</span> <span>2020</span> <span>03</span><span>:46:50</span> <span>-0700</span> <span>(PDT)</span>
<span>Reply-To:</span> <span>Alex</span> <span>&lt;alex@example.com&gt;</span>
<span>Sender:</span> <span>Google</span> <span>Calendar</span> <span>&lt;calendar-notification@google.com&gt;</span>
<span>Auto-Submitted:</span> <span>auto-generated</span>
<span>Message-ID:</span> <span>&lt;00000000000072a2c505a8597e15@google.com&gt;</span>
<span>Date:</span> <span>Thu,</span> <span>18</span> <span>Jun</span> <span>2020</span> <span>10</span><span>:46:50</span> <span>+0000</span>
<span>Subject: Accepted:</span> <span>All</span> <span>hands</span> <span>@</span> <span>Fri</span> <span>Jun</span> <span>26</span><span>,</span> <span>2020</span> <span>16</span><span>:30</span>
 <span>-</span> <span>18</span><span>:30</span> <span>(CEST)</span> <span>(anders.borch@example.com)</span>
<span>From:</span> <span>Alex</span> <span>&lt;alex@example.com&gt;</span>
<span>To:</span> <span>anders.borch@example.com</span>
<span>Content-Type:</span> <span>multipart/mixed;</span> <span>boundary="00000000000072a2b505a8597e14</span></code></pre><p>Neither <code><strong>From</strong></code>, <code><strong>To</strong></code>, or <code><strong>Subject</strong></code> is of much use.</p><p>After going through the headers, I noticed that <code><strong>Sender</strong></code> looks useful.</p><h2 id="creating-a-filter"><strong>Creating a filter</strong></h2><p>Annoyingly, <code><strong>Sender</strong></code> is not one of the fields that can be filtered natively in gmail.</p><figure><img src="http://blog.cyborch.com/content/images/2020/06/Screenshot-2020-06-18-at-16.34.48-copy.png"></figure><p>Luckily, <a href="https://script.google.com/">Google Apps Script</a> comes to the rescue.</p><p>I created a script which identifies calendar mails based on the <code><strong>Sender</strong></code> header and applies a <code><strong>Calendar</strong></code> label to those mails and removes them from the inbox.</p><p>Step one is to enumerate all recent messages. The granularity on "recent" by the Gmail API goes down to 1 hour, so we process those messages.</p><pre><code><span><span>function</span> <span>processInbox</span>(<span></span>) </span>{
  
  <span>var</span> threads = GmailApp.search(<span>"newer_than:1h"</span>);
  <span>for</span> (<span>var</span> i = <span>0</span>; i &lt; threads.length; i++) {
    
    <span>var</span> thread = threads[i];
    <span>var</span> messages = thread.getMessages();
    <span>for</span> (<span>var</span> j = <span>0</span>; j &lt; messages.length; j++) {
      <span>var</span> message = messages[j];
      <span>if</span> (isCalendarMessage(message)) {
        labelThread(thread);
        <span>break</span>;
      }
    }
  }
}

</code></pre><p>Next, add the message classification, which is done simply by looking for the existence of a <code><strong>Sender</strong></code> header where the content is <code><strong>Google Calendar</strong></code>:</p><pre><code><span><span>function</span> <span>isCalendarMessage</span>(<span>message</span>) </span>{
  <span>var</span> body = message.getRawContent();
  <span>if</span> (body.indexOf(<span>"Sender: Google Calendar &lt;calendar-notification@google.com&gt;"</span>) &gt; <span>-1</span>) {
    <span>return</span> <span>true</span>;
  } <span>else</span> {
    <span>return</span> <span>false</span>;
  }
}

</code></pre><p>Finally, apply the <code><strong>Calendar</strong></code> label and archive the thread:</p><pre><code><span><span>function</span> <span>labelThread</span>(<span>thread</span>) </span>{
  <span>var</span> label = GmailApp.getUserLabelByName(<span>"Calendar"</span>);
  thread.addLabel(label);
  GmailApp.moveThreadToArchive(thread);
}

</code></pre><p>Run the script to ensure that everything works. It should ask for authorization to access your gmail account on the first run.</p><p>Once everything works, add a trigger to ensure that it gets run automatically when there is a calendar update:</p><figure><img src="http://blog.cyborch.com/content/images/2020/06/add-trigger.png"></figure><figure><img src="http://blog.cyborch.com/content/images/2020/06/Screenshot-2020-06-18-at-17.18.46.png"></figure><p><em>Now, my inbox is finally free from calendar spam.</em></p>
        </section></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>