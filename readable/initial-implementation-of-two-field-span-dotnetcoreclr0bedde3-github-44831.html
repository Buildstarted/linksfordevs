<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Initial implementation of two field span. &#xB7; dotnet/coreclr@0bedde3 - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Initial implementation of two field span. &#xB7; dotnet/coreclr@0bedde3 - linksfor.dev(s)"/>
    <meta property="article:author" content="jkotas"/>
    <meta property="og:description" content="Implements two field span struct which is comprised of a byref field&#xA;that may be an interior pointer to a managed object, or a native&#xA;pointer indicating the start of the span, and a length field wh..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/coreclr/commit/0bedde3a63f22b65155d5f369e75c448c6afb786"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Initial implementation of two field span. &#xB7; dotnet/coreclr@0bedde3</title>
<div class="readable">
        <h1>Initial implementation of two field span. &#xB7; dotnet/coreclr@0bedde3</h1>
            <div>by jkotas</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 19 Dec 2019</div>
        <p><a href="https://github.com/dotnet/coreclr/commit/0bedde3a63f22b65155d5f369e75c448c6afb786">https://github.com/dotnet/coreclr/commit/0bedde3a63f22b65155d5f369e75c448c6afb786</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-hydro-view="{&quot;event_type&quot;:&quot;pull_request.select_diff_range&quot;,&quot;payload&quot;:{&quot;actor_id&quot;:null,&quot;pull_request_id&quot;:null,&quot;repository_id&quot;:null,&quot;diff_type&quot;:&quot;UNIFIED&quot;,&quot;whitespace_ignored&quot;:false,&quot;originating_url&quot;:&quot;https://github.com/dotnet/coreclr/commit/0bedde3a63f22b65155d5f369e75c448c6afb786&quot;,&quot;user_id&quot;:null}}" data-hydro-view-hmac="4070d62143c93b53d8e1ac29b6bb868b39afe39e73eb3a5c772e4beecf92ba28">
        <div>
          <table data-tab-size="4" data-diff-anchor="diff-edc46b80f57431489a82311948a8234d">

                
      <tbody><tr data-position="0">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Up" aria-label="Expand Up" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=&amp;last_right=&amp;left=1489&amp;left_hunk_size=17&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=1489&amp;right_hunk_size=16" data-left-range="1-1488" data-right-range="1-1488">
            
          </a>
    </td>
    <td>@@ -1489,17 +1489,16 @@ var_types Compiler::impNormStructType(CORINFO_CLASS_HANDLE structHnd,</td>
  </tr>

    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1489" data-line-number="1489"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1489" data-line-number="1489"></td>

  <td>
    <span data-code-marker=" ">    const DWORD structFlags = info.compCompHnd-&gt;getClassAttribs(structHnd);</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1490" data-line-number="1490"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1490" data-line-number="1490"></td>

  <td>
    <span data-code-marker=" ">    var_types   structType  = TYP_STRUCT;</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1491" data-line-number="1491"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1491" data-line-number="1491"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1492" data-line-number="1492"></td>

    <td></td>

  <td>
    <span data-code-marker="-">#ifdef FEATURE_CORECLR</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1493" data-line-number="1493"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    const bool hasGCPtrs = (structFlags &amp; CORINFO_FLG_CONTAINS_GC_PTR) != 0;</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1494" data-line-number="1494"></td>

    <td></td>

  <td>
    <span data-code-marker="-">#else</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1495" data-line-number="1495"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    // Desktop CLR won't report FLG_CONTAINS_GC_PTR for RefAnyClass - need to check explicitly.</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1496" data-line-number="1496"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    const bool        isRefAny    = (structHnd == impGetRefAnyClass());</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1497" data-line-number="1497"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    const bool        hasGCPtrs   = isRefAny || ((structFlags &amp; CORINFO_FLG_CONTAINS_GC_PTR) != 0);</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1498" data-line-number="1498"></td>

    <td></td>

  <td>
    <span data-code-marker="-">#endif</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1492" data-line-number="1492"></td>

  <td>
    <span data-code-marker="+">    // On coreclr the check for GC includes a "may" to account for the special</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1493" data-line-number="1493"></td>

  <td>
    <span data-code-marker="+">    // ByRef like span structs.  The added check for "CONTAINS_STACK_PTR" is the particular bit.</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1494" data-line-number="1494"></td>

  <td>
    <span data-code-marker="+">    // When this is set the struct will contain a ByRef that could be a GC pointer or a native</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1495" data-line-number="1495"></td>

  <td>
    <span data-code-marker="+">    // pointer.</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1496" data-line-number="1496"></td>

  <td>
    <span data-code-marker="+">    const bool mayContainGCPtrs =</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1497" data-line-number="1497"></td>

  <td>
    <span data-code-marker="+">        ((structFlags &amp; CORINFO_FLG_CONTAINS_STACK_PTR) != 0 || ((structFlags &amp; CORINFO_FLG_CONTAINS_GC_PTR) != 0));</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1499" data-line-number="1499"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1498" data-line-number="1498"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1500" data-line-number="1500"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1499" data-line-number="1499"></td>

  <td>
    <span data-code-marker=" ">#ifdef FEATURE_SIMD</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1501" data-line-number="1501"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1500" data-line-number="1500"></td>

  <td>
    <span data-code-marker=" ">    // Check to see if this is a SIMD type.</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1502" data-line-number="1502"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    if (featureSIMD &amp;&amp; !<span>hasGCPtrs</span>)</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1501" data-line-number="1501"></td>

  <td>
    <span data-code-marker="+">    if (featureSIMD &amp;&amp; !<span>mayContainGCPtrs</span>)</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1503" data-line-number="1503"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1502" data-line-number="1502"></td>

  <td>
    <span data-code-marker=" ">    {</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1504" data-line-number="1504"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1503" data-line-number="1503"></td>

  <td>
    <span data-code-marker=" ">        unsigned originalSize = info.compCompHnd-&gt;getClassSize(structHnd);</span></td>
</tr>



    <tr data-hunk="a726a4a28a8e10a4a7c3733db83d3bf3">
    <td id="diff-edc46b80f57431489a82311948a8234dL1505" data-line-number="1505"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1504" data-line-number="1504"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



      <tr data-position="25">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Down" aria-label="Expand Down" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=1505&amp;last_right=1504&amp;left=1532&amp;left_hunk_size=9&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=1531&amp;right_hunk_size=10" data-left-range="1506-1517" data-right-range="1505-1516">
            
          </a>
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Up" aria-label="Expand Up" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=1505&amp;last_right=1504&amp;left=1532&amp;left_hunk_size=9&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=1531&amp;right_hunk_size=10" data-left-range="1518-1531" data-right-range="1517-1530">
            
          </a>
    </td>
    <td>@@ -1532,9 +1531,10 @@ var_types Compiler::impNormStructType(CORINFO_CLASS_HANDLE structHnd,</td>
  </tr>

    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1532" data-line-number="1532"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1531" data-line-number="1531"></td>

  <td>
    <span data-code-marker=" ">        // Verify that the quick test up above via the class attributes gave a</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1533" data-line-number="1533"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1532" data-line-number="1532"></td>

  <td>
    <span data-code-marker=" ">        // safe view of the type's GCness.</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1534" data-line-number="1534"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1533" data-line-number="1533"></td>

  <td>
    <span data-code-marker=" ">        //</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1535" data-line-number="1535"></td>

    <td></td>

  <td>
    <span data-code-marker="-">        // Note there are cases where <span>hasGCPtrs</span> is true but getClassGClayout</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1534" data-line-number="1534"></td>

  <td>
    <span data-code-marker="+">        // Note there are cases where <span>mayContainGCPtrs</span> is true but getClassGClayout</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1536" data-line-number="1536"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1535" data-line-number="1535"></td>

  <td>
    <span data-code-marker=" ">        // does not report any gc fields.</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1537" data-line-number="1537"></td>

    <td></td>

  <td>
    <span data-code-marker="-">        assert(hasGCPtrs || (numGCVars == 0));</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1536" data-line-number="1536"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1537" data-line-number="1537"></td>

  <td>
    <span data-code-marker="+">        assert(mayContainGCPtrs || (numGCVars == 0));</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1538" data-line-number="1538"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1538" data-line-number="1538"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1539" data-line-number="1539"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1539" data-line-number="1539"></td>

  <td>
    <span data-code-marker=" ">        if (pNumGCVars != nullptr)</span></td>
</tr>



    <tr data-hunk="5d04b96ba41b04e1b973964a88a01373">
    <td id="diff-edc46b80f57431489a82311948a8234dL1540" data-line-number="1540"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR1540" data-line-number="1540"></td>

  <td>
    <span data-code-marker=" ">        {</span></td>
</tr>



      <tr data-position="38">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Down" aria-label="Expand Down" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=1540&amp;last_right=1540&amp;left=3271&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=3271&amp;right_hunk_size=8" data-left-range="1541-2404" data-right-range="1541-2404">
            
          </a>
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Up" aria-label="Expand Up" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=1540&amp;last_right=1540&amp;left=3271&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=3271&amp;right_hunk_size=8" data-left-range="2405-3270" data-right-range="2405-3270">
            
          </a>
    </td>
    <td>@@ -3271,7 +3271,8 @@ GenTreePtr Compiler::impInitializeArrayIntrinsic(CORINFO_SIG_INFO* sig)</td>
  </tr>

    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3271" data-line-number="3271"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3271" data-line-number="3271"></td>

  <td>
    <span data-code-marker=" ">// Returns the GenTree that should be used to do the intrinsic instead of the call.</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3272" data-line-number="3272"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3272" data-line-number="3272"></td>

  <td>
    <span data-code-marker=" ">// Returns NULL if an intrinsic cannot be used</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3273" data-line-number="3273"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3273" data-line-number="3273"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3274" data-line-number="3274"></td>

    <td></td>

  <td>
    <span data-code-marker="-">GenTreePtr Compiler::impIntrinsic(CORINFO_CLASS_HANDLE  clsHnd,</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3274" data-line-number="3274"></td>

  <td>
    <span data-code-marker="+">GenTreePtr Compiler::impIntrinsic(GenTreePtr            newobjThis,</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3275" data-line-number="3275"></td>

  <td>
    <span data-code-marker="+">                                  CORINFO_CLASS_HANDLE  clsHnd,</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3275" data-line-number="3275"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3276" data-line-number="3276"></td>

  <td>
    <span data-code-marker=" ">                                  CORINFO_METHOD_HANDLE method,</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3276" data-line-number="3276"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3277" data-line-number="3277"></td>

  <td>
    <span data-code-marker=" ">                                  CORINFO_SIG_INFO*     sig,</span></td>
</tr>



    <tr data-hunk="bab7bb009608e5fdc4aadc6414bb28ef">
    <td id="diff-edc46b80f57431489a82311948a8234dL3277" data-line-number="3277"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3278" data-line-number="3278"></td>

  <td>
    <span data-code-marker=" ">                                  int                   memberRef,</span></td>
</tr>



      <tr data-position="48">
    <td colspan="2">
        <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand All" aria-label="Expand All" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;in_wiki_context=&amp;last_left=3277&amp;last_right=3278&amp;left=3283&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=3284&amp;right_hunk_size=7" data-left-range="3278-3279" data-right-range="3279-3280">
          
        </a>
    </td>
    <td>@@ -3283,7 +3284,7 @@ GenTreePtr Compiler::impIntrinsic(CORINFO_CLASS_HANDLE  clsHnd,</td>
  </tr>

    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3283" data-line-number="3283"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3284" data-line-number="3284"></td>

  <td>
    <span data-code-marker=" ">#if COR_JIT_EE_VERSION &gt; 460</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3284" data-line-number="3284"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3285" data-line-number="3285"></td>

  <td>
    <span data-code-marker=" ">    CorInfoIntrinsics intrinsicID = info.compCompHnd-&gt;getIntrinsicID(method, &amp;mustExpand);</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3285" data-line-number="3285"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3286" data-line-number="3286"></td>

  <td>
    <span data-code-marker=" ">#else</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3286" data-line-number="3286"></td>

    <td></td>

  <td>
    <span data-code-marker="-">    CorInfoIntrinsics intrinsicID = info.compCompHnd-&gt;getIntrinsicID(method);</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3287" data-line-number="3287"></td>

  <td>
    <span data-code-marker="+">    CorInfoIntrinsics intrinsicID <span>                                     </span>= info.compCompHnd-&gt;getIntrinsicID(method);</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3287" data-line-number="3287"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3288" data-line-number="3288"></td>

  <td>
    <span data-code-marker=" ">#endif</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3288" data-line-number="3288"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3289" data-line-number="3289"></td>

  <td>
    <span data-code-marker=" ">    *pIntrinsicID = intrinsicID;</span></td>
</tr>



    <tr data-hunk="f46e250c2e6ca6fde0a290f1fe927866">
    <td id="diff-edc46b80f57431489a82311948a8234dL3289" data-line-number="3289"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3290" data-line-number="3290"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



      <tr data-position="57">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Down" aria-label="Expand Down" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=3289&amp;last_right=3290&amp;left=3607&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=3608&amp;right_hunk_size=33" data-left-range="3290-3447" data-right-range="3291-3448">
            
          </a>
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Up" aria-label="Expand Up" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=3289&amp;last_right=3290&amp;left=3607&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=3608&amp;right_hunk_size=33" data-left-range="3448-3606" data-right-range="3449-3607">
            
          </a>
    </td>
    <td>@@ -3607,7 +3608,33 @@ GenTreePtr Compiler::impIntrinsic(CORINFO_CLASS_HANDLE  clsHnd,</td>
  </tr>

    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3607" data-line-number="3607"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3608" data-line-number="3608"></td>

  <td>
    <span data-code-marker=" ">            retNode = op1;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3608" data-line-number="3608"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3609" data-line-number="3609"></td>

  <td>
    <span data-code-marker=" ">            break;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3609" data-line-number="3609"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3610" data-line-number="3610"></td>

  <td>
    <span data-code-marker=" ">#endif</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3610" data-line-number="3610"></td>

    <td></td>

  <td>
    <span data-code-marker="-"><br></span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3611" data-line-number="3611"></td>

  <td>
    <span data-code-marker="+">        // Implement ByReference Ctor.  This wraps the assignment of the ref into a byref-like field</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3612" data-line-number="3612"></td>

  <td>
    <span data-code-marker="+">        // in a value type.  The canonical example of this is Span&lt;T&gt;. In effect this is just a</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3613" data-line-number="3613"></td>

  <td>
    <span data-code-marker="+">        // substitution.  The parameter byref will be assigned into the newly allocated object.</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3614" data-line-number="3614"></td>

  <td>
    <span data-code-marker="+">        case CORINFO_INTRINSIC_ByReference_Ctor:</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3615" data-line-number="3615"></td>

  <td>
    <span data-code-marker="+">        {</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3616" data-line-number="3616"></td>

  <td>
    <span data-code-marker="+">            // Remove call to constructor and directly assign the byref passed</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3617" data-line-number="3617"></td>

  <td>
    <span data-code-marker="+">            // to the call to the first slot of the ByReference struct.</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3618" data-line-number="3618"></td>

  <td>
    <span data-code-marker="+">            op1                                    = impPopStack().val;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3619" data-line-number="3619"></td>

  <td>
    <span data-code-marker="+">            GenTreePtr           thisptr           = newobjThis;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3620" data-line-number="3620"></td>

  <td>
    <span data-code-marker="+">            CORINFO_FIELD_HANDLE fldHnd            = info.compCompHnd-&gt;getFieldInClass(clsHnd, 0);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3621" data-line-number="3621"></td>

  <td>
    <span data-code-marker="+">            GenTreePtr           field             = gtNewFieldRef(TYP_BYREF, fldHnd, thisptr, 0, false);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3622" data-line-number="3622"></td>

  <td>
    <span data-code-marker="+">            GenTreePtr           assign            = gtNewAssignNode(field, op1);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3623" data-line-number="3623"></td>

  <td>
    <span data-code-marker="+">            GenTreePtr           byReferenceStruct = gtCloneExpr(thisptr-&gt;gtGetOp1());</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3624" data-line-number="3624"></td>

  <td>
    <span data-code-marker="+">            assert(byReferenceStruct != nullptr);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3625" data-line-number="3625"></td>

  <td>
    <span data-code-marker="+">            impPushOnStack(byReferenceStruct, typeInfo(TI_STRUCT, clsHnd));</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3626" data-line-number="3626"></td>

  <td>
    <span data-code-marker="+">            retNode = assign;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3627" data-line-number="3627"></td>

  <td>
    <span data-code-marker="+">            break;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3628" data-line-number="3628"></td>

  <td>
    <span data-code-marker="+">        }</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3629" data-line-number="3629"></td>

  <td>
    <span data-code-marker="+">        // Implement ptr value getter for ByReference struct.</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3630" data-line-number="3630"></td>

  <td>
    <span data-code-marker="+">        case CORINFO_INTRINSIC_ByReference_Value:</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3631" data-line-number="3631"></td>

  <td>
    <span data-code-marker="+">        {</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3632" data-line-number="3632"></td>

  <td>
    <span data-code-marker="+">            op1                         = impPopStack().val;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3633" data-line-number="3633"></td>

  <td>
    <span data-code-marker="+">            CORINFO_FIELD_HANDLE fldHnd = info.compCompHnd-&gt;getFieldInClass(clsHnd, 0);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3634" data-line-number="3634"></td>

  <td>
    <span data-code-marker="+">            GenTreePtr           field  = gtNewFieldRef(TYP_BYREF, fldHnd, op1, 0, false);</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3635" data-line-number="3635"></td>

  <td>
    <span data-code-marker="+">            retNode                     = field;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3636" data-line-number="3636"></td>

  <td>
    <span data-code-marker="+">            break;</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3637" data-line-number="3637"></td>

  <td>
    <span data-code-marker="+">        }</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3611" data-line-number="3611"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3638" data-line-number="3638"></td>

  <td>
    <span data-code-marker=" ">        default:</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3612" data-line-number="3612"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3639" data-line-number="3639"></td>

  <td>
    <span data-code-marker=" ">            /* Unknown intrinsic */</span></td>
</tr>



    <tr data-hunk="91dc8b9f59210af12d5d106a8a4c02c5">
    <td id="diff-edc46b80f57431489a82311948a8234dL3613" data-line-number="3613"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR3640" data-line-number="3640"></td>

  <td>
    <span data-code-marker=" ">            break;</span></td>
</tr>



      <tr data-position="92">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Down" aria-label="Expand Down" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=3613&amp;last_right=3640&amp;left=6538&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=6565&amp;right_hunk_size=7" data-left-range="3614-5074" data-right-range="3641-5101">
            
          </a>
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Up" aria-label="Expand Up" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=3613&amp;last_right=3640&amp;left=6538&amp;left_hunk_size=7&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=6565&amp;right_hunk_size=7" data-left-range="5075-6537" data-right-range="5102-6564">
            
          </a>
    </td>
    <td>@@ -6538,7 +6565,7 @@ var_types Compiler::impImportCall(OPCODE                  opcode,</td>
  </tr>

    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6538" data-line-number="6538"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6565" data-line-number="6565"></td>

  <td>
    <span data-code-marker=" ">        // &lt;NICE&gt; Factor this into getCallInfo &lt;/NICE&gt;</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6539" data-line-number="6539"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6566" data-line-number="6566"></td>

  <td>
    <span data-code-marker=" ">        if ((mflags &amp; CORINFO_FLG_INTRINSIC) &amp;&amp; !pConstrainedResolvedToken)</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6540" data-line-number="6540"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6567" data-line-number="6567"></td>

  <td>
    <span data-code-marker=" ">        {</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6541" data-line-number="6541"></td>

    <td></td>

  <td>
    <span data-code-marker="-">            call = impIntrinsic(clsHnd, methHnd, sig, pResolvedToken-&gt;token, readonlyCall,</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6568" data-line-number="6568"></td>

  <td>
    <span data-code-marker="+">            call = impIntrinsic(<span>newobjThis, </span>clsHnd, methHnd, sig, pResolvedToken-&gt;token, readonlyCall,</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6542" data-line-number="6542"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6569" data-line-number="6569"></td>

  <td>
    <span data-code-marker=" ">                                (canTailCall &amp;&amp; (tailCall != 0)), &amp;intrinsicID);</span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6543" data-line-number="6543"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6570" data-line-number="6570"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="9217144a2dfdd8e98a0507af59bfb694">
    <td id="diff-edc46b80f57431489a82311948a8234dL6544" data-line-number="6544"></td>

    <td id="diff-edc46b80f57431489a82311948a8234dR6571" data-line-number="6571"></td>

  <td>
    <span data-code-marker=" ">            if (call != nullptr)</span></td>
</tr>



  <tr data-position="">
    <td colspan="2">
          <a href="#diff-edc46b80f57431489a82311948a8234d" title="Expand Down" aria-label="Expand Down" data-url="/dotnet/coreclr/blob_excerpt/1d9144b68f48dc0ece7fc7ed4a9e6a61478b0fe3?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=6544&amp;last_right=6571&amp;left=13420&amp;left_hunk_size=&amp;mode=100644&amp;path=src%2Fjit%2Fimporter.cpp&amp;right=13420&amp;right_hunk_size=" data-left-range="6545-13419" data-right-range="6572-13419">
            
          </a>
    </td>
    <td></td>
  </tr>


          </tbody></table>
        </div>

  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>