<!DOCTYPE html>
<html lang="en">
<head>
    <title>
On Liberating My Smartwatch From Cloud Services &#xAB; bunnie&#x27;s blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="On Liberating My Smartwatch From Cloud Services &#xAB; bunnie&#x27;s blog - linksfor.dev(s)"/>
    <meta property="og:description" content="I&#x2019;ve often said that if we convince ourselves that technology is magic, we risk becoming hostages to it. Just recently, I had a brush with this fate, but happily, I was saved by open source."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.bunniestudios.com/blog/?p=5863"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - On Liberating My Smartwatch From Cloud Services &#xAB; bunnie&#x27;s blog</title>
<div class="readable">
        <h1>On Liberating My Smartwatch From Cloud Services &#xAB; bunnie&#x27;s blog</h1>
            <div>Reading time: 8-11 minutes</div>
        <div>Posted here: 25 Jul 2020</div>
        <p><a href="https://www.bunniestudios.com/blog/?p=5863">https://www.bunniestudios.com/blog/?p=5863</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
				<p>I’ve often said that if we convince ourselves that <a href="https://www.youtube.com/watch?v=aFrTJPfM58s&amp;feature=youtu.be">technology is magic, we risk becoming hostages to it</a>. Just recently, I had a brush with this fate, but happily, I was saved by open source.</p>
<p>At the time of writing, Garmin is <a href="https://www.zdnet.com/article/garmin-services-and-production-go-down-after-ransomware-attack/">suffering from a massive ransomware attack</a>. I also happen to be a user of the <a href="https://amzn.to/3hEi7YJ">Garmin Instinct</a> watch. I’m very happy with it, and in many ways, it’s magical how much capability is packed into such a tiny package.</p>
<p>I also happen to have a hobby of paddling the outrigger canoe:</p>


<p>I consider the GPS watch to be an indispensable piece of safety gear, especially for the boat’s steer, because it’s hard to judge your water speed when you’re more than a few hundred meters from land. If you get stuck in a bad current, without situational awareness you could end up swept out to sea or worse.</p>
<p>The water currents around Singapore can be extreme. When the tides change, the South China Sea eventually finds its way to the Andaman Sea through the Singapore Strait, causing treacherous flows of current that shift over time. Thus, after every paddle, I upload my GPS data to the Garmin Connect cloud and review the route, in part to note dangerous changes in the ebb-and-flow patterns of currents.</p>
<p>While it’s a clear and present privacy risk to upload such data to the Garmin cloud, we’re all familiar with the trade-off: there’s only 24 hours in the day to worry about things, and the service just worked so well.</p>
<p>Until yesterday.</p>
<p>We had just wrapped up a paddle with particularly unusual currents, and my paddling partner wanted to know our speeds at a few of the tricky spots. I went to retrieve the data and…well, I found out that Garmin was under attack.</p>
<p><img src="https://bunniefoo.com/bunnie/garmin-outage.png"></p>
<p>Garmin was being held hostage, and transitively, so was access to my paddling data: a small facet of my life had become a hostage to technology.</p>
<p>A bunch of my paddling friends recommended I try Strava. The good news is Garmin allows data files to be retrieved off of the Instinct watch, for upload to third-party services.</p>
<p>The bad news is as I tried to create an account on Strava, all sorts of warning bells went off. The website is full of dark patterns, and when I clicked to deny Strava access to my health-related data, I was met with this tricky series dialog boxes:</p>
<p><img src="https://bunniefoo.com/bunnie/strava4b.png"></p>
<p>Click “Decline”…</p>
<p><img src="https://bunniefoo.com/bunnie/strava5b.png"></p>
<p>Click “Deny Permission”…</p>
<p><img src="https://bunniefoo.com/bunnie/strava6b.png"></p>
<p>Click “OK”…</p>
<p>Three clicks to opt out, and if I wasn’t paying attention and just kept clicking the bottom box, I would have opted-in by accident. After this, I was greeted by a creepy list of people to follow (<em>how do they know so much about me from just an email?</em>), and then there’s a tricky dialog box that, if answered incorrectly, routes you to a spot to enter credit card information as part of your “free trial”.</p>
<p>Since Garmin at least made money on the hardware, collecting my health data is just icing on the cake; for Strava, my health data <b>is</b> the cake. It’s pretty clear to me that Strava made a pitch to its investors that they’ll make fat returns by monetizing my private data, including my health information.</p>
<p>This is a hard no for me. Instead of liberating myself from a hostage situation, going from Garmin to Strava would be like stepping out of the frying pan and directly into the fire.</p>
<p>So, even though this was a busy afternoon … I’m scheduled to paddle again the day after tomorrow, and it would be great to have my boat speed analytics before then. Plus, I was sufficiently miffed by the Strava experience that I couldn’t help but start searching around to see if I couldn’t cobble together my own privacy-protecting alternative.</p>
<p>I was very pleased to discovered an open-source utility called <a href="https://www.gpsbabel.org/">gpsbabel</a> (<em>thank you gpsbabel! I donated!</em>) that can unpack Garmin’s semi-(?)proprietary “.FIT” file format into the interoperable “.GPX” format. From there, I was able to cobble together bits and pieces of <a href="https://github.com/andersle/gpxplotter">XML parsing code</a> and merge it with OpenStreetMaps via the <a href="https://python-visualization.github.io/folium/quickstart.html#Getting-Started">Folium API</a> to create custom maps of my data.</p>
<p>Even with getting “lost” on a detour of trying to use the Google Maps API that left an awful “for development only” watermark on all my map tiles, this only took an evening — it wasn’t the best possible use of my time all things considered, but it was mostly a matter of finding the right open-source pieces and gluing them together with Python (fwiw, Python is a great glue, but a terrible structural material. Do not build skyscrapers out of Python). The code quality is pretty crap, but Python allows that, and it gets the job done. Given those caveats, one could <a href="https://github.com/bunnie/watchmap">use it as a starting point</a> for something better.</p>
<p>Now that I have full control over my data, I’m able to visualize it in ways that make sense to me. For example, I’ve <a href="https://bunniefoo.com/bunnie/speed-2020-07-21-16-10-44-map.html">plotted my speed as a heat map map over the course</a>, with circles proportional to the speed at that moment, and a hover-text that shows my instantaneous speed and heart rate:</p>
<p><a href="https://bunniefoo.com/bunnie/watchmap1.png"><img src="https://bunniefoo.com/bunnie/watchmap1.png"></a></p>
<p>It’s exactly the data I need, in the format that I want; no more, and no less. Plus, the output is a single html file that I can share directly with <a href="https://bunniefoo.com/bunnie/speed-2020-07-21-16-10-44-map.html">nothing more than a simple link</a>. No analytics, no cookies. Just the data I’ve chosen to share with you.</p>
<p>Here’s a snippet of the code that I use to plot the map data:<br>
</p><div id="gist104527004">
    <div>
      <div>
        <div>
  <div id="file-plot-py">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-plot-py-L1" data-line-number="1"></td>
        <td id="file-plot-py-LC1"><span>def</span> <span>plot_osm_map</span>(<span>track</span>, <span>output</span><span>=</span><span>'speed-map.html'</span>, <span>hr</span><span>=</span><span>None</span>):</td>
      </tr>
      <tr>
        <td id="file-plot-py-L2" data-line-number="2"></td>
        <td id="file-plot-py-LC2">    <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>len</span>(<span>track</span>[<span>'speed'</span>])):</td>
      </tr>
      <tr>
        <td id="file-plot-py-L3" data-line-number="3"></td>
        <td id="file-plot-py-LC3">        <span>track</span>[<span>'speed'</span>][<span>i</span>] <span>=</span> <span>speed_conversion</span>(<span>track</span>[<span>'speed'</span>][<span>i</span>])</td>
      </tr>
      <tr>
        <td id="file-plot-py-L4" data-line-number="4"></td>
        <td id="file-plot-py-LC4">    <span>speeds</span> <span>=</span> <span>track</span>[<span>'speed'</span>]</td>
      </tr>
      <tr>
        <td id="file-plot-py-L5" data-line-number="5"></td>
        <td id="file-plot-py-LC5">    <span>minima</span> <span>=</span> <span>min</span>(<span>speeds</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L6" data-line-number="6"></td>
        <td id="file-plot-py-LC6">    <span>maxima</span> <span>=</span> <span>max</span>(<span>speeds</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L7" data-line-number="7"></td>
        <td id="file-plot-py-LC7">
</td>
      </tr>
      <tr>
        <td id="file-plot-py-L8" data-line-number="8"></td>
        <td id="file-plot-py-LC8">    <span>norm</span> <span>=</span> <span>matplotlib</span>.<span>colors</span>.<span>Normalize</span>(<span>vmin</span><span>=</span><span>minima</span>, <span>vmax</span><span>=</span><span>maxima</span>, <span>clip</span><span>=</span><span>True</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L9" data-line-number="9"></td>
        <td id="file-plot-py-LC9">    <span>mapper</span> <span>=</span> <span>cm</span>.<span>ScalarMappable</span>(<span>norm</span><span>=</span><span>norm</span>, <span>cmap</span><span>=</span><span>cm</span>.<span>plasma</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L10" data-line-number="10"></td>
        <td id="file-plot-py-LC10">    <span>m</span> <span>=</span> <span>folium</span>.<span>Map</span>(<span>location</span><span>=</span>[<span>track</span>[<span>'lat'</span>][<span>0</span>], <span>track</span>[<span>'lon'</span>][<span>0</span>]], <span>zoom_start</span><span>=</span><span>15</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L11" data-line-number="11"></td>
        <td id="file-plot-py-LC11">    <span>for</span> <span>index</span> <span>in</span> <span>range</span>(<span>len</span>(<span>track</span>[<span>'lat'</span>])):</td>
      </tr>
      <tr>
        <td id="file-plot-py-L12" data-line-number="12"></td>
        <td id="file-plot-py-LC12">        <span>if</span> <span>track</span>[<span>'speed'</span>][<span>index</span>] <span>==</span> <span>0</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L13" data-line-number="13"></td>
        <td id="file-plot-py-LC13">            <span>track</span>[<span>'speed'</span>][<span>index</span>] <span>=</span> <span>0.01</span></td>
      </tr>
      <tr>
        <td id="file-plot-py-L14" data-line-number="14"></td>
        <td id="file-plot-py-LC14">        <span>else</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L15" data-line-number="15"></td>
        <td id="file-plot-py-LC15">            <span>track</span>[<span>'speed'</span>][<span>index</span>] <span>=</span> <span>track</span>[<span>'speed'</span>][<span>index</span>]</td>
      </tr>
      <tr>
        <td id="file-plot-py-L16" data-line-number="16"></td>
        <td id="file-plot-py-LC16">        <span>if</span> <span>hr</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L17" data-line-number="17"></td>
        <td id="file-plot-py-LC17">            <span>try</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L18" data-line-number="18"></td>
        <td id="file-plot-py-LC18">                <span>tooltip</span><span>=</span><span>str</span>(<span>track</span>[<span>'speed'</span>][<span>index</span>]) <span>+</span> <span>' '</span> <span>+</span> <span>str</span>(<span>hr</span>[<span>'hr'</span>][<span>index</span>]) <span>+</span><span>'bpm'</span></td>
      </tr>
      <tr>
        <td id="file-plot-py-L19" data-line-number="19"></td>
        <td id="file-plot-py-LC19">            <span>except</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L20" data-line-number="20"></td>
        <td id="file-plot-py-LC20">                <span>tooltip</span><span>=</span><span>str</span>(<span>track</span>[<span>'speed'</span>][<span>index</span>])</td>
      </tr>
      <tr>
        <td id="file-plot-py-L21" data-line-number="21"></td>
        <td id="file-plot-py-LC21">        <span>else</span>:</td>
      </tr>
      <tr>
        <td id="file-plot-py-L22" data-line-number="22"></td>
        <td id="file-plot-py-LC22">            <span>tooltip</span><span>=</span><span>str</span>(<span>track</span>[<span>'speed'</span>][<span>index</span>])</td>
      </tr>
      <tr>
        <td id="file-plot-py-L23" data-line-number="23"></td>
        <td id="file-plot-py-LC23">        <span>folium</span>.<span>CircleMarker</span>(</td>
      </tr>
      <tr>
        <td id="file-plot-py-L24" data-line-number="24"></td>
        <td id="file-plot-py-LC24">            <span>location</span><span>=</span>(<span>track</span>[<span>'lat'</span>][<span>index</span>], <span>track</span>[<span>'lon'</span>][<span>index</span>]),</td>
      </tr>
      <tr>
        <td id="file-plot-py-L25" data-line-number="25"></td>
        <td id="file-plot-py-LC25">            <span>radius</span><span>=</span><span>track</span>[<span>'speed'</span>][<span>index</span>]<span>**</span><span>2</span> <span>/</span> <span>8</span>,</td>
      </tr>
      <tr>
        <td id="file-plot-py-L26" data-line-number="26"></td>
        <td id="file-plot-py-LC26">            <span>tooltip</span><span>=</span><span>tooltip</span>,</td>
      </tr>
      <tr>
        <td id="file-plot-py-L27" data-line-number="27"></td>
        <td id="file-plot-py-LC27">            <span>fill_color</span><span>=</span><span>matplotlib</span>.<span>colors</span>.<span>to_hex</span>(<span>mapper</span>.<span>to_rgba</span>(<span>track</span>[<span>'speed'</span>][<span>index</span>])),</td>
      </tr>
      <tr>
        <td id="file-plot-py-L28" data-line-number="28"></td>
        <td id="file-plot-py-LC28">            <span>fill</span><span>=</span><span>True</span>,</td>
      </tr>
      <tr>
        <td id="file-plot-py-L29" data-line-number="29"></td>
        <td id="file-plot-py-LC29">            <span>fill_opacity</span><span>=</span><span>0.2</span>,</td>
      </tr>
      <tr>
        <td id="file-plot-py-L30" data-line-number="30"></td>
        <td id="file-plot-py-LC30">            <span>weight</span><span>=</span><span>0</span>,</td>
      </tr>
      <tr>
        <td id="file-plot-py-L31" data-line-number="31"></td>
        <td id="file-plot-py-LC31">        ).<span>add_to</span>(<span>m</span>)</td>
      </tr>
      <tr>
        <td id="file-plot-py-L32" data-line-number="32"></td>
        <td id="file-plot-py-LC32">
</td>
      </tr>
      <tr>
        <td id="file-plot-py-L33" data-line-number="33"></td>
        <td id="file-plot-py-LC33">    <span>m</span>.<span>save</span>(<span>output</span>)</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>

<p>Like I said, not the best quality <a href="https://github.com/bunnie/watchmap">code</a>, but it works, and it was quick to write.</p>
<p>Even better yet, I’m no longer uploading my position or fitness data to the cloud — there is a certain intangible satisfaction in “going dark” for yet another surveillance leakage point in my life, without any compromise in quality or convenience.</p>
<p>It’s also an interesting meta-story about how healthy and vibrant the open-source ecosystem is today. When the Garmin cloud fell, I was able to replace the most important functions of it in just an afternoon by cutting and pasting together various open source frameworks.</p>
<p>The point of open source is not to ritualistically compile our stuff from source. It’s the awareness that technology is not magic: that there is a trail of breadcrumbs any of us could follow to liberate our digital lives in case of a potential hostage situation. Should we so desire, open source empowers us to create and run our own essential tools and services.</p>

								
				<p>
					<small>
												This entry was posted on Saturday, July 25th, 2020 at 5:24 am and is filed under <a href="https://www.bunniestudios.com/blog/?cat=2" rel="category">Hacking</a>, <a href="https://www.bunniestudios.com/blog/?cat=67" rel="category">open source</a>, <a href="https://www.bunniestudios.com/blog/?cat=5" rel="category">Ponderings</a>.						You can follow any responses to this entry through the <a href="https://www.bunniestudios.com/blog/?feed=rss2&amp;p=5863">RSS 2.0</a> feed. 

													You can <a href="#respond">leave a response</a>, or <a href="https://www.bunniestudios.com/wordpress/wp-trackback.php?p=5863" rel="trackback">trackback</a> from your own site.
						
					</small>
				</p>

			</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>