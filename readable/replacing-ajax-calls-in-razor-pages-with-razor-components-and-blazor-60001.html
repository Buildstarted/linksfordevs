<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Replacing AJAX calls in Razor Pages with Razor Components and Blazor - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Replacing AJAX calls in Razor Pages with Razor Components and Blazor - linksfor.dev(s)"/>
    <meta property="og:description" content="In this post I show how you can get AJAX-like behaviour in your Razor Pages by using Razor Components and Blazor"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://andrewlock.net/replacing-ajax-calls-in-razor-pages-using-razor-components-and-blazor/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Replacing AJAX calls in Razor Pages with Razor Components and Blazor</title>
<div class="readable">
        <h1>Replacing AJAX calls in Razor Pages with Razor Components and Blazor</h1>
            <div>Reading time: 19-24 minutes</div>
        <div>Posted here: 24 Mar 2020</div>
        <p><a href="https://andrewlock.net/replacing-ajax-calls-in-razor-pages-using-razor-components-and-blazor/">https://andrewlock.net/replacing-ajax-calls-in-razor-pages-using-razor-components-and-blazor/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

<div>
<p>In <a href="https://andrewlock.net/dont-replace-your-view-components-with-razor-components/">a recent post</a> I looked at whether you should consider using Razor Components in places where you would previously have used View Components. The answer was an emphatic no, but that doesn't mean you shouldn't use Razor Components, just don't use them like View Components!</p>
<p>In this post I look at a different use case, one that <em>is</em> suited to Razor Components, and add some client-side functionality that otherwise would have required rather more effort.</p>
<h2 id="the-scenario-cascading-dropdowns">The scenario: cascading dropdowns<a href="#the-scenario-cascading-dropdowns"></a></h2>
<p>The scenario I'm going to use in this post is probably familiar: cascading dropdowns. That is where you have two dropdowns (<code>&lt;select&gt;</code> elements), where changing a value in the first drop down changes the values in the second. In the example below, selecting a <code>country</code> from the drop down changes the <code>states</code> that you can choose from in the second:</p>
<picture>
<source srcset="/content/images/2020/razor_components_ajax.mp4" type="video/mp4">
<source srcset="/content/images/2020/razor_components_ajax.webp" type="image/webp">
<img src="https://andrewlock.net/content/images/2020/razor_components_ajax.gif" alt="Cascading drop downs in action">
</picture>
<blockquote>
<p>Please don't be offended USA, I know you have more than 2 states, I'm just lazy ðŸ˜‰</p>
</blockquote>
<p>I chose this scenario for a couple of reasons. First, it's a <em>very</em> common scenario. I've personally built similar cascading dropdowns on numerous occasions. Second, it's a common scenario for demonstrating how to use AJAX with Razor Pages:</p>
<ul>
<li><a href="https://twitter.com/mikesdotnetting">Mike Brind</a>'s website <a href="https://www.learnrazorpages.com/razor-pages/ajax/cascading-dropdowns">Learn Razor Pages describes exactly this scenario.</a></li>
<li><a href="https://twitter.com/thereformedprog">Jon P Smith</a> (author of <a href="https://t.co/3x6VBMbONr?amp=1">EF Core in Action</a>) describes a similar scenario in his <a href="https://www.thereformedprogrammer.net/asp-net-core-razor-pages-how-to-implement-ajax-requests/">popular blog post.</a>.</li>
</ul>
<p>These posts both explore multiple options for achieving the dynamic client-side behaviour, which inevitably involve some JavaScript (JS) on the client-side (either JQuery or native fetch APIs) along with either additional MVC actions, dedicated Razor Pages, or additional Razor Page handlers for generating the response. Up to now those were pretty much the only options for Razor Pages apps.</p>
<p>Razor Components provide an intriguing alternative. Now you can write C#/Razor code to add an island of interactivity into an otherwise server-side rendered app. </p>
<blockquote>
<p>The JS examples in those posts aren't obsolete just because Razor Components exist. They're perfectly valid options, and potentially easier, depending on your perspective and requirements. The approach I show in this post just shows an alternative.</p>
</blockquote>
<h2 id="-disclaimer-you-re-using-blazor-">âš  Disclaimer - you're using Blazor âš <a href="#-disclaimer-you-re-using-blazor-"></a></h2>
<p>Using Razor Components (if they're not <a href="https://andrewlock.net/dont-replace-your-view-components-with-razor-components/">statically rendered as in my last post</a>) implies you're using <a href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor">Blazor</a>. Blazor is <a href="https://channel9.msdn.com/Events/dotnetConf/Focus-on-Blazor">all the rage in .NET at the moment</a>, and Blazor Server was officially released with .NET Core 3.0 in 2019. Blazor WebAssembly (client side) is planned for release in the first half of 2020.</p>
<p>It's important to realise what you're signing up for when you use Blazor. If you use Blazor Server, you're getting:</p>
<ul>
<li>A <strong>stateful</strong> web application that communicates between your clients and server via SignalR/web sockets.</li>
<li>A <strong>small</strong> client-side download size.</li>
<li>Primarily execution on the <em>server</em> not the client.</li>
<li>Clients need a permanent connection to the server to interact. Offline mode is not supported, and latencies will be higher than for client-side frameworks.</li>
<li>Applications can directly access resources (e.g. a database, the filesystem) as though they're running on the server (because they are!)</li>
</ul>
<p>In contrast, with Blazor WebAssembly, you're getting:</p>
<ul>
<li>A (potentially) <strong>client-side only</strong> application. Essentially equivalent to other JavaScript client-side frameworks like Angular, React, or Vue, so you only need a simple file server to serve the static files.</li>
<li>A <strong>large</strong> client-side download size. Trying to reduce this size is one of the primary focuses for the .NET teams in Microsoft at the moment.</li>
<li>Execution occurs on the <em>client</em>, not the server. </li>
<li>Clients don't need a connection to the server, and can support offline mode (<a href="https://developers.google.com/web/fundamentals/primers/service-workers">by using a service worker</a>).</li>
<li>Application must access resources via traditional web APIs (the same way other client-side frameworks do today).</li>
</ul>
<p>Whichever approach you go for, there are trade offs to be made. I've only played with Blazor a little, and there's plenty of more in-depth opinion pieces out, but my gut feeling is:</p>
<blockquote>
<p>Blazor Server will be a great choice for enterprise/line of business apps, where a good web connection is practically guaranteed. The biggest gotcha from an operations perspective is that apps are stateful, and you need to consider how to manage the SignalR connections.</p>
</blockquote>
<p>On the other hand: </p>
<blockquote>
<p>Blazor WebAssembly will be a very interesting "drop in replacement" to current JS client-side frameworks for "consumer" apps (once they tackle technical hurdles like performance). My biggest concern is the fact we either have to reinvent the wheel to match the existing JS library ecosystem, or you're stuck doing JS interop, and in doing so are giving up some of the benefits Blazor promises.</p>
</blockquote>
<p>Anyway, that's rather more of a digression than I intended initially, the important thing is that you're aware <strong>the samples in this post use Blazor Server</strong>, and as such have all the associated <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/state-management?view=aspnetcore-3.1#blazor-circuits">operational challenges</a> that come with that.</p>
<p>Time to look at some code.</p>
<h2 id="adding-blazor-to-a-razor-pages-application-">Adding Blazor to a Razor Pages application.<a href="#adding-blazor-to-a-razor-pages-application-"></a></h2>
<p>The first thing we need is a Razor Pages application. I created the default Razor Pages application (without authentication) by running <code>dotnet new webapp</code>. Next, I ran through <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/hosting-models?view=aspnetcore-3.1#blazor-server">the steps from the documentation</a> to add Blazor to a Razor Pages app:</p>
<ol>
<li>Add a <code>&lt;base href="~/"&gt;</code> tag just before the closing <code>&lt;/head&gt;</code> in <em>Pages/Shared/_Layout.cshtml</em>.</li>
<li>In the same file, add the following <code>&lt;script&gt;</code> tag, just before the closing <code>&lt;/body&gt;</code>. This is the script that bootstraps Blazor on the client side. If you're only running Razor Components on a sub-set of pages, you could conditionally include this in the <code>"Scripts"</code> section, in the same way validation scripts are only included on pages that need them:</li>
</ol>
<pre><code><span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>"</span>_framework/blazor.server.js<span>"</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
</code></pre>
<ol start="3">
<li>Add an <em>_Imports.razor</em> file in the project root directory containing the following (and updating the last namespace to match the project name):</li>
</ol>
<pre><code>@<span>using</span> System<span>.</span>Net<span>.</span>Http
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Authorization
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Authorization
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Forms
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Routing
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Web
@<span>using</span> Microsoft<span>.</span>JSInterop
@<span>using</span> AjaxRazorComponent 
</code></pre>
<ol start="4">
<li>In <code>Startup.ConfigureServices()</code>, add the Blazor services:</li>
</ol>
<pre><code><span>public</span> <span>void</span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
    
    services<span>.</span><span>AddRazorPages</span><span>(</span><span>)</span><span>;</span>
    services<span>.</span><span>AddServerSideBlazor</span><span>(</span><span>)</span><span>;</span> 
<span>}</span>
</code></pre>
<ol start="5">
<li>Map the Blazor SignalR hub in <code>Startup.Configure()</code>:</li>
</ol>
<pre><code><span>public</span> <span>void</span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
<span>{</span>
    

    app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=</span><span>&gt;</span>
    <span>{</span>
        endpoints<span>.</span><span>MapRazorPages</span><span>(</span><span>)</span><span>;</span>
        endpoints<span>.</span><span>MapBlazorHub</span><span>(</span><span>)</span><span>;</span> 
    <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre>
<p>With these steps complete, we now have a Razor Pages/Blazor hybrid application. Hooray! </p>
<p>Now it's time to actually make use of the Blazor features.</p>
<h2 id="building-the-form">Building the form<a href="#building-the-form"></a></h2>
<p>As this is for demonstration purposes, I'm going to start by creating a very basic form on the home page of the application, <em>Pages/Index.cshtml</em>. This form consists of a single field (currently) and a submit button. Whatever is entered and POSTed to the server is echoed back in the alert (safely).</p>
<p><img src="https://andrewlock.net/content/images/2020/razor_components_ajax_01.png" alt="The initial form demonstrating a basic form"></p>
<p>There's nothing particularly special in the Razor markup. We use the standard Razor Page form Tag Helpers (<code>asp-page</code>, <code>asp-validation-summary</code>, <code>asp-for</code> etc) to build the form that contains a single <code>Greeting</code> field:</p>
<pre><code>@page
@model IndexModel

@if (!string.IsNullOrEmpty(Model.Message))
{
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>alert alert-info<span>"</span></span><span>&gt;</span></span>
      @Model.Message
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
}

<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>row<span>"</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>col-md-4<span>"</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>form</span> <span>asp-page</span><span><span>=</span><span>"</span>/Index<span>"</span></span> <span>method</span><span><span>=</span><span>"</span>post<span>"</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>div</span> <span>asp-validation-summary</span><span><span>=</span><span>"</span>ModelOnly<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>form-group<span>"</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>label</span> <span>asp-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>label</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>input</span> <span>asp-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>form-control<span>"</span></span> <span>/&gt;</span></span>
                <span><span><span>&lt;</span>span</span> <span>asp-validation-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>

            <span><span><span>&lt;</span>button</span> <span>id</span><span><span>=</span><span>"</span>registerSubmit<span>"</span></span> <span>type</span><span><span>=</span><span>"</span>submit<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>btn btn-primary<span>"</span></span><span>&gt;</span></span>Send value<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>form</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre>
<p>The code-behind is similarly uneventful. For now the <code>OnPost</code> handler just copies the model-bound <code>Greeting</code> field to the <code>Message</code> property for display:</p>
<pre><code><span>public</span> <span>class</span> <span>IndexModel</span> <span>:</span> <span>PageModel</span>
<span>{</span>
    <span>[</span><span>BindProperty</span><span>,</span> Required<span>]</span> <span>public</span> <span>string</span> Greeting <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> 
    <span>public</span> <span>string</span> Message <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> 

    <span>public</span> <span>void</span> <span>OnGet</span><span>(</span><span>)</span> <span>{</span> <span>}</span>

    <span>public</span> <span>void</span> <span>OnPost</span><span>(</span><span>)</span>
    <span>{</span>
        <span>if</span> <span>(</span>ModelState<span>.</span>IsValid<span>)</span>
        <span>{</span>
            Message <span>=</span> Greeting<span>;</span> 
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre>
<p>Now we can start integrating our Razor Components.</p>
<h2 id="building-a-razor-components-cascading-dropdown">Building a Razor components cascading dropdown<a href="#building-a-razor-components-cascading-dropdown"></a></h2>
<p>The goal of this section is to build a simple cascading drop-down component, where the value selected in the first component changes the values available in the second. Finally, we want the selected values to be POSTed in the Razor Page, just as though we'd used normal drop-downs and <a href="https://www.thereformedprogrammer.net/asp-net-core-razor-pages-how-to-implement-ajax-requests/">traditional AJAX to retrieve the possible values</a>.</p>
<p><img src="https://andrewlock.net/content/images/2020/razor_components_ajax_02.png" alt="Image of the cascading drop downs"></p>
<p>Start by adding a new file, <em>CountryDropdown.razor</em>. For simplicity I added it to the <em>Pages</em> folder, but you will probably want to organise your files more carefully than that!</p>
<p>Inside this file add the following:</p>
<pre><code><span>&lt;</span>div <span>class</span><span>=</span><span>"form-row"</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>"col"</span><span>&gt;</span>
        <span>&lt;</span><span>select</span> @onchange<span>=</span><span>"CountrySelectionChanged"</span> name<span>=</span><span>"@CountryFieldName"</span> <span>class</span><span>=</span><span>"form-control"</span><span>&gt;</span>
            <span>&lt;</span>option<span>&gt;</span><span>&lt;</span><span>/</span>option<span>&gt;</span>
            @<span>foreach</span> <span>(</span><span>var</span> country <span>in</span> Countries<span>)</span>
            <span>{</span>
                <span>&lt;</span>option selected<span>=</span><span>"@(country==SelectedCountry)"</span> <span>value</span><span>=</span><span>"@country"</span><span>&gt;</span>@country<span>&lt;</span><span>/</span>option<span>&gt;</span>
            <span>}</span>
        <span>&lt;</span><span>/</span><span>select</span><span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>"col"</span><span>&gt;</span>
        @<span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>SelectedCountry<span>)</span><span>)</span>
        <span>{</span>
            <span>&lt;</span><span>select</span> name<span>=</span><span>"@StateFieldName"</span> <span>class</span><span>=</span><span>"form-control"</span><span>&gt;</span>
                <span>&lt;</span>option<span>&gt;</span><span>&lt;</span><span>/</span>option<span>&gt;</span>
                @<span>foreach</span> <span>(</span><span>var</span> state <span>in</span> States<span>[</span><span>SelectedCountry</span><span>]</span><span>)</span>
                <span>{</span>
                    <span>&lt;</span>option selected<span>=</span><span>"@(state==SelectedState)"</span> <span>value</span><span>=</span><span>"@state"</span><span>&gt;</span>@state<span>&lt;</span><span>/</span>option<span>&gt;</span>
                <span>}</span>
            <span>&lt;</span><span>/</span><span>select</span><span>&gt;</span>
        <span>}</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span>

@code <span>{</span>

    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> SelectedCountry <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> SelectedState <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> CountryFieldName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> StateFieldName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>private</span> <span>static</span> <span>readonly</span> List<span>&lt;</span><span>string</span><span>&gt;</span> Countries <span>=</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span> <span>{</span><span>"United Kingdom"</span><span>,</span> <span>"USA"</span> <span>}</span><span>;</span>
    <span>private</span> <span>static</span> <span>readonly</span> Dictionary<span>&lt;</span><span>string</span><span>,</span> List<span>&lt;</span><span>string</span><span>&gt;</span><span>&gt;</span> States <span>=</span> <span>new</span> <span>Dictionary</span><span>&lt;</span><span>string</span><span>,</span> List<span>&lt;</span><span>string</span><span>&gt;</span><span>&gt;</span>
    <span>{</span>
        <span>{</span><span>"United Kingdom"</span><span>,</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span><span>{</span><span>"Devon"</span><span>,</span> <span>"Cornwall"</span><span>,</span> <span>"Somerset"</span> <span>}</span> <span>}</span><span>,</span>
        <span>{</span><span>"USA"</span><span>,</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span><span>{</span><span>"New York"</span><span>,</span> <span>"Texas"</span> <span>}</span> <span>}</span><span>,</span>
    <span>}</span><span>;</span>

    <span>public</span> <span>void</span> <span>CountrySelectionChanged</span><span>(</span><span>ChangeEventArgs</span> args<span>)</span>
    <span>{</span>
        <span>var</span> country <span>=</span> args<span>.</span><span>Value</span> <span>as</span> <span>string</span><span>;</span>

        <span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>country<span>)</span> <span>&amp;&amp;</span> Countries<span>.</span><span>Contains</span><span>(</span>country<span>)</span><span>)</span>
        <span>{</span>
            SelectedCountry <span>=</span> country<span>;</span>
        <span>}</span>
        <span>else</span>
        <span>{</span>
            SelectedCountry <span>=</span> <span>null</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre>
<p>That's quite a lot of code in one go (and the code hightlighting for Razor isn't brilliant on my blog), so I'll break it down piece by piece, starting from the bottom <code>@code</code> section.</p>
<pre><code>@code <span>{</span>
    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> SelectedCountry <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> SelectedState <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> CountryFieldName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span>Parameter</span><span>]</span> <span>public</span> <span>string</span> StateFieldName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    
<span>}</span>
</code></pre>
<p>First we have the parameters that are passed in from a parent component (which will be our Razor Page). These specify the currently selected values (<code>SelectedCountry</code> and <code>SelectedState</code>) and the names to use for the controls. </p>
<p>We need to provide the names for the controls so that they are bound correctly to our Razor Page model when we POST back to the server. The <code>SelectedCountry</code> and <code>SelectedState</code> are provided so that we can preserve the values across POSTs, or to set an initial value</p>
<pre><code>
<span>private</span> <span>static</span> <span>readonly</span> List<span>&lt;</span><span>string</span><span>&gt;</span> Countries <span>=</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span> <span>{</span><span>"United Kingdom"</span><span>,</span> <span>"USA"</span> <span>}</span><span>;</span>
<span>private</span> <span>static</span> <span>readonly</span> Dictionary<span>&lt;</span><span>string</span><span>,</span> List<span>&lt;</span><span>string</span><span>&gt;</span><span>&gt;</span> States <span>=</span> <span>new</span> <span>Dictionary</span><span>&lt;</span><span>string</span><span>,</span> List<span>&lt;</span><span>string</span><span>&gt;</span><span>&gt;</span>
<span>{</span>
    <span>{</span><span>"United Kingdom"</span><span>,</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span><span>{</span><span>"Devon"</span><span>,</span> <span>"Cornwall"</span><span>,</span> <span>"Somerset"</span> <span>}</span> <span>}</span><span>,</span>
    <span>{</span><span>"USA"</span><span>,</span> <span>new</span> <span>List</span><span>&lt;</span><span>string</span><span>&gt;</span><span>{</span><span>"New York"</span><span>,</span> <span>"Texas"</span> <span>}</span> <span>}</span><span>,</span>
<span>}</span><span>;</span>


</code></pre>
<p>The next static properties serve as dummy implementations of a country/state lookup. In practice you would probably load these from a service or the database, but that's not important to this implementation. Remember we're using Blazor Server here, so the code is running on the Server, and you can directly access anything you need, rather than having to use a Web API or similar.</p>
<pre><code><span>public</span> <span>void</span> <span>CountrySelectionChanged</span><span>(</span><span>ChangeEventArgs</span> args<span>)</span>
<span>{</span>
    <span>var</span> country <span>=</span> args<span>.</span><span>Value</span> <span>as</span> <span>string</span><span>;</span>

    <span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>country<span>)</span> <span>&amp;&amp;</span> Countries<span>.</span><span>Contains</span><span>(</span>country<span>)</span><span>)</span>
    <span>{</span>
        SelectedCountry <span>=</span> country<span>;</span>
    <span>}</span>
    <span>else</span>
    <span>{</span>
        SelectedCountry <span>=</span> <span>null</span><span>;</span>
    <span>}</span>
<span>}</span>
</code></pre>
<p>Next we have the <code>CountrySelectionChanged</code> function which is invoked every time the <code>Country</code> drop-down changes. We do some basic validation in there to make sure the selected country is actually one that we're allowed and set or clear the <code>SelectedCountry</code> as appropriate.</p>
<p>If we now look at the Razor markup itself, we can see how all these properties hook together. The <code>&lt;select&gt;</code> elements contain all the behaviour. For the first drop down we list out the available <code>Countries</code>, marking the appropriate <code>&lt;option&gt;</code> as selected, and hooking up the <code>onchange</code> handler. The second drop down is only rendered if we have a selected country, and if we do, renders all the <code>States</code>. Note that both <code>&lt;select&gt;</code> elements are using the <code>name</code> attribute values that were passed as <code>[Parameter]</code> values.</p>
<pre><code><span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>form-row<span>"</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>col<span>"</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>select</span> <span>@onchange</span><span><span>=</span><span>"</span>CountrySelectionChanged<span>"</span></span> <span>name</span><span><span>=</span><span>"</span>@CountryFieldName<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>form-control<span>"</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>option</span><span>&gt;</span></span><span><span><span>&lt;/</span>option</span><span>&gt;</span></span>
            @foreach (var country in Countries)
            {
                <span><span><span>&lt;</span>option</span> <span>selected</span><span><span>=</span><span>"</span>@(country==SelectedCountry)<span>"</span></span> <span>value</span><span><span>=</span><span>"</span>@country<span>"</span></span><span>&gt;</span></span>@country<span><span><span>&lt;/</span>option</span><span>&gt;</span></span>
            }
        <span><span><span>&lt;/</span>select</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>col<span>"</span></span><span>&gt;</span></span>
        @if (!string.IsNullOrEmpty(SelectedCountry))
        {
            <span><span><span>&lt;</span>select</span> <span>name</span><span><span>=</span><span>"</span>@StateFieldName<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>form-control<span>"</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>option</span><span>&gt;</span></span><span><span><span>&lt;/</span>option</span><span>&gt;</span></span>
                @foreach (var state in States[SelectedCountry])
                {
                    <span><span><span>&lt;</span>option</span> <span>selected</span><span><span>=</span><span>"</span>@(state==SelectedState)<span>"</span></span> <span>value</span><span><span>=</span><span>"</span>@state<span>"</span></span><span>&gt;</span></span>@state<span><span><span>&lt;/</span>option</span><span>&gt;</span></span>
                }
            <span><span><span>&lt;/</span>select</span><span>&gt;</span></span>
        }
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
</code></pre>
<p>As I said, this is a very rudimentary implementation, but it does the basics. In practice you would want to be more careful that the provided <code>SelectedCountry</code> and <code>SelectedState</code> are valid values, and you would probably use different values for the text/key of the drop down; I'm just using the full name for both.</p>
<h2 id="using-the-razor-component-from-a-razor-page">Using the Razor Component from a Razor Page<a href="#using-the-razor-component-from-a-razor-page"></a></h2>
<p>With the basic component complete, we can drop it into our Razor Pages form. I'll start by adding the extra fields to the <code>IndexModel</code> that we want to be POSTed back when the Submit button is clicked, and adjusting the message displayed in the "OnPost" handler.</p>
<pre><code><span>public</span> <span>class</span> <span>IndexModel</span> <span>:</span> <span>PageModel</span>
<span>{</span>
    <span>[</span><span>BindProperty</span><span>,</span> Required<span>]</span> <span>public</span> <span>string</span> Greeting <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>[</span><span>BindProperty</span><span>,</span> Required<span>]</span> <span>public</span> <span>string</span> Country <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> 
    <span>[</span><span>BindProperty</span><span>,</span> Required<span>]</span> <span>public</span> <span>string</span> State <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span> 
    <span>public</span> <span>string</span> Message <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

    <span>public</span> <span>void</span> <span>OnGet</span><span>(</span><span>)</span> <span>{</span> <span>}</span>

    <span>public</span> <span>void</span> <span>OnPost</span><span>(</span><span>)</span>
    <span>{</span>
        <span>if</span> <span>(</span>ModelState<span>.</span>IsValid<span>)</span>
        <span>{</span>
            Message <span>=</span> $<span>"{Greeting} from {State}, {Country}"</span><span>;</span> 
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre>
<p>Note that I've marked the <code>Country</code> and <code>State</code> fields as <code>[Required]</code> as well, so we'll only display the message if all three fields have a value. </p>
<p>Next we'll update the <em>Index.cshtml</em> file to render the component. I've only shown the <code>&lt;form&gt;</code> element for simplicity, the rest of the page stays the same:</p>
<pre><code><span><span><span>&lt;</span>form</span> <span>asp-page</span><span><span>=</span><span>"</span>/Index<span>"</span></span> <span>method</span><span><span>=</span><span>"</span>post<span>"</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>asp-validation-summary</span><span><span>=</span><span>"</span>ModelOnly<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>form-group<span>"</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>label</span> <span>asp-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>label</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>input</span> <span>asp-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>form-control<span>"</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;</span>span</span> <span>asp-validation-for</span><span><span>=</span><span>"</span>Greeting<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>

    
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>"</span>form-group<span>"</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>label</span> <span>asp-for</span><span><span>=</span><span>"</span>Country<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>label</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>component</span> <span>type</span><span><span>=</span><span>"</span>typeof(CountryDropdown)<span>"</span></span>
                    <span>render-mode</span><span><span>=</span><span>"</span>ServerPrerendered<span>"</span></span>
                    <span>param-CountryFieldName</span><span><span>=</span><span>"</span>Html.NameFor(x=&gt;x.Country)<span>"</span></span>
                    <span>param-SelectedCountry</span><span><span>=</span><span>"</span>Model.Country<span>"</span></span>
                    <span>param-StateFieldName</span><span><span>=</span><span>"</span>Html.NameFor(x=&gt;x.State)<span>"</span></span>
                    <span>param-SelectedState</span><span><span>=</span><span>"</span>Model.State<span>"</span></span> <span>/&gt;</span></span>

        <span><span><span>&lt;</span>span</span> <span>asp-validation-for</span><span><span>=</span><span>"</span>Country<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>span</span> <span>asp-validation-for</span><span><span>=</span><span>"</span>State<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>text-danger<span>"</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    

    <span><span><span>&lt;</span>button</span> <span>id</span><span><span>=</span><span>"</span>registerSubmit<span>"</span></span> <span>type</span><span><span>=</span><span>"</span>submit<span>"</span></span> <span>class</span><span><span>=</span><span>"</span>btn btn-primary<span>"</span></span><span>&gt;</span></span>Send value<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>form</span><span>&gt;</span></span>
</code></pre>
<p>There's a couple of things to note here</p>
<ul>
<li>I'm using the <code>&lt;label&gt;</code> and validation Tag Helpers inside the Razor Page to render the appropriate HTML. <em>You can't use Tag Helpers from inside Razor Components</em>, so this is the easiest place to use them.</li>
<li>To get the correct name for model-binding, I used the <code>Html.NameFor()</code> helper methods.</li>
<li>The Razor Component is only used to set the correct values in the <code>&lt;select&gt;</code> element - the actual POST back is done using a standard Razor Page form post.</li>
</ul>
<p>That's all there is to it. You can now run the application, and you'll have a cascading dropdown, no JavaScript required! </p>
<picture>
<source srcset="/content/images/2020/razor_components_ajax.mp4" type="video/mp4">
<source srcset="/content/images/2020/razor_components_ajax.webp" type="image/webp">
<img src="https://andrewlock.net/content/images/2020/razor_components_ajax.gif" alt="Cascading drop downs in action">
</picture>
<p>Of course, nothing's ever as simple as thatâ€¦</p>
<h2 id="limitations-and-alternatives">Limitations and alternatives<a href="#limitations-and-alternatives"></a></h2>
<p>One thing that's not entirely obvious in the video above is that although we added the <code>[Required]</code> validation attributes to our model, we're only doing validation on the server currently. That means we POST the values, check validation, and display the validation errors if there were any. </p>
<p>Server validation is <em>always</em> required for security reasons, but you can add client-side validation for an improved user experience - don't let users post something you know is going to fail! Normally you can add the client-side validation scripts to <em>Index.cshtml</em> by adding the following to the bottom of the page:</p>
<pre><code>@section Scripts <span>{</span>
    <span>&lt;</span><span>partial</span> name<span>=</span><span>"_ValidationScriptsPartial"</span> <span>/</span><span>&gt;</span>
<span>}</span>
</code></pre>
<p>Unfortunately, this doesn't work for our Razor Components! The <em>server-side</em> validation works correctly, but there's no client-side validation for the Country/State drop downs (although there is for the Greeting text box). Unfortunately the two approaches are just not compatible as far as I can see, so that's a limitation you'd have to live with.</p>
<p>There is an alternative of course: instead of only making the cascading drop-downs a Razor Component, you could make the <em>whole form</em> a Razor component instead! Razor Components built like this <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/forms-validation?view=aspnetcore-3.1">support full client-side and server-side validation using DataAnnotations</a>. The question then is whether you want to go that far or not. </p>
<p>Arguably, if you're using <em>any</em> server-side Blazor, then you may as well expand your usage like this whenever you hit rough edges. You're not really losing anything by doing so, as you've <em>already</em> tied yourself to the stateful application and connection requirements! </p>
<p>In many ways the Blazor development experience is really nice. You get to use a build toolchain that you're already familiar with, the speed of development is refreshing, and you can integrate it with existing solutions like Razor Pages. That's not to say Blazor is a panacea by any means, but it's definitely worth keeping in your back pocket for those occasions where the trade-offs make it worth while.</p>
<h2 id="summary">Summary<a href="#summary"></a></h2>
<p>In this post I showed how you can easily create cascading dropdowns using Razor Components and Blazor Server, where the selection in the first dropdown changes the options available in the second. </p>
<p>Rather than building a standalone Blazor app, I showed how you can embed this behaviour inside Razor Pages, to avoid having to write AJAX queries for simple enhancements like this. I also showed how to make sure the form elements interoperate properly with your Razor Pages during post back, by setting the correct form names.</p>
<p>The technique isn't completely perfect, you can't easily use client-side validation with this approach. If that's a problem you may want to consider building the whole form using Blazor. If you do try this approach, just be sure you understand the <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/state-management?view=aspnetcore-3.1#blazor-circuits">operational implications of using Blazor</a>.</p>
</div>
</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>