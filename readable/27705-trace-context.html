<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Trace Context -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Trace Context</h1><div><div><section id="abstract" class="introductory"><h2>Abstract</h2><p>This specification defines standard HTTP headers and a value format to propagate context information that enables distributed tracing scenarios. The specification standardizes how context information is sent and modified between services. Context information uniquely identifies individual requests in a distributed system and also defines a means to add and propagate provider-specific context information.</p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em></p><p>
      This document was published by the <a href="https://www.w3.org/2018/distributed-tracing/">Distributed Tracing Working Group</a> as a
      Recommendation.

    </p><p><a href="https://github.com/w3c/trace-context/issues/">GitHub Issues</a> are preferred for
            discussion of this specification.

      Alternatively, you can send comments to our mailing list.
            Please send them to
            <a href="mailto:public-trace-context@w3.org?subject=trace-context">public-trace-context@w3.org</a>
            (<a href="https://lists.w3.org/Archives/Public/public-trace-context/">archives</a>)
                  with <code>trace-context</code> at the start of your
                  email's subject
                .

    </p><p>
      Please see the Working Group's
      <a href="https://github.com/w3c/trace-context/blob/master/implementations.md">implementation report</a>.
    </p><p>This document has been reviewed by W3C Members, by software developers, and by other W3C groups and interested parties, and is endorsed by the Director as a W3C Recommendation. It is a stable document and may be used as reference material or cited from another document. W3C's role in making the Recommendation is to draw attention to the specification and to promote its widespread deployment. This enhances the functionality and interoperability of the Web.</p><p>

        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.


                  <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                  <a rel="disclosure" href="https://www.w3.org/2004/01/pp-impl/108594/status">public list of any patent disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.


    </p><p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="https://www.w3.org/2019/Process-20190301/">1 March 2019 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><section id="conformance"><h2 id="x1-conformance"><bdi class="secno">1. </bdi>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> in this document
            are to be interpreted as described in
            <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>]
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>] when, and only when, they appear
            in all capitals, as shown here.
          </p></section><section id="overview"><h2 id="x2-overview"><bdi class="secno">2. </bdi>Overview<a class="self-link" aria-label="§" href="#overview"></a></h2><section id="problem-statement"><h3 id="x2-1-problem-statement"><bdi class="secno">2.1 </bdi>Problem Statement<a class="self-link" aria-label="§" href="#problem-statement"></a></h3><p>Distributed tracing is a methodology implemented by tracing tools to follow, analyze and debug a transaction across multiple software components. Typically, a <a href="#dfn-distributed-traces" class="internalDFN" data-link-type="dfn">distributed trace</a> traverses more than one component which requires it to be uniquely identifiable across all participating systems. Trace context propagation passes along this unique identification. Today, trace context propagation is implemented individually by each tracing vendor. In multi-vendor environments, this causes interoperability problems, like:</p><ul><li>Traces that are collected by different tracing vendors cannot be correlated as there is no shared unique identifier.</li><li>Traces that cross boundaries between different tracing vendors can not be propagated as there is no uniformly agreed set of identification that is forwarded.</li><li>Vendor specific metadata might be dropped by intermediaries.</li><li>Cloud platform vendors, intermediaries and service providers, cannot guarantee to support trace context propagation as there is no standard to follow.</li></ul><p>In the past, these problems did not have a significant impact as most applications were monitored by a single tracing vendor and stayed within the boundaries of a single platform provider. Today, an increasing number of applications are highly distributed and leverage multiple middleware services and cloud platforms.</p><p>This transformation of modern applications calls for a distributed tracing context propagation standard.</p></section><section id="solution"><h3 id="x2-2-solution"><bdi class="secno">2.2 </bdi>Solution<a class="self-link" aria-label="§" href="#solution"></a></h3><p>The trace context specification defines a universally agreed-upon format for the exchange of trace context propagation data - referred to as <em>trace context</em>. Trace context solves the problems described above by</p><ul><li>providing an unique identifier for individual traces and requests, allowing trace data of multiple providers to be linked together.</li><li>providing an agreed-upon mechanism to forward vendor-specific trace data and avoid broken traces when multiple tracing tools participate in a single transaction.</li><li>providing an industry standard that intermediaries, platforms, and hardware providers can support.</li></ul><p>A unified approach for propagating trace data improves visibility into the behavior of distributed applications, facilitating problem and performance analysis. The interoperability provided by trace context is a prerequisite to manage modern micro-service based applications.</p></section><section id="design-overview"><h3 id="x2-3-design-overview"><bdi class="secno">2.3 </bdi>Design Overview<a class="self-link" aria-label="§" href="#design-overview"></a></h3><p>Trace context is split into two individual propagation fields supporting interoperability and vendor-specific extensibility:</p><ul><li><code>traceparent</code> describes the position of the incoming request in its trace graph in a portable, fixed-length format. Its design focuses on fast parsing. Every tracing tool <em class="rfc2119" title="MUST">MUST</em> properly set <code>traceparent</code> even when it only relies on vendor-specific information in <code>tracestate</code></li><li><code>tracestate</code> extends <code>traceparent</code> with vendor-specific data represented by a set of name/value pairs. Storing information in <code>tracestate</code> is optional.</li></ul><p>Tracing tools can provide two levels of compliant behavior interacting with trace context:</p><ul><li>At a minimum they <em class="rfc2119" title="MUST">MUST</em> propagate the <code>traceparent</code> and <code>tracestate</code> headers and guarantee traces are not broken. This behavior is also referred to as forwarding a trace.</li><li>In addition they CAN also choose to participate in a trace by modifying the <code>traceparent</code> header and relevant parts of the <code>tracestate</code> header containing their proprietary information. This is also referred to as participating in a trace.</li></ul><p>A tracing tool can choose to change this behavior for each individual request to a component it is monitoring.</p></section></section><section class="informative" id="processing-model"><h2 id="x4-processing-model"><bdi class="secno">4. </bdi>Processing Model<a class="self-link" aria-label="§" href="#processing-model"></a></h2><p><em>This section is non-normative.</em></p><p>This section provides a step-by-step example of a tracing vendor receiving a request with trace context headers, processing the request and then potentially forwarding it. This description can be used as a reference when implementing a trace context-compliant tracing system, middleware (like a proxy or messaging bus), or a cloud service.</p><section id="processing-model-for-working-with-trace-context"><h3 id="x4-1-processing-model-for-working-with-trace-context"><bdi class="secno">4.1 </bdi>Processing Model for Working with Trace Context<a class="self-link" aria-label="§" href="#processing-model-for-working-with-trace-context"></a></h3><p>This processing model describes the behavior of a vendor that modifies and forwards trace context headers. How the model works depends on whether or not a <code>traceparent</code> header is received.</p></section><section id="no-traceparent-received"><h3 id="x4-2-no-traceparent-received"><bdi class="secno">4.2 </bdi>No traceparent Received<a class="self-link" aria-label="§" href="#no-traceparent-received"></a></h3><p>If no traceparent header is received:</p><ol><li>The vendor checks an incoming request for a <code>traceparent</code> and a <code>tracestate</code> header.</li><li>Because the <code>traceparent</code> header is not received, the vendor creates a new <code>trace-id</code> and <code>parent-id</code> that represents the current request.</li><li>If a <code>tracestate</code> header is received without an accompanying <code>traceparent</code> header, it is invalid and <em class="rfc2119" title="MUST">MUST</em> be discarded.</li><li>The vendor <em class="rfc2119" title="SHOULD">SHOULD</em> create a new <code>tracestate</code> header and add a new key/value pair.</li><li>The vendor sets the <code>traceparent</code> and <code>tracestate</code> header for the outgoing request.</li></ol></section><section id="a-traceparent-is-received"><h3 id="x4-3-a-traceparent-is-received"><bdi class="secno">4.3 </bdi>A traceparent is Received<a class="self-link" aria-label="§" href="#a-traceparent-is-received"></a></h3><p>If a <code>traceparent</code> header is received:</p><ol><li><p>The vendor checks an incoming request for a <code>traceparent</code> and a <code>tracestate</code> header.</p></li><li><p>Because the <code>traceparent</code> header <em>is present</em>, the vendor tries to parse the version of the <code>traceparent</code> header.</p></li><li><p>If the <em>version cannot be parsed</em>, the vendor creates a new <code>traceparent</code> header and deletes <code>tracestate</code>.</p></li><li><p>If the <em>version number is higher</em> than supported by the tracer, the vendor uses the format defined in this specification (<code>00</code>) to parse <code>trace-id</code> and <code>parent-id</code>.
The vendor will only parse the <code>trace-flags</code> values supported by this version of this specification and ignore all other values. If parsing fails, the vendor creates a new <code>traceparent</code> header and deletes the <code>tracestate</code>. Vendors will set all unparsed / unknown <code>trace-flags</code> to 0 on outgoing requests.</p></li><li><p>If the vendor <em>supports the version number</em>, it validates <code>trace-id</code> and <code>parent-id</code>. If either <code>trace-id</code>, <code>parent-id</code> or <code>trace-flags</code> are invalid, the vendor creates a new <code>traceparent</code> header and deletes <code>tracestate</code>.</p></li><li><p>The vendor <em class="rfc2119" title="MAY">MAY</em> validate the <code>tracestate</code> header. If the <code>tracestate</code> header cannot be parsed the vendor <em class="rfc2119" title="MAY">MAY</em> discard the entire header. Invalid <code>tracestate</code> entries <em class="rfc2119" title="MAY">MAY</em> also be discarded.</p></li><li><p>For each outgoing request the vendor performs the following steps:</p><ol><li><p>The vendor <em class="rfc2119" title="MUST">MUST</em> modify the <code>traceparent</code> header:</p><ul><li><strong>Update <code>parent-id</code>:</strong> The value of property <code>parent-id</code><em class="rfc2119" title="MUST">MUST</em> be set to a value representing the ID of the current operation.</li><li><strong>Update <code>sampled</code>:</strong> The value of <code>sampled</code> reflects the caller's recording behavior. The value of the <code>sampled</code> flag of <code>trace-flags</code><em class="rfc2119" title="MAY">MAY</em> be set to <code>1</code> if the trace data is likely to be recorded or to <code>0</code> otherwise. Setting the flag is no guarantee that the trace will be recorded but increases the likeliness of end-to-end recorded traces.</li></ul></li><li><p>The vendor <em class="rfc2119" title="MAY">MAY</em> modify the <code>tracestate</code> header:</p><ul><li><strong>Update a key value:</strong> The value of any key can be updated. Modified keys <em class="rfc2119" title="MUST">MUST</em> be moved to the beginning (left) of the list.</li><li><strong>Add a new key/value pair:</strong> The new key-value pair <em class="rfc2119" title="MUST">MUST</em> be added to the beginning (left) of the list.</li><li><strong>Delete a key/value pair:</strong> Any key/value pair <em class="rfc2119" title="MAY">MAY</em> be deleted. Vendors <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> delete keys that weren't generated by themselves. Deletion of any key/value pair <em class="rfc2119" title="MAY">MAY</em> break correlation in other systems.</li></ul></li><li><p>The vendor sets the <code>traceparent</code> and <code>tracestate</code> header for the outgoing request.</p></li></ol></li></ol></section><section id="alternative-processing"><h3 id="x4-4-alternative-processing"><bdi class="secno">4.4 </bdi>Alternative Processing<a class="self-link" aria-label="§" href="#alternative-processing"></a></h3><p>The processing model above describes the complete set of steps for processing trace context headers. There are, however, situations when a vendor might only support a subset of the steps described above. Proxies or messaging middleware <em class="rfc2119" title="MAY">MAY</em> decide not to modify the <code>traceparent</code> headers but remove invalid headers or add additional information to <code>tracestate</code>.</p></section></section><section id="other-communication-protocols"><h2 id="x5-other-communication-protocols"><bdi class="secno">5. </bdi>Other Communication Protocols<a class="self-link" aria-label="§" href="#other-communication-protocols"></a></h2><p>While trace context is defined for HTTP, the authors acknowledge it is also relevant for other communication protocols. Extensions of this specification, as well as specifications produced by external organizations, define the format of trace context serialization and deserialization for other protocols. Note that these extensions may be at a different maturity level than this specification.</p><p>Please refer to the [<cite><a class="bibref" data-link-type="biblio" href="#bib-trace-context-protocols-registry" title="Trace Context Protocols Registry">trace-context-protocols-registry</a></cite>] for the details of trace context implementation for other protocols.</p></section><section class="appendix" id="acknowledgments"><h2 id="a-acknowledgments"><bdi class="secno">A. </bdi>Acknowledgments<a class="self-link" aria-label="§" href="#acknowledgments"></a></h2><p>Thanks to Adrian Cole, Christoph Neumüller, Daniel Khan, Erika Arnold, Fabian Lange, Matthew Wear, Reiley Yang, Ted Young, Tyler Benson, Victor Soares for their contributions to this work.</p></section><section class="informative" id="glossary"><h2 id="b-glossary"><bdi class="secno">B. </bdi>Glossary<a class="self-link" aria-label="§" href="#glossary"></a></h2><p><em>This section is non-normative.</em></p><dl><dt><dfn data-lt="distributed traces|Distributed trace" data-dfn-type="dfn" id="dfn-distributed-traces">Distributed trace</dfn></dt><dd>
A distributed trace is a set of events, triggered as a result
of a single logical operation, consolidated across various
components of an application. A distributed trace contains
events that cross process, network and security boundaries.
A distributed trace may be initiated when someone presses a
button to start an action on a website - in this example, the
trace will represent calls made between the downstream services
that handled the chain of requests initiated by this button
being pressed.
</dd></dl></section><section id="references" class="appendix"><h2 id="c-references"><bdi class="secno">C. </bdi>References<a class="self-link" aria-label="§" href="#references"></a></h2><section id="normative-references"><h3 id="c-1-normative-references"><bdi class="secno">C.1 </bdi>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3><dl class="bibliography"><dt id="bib-bit-field">[BIT-FIELD]</dt><dd><a href="https://en.wikipedia.org/wiki/Bit_field"><cite>8-bit field</cite></a>.  Wikipedia. URL: <a href="https://en.wikipedia.org/wiki/Bit_field">https://en.wikipedia.org/wiki/Bit_field</a></dd><dt id="bib-fetch">[FETCH]</dt><dd><a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Anne van Kesteren.  WHATWG. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a></dd><dt id="bib-rfc0020">[RFC0020]</dt><dd><a href="https://tools.ietf.org/html/rfc20"><cite>ASCII format for network interchange</cite></a>. V.G. Cerf.  IETF. October 1969. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc20">https://tools.ietf.org/html/rfc20</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc5234">[RFC5234]</dt><dd><a href="https://tools.ietf.org/html/rfc5234"><cite>Augmented BNF for Syntax Specifications: ABNF</cite></a>. D. Crocker, Ed.; P. Overell.  IETF. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a></dd><dt id="bib-rfc7230">[RFC7230]</dt><dd><a href="https://httpwg.org/specs/rfc7230.html"><cite>Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</cite></a>. R. Fielding, Ed.; J. Reschke, Ed..  IETF. June 2014. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc7230.html">https://httpwg.org/specs/rfc7230.html</a></dd><dt id="bib-rfc8174">[RFC8174]</dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc8174">https://tools.ietf.org/html/rfc8174</a></dd><dt id="bib-trace-context-protocols-registry">[trace-context-protocols-registry]</dt><dd><a href="https://www.w3.org/TR/trace-context-protocols-registry/"><cite>Trace Context Protocols Registry</cite></a>. Sergey Kanzhelev; Philippe Le Hégaret.  W3C. 14 March 2019. W3C Note. URL: <a href="https://www.w3.org/TR/trace-context-protocols-registry/">https://www.w3.org/TR/trace-context-protocols-registry/</a></dd></dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>