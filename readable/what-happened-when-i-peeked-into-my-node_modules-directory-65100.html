<!DOCTYPE html>
<html lang="en">
<head>
    <title>
What Happened When I Peeked Into My Node_Modules Directory - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="What Happened When I Peeked Into My Node_Modules Directory - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@jdan"/>
    <meta property="og:description" content="Just absolute madness"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/s/silicon-satire/i-peeked-into-my-node-modules-directory-and-you-wont-believe-what-happened-next-b89f63d21558"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - What Happened When I Peeked Into My Node_Modules Directory</title>
<div class="readable">
        <h1>What Happened When I Peeked Into My Node_Modules Directory</h1>
            <div>by https://medium.com/@jdan</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 02 Aug 2020</div>
        <p><a href="https://medium.com/s/silicon-satire/i-peeked-into-my-node-modules-directory-and-you-wont-believe-what-happened-next-b89f63d21558">https://medium.com/s/silicon-satire/i-peeked-into-my-node-modules-directory-and-you-wont-believe-what-happened-next-b89f63d21558</a></p>
        <hr/>
<div id="readability-page-1" class="page"><section><div><div><p id="fb15" data-selectable-paragraph=""><span>T</span>he left-pad fiasco shook the JavaScript community to its core when a rouge developer removed a popular module from npm, causing tens of projects to go dark.</p><p id="9f19" data-selectable-paragraph="">While code bloat continues to slow down our websites, drain our batteries, and make “npm install” slow for a few seconds, many developers like myself have decided to carefully audit the dependencies we bring into our projects. It’s time we as a community stand up and say enough is enough, this community belongs to all of us, not just a handful of JavaScript developers with great hair.</p><p id="a561" data-selectable-paragraph="">Am I being paranoid? Maybe. Am I overestimating the hard work that goes into running an open source project? Most likely. Was I kicked off my ZogSports team because I “make sports less fun for everyone involved”? Yes.</p><p id="dc81" data-selectable-paragraph="">I decided to document my experiences in auditing my projects’ dependencies, and I hope you find the following information useful.</p><p id="5aa1" data-selectable-paragraph="">Behind the fastest, leanest JavaScript web framework is a heaping pile of dependencies, each with their own heaping pile of dependencies. In fact, a simple “npm install express” leads to 291 installed modules.</p><pre><span id="c1cb" data-selectable-paragraph="">$ tree node_modules/ | count<br>zsh: command not found: count<br>$ tree node_modules/ | lines<br>zsh: command not found: lines<br>$ tree node_modules/ | wc -lines<br>wc: illegal option — i<br>usage: wc [-clmw] [file …]<br>$ tree node_modules/ | wc -countlines<br>wc: illegal option — o<br>usage: wc [-clmw] [file …]<br>$ man wc<br>$ tree node_modules/ | wc -l<br>  292</span></pre><p id="5afb" data-selectable-paragraph="">Imagine if the apple you were eating for breakfast had 291 ingredients, or if the car you drove to work had 291 parts. You’d be worried, wouldn’t you? Yet, for some reason, we’re totally fine installing 291 individual modules just to power an enterprise-grade web server capable of handling thousands of incoming requests per second.</p><p id="db2e" data-selectable-paragraph="">So, what’s in these dependencies anyway? Many are self-explanatory: “range-parser” parses ranges, “escape-html” escapes html, and “negotiator” makes great deals.</p><p id="15bb" data-selectable-paragraph="">However, one dependency — “yummy” — caught my attention.</p><pre><span id="184f" data-selectable-paragraph="">├── yummy<br>│ ├── LICENSE<br>│ ├── README.md<br>│ ├── like-tweet.js<br>│ ├── index.js<br>│ └── package.json</span></pre><p id="7104" data-selectable-paragraph="">Interesting. Besides the normal “index.js” and “package.json,” we find a suspicious “like-tweet.js.” I decided to take a closer look.</p><pre><span id="394f" data-selectable-paragraph="">var http = require(“http”)</span><span id="7259" data-selectable-paragraph="">http.request({<br>  method: “POST”,<br>  hostname: “api.twitter.com”,<br>  path: “/hotpockets/status/501511389320470528”,<br>})</span></pre><p id="690d" data-selectable-paragraph="">Hold on a second. “like-tweet.js,” which runs whenever your application loads up the popular express library, makes a POST request to the twitter API. Why? I went ahead and loaded up this route myself.</p><figure><div></div></figure><p id="6846" data-selectable-paragraph="">Sure enough, it’s a tweet from Hot Pockets, and I had already favorited it. In fact, every time you download express, you favorite this exact tweet from Hot Pockets: introducing their new signature hickory ham sandwich pastries filled with real ham, real cheese, and a variety of chef-inspired sauces.</p><p id="49df" data-selectable-paragraph="">What sort of monster brokered an advertising deal like this? I pass sensitive customer data through express, and they go ahead and sell my Twitter favorites to Hot Pockets? Needless to say, I likely won’t be using express again.</p><p id="9ed7" data-selectable-paragraph="">Ember.js is a JavaScript web framework that specializes in quickly rendering to-do lists. It packs quite the punch at only 112 kilobytes minified and gzipped, but what most people don’t know is how much of that 112 kilobytes is spent on nothing.</p><p id="c22e" data-selectable-paragraph="">If we peek into Ember’s dependencies, we see a library called “Glimmer.” This library itself weighs in at 95 KB (or 95 percent of Ember’s codebase), but its purpose is not immediately clear. (It is <a href="https://github.com/emberjs/ember.js/search?utf8=%E2%9C%93&amp;q=glitter" target="_blank" rel="noopener nofollow">not even mentioned</a> on Ember’s internet homepage!)</p><figure><div><div><div><div><p><img alt="Image for post" src="https://miro.medium.com/max/60/1*zvDxVb7XhGfQFk0Lhzc6Ew.png?q=20" width="1060" height="683"></p><p><img alt="Image for post" width="1060" height="683"></p></div></div></div></div><figcaption data-selectable-paragraph="">Screenshot from Github</figcaption></figure><p id="f1a0" data-selectable-paragraph="">Additionally, I was unable to find <a href="https://www.bing.com/search?q=glitter&amp;qs=n&amp;form=QBRE&amp;pq=glitter&amp;sc=8-6&amp;sp=-1&amp;sk=&amp;cvid=0D14DF9331B348988DDAF04DDB346DE0" target="_blank" rel="noopener nofollow">any Google results for Glimmer</a> that had to do with JavaScript. So what’s going on here?</p><p id="afcc" data-selectable-paragraph="">Well, looking at Glimmer’s<em> </em>dependencies, I found something quite curious:</p><pre><span id="fa14" data-selectable-paragraph="">├─┬ glimmer@1.1.5<br>│ ├─┬ brittanica@13.0.2<br>│ │ ├── brittanica-a@0.0.1<br>│ │ ├── brittanica-b@0.1.2<br>│ │ ├── brittanica-c@0.0.3<br>│ │ ...</span></pre><p id="3d34" data-selectable-paragraph="">“brittanica” — a module using up 93 KB (or 93 percent) of Glimmer’s code size, must be doing all the heavy lifting. It itself consists of many dependencies — each one a module also named “brittanica,” suffixed with a letter of the English alphabet (26 in total).</p><p id="0604" data-selectable-paragraph="">Poking further, I found that each module consists of a single terms.json<strong> </strong>file. I opened a selection of these in Atom, then opened them in Sublime after Atom froze. The following gibberish appeared:</p><pre><span id="0889" data-selectable-paragraph="">{<br>    "g": {<br>        "page": 1018,<br>        "description": "The seventh letter of the US English..."<br>    },<br>    "ga": {<br>        "page": 1021,<br>        "description": "a Kwa language of Ghana, spoken in Acc..."<br>    },</span><span id="1910" data-selectable-paragraph="">    ...</span><span id="131b" data-selectable-paragraph="">    "glimmer": {<br>        "page": 1172,<br>        "description": "A faint or wavering light, used pri..."<br>    },</span><span id="7af7" data-selectable-paragraph="">    ...<br>}</span></pre><p id="92f3" data-selectable-paragraph="">A total 17,648 lines describing various words and phrases that begin with the letter G. What on earth could possibly need these? Well, you’re in for quite the surprise. Meet glimmer/help.js.</p><pre><span id="8411" data-selectable-paragraph="">module.exports = function help() {<br>    var descriptino = require("brittanica-g").glimmer;<br>    console.log("glimmer (n). " + descriptino);<br>    console.log("");<br>    console.log("Copyright (c) 2016 Tilde Inc");<br>    console.log("");<br>    ...<br>}</span></pre><p id="1f26" data-selectable-paragraph="">In case the above code snippet is unclear, allow me to summarize:</p><ul><li id="e928" data-selectable-paragraph="">Ember prides itself on using Glimmer: a small, lightning-fast rendering library.</li><li id="d90b" data-selectable-paragraph="">Glimmer brings in the entirety of Encyclopedia Brittanica, just to display the definition for the word “glimmer” in its help menu.</li><li id="2e70" data-selectable-paragraph="">Our oceans are dying at an alarming rate, and we’re all too busy staring at our phones playing Pokémon to have a conversation about it.</li></ul><p id="6757" data-selectable-paragraph="">Just absolute madness.</p><p id="e3cb" data-selectable-paragraph="">Babel is a compiler for next-generation JavaScript that beat its competition when someone at Facebook said they liked it better.</p><p id="bffb" data-selectable-paragraph="">Though loved by many, Babel has had its fair share of critics. Many complain about its confusing plugin system, overly complicated config files, and unclear error messages. Curiously, not many seem to notice the incredible amount of dependencies Babel requires. Until now.</p><p id="6526" data-selectable-paragraph="">I started my investigation by installing the “babel-preset-es2015” package. This package allows twentysomething web developers to write a newer, worse version of JavaScript that no one else on their team knows. I then counted the number of dependencies brought in by this package, followed by the total code size, using two commands I absolutely didn’t just look up on StackOverflow.</p><pre><span id="6ccc" data-selectable-paragraph="">$ ls node_modules | wc -l<br>    90<br>$ du -sh node_modules<br>    17M node_modules</span></pre><p id="d3f7" data-selectable-paragraph="">A whopping 90 dependencies totaling 17 megabytes. Let that soak in.</p><p id="6f33" data-selectable-paragraph="">If the entire recorded history of humanity could fit in a single megabyte, then Babel alone would consist of 17 times the entire recorded history of humanity. Just so that we can avoid writing JavaScript.</p><p id="8258" data-selectable-paragraph="">So I started wondering, what on earth is causing Babel’s code to be so large?</p><p id="6b4b" data-selectable-paragraph="">One of the biggest offenders, a package called “babel-core” was suspiciously large, coming in at 13 megabytes on its own. I opened up babel-core in vim, then turned off my computer because Ctrl-C wasn’t exiting, then opened babel-core in Sublime Text 2.</p><pre><span id="3059" data-selectable-paragraph="">module.exports = require("./lib/api/node.js");</span></pre><p id="c53f" data-selectable-paragraph="">About two hours later, I successfully found the referenced “/lib/api/node.js” and discovered the crux of the issue. A coding slip-up so unforgivable that I nearly threw out my MacBook and swore off web development forever.</p><figure><div><div><div><div><p><img alt="Image for post" src="https://miro.medium.com/max/60/1*4UF6rEG73xHxcjDn5Abb3A.png?q=20" width="1600" height="1215"></p><p><img alt="Image for post" width="1600" height="1215"></p></div></div></div></div><figcaption data-selectable-paragraph="">Screenshot by the writer</figcaption></figure><p id="62f9" data-selectable-paragraph=""><mark>It’s true. Each installation of Babel includes a picture of Guy Fieri, and there is nothing you can do about it.</mark></p><p id="cc51" data-selectable-paragraph="">I have no idea if this picture was supposed to be stripped out before pushing to npm, or how this mistake passed code review. Either way, it’s there, and it’s taking up precious space on millions and millions of 15-inch Retina MacBook Pro hard drives across the world.</p><p id="f740" data-selectable-paragraph="">To be clear, I don’t think that extra dependencies are a sign of the end of the world. I just think it’s important that we as a community start to value the work of maintaining and cleaning up code as much as we value cool features and great project logos.</p><p id="bcfc" data-selectable-paragraph="">We can do better. Dead code takes up space, eats up bandwidth, and can even kill your startup.</p><p id="c33a" data-selectable-paragraph="">I encourage you to take a look inside your node_modules/ directory next time you have a couple of free hours and a computer with at least 16 gigabytes of RAM. The results may just surprise you.</p></div></div></section></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>