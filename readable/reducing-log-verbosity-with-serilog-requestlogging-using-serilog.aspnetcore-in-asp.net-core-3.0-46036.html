<!DOCTYPE html>
<html lang="en">
<head>
    <title>linksfor.dev(s)</title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <div class="readable">
        <h1>Reducing log verbosity with Serilog RequestLogging: Using Serilog.AspNetCore in ASP.NET Core 3.0 - Part 1</h1>
        <p>
Reading time: 13-17 minutes        </p>
        <p><a href="https://andrewlock.net/using-serilog-aspnetcore-in-asp-net-core-3-reducing-log-verbosity/">https://andrewlock.net/using-serilog-aspnetcore-in-asp-net-core-3-reducing-log-verbosity/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
<p>One of the great aspects of ASP.NET Core is that logging is built-in to the framework. That means you can (if you want to) get access to all the deep infrastructural logs from your own standard logging infrastructure. The down side to this is that sometimes you can get <em>too many</em> logs. </p>
<p>In this short series I describe how to use <a href="https://github.com/serilog/serilog-aspnetcore#request-logging">Serilog's ASP.NET Core request logging feature</a>. In this first post I describe how to add the the Serilog <code>RequestLoggingMiddleware</code> to your application, and the benefits it provides. In subsequent posts I'll describe how to customise the behaviour further.</p>
<blockquote>
<p>I've had these posts in draft for a while. Since then, <a href="https://nblumhardt.com/2019/10/serilog-in-aspnetcore-3">Nicholas Blumhardt, creator of Serilog, has written a comprehensive blog post on using Serilog with ASP.NET Core 3.0</a>. It's a very detailed (and opinionated) piece, that I strongly recommend reading. You'll find most of what I talk about in this series in his post, so check it out!</p>
</blockquote>
<h2 id="request-logging-without-serilog">Request logging without Serilog<a href="#request-logging-without-serilog"></a></h2>
<p>For this post we'll start with a basic ASP.NET Core 3.0 Razor pages app, created using <code>dotnet new webapp</code>. This creates a standard <em>Program.cs</em> that look like this:</p>
<pre><code><span>public</span> <span>class</span> <span>Program</span>
<span>{</span>
    <span>public</span> <span>static</span> <span>void</span> <span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span> args<span>)</span>
    <span>{</span>
        <span>CreateHostBuilder</span><span>(</span>args<span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>static</span> <span>IHostBuilder</span> <span>CreateHostBuilder</span><span>(</span><span>string</span><span>[</span><span>]</span> args<span>)</span> <span>=</span><span>&gt;</span>
        Host<span>.</span><span>CreateDefaultBuilder</span><span>(</span>args<span>)</span>
            <span>.</span><span>ConfigureWebHostDefaults</span><span>(</span>webBuilder <span>=</span><span>&gt;</span>
            <span>{</span>
                webBuilder<span>.</span><span><span>UseStartup</span><span>&lt;</span><span>Startup</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
            <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre>
<p>And a <em>Startup.cs</em> that configures the middleware pipeline in <code>Configure</code> as the following:</p>
<pre><code><span>public</span> <span>void</span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
<span>{</span>
    <span>if</span> <span>(</span>env<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    <span>else</span>
    <span>{</span>
        app<span>.</span><span>UseExceptionHandler</span><span>(</span><span>"/Error"</span><span>)</span><span>;</span>
        app<span>.</span><span>UseHsts</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    app<span>.</span><span>UseHttpsRedirection</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseStaticFiles</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=</span><span>&gt;</span>
    <span>{</span>
        endpoints<span>.</span><span>MapRazorPages</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre>
<p>If you run the application and navigate to the home page, by default you'll see a number of logs in the Console for each request. The logs below are generated for a <em>single</em> request to the home page (there are additional requests for CSS and JS files after this that I've not included):</p>
<pre><code>info: Microsoft.AspNetCore.Hosting.Diagnostics<span>[</span>1<span>]</span>
      Request starting HTTP/2 GET https://localhost:5001/
info: Microsoft.AspNetCore.Routing.EndpointMiddleware<span>[</span>0<span>]</span>
      Executing endpoint <span>'/Index'</span>
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>3<span>]</span>
      Route matched with <span>{</span>page <span>=</span> <span>"/Index"</span><span>}</span>. Executing page /Index
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>101<span>]</span>
      Executing handler method SerilogRequestLogging.Pages.IndexModel.OnGet - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>102<span>]</span>
      Executed handler method OnGet, returned result <span>.</span>
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>103<span>]</span>
      Executing an implicit handler method - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>104<span>]</span>
      Executed an implicit handler method, returned result Microsoft.AspNetCore.Mvc.RazorPages.PageResult.
info: Microsoft.AspNetCore.Mvc.RazorPages.Infrastructure.PageActionInvoker<span>[</span>4<span>]</span>
      Executed page /Index <span>in</span> 221.07510000000002ms
info: Microsoft.AspNetCore.Routing.EndpointMiddleware<span>[</span>1<span>]</span>
      Executed endpoint <span>'/Index'</span>
info: Microsoft.AspNetCore.Hosting.Diagnostics<span>[</span>2<span>]</span>
      Request finished <span>in</span> 430.9383ms 200 text/html<span>;</span> charset<span>=</span>utf-8
</code></pre>
<p>That's <strong>10</strong> logs for a single request. Now, to be clear, this was running in the <code>Development</code> environment, which by default logs everything in the <em>Microsoft</em> namespace of level "Information" or above. If we switch to the <code>Production</code> environment, the default template filters the logs to "Warning" for the <em>Microsoft</em> namespace. Navigating to the default home page now generates the following logs:</p>
<pre><code>
</code></pre>
<p>That's right, no logs at all! All of the logs generated in the previous run are in the <em>Microsoft</em> namespaces, and are "Information" level, so they're <em>all</em> filtered out. Personally I feel like that's a bit heavy handed. It would be nice if the production version logged <em>something</em>, for correlation with other logs if nothing else. </p>
<p>One possible solution is to customise the filters applied to each namespace. For example, you could limit the <em>Microsoft.AspNetCore.Mvc.RazorPages</em> namespace to "Warning", while leaving the more general <em>Microsoft</em> namespace as "Information". Now you get a reduced set of logs:</p>
<pre><code>info: Microsoft.AspNetCore.Hosting.Diagnostics<span>[</span>1<span>]</span>
      Request starting HTTP/2 GET https://localhost:5001/
info: Microsoft.AspNetCore.Routing.EndpointMiddleware<span>[</span>0<span>]</span>
      Executing endpoint <span>'/Index'</span>
info: Microsoft.AspNetCore.Routing.EndpointMiddleware<span>[</span>1<span>]</span>
      Executed endpoint <span>'/Index'</span>
info: Microsoft.AspNetCore.Hosting.Diagnostics<span>[</span>2<span>]</span>
      Request finished <span>in</span> 184.788ms 200 text/html<span>;</span> charset<span>=</span>utf-8
</code></pre>
<p>These logs have some useful information in them - the URL, HTTP method, timing information, endpoint etc. - and there's not <em>too</em> much redundancy. But it's still slightly annoying they're four separate log messages. </p>
<p>This is the issue Serilog's <code>RequestLoggingMiddleware</code> aims to deal with - instead of creating separate logs for each step in the request, create a single "Summary" log message containing all the pertinent information.</p>
<h2 id="adding-serilog-to-the-application">Adding Serilog to the application<a href="#adding-serilog-to-the-application"></a></h2>
<p>The one dependency for using Serilog's <code>RequestLoggingMiddleware</code> is that you're using Serilog! In this section I'll describe the basics for adding Serilog to your ASP.NET Core app. If you already have Serilog installed, skip to the next section.</p>
<p>I described <a href="https://andrewlock.net/adding-serilog-to-the-asp-net-core-generic-host/">how to add Serilog to a generic host application over a year ago</a>, and with ASP.NET Core now <a href="https://andrewlock.net/ihostingenvironment-vs-ihost-environment-obsolete-types-in-net-core-3/#asp-net-core-merges-with-the-generic-host">re-platformed on top of the generic host infrastructure</a> the setup for ASP.NET Core 3.0 is <em>very</em> similar. The approach described in this post follows the suggestions + advice of the <a href="https://github.com/serilog/serilog-aspnetcore">Serilog.AspNetCore GitHub repository</a> (and the advice from <a href="https://nblumhardt.com/2019/10/serilog-in-aspnetcore-3">Nicholas Blumhardt's post too</a>).</p>
<p>Start by installing the <em>Serilog.AspNetCore</em> NuGet package, plus the Console and <a href="https://datalust.co/seq">Seq</a> Sinks, so that we can view the logs. You can do this from the command line by running:</p>
<pre><code>dotnet add package Serilog.AspNetCore
dotnet add package Serilog.Sinks.Console
dotnet add package Serilog.Sinks.Seq
</code></pre>
<p>Now it's time to replace the default logging with Serilog. There's a number of ways you can do this, but the suggested approach is to configure your logger in <code>Program.Main</code> <em>before you do anything else</em>. This goes against the approach used by ASP.NET Core in general, but is the approach suggested for Serilog. The result is that your <em>Program.cs</em> file becomes rather longer:</p>
<pre><code>
<span>using</span> Serilog<span>;</span>
<span>using</span> Serilog<span>.</span>Events<span>;</span>

<span>public</span> <span>class</span> <span>Program</span>
<span>{</span>
    <span>public</span> <span>static</span> <span>int</span> <span>Main</span><span>(</span><span>string</span><span>[</span><span>]</span> args<span>)</span>
    <span>{</span>
        
        Log<span>.</span>Logger <span>=</span> <span>new</span> <span>LoggerConfiguration</span><span>(</span><span>)</span>
            <span>.</span>MinimumLevel<span>.</span><span>Debug</span><span>(</span><span>)</span>
            <span>.</span>MinimumLevel<span>.</span><span>Override</span><span>(</span><span>"Microsoft"</span><span>,</span> LogEventLevel<span>.</span>Information<span>)</span>
            <span>.</span>Enrich<span>.</span><span>FromLogContext</span><span>(</span><span>)</span>
            <span>.</span>WriteTo<span>.</span><span>Console</span><span>(</span><span>)</span>
            <span>.</span>WriteTo<span>.</span><span>Seq</span><span>(</span><span>"http://localhost:5341"</span><span>)</span>
            <span>.</span><span>CreateLogger</span><span>(</span><span>)</span><span>;</span>

        
        <span>try</span>
        <span>{</span>
            Log<span>.</span><span>Information</span><span>(</span><span>"Starting host"</span><span>)</span><span>;</span>
            <span>CreateHostBuilder</span><span>(</span>args<span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span>
            <span>return</span> <span>0</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>Exception</span> ex<span>)</span>
        <span>{</span>
            Log<span>.</span><span>Fatal</span><span>(</span>ex<span>,</span> <span>"Host terminated unexpectedly"</span><span>)</span><span>;</span>
            <span>return</span> <span>1</span><span>;</span>
        <span>}</span>
        <span>finally</span>
        <span>{</span>
            Log<span>.</span><span>CloseAndFlush</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>

    <span>public</span> <span>static</span> <span>IHostBuilder</span> <span>CreateHostBuilder</span><span>(</span><span>string</span><span>[</span><span>]</span> args<span>)</span> <span>=</span><span>&gt;</span>
        Host<span>.</span><span>CreateDefaultBuilder</span><span>(</span>args<span>)</span>
            <span>.</span><span>UseSerilog</span><span>(</span><span>)</span> 
            <span>.</span><span>ConfigureWebHostDefaults</span><span>(</span>webBuilder <span>=</span><span>&gt;</span>
            <span>{</span>
                webBuilder<span>.</span><span><span>UseStartup</span><span>&lt;</span><span>Startup</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
            <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre>
<p>While more complex, this setup ensures that you will still get logs if your <em>appsettings.json</em> file is formatted incorrectly, or configuration files are missing, for example. If you run your application now you'll see the same 10 logs we did originally, just formatted slightly differently:</p>
<pre><code><span>[</span>13:30:27 INF<span>]</span> Request starting HTTP/2 GET https://localhost:5001/  
<span>[</span>13:30:27 INF<span>]</span> Executing endpoint <span>'/Index'</span>
<span>[</span>13:30:27 INF<span>]</span> Route matched with <span>{</span>page <span>=</span> <span>"/Index"</span><span>}</span>. Executing page /Index
<span>[</span>13:30:27 INF<span>]</span> Executing handler method SerilogRequestLogging.Pages.IndexModel.OnGet - ModelState is Valid
<span>[</span>13:30:27 INF<span>]</span> Executed handler method OnGet, returned result <span>.</span>
<span>[</span>13:30:27 INF<span>]</span> Executing an implicit handler method - ModelState is Valid
<span>[</span>13:30:27 INF<span>]</span> Executed an implicit handler method, returned result Microsoft.AspNetCore.Mvc.RazorPages.PageResult.
<span>[</span>13:30:27 INF<span>]</span> Executed page /Index <span>in</span> 168.28470000000002ms
<span>[</span>13:30:27 INF<span>]</span> Executed endpoint <span>'/Index'</span>
<span>[</span>13:30:27 INF<span>]</span> Request finished <span>in</span> 297.0663ms 200 text/html<span>;</span> charset<span>=</span>utf-8
</code></pre>
<p>We seem to have taken 2 steps forward and one step back here. Our logging configuration is more robust now by configuring it earlier in the application lifecycle, but we haven't actually solved the problem we set out to yet. To do that we'll add the <code>RequestLoggingMiddleware</code>.</p>
<h2 id="switching-to-serilog-s-requestloggingmiddleware">Switching to Serilog's <code>RequestLoggingMiddleware</code><a href="#switching-to-serilog-s-requestloggingmiddleware"></a></h2>
<p>The <code>RequestLoggingMiddleware</code> is included in the <em>Serilog.AspNetCore</em> package and can be used to add a single "summary" log message for each request. If you've already gone through the steps in the previous section, adding the middleware is simple. In your <code>Startup</code> class, call <code>UseSerilogRequestLogging()</code> at the point where you would like to record the logs:</p>
<pre><code>
<span>using</span> Serilog<span>;</span>

<span>public</span> <span>void</span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
<span>{</span>
    
    app<span>.</span><span>UseStaticFiles</span><span>(</span><span>)</span><span>;</span>

    app<span>.</span><span>UseSerilogRequestLogging</span><span>(</span><span>)</span><span>;</span> 

    app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=</span><span>&gt;</span>
    <span>{</span>
        endpoints<span>.</span><span>MapRazorPages</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>
</code></pre>
<p>As always with the ASP.NET Core middleware pipeline, <strong>order is important</strong>. When a request reaches the <code>RequestLoggingMiddleware</code> the middleware starts a timer, and passes the request on for handling by subsequent middleware. When a later middleware eventually generates a response (or throws an exception), the response passes <em>back</em> through the middleware pipeline to the request logger, which records the result and writes a summary log message. </p>
<p>Serilog can only log requests that reach the middleware. In the example above, I've added the <code>RequestLoggingMiddleware</code> <em>after</em> the <code>StaticFilesMiddleware</code>. Requests that are handled by <code>UseStaticFiles</code> will short-circuit the pipeline, and won't be logged. Given the static files middleware is quite noisy that will often be the desired behaviour, but if you wish to log requests for static files too, you can move the serilog middleware earlier in the pipeline.</p>
<p>If we run the application one more time, you'll still see the original 10 log messages, but you'll see an <em>additional</em> log message from the Serilog <code>RequestLoggingMiddleware</code>, the penultimate message:</p>
<pre><code>
<span>[</span>14:15:44 INF<span>]</span> Request starting HTTP/2 GET https://localhost:5001/  
<span>[</span>14:15:44 INF<span>]</span> Executing endpoint <span>'/Index'</span>
<span>[</span>14:15:45 INF<span>]</span> Route matched with <span>{</span>page <span>=</span> <span>"/Index"</span><span>}</span>. Executing page /Index
<span>[</span>14:15:45 INF<span>]</span> Executing handler method SerilogRequestLogging.Pages.IndexModel.OnGet - ModelState is Valid
<span>[</span>14:15:45 INF<span>]</span> Executed handler method OnGet, returned result <span>.</span>
<span>[</span>14:15:45 INF<span>]</span> Executing an implicit handler method - ModelState is Valid
<span>[</span>14:15:45 INF<span>]</span> Executed an implicit handler method, returned result Microsoft.AspNetCore.Mvc.RazorPages.PageResult.
<span>[</span>14:15:45 INF<span>]</span> Executed page /Index <span>in</span> 124.7462ms
<span>[</span>14:15:45 INF<span>]</span> Executed endpoint <span>'/Index'</span>


<span>[</span>14:15:45 INF<span>]</span> HTTP GET / responded 200 <span>in</span> 249.6985 ms


<span>[</span>14:15:45 INF<span>]</span> Request finished <span>in</span> 274.283ms 200 text/html<span>;</span> charset<span>=</span>utf-8
</code></pre>
<p>There's a couple of things to note about this log:</p>
<ul>
<li>It includes most of the pertinent information you'd want in a single message - HTTP method, URL Path, Status Code, duration.</li>
<li>The duration shown is <em>slightly</em> shorter than the value logged by Kestrel on the subsequent message. That's to be expected, as Serilog only starts timing when the request reaches its middleware, and stops timing when it returns (after generating a response).</li>
<li>In both cases, additional values are logged when you use structural logging. For example, the RequestId and SpanId (<a href="https://devblogs.microsoft.com/aspnet/improvements-in-net-core-3-0-for-troubleshooting-and-monitoring-distributed-apps/">used for tracing capabilities</a>) are logged as they are part of the logging scope. You can see this in the following image of the request logged to seq.</li>
<li>We do lose some information by default. For example, the endpoint name and Razor page handler are no longer logged. In subsequent posts I'll show how to add these to the summary log.</li>
</ul>
<p><img src="https://andrewlock.net/content/images/2019/seq_request_logging.png" alt="RequestLoggingMiddleware logs to Seq showing structured logging includes additional properties"></p>
<p>All that remains to finish tidying things up is to filter out the Information-level log messages we're currently logging. Update your Serilog configuration in <em>Program.cs</em> to add the extra filter:</p>
<pre><code>Log<span>.</span>Logger <span>=</span> <span>new</span> <span>LoggerConfiguration</span><span>(</span><span>)</span>
    <span>.</span>MinimumLevel<span>.</span><span>Debug</span><span>(</span><span>)</span>
    <span>.</span>MinimumLevel<span>.</span><span>Override</span><span>(</span><span>"Microsoft"</span><span>,</span> LogEventLevel<span>.</span>Information<span>)</span>
    
    <span>.</span>MinimumLevel<span>.</span><span>Override</span><span>(</span><span>"Microsoft.AspNetCore"</span><span>,</span> LogEventLevel<span>.</span>Warning<span>)</span> 
    <span>.</span>Enrich<span>.</span><span>FromLogContext</span><span>(</span><span>)</span>
    <span>.</span>WriteTo<span>.</span><span>Console</span><span>(</span><span>)</span>
    <span>.</span>WriteTo<span>.</span><span>Seq</span><span>(</span><span>"http://localhost:5341"</span><span>)</span>
    <span>.</span><span>CreateLogger</span><span>(</span><span>)</span><span>;</span>
</code></pre>
<p>With this final change, you'll now get a clean set of request logs containing summary data for each request:</p>
<pre><code><span>[</span>14:29:53 INF<span>]</span> HTTP GET / responded 200 <span>in</span> 129.9509 ms
<span>[</span>14:29:56 INF<span>]</span> HTTP GET /Privacy responded 200 <span>in</span> 10.0724 ms
<span>[</span>14:29:57 INF<span>]</span> HTTP GET / responded 200 <span>in</span> 3.3341 ms
<span>[</span>14:30:54 INF<span>]</span> HTTP GET /Missing responded 404 <span>in</span> 16.7119 ms
</code></pre>
<p>In the next post I'll look at how we can enhance this log by recording additional data.</p>
<h2 id="summary">Summary<a href="#summary"></a></h2>
<p>In this post I described how you can use <em>Serilog.AspNetCore</em>'s request logging middleware to reduce the number of logs generated for each ASP.NET Core request, while still recording summary data. If you're already using Serilog, this is very easy to enable. Simply call <code>UseSerilogRequestLogging()</code> in your <em>Startup.cs</em> file. </p>
<p>When a request reaches this middleware it will start a timer. When subsequent middleware generates a response (or throws an exception) the response passes back through the request logger, which records the result and writes a summary log message. </p>
<p>After adding the request logging middleware you can filter out more of the infrastructural logs generated by default in ASP.NET Core 3.0, without losing useful information.</p>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>

</body>
</html>