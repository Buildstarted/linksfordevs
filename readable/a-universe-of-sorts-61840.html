<!DOCTYPE html>
<html lang="en">
<head>
    <title>
A Universe of Sorts - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="A Universe of Sorts - linksfor.dev(s)"/>
    <meta property="og:description" content="I show off &#xA;minanim.js&#xA;,&#xA;a tiny, 100LoC, yet feature-complete library for building animations declaratively,&#xA;and why someone would want to do things this way. Enjoy!"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://bollu.github.io/mathemagic/declarative/index.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - A Universe of Sorts</title>
<div class="readable">
        <h1>A Universe of Sorts</h1>
            <div>Reading time: 17-22 minutes</div>
        <div>Posted here: 19 May 2020</div>
        <p><a href="https://bollu.github.io/mathemagic/declarative/index.html">https://bollu.github.io/mathemagic/declarative/index.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><h2><a id="the-unreasonable-effectiveness-of-declarative-programming" href="#the-unreasonable-effectiveness-of-declarative-programming"> § </a> The Unreasonable Effectiveness Of Declarative Programming</h2>
<h3><a id="declarative-animations" href="#declarative-animations"> § </a> Declarative animations</h3><p>
I show off <a href="https://github.com/bollu/mathemagic/blob/master/declarative/minanim.js">
<code>minanim.js</code></a>
,
a tiny, 100LoC, yet feature-complete library for building animations <i>declaratively</i>,
and why someone would want to do things this way. Enjoy!
</p><h3><a id="a-complex-animation" href="#a-complex-animation"> § </a> A complex animation</h3>
<p>
The blue circle's animation is quite complex. It consists of multiple
stages. (1) The circle grows in size. (2) It continues to grow in size
at a faster rate, as it shoots off to the right. (3) It pauses. (4) It
moves to the middle. (5) It pauses again. (6) It shrinks to nothing.
All of this is captured by a single object <code>anim_circle</code> (written using <code>minanim.js</code>)
which <i>declares</i> what the animation is doing:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// cx = location | cr = radius</span></i>
<span color="#000000">03:</span> let anim_circle = anim_const(<span color="#808080">"cx"</span>, <span color="#000000">100</span>)
<span color="#000000">04:</span>     .seq(anim_const(<span color="#808080">"cr"</span>, <span color="#000000">0</span>))
<span color="#000000">05:</span>     <i><span color="#222222">// (1) grow in size.</span></i>
<span color="#000000">06:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <i><span color="#222222">/*val=*/</span></i><span color="#000000">10</span>, <i><span color="#222222">/*time=*/</span></i><span color="#000000">3</span>))
<span color="#000000">07:</span>     <i><span color="#222222">// (2) go to right while growing.</span></i>
<span color="#000000">08:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cx"</span>, <i><span color="#222222">/*val=*/</span></i><span color="#000000">300</span>, <i><span color="#222222">/*time=*/</span></i><span color="#000000">1</span>)
<span color="#000000">09:</span>         .par(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <span color="#000000">70</span>, <span color="#000000">1</span>)))
<span color="#000000">10:</span>     <i><span color="#222222">// (3) pause.</span></i>
<span color="#000000">11:</span>     .seq(anim_delay(<i><span color="#222222">/*time=*/</span></i><span color="#000000">3</span>))
<span color="#000000">12:</span>     <i><span color="#222222">// (4) come back to the left.</span></i>
<span color="#000000">13:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cx"</span>, <span color="#000000">100</span>, <span color="#000000">1</span>))
<span color="#000000">14:</span>     <i><span color="#222222">// (5) pause again.</span></i>
<span color="#000000">15:</span>     .seq(anim_delay(<i><span color="#222222">/*time=*/</span></i><span color="#000000">2</span>))
<span color="#000000">16:</span>     <i><span color="#222222">// (6) shrink to nothing.</span></i>
<span color="#000000">17:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <span color="#000000">0</span>, <span color="#000000">1</span>));
<span color="#000000">18:</span> </tt></pre>
</div><p>

The entire animation is built out of one primitive and three combinators:
</p><ol>
<li>
 <code>anim_const(name, val)</code> to set a constant value <code>val</code> to name <code>name</code>.
</li>
<li>
 <code>anim_interpolated(ease, name, val, time)</code> to change to a named value with name <code>name</code>
   to value <code>val</code> in duration <code>time</code>. 
</li>
<li>
 <code>anim1.seq(anim2)</code> to run <code>anim2</code> once <code>anim1</code> has completed.
</li>
<li>
 <code>anim1.par(anim2)</code> to run <code>anim2</code> in parallel with <code>anim1</code>.
</li>
<li>
 <code>anim_delay(time)</code> to do nothing for time <code>time</code>.
</li>

</ol>

<h3><a id="reallyle" href="#reallyle"> § </a> What is <code>anim_circle</code>, really?</h3>
<p><code>anim_circle</code> is a <i>function</i>, which can be invoked as <code>val = anim_circle(t)</code>.
It returns an object <code>val</code>.  <code>val.cx</code> and <code>val.cr</code> have values as the animation dictates.
<b>That's it</b>. It <b>does not modify the DOM</b>. It <b>does not edit the</b> <code>circle</code> tag.
Given a time <code>t0</code>, it computes <code>cx</code> and <code>cr</code> at time <code>t0</code>. Keep it simple, stupid!
</p><p id="plot"><svg width="500px" height="300px" viewBox="0 0 500 300" font-family="monospace"><text x="0" y="30" fill="#1a73e8">cx</text><line style="stroke:#1a73e8;stroke-width:2" x1="0" x2="5" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="5" x2="10" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="10" x2="15" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="15" x2="20" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="20" x2="25" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="25" x2="30" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="30" x2="35" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="35" x2="40" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="40" x2="45" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="45" x2="50" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="50" x2="55" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="55" x2="60" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="60" x2="65" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="65" x2="70" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="70" x2="75" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="75" x2="80" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="80" x2="85" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="85" x2="90" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="90" x2="95" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="95" x2="100" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="100" x2="105" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="105" x2="110" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="110" x2="115" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="115" x2="120" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="120" x2="125" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="125" x2="130" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="130" x2="135" y1="90" y2="90"></line><line style="stroke:#1a73e8;stroke-width:2" x1="135" x2="140" y1="90" y2="76.72128"></line><line style="stroke:#1a73e8;stroke-width:2" x1="140" x2="145" y1="76.72128" y2="61.886460000000014"></line><line style="stroke:#1a73e8;stroke-width:2" x1="145" x2="150" y1="61.886460000000014" y2="50.58000000000001"></line><line style="stroke:#1a73e8;stroke-width:2" x1="150" x2="155" y1="50.58000000000001" y2="42.32273999999999"></line><line style="stroke:#1a73e8;stroke-width:2" x1="155" x2="160" y1="42.32273999999999" y2="36.63551999999999"></line><line style="stroke:#1a73e8;stroke-width:2" x1="160" x2="165" y1="36.63551999999999" y2="33.03917999999999"></line><line style="stroke:#1a73e8;stroke-width:2" x1="165" x2="170" y1="33.03917999999999" y2="31.054559999999988"></line><line style="stroke:#1a73e8;stroke-width:2" x1="170" x2="175" y1="31.054559999999988" y2="30.202499999999993"></line><line style="stroke:#1a73e8;stroke-width:2" x1="175" x2="180" y1="30.202499999999993" y2="30.003839999999997"></line><line style="stroke:#1a73e8;stroke-width:2" x1="180" x2="185" y1="30.003839999999997" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="185" x2="190" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="190" x2="195" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="195" x2="200" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="200" x2="205" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="205" x2="210" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="210" x2="215" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="215" x2="220" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="220" x2="225" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="225" x2="230" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="230" x2="235" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="235" x2="240" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="240" x2="245" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="245" x2="250" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="250" x2="255" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="255" x2="260" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="260" x2="265" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="265" x2="270" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="270" x2="275" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="275" x2="280" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="280" x2="285" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="285" x2="290" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="290" x2="295" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="295" x2="300" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="300" x2="305" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="305" x2="310" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="310" x2="315" y1="30" y2="30"></line><line style="stroke:#1a73e8;stroke-width:2" x1="315" x2="320" y1="30" y2="32.766335999999995"></line><line style="stroke:#1a73e8;stroke-width:2" x1="320" x2="325" y1="32.766335999999995" y2="39.26100000000002"></line><line style="stroke:#1a73e8;stroke-width:2" x1="325" x2="330" y1="39.26100000000002" y2="44.27462400000002"></line><line style="stroke:#1a73e8;stroke-width:2" x1="330" x2="335" y1="44.27462400000002" y2="47.998872000000006"></line><line style="stroke:#1a73e8;stroke-width:2" x1="335" x2="340" y1="47.998872000000006" y2="50.625408"></line><line style="stroke:#1a73e8;stroke-width:2" x1="340" x2="345" y1="50.625408" y2="52.34589599999999"></line><line style="stroke:#1a73e8;stroke-width:2" x1="345" x2="350" y1="52.34589599999999" y2="53.35199999999999"></line><line style="stroke:#1a73e8;stroke-width:2" x1="350" x2="355" y1="53.35199999999999" y2="53.835384"></line><line style="stroke:#1a73e8;stroke-width:2" x1="355" x2="360" y1="53.835384" y2="53.987711999999995"></line><line style="stroke:#1a73e8;stroke-width:2" x1="360" x2="365" y1="53.987711999999995" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="365" x2="370" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="370" x2="375" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="375" x2="380" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="380" x2="385" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="385" x2="390" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="390" x2="395" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="395" x2="400" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="400" x2="405" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="405" x2="410" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="410" x2="415" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="415" x2="420" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="420" x2="425" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="425" x2="430" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="430" x2="435" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="435" x2="440" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="440" x2="445" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="445" x2="450" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="450" x2="455" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="455" x2="460" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="460" x2="465" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="465" x2="470" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="470" x2="475" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="475" x2="480" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="480" x2="485" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="485" x2="490" y1="54" y2="54"></line><line style="stroke:#1a73e8;stroke-width:2" x1="490" x2="495" y1="54" y2="54"></line><text x="0" y="180" fill="#e91e63">cr</text><line style="stroke:#e91e63;stroke-width:2" x1="0" x2="5" y1="270" y2="269.09129174603174"></line><line style="stroke:#e91e63;stroke-width:2" x1="5" x2="10" y1="269.09129174603174" y2="268.2491911111111"></line><line style="stroke:#e91e63;stroke-width:2" x1="10" x2="15" y1="268.2491911111111" y2="267.4711628571429"></line><line style="stroke:#e91e63;stroke-width:2" x1="15" x2="20" y1="267.4711628571429" y2="266.75467174603176"></line><line style="stroke:#e91e63;stroke-width:2" x1="20" x2="25" y1="266.75467174603176" y2="266.09718253968254"></line><line style="stroke:#e91e63;stroke-width:2" x1="25" x2="30" y1="266.09718253968254" y2="265.49616000000003"></line><line style="stroke:#e91e63;stroke-width:2" x1="30" x2="35" y1="265.49616000000003" y2="264.94906888888886"></line><line style="stroke:#e91e63;stroke-width:2" x1="35" x2="40" y1="264.94906888888886" y2="264.45337396825397"></line><line style="stroke:#e91e63;stroke-width:2" x1="40" x2="45" y1="264.45337396825397" y2="264.00654"></line><line style="stroke:#e91e63;stroke-width:2" x1="45" x2="50" y1="264.00654" y2="263.60603174603176"></line><line style="stroke:#e91e63;stroke-width:2" x1="50" x2="55" y1="263.60603174603176" y2="263.24931396825394"></line><line style="stroke:#e91e63;stroke-width:2" x1="55" x2="60" y1="263.24931396825394" y2="262.9338514285714"></line><line style="stroke:#e91e63;stroke-width:2" x1="60" x2="65" y1="262.9338514285714" y2="262.6571088888889"></line><line style="stroke:#e91e63;stroke-width:2" x1="65" x2="70" y1="262.6571088888889" y2="262.4165511111111"></line><line style="stroke:#e91e63;stroke-width:2" x1="70" x2="75" y1="262.4165511111111" y2="262.20964285714285"></line><line style="stroke:#e91e63;stroke-width:2" x1="75" x2="80" y1="262.20964285714285" y2="262.0338488888889"></line><line style="stroke:#e91e63;stroke-width:2" x1="80" x2="85" y1="262.0338488888889" y2="261.886633968254"></line><line style="stroke:#e91e63;stroke-width:2" x1="85" x2="90" y1="261.886633968254" y2="261.76546285714284"></line><line style="stroke:#e91e63;stroke-width:2" x1="90" x2="95" y1="261.76546285714284" y2="261.6678003174603"></line><line style="stroke:#e91e63;stroke-width:2" x1="95" x2="100" y1="261.6678003174603" y2="261.5911111111111"></line><line style="stroke:#e91e63;stroke-width:2" x1="100" x2="105" y1="261.5911111111111" y2="261.53286"></line><line style="stroke:#e91e63;stroke-width:2" x1="105" x2="110" y1="261.53286" y2="261.49051174603176"></line><line style="stroke:#e91e63;stroke-width:2" x1="110" x2="115" y1="261.49051174603176" y2="261.4615311111111"></line><line style="stroke:#e91e63;stroke-width:2" x1="115" x2="120" y1="261.4615311111111" y2="261.44338285714286"></line><line style="stroke:#e91e63;stroke-width:2" x1="120" x2="125" y1="261.44338285714286" y2="261.43353174603175"></line><line style="stroke:#e91e63;stroke-width:2" x1="125" x2="130" y1="261.43353174603175" y2="261.42944253968255"></line><line style="stroke:#e91e63;stroke-width:2" x1="130" x2="135" y1="261.42944253968255" y2="261.42858"></line><line style="stroke:#e91e63;stroke-width:2" x1="135" x2="140" y1="261.42858" y2="250.0468114285714"></line><line style="stroke:#e91e63;stroke-width:2" x1="140" x2="145" y1="250.0468114285714" y2="237.33125142857142"></line><line style="stroke:#e91e63;stroke-width:2" x1="145" x2="150" y1="237.33125142857142" y2="227.64000000000001"></line><line style="stroke:#e91e63;stroke-width:2" x1="150" x2="155" y1="227.64000000000001" y2="220.56234857142857"></line><line style="stroke:#e91e63;stroke-width:2" x1="155" x2="160" y1="220.56234857142857" y2="215.6875885714286"></line><line style="stroke:#e91e63;stroke-width:2" x1="160" x2="165" y1="215.6875885714286" y2="212.6050114285714"></line><line style="stroke:#e91e63;stroke-width:2" x1="165" x2="170" y1="212.6050114285714" y2="210.90390857142856"></line><line style="stroke:#e91e63;stroke-width:2" x1="170" x2="175" y1="210.90390857142856" y2="210.17357142857142"></line><line style="stroke:#e91e63;stroke-width:2" x1="175" x2="180" y1="210.17357142857142" y2="210.00329142857143"></line><line style="stroke:#e91e63;stroke-width:2" x1="180" x2="185" y1="210.00329142857143" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="185" x2="190" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="190" x2="195" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="195" x2="200" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="200" x2="205" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="205" x2="210" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="210" x2="215" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="215" x2="220" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="220" x2="225" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="225" x2="230" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="230" x2="235" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="235" x2="240" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="240" x2="245" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="245" x2="250" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="250" x2="255" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="255" x2="260" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="260" x2="265" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="265" x2="270" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="270" x2="275" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="275" x2="280" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="280" x2="285" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="285" x2="290" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="290" x2="295" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="295" x2="300" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="300" x2="305" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="305" x2="310" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="310" x2="315" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="315" x2="320" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="320" x2="325" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="325" x2="330" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="330" x2="335" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="335" x2="340" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="340" x2="345" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="345" x2="350" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="350" x2="355" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="355" x2="360" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="360" x2="365" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="365" x2="370" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="370" x2="375" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="375" x2="380" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="380" x2="385" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="385" x2="390" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="390" x2="395" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="395" x2="400" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="400" x2="405" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="405" x2="410" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="410" x2="415" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="415" x2="420" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="420" x2="425" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="425" x2="430" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="430" x2="435" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="435" x2="440" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="440" x2="445" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="445" x2="450" y1="210" y2="210"></line><line style="stroke:#e91e63;stroke-width:2" x1="450" x2="455" y1="210" y2="211.78205999999997"></line><line style="stroke:#e91e63;stroke-width:2" x1="455" x2="460" y1="211.78205999999997" y2="229.11168000000015"></line><line style="stroke:#e91e63;stroke-width:2" x1="460" x2="465" y1="229.11168000000015" y2="242.60802000000004"></line><line style="stroke:#e91e63;stroke-width:2" x1="465" x2="470" y1="242.60802000000004" y2="252.75024"></line><line style="stroke:#e91e63;stroke-width:2" x1="470" x2="475" y1="252.75024" y2="260.0175"></line><line style="stroke:#e91e63;stroke-width:2" x1="475" x2="480" y1="260.0175" y2="264.88895999999994"></line><line style="stroke:#e91e63;stroke-width:2" x1="480" x2="485" y1="264.88895999999994" y2="267.84378"></line><line style="stroke:#e91e63;stroke-width:2" x1="485" x2="490" y1="267.84378" y2="269.36111999999997"></line><line style="stroke:#e91e63;stroke-width:2" x1="490" x2="495" y1="269.36111999999997" y2="269.92014"></line></svg></p><p>
Here is a plot of the values of <code>val.cx</code> and <code>val.cr</code> for different values of <code>t</code>.
This plotting code calls <code>anim_circle</code> at different times to plot the
results. The function <code>anim_circle</code> <i>is</i> these plots,
since it doesn't compute anything else.
</p><blockquote> Fancy ways of saying that <code>anim_circle</code> doesn't change anything else is to say that it  is <i>side-effect-free</i>, or <i>refrentially transparent</i>.</blockquote>
<h3><a id="in-the-browseris-webpage-edit-" href="#in-the-browseris-webpage-edit-"> § </a> Playing with this Webpage: edit <code>anim_circle</code> in the browser!</h3>
<ul>
<li>
 <a onclick="foo()">
  <b>An ORDER</b>: Click on this link, paste what has been copied to your clipboard into the browser's console, and hit enter.
  </a> <b>This instantly updates the circle's animation and the plots</b>, since the code
  in the clipboard overwrites the definition of <code>anim_circle</code>! Scroll
  back to the top to see the new animation and charts.
  As our page is declarative, both the animations and the plots are driven
  by the definition of <code>anim_circle</code>.
</li>

</ul><p>

The code that's been copied onto your clipboard is:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// cx = location | cr = radius</span></i>
<span color="#000000">03:</span> anim_circle = anim_const(<span color="#808080">"cx"</span>, <span color="#000000">100</span>)
<span color="#000000">04:</span>     .seq(anim_const(<span color="#808080">"cr"</span>, <span color="#000000">0</span>))
<span color="#000000">05:</span>     <i><span color="#222222">// (1) grow in size.</span></i>
<span color="#000000">06:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <i><span color="#222222">/*val=*/</span></i><span color="#000000">10</span>, <i><span color="#222222">/*time=*/</span></i><span color="#000000">3</span>))
<span color="#000000">07:</span>     <i><span color="#222222">// (2) go to right while growing.</span></i>
<span color="#000000">08:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cx"</span>, <i><span color="#222222">/*val=*/</span></i><span color="#000000">300</span>, <i><span color="#222222">/*time=*/</span></i><span color="#000000">1</span>)
<span color="#000000">09:</span>         .par(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <span color="#000000">70</span>, <span color="#000000">1</span>)))
<span color="#000000">10:</span>     <i><span color="#222222">// (3) shrink to nothing.</span></i>
<span color="#000000">11:</span>     .seq(anim_interpolated(ease_cubic, <span color="#808080">"cr"</span>, <span color="#000000">0</span>, <span color="#000000">1</span>)); plot()
<span color="#000000">12:</span> </tt></pre>
</div><p>

You can explore different definitions <code>anim_circle</code>s. Feel free to
play around.  Try evaluating <code>anim_circle(0)</code>, <code>anim_circle(anim_circle.duration)</code>,
<code>anim_circle(anim_circle.duration/2.0)</code> in the console to get a feel for what
<code>anim_circle</code> returns. <a onclick="writeOldToClipboard()">
</a></p><ul><a onclick="writeOldToClipboard()">
</a><li><a onclick="writeOldToClipboard()">
 <b>To go back to the original state of affairs</b>, 
  click on this link to copy the old code onto your clipboard </a>. Paste
  the text, into your console, hit enter. Everything will be back to
  original.
</li>

</ul>

<h3><a id="declarative-pure" href="#declarative-pure"> § </a> Declarative ⇒ Pure</h3><p>
As hinted above, since our specification of the animation was entirely declarative,
it can't really "do anything else" like manipulate the DOM. This gives us 
fantastic debugging and editing capabilities. As it's "just" a mathematical
function:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span> anim_circle: (t:Time) -&gt; (cx: float, cr: float)
<span color="#000000">3:</span> </tt></pre>
</div><p>

We can easily swap it (by pasting the code above), poke it (by calling <code>anim_circle(0.5)</code>),
and in general deal with is as a <b>unit of thought</b>. It has no unpleasant
interactions with the rest of the world.
</p><h3><a id="purity-time-travel" href="#purity-time-travel"> § </a> Purity ⇒ Time Travel</h3><p>
Due to this purity, we also get <b>time-travel-debugging</b>. The slider is hooked up
to <code>anim_circle</code>, and displays the circle as dictated by <code>anim_circle(t_slider)</code>.
<code>t_slider</code> is received from the slider.
</p><p>
Drag the slider to move through the animation!  <br>
</p><h3><a id="declarative-composition-staggering-animations" href="#declarative-composition-staggering-animations"> § </a> Declarative ⇒ Composition: staggering animations</h3><p>
Our framework is <i>composable</i>, because we can build larger objects from smaller
objects in a natural way. As an example, a <i>staggered</i> animation is a nice
way to make the entry of multiple objects feel less monotonous.
</p>
<h4><a id="step-1" href="#step-1"> § </a> Step 1</h4><p>
The code to achieve this creates a list of animations called <code>as</code> which
has the animations of the ball rising up. Each element <code>as[i]</code> has
the animation of the ball rising up for the same amount of time. This is
visualized here:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span> *as[0]===*
<span color="#000000">3:</span> *as[1]===*
<span color="#000000">4:</span> *as[2]===*
<span color="#000000">5:</span> *as[3]===*
<span color="#000000">6:</span> *as[4]===*
<span color="#000000">7:</span> </tt></pre>
</div>


<h4><a id="step-2" href="#step-2"> § </a> Step 2</h4><p>
Next, each element <code>as[i]</code> is modified by creating a new animation <code>xs[i]</code>.
<code>xs[i]</code> runs <code>as[i]</code> after a delay of <code>delta*i</code>.
We then compose all the <code>xs[i]</code> in parallel to create a single animation <code>x</code>.
This animation has the balls rising from the bottom in a staggered fashion.
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span>   | |xs[0] = -delay=0-*as[0]===*
<span color="#000000">3:</span>   |P|xs[1] = -delay=1------*as[1]===*
<span color="#000000">4:</span> x=|A|xs[2] = -delay=2-----------*as[2]===*
<span color="#000000">5:</span>   |R|xs[3] = -delay=3----------------*as[3]===*
<span color="#000000">6:</span>   | |xs[4] = -delay=4--------------------*as[4]===*
<span color="#000000">7:</span> </tt></pre>
</div>


<h4><a id="step-3" href="#step-3"> § </a> Step 3</h4><p>
Next, we similarly create an array of animations called <code>bs</code> which
has animations of the balls disappearing. These are staggered as before.
This is shown here:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span>   | |ys[0] = -delay=0-*bs[0]===*
<span color="#000000">3:</span>   |P|ys[1] = -delay=1------*bs[1]===*
<span color="#000000">4:</span> y=|A|ys[2] = -delay=2-----------*bs[2]===*
<span color="#000000">5:</span>   |R|ys[3] = -delay=3----------------*bs[3]===*
<span color="#000000">6:</span>   | |ys[4] = -delay=4--------------------*bs[4]===*
<span color="#000000">7:</span> </tt></pre>
</div>


<h4><a id="step-4" href="#step-4"> § </a> Step 4</h4><p>
Finally, we compose <code>x</code> and <code>y</code>, such that <code>y</code> is staggered relative to <code>x</code>
by some delay. This allows the first few balls to start disappearing
<i>while new balls</i> continue entering.
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span>      |  | |xs[0] = -delay=0-*as[0]===*
<span color="#000000">03:</span>      |  |P|xs[1] = -delay=1------*as[1]===*
<span color="#000000">04:</span>      |x=|A|xs[2] = -delay=2-----------*as[2]===*
<span color="#000000">05:</span>      |  |R|xs[3] = -delay=3----------------*as[3]===*
<span color="#000000">06:</span>      |  | |xs[4] = -delay=4--------------------*as[4]===*
<span color="#000000">07:</span>      |                 | |ys[0] = -delay=0-*bs[0]===*
<span color="#000000">08:</span>      |                 |P|ys[1] = -delay=1------*bs[1]===*
<span color="#000000">09:</span> anim=|---delay-------y=|A|ys[2] = -delay=2-----------*bs[2]===*
<span color="#000000">10:</span>      |                 |R|ys[3] = -delay=3----------------*bs[3]===*
<span color="#000000">11:</span>      |                 | |ys[4] = -delay=4--------------------*bs[4]===*
<span color="#000000">12:</span> </tt></pre>
</div>

<p>
Drag the slider to move through the animation!  <br>
</p><h4><a id="reflection" href="#reflection"> § </a> Reflection</h4><p>
Notice that the final animation network is quite complex. It's hopeless
to build it "manually". In code, we write special helpers
called <code>anim_stagger</code> that allow us to stagger animation, and then use
it, along with <code>.seq()</code> and <code>.par()</code> to build the full animation:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span> <b><u><span color="#000000">const</span></u></b> anim = anim_parallel_list(anim_circles_start)
<span color="#000000">3:</span>     .seq(anim_stagger([anim_stagger(anim_circles_enter, STAGGER),
<span color="#000000">4:</span>                        anim_stagger(anim_circles_leave, STAGGER)], <span color="#000000">300</span>));
<span color="#000000">5:</span> </tt></pre>
</div><p>

This describes the complicated network:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span>      |  | |xs[0] = -delay=0-*as[0]===*
<span color="#000000">03:</span>      |  |P|xs[1] = -delay=1------*as[1]===*
<span color="#000000">04:</span>      |x=|A|xs[2] = -delay=2-----------*as[2]===*
<span color="#000000">05:</span>      |  |R|xs[3] = -delay=3----------------*as[3]===*
<span color="#000000">06:</span>      |  | |xs[4] = -delay=4--------------------*as[4]===*
<span color="#000000">07:</span>      |             | |bs[0] = -delay=0-*as[0]===*
<span color="#000000">08:</span>      |             |P|bs[1] = -delay=1------*as[1]===*
<span color="#000000">09:</span> anim=|---delay---y=|A|bs[2] = -delay=2-----------*as[2]===*
<span color="#000000">10:</span>      |             |R|bs[3] = -delay=3----------------*as[3]===*
<span color="#000000">11:</span>      |             | |bs[4] = -delay=4--------------------*as[4]===*
<span color="#000000">12:</span> </tt></pre>
</div>

<h3><a id="declarative-debuggable" href="#declarative-debuggable"> § </a> Declarative ⇒ Debuggable</h3><p>
As hinted above, since our specification of the animation was entirely declarative,
it can't really "do anything else" like manipulate the DOM. This gives us 
fantastic debugging and editing capabilities. As it's "just" a mathematical
function:
</p><div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span> anim_circle: (t:Time) -&gt; (cx: float, cr: float)
<span color="#000000">3:</span> </tt></pre>
</div><p>

so we can play with it on the console, edit it interactively, and plot it.
It's behaviour can be studied on a piece of paper, since it's entirely
decoupled from the real world.
</p><h3><a id="easingower-of-" href="#easingower-of-"> § </a> The power of <code>easing</code></h3><p>
So far, we have been using the same <code>easing</code> parameter everywhere: 
<code>easing_cubic</code>. This parameter is a way to <i>warp time</i>. We only tell the
library what the <i>final value</i> is supposed to be. It's our library's job
to figure out how to get from the current value to the final value. However,
there are <i>many ways</i> to get from the initial value to the final value. We
could:
</p><ul>
<li>
 Change the value in constant increments. This is what <code>easing_linear</code> does.
</li>
<li>
 Change the value so that it changes slowly in the beginning, and much
  faster later. This is what <code>easing_cubic</code> does.
</li>
<li>
 Change the value so that it changes quickly, <i>overshoots</i>, and then
  comes back to the final value. This is what <code>ease_out_back</code> does. 
</li>

</ul><p>

There are many easing functions. Indeed, infinitely many, since we can write
any function we want. A quick example of the three mentioned above, with
a slide to notice the difference:
</p><p>
Drag the slider to move through the animation!  <br>
</p><h4><a id="code-for-easing" href="#code-for-easing"> § </a> Code for easing:</h4>
<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <b><u><span color="#000000">const</span></u></b> interpolators = [ease_cubic, ease_linear, ease_out_back]
<span color="#000000">03:</span> <b><u><span color="#000000">for</span></u></b>(<b><u><span color="#000000">var</span></u></b> i = <span color="#000000">0</span>; i &lt; NINTERPOLATORS; ++i) {
<span color="#000000">04:</span>     ...
<span color="#000000">05:</span>     anim_circles_start.push(anim_const(<span color="#808080">"cx"</span> + i, <span color="#000000">200</span>));
<span color="#000000">06:</span>     anim_circles_enter.push(anim_interpolated(interpolators[i], <span color="#808080">"cx"</span> + i, <span color="#000000">300</span>, <span color="#000000">200</span>));
<span color="#000000">07:</span> }
<span color="#000000">08:</span> ...
<span color="#000000">09:</span> <b><u><span color="#000000">const</span></u></b> anim = anim_parallel_list(anim_circles_start).seq(anim_parallel_list(anim_circles_enter));
<span color="#000000">10:</span> 
<span color="#000000">11:</span> </tt></pre>
</div>

<h3><a id="versus-the-world" href="#versus-the-world"> § </a> <code>minanim.js</code> versus the world</h3><p>
Both <code>d3.js</code> and <code>anime.js</code> are libraries that intertwine 
<i>computing</i> with <i>animation</i>. On the other hand, our implementation describes
<i>only</i> how values change. It's up to us to render this using
SVG/canvas/what-have-you. 
Building a layer like <code>anime.js</code> on top of this is not hard. On the other hand,
using <code>anime.js</code> purely is impossible.
</p><h3><a id="code-walkthrough-api-documentation" href="#code-walkthrough-api-documentation"> § </a> Code Walkthrough / API documentation</h3><p>
The entire "library", which is written very defensively and sprinkled with
asserts fits in <a href="https://github.com/bollu/mathemagic/blob/master/declarative/minanim.js">
<b>exactly 100 lines of code</b></a>
. It can be golfed further
at the expense of either asserts, clarity, or by adding some higher-order
functions that factor out some common work. I was loath to do any of these.
So here's the full source code, explained as we go on.
</p><ul>
<li>
 We write <code>assert_precondition(t, out, tstart)</code> to check that <code>t</code>
  and <code>tstart</code> are numbers such that <code>t &gt;= tstart</code>, and that <code>out</code> is an object. 
  If <code>tstart</code> is uninitialized, we initialize <code>tstart</code> to <code>0</code>. If
  <code>out</code> is uninitialized, we initialize <code>out</code> to <code>{}</code>.
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// t, tstart: number. out: object</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> assert_precondition(t, out, tstart) {
<span color="#000000">04:</span>     console.assert(<b><u><span color="#000000">typeof</span></u></b>(t) === <span color="#808080">"number"</span>);
<span color="#000000">05:</span>     <b><u><span color="#000000">if</span></u></b> (out === undefined) { out = {}; }
<span color="#000000">06:</span>     console.assert(<b><u><span color="#000000">typeof</span></u></b>(out) === <span color="#808080">"object"</span>);
<span color="#000000">07:</span>     <b><u><span color="#000000">if</span></u></b> (tstart === undefined) { tstart = <span color="#000000">0</span>; }
<span color="#000000">08:</span>     <b><u><span color="#000000">else</span></u></b> { console.assert(<b><u><span color="#000000">typeof</span></u></b>(tstart) === <span color="#808080">"number"</span>); }
<span color="#000000">09:</span>     console.assert(t &gt;= tstart);
<span color="#000000">10:</span>     <b><u><span color="#000000">return</span></u></b> [out, tstart];
<span color="#000000">11:</span> }
<span color="#000000">12:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_delay(duration)</code> creates a function <code>f</code>. On being invoked, it returns
  whatever value of <code>out</code> has been given to it. That is, it doesn't
  modify anything. It has three fields, <code>duration</code>, <code>par</code>, and <code>seq</code>.
  <code>duration</code>. <code>duration</code> is how long the animation runs for. <code>par, seq</code>
  are methods for chaining, that allows us to compose this delay animation
  in parallel and in sequence with other animations.
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// duration: number</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> anim_delay(duration) {
<span color="#000000">04:</span>     console.assert(<b><u><span color="#000000">typeof</span></u></b>(duration) === <span color="#808080">"number"</span>);
<span color="#000000">05:</span>     let f = <b><u><span color="#000000">function</span></u></b>(t, out, tstart) { 
<span color="#000000">06:</span>         [out, tstart] = assert_precondition(t, out, tstart); <b><u><span color="#000000">return</span></u></b> out;
<span color="#000000">07:</span>     }
<span color="#000000">08:</span>     f.duration = duration;
<span color="#000000">09:</span>     f.par = ((g) =&gt; anim_parallel(f, g));
<span color="#000000">10:</span>     f.seq = ((g) =&gt; anim_sequence(f, g));
<span color="#000000">11:</span>     <b><u><span color="#000000">return</span></u></b> f;
<span color="#000000">12:</span> }
<span color="#000000">13:</span> </tt></pre>
</div>

<ul>
<li>
 <code>const(field, v)</code> creates a function <code>f</code>. On being invoked, it sets
  <code>out.v = field</code>. It takes zero time to run such an animation, hence it's
  duration is <code>0</code>. Useful for instaneously setting the value at the
  start of an animation.
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// field: string. v: number</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> anim_const(field, v) {
<span color="#000000">04:</span>     let f = <b><u><span color="#000000">function</span></u></b>(t, out, tstart) {
<span color="#000000">05:</span>         [out, tstart] = assert_precondition(t, out, tstart); out[field] = v; <b><u><span color="#000000">return</span></u></b> out;
<span color="#000000">06:</span>     };
<span color="#000000">07:</span>     f.duration = <span color="#000000">0</span>;
<span color="#000000">08:</span>     f.par = ((g) =&gt; anim_parallel(f, g));
<span color="#000000">09:</span>     f.seq = ((g) =&gt; anim_sequence(f, g));
<span color="#000000">10:</span>     <b><u><span color="#000000">return</span></u></b> f;
<span color="#000000">11:</span> }
<span color="#000000">12:</span> </tt></pre>
</div>

<ul>
<li>
 We implement two <b>easing functions</b>, which takes a parameter 
  <code>tlin</code> such that <code>0 &lt;= tlin &lt;= 1</code>, and two parameters <code>vstart</code> and <code>vend</code>.
  The functions allow us to animate a change from <code>vstart</code> to <code>vend</code> smoothly.
  We are to imagine <code>tlin</code> as a time. When <code>tlin=0</code>, we are at <code>vstart</code>.
  When <code>tlin=1</code>, we will be at <code>tend</code>.
  In between, we want values between <code>vstart</code> and <code>vend</code>. To animate values,
  we often want the change from <code>vstart</code> to <code>vend</code> to happen a certain way.
  For example, we often want the change to start slowly, and then for the
  change to happen faster towards the end. A good reference for this is
  <a href="https://easings.net/">
<code>easings.net</code></a>
. Our animation library can use
  <i>any</i> easing function we see fit.
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// vstart, vend: number. tlin: number, 0 &lt;= tlin &lt;= 1</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> ease_linear(vstart, tlin, vend) { <b><u><span color="#000000">return</span></u></b> (<span color="#000000">1.0</span> - tlin) * vstart + tlin * vend; }
<span color="#000000">04:</span> 
<span color="#000000">05:</span> <b><u><span color="#000000">function</span></u></b> ease_cubic(vstart, tlin, vend) {
<span color="#000000">06:</span>     <b><u><span color="#000000">const</span></u></b> cube = (<span color="#000000">1</span> - tlin)*(<span color="#000000">1</span>-tlin)*(<span color="#000000">1</span>-tlin); <b><u><span color="#000000">return</span></u></b> cube * vstart + (<span color="#000000">1</span> - cube) * vend;
<span color="#000000">07:</span> }
<span color="#000000">08:</span> <b><u><span color="#000000">function</span></u></b> ease_out_back(vstart, tlin, vend) {
<span color="#000000">09:</span>     <b><u><span color="#000000">const</span></u></b> c1 = <span color="#000000">1.70158</span>; <b><u><span color="#000000">const</span></u></b> c3 = c1 + <span color="#000000">1</span>; <b><u><span color="#000000">const</span></u></b> t = <span color="#000000">1</span> + c3 * pow(x - <span color="#000000">1</span>, <span color="#000000">3</span>) + c1 * pow(x - <span color="#000000">1</span>, <span color="#000000">2</span>);
<span color="#000000">10:</span>     <b><u><span color="#000000">return</span></u></b> (<span color="#000000">1</span>-t) * vstart + t*vend;
<span color="#000000">11:</span> }
<span color="#000000">12:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_interpolated(duration)</code> creates a function <code>f</code>. On being invoked, 
  it figures out if its animation is running or has already ended.
  We have a <b>precondition</b> <code>t &gt;= tstart</code>, which is checked by
  <code>assert_precondition</code>, and is maintained by the library.
  So, we only need to care whether the animation is currently running
  or has ended. If the animation is currently running, we find the
  current value using <code>fease</code>. If the animation has ended, we set
  the value to the <code>end</code> value.
</li>

</ul>


<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// fease: easing function.</span></i>
<span color="#000000">03:</span> <i><span color="#222222">// field: string. vend: number. duration: number &gt;= 0</span></i>
<span color="#000000">04:</span> <b><u><span color="#000000">function</span></u></b> anim_interpolated(fease, field, vend, duration) {
<span color="#000000">05:</span>     let f =  <b><u><span color="#000000">function</span></u></b>(t, out, tstart) {
<span color="#000000">06:</span>         [out, tstart] = assert_precondition(t, out, tstart);
<span color="#000000">07:</span>         <b><u><span color="#000000">if</span></u></b> (t &lt; tstart + duration &amp;&amp; duration !== <span color="#000000">0</span>) {
<span color="#000000">08:</span>             <b><u><span color="#000000">const</span></u></b> tlin = (t - tstart) /duration;
<span color="#000000">09:</span>             console.assert(tlin &gt;= <span color="#000000">0</span>);
<span color="#000000">10:</span>             console.assert(tlin &lt;= <span color="#000000">1</span>);
<span color="#000000">11:</span>             <b><u><span color="#000000">const</span></u></b> vstart = out[field];
<span color="#000000">12:</span>             out[field] = fease(vstart, tlin, vend);
<span color="#000000">13:</span>         } <b><u><span color="#000000">else</span></u></b> { out[field] = vend; }
<span color="#000000">14:</span>         <b><u><span color="#000000">return</span></u></b> out;
<span color="#000000">15:</span>     };
<span color="#000000">16:</span>     f.duration = duration;
<span color="#000000">17:</span>     f.par = ((g) =&gt; anim_parallel(f, g));
<span color="#000000">18:</span>     f.seq = ((g) =&gt; anim_sequence(f, g));
<span color="#000000">19:</span>     <b><u><span color="#000000">return</span></u></b> f;
<span color="#000000">20:</span> }
<span color="#000000">21:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_sequence(anim1, anim2)</code> sets up <code>anim2</code> to begin
  running once <code>anim1</code> has completed. When it is invoked, <code>t &gt;= tstart</code>. So
  it can run <code>anim1</code> immediately. If it learns that
  <code>anim1</code> has completed, it then invokes <code>anim2</code>. The total time taken for
  this animation is its <code>duration</code>. This is the sum of durations of <code>anim1</code>
  and <code>anim2</code>.
</li>

</ul>


<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// anim1, anim2: anim</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> anim_sequence(anim1, anim2) {
<span color="#000000">04:</span>     <b><u><span color="#000000">const</span></u></b> duration = anim1.duration + anim2.duration;
<span color="#000000">05:</span>     let f =  <b><u><span color="#000000">function</span></u></b>(t, out, tstart) {
<span color="#000000">06:</span>         [out, tstart] = assert_precondition(t, out, tstart);
<span color="#000000">07:</span>         anim1(t, out, tstart);
<span color="#000000">08:</span>         <b><u><span color="#000000">if</span></u></b> (t &gt;= tstart + anim1.duration) { anim2(t, out, tstart + anim1.duration); }
<span color="#000000">09:</span>         <b><u><span color="#000000">return</span></u></b> out;
<span color="#000000">10:</span>     }
<span color="#000000">11:</span>     f.duration = duration;
<span color="#000000">12:</span>     f.par = ((g) =&gt; anim_parallel(f, g));
<span color="#000000">13:</span>     f.seq = ((g) =&gt; anim_sequence(f, g));
<span color="#000000">14:</span>     <b><u><span color="#000000">return</span></u></b> f;
<span color="#000000">15:</span> }
<span color="#000000">16:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_parallel(anim1, anim2)</code> sets up <code>anim1</code> and
  <code>anim2</code> to run in parallel. When it is invoked, <code>t &gt;= tstart</code>. So it can
  launch <code>anim1, anim2</code> both immediately. The <code>duration</code> of this animation
  is the <i>maximum</i> time taken by <code>anim1</code>, <code>anim2</code>.
</li>

</ul>


<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// anim1, anim2: anim</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> anim_parallel(anim1, anim2) {
<span color="#000000">04:</span>     <b><u><span color="#000000">const</span></u></b> duration = Math.max(anim1.duration, anim2.duration);
<span color="#000000">05:</span>     let f =  <b><u><span color="#000000">function</span></u></b>(t, out, tstart) {
<span color="#000000">06:</span>         [out, tstart] = assert_precondition(t, out, tstart);
<span color="#000000">07:</span>         <b><u><span color="#000000">if</span></u></b> (t &gt;= tstart) { anim1(t, out, tstart); anim2(t, out, tstart); }
<span color="#000000">08:</span>         <b><u><span color="#000000">return</span></u></b> out;
<span color="#000000">09:</span>     }
<span color="#000000">10:</span>     f.duration = duration;
<span color="#000000">11:</span>     f.par = ((g) =&gt; anim_parallel(f, g));
<span color="#000000">12:</span>     f.seq = ((g) =&gt; anim_sequence(f, g));
<span color="#000000">13:</span>     <b><u><span color="#000000">return</span></u></b> f;
<span color="#000000">14:</span> }
<span color="#000000">15:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_parallel_list(xs)</code> is a helpful to write the animations
  in <code>xs</code> in parallel. It chains together the elements of the list
  with <code>par</code> calls.
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">1:</span> 
<span color="#000000">2:</span> <i><span color="#222222">// xs: list[animation]</span></i>
<span color="#000000">3:</span> <b><u><span color="#000000">function</span></u></b> anim_parallel_list(xs) {
<span color="#000000">4:</span>     <b><u><span color="#000000">var</span></u></b> x = xs[<span color="#000000">0</span>]; <b><u><span color="#000000">for</span></u></b>(<b><u><span color="#000000">var</span></u></b> i = <span color="#000000">1</span>; i &lt; xs.length; ++i) { x = x.par(xs[i]); }
<span color="#000000">5:</span>     <b><u><span color="#000000">return</span></u></b> x;
<span color="#000000">6:</span> }
<span color="#000000">7:</span> </tt></pre>
</div>

<ul>
<li>
 <code>anim_stagger(xs, delta)</code> is a combinator to stagger the animations in
  the list of animations <code>xs</code>. It
  delays the animation at <code>xs[i]</code> for a duration <code>delta*i</code>. 
</li>

</ul>

<div>
<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span color="#000000">01:</span> 
<span color="#000000">02:</span> <i><span color="#222222">// xs: list[animation]. delta: duration</span></i>
<span color="#000000">03:</span> <b><u><span color="#000000">function</span></u></b> anim_stagger(xs, delta) {
<span color="#000000">04:</span>     console.assert(<b><u><span color="#000000">typeof</span></u></b>(delta) == <span color="#808080">"number"</span>);
<span color="#000000">05:</span>     <b><u><span color="#000000">var</span></u></b> ys = [];
<span color="#000000">06:</span>     <b><u><span color="#000000">for</span></u></b>(<b><u><span color="#000000">var</span></u></b> i = <span color="#000000">0</span>; i &lt; xs.length; ++i) {
<span color="#000000">07:</span>         ys.push(anim_delay(delta*i).seq(xs[i]));
<span color="#000000">08:</span>     }
<span color="#000000">09:</span>     <b><u><span color="#000000">var</span></u></b> y = ys[<span color="#000000">0</span>];
<span color="#000000">10:</span>     <b><u><span color="#000000">for</span></u></b>(<b><u><span color="#000000">var</span></u></b> i = <span color="#000000">1</span>; i &lt; ys.length; ++i) {
<span color="#000000">11:</span>         y = y.par(ys[i]);
<span color="#000000">12:</span>     }
<span color="#000000">13:</span>     <b><u><span color="#000000">return</span></u></b> y;
<span color="#000000">14:</span> }
<span color="#000000">15:</span> </tt></pre>
</div>

<h3><a id="conclusion" href="#conclusion"> § </a> Conclusion</h3><p>
We saw how to write a tiny, declarative, composable animation library that
does <i>one</i> thing: compose functions that manipulate values over time,
and does it well.
If you like this content, check out the repo at <a href="https://github.com/bollu/mathemagic">
bollu/mathemagic</a>





</p></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>