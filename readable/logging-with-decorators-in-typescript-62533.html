<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Logging with Decorators in TypeScript - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Logging with Decorators in TypeScript - linksfor.dev(s)"/>
    <meta property="article:author" content="https://medium.com/@ben_seager"/>
    <meta property="og:description" content="Avoid tangled code by encapsulating cross-cutting concerns."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://medium.com/swlh/logging-with-decorators-in-typescript-1c3ce13576d5"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Logging with Decorators in TypeScript</title>
<div class="readable">
        <h1>Logging with Decorators in TypeScript</h1>
            <div>by https://medium.com/@ben_seager</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 08 Jun 2020</div>
        <p><a href="https://medium.com/swlh/logging-with-decorators-in-typescript-1c3ce13576d5">https://medium.com/swlh/logging-with-decorators-in-typescript-1c3ce13576d5</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><section><div><div><h2 id="91e8">Avoid tangled code by encapsulating cross-cutting concerns.</h2><div><div><div><div><a rel="noopener" href="https://medium.com/@ben_seager?source=post_page-----1c3ce13576d5----------------------"><div><p><img alt="Ben Seager" src="https://miro.medium.com/fit/c/96/96/2*5y97xLFmh4DB5RU7-BkVcg.png" width="48" height="48"></p></div></a></div></div></div></div><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*xr95amIoj4IUPCez7QOH5Q.jpeg?q=20" width="1280" height="853" role="presentation"></p><p><img width="1280" height="853" srcset="https://miro.medium.com/max/552/1*xr95amIoj4IUPCez7QOH5Q.jpeg 276w, https://miro.medium.com/max/1104/1*xr95amIoj4IUPCez7QOH5Q.jpeg 552w, https://miro.medium.com/max/1280/1*xr95amIoj4IUPCez7QOH5Q.jpeg 640w, https://miro.medium.com/max/1400/1*xr95amIoj4IUPCez7QOH5Q.jpeg 700w" sizes="700px" role="presentation" src="https://miro.medium.com/max/1280/1*xr95amIoj4IUPCez7QOH5Q.jpeg"></p></div></div></div></div><figcaption data-selectable-paragraph="">Image by <a href="https://pixabay.com/users/snd63-2441173/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1484387" target="_blank" rel="noopener nofollow">snd63</a> from <a href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1484387" target="_blank" rel="noopener nofollow">Pixabay</a></figcaption></figure><p id="0ebe" data-selectable-paragraph="">As codebases grow, so does the complex web of dependencies and concerns that individual modules rely on. Managing these can cause us headaches — even in the most well engineered applications.</p><p id="ce23" data-selectable-paragraph="">Logging is a prime example of one such concern. We may have a logging functionality in one module, that is used across the application —<strong> cross-cutting</strong> it.</p><p id="09ba" data-selectable-paragraph="">Consider the following example:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*DkmtSLKvbCeLSSxTBSNtBg.png?q=20" width="1584" height="1436" role="presentation"></p><p><img width="1584" height="1436" srcset="https://miro.medium.com/max/552/1*DkmtSLKvbCeLSSxTBSNtBg.png 276w, https://miro.medium.com/max/1104/1*DkmtSLKvbCeLSSxTBSNtBg.png 552w, https://miro.medium.com/max/1280/1*DkmtSLKvbCeLSSxTBSNtBg.png 640w, https://miro.medium.com/max/1400/1*DkmtSLKvbCeLSSxTBSNtBg.png 700w" sizes="700px" role="presentation" src="https://miro.medium.com/max/1584/1*DkmtSLKvbCeLSSxTBSNtBg.png"></p></div></div></div></div><figcaption data-selectable-paragraph="">Two classes with an injected Logger dependency</figcaption></figure><p id="99b5" data-selectable-paragraph="">On the face of it, there isn’t too much wrong here. We’re injecting implementations of <em>Logger</em> (which happens to be an interface, we’ll see it shortly) so that’s a tick in the SOLID box.</p><p id="bf3e" data-selectable-paragraph="">There are some improvements we can make though. The <em>Logger</em> is a cross-cutting concern. It weaves its way through our application like ivy. Yes, we’re injecting it but consider the maintenance burden. If the <em>log</em> method’s signature changes that is an awful lot of refactoring that needs to be handled.</p><h2 id="c78b" data-selectable-paragraph="">Decorators to the Rescue</h2><p id="3ac3" data-selectable-paragraph="">If you use Angular you’ll already be very familiar with decorators in TypeScript but if not, don’t worry — this article presumes exactly zero knowledge. So, we’ll start at the beginning.</p><p id="6072" data-selectable-paragraph="">A decorator “decorates” a class or method and provides some extra functionality at initialisation time, i.e. when a class is instantiated. In this example we’re going to implement a decorator that logs a message whenever a method is invoked, so that we can remove the injected <em>Logger </em>dependencies and calls to <em>lo</em>g.</p><p id="8bcb" data-selectable-paragraph="">In TypeScript decorators look like this:</p><pre><span id="d34e" data-selectable-paragraph="">@decorator()<br>public class Foo { ... }</span></pre><p id="80f5" data-selectable-paragraph="">Ok, before we dive into writing a decorator let’s do some setup. We’re going to need some logging functionality. This will be handled by two classes, <em>ConsoleLogger</em> and <em>LoggerFactory</em> and an interface <em>Logger</em>. Let’s take a look at them:</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*ITglv9GYqFtI-3sJLztP1w.png?q=20" width="1584" height="500" role="presentation"></p><p><img width="1584" height="500" srcset="https://miro.medium.com/max/552/1*ITglv9GYqFtI-3sJLztP1w.png 276w, https://miro.medium.com/max/1104/1*ITglv9GYqFtI-3sJLztP1w.png 552w, https://miro.medium.com/max/1280/1*ITglv9GYqFtI-3sJLztP1w.png 640w, https://miro.medium.com/max/1400/1*ITglv9GYqFtI-3sJLztP1w.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">Logger Interface</figcaption></figure><p id="29be" data-selectable-paragraph="">The <em>Logger</em> interface has a single method, <em>log</em>, which takes a string. Simple.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*C2wVYGGzxE8Fx56WK2eP9g.png?q=20" width="1584" height="670" role="presentation"></p><p><img width="1584" height="670" srcset="https://miro.medium.com/max/552/1*C2wVYGGzxE8Fx56WK2eP9g.png 276w, https://miro.medium.com/max/1104/1*C2wVYGGzxE8Fx56WK2eP9g.png 552w, https://miro.medium.com/max/1280/1*C2wVYGGzxE8Fx56WK2eP9g.png 640w, https://miro.medium.com/max/1400/1*C2wVYGGzxE8Fx56WK2eP9g.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">ConsoleLogger class</figcaption></figure><p id="012d" data-selectable-paragraph="">The <em>ConsoleLogger</em> class implements the <em>Logger</em> interface and, well, logs a message to the console (this is a <em>very</em> simple example, after all).</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*BydBwCO9E3Kj1hCqO_KaHg.png?q=20" width="1584" height="968" role="presentation"></p><p><img width="1584" height="968" srcset="https://miro.medium.com/max/552/1*BydBwCO9E3Kj1hCqO_KaHg.png 276w, https://miro.medium.com/max/1104/1*BydBwCO9E3Kj1hCqO_KaHg.png 552w, https://miro.medium.com/max/1280/1*BydBwCO9E3Kj1hCqO_KaHg.png 640w, https://miro.medium.com/max/1400/1*BydBwCO9E3Kj1hCqO_KaHg.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">LoggerFactory</figcaption></figure><p id="021b" data-selectable-paragraph="">The <em>LoggerFactory</em> is responsible for creating and returning a single instance of the <em>ConsoleLogger</em>. If you’re familiar with the singleton pattern, then you’ll recognise this. If not - this is a quick, crude, example of implementing the singleton pattern.</p><p id="069a" data-selectable-paragraph="">Right — that’s the setup done. We’ve got a means of logging to the console. Now let’s look at implementing a decorator.</p><p id="2339" data-selectable-paragraph="">If you’re thinking that this kind of meta-programming is going to be complex, think again. TypeScript makes it really quite simple to implement some powerful functionality.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*D8UW16vw-JqjMabcx29EKA.png?q=20" width="1820" height="756" role="presentation"></p><p><img width="1820" height="756" srcset="https://miro.medium.com/max/552/1*D8UW16vw-JqjMabcx29EKA.png 276w, https://miro.medium.com/max/1104/1*D8UW16vw-JqjMabcx29EKA.png 552w, https://miro.medium.com/max/1280/1*D8UW16vw-JqjMabcx29EKA.png 640w, https://miro.medium.com/max/1400/1*D8UW16vw-JqjMabcx29EKA.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">A simple decorator</figcaption></figure><p id="1911" data-selectable-paragraph="">Ok, let’s step through this. Some of it is obvious but some requires a little explanation.</p><p id="0423" data-selectable-paragraph="">On line 3 we’re using the <em>LoggerFactory</em> to get an instance of <em>Logger </em>that we’ll be using to write messages to the console. So far, so straightforward.</p><p id="a3c5" data-selectable-paragraph="">The fun starts on line 5.</p><p id="cbf1" data-selectable-paragraph="">We’re creating a function that returns a function. The “outer” function, the one declared on line 5, is actually the <strong>decorator factory</strong>. This is a function which creates, and returns, the actual decorator. We can use a decorator factory to customise how a decorator is applied, but in this example we’re just returning the decorator.</p><p id="b57d" data-selectable-paragraph="">So, the decorator itself. This is the function on lines 6, 7 and 8. As you can see all it does is call the <em>log</em> method. This type of decorator is a <strong>method decorator</strong>. It should only be applied to a class’s methods.</p><p id="15f4" data-selectable-paragraph="">You can see that there are three arguments - <em>target, propertyKey</em> and <em>descriptor</em>. Let’s define what these are:</p><ul><li id="07ef" data-selectable-paragraph=""><strong>target</strong>: The class that the member is part of</li><li id="9e0d" data-selectable-paragraph=""><strong>propertyKey:</strong> The name of the member</li><li id="34ad" data-selectable-paragraph=""><strong>descriptor:</strong> This is, essentially, the object that you would pass to <code>Object.defineProperty</code> if you we’re writing this class in JavaScript</li></ul><p id="453e" data-selectable-paragraph="">OK — that’s our decorator up and running. Let’s implement it in the <em>Counter</em> class we saw right at the start of the article.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*GG_hNrGJa45UnFtDCpU82g.png?q=20" width="1584" height="1308" role="presentation"></p><p><img width="1584" height="1308" srcset="https://miro.medium.com/max/552/1*GG_hNrGJa45UnFtDCpU82g.png 276w, https://miro.medium.com/max/1104/1*GG_hNrGJa45UnFtDCpU82g.png 552w, https://miro.medium.com/max/1280/1*GG_hNrGJa45UnFtDCpU82g.png 640w, https://miro.medium.com/max/1400/1*GG_hNrGJa45UnFtDCpU82g.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">A simple node app’s index.ts file</figcaption></figure><p id="9232" data-selectable-paragraph="">The code above is the entry point for a very simple node app. It creates a new instance of <em>Counter</em> and does a loop, and in each iteration it prints the current count and then increments.</p><p id="df88" data-selectable-paragraph="">On lines 7 and 12 we’ve implemented the <em>simpleLog</em> (remember the <code>@</code> syntax for a decorator). We’ve also been able to remove the injected logger from the class (yay, no cross-cutting concerns) and the hard-coded calls to <em>log</em> from each of the methods.</p><p id="9979" data-selectable-paragraph="">This will perform the same as before, logging that we’re calling each method on each iteration.</p><p id="0844" data-selectable-paragraph="">Right?</p><p id="361d" data-selectable-paragraph="">Let’s look at the output…</p><pre><span id="f5d2" data-selectable-paragraph="">❯ node index<br>Calling currentCount<br>Calling incrementCount<br>0<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</span></pre><p id="4c67" data-selectable-paragraph="">Hmm…</p><p id="7fae" data-selectable-paragraph="">Well the correct method names have been logged, so that’s a start — but we’re not getting anything logged from the decorators on each iteration.</p><p id="392d" data-selectable-paragraph="">Remember at the start of the article we learned that decorators are called at instatiation time and <strong>not</strong> when their decorated methods are called. That’s what we’re seeing here. An instance of <em>Counter </em>is being instatiated so the decorator is called.</p><p id="9b1d" data-selectable-paragraph="">So, how can we replicate the functionality we had originally.</p><p id="ea84" data-selectable-paragraph="">Let’s create a slightly more useful decorator…</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*lKpLxpAAUO1sEQjbHp_34Q.png?q=20" width="1836" height="882" role="presentation"></p><p><img width="1836" height="882" srcset="https://miro.medium.com/max/552/1*lKpLxpAAUO1sEQjbHp_34Q.png 276w, https://miro.medium.com/max/1104/1*lKpLxpAAUO1sEQjbHp_34Q.png 552w, https://miro.medium.com/max/1280/1*lKpLxpAAUO1sEQjbHp_34Q.png 640w, https://miro.medium.com/max/1400/1*lKpLxpAAUO1sEQjbHp_34Q.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">A second decorator, this time a little more useful</figcaption></figure><p id="f05c" data-selectable-paragraph="">So similar to before, we’re using a decorator factory which returns a function and the arguments <em>target</em>, <em>propertyKey </em>and <em>descriptor </em>are the same. The difference is in the guts of the decorator function itself.</p><p id="0029" data-selectable-paragraph="">On line 3 we’re creating a copy of the descriptor’s <em>value </em>property. This is the decorated method that will actually be executed.</p><p id="cced" data-selectable-paragraph="">We then set <em>descriptor.value </em>to a new function, one which wraps the original. You can see this on lines 5 to 8. On line 6 we call <em>log </em>and on line 7 we call the copy of the original method and return the result.</p><p id="a8cf" data-selectable-paragraph="">Let’s implement this in <em>index.ts</em> and see what the output looks like.</p><figure><div><div><div><div><p><img src="https://miro.medium.com/max/60/1*y4HBDghLxQ_6mHVd6IYXjg.png?q=20" width="1584" height="1308" role="presentation"></p><p><img width="1584" height="1308" srcset="https://miro.medium.com/max/552/1*y4HBDghLxQ_6mHVd6IYXjg.png 276w, https://miro.medium.com/max/1104/1*y4HBDghLxQ_6mHVd6IYXjg.png 552w, https://miro.medium.com/max/1280/1*y4HBDghLxQ_6mHVd6IYXjg.png 640w, https://miro.medium.com/max/1400/1*y4HBDghLxQ_6mHVd6IYXjg.png 700w" sizes="700px" role="presentation"></p></div></div></div></div><figcaption data-selectable-paragraph="">Refactored entry point using usefulLog</figcaption></figure><p id="e3cd" data-selectable-paragraph="">The only change is to use our new <em>usefulLog</em> decorator.</p><p id="20f3" data-selectable-paragraph="">And the output…</p><pre><span id="f223" data-selectable-paragraph="">Calling currentCount<br>0<br>Calling incrementCount<br>Calling currentCount<br>1<br>Calling incrementCount<br>Calling currentCount<br>2<br>Calling incrementCount<br>Calling currentCount<br>3<br>Calling incrementCount<br>Calling currentCount<br>4<br>Calling incrementCount<br>Calling currentCount<br>5<br>Calling incrementCount<br>Calling currentCount<br>6<br>Calling incrementCount<br>Calling currentCount<br>7<br>Calling incrementCount<br>Calling currentCount<br>8<br>Calling incrementCount<br>Calling currentCount<br>9<br>Calling incrementCount</span></pre><p id="8567" data-selectable-paragraph="">Much better!</p><h2 id="ab6a" data-selectable-paragraph="">Conclusion</h2><p id="e582" data-selectable-paragraph="">We’ve seen how we can implement a simple decorator to log whenever a method is called and how this helps to alleviate cross-cutting concerns. If we ever needed to change the method signature of <em>log</em> we would only need to refactor one place — the decorator.</p><p id="e3ea" data-selectable-paragraph="">This was, of course, a very simple example but it has hopefully given you an insight into what decorators are and how they work.</p><p id="65a2" data-selectable-paragraph="">As of right now (June 2020) decorators in JavaScript, and therefore TypeScript, are still experimental. Their final implementation in JS hasn’t been formally agreed. Personally I’m happy using the in TypeScript — where the compiler does an awesome job of abstracting experimental features away — but I’m less happy using them in un-transpiled JavaScript applications.</p><p id="5a3b" data-selectable-paragraph="">That being said this is very powerful functionality available to us, familiar to those from the C# or Java worlds, and can really help solve some problems (such as cross-cutting concerns).</p></div></div></section></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>