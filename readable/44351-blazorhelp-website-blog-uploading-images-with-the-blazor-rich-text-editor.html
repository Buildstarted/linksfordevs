<!DOCTYPE html>
<html lang="en">
<head>
    <title>
BlazorHelp Website &gt; Blog - Uploading Images With The Blazor Rich Text Editor -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>BlazorHelp Website &gt; Blog - Uploading Images With The Blazor Rich Text Editor</h1><div><div class="BlogBody"><acronym class="BlogPublished" title="12/15/2019 3:00 PM"><span class="BlogPubMonth"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryMonth">Dec</span></span><span class="BlogPubDate"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryDay">15</span></span></acronym><p class="BlogSubHead"><span class="blog_author"><span id="dnn_ctr382_MainView_ViewEntry_lblPostedBy">Written by:</span><span id="dnn_ctr382_MainView_ViewEntry_lblUserID">Michael Washington</span></span><br><span id="dnn_ctr382_MainView_ViewEntry_lblDateTime" class="BlogDate">12/15/2019 3:00 PM</span>&nbsp;
  <a id="dnn_ctr382_MainView_ViewEntry_lnkRss" href="http://blazorhelpwebsite.com/Blog/tabid/61/rssid/1/Default.aspx" target="_blank"><img id="dnn_ctr382_MainView_ViewEntry_lnkRssIcon" src="/desktopmodules/Blog/Images/feed-icon-12x12.gif" alt="RssIcon"></a></p><p><img src="/images/BlazorBlogsAnimation.gif"></p><p>By combining <strong>Blazor</strong> components, you can easily enable uploading of images into the <strong>Blazor Rich Text Editor.</strong></p><h1>Blazor-Blogs</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_8ec60ccc-4a77-4b03-b601-05ad3bfe2ba7.png" width="510" height="227"></p><p>We start with the <strong>Blazor Blogs</strong> Github project at: <a href="https://github.com/ADefWebserver/Blazor-Blogs">https://github.com/ADefWebserver/Blazor-Blogs</a>. </p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_42c90f01-f042-4469-86b1-524af2b384d7.png" width="672" height="287"></p><p>We will want to leverage the power of the free <strong><a href="https://razor.radzen.com/">Radzen Blazor Components</a></strong>, so we follow the directions at this link to install the controls: <a href="https://razor.radzen.com/get-started">https://razor.radzen.com/get-started</a>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_0601f522-f398-4739-88b7-972fdf7318b5.png" width="616" height="228"></p><p>We will also need to install the <strong>NuGet</strong> package <strong>System.Drawing.Common</strong> to allow us to properly <em>resize</em><strong>thumbnail images</strong>.</p><h1>Uploading Files Using A File Manager</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_7028f5f2-416a-4a4e-a990-215cf0549885.png" width="592" height="356"></p><p>The article: <a href="/Blog/tabid/61/EntryId/4368/A-Blazor-Image-File-Manager.aspx">A Blazor Image File Manager</a> provides a starting point for implementing a <strong>File Manager</strong> that allows us to <em>upload</em> images.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_2d8f42c4-db46-43b1-82e2-5510538dec69.png" width="241" height="446"></p><p>The first step is to add a <strong>UploadController.cs</strong> class to the project using the following code:</p><pre><pre><span>using</span> Microsoft.AspNetCore.Authorization;
</pre><pre><span>using</span> Microsoft.AspNetCore.Hosting;
</pre><pre><span>using</span> Microsoft.AspNetCore.Http;
</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc;
</pre><pre><span>using</span> System;
</pre><pre><span>using</span> System.IO;
</pre><pre><span>using</span> System.Linq;
</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre></pre><pre><span>namespace</span> BlazorBlogs
</pre><pre>{
</pre><pre><span>public</span><span>class</span> FileObject
</pre><pre>    {
</pre><pre><span>public</span><span>string</span> FileName { <span>get</span>; <span>set</span>; }
</pre><pre><span>public</span><span>string</span> FilePath { <span>get</span>; <span>set</span>; }
</pre><pre><span>public</span><span>int</span> Height { <span>get</span>; <span>set</span>; }
</pre><pre><span>public</span><span>int</span> Width { <span>get</span>; <span>set</span>; }
</pre><pre><span>public</span><span>int</span> ThumbnailHeight { <span>get</span>; <span>set</span>; }
</pre><pre><span>public</span><span>int</span> ThumbnailWidth { <span>get</span>; <span>set</span>; }
</pre><pre>    }
</pre><pre></pre><pre>    [Route("<span>api/[controller]</span>")]
</pre><pre>    [ApiController]
</pre><pre><span>// to ensure that user must be in the Administrator Role</span></pre><pre>    [Authorize(Roles = "<span>Administrators</span>")]
</pre><pre><span>public</span><span>class</span> UploadController : Controller
</pre><pre>    {
</pre><pre><span>private</span><span>readonly</span> IWebHostEnvironment environment;
</pre><pre><span>public</span> UploadController(IWebHostEnvironment environment)
</pre><pre>        {
</pre><pre><span>this</span>.environment = environment;
</pre><pre>        }
</pre><pre></pre><pre>        [HttpPost("<span>[action]</span>")]
</pre><pre><span>public</span> async Task&lt;IActionResult&gt; MultipleAsync(
</pre><pre>            IFormFile[] files, <span>string</span> CurrentDirectory)
</pre><pre>        {
</pre><pre><span>try</span></pre><pre>            {
</pre><pre><span>if</span> (HttpContext.Request.Form.Files.Any())
</pre><pre>                {
</pre><pre><span>foreach</span> (var file <span>in</span> HttpContext.Request.Form.Files)
</pre><pre>                    {
</pre><pre><span>// reconstruct the path to ensure everything </span></pre><pre><span>// goes to uploads directory</span></pre><pre><span>string</span> RequestedPath = 
</pre><pre>                            CurrentDirectory.ToLower()
</pre><pre>                            .Replace(environment.WebRootPath.ToLower(), "<span></span>");
</pre><pre></pre><pre><span>if</span> (RequestedPath.Contains("<span>\\uploads\\</span>"))
</pre><pre>                        {
</pre><pre>                            RequestedPath = 
</pre><pre>                                RequestedPath.Replace("<span>\\uploads\\</span>", "<span></span>");
</pre><pre>                        }
</pre><pre><span>else</span></pre><pre>                        {
</pre><pre>                            RequestedPath = "<span></span>";
</pre><pre>                        }
</pre><pre></pre><pre><span>string</span> path = 
</pre><pre>                            Path.Combine(
</pre><pre>                                environment.WebRootPath, 
</pre><pre>                                "<span>uploads</span>", 
</pre><pre>                                RequestedPath, 
</pre><pre>                                file.FileName);
</pre><pre></pre><pre><span>using</span> (var stream = 
</pre><pre><span>new</span> FileStream(path, FileMode.Create))
</pre><pre>                        {
</pre><pre>                            await file.CopyToAsync(stream);
</pre><pre>                        }
</pre><pre>                    }
</pre><pre>                }
</pre><pre><span>return</span> StatusCode(200);
</pre><pre>            }
</pre><pre><span>catch</span> (Exception ex)
</pre><pre>            {
</pre><pre><span>return</span> StatusCode(500, ex.Message);
</pre><pre>            }
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_2ff3190f-047d-4bad-af04-c306218b40d2.png" width="254" height="422"></p><p>Next, we add a <strong>FileManager.razor</strong> control using the following code:</p><pre><pre>@<span>using</span> System.IO
</pre><pre>@<span>using</span> System.Drawing;
</pre><pre>@<span>using</span> Radzen
</pre><pre>@<span>using</span> Radzen.Blazor
</pre><pre>@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment HostEnvironment</pre></pre><pre><pre>@if (ShowFileManager)
</pre><pre>{
</pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal"</span><span>tabindex</span>=<span>"-1"</span><span>style</span>=<span>"display:block"</span><span>role</span>=<span>"dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-content"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-header"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>b</span><span>class</span>=<span>"modal-title"</span><span>&gt;</span>Insert Image<span>&lt;/</span><span>b</span><span>&gt;</span></pre><pre><span>&lt;!-- Close Button --&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>type</span>=<span>"button"</span><span>class</span>=<span>"close"</span></pre><pre>                            @<span>onclick</span>=<span>"() =&gt; { ShowFileManager = false; }"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>span</span><span>aria</span>-<span>hidden</span>=<span>"true"</span><span>&gt;</span>X<span>&lt;/</span><span>span</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-body"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"row"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenUpload</span><span>ChooseText</span>=<span>"Upload Files"</span><span>Multiple</span>=<span>"true"</span></pre><pre><span>Accept</span>=<span>"image/*"</span></pre><pre><span>Url</span>=<span>@($</span>"/<span>api</span>/<span>upload</span>/<span>multiple</span>?<span>CurrentDirectory</span>=<span>{CurrentDirectory}</span>")
</pre><pre><span>Style</span>=<span>"margin-bottom: 20px;height: 45px"</span></pre><pre><span>Progress</span>=<span>"@((args) =&gt; OnProgress(args))"</span><span>/&gt;</span></pre><pre></pre><pre><span>&lt;</span><span>RadzenSplitButton</span><span>Click</span>=<span>"(args) =&gt; FolderAction(args)"</span></pre><pre><span>Text</span>=<span>"Folder"</span></pre><pre><span>ButtonStyle</span>=<span>"ButtonStyle.Info"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px;height: 35px"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>ChildContent</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenSplitButtonItem</span><span>Text</span>=<span>"Add Folder"</span><span>Value</span>=<span>"Add"</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>RadzenSplitButtonItem</span><span>Text</span>=<span>"Delete Folder"</span><span>Value</span>=<span>"Delete"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>ChildContent</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>RadzenSplitButton</span><span>&gt;</span></pre><pre></pre><pre><span>&lt;</span><span>RadzenButton</span><span>Disabled</span>=<span>"@(SelectedFile.FileName == null)"</span></pre><pre><span>Text</span>=<span>"Delete"</span></pre><pre><span>Click</span>=<span>"DeleteSelectedFile"</span></pre><pre><span>ButtonStyle</span>=<span>"ButtonStyle.Danger"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px;height: 35px"</span><span>/&gt;</span></pre><pre></pre><pre><span>&lt;</span><span>RadzenButton</span><span>Disabled</span>=<span>"@(SelectedFile.FileName == null)"</span></pre><pre><span>Text</span>=<span>"Select"</span></pre><pre><span>Click</span>=<span>"SelectFile"</span></pre><pre><span>ButtonStyle</span>=<span>"ButtonStyle.Success"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px;height: 35px"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"row"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"col-md-4"</span><span>style</span>=<span>"margin-bottom: 16px"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenTree</span><span>Change</span>=<span>"@LogChange"</span><span>Data</span>=<span>"@Directories"</span></pre><pre><span>Expand</span>=<span>"@LoadDirectory"</span></pre><pre><span>Style</span>=<span>"width: 100%; height: 300px"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenTreeLevel</span><span>Text</span>=<span>"@GetTextForNode"</span></pre><pre><span>Template</span>=<span>"@FileOrFolderTemplate"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>RadzenTree</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"col-md-8"</span><span>style</span>=<span>"margin-bottom: 16px"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenDataList</span> @<span>ref</span>=<span>"FileDataList"</span><span>Data</span>=<span>"@Files"</span></pre><pre><span>AllowPaging</span>=<span>"true"</span><span>TItem</span>=<span>"FileObject"</span></pre><pre><span>WrapItems</span>=<span>"true"</span><span>PageSize</span>=<span>"6"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>Template</span><span>Context</span>=<span>"file"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenImage</span><span>Path</span>=<span>"@file.FilePath"</span></pre><pre><span>Style</span>=<span>"@((file.FileName == SelectedFile.FileName)
</span></pre><pre>                                                          ? $"<span>height</span>:{<span>file</span>.<span>ThumbnailHeight</span>}<span>px</span>;" +
</pre><pre>                                                          $"<span>width</span>:{<span>file</span>.<span>ThumbnailWidth</span>}<span>px</span>;" +
</pre><pre>                                                          $"<span>padding</span>:<span>10px</span>;<span>background</span>-<span>color</span>:<span>darkgrey</span>;"
</pre><pre>                                                          : $"<span>height</span>:{<span>file</span>.<span>ThumbnailHeight</span>}<span>px</span>;" +
</pre><pre>                                                          $"<span>width</span>:{<span>file</span>.<span>ThumbnailWidth</span>}<span>px</span>;" +
</pre><pre>                                                          $"<span>padding</span>:<span>10px</span>;<span>background</span>-<span>color</span>:<span>white</span>;")"
</pre><pre><span>Click</span>=<span>"@((args) =&gt; SelectImage(file))"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>Template</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>RadzenDataList</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre>}
</pre><pre></pre><pre>@if (ShowProgressBarPopup)
</pre><pre>{
</pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal"</span><span>tabindex</span>=<span>"-1"</span><span>style</span>=<span>"display:block"</span><span>role</span>=<span>"dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-dialog modal-sm"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-content"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-header"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>h4</span><span>class</span>=<span>"modal-title"</span><span>&gt;</span>Upload Status<span>&lt;/</span><span>h4</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>align</span>=<span>"center"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenProgressBar</span><span>Value</span>=<span>"@progress"</span></pre><pre><span>Unit</span>=<span>"@info"</span></pre><pre><span>Visible</span>=<span>"@(progress &gt; 0)"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre>}
</pre><pre></pre><pre>@if (ShowFolderPopup)
</pre><pre>{
</pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal"</span><span>tabindex</span>=<span>"-1"</span><span>style</span>=<span>"display:block"</span><span>role</span>=<span>"dialog"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-dialog modal-sm"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-content"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>class</span>=<span>"modal-header"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>h4</span><span>class</span>=<span>"modal-title"</span><span>&gt;</span>New Folder Name<span>&lt;/</span><span>h4</span><span>&gt;</span></pre><pre><span>&lt;</span><span>button</span><span>type</span>=<span>"button"</span><span>class</span>=<span>"close"</span></pre><pre>                            @<span>onclick</span>=<span>"CloseFolderPopup"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>span</span><span>aria</span>-<span>hidden</span>=<span>"true"</span><span>&gt;</span>X<span>&lt;/</span><span>span</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;</span><span>div</span><span>align</span>=<span>"center"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>RadzenTextBox</span><span>Placeholder</span>=<span>"Folder Name"</span></pre><pre>                                   @<span>bind</span>-<span>Value</span>=<span>"NewFolderName"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px"</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>RadzenButton</span><span>Text</span>=<span>"Add Folder"</span></pre><pre><span>Click</span>=<span>"AddFolderName"</span></pre><pre><span>ButtonStyle</span>=<span>"ButtonStyle.Success"</span></pre><pre><span>Style</span>=<span>"margin-bottom: 20px;height: 35px"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre><pre>}</pre></pre><pre><pre><span>@code</span> {
</pre><pre><span>// ImageSelected is an EventCallback that will</span></pre><pre><span>// notify the parent component when an image is selected</span></pre><pre><span>// passing the url of the image to the parent component</span></pre><pre>    [Parameter] <span>public</span> EventCallback&lt;<span>string</span>&gt; ImageSelected { <span>get</span>; <span>set</span>; }
</pre><pre></pre><pre><span>private</span> RadzenDataList&lt;FileObject&gt; FileDataList;
</pre><pre><span>private</span><span>bool</span> ShowFileManager = <span>false</span>;
</pre><pre><span>private</span><span>bool</span> ShowProgressBarPopup = <span>false</span>;
</pre><pre><span>private</span><span>bool</span> ShowFolderPopup = <span>false</span>;
</pre><pre><span>private</span><span>int</span> progress;
</pre><pre><span>private</span><span>string</span> info;
</pre><pre></pre><pre><span>private</span><span>string</span> CurrentDirectory = "<span></span>";
</pre><pre><span>private</span><span>string</span> CurrentRoot = "<span></span>";
</pre><pre><span>private</span><span>string</span> NewFolderName = "<span></span>";
</pre><pre><span>private</span> FileObject SelectedFile = <span>new</span> FileObject();
</pre><pre><span>private</span> List&lt;<span>string</span>&gt; Directories = <span>new</span> List&lt;<span>string</span>&gt;();
</pre><pre><span>private</span> List&lt;FileObject&gt; Files = <span>new</span> List&lt;FileObject&gt;();
</pre><pre><span>private</span> Dictionary&lt;DateTime, <span>string</span>&gt; events =
</pre><pre><span>new</span> Dictionary&lt;DateTime, <span>string</span>&gt;();
</pre><pre></pre><pre><span>protected</span><span>override</span><span>void</span> OnInitialized()
</pre><pre>    {
</pre><pre>        CurrentRoot =
</pre><pre>            Path.Combine(HostEnvironment.WebRootPath, "<span>uploads</span>");
</pre><pre>        CurrentDirectory = CurrentRoot;
</pre><pre>        Directories.Add(CurrentDirectory);
</pre><pre>        LoadFiles();
</pre><pre>    }
</pre><pre></pre><pre><span>public</span><span>void</span> SetShowFileManager(<span>bool</span> paramSetting)
</pre><pre>    {
</pre><pre>        ShowFileManager = paramSetting;
</pre><pre>    }
</pre><pre></pre><pre><span>//SelectFile</span></pre><pre></pre><pre><span>private</span> async Task SelectFile()
</pre><pre>    {
</pre><pre>        await ImageSelected.InvokeAsync(SelectedFile.FilePath);
</pre><pre>    }
</pre><pre></pre><pre><span>// Files</span></pre><pre></pre><pre><span>private</span><span>void</span> SelectImage(FileObject file)
</pre><pre>    {
</pre><pre><span>if</span> (SelectedFile.FileName == file.FileName)
</pre><pre>        {
</pre><pre>            SelectedFile = <span>new</span> FileObject();
</pre><pre>        }
</pre><pre><span>else</span></pre><pre>        {
</pre><pre>            SelectedFile = file;
</pre><pre>        }
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>void</span> LogChange(TreeEventArgs args)
</pre><pre>    {
</pre><pre><span>// Get the current directory from the</span></pre><pre><span>// argument passed to the method</span></pre><pre>        CurrentDirectory = args.Value <span>as</span><span>string</span>;
</pre><pre></pre><pre><span>// Set the RadzenDataList to page 1</span></pre><pre>        FileDataList.FirstPage();
</pre><pre></pre><pre><span>// Reload the FileDataList</span></pre><pre>        LoadFiles();
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>string</span> GetTextForNode(<span>object</span> data)
</pre><pre>    {
</pre><pre><span>return</span> Path.GetFileName((<span>string</span>)data);
</pre><pre>    }
</pre><pre></pre><pre><span>private</span> RenderFragment&lt;RadzenTreeItem&gt;
</pre><pre>        FileOrFolderTemplate = (context) =&gt; builder =&gt;
</pre><pre>        {
</pre><pre><span>string</span> path = context.Value <span>as</span><span>string</span>;
</pre><pre><span>bool</span> isDirectory = Directory.Exists(path);
</pre><pre></pre><pre>            builder.OpenComponent&lt;RadzenIcon&gt;(0);
</pre><pre>            builder.AddAttribute(1,
</pre><pre>                "<span>Icon</span>", isDirectory ? "<span>folder</span>" :
</pre><pre>                "<span>insert_drive_file</span>");
</pre><pre></pre><pre><span>if</span> (!isDirectory)
</pre><pre>            {
</pre><pre>                builder.AddAttribute(2,
</pre><pre>                    "<span>Style</span>",
</pre><pre>                    "<span>margin-left: 24px</span>");
</pre><pre>            }
</pre><pre>            builder.CloseComponent();
</pre><pre>            builder.AddContent(3, context.Text);
</pre><pre>        };
</pre><pre></pre><pre><span>private</span><span>void</span> LoadDirectory(TreeExpandEventArgs args)
</pre><pre>    {
</pre><pre>        CurrentDirectory = args.Value <span>as</span><span>string</span>;
</pre><pre></pre><pre><span>// Only get the folders not the files</span></pre><pre>        args.Children.Data =
</pre><pre>            Directory.EnumerateFileSystemEntries(CurrentDirectory)
</pre><pre>            .Where(x =&gt; !x.Contains("<span>.</span>"));
</pre><pre></pre><pre>        args.Children.Text = GetTextForNode;
</pre><pre>        args.Children.HasChildren =
</pre><pre>            (path) =&gt; Directory.Exists((<span>string</span>)path);
</pre><pre>        args.Children.Template = FileOrFolderTemplate;
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>void</span> LoadFiles()
</pre><pre>    {
</pre><pre>        Files = <span>new</span> List&lt;FileObject&gt;();
</pre><pre>        var FileNames =
</pre><pre>            Directory.EnumerateFileSystemEntries(CurrentDirectory)
</pre><pre>            .Where(x =&gt; x.Contains("<span>.</span>"));
</pre><pre></pre><pre><span>foreach</span> (var item <span>in</span> FileNames)
</pre><pre>        {
</pre><pre><span>using</span> (var image = Image.FromFile(item))
</pre><pre>            {
</pre><pre><span>// Calculate Thumbnail</span></pre><pre><span>int</span> thumbnailHeight = 100;
</pre><pre><span>int</span> thumbnailWidth = 100;
</pre><pre><span>double</span> x = image.Height / 100;
</pre><pre><span>if</span> (x &gt; 0)
</pre><pre>                {
</pre><pre>                    thumbnailHeight = Convert.ToInt32(image.Height / x);
</pre><pre>                    thumbnailWidth = Convert.ToInt32(image.Width / x);
</pre><pre>                }
</pre><pre></pre><pre>                Files.Add(<span>new</span> FileObject()
</pre><pre>                {
</pre><pre>                    FileName =
</pre><pre>                    Path.GetFileName(item),
</pre><pre>                    FilePath =
</pre><pre>                    item.Replace(HostEnvironment.WebRootPath, "<span></span>"),
</pre><pre>                    Height = image.Height,
</pre><pre>                    Width = image.Width,
</pre><pre>                    ThumbnailHeight = Convert.ToInt32(thumbnailHeight),
</pre><pre>                    ThumbnailWidth = Convert.ToInt32(thumbnailWidth)
</pre><pre>                });
</pre><pre>            }
</pre><pre>        }
</pre><pre></pre><pre><span>// Reset selected file</span></pre><pre>        SelectedFile = <span>new</span> FileObject();
</pre><pre></pre><pre><span>// Update UI</span></pre><pre>        StateHasChanged();
</pre><pre>    }
</pre><pre></pre><pre><span>// Uploading</span></pre><pre></pre><pre><span>private</span> async <span>void</span> OnProgress(UploadProgressArgs args)
</pre><pre>    {
</pre><pre>        ShowProgressBarPopup = <span>true</span>;
</pre><pre><span>this</span>.info = $"<span>{args.Loaded} of {args.Total} bytes.</span>";
</pre><pre><span>this</span>.progress = args.Progress;
</pre><pre>        StateHasChanged();
</pre><pre><span>if</span> (args.Loaded == args.Total)
</pre><pre>        {
</pre><pre><span>// Delay to give files time to be saved</span></pre><pre><span>// before reloading file view</span></pre><pre>            await LoadFilesAsync();
</pre><pre>        }
</pre><pre>    }
</pre><pre></pre><pre><span>private</span> async Task LoadFilesAsync()
</pre><pre>    {
</pre><pre><span>int</span> Time = 1;
</pre><pre><span>while</span> (Time &gt; 0)
</pre><pre>        {
</pre><pre>            Time--;
</pre><pre>            StateHasChanged();
</pre><pre>            await Task.Delay(1000);
</pre><pre>        }
</pre><pre>        ShowProgressBarPopup = <span>false</span>;
</pre><pre>        LoadFiles();
</pre><pre>    }
</pre><pre></pre><pre><span>// Deleteing</span></pre><pre></pre><pre><span>private</span><span>void</span> DeleteSelectedFile()
</pre><pre>    {
</pre><pre><span>string</span> RequestedPath = SelectedFile.FilePath;
</pre><pre></pre><pre>        RequestedPath =
</pre><pre>            RequestedPath.Replace("<span>\\uploads\\</span>", "<span>uploads\\</span>");
</pre><pre></pre><pre><span>string</span> path = Path.Combine(
</pre><pre>            HostEnvironment.WebRootPath,
</pre><pre>            RequestedPath);
</pre><pre></pre><pre><span>if</span> (File.Exists(path))
</pre><pre>        {
</pre><pre>            File.Delete(path);
</pre><pre></pre><pre>            LoadFiles();
</pre><pre>        }
</pre><pre>    }
</pre><pre></pre><pre><span>// Folders</span></pre><pre></pre><pre><span>private</span><span>void</span> AddFolder()
</pre><pre>    {
</pre><pre>        ShowFolderPopup = <span>true</span>;
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>void</span> CloseFolderPopup()
</pre><pre>    {
</pre><pre>        ShowFolderPopup = <span>false</span>;
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>void</span> AddFolderName()
</pre><pre>    {
</pre><pre><span>string</span> path = Path.Combine(
</pre><pre>            HostEnvironment.WebRootPath,
</pre><pre>            CurrentDirectory,
</pre><pre>            NewFolderName);
</pre><pre></pre><pre><span>if</span> (!Directory.Exists(path))
</pre><pre>        {
</pre><pre>            Directory.CreateDirectory(path);
</pre><pre>            LoadFiles();
</pre><pre>        }
</pre><pre></pre><pre>        NewFolderName = "<span></span>";
</pre><pre>        ShowFolderPopup = <span>false</span>;
</pre><pre>    }
</pre><pre></pre><pre><span>private</span><span>void</span> FolderAction(RadzenSplitButtonItem item)
</pre><pre>    {
</pre><pre><span>if</span> (item != <span>null</span>)
</pre><pre>        {
</pre><pre><span>if</span> (item.Value == "<span>Add</span>")
</pre><pre>            {
</pre><pre>                ShowFolderPopup = <span>true</span>;
</pre><pre>            }
</pre><pre><span>// Delete</span></pre><pre><span>if</span> (item.Value == "<span>Delete</span>")
</pre><pre>            {
</pre><pre><span>if</span> (CurrentDirectory != CurrentRoot)
</pre><pre>                {
</pre><pre><span>string</span> path = Path.Combine(
</pre><pre>                        HostEnvironment.WebRootPath,
</pre><pre>                        CurrentDirectory);
</pre><pre></pre><pre><span>if</span> (Directory.Exists(path))
</pre><pre>                    {
</pre><pre>                        Directory.Delete(path, <span>true</span>);
</pre><pre></pre><pre>                        CurrentDirectory =
</pre><pre>                            HostEnvironment.WebRootPath;
</pre><pre></pre><pre>                        LoadFiles();
</pre><pre>                    }
</pre><pre>                }
</pre><pre>            }
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_f4df4e8e-f715-4840-a265-53e2685af8b7.png" width="248" height="274"></p><p>To allow the <strong>File Manager</strong> to be opened, we first add a <strong>image icon</strong> to the project.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_b09a0684-4ec0-4545-aee6-ae079e668eb5.png" width="263" height="417"></p><p>Then we open the <strong>BlogAdministration.razor</strong> control and add the <strong>FileManagerControl</strong>:</p><pre><pre><span>&lt;</span><span>FileManager</span> @<span>ref</span>=<span>"FileManagerControl"</span></pre><pre><span>ImageSelected</span>=<span>"InsertImage"</span><span>/&gt;</span></pre></pre><p>This also requires a <em>backing property</em> to be added to the <span>@code</span> section:</p><pre><pre><span>private</span> FileManager FileManagerControl;</pre></pre><p>Also, we need code to respond to the <em><strong>InsertImage</strong></em> event, to <em>insert</em> the <strong>selected image</strong> into the <strong>Rich Text Editor</strong>:</p><pre><pre>    async Task InsertImage(<span>string</span> paramImageURL)
</pre><pre>    {
</pre><pre>        await <span>this</span>.QuillHtml.InsertImage(paramImageURL);
</pre><pre></pre><pre>        FileManagerControl.SetShowFileManager(<span>false</span>);
</pre><pre>    }</pre></pre><p>We also add the following <strong>button</strong> to the <strong>toolbar</strong> of the <strong>Rich Text Editor</strong>:</p><pre><pre><span>&lt;</span><span>button</span><span>class</span>=<span>"btn btn-link"</span><span>id</span>=<span>"custom-button"</span></pre><pre>                    @<span>onclick</span>=<span>"InsertImageClick"</span><span>&gt;</span></pre><pre><span>&lt;</span><span>img</span><span>src</span>=<span>"imageIcon.png"</span><span>style</span>=<span>"border:hidden"</span><span>/&gt;</span></pre><pre><span>&lt;/</span><span>button</span><span>&gt;</span></pre></pre><p>We add a method to show the <strong>File Manager</strong> when that button is clicked:</p><pre><pre><span>private</span><span>void</span> InsertImageClick()
</pre><pre>    {
</pre><pre>        FileManagerControl.SetShowFileManager(<span>true</span>);
</pre><pre>    }</pre></pre><p>Finally, the <strong>File Manager</strong> code expects an <strong><em>uploads</em></strong> directory, so we add that:</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_cde54313-7dac-46a4-8f44-555dd52e3161.png" width="248" height="291"><br></p><h1>Inserting Images</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_bf89a70a-81bf-4be2-924c-01964a851e3d.png" width="569" height="412"></p><p>At this point, we can <em>run</em> the application, log in as an <strong>Administrator</strong>, navigate to the <strong>Blog Administration</strong> page, and <strong>Add</strong> or <strong>Edit</strong> a <strong>Blog</strong> post.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_58add527-475a-4a1b-a160-753eecc655e7.png" width="577" height="399"></p><p>We can <em>click</em> on the <strong>image icon</strong>, on the <strong>Rich Text Editor</strong>, to open the <strong>File Manager</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_3ee2464d-8efa-44a5-aa31-47342b62d758.png" width="483" height="399"></p><p>The <strong>File Manager</strong> allows us to <em>create</em> and <em>edit</em><strong>Folders</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_66dbf2e1-9258-4aae-95a4-5a5c504e2ffb.png" width="479" height="378"></p><p>The <strong>Upload Files</strong> button allows us to <em>upload</em><strong>images</strong> into the <strong>Folders</strong>.</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_eccfc264-b97d-425f-848d-470c6576c899.png" width="511" height="402"></p><p>We can then <em>select</em> any <strong>uploaded image</strong>, and then click the <strong>Select</strong> button…</p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4369/Windows-Live-Writer-7ddaf8701e2d_AA75-image_9595e354-6010-4561-978f-046542313da4.png" width="580" height="431"></p><p>… to insert the <strong>image</strong> into the <strong>editor</strong>.</p><p><em>Clicking</em> on a image allows the image to be <em>resized</em>.</p><h1>Links</h1><p><a href="https://github.com/ADefWebserver/Blazor-Blogs"><span>Blazor-Blogs (GitHub)</span></a></p><p><u><span><a href="/Blog/tabid/61/EntryId/4368/A-Blazor-Image-File-Manager.aspx">A Blazor Image File Manager</a></span></u></p><p><a href="/Blog/tabid/61/EntryId/4365/Creating-Reusable-Custom-Blazor-Controls.aspx"><span>Creating Reusable Custom Blazor Controls</span></a></p><p><a href="/Blog/tabid/61/EntryId/4364/Creating-A-Rich-Text-Editor-In-Blazor-Using-Quill.aspx"><span>Creating A Rich Text Editor In Blazor Using Quill</span></a></p><p><a href="/Blog/tabid/61/EntryId/4355/Radzen-ndash-The-Fastest-Way-To-Build-Blazor-Applications.aspx"><span>Radzen–The Fastest Way To Build Blazor Applications</span></a></p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>