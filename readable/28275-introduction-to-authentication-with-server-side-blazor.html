<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Introduction to Authentication with server-side Blazor -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Introduction to Authentication with server-side Blazor</h1><div><div class="post-content"><h2>Securing Your Blazor Apps (Part 1)</h2><hr><p>This is the first post in the series: Securing Your Blazor Apps. </p><p><strong>Part 1</strong> - Introduction to Authentication with server-side Blazor (this post)<br><strong>Part 2</strong> - <a href="https://chrissainty.com/securing-your-blazor-apps-authentication-with-clientside-blazor-using-webapi-aspnet-core-identity/">Authentication with client-side Blazor using WebAPI and ASP.NET Core Identity</a><br><strong>Part 3</strong> - <a href="https://chrissainty.com/securing-your-blazor-apps-configuring-role-based-authorization-with-client-side-blazor/">Configuring Role-based Authorization with client-side Blazor</a><br><strong>Part 4</strong> - <a href="https://chrissainty.com/securing-your-blazor-apps-configuring-policy-based-authorization-with-blazor/">Configuring Policy-based Authorization with Blazor</a></p><hr><p>Authentication and authorisation are two fundamental functions in most applications today. Until recently, it wasn't very clear how to best achieve these functions in Blazor applications. But with the release of <a href="https://devblogs.microsoft.com/aspnet/asp-net-core-and-blazor-updates-in-net-core-3-0-preview-6/">ASP.NET Core 3 Preview 6</a> that all changed.</p><p>In this post, I'll show you how you can create a new server-side Blazor application with authentication enabled. Then we'll take a high level look at the services and components which are used in the application.</p><h2 id="what-is-the-difference-between-authentication-and-authorisation">What is the difference between authentication and authorisation?</h2><p>Let's start with the difference between authentication and authorisation as this can sometimes be a bit confusing for new developers.</p><blockquote><strong>Authentication </strong>is the process of determining if someone is who they claim to be. </blockquote><p>This can be done in many different ways, but the most common for web applications is a username and password check. Another example of authentication is using your pin code with your debit card at a ATM. </p><p>Whatever the mechanism, authentication verifies you are who you say you are. But what it doesn't do is define what you have <em>access</em> to, that is where authorisation comes in.</p><blockquote><strong>Authorisation </strong>is the process of checking if someone has the rights to access a resource.</blockquote><p>Authorisation occurs after an identity has been established via authentication and determins what parts of a system you can access. For example, if you're have administrator rights on a system you can access everything. But if you're a standard user, you may only be able to access specific screens.</p><h2 id="creating-a-blazor-application-with-authentication">Creating a Blazor application with Authentication</h2><p>We'll get stuck in straight away by creating a new Blazor server-side application with authentication enabled.</p><p>Follow the normal steps for creating a server-side Blazor application.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/create-new-project-step-1.jpg" class="kg-image"></figure><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/10/create-blazor-app.png" class="kg-image"></figure><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/create-new-project-step-3.jpg" class="kg-image"></figure><p>When you hit the project type screen, select Blazor Server App then select the <em>Change</em> link under Authentication.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/create-new-project-step-4.jpg" class="kg-image"></figure><p>From the popup window select <em>Individual User Accounts </em>and then<em> OK.</em></p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/create-new-project-step-5.jpg" class="kg-image"></figure><p>Make sure that Authentication is set to <em>Individual User Accounts</em> then click <em>Create</em>.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/create-new-project-step-6.jpg" class="kg-image"></figure><p>Once the app has been generated press F5 to run it and you should see the following.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/running-app.JPG" class="kg-image"></figure><p>Click the <em>Register</em> link in the top right and fill in your details. Then click <em>Register</em>.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/register.jpg" class="kg-image"></figure><p>You should then be presented with the following screen prompting you to run migrations. This will setup the database which holds the account details. Click the <em>Apply Migrations</em> button, then refresh the page when prompted.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/apply-migrations.jpg" class="kg-image"></figure><p>You should then be redirected back to the home page as an authenticated user. You should see the <em>Register</em> link has been replaced with your email address and a <em>Log out</em> button. </p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/07/loggedinjpg.jpg" class="kg-image"></figure><p>We now have a working Blazor app with authentication, so how is all this achieved? Let's take a look at the various features which enable all this to happen. </p><h2 id="asp-net-core-identity">ASP.NET Core Identity</h2><p>Blazors authentication system is built to work with different configurations including ASP.NET Core Identity. The registration process and login screens aren't Blazor components but razor pages. You won't find them in the project structure either, they are provided by the following call in the <code>Startup.cs</code>.</p><pre><code class="language-csharp">services.AddDefaultIdentity&lt;IdentityUser&gt;()
</code></pre><p>This adds the default identity UI to the application along with the necessary configuration and services. Don't worry, you can override these pages and customise/create your own and we'll cover that in a future post.</p><h2 id="authenticationstateprovider-service">AuthenticationStateProvider Service</h2><p>This service provides the authentication state for the current user and is used by the <code>CascadingAuthenticationState</code> component. The service provides a consistant way of serving this information regardless of whether it is being used in a client-side or server-side Blazor application.</p><p>When used within a server-side application the current user information is hydrated using the <code>HttpContext</code> which established the connection to the server. </p><p>Where as in a client-side application we would have to configure a custom provider which may populate the user information from a API endpoint. We'll cover this in a future post.</p><h2 id="cascadingauthenticationstate-component">CascadingAuthenticationState Component</h2><p>Inside the <code>app.razor</code> you will find the following code.</p><pre><code class="language-html">&lt;CascadingAuthenticationState&gt;
    &lt;Router AppAssembly="typeof(Startup).Assembly"&gt;
        &lt;NotFoundContent&gt;
            &lt;p&gt;Sorry, there's nothing at this address.&lt;/p&gt;
        &lt;/NotFoundContent&gt;
    &lt;/Router&gt;
&lt;/CascadingAuthenticationState&gt;
</code></pre><p>The part we are interested in is the <code>CascadingAuthenticationState</code> component. It's responsible for providing the current authentication state to it's decendent components. </p><p>Currently this value is used by the <code>Router</code> and <code>AuthorizeView</code> components to control access to various parts of the UI.</p><h2 id="authorizeview-component">AuthorizeView Component</h2><p>Inside <code>LoginDisplay.razor</code> we can find an example of the <code>AuthorizeView</code> component.</p><pre><code class="language-html">&lt;AuthorizeView&gt;
    &lt;Authorized&gt;
        &lt;a href="Identity/Account/Manage"&gt;Hello, @context.User.Identity.Name!&lt;/a&gt;
        &lt;a href="Identity/Account/LogOut"&gt;Log out&lt;/a&gt;
    &lt;/Authorized&gt;
    &lt;NotAuthorized&gt;
        &lt;a href="Identity/Account/Register"&gt;Register&lt;/a&gt;
        &lt;a href="Identity/Account/Login"&gt;Log in&lt;/a&gt;
    &lt;/NotAuthorized&gt;
&lt;/AuthorizeView&gt;
</code></pre><p>This component allows us to control what parts of the UI are displayed depending on what the user is <em>authorised</em> to view. By default, if no other policy is applied, then <em>non-authenticated</em> users are treated as <em>not authorised</em>. Logged in users are treated as <em>authorised</em>.</p><p>It also exposes a <code>context</code> parameter which can be used to view the currently logged in users information. As well as the following 3 templates, two of which you can see used in the code snippet above.</p><ul><li><strong>NotAuthorized</strong> - Any content placed in this template will only be shown to non-authorised users.</li><li><strong>Authorizing</strong> - Any content placed in this template will be shown during asyncronous authorisation.</li><li><strong>Authorized</strong> - Any content placed in this template will only be shown to authorised users.</li></ul><h2 id="summary">Summary</h2><p>In this post, I showed you how to create a new server-side Blazor application with authentication. I then talked through some of the services and components used in the application to enable authentication.</p><p>In the next post, I'll dive into client-side Blazor and how to setup authentication using WebAPI and ASP.NET Core Identity.</p><hr><hr></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>