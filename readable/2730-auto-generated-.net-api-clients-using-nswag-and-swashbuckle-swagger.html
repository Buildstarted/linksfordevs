<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Auto Generated .NET API Clients using NSwag and Swashbuckle Swagger -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Auto Generated .NET API Clients using NSwag and Swashbuckle Swagger</h1><div><div class="entry-content"><p>This article shows how auto generated code for a C# HTTP API client could be created using <a href="https://swagger.io/">Swagger </a>and <a href="https://github.com/RSuter/NSwag">NSwag </a>. The API was created using ASP.NET Core MVC. </p><p><strong>Code</strong><a href="https://github.com/damienbod/csvSwaggerExample" rel="nofollow">https://github.com/damienbod/csvSwaggerExample</a></p><p><strong>Create the API using ASP.NET Core and Swashbuckle Swagger</strong></p><p>The API is created using ASP.NET Core with Swashbuckle. Add the required Nuget packages to the project, set the GenerateDocumentationFile element to true and also add the NoWarn element, if all the C# code is not documented. </p><pre class="brush: xml; title: ; notranslate" title="">&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;
  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;netcoreapp2.2&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;

  &lt;PropertyGroup&gt;
    &lt;GenerateDocumentationFile&gt;true&lt;/GenerateDocumentationFile&gt;
    &lt;NoWarn&gt;$(NoWarn);1591&lt;/NoWarn&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Microsoft.AspNetCore.App" /&gt;
    &lt;PackageReference Include="Swashbuckle.AspNetCore" Version="4.0.1" /&gt;
    &lt;PackageReference Include="Swashbuckle.AspNetCore.Swagger" Version="4.0.1" /&gt;
    &lt;PackageReference Include="Swashbuckle.AspNetCore.SwaggerGen" Version="4.0.1" /&gt;
    &lt;PackageReference Include="Swashbuckle.AspNetCore.SwaggerUI" Version="4.0.1" /&gt;
    &lt;PackageReference Include="WebApiContrib.Core.Formatter.Csv" Version="3.0.0" /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;

</pre><p>In the Startup class, add the Swagger configuration in the ConfigureServices method. The AddSwaggerGen extension method uses the XML file for the comments.</p><pre class="brush: csharp; title: ; notranslate" title="">public void ConfigureServices(IServiceCollection services)
{
	services.AddSwaggerGen(c =&gt;
	{
		c.SwaggerDoc("v1", new Info
		{
			Version = "v1",
			Title = "CSV TEST API",
		});

		// comments path
		var xmlFile = $"{Assembly.GetExecutingAssembly().GetName().Name}.xml";
		var xmlPath = Path.Combine(AppContext.BaseDirectory, xmlFile);
		c.IncludeXmlComments(xmlPath);
	});
</pre><p>Use the Swagger middleware to create the UI and the Json file with the API documentation. The UI part is not required for NSwag.</p><pre class="brush: csharp; title: ; notranslate" title="">public void Configure(IApplicationBuilder app, IHostingEnvironment env)
{
	app.UseStaticFiles();
	app.UseMvc();

	app.UseSwagger();
	app.UseSwaggerUI(c =&gt;
	{
		c.SwaggerEndpoint("/swagger/v1/swagger.json", "CSV Test API V1");
	});
}
</pre><p>Add an API as required. Here is a basic example of a CRUD REST API with definitions, which will be picked up by the Swagger documentation.</p><pre class="brush: csharp; title: ; notranslate" title="">using System.Collections.Generic;
using System.Linq;
using System.Net;
using CsvWebApiSwagger.Models;
using Microsoft.AspNetCore.Mvc;

namespace CsvWebApiSwagger.Controllers
{
    /// &lt;summary&gt;
    /// Jobs API for CRUD job 
    /// &lt;/summary&gt;
    [Route("api/[controller]")]
    public class JobsController : Controller
    {
        /// &lt;summary&gt;
        /// Gets all jobs using the API
        /// &lt;/summary&gt;
        /// &lt;returns&gt;Return a list of jobs&lt;/returns&gt;
        [HttpGet]
        [ProducesResponseType(typeof(IEnumerable&lt;Job&gt;), (int)HttpStatusCode.OK)]
        public IActionResult Get()
        {
            return Ok(Jobs);
        }

        /// &lt;summary&gt;
        /// get Job using the id
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;job id&lt;/param&gt;
        /// &lt;returns&gt;Job for the ID&lt;/returns&gt;
        [HttpGet("{id}")]
        [ProducesResponseType(typeof(IEnumerable&lt;Job&gt;), (int)HttpStatusCode.OK)]
        public IActionResult Get(int id)
        {
            if (id == 0)
            {
                return BadRequest();
            }

            var jobExists = Jobs.Exists(j =&gt; j.Id == id);

            if (jobExists == false)
            {
                return NotFound($"Job with Id not found: {id}");
            }

            return Ok(Jobs.First(j =&gt; j.Id == id));
        }

        /// &lt;summary&gt;
        /// Creates a new JOB if the ID does not already exist
        /// &lt;/summary&gt;
        /// &lt;remarks&gt;
        /// Sample create Job:
        ///
        ///     POST api/Jobs
        ///     {
        ///        "id": int id which does not exist,
        ///        "title": "title of the job",
        ///        "description": "Description of the job",
        ///        "level": "level of the job",
        ///        "requirements": "Requirements of the job",
        ///     }
        ///
        /// &lt;/remarks&gt;
        /// &lt;param name="job"&gt;Job to create&lt;/param&gt;
        /// &lt;returns&gt;The created JOB&lt;/returns&gt;
        [HttpPost]
        [ProducesResponseType(typeof(Job), (int)HttpStatusCode.OK)]
        [ProducesResponseType(typeof(Job), (int)HttpStatusCode.Conflict)]
        public IActionResult Post([FromBody]Job job)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest();
            }

            var jobAlreadyExists = Jobs.Exists(j =&gt; j.Id == job.Id);

            if (jobAlreadyExists == true)
            {
                return Conflict($"Job with Id {job.Id} exists");
            }

            Jobs.Add(job);

            return Ok(job);
        }

        /// &lt;summary&gt;
        /// put a string
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;id of a string&lt;/param&gt;
        /// &lt;param name="value"&gt;value of the string&lt;/param&gt;
        [HttpPut("{id}")]
        [ProducesResponseType(typeof(Job), (int)HttpStatusCode.OK)]
        public IActionResult Put(int id, [FromBody]Job value)
        {
            if (id == 0)
            {
                return BadRequest();
            }

            if (!ModelState.IsValid)
            {
                return BadRequest();
            }

            var job = Jobs.First(j =&gt; j.Id == id);
            job.Description = value.Description;
            job.Level = value.Level;
            job.Title = value.Title;
            job.Requirements = value.Requirements;

            return Ok(value);
        }

        /// &lt;summary&gt;
        /// delete the Job if it is found
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;job id&lt;/param&gt;
        [HttpDelete("{id}")]
        [ProducesResponseType((int)HttpStatusCode.OK)]
        [ProducesResponseType((int)HttpStatusCode.NotFound)]
        [ProducesResponseType((int)HttpStatusCode.Conflict)]
        public IActionResult Delete(int id)
        {
            if (id == 0)
            {
                return BadRequest();
            }

            var job = Jobs.First(j =&gt; j.Id == id);

            if (job == null)
            {
                return Conflict($"Job with Id {id} does not exist");
            }

            Jobs.Remove(job);
            return Ok();
        }
    }
}

</pre><p><strong>Creating the API client using NSwag</strong></p><p>NSwag can be used to create a C# class, which implements the client for the API. This can be created using the <a href="https://github.com/RSuter/NSwag/wiki/NSwagStudio">NSwagStudio </a>created by <a href="https://twitter.com/RicoSuter">Rico Suter</a>.</p><p>Download this, install it and open it. Then configure the tool, to read from the API. (Start the API first). Set the namespace to the same as the target project, and save to class where it is required.</p><p><img data-attachment-id="11993" data-permalink="https://damienbod.com/2019/02/13/auto-generated-net-api-clients-using-nswag-and-swashbuckle-swagger/open_api_nswag_01/" data-orig-file="https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png" data-orig-size="1136,888" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="open_api_nswag_01" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=640" src="https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=640&amp;h=500" alt="" width="640" height="500" class="alignnone size-full wp-image-11993" srcset="https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=640&amp;h=500 640w, https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=150&amp;h=117 150w, https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=600&amp;h=469 600w, https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=768&amp;h=600 768w, https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png?w=1024&amp;h=800 1024w, https://damienbod.files.wordpress.com/2019/02/open_api_nswag_01.png 1136w" sizes="(max-width: 640px) 100vw, 640px"></p><p>This generated class can then be used in any application, and for a Console .NET Core application, only the Json Nuget package is required. </p><p>Here is a simple example of the API usage.</p><pre class="brush: csharp; title: ; notranslate" title="">using System;
using System.Net.Http;
using System.Threading.Tasks;

namespace ConsoleApiClient
{
    class Program
    {
        public static void Main(string[] args) =&gt; MainAsync().GetAwaiter().GetResult();

        static async Task MainAsync()
        {
            Console.WriteLine("begin...");

            HttpClient httpClient = new HttpClient();

            var clientCsvWebApiSwagger = new ClientCsvWebApiSwagger(
                "https://localhost:44354/", httpClient);

            var all = await clientCsvWebApiSwagger.GetAllAsync();

            Console.WriteLine($"amount of jobs: {all.Count}");

            Console.WriteLine($"Create job: Id = 2340");

            var job = await clientCsvWebApiSwagger.PostAsync(new Job
            {
                Id = 2340,
                Description = "created using the NSwag generated code",
                Level = "amazing",
                Requirements = "Json nugetg package",
                Title = "NSwag generate"
            });

            all = await clientCsvWebApiSwagger.GetAllAsync();

            Console.WriteLine($"amount of jobs: {all.Count}");
            Console.ReadLine();

        }
    }
}

</pre><p>The NSwag configuration can be saved and commited to the project for reuse later.</p><pre class="brush: jscript; title: ; notranslate" title="">{
  "runtime": "NetCore22",
  "defaultVariables": null,
  "swaggerGenerator": {
    "fromSwagger": {
      "json": "{\r\n  \"swagger\": \"2.0\",\r\n  \"info\": {\r\...}",
      "url": "https://localhost:44354/swagger/v1/swagger.json",
      "output": null
    }
  },
  "codeGenerators": {
    "swaggerToCSharpClient": {
      "clientBaseClass": null,
      "configurationClass": null,
      "generateClientClasses": true,
      "generateClientInterfaces": false,
      "generateDtoTypes": true,
      "injectHttpClient": true,
      "disposeHttpClient": true,
      "protectedMethods": [],
      "generateExceptionClasses": true,
      "exceptionClass": "SwaggerException",
      "wrapDtoExceptions": true,
      "useHttpClientCreationMethod": false,
      "httpClientType": "System.Net.Http.HttpClient",
      "useHttpRequestMessageCreationMethod": false,
      "useBaseUrl": true,
      "generateBaseUrlProperty": true,
      "generateSyncMethods": false,
      "exposeJsonSerializerSettings": false,
      "clientClassAccessModifier": "public",
      "typeAccessModifier": "public",
      "generateContractsOutput": false,
      "contractsNamespace": null,
      "contractsOutputFilePath": null,
      "parameterDateTimeFormat": "s",
      "generateUpdateJsonSerializerSettingsMethod": true,
      "serializeTypeInformation": false,
      "queryNullValue": "",
      "className": "{controller}ClientCsvWebApiSwagger",
      "operationGenerationMode": "MultipleClientsFromOperationId",
      "additionalNamespaceUsages": [],
      "additionalContractNamespaceUsages": [],
      "generateOptionalParameters": false,
      "generateJsonMethods": true,
      "enforceFlagEnums": false,
      "parameterArrayType": "System.Collections.Generic.IEnumerable",
      "parameterDictionaryType": "System.Collections.Generic.IDictionary",
      "responseArrayType": "System.Collections.Generic.ICollection",
      "responseDictionaryType": "System.Collections.Generic.IDictionary",
      "wrapResponses": false,
      "wrapResponseMethods": [],
      "generateResponseClasses": true,
      "responseClass": "SwaggerResponse",
      "namespace": "ConsoleApiClient",
      "requiredPropertiesMustBeDefined": true,
      "dateType": "System.DateTimeOffset",
      "jsonConverters": null,
      "dateTimeType": "System.DateTimeOffset",
      "timeType": "System.TimeSpan",
      "timeSpanType": "System.TimeSpan",
      "arrayType": "System.Collections.Generic.ICollection",
      "arrayInstanceType": "System.Collections.ObjectModel.Collection",
      "dictionaryType": "System.Collections.Generic.IDictionary",
      "dictionaryInstanceType": "System.Collections.Generic.Dictionary",
      "arrayBaseType": "System.Collections.ObjectModel.Collection",
      "dictionaryBaseType": "System.Collections.Generic.Dictionary",
      "classStyle": "Poco",
      "generateDefaultValues": true,
      "generateDataAnnotations": true,
      "excludedTypeNames": [],
      "handleReferences": false,
      "generateImmutableArrayProperties": false,
      "generateImmutableDictionaryProperties": false,
      "jsonSerializerSettingsTransformationMethod": null,
      "inlineNamedDictionaries": false,
      "inlineNamedTuples": true,
      "templateDirectory": null,
      "typeNameGeneratorType": null,
      "propertyNameGeneratorType": null,
      "enumNameGeneratorType": null,
      "serviceHost": null,
      "serviceSchemes": null,
      "output": "ConsoleApiClient/MyApiClient.cs"
    }
  }
}
</pre><p>When the applications are started, the API can be used and no client code, models need to be implemented manually.</p><p><strong>Links</strong></p><p><a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-nswag" rel="nofollow">https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-nswag</a></p><p><a href="https://github.com/RSuter/NSwag" rel="nofollow">https://github.com/RSuter/NSwag</a></p><p><a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle" rel="nofollow">https://docs.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle</a></p><p><a href="https://github.com/RSuter/NSwag/wiki/NSwagStudio" rel="nofollow">https://github.com/RSuter/NSwag/wiki/NSwagStudio</a></p><p><a href="https://swagger.io/" rel="nofollow">https://swagger.io/</a></p><p><a href="https://github.com/dmitry-pavlov/openapi-connected-service" rel="nofollow">https://github.com/dmitry-pavlov/openapi-connected-service</a></p><div id="jp-post-flair" class="sharedaddy sd-like-enabled sd-sharing-enabled"><h3 class="jp-relatedposts-headline"><em>Related</em></h3></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>