<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Add methods to convert between hexadecimal strings and bytes &#xB7; Issue #17837 &#xB7; dotnet/runtime - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Add methods to convert between hexadecimal strings and bytes &#xB7; Issue #17837 &#xB7; dotnet/runtime - linksfor.dev(s)"/>
    <meta property="article:author" content="joshfree"/>
    <meta property="og:description" content="It is quite common to need to convert bytes to hex strings and back. The .NET Framework does not have an API to do that. Look at what lengths people have gone to to solve this problem for them: How..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/corefx/issues/10013"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Add methods to convert between hexadecimal strings and bytes &#xB7; Issue #17837 &#xB7; dotnet/runtime</title>
<div class="readable">
        <h1>Add methods to convert between hexadecimal strings and bytes &#xB7; Issue #17837 &#xB7; dotnet/runtime</h1>
            <div>by joshfree</div>
            <div>Reading time: 22-28 minutes</div>
        <div>Posted here: 20 Jun 2019</div>
        <p><a href="https://github.com/dotnet/corefx/issues/10013">https://github.com/dotnet/corefx/issues/10013</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
  <div>

    
    
  <div data-pjax="">
    
      



  <div id="show_issue" data-channel="issue:558086220:timeline">

    
  <div id="partial-discussion-header" data-channel="issue:558086220" data-url="/dotnet/runtime/issues/17837/show_partial?partial=issues%2Ftitle&amp;sticky=true" data-gid="MDU6SXNzdWU1NTgwODYyMjA=">
  <div>
    <div>
      <div>

          
<details>
  <summary data-ga-click="Issues, create new issue, view:issue_show location:issue_header style:button logged_in:false" role="button">
    
    New issue
  </summary>
  <details-dialog aria-label="Sign up for GitHub" role="dialog" aria-modal="true">
      
    <div>
            

<div>
  <p>
  <strong>Have a question about this project?</strong> Sign up for a free GitHub account to open an issue and contact its maintainers and the community.
  </p>

  <!-- '"` --><!-- </textarea></xmp> -->
  <p>By clicking “Sign up for GitHub”, you agree to our <a href="https://help.github.com/terms" target="_blank">terms of service</a> and
  <a href="https://help.github.com/privacy" target="_blank">privacy statement</a>. We’ll occasionally send you account related emails.</p>

  <p>
    Already on GitHub?
    <a data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;new issue modal&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/dotnet/runtime/issues/17837&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="ea126282e19a1f967119cf61828a6582ed03d03712f9ee583006acdf6f07f632" data-ga-click="(Logged out) New issue modal, clicked Sign in, text:sign-in" href="https://github.com/login?return_to=%2Fdotnet%2Fruntime%2Fissues%2Fnew">Sign in</a>
    to your account
  </p>
</div>

</div>
  </details-dialog>
</details>
        
      </div>

    
    </div>
  </div>

  <div>
    <p><span title="Status: Open">
  
   Open

</span>

    </p>
    <div>
        <p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP">GSPP</a>  opened this issue
</p><relative-time datetime="2016-07-12T15:50:34Z" title="Jul 12, 2016, 8:50 AM PDT">on Jul 12, 2016</relative-time><p>
· 17 comments

  <span data-issue-and-pr-hovercards-enabled="">
    
  </span>

    </p></div>
  </div>


    <div data-original-top="0px">
      <div>
        <div>
          <div>
            <p><span title="Status: Open">
  
   Open

</span>

            </p>
            <div>
              

              <div>
                  <p><a data-hovercard-z-index-override="111" data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP">GSPP</a>  opened this issue
</p><relative-time datetime="2016-07-12T15:50:34Z" title="Jul 12, 2016, 8:50 AM PDT">on Jul 12, 2016</relative-time><p>
· 17 comments

  <span data-issue-and-pr-hovercards-enabled="">
    
  </span>

              </p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
</div>



      <div>
      <div>
        <p><span>Assignees</span></p><p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">
              <img src="https://avatars0.githubusercontent.com/u/1746272?s=40&amp;v=4" width="20" height="20" alt="@GrabYourPitchforks">
</a>        </p>
      </div>

      


      
  </div>


    <h2>Comments</h2>
    <div id="discussion_bucket">
      <div>

  <div>
              <div data-quote-markdown=".js-comment-body" data-issue-and-pr-hovercards-enabled="" data-team-hovercards-enabled="">

            <div data-channel="marked-as-read:issue:558086220">

              
<div data-gid="MDU6SXNzdWU1NTgwODYyMjA=" data-url="/_render_node/MDU6SXNzdWU1NTgwODYyMjA=/issues/body" data-channel="issue:558086220">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP"><img height="40" width="40" alt="@GSPP" src="https://avatars1.githubusercontent.com/u/12032350?s=88&amp;v=4"></a>

</p>


  
<div id="issue-558086220">
  <div data-body-version="3c3fd81f9dbaf1642011a24948f0069c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>It is quite common to need to convert bytes to hex strings and back. The .NET Framework does not have an API to do that. Look at what lengths people have gone to to solve this problem for them: <a href="http://stackoverflow.com/questions/311165/how-do-you-convert-byte-array-to-hexadecimal-string-and-vice-versa" rel="nofollow">How do you convert Byte Array to Hexadecimal String, and vice versa?</a> Many of those solutions are somehow bad (e.g. slow or broken or not validating).</p>
<p><code>BitConverter.ToString(byte[])</code> generates strings of a practically useless format: <code>BitConverter.ToString(new byte[] { 0x00, 0x01, 0xAA, 0xFF })</code> =&gt; <code>00-01-AA-FF</code>. I don't understand how this decision was made. This seems to be a special solution for some specific purpose (debug output?). Using this API requires <code>Replace(str, "-", "")</code> which is ugly and slow. Also, this API is not discoverable because it does not have "hex" in it's name.</p>
<p>I propose adding an API that does the following:</p>
<ul>
<li>Supports char[] and string</li>
<li>Supports specifying the output buffer to support zero-allocation scenarios</li>
<li>Supports upper- and lowercase</li>
<li>Fast (probably, this means working in-place using unsafe code)</li>
<li>Validates input</li>
<li><em>No</em> support for any kind of hex prefix (such as "0x"), whitespace or digit separator (such as "-" or "\n"). This is out of scope.</li>
</ul>
<p>The use case for char[] in- and outputs is low-allocation scenarios.</p>
<p>The API could look like this:</p>
<div><pre><span>static</span> <span>class</span> <span>HexConvert</span> {
 <span>byte</span>[] <span>ToBytes</span>(<span>string</span> <span>input</span>, <span>int</span> <span>start</span>, <span>int</span> <span>count</span>, <span>HexFormat</span> <span>hexFormat</span>);
 <span>void</span> <span>ToBytes</span>(<span>string</span> <span>input</span>, <span>int</span> <span>start</span>, <span>int</span> <span>count</span>, <span>ArraySegment</span>&lt;<span>byte</span>&gt; <span>outputBuffer</span>, <span>HexFormat</span> <span>hexFormat</span>);
 <span><span>//</span>Repeat the same for ArraySegment&lt;char&gt; as input</span>

 <span>string</span> <span>ToString</span>(<span>ArraySegment</span>&lt;<span>byte</span>&gt; <span>bytes</span>);
 <span>char</span>[] <span>ToChars</span>(<span>ArraySegment</span>&lt;<span>byte</span>&gt; <span>bytes</span>);
 <span>void</span> <span>ToChars</span>(<span>ArraySegment</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>ArraySegment</span>&lt;<span>char</span>&gt; <span>outputBuffer</span>);

 <span><span>//</span>Plus obvious convenience overloads</span>

 <span>int</span> <span>HexDigitToInteger</span>(<span>char</span> <span>val</span>); <span><span>//</span>0-9A-F =&gt; 0-15.</span>
 <span>char</span> <span>IntegerToHexDigit</span>(<span>int</span> <span>value</span>, <span>HexFormat</span> <span>hexFormat</span>); <span><span>//</span>0-15 =&gt; 0-9A-F</span>
}

[<span>Flags</span>]
<span>enum</span> <span>HexFormat</span> { <span>UseDefaults</span> <span>=</span> <span>0</span>, <span>Lowercase</span> <span>=</span> <span>1</span> } <span><span>//</span>extensible</span></pre></div>
<p>A possible extension would be to support <code>Stream</code> and <code>IEnumerable&lt;byte&gt;</code> as sources and destinations. I would consider this out of scope.</p>
<p>I feel that converting hexadecimal strings is an important and frequent enough thing that this should be supported well. Of course, a "light" version of this proposal is also feasible (just support for string and byte[] with no user-provided output buffer). Not sure if anyone wants/needs lowercase hex, I don't but others might.</p>
<p>This seems cheap enough to implement. Testing should be easily automatable. I don't see any particular usability problems. This is suitable for community contribution.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>

</div>


              

  


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDIzMjEwOTczMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDIzMjEwOTczMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDIzMjEwOTczMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/joshfree/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/joshfree"><img height="40" width="40" alt="@joshfree" src="https://avatars1.githubusercontent.com/u/1302850?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-232109730">
    <div>
      

  

<details data-body-version="a514d65299c5db13da570d2353e83c6a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDIzMjE3MjkwMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDIzMjE3MjkwMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDIzMjE3MjkwMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/juliusfriedman/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/juliusfriedman"><img height="40" width="40" alt="@juliusfriedman" src="https://avatars0.githubusercontent.com/u/7851618?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-232172902">
    <div>
      

  

<details data-body-version="10a8f5f53e59864de57a98ef531cf3e4">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="10a8f5f53e59864de57a98ef531cf3e4" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Replacement is not the ONLY way, you can just skip the char if you need to.</p>
<pre><code>///Could easily allow upper or lower case here...   
[System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.AggressiveInlining)]
public static byte HexCharToByte(char c, bool upperCase = false) { c = char.ToUpperInvariant(c); return (byte)(upperCase ? char.ToUpperInvariant((char)(c &gt; '9' ? c - 'A' + 10 : c - '0')) : (c &gt; '9' ? c - 'A' + 10 : c - '0')); }

        /// &lt;summary&gt;
        /// Converts a String in the form 0011AABB to a Byte[] using the chars in the string as bytes to caulcate the decimal value.
        /// &lt;/summary&gt;
        /// &lt;notes&gt;
        /// Reduced string allocations from managed version substring
        /// About 10 milliseconds faster then Managed when doing it 100,000 times. otherwise no change
        /// &lt;/notes&gt;
        /// &lt;param name="str"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static byte[] HexStringToBytes(string str, int start = 0, int length = -1)
        {
            if (length.Equals(Common.Binary.Zero)) return null;

            if (length &lt;= -1) length = str.Length;

            if (start &gt; length - start) throw new System.ArgumentOutOfRangeException("start");

            if (length &gt; length - start) throw new System.ArgumentOutOfRangeException("length");

            System.Collections.Generic.List&lt;byte&gt; result = new System.Collections.Generic.List&lt;byte&gt;(length &gt;&gt; 1); // / 2

            //Dont check the results for overflow
            unchecked
            {
                //Iterate the pointer using the managed length ....
                //Todo, optomize with reverse or i - 1
                for (int i = start, e = length; i &lt; e; i += 2)
                {
                    //to reduce string manipulations pre call
                    if(str[i] == '-') ++i;

                    //Todo, Native and Unsafe
                    //Convert 2 Chars to a byte
                    result.Add((byte)(HexCharToByte(str[i]) &lt;&lt; 4 | HexCharToByte(str[i + 1])));
                }
            }

            //Dont use a List..

            //Return the bytes
            return result.ToArray();
        }

</code></pre>
<p>I agree that the format is useless in MOST cases...</p>
<p>However if you think about it a little more and try to be as outside the box as possible you will clearly see that there is an extra index for every octet, finally then you can achieve some interesting things by realigning the data or using the extra indexes....</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjY1Mjc1NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjY1Mjc1NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDI2MjY1Mjc1NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/AlexGhiondea/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexGhiondea"><img height="40" width="40" alt="@AlexGhiondea" src="https://avatars1.githubusercontent.com/u/8396979?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-262652755">
    <div>
      

  

<details data-body-version="d2e5c3af8f4f10c7ad382d57353cca4b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d2e5c3af8f4f10c7ad382d57353cca4b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP">@GSPP</a> how about augmenting the BitConverter type with these new methods?</p>
<p>I feel like that would be a better place for these since that is already a type people use for converting between various formats.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjY2MDMxMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjY2MDMxMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDI2MjY2MDMxMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/AlexGhiondea/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexGhiondea"><img height="40" width="40" alt="@AlexGhiondea" src="https://avatars1.githubusercontent.com/u/8396979?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-262660310">
    <div>
      

  

<details data-body-version="f7ac6c0a2efa79b2c816419b7425eaf2">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjgyMDY3OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjgyMDY3OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDI2MjgyMDY3OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/CodesInChaos/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/CodesInChaos"><img height="40" width="40" alt="@CodesInChaos" src="https://avatars2.githubusercontent.com/u/320473?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-262820679">
    <div>
      

  

<details data-body-version="c0c21a870d2593430e7d87bf8d7e924a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c0c21a870d2593430e7d87bf8d7e924a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>If the slices API lands before this, I'd go with something like:</p>
<div><pre><span><span>//</span> all instance methods are thread-safe</span>
<span>public</span> <span>abstract</span> <span>class</span> <span>BinaryEncoding</span>
{
	<span>protected</span> <span>abstract</span> <span>void</span> <span>ToBytesOverride</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>sourceChars</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>destinationBytes</span>);
	<span>protected</span> <span>abstract</span> <span>int</span> <span>GetByteLengthOverride</span>(<span>int</span> <span>stringLength</span>);
	<span>protected</span> <span>abstract</span> <span>void</span> <span>ToCharsOverride</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>sourceBytes</span>, <span>Span</span>&lt;<span>char</span>&gt; <span>destinationChars</span>);
	<span>protected</span> <span>abstract</span> <span>int</span> <span>GetStringLengthOverride</span>(<span>int</span> <span>byteLength</span>);

	<span>public</span> <span>byte</span>[] <span>ToBytes</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>str</span>);
	<span>public</span> <span>void</span> <span>ToBytes</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>sourceChars</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>destinationBytes</span>);
	<span>public</span> <span>int</span> <span>GetByteLength</span>(<span>int</span> <span>stringLength</span>);
	
	<span>public</span> <span>string</span> <span>ToString</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>);
	<span>public</span> <span>char</span>[] <span>ToChars</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>);
	<span>public</span> <span>void</span> <span>ToChars</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>sourceBytes</span>, <span>Span</span>&lt;<span>char</span>&gt; <span>destinationChars</span>);
	<span>public</span> <span>int</span> <span>GetStringLength</span>(<span>int</span> <span>byteLength</span>);
}

<span>public</span> <span>class</span> <span>HexEncoding</span>
{
	<span>public</span> <span>static</span> <span>HexEncoding</span> <span>UpperCase</span> { <span>get</span>; }
	<span>public</span> <span>static</span> <span>HexEncoding</span> <span>LowerCase</span> { <span>get</span>; }
}</pre></div>
<p>perhaps add some additional overloads with <code>byte[]</code>, <code>char[]</code>, <code>string</code> inputs.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjgyODY5MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDI2MjgyODY5MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDI2MjgyODY5MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/karelz/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/karelz"><img height="40" width="40" alt="@karelz" src="https://avatars0.githubusercontent.com/u/5776068?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-262828691">
    <div>
      

  

<details data-body-version="c0efa130dac1b0e687c1059c0efacd92">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c0efa130dac1b0e687c1059c0efacd92" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>We don't take any new API additions if they would be obsolete when <code>Span</code> lands.<br>
Marking as blocked on <code>Span</code> dotnet/corefx#13892 - <a data-hovercard-type="user" data-hovercard-url="/users/AlexGhiondea/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexGhiondea">@AlexGhiondea</a> feel free to change it if you think I am wrong.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQxMjMzMDg0Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQxMjMzMDg0Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQxMjMzMDg0Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP"><img height="40" width="40" alt="@GSPP" src="https://avatars1.githubusercontent.com/u/12032350?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-412330842">
    <div>
      

  

<details data-body-version="8b71aefaccb28587f26817fc50c6e33b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8b71aefaccb28587f26817fc50c6e33b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Span has landed so this can be unblocked.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQxOTMyMQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQxOTMyMQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2MzQxOTMyMQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-463419321">
    <div>
      

  

<details data-body-version="292c46ba7edf51e6fd8ba5089c5f2c46">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="292c46ba7edf51e6fd8ba5089c5f2c46" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I propose a slightly different API, instead putting this on the <code>Convert</code> class near the existing base64 APIs. That would help discoverability, and it gives us an existing template for the recommended API shape.</p>
<div><pre><span>namespace</span> <span>System</span>
{
    <span><span>//</span> NEW methods on EXISTING type</span>
    <span>public</span> <span>static</span> <span>class</span> <span>Convert</span>
    {
        <span>public</span> <span>static</span> <span>byte</span>[] <span>FromHexString</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>chars</span>); <span><span>//</span> doesn't match an existing overload of FromBase64String, but could be useful</span>
        <span>public</span> <span>static</span> <span>byte</span>[] <span>FromHexString</span>(<span>string</span> <span>s</span>);

        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>byte</span>[] <span>inArray</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>);
        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>byte</span>[] <span>inArray</span>, <span>int</span> <span>offset</span>, <span>int</span> <span>length</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>);
        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>);
    }

    [<span>Flags</span>]
    <span>public</span> <span>enum</span> <span>HexFormattingOptions</span>
    {
        <span>None</span> <span>=</span> <span>0</span>,
        <span>InsertLineBreaks</span> <span>=</span> <span>1</span>,
        <span>Lowercase</span> <span>=</span> <span>2</span>,
    }
}</pre></div>
<p>It also makes sense IMO to have <code>OperationStatus</code>-based APIs. Those APIs could be done in the corefxlab repo to live alongside the existing <code>Base64Encoder</code> and <code>Base64Decoder</code> types in that repo. Then all of the <code>OperationStatus</code>-based base64 and hex APIs can be reviewed at once if we decide to move them into corefx.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQ1MjA4OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQ1MjA4OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2MzQ1MjA4OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/vcsjones/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vcsjones"><img height="40" width="40" alt="@vcsjones" src="https://avatars1.githubusercontent.com/u/361677?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-463452088">
    <div>
      

  

<details data-body-version="ddc85eb8de83dd3d8a74dc9bec2f9600">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="ddc85eb8de83dd3d8a74dc9bec2f9600" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>To give some parity with the <code>*CharArray</code> from base64, I would consider a few other methods:</p>
<div><pre><span>public</span> <span>static</span> <span>class</span> <span>Convert</span>
{
    <span>public</span> <span>bool</span> <span>TryFromHexString</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>chars</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>buffer</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>);
    <span>public</span> <span>bool</span> <span>TryFromHexString</span>(<span>string</span> <span>s</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>buffer</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>);
    <span>public</span> <span>bool</span> <span>TryToHexString</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>Span</span>&lt;<span>char</span>&gt; <span>buffer</span>, <span>out</span> <span>int</span> <span>charsWritten</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>);
}</pre></div>
<p>The rationale for this is in my typical usage I expect a hex string to be short (think a SHA digest) which tops out at 64 bytes right now.</p>
<p>I'm not strongly tied to these, but worth considering during review.</p>
<hr>
<p>Other considerations, does there need to be an options for  the <code>FromHexString</code> that provide similar functionality like specifying if the input is expected to be upper or lower, or would the input be treated case insensitive?</p>
<p>What about continuing from line breaks?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQ5MjYzMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzQ5MjYzMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2MzQ5MjYzMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-463492630">
    <div>
      

  

<details data-body-version="173cde0eb5f5e9811eed7a8375293f2b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="173cde0eb5f5e9811eed7a8375293f2b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/vcsjones/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vcsjones">@vcsjones</a> I envision <code>HexFormattingOptions.InsertLineBreaks</code> as inserting every 72 chars, just like base64 does today. And parsing would allow all of uppercase / lowercase / whitespace, hence no options parameter.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzY3OTY4MA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2MzY3OTY4MA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2MzY3OTY4MA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP"><img height="40" width="40" alt="@GSPP" src="https://avatars1.githubusercontent.com/u/12032350?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-463679680">
    <div>
      

  

<details data-body-version="30517319c2648b5dc3d61f2f62bb4f41">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="30517319c2648b5dc3d61f2f62bb4f41" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I'd <em>not</em> put it on <code>Convert</code>. My argument for that is this: Imagine there were 10 different such formats (Hex, base64, base85, ...). Then, we clearly would like each of them to be their own static class. Anything else would make for a very crowded API. Now we don't have 10 formats but from this thought experiment we can see that creating a separate class is the better option. Especially, since more formats might be added in the future. For example, Bitcoin uses a base85 format which is more efficient. Who knows if additional formats might be desirable in the future.</p>
<p>Should this API accept any other input besides spans? It could accept arrays, strings, <code>ArraySegment</code> and even pointers. In my opinion it should <em>only</em> take spans. That would make for the cleanest and least crowded API. Anything else is easily converted to span. In particular I don't want to see overloads with index and count parameters. Thank god we no longer need those!</p>
<p>We certainly need methods that do not throw in the error case. My original proposal missed those.</p>
<blockquote>
<p><code>InsertLineBreaks</code> as inserting every 72 chars</p>
</blockquote>
<p>Is this a widely known standard format? Is it only for base64 or also for hex?</p>
<hr>
<p>New API proposal:</p>
<pre><code>namespace System
{
    public static class HexConvert
    {
        //convert to bytes, throwing
        public static byte[] GetBytes(ReadOnlySpan&lt;char&gt; chars, HexFormattingOptions formattingOptions = default);
        public static void GetBytes(ReadOnlySpan&lt;char&gt; chars, Span&lt;byte&gt; output, out int bytesWritten, HexFormattingOptions formattingOptions = default);

        //convert to bytes, try
        public static byte[] TryGetBytes(ReadOnlySpan&lt;char&gt; chars, HexFormattingOptions formattingOptions = default); //can return null
        public static bool TryGetBytes(ReadOnlySpan&lt;char&gt; chars, Span&lt;byte&gt; output, out int bytesWritten, HexFormattingOptions formattingOptions = default);

         //convert to chars
         string GetString(ReadOnlySpan&lt;byte&gt; bytes);
         char[] GetChars(ReadOnlySpan&lt;byte&gt; bytes);

         //plus non-throwing overloads
         //plus overloads with output buffer
         //plus overloads without HexFormattingOptions (I was lazy so I made them default arguments)
    }

    [Flags]
    public enum HexFormattingOptions
    {
        None = 0,
        Lowercase = 1,
    }
}
</code></pre>
<p>I chose the name prefix to be "Get" so that "TryGet" is fitting. This succinct naming would not be possible when placing these methods in <code>Convert</code>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2NDQ4MDA0Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2NDQ4MDA0Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2NDQ4MDA0Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/AlexeiScherbakov/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexeiScherbakov"><img height="40" width="40" alt="@AlexeiScherbakov" src="https://avatars3.githubusercontent.com/u/8665915?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-464480043">
    <div>
      

  

<details data-body-version="f86fc13cafbb0f04d726ae449ce7d9da">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="f86fc13cafbb0f04d726ae449ce7d9da" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>There are many variants of API. It can be used in web,cryptography and many other places. Some hex conversion is used in json for writing non-ASCII chars - \u0000 - \uFFFF</p>
<p>I think that .NET Core must provide optimized variants for each purpose</p>
<p><strong>Writing API</strong></p>
<ol>
<li>It can be uppercase/lowercase</li>
<li>It can use separators or not use</li>
<li>Separators can be single char or multi (char[] or string)</li>
<li>It can create new instance of string and char[] or use Span, StringBuilder, TextWriter or Stream  as output</li>
<li>Source can be Span or types like,(s)byte,(u)short,char,(u)int,(u)long</li>
<li>If source is Span function can take entire span or it part (for direct byte[] calls)</li>
</ol>
<p>All above give us more than 100 function declarations. If it will have byte[] inputs - it take much more</p>
<p>For example just writing API for ReadOnlySpan as source, with all kinds of separators, and only lowercase give us 6 optimized variants</p>
<pre><code>public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array);
public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array, char separator);
public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array, ReadOnlySpan&lt;char&gt; separator);
public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array, int offset, int count);
public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array, int offset, int count, char separator);
public static string ToHexStringLowerCase(this ReadOnlySpan&lt;byte&gt; array, int offset, int count, ReadOnlySpan&lt;char&gt; separator);
</code></pre>
<p>This is bad idea to place it in existing places, I think, that better to place this API in external netcoreapp2.1+netstandard2.1 package. Something like System.Text.Hex</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2NDQ4MTM5Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ2NDQ4MTM5Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ2NDQ4MTM5Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/AlexeiScherbakov/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexeiScherbakov"><img height="40" width="40" alt="@AlexeiScherbakov" src="https://avatars3.githubusercontent.com/u/8665915?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-464481397">
    <div>
      

  

<details data-body-version="d822c7126c1fa92c1ad14362f664eed8">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d822c7126c1fa92c1ad14362f664eed8" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Also, as <a data-hovercard-type="user" data-hovercard-url="/users/vcsjones/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vcsjones">@vcsjones</a> mentioned for short strings, we need some different allocation mechanism, to avoid dirty hacks for reducing allocations count: (<a rel="nofollow" href="https://docs.microsoft.com/en-us/dotnet/csharp/how-to/modify-string-contents#unsafe-modifications-to-string">https://docs.microsoft.com/en-us/dotnet/csharp/how-to/modify-string-contents#unsafe-modifications-to-string</a>)</p>
<pre><code>public static unsafe string ToHexStringLowerCase(this byte[] array)
{
	string ret = new string('\0', array.Length * 2);
	
	fixed(char* strPtr=ret)
	{
		char* ptr = strPtr;
		for (int i = 0; i &lt; array.Length; i++)
		{
			byte bytic = array[i];
			*ptr = HexChars.HexDigitsLowerCase[(bytic &gt;&gt; 4) &amp; 0xF];
			ptr++;
			*ptr = HexChars.HexDigitsLowerCase[bytic &amp; 0xF];
			ptr++;
		}
	}
	return ret;
}
</code></pre>
<p>For example in this case we can allocate string memory (x2 of byte array length) and write to it, without copy contructor.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTExMjMxMQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTExMjMxMQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUxMTExMjMxMQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tkp1n/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tkp1n"><img height="40" width="40" alt="@tkp1n" src="https://avatars2.githubusercontent.com/u/9985284?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-511112311">
    <div>
      

  

<details data-body-version="ad6260162ee104b62dd9f2fb376e5864">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="ad6260162ee104b62dd9f2fb376e5864" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I consolidated the different proposals and comments made in this discussion and came up with the following API. I also provide a sample implementation (internally utilizing AVX2, SSE4.1, SSSE3, SSE2 or Scalar/Lookup with the following <a href="https://github.com/tkp1n/HexMate#performance-characteristics">performance characteristics</a>) of the API to experiment with via a seperate GitHub repository and nuget package.</p>
<h4>Sample implementation to play arround with</h4>
<p><a href="https://github.com/tkp1n/HexMate">https://github.com/tkp1n/HexMate</a><br>
<a rel="nofollow" href="https://www.nuget.org/packages/HexMate">https://www.nuget.org/packages/HexMate</a></p>
<h4>Adressed proposals and comments:</h4>
<ul>
<li>Parity with base64 APIs on <code>System.Convert</code> (<a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-463419321">https://github.com/dotnet/corefx/issues/10013#issuecomment-463419321</a> and <a data-hovercard-type="user" data-hovercard-url="/users/vcsjones/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vcsjones">@vcsjones</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-463452088">https://github.com/dotnet/corefx/issues/10013#issuecomment-463452088</a>)</li>
<li><code>OperationStatus</code>-based APIs as currently in <code>System.Buffers.Text.Base64</code> (<a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-463419321">https://github.com/dotnet/corefx/issues/10013#issuecomment-463419321</a>)</li>
<li>Allocation-free or -friendly implementation is possible (see repo above, <a data-hovercard-type="user" data-hovercard-url="/users/AlexeiScherbakov/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexeiScherbakov">@AlexeiScherbakov</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-464481397">https://github.com/dotnet/corefx/issues/10013#issuecomment-464481397</a>)</li>
</ul>
<h4>Open questions:</h4>
<ul>
<li>Would it make sense to add APIs where one could choose a separator at the cost of additional overloads and deviating from base64 API parity? (<a data-hovercard-type="user" data-hovercard-url="/users/AlexeiScherbakov/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlexeiScherbakov">@AlexeiScherbakov</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-464480043">https://github.com/dotnet/corefx/issues/10013#issuecomment-464480043</a>)</li>
<li>Why should <code>InsertLineBreaks</code> add a new-line every 72 characters for hex but <a href="https://github.com/dotnet/corefx/blob/4ddf96fe04a6befe8814651a9933258379e3f4f4/src/Common/src/CoreLib/System/Convert.cs#L136">every 76 for base64</a>? (<a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>, <a href="https://github.com/dotnet/corefx/issues/10013#issuecomment-463492630">https://github.com/dotnet/corefx/issues/10013#issuecomment-463492630</a>)</li>
<li>Should the parsing routines accept <code>-</code>-separated input to allow processing strings returned by <code>BitConverter.ToString(byte[])</code>?</li>
<li>Would <code>GetMaxDecodedFromUtf8Length</code> and <code>GetMaxEncodedToUtf8Length</code> make sense for <code>Hex</code> as the calculation is much simpler as with base64 where those methods are provided?</li>
</ul>
<h3>API proposal</h3>
<div><pre><span>namespace</span> <span>System</span>
{
    <span><span>//</span> NEW type</span>
    [<span>Flags</span>]
    <span>public</span> <span>enum</span> <span>HexFormattingOptions</span>
    {
        <span>None</span> <span>=</span> <span>0</span>,
        <span>InsertLineBreaks</span> <span>=</span> <span>1</span>,
        <span>Lowercase</span> <span>=</span> <span>2</span>
    }

    <span><span>//</span> NEW methods on EXISTING type</span>
    <span>public</span> <span>static</span> <span>class</span> <span>Convert</span>
    {
        <span><span>//</span> Decode from chars</span>
        <span>public</span> <span>static</span> <span>byte</span>[] <span>FromHexCharArray</span>(<span>char</span>[] <span>inArray</span>, <span>int</span> <span>offset</span>, <span>int</span> <span>length</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>bool</span> <span>TryFromHexChars</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>chars</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;

        <span><span>//</span> Decode from strings</span>
        <span>public</span> <span>static</span> <span>byte</span>[] <span>FromHexString</span>(<span>string</span> <span>s</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>byte</span>[] <span>FromHexString</span>(<span>ReadOnlySpan</span>&lt;<span>char</span>&gt; <span>chars</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>bool</span> <span>TryFromHexString</span>(<span>string</span> <span>s</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;

        <span><span>//</span> Encode to chars</span>
        <span>public</span> <span>static</span> <span>int</span> <span>ToHexCharArray</span>(<span>byte</span>[] <span>inArray</span>, <span>int</span> <span>offsetIn</span>, <span>int</span> <span>length</span>, <span>char</span>[] <span>outArray</span>, <span>int</span> <span>offsetOut</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>bool</span> <span>TryToHexChars</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>Span</span>&lt;<span>char</span>&gt; <span>chars</span>, <span>out</span> <span>int</span> <span>charsWritten</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;

        <span><span>//</span> Encode to strings</span>
        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>byte</span>[] <span>inArray</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>byte</span>[] <span>inArray</span>, <span>int</span> <span>offset</span>, <span>int</span> <span>length</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>string</span> <span>ToHexString</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>HexFormattingOptions</span> <span>options</span> <span>=</span> <span>default</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
    }
}

<span>namespace</span> <span>System</span>.<span>Buffers</span>.<span>Text</span>
{
    <span><span>//</span> NEW type</span>
    <span>public</span> <span>static</span> <span>class</span> <span>Hex</span>
    {
        <span><span>//</span> Decode</span>
        <span>public</span> <span>static</span> <span>OperationStatus</span> <span>DecodeFromUtf8</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>utf8</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>out</span> <span>int</span> <span>bytesConsumed</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>, <span>bool</span> <span>isFinalBlock</span> <span>=</span> <span>true</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>OperationStatus</span> <span>DecodeFromUtf8InPlace</span>(<span>Span</span>&lt;<span>byte</span>&gt; <span>buffer</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        
        <span><span>//</span> Encode</span>
        <span>public</span> <span>static</span> <span>OperationStatus</span> <span>EncodeToUtf8</span>(<span>ReadOnlySpan</span>&lt;<span>byte</span>&gt; <span>bytes</span>, <span>Span</span>&lt;<span>byte</span>&gt; <span>utf8</span>, <span>out</span> <span>int</span> <span>bytesConsumed</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>, <span>bool</span> <span>isFinalBlock</span> <span>=</span> <span>true</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
        <span>public</span> <span>static</span> <span>OperationStatus</span> <span>EncodeToUtf8InPlace</span>(<span>Span</span>&lt;<span>byte</span>&gt; <span>buffer</span>, <span>int</span> <span>dataLength</span>, <span>out</span> <span>int</span> <span>bytesWritten</span>) <span>=&gt;</span> <span>throw</span> <span>null</span>;
    }
}</pre></div>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTEyODMzNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTEyODMzNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUxMTEyODMzNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GSPP/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GSPP"><img height="40" width="40" alt="@GSPP" src="https://avatars1.githubusercontent.com/u/12032350?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-511128335">
    <div>
      

  

<details data-body-version="69788da006aadcb3a1e9dbbfe6a77615">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="69788da006aadcb3a1e9dbbfe6a77615" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I think we should demonstrate a need for inserting line breaks first. I am not aware of any common scenario where this would be used. If this feature is added then the line length must be variable. I cannot imagine any fixed line length to be appropriate.</p>
<p>What are the intended use cases?</p>
<blockquote>
<p>Should the parsing routines accept --separated input</p>
</blockquote>
<p>By default, the parsing routines should be maximally strict. This means <em>no</em> support for whitespace or any separator. When we parse data we generally want to be as strict as possible in order to find bugs in the originating systems and in order to not accidentally accept invalid data. The motto <code>be strict in what you produce and liberal in what you accept</code> is false. It has lead to the mess that is web development. The correct approach is to be as strict as possible and relax only if required.</p>
<p>Parsing should accept any case of the letters <code>A-F</code>, though. I see no good alternative to that.</p>
<p>I see no need for supporting a separator. This is a rare need. An easy workaround exists at a performance cost: <code>str.Replace("-", "")</code>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUyMzEzMzgyOA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUyMzEzMzgyOA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUyMzEzMzgyOA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/terrajobst/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/terrajobst"><img height="40" width="40" alt="@terrajobst" src="https://avatars0.githubusercontent.com/u/5169960?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-523133828">
    <div>
      

  

<details data-body-version="93e1f48df716a03bc8c4f8fb497d3b95">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="93e1f48df716a03bc8c4f8fb497d3b95" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>, it seems we should survey what internal implementations we have and what all the places are where we expose something similar. It seems new proposals were added after you marked it as read for review.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU2MjE5MzAwMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU2MjE5MzAwMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU2MjE5MzAwMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/bugproof/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/bugproof"><img height="40" width="40" alt="@bugproof" src="https://avatars3.githubusercontent.com/u/3116731?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-562193003">
    <div>
      

  

<details data-body-version="6ad4b7dd6f6eb4ef31c0d8ec33012477">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  







<!-- Rendered timeline since 2020-01-31 03:50:40 -->



            </div>


            
          </div>

</div>

    
</div>


    </div>
  </div>

  </div>


  </div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>