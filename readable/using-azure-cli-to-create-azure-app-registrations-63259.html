<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using Azure CLI to create Azure App Registrations - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Using Azure CLI to create Azure App Registrations - linksfor.dev(s)"/>
    <meta property="article:author" content="June 22, 2020 &#xB7;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;by damienbod &#xB7;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in Azure, Deployment, devops&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xB7; 2 Comments"/>
    <meta property="og:description" content="This blog shows how to setup Azure App Registrations using Azure CLI and Powershell. The scripts setup the configuration for the applications created in the previous posts in this serious. The aim &#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://damienbod.com/2020/06/22/using-azure-cli-to-create-azure-app-registrations/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Using Azure CLI to create Azure App Registrations</title>
<div class="readable">
        <h1>Using Azure CLI to create Azure App Registrations</h1>
            <div>by June 22, 2020 &#xB7;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;by damienbod &#xB7;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;in Azure, Deployment, devops&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xB7; 2 Comments</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 22 Jun 2020</div>
        <p><a href="https://damienbod.com/2020/06/22/using-azure-cli-to-create-azure-app-registrations/">https://damienbod.com/2020/06/22/using-azure-cli-to-create-azure-app-registrations/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><div><p><code>Param( [</code><code>string</code><code>]$tenantId = </code><code>""</code><code>, [</code><code>string</code><code>]$inputAppIdApi = </code><code>""</code><code>, [</code><code>string</code><code>]$secretForWebApp = </code><code>""</code> <code>)</code></p><p><code>$displayNameSrUI = </code><code>"mi-server-rendered-portal"</code></p><p><code>$bodySrUI = '{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"signInAudience"</code> <code>: </code><code>"AzureADandPersonalMicrosoftAccount"</code><code>, </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"groupMembershipClaims"</code><code>: </code><code>"None"</code></p><p><code>}' | ConvertTo-Json | ConvertFrom-Json</code></p><p><code>$requiredResourceAccessesSrUI = '[{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"resourceAppId"</code><code>: </code><code>"00000003-0000-0000-c000-000000000000"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"resourceAccess"</code><code>: [</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"64a6cdd6-aab1-4aaf-94b8-3cc8405e90d0"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"7427e0e9-2fba-42fe-b0c0-848c9e6a8182"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"37f7f235-527c-4136-accd-4a02d197296e"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"14dad69e-099b-42c9-810b-d002981feec1"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"e1fe6dd8-ba31-4d61-89e7-88639da4683d"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>]</code></p><p><code>},</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"resourceAppId"</code><code>: </code><code>"-- replace --"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"resourceAccess"</code><code>: [</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"id"</code><code>: </code><code>"-- replace --"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"type"</code><code>: </code><code>"Scope"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>]</code></p><p><code>}]' | ConvertTo-Json | ConvertFrom-Json</code></p><p><code>##################################</code></p><p><code>### testParams</code></p><p><code>##################################</code></p><p><code>function testParams {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!$tenantId) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{ </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host </code><code>"tenantId is null"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>exit 1</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!$inputAppIdApi) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{ </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host </code><code>"inputAppIdApi is null"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>exit 1</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!$secretForWebApp) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{ </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host </code><code>"secretForWebApp is null"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>exit 1</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p><p><code>testParams</code></p><p><code>Write-Host </code><code>"Begin ServerRendered Azure App Registration"</code></p><p><code>$appDataFromInputAppIdApi = az ad app show --id $inputAppIdApi | Out-String | ConvertFrom-Json</code></p><p><code>$appDataFromInputAppIdApiOauth2Permissions = $appDataFromInputAppIdApi.oauth2Permissions[0]</code></p><p><code>$requiredResourceAccessesSrUIData = ConvertFrom-Json $requiredResourceAccessesSrUI</code></p><p><code># add the API values to the requiredResourceAccessesSrUIData</code></p><p><code>$requiredResourceAccessesSrUIData[1].resourceAppId = $inputAppIdApi</code></p><p><code>$requiredResourceAccessesSrUIData[1].resourceAccess[0].id = $appDataFromInputAppIdApiOauth2Permissions.id</code></p><p><code>$requiredResourceAccessesSrUINew =&nbsp; $requiredResourceAccessesSrUIData | ConvertTo-Json -Depth 5</code></p><p><code># Write-Host "$requiredResourceAccessesNew" </code></p><p><code>$requiredResourceAccessesSrUINew | Out-File -FilePath .\server_rendered_required_resources.json</code></p><p><code>Write-Host </code><code>" - Updated required-resource-accesses for new App Registration"</code></p><p><code>##################################</code></p><p><code>### Create Azure App Registration</code></p><p><code>##################################</code></p><p><code>$myServerRenderedAppRegistration = az ad app create `</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--display-name $displayNameSrUI `</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--available-to-other-tenants </code><code>true</code> <code>`</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--oauth2-allow-</code><code>implicit</code><code>-flow&nbsp; </code><code>false</code> <code>`</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--reply-urls $replyUrlsSrUI `</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--password $secretForWebApp `</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>--required-resource-accesses `@server_rendered_required_resources.json</code></p><p><code>$myServerRenderedAppRegistrationData = ($myServerRenderedAppRegistration | ConvertFrom-Json)</code></p><p><code>$myServerRenderedAppRegistrationDataAppId = $myServerRenderedAppRegistrationData.appId</code></p><p><code>Write-Host </code><code>" - Created ServerRendered $displayNameSrUI with appId: $myServerRenderedAppRegistrationDataAppId"</code></p><p><code>##################################</code></p><p><code>###&nbsp; add logoutUrl</code></p><p><code>##################################</code></p><p><code>az ad app update --id $myServerRenderedAppRegistrationDataAppId --</code><code>set</code> <code>logoutUrl=$logoutUrl</code></p><p><code>Write-Host </code><code>" - Updated logoutUrl"</code></p><p><code>##################################</code></p><p><code>### Add optional claims to App Registration </code></p><p><code>##################################</code></p><p><code>az ad app update --id $myServerRenderedAppRegistrationDataAppId --optional-claims `@server_rendered_optional_claims.json</code></p><p><code>Write-Host </code><code>" - Optional claims added to App Registration: $myServerRenderedAppRegistrationDataAppId"</code></p><p><code>##################################</code></p><p><code>###&nbsp; Remove scopes (oauth2Permissions)</code></p><p><code>##################################</code></p><p><code># 1. read oauth2Permissions</code></p><p><code>$oauth2PermissionsSrUI = $myServerRenderedAppRegistrationData.oauth2Permissions</code></p><p><code># 2. set to enabled to false from the defualt scope, because we want to remove this</code></p><p><code>$oauth2PermissionsSrUI[0].isEnabled = </code><code>'false'</code></p><p><code>$oauth2PermissionsSrUI = ConvertTo-Json -InputObject @($oauth2PermissionsSrUI) </code></p><p><code># Write-Host "$oauth2PermissionsSrUI" </code></p><p><code># disable oauth2Permission in Azure App Registration</code></p><p><code>$oauth2PermissionsSrUI | Out-File -FilePath .\oauth2Permissionsold.json</code></p><p><code>az ad app update --id $myServerRenderedAppRegistrationDataAppId --</code><code>set</code> <code>oauth2Permissions=`@oauth2Permissionsold.json</code></p><p><code># 3. delete the default oauth2Permission</code></p><p><code>az ad app update --id $myServerRenderedAppRegistrationDataAppId --</code><code>set</code> <code>oauth2Permissions=</code><code>'[]'</code></p><p><code>Write-Host </code><code>" - Updated scopes (oauth2Permissions) for App Registration: $myServerRenderedAppRegistrationDataAppId"</code></p><p><code>##################################</code></p><p><code>###&nbsp; Create a ServicePrincipal for the ServerRendered App Registration</code></p><p><code>##################################</code></p><p><code>az ad sp create --id $myServerRenderedAppRegistrationDataAppId</code></p><p><code>Write-Host </code><code>" - Created Service Principal for ServerRendered App registration"</code></p><p><code>return</code> <code>$myServerRenderedAppRegistrationDataAppId</code></p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>