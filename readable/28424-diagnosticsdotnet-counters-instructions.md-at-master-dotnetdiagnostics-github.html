<!DOCTYPE html>
<html lang="en">
<head>
    <title>
diagnostics/dotnet-counters-instructions.md at master &#xB7; dotnet/diagnostics &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>diagnostics/dotnet-counters-instructions.md at master · dotnet/diagnostics · GitHub</h1><div><div id="" class="markdown-body entry-content p-3 p-md-6"><h2><a id="user-content-intro" class="anchor" aria-hidden="true" href="#intro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Intro</h2><p>dotnet-counters is a performance monitoring tool for ad-hoc health monitoring or 1st level performance investigation. It can observe performance counter values that are published via <code>EventCounter</code> API (<a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.tracing.eventcounter" rel="nofollow">https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.tracing.eventcounter</a>). For example, you can quickly monitor things like the CPU usage or the rate of exceptions being thrown in your .NET Core application to see if there is anything suspiscious before diving into more serious performance investigation using PerfView or dotnet-trace.</p><h2><a id="user-content-install-dotnet-counters" class="anchor" aria-hidden="true" href="#install-dotnet-counters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install dotnet-counters</h2><pre><code>dotnet tool install --global dotnet-counters
</code></pre><h2><a id="user-content-using-dotnet-counters" class="anchor" aria-hidden="true" href="#using-dotnet-counters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using dotnet-counters</h2><p><em>SYNOPSIS</em></p><pre><code>dotnet-counters [--version]
                [-h, --help]
                &lt;command&gt; [&lt;args&gt;]
</code></pre><p><em>OPTIONS</em></p><pre><code>--version
    Display the version of the dotnet-counters utility.

-h, --help
    Show command line help
</code></pre><p><em>COMMANDS</em></p><pre><code>list      Display a list of counter names and descriptions
ps        Display a list of dotnet processes that can be monitored
monitor   Display periodically refreshing values of selected counters
collect   Periodically collect selected counter values and export them into a specified file format for post-processing.
</code></pre><p><em>PS</em></p><pre><code>dotnet-counters ps

Display a list of dotnet processes that can be monitored.

Examples:
  &gt; dotnet-counters ps

 15683 WebApi     /home/suwhang/repos/WebApi/WebApi
 16324 dotnet     /usr/local/share/dotnet/dotnet
</code></pre><p><em>LIST</em></p><pre><code>dotnet-counters list [-h|--help]

Display a list of counter names and descriptions, grouped by provider.

-h, --help
    Show command line help

Examples:
  &gt; dotnet-counters list

Showing well-known counters only. Specific processes may support additional counters.
System.Runtime
    cpu-usage                    Amount of time the process has utilized the CPU (ms)
    working-set                  Amount of working set used by the process (MB)
    gc-heap-size                 Total heap size reported by the GC (MB)
    gen-0-gc-count               Number of Gen 0 GCs / sec
    gen-1-gc-count               Number of Gen 1 GCs / sec
    gen-2-gc-count               Number of Gen 2 GCs / sec
    exception-count              Number of Exceptions / sec
</code></pre><p><em>MONITOR</em></p><pre><code>### Examples:

1. Monitoring all counters from `System.Runtime` at a refresh interval of 3 seconds:

  &gt; dotnet-counters monitor --process-id 1902 System.Runtime

Press p to pause, r to resume, q to quit.
  System.Runtime:
    CPU Usage (%)                                 24
    Working Set (MB)                            1982
    GC Heap Size (MB)                            811
    Gen 0 GC / second                             20
    Gen 1 GC / second                              4
    Gen 1 GC / Second                              1
    Number of Exceptions / sec                     4

2. Monitoring just CPU usage and GC heap size from `System.Runtime` at a refresh interval of 5 seconds:

  &gt; dotnet-counters monitor --process-id 1902 System.Runtime[cpu-usage,gc-heap-size,exception-count]

Press p to pause, r to resume, q to quit.
  System.Runtime:
    CPU Usage (%)                                 24
    GC Heap Size (MB)                            811
    Number of Exceptions / sec                     4

3. Monitoring EventCounter values from user-defined EventSource: (see https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md on how to do this.0)

  &gt; dotnet-counters monitor --process-id 1902 Samples-EventCounterDemos-Minimal

Press p to pause, r to resume, q to quit.
    request                                      100


### Syntax:

dotnet-counters monitor [-h||--help]
                        [-p|--process-id &lt;pid&gt;]
                        [--refresh-interval &lt;sec&gt;]
                        counter_list

Display periodically refreshing values of selected counters

-h, --help
    Show command line help

-p,--process-id
    The ID of the process that will be monitored

--refresh-interval
    The number of seconds to delay between updating the displayed counters

counter_list
    A space separated list of counters. Counters can be specified provider_name[:counter_name]. If the
    provider_name is used without a qualifying counter_name then all counters will be shown. To discover
    provider and counter names, use the list command.
</code></pre><p><em>COLLECT</em></p><h3><a id="user-content-examples" class="anchor" aria-hidden="true" href="#examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples:</h3><ol><li>Collect the runtime performance counters at a refresh interval of 10 seconds and export it as a JSON file named "test.json".</li></ol><pre><code>    dotnet run collect --process-id 863148 --refresh-interval 10 --output test --format json
</code></pre><ol start="2"><li>Collect the runtime performance counters as well as the ASP.NET hosting performance counters at the default refresh interval (1 second) and export it as a CSV file named "mycounter.csv".</li></ol><pre><code>    dotnet run collect --process-id 863148 --output mycounter --format csv System.Runtime Microsoft.AspNetCore.Hosting
</code></pre><pre><code>### Syntax:

dotnet-counters collect [-h||--help]
                        [-p|--process-id &lt;pid&gt;]
                        [-o|--output &lt;name&gt;]
                        [--format &lt;csv|json&gt;]
                        [--refreshInterval &lt;sec&gt;]
                        counter_list

Periodically collect selected counter values and export them into a specified file format for post-processing.

-h, --help
    Show command line help

-p,--process-id
    The ID of the process that will be monitored

-o, --output
    The name of the output file

--format
    The format to be exported. Currently available: csv, json

--refresh-interval
    The number of seconds to delay between updating the displayed counters

counter_list
    A space separated list of counters. Counters can be specified provider_name[:counter_name]. If the
    provider_name is used without a qualifying counter_name then all counters will be shown. To discover
    provider and counter names, use the list command.
</code></pre></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>