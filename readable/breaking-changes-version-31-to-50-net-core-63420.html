<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Breaking changes, version 3.1 to 5.0 - .NET Core - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Breaking changes, version 3.1 to 5.0 - .NET Core - linksfor.dev(s)"/>
    <meta property="article:author" content="gewarren"/>
    <meta property="og:description" content="Lists the breaking changes from version 3.1 to version 5.0 of .NET, ASP.NET Core, and EF Core."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://docs.microsoft.com/en-us/dotnet/core/compatibility/3.1-5.0"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Breaking changes, version 3.1 to 5.0 - .NET Core</title>
<div class="readable">
        <h1>Breaking changes, version 3.1 to 5.0 - .NET Core</h1>
            <div>by gewarren</div>
            <div>Reading time: 42-54 minutes</div>
        <div>Posted here: 25 Jun 2020</div>
        <p><a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/3.1-5.0">https://docs.microsoft.com/en-us/dotnet/core/compatibility/3.1-5.0</a></p>
        <hr/>
<div id="readability-page-1" class="page">


	<div data-bi-name="body">

		<div>

			

			<section>
				<div>


				<div id="main-column">

					<main id="main" role="main" data-bi-name="content" lang="en-us" dir="ltr">



						

						<ul data-bi-name="page info" lang="en-us" dir="ltr">
							<li>
								<time data-article-date="" aria-label="Article review date" datetime="2020-06-23T00:00:00.000Z" data-article-date-source="ms.date">06/23/2020</time>
							</li>
								<li>27 minutes to read</li>
								<li>
									<a href="https://github.com/dotnet/docs/blob/master/docs/core/compatibility/3.1-5.0.md" title="3 Contributors" aria-label="3 Contributors">
										
									</a>
								</li>
						</ul>

						<nav id="center-doc-outline" data-bi-name="intopic toc" role="navigation" aria-label="Article Outline">
							<h3>In this article</h3>
						<ol><li><a href="#aspnet-core">ASP.NET Core</a></li><li><a href="#core-net-libraries">Core .NET libraries</a></li><li><a href="#globalization">Globalization</a></li><li><a href="#windows-forms">Windows Forms</a></li></ol></nav>

						<!-- <content> -->
							<p>If you're migrating from version 3.1 of .NET Core, ASP.NET Core, or EF Core to version 5.0 of .NET, ASP.NET Core, or EF Core, the breaking changes listed in this article may affect your app.</p>
<h2 id="aspnet-core"><a href="#aspnet-core" aria-labelledby="aspnet-core"></a>ASP.NET Core</h2>
<ul>
<li><a href="#azure-microsoft-prefixed-azure-integration-packages-removed" data-linktype="self-bookmark">Azure: Microsoft-prefixed Azure integration packages removed</a></li>
<li><a href="#extensions-package-reference-changes-affecting-some-nuget-packages" data-linktype="self-bookmark">Extensions: Package reference changes affecting some NuGet packages</a></li>
<li><a href="#http-httpclient-instances-created-by-ihttpclientfactory-log-integer-status-codes" data-linktype="self-bookmark">HTTP: HttpClient instances created by IHttpClientFactory log integer status codes</a></li>
<li><a href="#http-kestrel-and-iis-badhttprequestexception-types-marked-obsolete-and-replaced" data-linktype="self-bookmark">HTTP: Kestrel and IIS BadHttpRequestException types marked obsolete and replaced</a></li>
<li><a href="#httpsys-client-certificate-renegotiation-disabled-by-default" data-linktype="self-bookmark">HttpSys: Client certificate renegotiation disabled by default</a></li>
<li><a href="#iis-urlrewrite-middleware-query-strings-are-preserved" data-linktype="self-bookmark">IIS: UrlRewrite middleware query strings are preserved</a></li>
<li><a href="#kestrel-configuration-changes-at-run-time-detected-by-default" data-linktype="self-bookmark">Kestrel: Configuration changes at run time detected by default</a></li>
<li><a href="#kestrel-default-supported-tls-protocol-versions-changed" data-linktype="self-bookmark">Kestrel: Default supported TLS protocol versions changed</a></li>
<li><a href="#kestrel-http2-disabled-over-tls-on-incompatible-windows-versions" data-linktype="self-bookmark">Kestrel: HTTP/2 disabled over TLS on incompatible Windows versions</a></li>
<li><a href="#localization-pubternal-apis-removed" data-linktype="self-bookmark">Localization: "Pubternal" APIs removed</a></li>
<li><a href="#localization-resourcemanagerwithculturestringlocalizer-class-and-withculture-interface-member-removed" data-linktype="self-bookmark">Localization: ResourceManagerWithCultureStringLocalizer class and WithCulture interface member removed</a></li>
<li><a href="#signalr-messagepack-hub-protocol-moved-to-messagepack-2x-package" data-linktype="self-bookmark">SignalR: MessagePack Hub Protocol moved to MessagePack 2.x package</a></li>
<li><a href="#signalr-messagepack-hub-protocol-options-type-changed" data-linktype="self-bookmark">SignalR: MessagePack Hub Protocol options type changed</a></li>
<li><a href="#signalr-usesignalr-and-useconnections-methods-removed" data-linktype="self-bookmark">SignalR: UseSignalR and UseConnections methods removed</a></li>
<li><a href="#static-files-csv-content-type-changed-to-standards-compliant" data-linktype="self-bookmark">Static files: CSV content type changed to standards-compliant</a></li>
</ul>
<h3 id="azure-microsoft-prefixed-azure-integration-packages-removed"><a href="#azure-microsoft-prefixed-azure-integration-packages-removed" aria-labelledby="azure-microsoft-prefixed-azure-integration-packages-removed"></a>Azure: Microsoft-prefixed Azure integration packages removed</h3>
<p>The following <code>Microsoft.*</code> packages that provide integration between ASP.NET Core and Azure SDKs aren't included in ASP.NET Core 5.0:</p>
<ul>
<li><a href="https://www.nuget.org/packages/Microsoft.Extensions.Configuration.AzureKeyVault/" data-linktype="external">Microsoft.Extensions.Configuration.AzureKeyVault</a>, which integrates <a href="https://docs.microsoft.com/en-us/azure/key-vault/" data-linktype="absolute-path">Azure Key Vault</a> into the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/" data-linktype="absolute-path">Configuration system</a>.</li>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.AzureKeyVault/" data-linktype="external">Microsoft.AspNetCore.DataProtection.AzureKeyVault</a>, which integrates Azure Key Vault into the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/data-protection/introduction" data-linktype="absolute-path">ASP.NET Core Data Protection system</a>.</li>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.AzureStorage/" data-linktype="external">Microsoft.AspNetCore.DataProtection.AzureStorage</a>, which integrates <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/" data-linktype="absolute-path">Azure Blob Storage</a> into the ASP.NET Core Data Protection system.</li>
</ul>
<p>For discussion on this issue, see <a href="https://github.com/dotnet/aspnetcore/issues/19570" data-linktype="external">dotnet/aspnetcore#19570</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The <code>Microsoft.*</code> packages integrated Azure services with the Configuration and Data Protection APIs.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>New <code>Azure.*</code> packages integrate Azure services with the Configuration and Data Protection APIs.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The change was made because the <code>Microsoft.*</code> packages were:</p>
<ul>
<li>Using outdated versions of the Azure SDK. Simple updates weren't possible because the new versions of the Azure SDK included breaking changes.</li>
<li>Tied to the .NET Core release schedule. Transferring ownership of the packages to the Azure SDK team enables package updates as the Azure SDK is updated.</li>
</ul>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>In ASP.NET Core 2.1 or later projects, replace the old <code>Microsoft.*</code> with the new <code>Azure.*</code> packages.</p>

<p>The new packages use a new version of the Azure SDK that includes breaking changes. The general usage patterns are unchanged. Some overloads and options may differ to adapt to changes in the underlying Azure SDK APIs.</p>
<p>The old packages will:</p>
<ul>
<li>Be supported by the ASP.NET Core team for the lifetime of .NET Core 2.1 and 3.1.</li>
<li>Not be included in .NET 5.</li>
</ul>
<p>When upgrading your project to .NET 5, transition to the <code>Azure.*</code> packages to maintain support.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.configuration.azurekeyvaultconfigurationextensions.addazurekeyvault" data-linktype="absolute-path">AzureKeyVaultConfigurationExtensions.AddAzureKeyVault</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.dataprotection.azuredataprotectionbuilderextensions.protectkeyswithazurekeyvault" data-linktype="absolute-path">AzureDataProtectionBuilderExtensions.ProtectKeysWithAzureKeyVault</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.dataprotection.azuredataprotectionbuilderextensions.persistkeystoazureblobstorage" data-linktype="absolute-path">AzureDataProtectionBuilderExtensions.PersistKeysToAzureBlobStorage</a></li>
</ul>
<!--

#### Affected APIs

- `Overload:Microsoft.Extensions.Configuration.AzureKeyVaultConfigurationExtensions.AddAzureKeyVault`
- `Overload:Microsoft.AspNetCore.DataProtection.AzureDataProtectionBuilderExtensions.ProtectKeysWithAzureKeyVault`
- `Overload:Microsoft.AspNetCore.DataProtection.AzureDataProtectionBuilderExtensions.PersistKeysToAzureBlobStorage`

-->
<hr>
<h3 id="extensions-package-reference-changes-affecting-some-nuget-packages"><a href="#extensions-package-reference-changes-affecting-some-nuget-packages" aria-labelledby="extensions-package-reference-changes-affecting-some-nuget-packages"></a>Extensions: Package reference changes affecting some NuGet packages</h3>
<p>With the migration of some <code>Microsoft.Extensions.*</code> NuGet packages from the <a href="https://github.com/dotnet/extensions" data-linktype="external">dotnet/extensions</a> repository to <a href="https://github.com/dotnet/runtime" data-linktype="external">dotnet/runtime</a>, as described in <a href="https://github.com/aspnet/Announcements/issues/411" data-linktype="external">aspnet/Announcements#411</a>, packaging changes are being applied to some of the migrated packages. For discussion on this issue, see <a href="https://github.com/dotnet/aspnetcore/issues/21033" data-linktype="external">dotnet/aspnetcore#21033</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 4</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>Some <code>Microsoft.Extensions.*</code> packages included package references for APIs on which your app relied.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>Your app may have to add <code>Microsoft.Extensions.*</code> package dependencies.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>Packaging policies were updated to better align with the <em>dotnet/runtime</em> repository. Under the new policy, unused package references are removed from <em>.nupkg</em> files during packaging.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Consumers of the affected packages should add a direct dependency on the removed package dependency in their project if APIs from removed package dependency are used. The following table lists the affected packages and the corresponding changes.</p>

<p>For example, the package reference to <code>Microsoft.Extensions.Configuration</code> was removed from <code>Microsoft.Extensions.Configuration.Binder</code>. No API from the dependency was used in the package. Users of <code>Microsoft.Extensions.Configuration.Binder</code> who depend on APIs from <code>Microsoft.Extensions.Configuration</code> should add a direct reference to it in their project.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p>None</p>
<!--

#### Affected APIs

Not detectable via API analysis

-->
<hr>
<h3 id="http-httpclient-instances-created-by-ihttpclientfactory-log-integer-status-codes"><a href="#http-httpclient-instances-created-by-ihttpclientfactory-log-integer-status-codes" aria-labelledby="http-httpclient-instances-created-by-ihttpclientfactory-log-integer-status-codes"></a>HTTP: HttpClient instances created by IHttpClientFactory log integer status codes</h3>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient" data-linktype="absolute-path">HttpClient</a> instances created by <a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.http.ihttpclientfactory" data-linktype="absolute-path">IHttpClientFactory</a> log HTTP status codes as integers instead of with status code names.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>Logging uses the textual descriptions of HTTP status codes. Consider the following log messages:</p>
<pre tabindex="0"><code data-author-content="Received HTTP response after 56.0044ms - OK
End processing HTTP request after 70.0862ms - OK
">Received HTTP response after 56.0044ms - OK
End processing HTTP request after 70.0862ms - OK
</code></pre>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>Logging uses the integer values of HTTP status codes. Consider the following log messages:</p>
<pre tabindex="0"><code data-author-content="Received HTTP response after 56.0044ms - 200
End processing HTTP request after 70.0862ms - 200
">Received HTTP response after 56.0044ms - 200
End processing HTTP request after 70.0862ms - 200
</code></pre>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The original behavior of this logging is inconsistent with other parts of ASP.NET Core that have always used integer values. The inconsistency makes logs difficult to query via structured logging systems such as <a href="https://www.elastic.co/elasticsearch/" data-linktype="external">Elasticsearch</a>. For more context, see <a href="https://github.com/dotnet/extensions/issues/1549" data-linktype="external">dotnet/extensions#1549</a>.</p>
<p>Using integer values is more flexible than text because it allows queries on ranges of values.</p>
<p>Adding another log value to capture the integer status code was considered. Unfortunately, doing so would introduce another inconsistency with the rest of ASP.NET Core. HttpClient logging and HTTP server/hosting logging use the same <code>StatusCode</code> key name already.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>The best option is to update logging queries to use the integer values of status codes. This option may cause some difficulty writing queries across multiple ASP.NET Core versions. However, using integers for this purpose is much more flexible for querying logs.</p>
<p>If you need to force compatibility with the old behavior and use textual status codes, replace the <code>IHttpClientFactory</code> logging with your own:</p>
<ol>
<li><p>Copy the .NET Core 3.1 versions of the following classes into your project:</p>
<ul>
<li><a href="https://github.com/dotnet/extensions/blob/release/3.1/src/HttpClientFactory/Http/src/Logging/LoggingHttpMessageHandlerBuilderFilter.cs" data-linktype="external">LoggingHttpMessageHandlerBuilderFilter</a></li>
<li><a href="https://github.com/dotnet/extensions/blob/release/3.1/src/HttpClientFactory/Http/src/Logging/LoggingHttpMessageHandler.cs" data-linktype="external">LoggingHttpMessageHandler</a></li>
<li><a href="https://github.com/dotnet/extensions/blob/release/3.1/src/HttpClientFactory/Http/src/Logging/LoggingScopeHttpMessageHandler.cs" data-linktype="external">LoggingScopeHttpMessageHandler</a></li>
<li><a href="https://github.com/dotnet/extensions/blob/release/3.1/src/HttpClientFactory/Http/src/Logging/HttpHeadersLogValue.cs" data-linktype="external">HttpHeadersLogValue</a></li>
</ul>
</li>
<li><p>Rename the classes to avoid conflicts with public types in the <a href="https://www.nuget.org/packages/Microsoft.Extensions.Http" data-linktype="external">Microsoft.Extensions.Http</a> NuGet package.</p>
</li>
<li><p>Replace the built-in implementation of <code>LoggingHttpMessageHandlerBuilderFilter</code> with your own in the project's <code>Startup.ConfigureServices</code> method. For example:</p>
<pre tabindex="0"><code data-author-content="public void ConfigureServices(IServiceCollection services)
{
    // Other service registrations go first. Code omitted for brevity.

    // Place the following after all AddHttpClient registrations.
    var descriptors = services.Where(
        s => s.ServiceType == typeof(IHttpMessageHandlerBuilderFilter));
    foreach (var descriptor in descriptors)
    {
        services.Remove(descriptor);
    }

    services.AddSingleton<IHttpMessageHandlerBuilderFilter,
                          MyLoggingHttpMessageHandlerBuilderFilter>();
}
"><span><span><span>public</span> <span>void</span> <span>ConfigureServices</span>(<span>IServiceCollection services</span>)</span>
{
    <span>// Other service registrations go first. Code omitted for brevity.</span>

    <span>// Place the following after all AddHttpClient registrations.</span>
    <span>var</span> descriptors = services.Where(
        s =&gt; s.ServiceType == <span>typeof</span>(IHttpMessageHandlerBuilderFilter));
    <span>foreach</span> (<span>var</span> descriptor <span>in</span> descriptors)
    {
        services.Remove(descriptor);
    }

    services.AddSingleton&lt;IHttpMessageHandlerBuilderFilter,
                          MyLoggingHttpMessageHandlerBuilderFilter&gt;();
}
</span></code></pre>
</li>
</ol>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient" data-linktype="absolute-path">System.Net.Http.HttpClient</a></p>
<!--

#### Affected APIs

`T:System.Net.Http.HttpClient`

-->
<hr>
<h3 id="http-kestrel-and-iis-badhttprequestexception-types-marked-obsolete-and-replaced"><a href="#http-kestrel-and-iis-badhttprequestexception-types-marked-obsolete-and-replaced" aria-labelledby="http-kestrel-and-iis-badhttprequestexception-types-marked-obsolete-and-replaced"></a>HTTP: Kestrel and IIS BadHttpRequestException types marked obsolete and replaced</h3>
<p><code>Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException</code> and <code>Microsoft.AspNetCore.Server.IIS.BadHttpRequestException</code> have been marked obsolete and changed to derive from <code>Microsoft.AspNetCore.Http.BadHttpRequestException</code>. The Kestrel and IIS servers still throw their old exception types for backwards compatibility. The obsolete types will be removed in a future release.</p>
<p>For discussion, see <a href="https://github.com/dotnet/aspnetcore/issues/20614" data-linktype="external">dotnet/aspnetcore#20614</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 4</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p><code>Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException</code> and <code>Microsoft.AspNetCore.Server.IIS.BadHttpRequestException</code> derived from <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.ioexception" data-linktype="absolute-path">System.IO.IOException</a>.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p><code>Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException</code> and <code>Microsoft.AspNetCore.Server.IIS.BadHttpRequestException</code> are obsolete. The types also derive from <code>Microsoft.AspNetCore.Http.BadHttpRequestException</code>, which derives from <code>System.IO.IOException</code>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The change was made to:</p>
<ul>
<li>Consolidate duplicate types.</li>
<li>Unify behavior across server implementations.</li>
</ul>
<p>An app can now catch the base exception <code>Microsoft.AspNetCore.Http.BadHttpRequestException</code> when using either Kestrel or IIS.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Replace usages of <code>Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException</code> and <code>Microsoft.AspNetCore.Server.IIS.BadHttpRequestException</code> with <code>Microsoft.AspNetCore.Http.BadHttpRequestException</code>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.iis.badhttprequestexception?view=aspnetcore-3.1" data-linktype="absolute-path">Microsoft.AspNetCore.Server.IIS.BadHttpRequestException</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.badhttprequestexception?view=aspnetcore-1.1" data-linktype="absolute-path">Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException</a></li>
</ul>
<!--

#### Affected APIs

- `T:Microsoft.AspNetCore.Server.IIS.BadHttpRequestException`
- `T:Microsoft.AspNetCore.Server.Kestrel.BadHttpRequestException`

-->
<hr>
<h3 id="httpsys-client-certificate-renegotiation-disabled-by-default"><a href="#httpsys-client-certificate-renegotiation-disabled-by-default" aria-labelledby="httpsys-client-certificate-renegotiation-disabled-by-default"></a>HttpSys: Client certificate renegotiation disabled by default</h3>
<p>The option to renegotiate a connection and request a client certificate has been disabled by default. For discussion, see issue <a href="https://github.com/dotnet/aspnetcore/issues/23181" data-linktype="external">dotnet/aspnetcore#23181</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>ASP.NET Core 5.0</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The connection can be renegotiated to request a client certificate.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>Client certificates can only be requested during the initial connection handshake. For more information, see pull request <a href="https://github.com/dotnet/aspnetcore/pull/23162" data-linktype="external">dotnet/aspnetcore#23162</a>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>Renegotiation caused a number of performance and deadlock issues. It's also not supported in HTTP/2. For additional context from when the option to control this behavior was introduced in ASP.NET Core 3.1, see issue <a href="https://github.com/dotnet/aspnetcore/issues/14806" data-linktype="external">dotnet/aspnetcore#14806</a>.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Apps that require client certificates should use <em>netsh.exe</em> to set the <code>clientcertnegotiation</code> option to <code>enabled</code>. For more information, see <a href="https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-http" data-linktype="absolute-path">netsh http commands</a>.</p>
<p>If you want client certificates enabled for only some parts of your app, see the guidance at <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/certauth?view=aspnetcore-3.1#optional-client-certificates" data-linktype="absolute-path">Optional client certificates</a>.</p>
<p>If you need the old renegotiate behavior, set <code>HttpSysOptions.ClientCertificateMethod</code> to the old value <code>ClientCertificateMethod.AllowRenegotiate</code>. This isn't recommended for the reasons outlined above and in the linked guidance.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.connectioninfo.clientcertificate" data-linktype="absolute-path">ConnectionInfo.ClientCertificate</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.connectioninfo.getclientcertificateasync" data-linktype="absolute-path">ConnectionInfo.GetClientCertificateAsync</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.httpsys.httpsysoptions.clientcertificatemethod" data-linktype="absolute-path">HttpSysOptions.ClientCertificateMethod</a></li>
</ul>
<!--

#### Affected APIs

- `Overload:Microsoft.AspNetCore.Http.ConnectionInfo.ClientCertificate`
- `Overload:Microsoft.AspNetCore.Http.ConnectionInfo.GetClientCertificateAsync`
- `Overload:Microsoft.AspNetCore.Server.HttpSys.HttpSysOptions.ClientCertificateMethod`

-->
<hr>
<h3 id="iis-urlrewrite-middleware-query-strings-are-preserved"><a href="#iis-urlrewrite-middleware-query-strings-are-preserved" aria-labelledby="iis-urlrewrite-middleware-query-strings-are-preserved"></a>IIS: UrlRewrite middleware query strings are preserved</h3>
<p>An IIS UrlRewrite middleware defect prevented the query string from being preserved in rewrite rules. That defect has been fixed to maintain consistency with the IIS UrlRewrite Module's behavior.</p>
<p>For discussion, see issue <a href="https://github.com/dotnet/aspnetcore/issues/22972" data-linktype="external">dotnet/aspnetcore#22972</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>ASP.NET Core 5.0 Preview 7</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>Consider the following rewrite rule:</p>
<pre tabindex="0"><code data-author-content="<rule name=&quot;MyRule&quot; stopProcessing=&quot;true&quot;>
  <match url=&quot;^about&quot; />
  <action type=&quot;Redirect&quot; url=&quot;/contact&quot; redirectType=&quot;Temporary&quot; appendQueryString=&quot;true&quot; />
</rule>
"><span><span>&lt;<span>rule</span> <span>name</span>=<span>"MyRule"</span> <span>stopProcessing</span>=<span>"true"</span>&gt;</span>
  <span>&lt;<span>match</span> <span>url</span>=<span>"^about"</span> /&gt;</span>
  <span>&lt;<span>action</span> <span>type</span>=<span>"Redirect"</span> <span>url</span>=<span>"/contact"</span> <span>redirectType</span>=<span>"Temporary"</span> <span>appendQueryString</span>=<span>"true"</span> /&gt;</span>
<span>&lt;/<span>rule</span>&gt;</span>
</span></code></pre>
<p>The preceding rule doesn't append the query string. A URI like <code>/about?id=1</code> redirects to <code>/contact</code> instead of <code>/contact?id=1</code>. The <code>appendQueryString</code> attribute defaults to <code>true</code> as well.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>The query string is preserved. The URI from the example in <a href="#old-behavior" data-linktype="self-bookmark">Old behavior</a> would be <code>/contact?id=1</code>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The old behavior didn't match the IIS UrlRewrite Module's behavior. To support porting between the middleware and module, the goal is to maintain consistent behaviors.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>If the behavior of removing the query string is preferred, set the <code>action</code> element to <code>appendQueryString="false"</code>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.rewrite.iisurlrewriteoptionsextensions.addiisurlrewrite" data-linktype="absolute-path">IISUrlRewriteOptionsExtensions.AddIISUrlRewrite</a></p>
<!--

#### Affected APIs

`Overload:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite`

-->
<hr>
<h3 id="kestrel-configuration-changes-at-run-time-detected-by-default"><a href="#kestrel-configuration-changes-at-run-time-detected-by-default" aria-labelledby="kestrel-configuration-changes-at-run-time-detected-by-default"></a>Kestrel: Configuration changes at run time detected by default</h3>
<p>Kestrel now reacts to changes made to the <code>Kestrel</code> section of the project's <code>IConfiguration</code> instance (for example, <em>appsettings.json</em>) at run time. To learn more about how to configure Kestrel using <em>appsettings.json</em>, see the <em>appsettings.json</em> example in <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel#endpoint-configuration" data-linktype="absolute-path">Endpoint configuration</a>.</p>
<p>Kestrel will bind, unbind, and rebind endpoints as necessary to react to these configuration changes.</p>
<p>For discussion, see issue <a href="https://github.com/dotnet/aspnetcore/issues/22807" data-linktype="external">dotnet/aspnetcore#22807</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 7</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>Before ASP.NET Core 5.0 Preview 6, Kestrel didn't support changing configuration at run time.</p>
<p>In ASP.NET Core 5.0 Preview 6, you could opt into the now-default behavior of reacting to configuration changes at run time. Opting in required binding Kestrel's configuration manually:</p>
<pre tabindex="0"><code data-author-content="using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting;

public class Program
{
    public static void Main(string[] args) =>
        CreateHostBuilder(args).Build().Run();

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder.UseKestrel((builderContext, kestrelOptions) =>
                {
                    kestrelOptions.Configure(
                        builderContext.Configuration.GetSection(&quot;Kestrel&quot;), reloadOnChange: true);
                });

                webBuilder.UseStartup<Startup>();
            });
}
"><span><span>using</span> Microsoft.AspNetCore.Hosting;
<span>using</span> Microsoft.Extensions.Hosting;

<span>public</span> <span>class</span> <span>Program</span>
{
    <span><span>public</span> <span>static</span> <span>void</span> <span>Main</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        CreateHostBuilder(args).Build().Run();

    <span><span>public</span> <span>static</span> IHostBuilder <span>CreateHostBuilder</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =&gt;
            {
                webBuilder.UseKestrel((builderContext, kestrelOptions) =&gt;
                {
                    kestrelOptions.Configure(
                        builderContext.Configuration.GetSection(<span>"Kestrel"</span>), reloadOnChange: <span>true</span>);
                });

                webBuilder.UseStartup&lt;Startup&gt;();
            });
}
</span></code></pre>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>Kestrel reacts to configuration changes at run time by default. To support that change, <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.generichostbuilderextensions.configurewebhostdefaults" data-linktype="absolute-path">ConfigureWebHostDefaults</a> calls <code>KestrelServerOptions.Configure(IConfiguration, bool)</code> with <code>reloadOnChange: true</code> by default.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The change was made to support endpoint reconfiguration at run time without completely restarting the server. Unlike with a full server restart, unchanged endpoints aren't unbound even temporarily.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<ul>
<li><p>For most scenarios in which Kestrel's default configuration section doesn't change at run time, this change has no impact and no action is needed.</p>
</li>
<li><p>For scenarios in which Kestrel's default configuration section does change at run time and Kestrel should react to it, this is now the default behavior.</p>
</li>
<li><p>For scenarios in which Kestrel's default configuration section changes at run time and Kestrel shouldn't react to it, you can opt out as follows:</p>
<pre tabindex="0"><code data-author-content="using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting;

public class Program
{
    public static void Main(string[] args) =>
        CreateHostBuilder(args).Build().Run();

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder.UseKestrel((builderContext, kestrelOptions) =>
                {
                    kestrelOptions.Configure(
                        builderContext.Configuration.GetSection(&quot;Kestrel&quot;), reloadOnChange: false);
                });

                webBuilder.UseStartup<Startup>();
            });
}
"><span><span>using</span> Microsoft.AspNetCore.Hosting;
<span>using</span> Microsoft.Extensions.Hosting;

<span>public</span> <span>class</span> <span>Program</span>
{
    <span><span>public</span> <span>static</span> <span>void</span> <span>Main</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        CreateHostBuilder(args).Build().Run();

    <span><span>public</span> <span>static</span> IHostBuilder <span>CreateHostBuilder</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =&gt;
            {
                webBuilder.UseKestrel((builderContext, kestrelOptions) =&gt;
                {
                    kestrelOptions.Configure(
                        builderContext.Configuration.GetSection(<span>"Kestrel"</span>), reloadOnChange: <span>false</span>);
                });

                webBuilder.UseStartup&lt;Startup&gt;();
            });
}
</span></code></pre>
</li>
</ul>
<p><strong>Notes:</strong></p>
<p>This change doesn't modify the behavior of the <code>KestrelServerOptions.Configure(IConfiguration)</code> overload, which still defaults to the <code>reloadOnChange: false</code> behavior.</p>
<p>It's also important to make sure the configuration source supports reloading. For JSON sources, reloading is configured by calling <code>AddJsonFile(path, reloadOnChange: true)</code>. Reloading is already configured by default for <em>appsettings.json</em> and <em>appsettings.{Environment}.json</em>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.generichostbuilderextensions.configurewebhostdefaults" data-linktype="absolute-path">GenericHostBuilderExtensions.ConfigureWebHostDefaults</a></p>
<!-- 

#### Affected APIs

`Overload:Microsoft.Extensions.Hosting.GenericHostBuilderExtensions.ConfigureWebHostDefaults`

-->
<hr>
<h3 id="kestrel-default-supported-tls-protocol-versions-changed"><a href="#kestrel-default-supported-tls-protocol-versions-changed" aria-labelledby="kestrel-default-supported-tls-protocol-versions-changed"></a>Kestrel: Default supported TLS protocol versions changed</h3>
<p>Kestrel now uses the system default TLS protocol versions rather than restricting connections to the TLS 1.1 and TLS 1.2 protocols like it did previously.</p>
<p>This change allows:</p>
<ul>
<li>TLS 1.3 to be used by default in environments that support it.</li>
<li>TLS 1.0 to be used in some environments (such as Windows Server 2016 by default), which is usually <a href="https://docs.microsoft.com/en-us/security/engineering/solving-tls1-problem" data-linktype="absolute-path">not desirable</a>.</li>
</ul>
<p>For discussion, see issue <a href="https://github.com/dotnet/aspnetcore/issues/22563" data-linktype="external">dotnet/aspnetcore#22563</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 6</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>Kestrel required that connections use TLS 1.1 or TLS 1.2 by default.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>Kestrel allows the operating system to choose the best protocol to use and to block insecure protocols. <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.https.httpsconnectionadapteroptions.sslprotocols" data-linktype="absolute-path">HttpsConnectionAdapterOptions.SslProtocols</a> now defaults to <code>SslProtocols.None</code> instead of <code>SslProtocols.Tls12 | SslProtocols.Tls11</code>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The change was made to support TLS 1.3 and future TLS versions by default as they become available.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Unless your app has a specific reason not to, you should use the new defaults. Verify your system is configured to allow only secure protocols.</p>
<p>To disable older protocols, take one of the following actions:</p>
<ul>
<li><p>Disable older protocols, such as TLS 1.0, system-wide with the <a href="https://docs.microsoft.com/en-us/dotnet/framework/network-programming/tls#configuring-schannel-protocols-in-the-windows-registry" data-linktype="absolute-path">Windows instructions</a>. It's currently enabled by default on all Windows versions.</p>
</li>
<li><p>Manually select which protocols you want to support in code as follows:</p>
<pre tabindex="0"><code data-author-content="using System.Security.Authentication;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting;

public class Program
{
    public static void Main(string[] args) =>
        CreateHostBuilder(args).Build().Run();

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder.UseKestrel(kestrelOptions =>
                {
                    kestrelOptions.ConfigureHttpsDefaults(httpsOptions =>
                    {
                        httpsOptions.SslProtocols = SslProtocols.Tls12 | SslProtocols.Tls13;
                    });
                });

                webBuilder.UseStartup<Startup>();
            });
}
"><span><span>using</span> System.Security.Authentication;
<span>using</span> Microsoft.AspNetCore.Hosting;
<span>using</span> Microsoft.Extensions.Hosting;

<span>public</span> <span>class</span> <span>Program</span>
{
    <span><span>public</span> <span>static</span> <span>void</span> <span>Main</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        CreateHostBuilder(args).Build().Run();

    <span><span>public</span> <span>static</span> IHostBuilder <span>CreateHostBuilder</span>(<span><span>string</span>[] args</span>)</span> =&gt;
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =&gt;
            {
                webBuilder.UseKestrel(kestrelOptions =&gt;
                {
                    kestrelOptions.ConfigureHttpsDefaults(httpsOptions =&gt;
                    {
                        httpsOptions.SslProtocols = SslProtocols.Tls12 | SslProtocols.Tls13;
                    });
                });

                webBuilder.UseStartup&lt;Startup&gt;();
            });
}
</span></code></pre>
</li>
</ul>
<p>Unfortunately, there's no API to exclude specific protocols.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.https.httpsconnectionadapteroptions.sslprotocols" data-linktype="absolute-path">HttpsConnectionAdapterOptions.SslProtocols</a></p>
<!-- 

#### Affected APIs

`P:Microsoft.AspNetCore.Server.Kestrel.Https.HttpsConnectionAdapterOptions.SslProtocols`

-->
<hr>
<h3 id="kestrel-http2-disabled-over-tls-on-incompatible-windows-versions"><a href="#kestrel-http2-disabled-over-tls-on-incompatible-windows-versions" aria-labelledby="kestrel-http2-disabled-over-tls-on-incompatible-windows-versions"></a>Kestrel: HTTP/2 disabled over TLS on incompatible Windows versions</h3>
<p>To enable HTTP/2 over Transport Layer Security (TLS) on Windows, two requirements need to be met:</p>
<ul>
<li>Application-Layer Protocol Negotiation (ALPN) support, which is available starting with Windows 8.1 and Windows Server 2012 R2.</li>
<li>A set of ciphers compatible with HTTP/2, which is available starting with Windows 10 and Windows Server 2016.</li>
</ul>
<p>As such, Kestrel's behavior when HTTP/2 over TLS is configured has changed to:</p>
<ul>
<li>Downgrade to <code>Http1</code> and log a message at the <code>Information</code> level when <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.server.kestrel.core.httpprotocols" data-linktype="absolute-path">ListenOptions.HttpProtocols</a> is set to <code>Http1AndHttp2</code>. <code>Http1AndHttp2</code> is the default value for <code>ListenOptions.HttpProtocols</code>.</li>
<li>Throw a <code>NotSupportedException</code> when <code>ListenOptions.HttpProtocols</code> is set to <code>Http2</code>.</li>
</ul>
<p>For discussion, see issue <a href="https://github.com/dotnet/aspnetcore/issues/23068" data-linktype="external">dotnet/aspnetcore#23068</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>ASP.NET Core 5.0 Preview 7</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The following table outlines the behavior when HTTP/2 over TLS is configured.</p>

<p>* Configure compatible cipher suites to enable these scenarios.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>The following table outlines the behavior when HTTP/2 over TLS is configured.</p>

<p>** Configure compatible cipher suites and set the app context switch <code>Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2</code> to <code>true</code> to enable these scenarios.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>This change ensures compatibility errors for HTTP/2 over TLS on older Windows versions are surfaced as early and as clearly as possible.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Ensure HTTP/2 over TLS is disabled on incompatible Windows versions. Windows 8.1 and Windows Server 2012 R2 are incompatible since they lack the necessary ciphers by default. However, it's possible to update the Computer Configuration settings to use HTTP/2 compatible ciphers. For more information, see <a href="https://docs.microsoft.com/en-us/windows/win32/secauthn/tls-cipher-suites-in-windows-8-1" data-linktype="absolute-path">TLS cipher suites in Windows 8.1</a>. Once configured, HTTP/2 over TLS on Kestrel must be enabled by setting the app context switch <code>Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2</code>. For example:</p>
<pre tabindex="0"><code data-author-content="AppContext.SetSwitch(&quot;Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2&quot;, true);
"><span>AppContext.SetSwitch(<span>"Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2"</span>, <span>true</span>);
</span></code></pre>
<p>No underlying support has changed. For example, HTTP/2 over TLS has never worked on Windows 8 or Windows Server 2012. This change modifies how errors in these unsupported scenarios are presented.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p>None</p>
<!--

#### Affected APIs

Not detectable via API analysis

-->
<hr>
<h3 id="localization-pubternal-apis-removed"><a href="#localization-pubternal-apis-removed" aria-labelledby="localization-pubternal-apis-removed"></a>Localization: "Pubternal" APIs removed</h3>
<p>To better maintain the public API surface of ASP.NET Core, some "pubternal" localization APIs were removed. A "pubternal" API has a <code>public</code> access modifier and is defined in a namespace that implies an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/internal" data-linktype="absolute-path">internal</a> intent.</p>
<p>For discussion, see <a href="https://github.com/dotnet/aspnetcore/issues/22291" data-linktype="external">dotnet/aspnetcore#22291</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 6</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The following APIs were <code>public</code>:</p>
<ul>
<li><code>Microsoft.Extensions.Localization.Internal.AssemblyWrapper</code></li>
<li><code>Microsoft.Extensions.Localization.Internal.IResourceStringProvider</code></li>
<li><code>Microsoft.Extensions.Localization.ResourceManagerStringLocalizer</code> constructor overloads accepting either of the following parameter types:
<ul>
<li><code>AssemblyWrapper</code></li>
<li><code>IResourceStringProvider</code></li>
</ul>
</li>
</ul>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>The following list outlines the changes:</p>
<ul>
<li><code>Microsoft.Extensions.Localization.Internal.AssemblyWrapper</code> became <code>Microsoft.Extensions.Localization.AssemblyWrapper</code> and is now <code>internal</code>.</li>
<li><code>Microsoft.Extensions.Localization.Internal.IResourceStringProvider</code> became <code>Microsoft.Extensions.Localization.Internal.IResourceStringProvider</code> and is now <code>internal</code>.</li>
<li><code>Microsoft.Extensions.Localization.ResourceManagerStringLocalizer</code> constructor overloads accepting either of the following parameter types are now <code>internal</code>:
<ul>
<li><code>AssemblyWrapper</code></li>
<li><code>IResourceStringProvider</code></li>
</ul>
</li>
</ul>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>Explained more thoroughly at <a href="https://github.com/aspnet/Announcements/issues/377#issue-473651882" data-linktype="external">aspnet/Announcements#377</a>, "pubternal" types were removed from the <code>public</code> API surface. These changes adapt more classes to that design decision. The classes in question were intended as extension points for the team's internal testing.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Although it's unlikely, some apps may intentionally or accidentally depend upon the "pubternal" types. See the <a href="#new-behavior" data-linktype="self-bookmark">New behavior</a> sections to determine how to migrate away from the types.</p>
<p>If you've identified a scenario which the public API allowed before this change but doesn't now, file an issue at <a href="https://github.com/dotnet/aspnetcore/issues" data-linktype="external">dotnet/aspnetcore</a>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><code>Microsoft.Extensions.Localization.Internal.AssemblyWrapper</code></li>
<li><code>Microsoft.Extensions.Localization.Internal.IResourceStringProvider</code></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerstringlocalizer.-ctor" data-linktype="absolute-path">ResourceManagerStringLocalizer.ResourceManagerStringLocalizer</a></li>
</ul>
<!--

#### Affected APIs

- `T:Microsoft.Extensions.Localization.Internal.AssemblyWrapper`
- `T:Microsoft.Extensions.Localization.Internal.IResourceStringProvider`
- `Overload:Microsoft.Extensions.Localization.ResourceManagerStringLocalizer.#ctor`

-->
<hr>
<h3 id="localization-resourcemanagerwithculturestringlocalizer-class-and-withculture-interface-member-removed"><a href="#localization-resourcemanagerwithculturestringlocalizer-class-and-withculture-interface-member-removed" aria-labelledby="localization-resourcemanagerwithculturestringlocalizer-class-and-withculture-interface-member-removed"></a>Localization: ResourceManagerWithCultureStringLocalizer class and WithCulture interface member removed</h3>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerwithculturestringlocalizer?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">ResourceManagerWithCultureStringLocalizer</a> class and <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerstringlocalizer.withculture?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">WithCulture</a> method were removed in .NET 5.0 Preview 1.</p>
<p>For context, see <a href="https://github.com/aspnet/Announcements/issues/346" data-linktype="external">aspnet/Announcements#346</a> and <a href="https://github.com/dotnet/aspnetcore/issues/3324" data-linktype="external">dotnet/aspnetcore#3324</a>. For discussion on this change, see <a href="https://github.com/dotnet/aspnetcore/issues/7756" data-linktype="external">dotnet/aspnetcore#7756</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The <code>ResourceManagerWithCultureStringLocalizer</code> class and the <code>ResourceManagerStringLocalizer.WithCulture</code> method are <a href="https://docs.microsoft.com/en-us/dotnet/core/compatibility/2.2-3.0#localization-resourcemanagerwithculturestringlocalizer-and-withculture-marked-obsolete" data-linktype="absolute-path">obsolete in .NET Core 3.0 Preview 3 and later</a>.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>The <code>ResourceManagerWithCultureStringLocalizer</code> class and the <code>ResourceManagerStringLocalizer.WithCulture</code> method have been removed in .NET 5.0 Preview 1. For an inventory of the changes made, see the pull request at <a href="https://github.com/dotnet/extensions/pull/2562/files" data-linktype="external">dotnet/extensions#2562</a>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerwithculturestringlocalizer?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">ResourceManagerWithCultureStringLocalizer</a> class and <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerstringlocalizer.withculture?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">ResourceManagerStringLocalizer.WithCulture</a> method were often sources of confusion for users of localization. The confusion was especially high when creating a custom <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.istringlocalizer" data-linktype="absolute-path">IStringLocalizer</a> implementation. This class and method give consumers the impression that an <code>IStringLocalizer</code> instance is expected to be "per-language, per-resource". In reality, the instance should only be "per-resource". At run time, the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.cultureinfo.currentuiculture" data-linktype="absolute-path">CultureInfo.CurrentUICulture</a> property determines the language to be used.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Stop using the <code>ResourceManagerWithCultureStringLocalizer</code> class and the <code>ResourceManagerStringLocalizer.WithCulture</code> method.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerwithculturestringlocalizer?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">ResourceManagerWithCultureStringLocalizer</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.localization.resourcemanagerstringlocalizer.withculture?view=dotnet-plat-ext-3.1" data-linktype="absolute-path">ResourceManagerStringLocalizer.WithCulture</a></li>
</ul>
<!--

#### Affected APIs

- `T:Microsoft.Extensions.Localization.ResourceManagerWithCultureStringLocalizer`
- `Overload:Microsoft.Extensions.Localization.ResourceManagerStringLocalizer.WithCulture`

-->
<hr>
<h3 id="signalr-messagepack-hub-protocol-moved-to-messagepack-2x-package"><a href="#signalr-messagepack-hub-protocol-moved-to-messagepack-2x-package" aria-labelledby="signalr-messagepack-hub-protocol-moved-to-messagepack-2x-package"></a>SignalR: MessagePack Hub Protocol moved to MessagePack 2.x package</h3>
<p>The ASP.NET Core SignalR <a href="https://docs.microsoft.com/en-us/aspnet/core/signalr/messagepackhubprotocol" data-linktype="absolute-path">MessagePack Hub Protocol</a> uses the <a href="https://www.nuget.org/packages/MessagePack" data-linktype="external">MessagePack NuGet package</a> for MessagePack serialization. ASP.NET Core 5.0 upgrades the package from 1.x to the latest 2.x package version.</p>
<p>For discussion on this issue, see <a href="https://github.com/dotnet/aspnetcore/issues/18692" data-linktype="external">dotnet/aspnetcore#18692</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>ASP.NET Core SignalR used the MessagePack 1.x package to serialize and deserialize MessagePack messages.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>ASP.NET Core SignalR uses the MessagePack 2.x package to serialize and deserialize MessagePack messages.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The latest improvements in the MessagePack 2.x package add useful functionality.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>This breaking change applies when:</p>
<ul>
<li>Setting or configuring values on <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.messagepackhubprotocoloptions" data-linktype="absolute-path">MessagePackHubProtocolOptions</a>.</li>
<li>Using the MessagePack APIs directly and using the ASP.NET Core SignalR MessagePack Hub Protocol in the same project. The newer version will be loaded instead of the previous version.</li>
</ul>
<p>For migration guidance from the package authors, see <a href="https://github.com/neuecc/MessagePack-CSharp/blob/master/doc/migration.md" data-linktype="external">Migrating from MessagePack v1.x to MessagePack v2.x</a>. Some aspects of message serialization and deserialization are affected. Specifically, there are <a href="https://github.com/neuecc/MessagePack-CSharp/blob/master/doc/migration.md#behavioral-changes" data-linktype="external">behavioral changes to how DateTime values are serialized</a>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.messagepackhubprotocoloptions" data-linktype="absolute-path">Microsoft.AspNetCore.SignalR.MessagePackHubProtocolOptions</a></p>
<!--

#### Affected APIs

`T:Microsoft.AspNetCore.SignalR.MessagePackHubProtocolOptions`

-->
<hr>
<h3 id="signalr-messagepack-hub-protocol-options-type-changed"><a href="#signalr-messagepack-hub-protocol-options-type-changed" aria-labelledby="signalr-messagepack-hub-protocol-options-type-changed"></a>SignalR: MessagePack Hub Protocol options type changed</h3>
<p>The ASP.NET Core SignalR MessagePack Hub Protocol options type has changed from <code>IList&lt;MessagePack.IFormatterResolver&gt;</code> to the <a href="https://www.nuget.org/packages/MessagePack" data-linktype="external">MessagePack</a> library's <code>MessagePackSerializerOptions</code> type.</p>
<p>For discussion on this change, see <a href="https://github.com/dotnet/aspnetcore/issues/20506" data-linktype="external">dotnet/aspnetcore#20506</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 4</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>You can add to the options as shown in the following example:</p>
<pre tabindex="0"><code data-author-content="services.AddSignalR()
    .AddMessagePackProtocol(options =>
    {
        options.FormatterResolvers.Add(MessagePack.Resolvers.StandardResolver.Instance);
    });
"><span>services.AddSignalR()
    .AddMessagePackProtocol(options =&gt;
    {
        options.FormatterResolvers.Add(MessagePack.Resolvers.StandardResolver.Instance);
    });
</span></code></pre>
<p>And replace the options as follows:</p>
<pre tabindex="0"><code data-author-content="services.AddSignalR()
    .AddMessagePackProtocol(options =>
    {
        options.FormatterResolvers = new List<MessagePack.IFormatterResolver>()
        {
            MessagePack.Resolvers.StandardResolver.Instance
        };
    });
"><span>services.AddSignalR()
    .AddMessagePackProtocol(options =&gt;
    {
        options.FormatterResolvers = <span>new</span> List&lt;MessagePack.IFormatterResolver&gt;()
        {
            MessagePack.Resolvers.StandardResolver.Instance
        };
    });
</span></code></pre>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>You can add to the options as shown in the following example:</p>
<pre tabindex="0"><code data-author-content="services.AddSignalR()
    .AddMessagePackProtocol(options =>
    {
        options.SerializerOptions =
            options.SerializeOptions.WithResolver(MessagePack.Resolvers.StandardResolver.Instance);
    });
"><span>services.AddSignalR()
    .AddMessagePackProtocol(options =&gt;
    {
        options.SerializerOptions =
            options.SerializeOptions.WithResolver(MessagePack.Resolvers.StandardResolver.Instance);
    });
</span></code></pre>
<p>And replace the options as follows:</p>
<pre tabindex="0"><code data-author-content="services.AddSignalR()
    .AddMessagePackProtocol(options =>
    {
        options.SerializerOptions = MessagePackSerializerOptions
                .Standard
                .WithResolver(MessagePack.Resolvers.StandardResolver.Instance)
                .WithSecurity(MessagePackSecurity.UntrustedData);
    });
"><span>services.AddSignalR()
    .AddMessagePackProtocol(options =&gt;
    {
        options.SerializerOptions = MessagePackSerializerOptions
                .Standard
                .WithResolver(MessagePack.Resolvers.StandardResolver.Instance)
                .WithSecurity(MessagePackSecurity.UntrustedData);
    });
</span></code></pre>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>This change is part of moving to MessagePack v2.x, which was announced in <a href="https://github.com/aspnet/Announcements/issues/404" data-linktype="external">aspnet/Announcements#404</a>. The v2.x library has added an options API that's easier to use and provides more features than the list of <code>MessagePack.IFormatterResolver</code> that was exposed before.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>This breaking change affects anyone who is configuring values on <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.messagepackhubprotocoloptions" data-linktype="absolute-path">MessagePackHubProtocolOptions</a>. If you're using the ASP.NET Core SignalR MessagePack Hub Protocol and modifying the options, update your usage to use the new options API as shown above.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.messagepackhubprotocoloptions" data-linktype="absolute-path">Microsoft.AspNetCore.SignalR.MessagePackHubProtocolOptions</a></p>
<!--

#### Affected APIs

`T:Microsoft.AspNetCore.SignalR.MessagePackHubProtocolOptions`

-->
<hr>
<h3 id="signalr-usesignalr-and-useconnections-methods-removed"><a href="#signalr-usesignalr-and-useconnections-methods-removed" aria-labelledby="signalr-usesignalr-and-useconnections-methods-removed"></a>SignalR: UseSignalR and UseConnections methods removed</h3>
<p>In ASP.NET Core 3.0, SignalR adopted endpoint routing. As part of that change, the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.signalrappbuilderextensions.usesignalr" data-linktype="absolute-path">UseSignalR</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.connectionsappbuilderextensions.useconnections" data-linktype="absolute-path">UseConnections</a>, and some related methods were marked as obsolete. In ASP.NET Core 5.0, those obsolete methods were removed. For the full list of methods, see <a href="#affected-apis" data-linktype="self-bookmark">Affected APIs</a>.</p>
<p>For discussion on this issue, see <a href="https://github.com/dotnet/aspnetcore/issues/20082" data-linktype="external">dotnet/aspnetcore#20082</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 3</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>SignalR hubs and connection handlers could be registered in the middleware pipeline using the <code>UseSignalR</code> or <code>UseConnections</code> methods.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>SignalR hubs and connection handlers should be registered within <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.endpointroutingapplicationbuilderextensions.useendpoints" data-linktype="absolute-path">UseEndpoints</a> using the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.hubroutebuilder.maphub" data-linktype="absolute-path">MapHub</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.connections.connectionsroutebuilder.mapconnectionhandler" data-linktype="absolute-path">MapConnectionHandler</a> extension methods on <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.routing.iendpointroutebuilder" data-linktype="absolute-path">IEndpointRouteBuilder</a>.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>The old methods had custom routing logic that didn't interact with other routing components in ASP.NET Core. In ASP.NET Core 3.0, a new general-purpose routing system, called endpoint routing, was introduced. Endpoint routing enabled SignalR to interact with other routing components. Switching to this model allows users to realize the full benefits of endpoint routing. Consequently, the old methods have been removed.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Remove code that calls <code>UseSignalR</code> or <code>UseConnections</code> from your project's <code>Startup.Configure</code> method. Replace it with calls to <code>MapHub</code> or <code>MapConnectionHandler</code>, respectively, within the body of a call to <code>UseEndpoints</code>. For example:</p>
<p><strong>Old code:</strong></p>
<pre tabindex="0"><code data-author-content="app.UseSignalR(routes =>
{
    routes.MapHub<SomeHub>(&quot;/path&quot;);
});
"><span>app.UseSignalR(routes =&gt;
{
    routes.MapHub&lt;SomeHub&gt;(<span>"/path"</span>);
});
</span></code></pre>
<p><strong>New code:</strong></p>
<pre tabindex="0"><code data-author-content="app.UseEndpoints(endpoints =>
{
    endpoints.MapHub<SomeHub>(&quot;/path&quot;);
});
"><span>app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapHub&lt;SomeHub&gt;(<span>"/path"</span>);
});
</span></code></pre>
<p>In general, your previous <code>MapHub</code> and <code>MapConnectionHandler</code> calls can be transferred directly from the body of <code>UseSignalR</code> and <code>UseConnections</code> to <code>UseEndpoints</code> with little-to-no change needed.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.connectionsappbuilderextensions.useconnections" data-linktype="absolute-path">ConnectionsAppBuilderExtensions.UseConnections</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.signalrappbuilderextensions.usesignalr" data-linktype="absolute-path">SignalRAppBuilderExtensions.UseSignalR</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.connections.connectionsroutebuilder.mapconnections" data-linktype="absolute-path">ConnectionsRouteBuilder.MapConnections</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.connections.connectionsroutebuilder.mapconnectionhandler" data-linktype="absolute-path">ConnectionsRouteBuilder.MapConnectionHandler</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.signalr.hubroutebuilder.maphub" data-linktype="absolute-path">HubRouteBuilder.MapHub</a></li>
</ul>
<!--

#### Affected APIs

- `Overload:Microsoft.AspNetCore.Builder.ConnectionsAppBuilderExtensions.UseConnections`
- `Overload:Microsoft.AspNetCore.Builder.SignalRAppBuilderExtensions.UseSignalR`
- `Overload:Microsoft.AspNetCore.Http.Connections.ConnectionsRouteBuilder.MapConnections`
- `Overload:Microsoft.AspNetCore.Http.Connections.ConnectionsRouteBuilder.MapConnectionHandler`
- `Overload:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub`

-->
<hr>
<h3 id="static-files-csv-content-type-changed-to-standards-compliant"><a href="#static-files-csv-content-type-changed-to-standards-compliant" aria-labelledby="static-files-csv-content-type-changed-to-standards-compliant"></a>Static files: CSV content type changed to standards-compliant</h3>
<p>In ASP.NET Core 5.0, the default <code>Content-Type</code> response header value that the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files" data-linktype="absolute-path">Static File Middleware</a> uses for <em>.csv</em> files has changed to the standards-compliant value <code>text/csv</code>.</p>
<p>For discussion on this issue, see <a href="https://github.com/dotnet/AspNetCore/issues/17385" data-linktype="external">dotnet/aspnetcore#17385</a>.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="old-behavior"><a href="#old-behavior" aria-labelledby="old-behavior"></a>Old behavior</h4>
<p>The <code>Content-Type</code> header value <code>application/octet-stream</code> was used.</p>
<h4 id="new-behavior"><a href="#new-behavior" aria-labelledby="new-behavior"></a>New behavior</h4>
<p>The <code>Content-Type</code> header value <code>text/csv</code> is used.</p>
<h4 id="reason-for-change"><a href="#reason-for-change" aria-labelledby="reason-for-change"></a>Reason for change</h4>
<p>Compliance with the <a href="https://tools.ietf.org/html/rfc7111#section-5.1" data-linktype="external">RFC 7111</a> standard.</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>If this change impacts your app, you can customize the file extension-to-MIME type mapping. To revert to the <code>application/octet-stream</code> MIME type, modify the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles" data-linktype="absolute-path">UseStaticFiles</a> method call in <code>Startup.Configure</code>. For example:</p>
<pre tabindex="0"><code data-author-content="var provider = new FileExtensionContentTypeProvider();
provider.Mappings[&quot;.csv&quot;] = MediaTypeNames.Application.Octet;

app.UseStaticFiles(new StaticFileOptions
{
    ContentTypeProvider = provider
});
"><span><span>var</span> provider = <span>new</span> FileExtensionContentTypeProvider();
provider.Mappings[<span>".csv"</span>] = MediaTypeNames.Application.Octet;

app.UseStaticFiles(<span>new</span> StaticFileOptions
{
    ContentTypeProvider = provider
});
</span></code></pre>
<p>For more information on customizing the mapping, see <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files#fileextensioncontenttypeprovider" data-linktype="absolute-path">FileExtensionContentTypeProvider</a>.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>ASP.NET Core</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.staticfiles.fileextensioncontenttypeprovider" data-linktype="absolute-path">Microsoft.AspNetCore.StaticFiles.FileExtensionContentTypeProvider</a></p>
<!--

#### Affected APIs

`T:Microsoft.AspNetCore.StaticFiles.FileExtensionContentTypeProvider`

-->
<hr>
<h2 id="core-net-libraries"><a href="#core-net-libraries" aria-labelledby="core-net-libraries"></a>Core .NET libraries</h2>
<ul>
<li><a href="#sse-and-sse2-comparegreaterthan-methods-properly-handle-nan-inputs" data-linktype="self-bookmark">SSE and SSE2 CompareGreaterThan methods properly handle NaN inputs</a></li>
<li><a href="#countersetcreatecountersetinstance-now-throws-invalidoperationexception-if-instance-already-exists" data-linktype="self-bookmark">CounterSet.CreateCounterSetInstance now throws InvalidOperationException if instance already exist</a></li>
</ul>
<h3 id="sse-and-sse2-comparegreaterthan-methods-properly-handle-nan-inputs"><a href="#sse-and-sse2-comparegreaterthan-methods-properly-handle-nan-inputs" aria-labelledby="sse-and-sse2-comparegreaterthan-methods-properly-handle-nan-inputs"></a>SSE and SSE2 CompareGreaterThan methods properly handle NaN inputs</h3>
<p>The following <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2</a> methods have been fixed to properly handle <code>NaN</code> inputs and match the hardware behavior of the equivalent methods in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.avx" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Avx</a> class:</p>
<ul>
<li><code>CompareGreaterThan</code></li>
<li><code>CompareGreaterThanOrEqual</code></li>
<li><code>CompareNotGreaterThan</code></li>
<li><code>CompareNotGreaterThanOrEqual</code></li>
<li><code>CompareScalarGreaterThan</code></li>
<li><code>CompareScalarGreaterThanOrEqual</code></li>
<li><code>CompareScalarNotGreaterThan</code></li>
<li><code>CompareScalarNotGreaterThanOrEqual</code></li>
</ul>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Previously, <code>NaN</code> inputs to the listed <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse" data-linktype="absolute-path">Sse</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2" data-linktype="absolute-path">Sse2</a> methods returned an incorrect result. The result also differed from the result generated by the corresponding method in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.avx" data-linktype="absolute-path">Avx</a> class.</p>
<p>Starting in .NET 5.0, these methods correctly handle <code>NaN</code> inputs and return the same results as the corresponding methods in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.avx" data-linktype="absolute-path">Avx</a> class.</p>
<p>The Streaming SIMD Extensions (SSE) and Streaming SIMD Extensions 2 (SSE2) industry standard architectures (ISAs) don't provide direct hardware support for these comparison methods, so they're implemented in software. Previously, the methods were improperly implemented, and they incorrectly handled <code>NaN</code> inputs. For code ported from native, the incorrect behavior may introduce bugs. For a 256-bit code path, the methods can also produce different results to the equivalent methods in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.avx" data-linktype="absolute-path">Avx</a> class.</p>
<p>As an example of how the methods were previously incorrect, you can implement <code>CompareNotGreaterThan(x,y)</code> as <code>CompareLessThanOrEqual(x,y)</code> for regular integers. However, for <code>NaN</code> inputs, that logic computes the wrong result. Instead, using <code>CompareNotLessThan(y,x)</code> compares the numbers correctly <em>and</em> takes <code>NaN</code> inputs into consideration.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 4</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<ul>
<li><p>If the previous behavior was a bug, no change is required.</p>
</li>
<li><p>If the previous behavior was desired, you can maintain that behavior by changing the relevant invocation as follows:</p>
<ul>
<li><code>CompareGreaterThan(x,y)</code> -&gt; <code>CompareNotLessThanOrEqual(x,y)</code></li>
<li><code>CompareGreaterThanOrEqual(x,y)</code> -&gt; <code>CompareNotLessThan(x,y)</code></li>
<li><code>CompareNotGreaterThan(x,y)</code> -&gt; <code>CompareLessThanOrEqual(x,y)</code></li>
<li><code>CompareNotGreaterThanOrEqual(x,y)</code> -&gt; <code>CompareLessThan(x,y)</code></li>
<li><code>CompareScalarGreaterThan(x,y)</code> -&gt; <code>CompareScalarNotLessThanOrEqual(x,y)</code></li>
<li><code>CompareScalarGreaterThanOrEqual(x,y)</code> -&gt; <code>CompareScalarNotLessThan(x,y)</code></li>
<li><code>CompareScalarNotGreaterThan(x,y)</code> -&gt; <code>CompareScalarLessThanOrEqual(x,y)</code></li>
<li><code>CompareScalarNotGreaterThanOrEqual(x,y)</code> -&gt; <code>CompareScalarLessThan(x,y)</code></li>
</ul>
</li>
</ul>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Core .NET libraries</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparegreaterthan#System_Runtime_Intrinsics_X86_Sse_CompareGreaterThan_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareGreaterThan(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparegreaterthanorequal#System_Runtime_Intrinsics_X86_Sse_CompareGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareGreaterThanOrEqual(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparenotgreaterthan#System_Runtime_Intrinsics_X86_Sse_CompareNotGreaterThan_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThan(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparenotgreaterthanorequal#System_Runtime_Intrinsics_X86_Sse_CompareNotGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThanOrEqual(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparescalargreaterthan#System_Runtime_Intrinsics_X86_Sse_CompareScalarGreaterThan_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThan(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparescalargreaterthanorequal#System_Runtime_Intrinsics_X86_Sse_CompareScalarGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThanOrEqual(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparescalarnotgreaterthan#System_Runtime_Intrinsics_X86_Sse_CompareScalarNotGreaterThan_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThan(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse.comparescalarnotgreaterthanorequal#System_Runtime_Intrinsics_X86_Sse_CompareScalarNotGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Single__System_Runtime_Intrinsics_Vector128_System_Single__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThanOrEqual(Vector128&lt;Single&gt;, Vector128&lt;Single&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparegreaterthan#System_Runtime_Intrinsics_X86_Sse2_CompareGreaterThan_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThan(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparegreaterthanorequal#System_Runtime_Intrinsics_X86_Sse2_CompareGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThanOrEqual(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparenotgreaterthan#System_Runtime_Intrinsics_X86_Sse2_CompareNotGreaterThan_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThan(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparenotgreaterthanorequal#System_Runtime_Intrinsics_X86_Sse2_CompareNotGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThanOrEqual(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparescalargreaterthan#System_Runtime_Intrinsics_X86_Sse2_CompareScalarGreaterThan_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThan(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparescalargreaterthanorequal#System_Runtime_Intrinsics_X86_Sse2_CompareScalarGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThanOrEqual(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparescalarnotgreaterthan#System_Runtime_Intrinsics_X86_Sse2_CompareScalarNotGreaterThan_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThan(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
<li><p><a href="https://docs.microsoft.com/en-us/dotnet/api/system.runtime.intrinsics.x86.sse2.comparescalarnotgreaterthanorequal#System_Runtime_Intrinsics_X86_Sse2_CompareScalarNotGreaterThanOrEqual_System_Runtime_Intrinsics_Vector128_System_Double__System_Runtime_Intrinsics_Vector128_System_Double__" data-linktype="absolute-path">System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThanOrEqual(Vector128&lt;Double&gt;, Vector128&lt;Double&gt;)</a></p>
</li>
</ul>
<!--

#### Affected APIs

- `M:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`
- `M:System.Runtime.Intrinsics.X86.Sse.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Single},System.Runtime.Intrinsics.Vector128{System.Single})`

- `M:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThan(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`
- `M:System.Runtime.Intrinsics.X86.Sse2.CompareScalarNotGreaterThanOrEqual(System.Runtime.Intrinsics.Vector128{System.Double},System.Runtime.Intrinsics.Vector128{System.Double})`

-->
<hr>
<h3 id="countersetcreatecountersetinstance-now-throws-invalidoperationexception-if-instance-already-exists"><a href="#countersetcreatecountersetinstance-now-throws-invalidoperationexception-if-instance-already-exists" aria-labelledby="countersetcreatecountersetinstance-now-throws-invalidoperationexception-if-instance-already-exists"></a>CounterSet.CreateCounterSetInstance now throws InvalidOperationException if instance already exists</h3>
<p>Starting in .NET 5.0, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.performancedata.counterset.createcountersetinstance#System_Diagnostics_PerformanceData_CounterSet_CreateCounterSetInstance_System_String_" data-linktype="absolute-path">CounterSet.CreateCounterSetInstance(String)</a> throws an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.invalidoperationexception" data-linktype="absolute-path">InvalidOperationException</a> instead of an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> if the counter set already exists.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>In .NET Framework and .NET Core 1.0 to 3.1, you can create an instance of the counter set by calling <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.performancedata.counterset.createcountersetinstance" data-linktype="absolute-path">CreateCounterSetInstance</a>. However, if the counter set already exists, the method throws an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> exception.</p>
<p>In .NET 5.0 and later versions, when you call <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.performancedata.counterset.createcountersetinstance" data-linktype="absolute-path">CreateCounterSetInstance</a> and the counter set exists, an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.invalidoperationexception" data-linktype="absolute-path">InvalidOperationException</a> exception is thrown.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 5</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>If you catch <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> exceptions in your app when calling <a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.performancedata.counterset.createcountersetinstance" data-linktype="absolute-path">CreateCounterSetInstance</a>, consider also catching <a href="https://docs.microsoft.com/en-us/dotnet/api/system.invalidoperationexception" data-linktype="absolute-path">InvalidOperationException</a> exceptions.</p>

<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Core .NET libraries</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.diagnostics.performancedata.counterset.createcountersetinstance" data-linktype="absolute-path">System.Diagnostics.PerformanceData.CounterSet.CreateCounterSetInstance</a></li>
</ul>
<!--

#### Affected APIs

- `M:System.Diagnostics.PerformanceData.CounterSet.CreateCounterSetInstance(System.String)`

-->
<hr>
<h2 id="globalization"><a href="#globalization" aria-labelledby="globalization"></a>Globalization</h2>
<ul>
<li><a href="#stringinfo-and-textelementenumerator-are-now-uax29-compliant" data-linktype="self-bookmark">StringInfo and TextElementEnumerator are now UAX29-compliant</a></li>
<li><a href="#globalization-apis-use-icu-libraries-on-windows" data-linktype="self-bookmark">Globalization APIs use ICU libraries on Windows</a></li>
</ul>
<h3 id="stringinfo-and-textelementenumerator-are-now-uax29-compliant"><a href="#stringinfo-and-textelementenumerator-are-now-uax29-compliant" aria-labelledby="stringinfo-and-textelementenumerator-are-now-uax29-compliant"></a>StringInfo and TextElementEnumerator are now UAX29-compliant</h3>
<p>Prior to this change, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">System.Globalization.StringInfo</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">System.Globalization.TextElementEnumerator</a> didn't properly handle all grapheme clusters. Some graphemes were split into their constituent components instead of being kept together. Now, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">StringInfo</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">TextElementEnumerator</a> process grapheme clusters according to the latest version of the Unicode Standard.</p>
<p>In addition, the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.strings.strreverse" data-linktype="absolute-path">Microsoft.VisualBasic.Strings.StrReverse</a> method, which reverses the characters in a string in Visual Basic, now also follows the Unicode standard for grapheme clusters.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>A <a href="https://www.unicode.org/glossary/#grapheme" data-linktype="external">grapheme</a> or <a href="https://www.unicode.org/glossary/#extended_grapheme_cluster" data-linktype="external">extended grapheme cluster</a> is a single user-perceived character that may be made up of multiple Unicode code points. For example, the string containing the Thai character "kam" () consists of the following two characters:</p>
<ul>
<li> (= '') THAI CHARACTER KO KAI</li>
<li> (= '') THAI CHARACTER SARA AM</li>
</ul>
<p>When displayed to the user, the operating system combines the two characters to form the single display character (or grapheme) "kam" or . Emoji can also consist of multiple characters that are combined for display in a similar way.</p>
<div>
<p><span aria-hidden="true"></span> Tip</p>
<p>The .NET documentation sometimes uses the term "text element" when referring to a grapheme.</p>
</div>
<p>The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">StringInfo</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">TextElementEnumerator</a> classes inspect strings and return information about the graphemes they contain. In .NET Framework (all versions) and .NET Core 3.x and earlier, these two classes use custom logic that handles some combining classes but doesn't fully comply with the <a href="https://www.unicode.org/reports/tr29/tr29-35.html#Grapheme_Cluster_Boundaries" data-linktype="external">Unicode Standard</a>. For example, the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">StringInfo</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">TextElementEnumerator</a> classes incorrectly split the single Thai character "kam" back into its constituent components instead of keeping them together. These classes also incorrectly split the emoji character "" into four clusters (person shrugging, skin tone modifier, gender modifier, and an invisible combiner) instead of keeping them together as a single grapheme cluster.</p>
<p>Starting with .NET 5, the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">StringInfo</a> and <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">TextElementEnumerator</a> classes implement the Unicode standard as defined by <a href="https://www.unicode.org/reports/tr29/tr29-35.html" data-linktype="external">Unicode Standard Annex #29, rev. 35, sec. 3</a>. In particular, they now return <a href="https://www.unicode.org/glossary/#extended_grapheme_cluster" data-linktype="external">extended grapheme clusters</a> for all combining classes.</p>
<p>Consider the following C# code:</p>
<pre tabindex="0"><code data-author-content="using System.Globalization;

static void Main(string[] args)
{
    PrintGraphemes(&quot;&quot;);
    PrintGraphemes(&quot;&quot;);
}

static void PrintGraphemes(string str)
{
    Console.WriteLine($&quot;Printing graphemes of &quot;{str}&quot;...&quot;);
    int i = 0;

    TextElementEnumerator enumerator = StringInfo.GetTextElementEnumerator(str);
    while (enumerator.MoveNext())
    {
        Console.WriteLine($&quot;Grapheme {++i}: &quot;{enumerator.Current}&quot;&quot;);
    }

    Console.WriteLine($&quot;({i} grapheme(s) total.)&quot;);
    Console.WriteLine();
}
"><span><span>using</span> System.Globalization;

<span><span>static</span> <span>void</span> <span>Main</span>(<span><span>string</span>[] args</span>)</span>
{
    PrintGraphemes(<span>""</span>);
    PrintGraphemes(<span>""</span>);
}

<span><span>static</span> <span>void</span> <span>PrintGraphemes</span>(<span><span>string</span> str</span>)</span>
{
    Console.WriteLine(<span>$"Printing graphemes of "<span>{str}</span>"..."</span>);
    <span>int</span> i = <span>0</span>;

    TextElementEnumerator enumerator = StringInfo.GetTextElementEnumerator(str);
    <span>while</span> (enumerator.MoveNext())
    {
        Console.WriteLine(<span>$"Grapheme <span>{++i}</span>: "<span>{enumerator.Current}</span>""</span>);
    }

    Console.WriteLine(<span>$"(<span>{i}</span> grapheme(s) total.)"</span>);
    Console.WriteLine();
}
</span></code></pre>
<p>In .NET Framework and .NET Core 3.x and earlier versions, the graphemes are split up, and the console output is as follows:</p>
<pre tabindex="0"><code data-author-content="Printing graphemes of &quot;&quot;...
Grapheme 1: &quot;&quot;
Grapheme 2: &quot;&quot;
(2 grapheme(s) total.)

Printing graphemes of &quot;&quot;...
Grapheme 1: &quot;&quot;
Grapheme 2: &quot;&quot;
Grapheme 3: &quot;&quot;
Grapheme 4: &quot;&quot;
(4 grapheme(s) total.)
">Printing graphemes of ""...
Grapheme 1: ""
Grapheme 2: ""
(2 grapheme(s) total.)

Printing graphemes of ""...
Grapheme 1: ""
Grapheme 2: ""
Grapheme 3: ""
Grapheme 4: ""
(4 grapheme(s) total.)
</code></pre>
<p>In .NET 5 and later versions, the graphemes are kept together, and the console output is as follows:</p>
<pre tabindex="0"><code data-author-content="Printing graphemes of &quot;&quot;...
Grapheme 1: &quot;&quot;
(1 grapheme(s) total.)

Printing graphemes of &quot;&quot;...
Grapheme 1: &quot;&quot;
(1 grapheme(s) total.)
">Printing graphemes of ""...
Grapheme 1: ""
(1 grapheme(s) total.)

Printing graphemes of ""...
Grapheme 1: ""
(1 grapheme(s) total.)
</code></pre>
<p>In addition, starting in .NET 5, the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.strings.strreverse" data-linktype="absolute-path">Microsoft.VisualBasic.Strings.StrReverse</a> method, which reverses the characters in a string in Visual Basic, now also follows the Unicode standard for grapheme clusters.</p>
<p>These changes are part of a wider set of Unicode and UTF-8 improvements in .NET, including an extended grapheme cluster enumeration API to complement the Unicode scalar-value enumeration APIs that were introduced with the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.text.rune" data-linktype="absolute-path">System.Text.Rune</a> type in .NET Core 3.0.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>.NET 5.0 Preview 1</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>You don't need to take any action. Your apps will automatically behave in a more standards-compliant manner in a variety of globalization-related scenarios.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Globalization</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.stringinfo" data-linktype="absolute-path">System.Globalization.StringInfo</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization.textelementenumerator" data-linktype="absolute-path">System.Globalization.TextElementEnumerator</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.visualbasic.strings.strreverse" data-linktype="absolute-path">Microsoft.VisualBasic.Strings.StrReverse</a></li>
</ul>
<!--

#### Affected APIs

- `T:System.Globalization.StringInfo`
- `T:System.Globalization.TextElementEnumerator`
- `Overload:Microsoft.VisualBasic.Strings.StrReverse`

-->
<hr>
<h3 id="globalization-apis-use-icu-libraries-on-windows"><a href="#globalization-apis-use-icu-libraries-on-windows" aria-labelledby="globalization-apis-use-icu-libraries-on-windows"></a>Globalization APIs use ICU libraries on Windows</h3>
<p>.NET 5.0 and later versions use <a href="http://site.icu-project.org/home" data-linktype="external">International Components for Unicode (ICU)</a> libraries for globalization functionality when running on Windows 10 May 2019 Update or later.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Previously, .NET libraries used <a href="https://docs.microsoft.com/en-us/windows/win32/intl/national-language-support" data-linktype="absolute-path">National Language Support (NLS)</a> APIs for globalization functionality. For example, NLS functions were used to get culture data, such as date and time format patterns, compare strings, and perform string casing in the appropriate culture.</p>
<p>Starting in .NET 5.0, if an app is running on Windows 10 May 2019 Update or later, .NET libraries use <a href="http://site.icu-project.org/home" data-linktype="external">ICU</a> globalization APIs. Windows 10 May 2019 Update and later versions ship with the ICU native library. If the .NET runtime can't load ICU, it uses NLS instead.</p>
<p>This change was introduced for two reasons:</p>
<ul>
<li>Apps have the same globalization behavior across platforms, including Linux, macOS, and Windows.</li>
<li>Apps can control globalization behavior by using custom ICU libraries.</li>
</ul>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>.NET 5.0 Preview 4</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>No action is required on the part of the developer. However, if you wish to continue using NLS globalization APIs, you can set a <a href="https://docs.microsoft.com/en-us/dotnet/core/run-time-config/globalization#nls" data-linktype="relative-path">run-time switch</a> to revert to that behavior.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Globalization</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.span-1" data-linktype="absolute-path">System.Span&lt;T&gt;</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.string" data-linktype="absolute-path">System.String</a></li>
<li>Most types in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.globalization" data-linktype="absolute-path">System.Globalization</a> namespace</li>
</ul>
<!--

#### Affected APIs

- `T:System.Span%601`
- `T:System.String`
- `N:System.Globalization`

-->
<hr>
<h2 id="windows-forms"><a href="#windows-forms" aria-labelledby="windows-forms"></a>Windows Forms</h2>
<ul>
<li><a href="#removed-status-bar-controls" data-linktype="self-bookmark">Removed status bar controls</a></li>
<li><a href="#winforms-methods-now-throw-argumentexception" data-linktype="self-bookmark">WinForms methods now throw ArgumentException</a></li>
<li><a href="#winforms-methods-now-throw-argumentnullexception" data-linktype="self-bookmark">WinForms methods now throw ArgumentNullException</a></li>
<li><a href="#winforms-properties-now-throw-argumentoutofrangeexception" data-linktype="self-bookmark">WinForms properties now throw ArgumentOutOfRangeException</a></li>
</ul>
<h3 id="removed-status-bar-controls"><a href="#removed-status-bar-controls" aria-labelledby="removed-status-bar-controls"></a>Removed status bar controls</h3>
<p>Starting in .NET 5.0 Preview 1, some Windows Forms controls are no longer available.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Starting with .NET 5.0 Preview 1, some of the status bar-related Windows Forms controls are no longer available. Replacement controls that have better design and support were introduced in .NET Framework 2.0. The deprecated controls were previously removed from designer toolboxes but were still available to be used. Now, they have been completely removed.</p>
<p>The following types are no longer available:</p>
<ul>
<li><code>StatusBar</code></li>
<li><code>StatusBarDrawItemEventArgs</code></li>
<li><code>StatusBarDrawItemEventHandler</code></li>
<li><code>StatusBarPanel</code></li>
<li><code>StatusBarPanelAutoSize</code></li>
<li><code>StatusBarPanelBorderStyle</code></li>
<li><code>StatusBarPanelClickEventArgs</code></li>
<li><code>StatusBarPanelClickEventHandler</code></li>
<li><code>StatusBarPanelStyle</code></li>
</ul>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>5.0 Preview 1</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>Move to the replacement APIs for these controls and their scenarios:</p>

<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Windows Forms</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbar" data-linktype="absolute-path">System.Windows.Forms.StatusBar</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbardrawitemeventargs" data-linktype="absolute-path">System.Windows.Forms.StatusBarDrawItemEventArgs</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbardrawitemeventhandler" data-linktype="absolute-path">System.Windows.Forms.StatusBarDrawItemEventHandler</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanel" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanel</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanelautosize" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanelAutoSize</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanelborderstyle" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanelBorderStyle</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanelclickeventargs" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanelClickEventArgs</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanelclickeventhandler" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanelClickEventHandler</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.statusbarpanelstyle" data-linktype="absolute-path">System.Windows.Forms.StatusBarPanelStyle</a></li>
</ul>
<!-- 

#### Affected APIs

- `T:System.Windows.Forms.StatusBar`
- `T:System.Windows.Forms.StatusBarDrawItemEventArgs`
- `T:System.Windows.Forms.StatusBarDrawItemEventHandler`
- `T:System.Windows.Forms.StatusBarPanel`
- `T:System.Windows.Forms.StatusBarPanelAutoSize`
- `T:System.Windows.Forms.StatusBarPanelBorderStyle`
- `T:System.Windows.Forms.StatusBarPanelClickEventArgs`
- `T:System.Windows.Forms.StatusBarPanelClickEventHandler`
- `T:System.Windows.Forms.StatusBarPanelStyle` 

-->
<hr>
<h3 id="winforms-methods-now-throw-argumentexception"><a href="#winforms-methods-now-throw-argumentexception" aria-labelledby="winforms-methods-now-throw-argumentexception"></a>WinForms methods now throw ArgumentException</h3>
<p>Some Windows Forms methods now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> for invalid arguments, where previously they did not.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Previously, passing arguments of an unexpected or incorrect type to certain Windows Forms methods would result in an indeterminate state. Starting in .NET 5.0, these methods now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> when passed invalid arguments.</p>
<p>Throwing an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> conforms to the behavior of the .NET runtime. It also improves the debugging experience by clearly communicating which argument is invalid.</p>
<p>The following table lists the affected methods and parameters:</p>

<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>.NET 5.0</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<ul>
<li>Update the code to prevent passing invalid arguments.</li>
<li>If necessary, handle an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a> when calling the method.</li>
</ul>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Windows Forms</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.tabcontrol.gettooltiptext#System_Windows_Forms_TabControl_GetToolTipText_System_Object_" data-linktype="absolute-path">System.Windows.Forms.TabControl.GetToolTipText(Object)</a></li>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.dataformats.getformat#System_Windows_Forms_DataFormats_GetFormat_System_String_" data-linktype="absolute-path">System.Windows.Forms.DataFormats.GetFormat(String)</a></li>
</ul>
<!-- 

#### Affected APIs

- `M:System.Windows.Forms.TabControl.GetToolTipText(System.Object)`
- `M:System.Windows.Forms.DataFormats.GetFormat(System.String)`

-->
<hr>
<h3 id="winforms-methods-now-throw-argumentnullexception"><a href="#winforms-methods-now-throw-argumentnullexception" aria-labelledby="winforms-methods-now-throw-argumentnullexception"></a>WinForms methods now throw ArgumentNullException</h3>
<p>Some Windows Forms methods now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentnullexception" data-linktype="absolute-path">ArgumentNullException</a> for null arguments, where previously they threw a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.nullreferenceexception" data-linktype="absolute-path">NullReferenceException</a>.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Previously, certain Windows Forms methods threw a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.nullreferenceexception" data-linktype="absolute-path">NullReferenceException</a> if passed an argument that was null. Starting in .NET 5.0, these methods now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentnullexception" data-linktype="absolute-path">ArgumentNullException</a> for null arguments, instead.</p>
<p>Throwing an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentnullexception" data-linktype="absolute-path">ArgumentNullException</a> conforms to the behavior of the .NET runtime. It also improves the debugging experience by clearly communicating that an argument is null and which argument it is.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>.NET 5.0</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<p>If you call any of these methods and your code currently catches a <a href="https://docs.microsoft.com/en-us/dotnet/api/system.nullreferenceexception" data-linktype="absolute-path">NullReferenceException</a> for null arguments, catch an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentnullexception" data-linktype="absolute-path">ArgumentNullException</a> instead. In addition, consider updating the code to prevent passing null arguments to the listed methods.</p>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Windows Forms</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p>The following table lists the affected methods and parameters:</p>

<!-- 

#### Affected APIs

- `M:System.Windows.Forms.Control.ControlCollection.#ctor(System.Windows.Forms.Control)`
- `M:System.Windows.Forms.TabControl.GetToolTipText(System.Object)`
- `M:System.Windows.Forms.TableLayoutControlCollection.#ctor(System.Windows.Forms.TableLayoutPanel)`
- `M:System.Windows.Forms.ToolStripRenderer.OnRenderArrow(System.Windows.Forms.ToolStripArrowRenderEventArgs)`
- `M:System.Windows.Forms.ToolStripRenderer.OnRenderItemImage(System.Windows.Forms.ToolStripItemImageRenderEventArgs)`
- `M:System.Windows.Forms.ToolStripRenderer.OnRenderItemCheck(System.Windows.Forms.ToolStripItemImageRenderEventArgs)`
- `M:System.Windows.Forms.ToolStripRenderer.OnRenderItemText(System.Windows.Forms.ToolStripItemTextRenderEventArgs)`
- `M:System.Windows.Forms.ToolStripRenderer.OnRenderStatusStripSizingGrip(System.Windows.Forms.ToolStripRenderEventArgs)`
- `M:System.Windows.Forms.DataGridViewComboBoxEditingControl.ApplyCellStyleToEditingControl(System.Windows.Forms.DataGridViewCellStyle)`
- `M:System.Windows.Forms.RichTextBox.LoadFile(System.IO.Stream,System.Windows.Forms.RichTextBoxStreamType)`
- `M:System.Windows.Forms.ListViewGroup.System%23Runtime%23Serialization%23ISerializable%23GetObjectData(System.Runtime.Serialization.SerializationInfo,System.Runtime.Serialization.StreamingContext)`
- `M:System.Windows.Forms.VisualStyles.VisualStyleRenderer.%23ctor(System.String,System.Int32,System.Int32)`
- `M:System.Windows.Forms.ListBox.IntegerCollection.%23ctor(System.Windows.Forms.ListBox)`
- `M:System.Windows.Forms.ListBox.IntegerCollection.CopyTo(System.Array,System.Int32)`

-->
<hr>
<h3 id="winforms-properties-now-throw-argumentoutofrangeexception"><a href="#winforms-properties-now-throw-argumentoutofrangeexception" aria-labelledby="winforms-properties-now-throw-argumentoutofrangeexception"></a>WinForms properties now throw ArgumentOutOfRangeException</h3>
<p>Some Windows Forms properties now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentoutofrangeexception" data-linktype="absolute-path">ArgumentOutOfRangeException</a> for invalid arguments, where previously they did not.</p>
<h4 id="change-description"><a href="#change-description" aria-labelledby="change-description"></a>Change description</h4>
<p>Previously, these properties threw various exceptions, such as <a href="https://docs.microsoft.com/en-us/dotnet/api/system.nullreferenceexception" data-linktype="absolute-path">NullReferenceException</a>, <a href="https://docs.microsoft.com/en-us/dotnet/api/system.indexoutofrangeexception" data-linktype="absolute-path">IndexOutOfRangeException</a>, or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentexception" data-linktype="absolute-path">ArgumentException</a>, when passed out-of-range arguments. Starting in .NET 5.0, these properties now throw an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentoutofrangeexception" data-linktype="absolute-path">ArgumentOutOfRangeException</a> when passed arguments that are out of range.</p>
<p>Throwing an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentoutofrangeexception" data-linktype="absolute-path">ArgumentOutOfRangeException</a> conforms to the behavior of the .NET runtime. It also improves the debugging experience by clearly communicating which argument is invalid.</p>
<h4 id="version-introduced"><a href="#version-introduced" aria-labelledby="version-introduced"></a>Version introduced</h4>
<p>.NET 5.0</p>
<h4 id="recommended-action"><a href="#recommended-action" aria-labelledby="recommended-action"></a>Recommended action</h4>
<ul>
<li>Update the code to prevent passing invalid arguments.</li>
<li>If necessary, handle an <a href="https://docs.microsoft.com/en-us/dotnet/api/system.argumentoutofrangeexception" data-linktype="absolute-path">ArgumentOutOfRangeException</a> when setting the property.</li>
</ul>
<h4 id="category"><a href="#category" aria-labelledby="category"></a>Category</h4>
<p>Windows Forms</p>
<h4 id="affected-apis"><a href="#affected-apis" aria-labelledby="affected-apis"></a>Affected APIs</h4>
<p>The following table lists the affected properties and parameters:</p>

<!-- 

#### Affected APIs

- `P:System.Windows.Forms.ListBox.IntegerCollection.Item(System.Int32)`
- `P:System.Windows.Forms.TreeNode.ImageIndex`
- `P:System.Windows.Forms.TreeNode.SelectedImageIndex`

-->
<hr>

						<!-- </content> -->

						</main>

						<!-- recommended content page section -->

							<nav data-bi-name="recommendation-bottom" hidden="" id="recommended-content-center" aria-labelledby="recommended-content-center-title">
								<h3 id="recommended-content-center-title">Related Articles</h3>
							</nav>

						<!-- end recommended content page section -->

						<!-- page rating section -->
								
						<!-- end page rating section -->


						<!-- feedback section -->
<section data-bi-name="feedback-section">

    <h2 id="feedback">Feedback</h2>

    <div>
        <p aria-hidden="true" id="send-feedback-about">Submit and view feedback for</p>

        
    </div>

    
</section>

						<!-- end feedback section -->

						<!-- feedback report section -->
						<!-- end feedback report section -->

						
					</div>

					

					<!--end of div.columns -->
				</div>

			<!--end of .primary-holder -->
			</section>

			
		</div>

		<!--end of .mainContainer -->
	</div>

	

	

		
		
	
	<span id="adobe-target-experiment-container" hidden=""></span>


</div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>