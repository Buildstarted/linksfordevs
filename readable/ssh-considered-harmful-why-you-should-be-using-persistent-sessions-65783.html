<!DOCTYPE html>
<html lang="en">
<head>
    <title>
SSH Considered Harmful &#x2013; Why You Should Be Using Persistent Sessions - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="SSH Considered Harmful &#x2013; Why You Should Be Using Persistent Sessions - linksfor.dev(s)"/>
    <meta property="article:author" content="RP"/>
    <meta property="og:description" content="No, there hasn&#x2019;t been any new vulnerability found in SSH, nor am I denying the usefulness of SSH as a building block in the dev toolchain. This article is about why you shouldn&#x2019;t be (an&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://software.rajivprab.com/2019/07/14/ssh-considered-harmful/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - SSH Considered Harmful &#x2013; Why You Should Be Using Persistent Sessions</title>
<div class="readable">
        <h1>SSH Considered Harmful &#x2013; Why You Should Be Using Persistent Sessions</h1>
            <div>by RP</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 17 Aug 2020</div>
        <p><a href="https://software.rajivprab.com/2019/07/14/ssh-considered-harmful/">https://software.rajivprab.com/2019/07/14/ssh-considered-harmful/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		
<div><figure><img loading="lazy" data-attachment-id="150" data-permalink="https://software.rajivprab.com/no-ssh/" data-orig-file="https://softwarerajivprab.files.wordpress.com/2019/07/no-ssh.png" data-orig-size="120,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="no-ssh" data-image-description="" data-medium-file="https://softwarerajivprab.files.wordpress.com/2019/07/no-ssh.png?w=120" data-large-file="https://softwarerajivprab.files.wordpress.com/2019/07/no-ssh.png?w=120" src="https://softwarerajivprab.files.wordpress.com/2019/07/no-ssh.png" alt="" width="120" height="120"></figure></div>



<p>No, there hasn’t been any new vulnerability found in SSH, nor am I denying the usefulness of SSH as a <em>building block</em> in the dev toolchain. This article is about why you shouldn’t be (and how you can avoid) using <em>raw</em> SSH sessions for development work.</p>



<hr>



<p>Here’s a little story. I spent many years working in tech, and repeatedly ran into an annoying problem. I would ssh into a remote host from my laptop, do a bunch of work, and eventually get disconnected for whatever reason. And as soon as I disconnected, I would lose a whole bunch of ssh-session context. Upon reconnecting, I had to reopen multiple terminals, navigate each of them to the directory they were in, and reopen any files that I previously had open.</p>



<p>I grumbled about it all the time, but did nothing about it. Until one day when I ran into a killer problem. I had to run a multi-hour job on the remote host, but had to disconnect my laptop and take it home soon. I briefly researched using <a rel="noreferrer noopener" aria-label="nohup (opens in a new tab)" href="https://en.wikipedia.org/wiki/Nohup" target="_blank">nohup</a> to get the job done. But thankfully, I mentioned this problem to my lead, and he mentioned a tool that I had never heard of before. <em>“Start a screen session and run your command there.”</em></p>



<p>I did a little digging and found out that a <a href="https://kb.iu.edu/d/acuy" target="_blank" rel="noreferrer noopener" aria-label="screen (opens in a new tab)">screen</a> session is simply a persistent and recoverable session, that keeps running even after the ssh connection has ended. It seemed like a glorified nohup replacement, except that it preserved your entire terminal contents, not just the running process. I started using it for long running jobs, but it took me a little longer to realize that by using screen, I could eliminate all my frustrations with ssh-disconnects entirely. Even for something as simple as reading a log-file or coding, I could do it within a screen session in order to recover more easily from ssh disconnects.</p>



<p>With time, I discovered <a href="https://hackernoon.com/a-gentle-introduction-to-tmux-8d784c404340" target="_blank" rel="noreferrer noopener" aria-label="tmux (opens in a new tab)">tmux</a>, tmux-tabs, <a href="https://www.iterm2.com/documentation-tmux-integration.html" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">iterm integration</a>, and many more. Pretty soon, I realized that there was virtually no reason for me to ever use raw-ssh at all. By using tmux, even if I had 10 tabs open in 10 different directories running 10 different commands, I could still recover from a wifi disconnect within seconds, with no context loss at all. Why wasn’t this my default workflow all this time!?</p>



<hr>



<p>Obviously you still need to use raw ssh sessions if the remote host doesn’t have tmux installed. Besides that, the only reason for me to use ssh was as an intermediate step to start my tmux session. But I soon realized even that could be automated.</p>


<div><div id="highlighter_446030"><table><tbody><tr><td><p>1</p></td><td><div><p><code>function</code> <code>tsh { </code><code>ssh</code> <code>-X $1 -t </code><code>"tmux -CC attach -t $2 || tmux -CC new -s $2"</code><code>; }</code></p></div></td></tr></tbody></table></div></div>


<p>Just stick the above in your bashrc, and all you have to do from now on is run <code>tsh my-remote-host.mycorp.com main</code>, and you’ve seamlessly picked up from where you left off. No more messing with ssh or manually invoking tmux ever again.</p>



<p>The above may seem a little magical, so let’s break it down.</p>



<p><strong><em>“function tsh”</em></strong>: All this does is define “tsh” as a <a href="https://linuxize.com/post/bash-functions/">bash function</a>. Ie, a souped up alias.<br><em><strong>“ssh”</strong></em>: Your trusty ssh tool wrapped up in a function, so you’ll never have to touch it again.<br><em><strong>“-X”</strong></em>: Enables <a href="https://kb.iu.edu/d/bdnt">X11 forwarding</a>, for GUI support. You can omit this if desired.<br><em><strong>“$1”</strong></em>: Your first argument to the function, which should be the host you want to connect to.<br><em><strong>“-t”</strong></em>: Runs the following command on the remote host <a href="https://serverfault.com/questions/593399/what-is-the-benefit-of-not-allocating-a-terminal-in-ssh" target="_blank" rel="noreferrer noopener" aria-label="interactively in a pseudo-terminal (opens in a new tab)">interactively in a pseudo-terminal</a>.</p>



<p><em><strong>“tmux”</strong></em>: Runs tmux. Replace with screen if you like unreadable config files.<br><em><strong>“-CC”</strong></em>: Uses the iterm integration. Delete this if you’re not using iterm, or don’t like the integration.<br><strong><em>“$2”</em></strong>: Your second argument to the function, which should be the session name. You can replace this with a hardcoded name, if you only ever want one session per host.<br><strong><em>“attach -t $2”</em></strong>: Attaches to an existing tmux session with specified name.<br><em><strong>“|| tmux -CC new -s $2”</strong></em>: If the attach fails (because specified session-name does not exist), then start a new session with that name instead.</p>



<p>If you’re a fan of more verbose but readable code, here’s another version of the same function:</p>


<div><div id="highlighter_915693"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p></td><td><div><p><code>function</code> <code>tsh {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>host=$1</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>session_name=$2</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>[ -z </code><code>"$session_name"</code> <code>]; </code><code>then</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>echo</code> <code>"Need to provide session-name. Example: tsh &lt;hostname&gt; main"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>1;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>fi</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ssh</code> <code>-X $host -t </code><code>"tmux -CC attach -t $session_name || tmux -CC new -s $session_name"</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>


<p>And there you go. Your days of manually dealing with ssh sessions are now over, and you never need to fear session disconnects ever again.</p>



<hr>



<p><em>To anyone complaining about the title, please refer to the seminal “<a rel="noreferrer noopener" aria-label="Go To Considered Harmful (opens in a new tab)" href="https://homepages.cwi.nl/~storm/teaching/reader/Dijkstra68.pdf" target="_blank">Go To Considered Harmful</a>” paper, and its recommendation to use if-else statements, which are then converted by the compiler into lower level Go-To statements.</em></p>
	</div><div>
				<p><strong>Published</strong>
			<time datetime="2019-07-14T14:09:09+00:00">2019-07-14</time><time datetime="2020-01-28T16:11:31+00:00">2020-01-28</time>		</p><!-- .site-posted-on -->
	</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>