<!DOCTYPE html>
<html lang="en">
<head>
    <title>
StrathWeb. A free flowing web tech monologue. -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>StrathWeb. A free flowing web tech monologue.</h1>
    <div class="entry-content clearfix"> <p>When you compile your C#, F# or VB.NET code, which are all high-level managed languages, the relevant compiler doesn&#x2019;t compile it to native code, but instead it compiles it into the <a href="https://en.wikipedia.org/wiki/Common_Intermediate_Language">Common Intermedia Language</a>.</p>
<p>The IL code is then just-in-time (not always, but let&#x2019;s keep things simple) compiled by the CLR/CoreCLR to machine code that can be run on the CPU. What I wanted to show you today, is that with the new <em>Microsoft.NET.Sdk.IL</em> project SDK, it is actually quite easy to create and build projects in pure IL. </p>
<p>Let&#x2019;s have a look.</p> <h3 id="toc_1">Project SDKs</h3>
<p>The new project system for .NET allows usage of custom project SDKs to support building a wide array of application types. You add an SDK to your project at the top of the project file, for example, the standard one for libraries and console apps is <em>Microsoft.NET.Sdk</em>.</p>
<div> <div id="crayon-5df3a90555d9d476433731" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555d9d476433731-1"><span class="crayon-o">&lt;</span><span class="crayon-e">Project </span><span class="crayon-v">Sdk</span><span class="crayon-o">=</span><span class="crayon-s">&quot;Microsoft.NET.Sdk&quot;</span><span class="crayon-o">&gt;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>There are quite a few other project SDKs &#x2013; ASP.NET Core uses <em>Microsoft.NET.Sdk.Web</em>, .NET Core workers use <em>Microsoft.NET.Sdk.Worker</em> and so on. For the most part these things do not really concern the developers, as they are set from the project template and then never change.</p>
<p>One interesting project SDK that is not widely known, is <em>Microsoft.NET.Sdk.IL</em>. It allows us to write .NET code (libraries, applications) using pure IL, instead of a higher level language. This can then be built via dotnet CLI, using <a href="https://docs.microsoft.com/en-us/dotnet/framework/tools/ilasm-exe-il-assembler">ILASM</a> as desktop FX, .NET Core or .NET Standard.</p>
<h3 id="toc_2">Getting started with Microsoft.NET.Sdk.IL</h3>
<p>The SDK is actually not published to the public NuGet feed &#x2013; therefore to take advantage of it, you need to add a custom NuGet feed of Core CLR to your <em>NuGet.config</em>.</p>
<div> <div id="crayon-5df3a90555daf778166556" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
https://dotnet.myget.org/feed/dotnet-core/package/nuget/Microsoft.NET.Sdk.IL</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555daf778166556-1"><span class="crayon-v">https</span><span class="crayon-o">:</span><span class="crayon-c">//dotnet.myget.org/feed/dotnet-core/package/nuget/Microsoft.NET.Sdk.IL</span></div></div></td> </tr> </table> </div> </div> </div>
<p>This is the old feed, but it&#x2019;s where we can find the &#x201C;old&#x201D; version of the SDK, that was built for .NET Core 3.0. On the <a href="https://dotnetfeed.blob.core.windows.net/dotnet-coreclr/index.json">new feed</a>, there is currently only latest build available, that&#x2019;s already adapted towards .NET 5.0 (or .NET Core 5.0, the name is apparently not set yet).</p>
<p>Once the feed is added, you could also add the following <em>global.json</em> file, indicating that the SDK of this particular version should be used:</p>
<div> <div id="crayon-5df3a90555dbb470244352" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
{
    &quot;msbuild-sdks&quot;: 
    {
      &quot;Microsoft.NET.Sdk.IL&quot;: &quot;3.0.0-preview-27318-01&quot;
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555dbb470244352-4"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-s">&quot;Microsoft.NET.Sdk.IL&quot;</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">&quot;3.0.0-preview-27318-01&quot;</span></div></div></td> </tr> </table> </div> </div> </div>
<h3 id="toc_3">Bootstrapping an IL project</h3>
<p>Equipped with such setup, we could create our project. The extension for IL projects is <em>ilproj</em>, but structurally it is very similar to <em>csproj</em>.</p>
<p>In my case it will look the following:</p>
<div> <div id="crayon-5df3a90555dc6589588117" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
&lt;Project Sdk=&quot;Microsoft.NET.Sdk.IL&quot;&gt;
    &lt;PropertyGroup&gt;
        &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;
        &lt;MicrosoftNetCoreIlasmPackageVersion&gt;3.0.0-preview-27318-01&lt;/MicrosoftNetCoreIlasmPackageVersion&gt;
        &lt;IncludePath Condition=&quot;&apos;$(TargetFramework)&apos; == &apos;netstandard2.0&apos;&quot;&gt;include\netstandard&lt;/IncludePath&gt;
        &lt;IlasmFlags&gt;$(IlasmFlags) -INCLUDE=$(IncludePath)&lt;/IlasmFlags&gt;
    &lt;/PropertyGroup&gt;
&lt;/Project&gt;</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555dc6589588117-1"><span class="crayon-o">&lt;</span><span class="crayon-e">Project </span><span class="crayon-v">Sdk</span><span class="crayon-o">=</span><span class="crayon-s">&quot;Microsoft.NET.Sdk.IL&quot;</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5df3a90555dc6589588117-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-o">&lt;</span><span class="crayon-v">TargetFramework</span><span class="crayon-o">&gt;</span><span class="crayon-v">netstandard2</span><span class="crayon-sy">.</span><span class="crayon-cn">0</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">TargetFramework</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555dc6589588117-4"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-o">&lt;</span><span class="crayon-v">MicrosoftNetCoreIlasmPackageVersion</span><span class="crayon-o">&gt;</span><span class="crayon-cn">3.0.0</span><span class="crayon-o">-</span><span class="crayon-v">preview</span><span class="crayon-o">-</span><span class="crayon-cn">27318</span><span class="crayon-o">-</span><span class="crayon-cn">01</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">MicrosoftNetCoreIlasmPackageVersion</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5df3a90555dc6589588117-5"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-o">&lt;</span><span class="crayon-e">IncludePath </span><span class="crayon-v">Condition</span><span class="crayon-o">=</span><span class="crayon-s">&quot;&apos;$(TargetFramework)&apos; == &apos;netstandard2.0&apos;&quot;</span><span class="crayon-o">&gt;</span><span class="crayon-v">include</span><span class="crayon-sy">\</span><span class="crayon-v">netstandard</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">IncludePath</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555dc6589588117-6"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-o">&lt;</span><span class="crayon-v">IlasmFlags</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">IlasmFlags</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">INCLUDE</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">IncludePath</span><span class="crayon-sy">)</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">IlasmFlags</span><span class="crayon-o">&gt;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>We are specifying here the reference to the <em>Microsoft.NET.Sdk.IL</em> SDK again, as well as the version of the ILASM package, which should be the same as the SDK itself.</p>
<p>I will be building for .NET Standard 2.0 only, but there is nothing preventing you from targeting other frameworks. For each of the supported frameworks, you could create an include folder in order to include certain common references. In my case, I will include the reference to the CorLib. To do that I create the path <em>include\netstandard\coreassembly.h</em> with the following contents:</p>
<div> <div id="crayon-5df3a90555dd2667935342" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
#define CORE_ASSEMBLY &quot;System.Runtime&quot;

.assembly extern CORE_ASSEMBLY
{
  .publickeytoken = (B0 3F 5F 7F 11 D5 0A 3A )
  .ver 4:0:0:0
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555dd2667935342-1"><span class="crayon-p">#define CORE_ASSEMBLY &quot;System.Runtime&quot;</span></div><div class="crayon-line" id="crayon-5df3a90555dd2667935342-3"><span class="crayon-sy">.</span><span class="crayon-e">assembly </span><span class="crayon-e">extern</span><span class="crayon-h"> </span><span class="crayon-e">CORE_ASSEMBLY</span></div><div class="crayon-line" id="crayon-5df3a90555dd2667935342-5"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-sy">.</span><span class="crayon-v">publickeytoken</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">B0</span><span class="crayon-h"> </span><span class="crayon-cn">3F</span><span class="crayon-h"> </span><span class="crayon-cn">5F</span><span class="crayon-h"> </span><span class="crayon-cn">7F</span><span class="crayon-h"> </span><span class="crayon-cn">11</span><span class="crayon-h"> </span><span class="crayon-i">D5</span><span class="crayon-h"> </span><span class="crayon-cn">0A</span><span class="crayon-h"> </span><span class="crayon-cn">3A</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div></div></td> </tr> </table> </div> </div> </div>
<h3 id="toc_4">Writing IL code</h3>
<p>At this point, the only thing left is to write some IL code. I therefore create a <em>File.il</em> and, first, need to import the inclusion of core lib, as well as define the assembly and module. This is the bare minimum that is needed.</p>
<div> <div id="crayon-5df3a90555ddd762005061" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
#include &quot;coreassembly.h&quot;

.assembly SampleIL
{
  .ver 1:0:0:0
}

.module SampleIL.dll</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555ddd762005061-1"><span class="crayon-p">#include &quot;coreassembly.h&quot;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>The rest will be my regular code &#x2013; since this is a library not a console app, I do not need to create an entry point. I will, however, create a <em>Hello</em> type, with a <em>World()</em> method (sounds particularly exciting, doesn&#x2019;t it?).</p>
<div> <div id="crayon-5df3a90555de8597070029" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
.class public auto ansi beforefieldinit Hello
  extends [CORE_ASSEMBLY]System.Object
{
  .method public hidebysig static string World() cil managed
  {
    ldstr      &quot;Hello World!&quot;
    ret
  }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555de8597070029-1"><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">auto </span><span class="crayon-e">ansi </span><span class="crayon-e">beforefieldinit </span><span class="crayon-e">Hello</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555de8597070029-2"><span class="crayon-e">&#xA0;&#xA0;</span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">CORE_ASSEMBLY</span><span class="crayon-sy">]</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-t">Object</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555de8597070029-4"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-sy">.</span><span class="crayon-e">method </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">hidebysig </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">cil</span><span class="crayon-h"> </span><span class="crayon-e">managed</span></div></div></td> </tr> </table> </div> </div> </div>
<p>With this code in place, we can now build our program using a regular <em>dotnet build {path-to-my.ilproj}</em> command. The output should look more or less like this:</p>
<div> <div id="crayon-5df3a90555df3173681066" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
Z:\Documents\dev\il-sample&gt;dotnet build SampleIL\SampleIL.ilproj
Microsoft (R) Build Engine version 16.4.0+e901037fe for .NET Core
Copyright (C) Microsoft Corporation. All rights reserved.

  Restore completed in 27.2 ms for Z:\Documents\dev\il-sample\SampleIL\SampleIL.ilproj.
  SampleIL -&gt; Z:\Documents\dev\il-sample\SampleIL\bin\Debug\netstandard2.0\SampleIL.dll

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:00.93</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555df3173681066-1"><span class="crayon-v">Z</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Documents</span><span class="crayon-sy">\</span><span class="crayon-v">dev</span><span class="crayon-sy">\</span><span class="crayon-v">il</span><span class="crayon-o">-</span><span class="crayon-v">sample</span><span class="crayon-o">&gt;</span><span class="crayon-e">dotnet </span><span class="crayon-e">build </span><span class="crayon-v">SampleIL</span><span class="crayon-sy">\</span><span class="crayon-v">SampleIL</span><span class="crayon-sy">.</span><span class="crayon-e">ilproj</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555df3173681066-2"><span class="crayon-e">Microsoft</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">R</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">Build </span><span class="crayon-e">Engine </span><span class="crayon-i">version</span><span class="crayon-h"> </span><span class="crayon-cn">16.4.0</span><span class="crayon-o">+</span><span class="crayon-e">e901037fe </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">NET </span><span class="crayon-e">Core</span></div><div class="crayon-line" id="crayon-5df3a90555df3173681066-3"><span class="crayon-e">Copyright</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">C</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">Microsoft </span><span class="crayon-v">Corporation</span><span class="crayon-sy">.</span><span class="crayon-h"> </span><span class="crayon-e">All </span><span class="crayon-e">rights </span><span class="crayon-v">reserved</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5df3a90555df3173681066-5"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-e">Restore </span><span class="crayon-e">completed </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-cn">27.2</span><span class="crayon-h"> </span><span class="crayon-e">ms </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">Z</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Documents</span><span class="crayon-sy">\</span><span class="crayon-v">dev</span><span class="crayon-sy">\</span><span class="crayon-v">il</span><span class="crayon-o">-</span><span class="crayon-v">sample</span><span class="crayon-sy">\</span><span class="crayon-v">SampleIL</span><span class="crayon-sy">\</span><span class="crayon-v">SampleIL</span><span class="crayon-sy">.</span><span class="crayon-v">ilproj</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555df3173681066-6"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-v">SampleIL</span><span class="crayon-h"> </span><span class="crayon-o">-&gt;</span><span class="crayon-h"> </span><span class="crayon-v">Z</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Documents</span><span class="crayon-sy">\</span><span class="crayon-v">dev</span><span class="crayon-sy">\</span><span class="crayon-v">il</span><span class="crayon-o">-</span><span class="crayon-v">sample</span><span class="crayon-sy">\</span><span class="crayon-v">SampleIL</span><span class="crayon-sy">\</span><span class="crayon-v">bin</span><span class="crayon-sy">\</span><span class="crayon-v">Debug</span><span class="crayon-sy">\</span><span class="crayon-v">netstandard2</span><span class="crayon-sy">.</span><span class="crayon-cn">0</span><span class="crayon-sy">\</span><span class="crayon-v">SampleIL</span><span class="crayon-sy">.</span><span class="crayon-e">dll</span></div></div></td> </tr> </table> </div> </div> </div>
<p>At that point we have a valid DLL we can load from any project compatible with .NET Standard 2.0 and use it. In this case, at the C# surface level, the usage would simply be:</p>
<div> <div id="crayon-5df3a90555dfe301968200" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine(Hello.World());
        }
    }</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555dfe301968200-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">Main</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5df3a90555dfe301968200-5"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-v">Hello</span><span class="crayon-sy">.</span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<h3 id="toc_5">What can you do with this?</h3>
<p>Well, obviously, you can let your imagination be the limit. The most apparent use case is to do all kinds of micro-optimizations, especially if you feel like the compiler is not doing enough. That said, you could also do some completely absurd things with it too &#x2013; after all it&#x2019;s raw IL. </p>
<p>For example, you could remove the inheritance from <em>System.Object</em>:</p>
<div> <div id="crayon-5df3a90555e0a768313810" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
.class public auto ansi beforefieldinit Hello
{
  .method public hidebysig static string World() cil managed
  {
    ldstr      &quot;Hello World!&quot;
    ret
  }</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e0a768313810-1"><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">auto</span><span class="crayon-h"> </span><span class="crayon-e">ansi</span><span class="crayon-h"> </span><span class="crayon-e">beforefieldinit</span><span class="crayon-h"> </span><span class="crayon-e">Hello</span></div><div class="crayon-line" id="crayon-5df3a90555e0a768313810-3"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-sy">.</span><span class="crayon-e">method </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">hidebysig </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">cil</span><span class="crayon-h"> </span><span class="crayon-e">managed</span></div></div></td> </tr> </table> </div> </div> </div>
<p>and add an ILASM switch to disable automatic inheritance to our <em>ilproj</em>:</p>
<div> <div id="crayon-5df3a90555e15530242197" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
 &lt;IlasmFlags&gt;$(IlasmFlags) -INCLUDE=$(IncludePath) -noautoinherit&lt;/IlasmFlags&gt;</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e15530242197-1"><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-v">IlasmFlags</span><span class="crayon-o">&gt;</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">IlasmFlags</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">INCLUDE</span><span class="crayon-o">=</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">IncludePath</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">noautoinherit</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">IlasmFlags</span><span class="crayon-o">&gt;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>This DLL will now build correctly, and we have managed to achieve the impossible &#x2013; we now have a DLL, that was successfully emitted, where we have a type that doesn&#x2019;t inherit from <em>System.Object</em>, which is really forbidden. As thrilling as this is, it is, unfortunately, equally useless, since any attempt to load and use this DLL will result in a type load exception.</p>
<p>We could also, given the fact that we are in IL, do some other things that are forbidden in C#. For example overload by return type. I could add a second <em>World()</em> method to our <em>Hello</em> type &#x2013; differing from our previous one by return type only: </p>
<div> <div id="crayon-5df3a90555e20992765246" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
.class public auto ansi beforefieldinit Hello
  extends [CORE_ASSEMBLY]System.Object
{
  .method public hidebysig static string World() cil managed
  {
    ldstr      &quot;Hello World!&quot;
    ret
  }

    .method public hidebysig static int32 World() cil managed
  {
    ldc.i4      42
    ret
  }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e20992765246-1"><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">auto </span><span class="crayon-e">ansi </span><span class="crayon-e">beforefieldinit </span><span class="crayon-e">Hello</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e20992765246-2"><span class="crayon-e">&#xA0;&#xA0;</span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">CORE_ASSEMBLY</span><span class="crayon-sy">]</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-t">Object</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e20992765246-4"><span class="crayon-h">&#xA0;&#xA0;</span><span class="crayon-sy">.</span><span class="crayon-e">method </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">hidebysig </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">cil</span><span class="crayon-h"> </span><span class="crayon-e">managed</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e20992765246-10"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-sy">.</span><span class="crayon-e">method </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">hidebysig </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">int32 </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">cil</span><span class="crayon-h"> </span><span class="crayon-e">managed</span></div></div></td> </tr> </table> </div> </div> </div>
<p>We now have two <em>Hello.World()</em> methods, one returning a <em>string</em> and one returning an <em>int</em>. This is impossible to do in C# and the compiler would not allow it, but it&#x2019;s allowed in IL, since you have to specify the return type when you call a method there.</p>
<p>So this DLL builds, and a quick peek via decompiler reveals that indeed our plot worked and we have a DLL that really is impossible to produce with C# code and the Roslyn compiler:</p>
<div> <div id="crayon-5df3a90555e39125415676" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
using System;

public class Hello : Object
{
    public static String World()
    {
        return &quot;Hello World!&quot;;
    }

    public static Int32 World()
    {
        return 42;
    }
}</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e39125415676-3"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Hello</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-t">Object</span></div><div class="crayon-line" id="crayon-5df3a90555e39125415676-5"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e39125415676-10"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">Int32 </span><span class="crayon-e">World</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td> </tr> </table> </div> </div> </div>
<p>To be fair, again, when we try to use it from a C# program, and invoke <em>Hello.World()</em> there, the compiler will not know which method to select and complain:</p>
<div> <div id="crayon-5df3a90555e45319976583" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
CS0121  The call is ambiguous between the following methods or properties: &apos;Hello.World()&apos; and &apos;Hello.World()&apos;</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e45319976583-1"><span class="crayon-e">CS0121&#xA0;&#xA0;</span><span class="crayon-e">The </span><span class="crayon-e">call </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">ambiguous </span><span class="crayon-e">between </span><span class="crayon-e">the </span><span class="crayon-e">following </span><span class="crayon-e">methods </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-v">properties</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">&apos;Hello.World()&apos;</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-s">&apos;Hello.World()&apos;</span></div></div></td> </tr> </table> </div> </div> </div>
<p>What is interesting is that it would work with reflection, for example, the following code compiles and executes just fine:</p>
<div> <div id="crayon-5df3a90555e51047349568" class="crayon-syntax crayon-theme-github crayon-font-courier-new crayon-os-mac print-yes notranslate"> <div class="crayon-plain-wrap"><textarea class="crayon-plain print-no">
var intOverload = typeof(Hello).
    GetMethods(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static).
    First(m =&gt; m.Name == &quot;World&quot; &amp;&amp; m.ReturnType == typeof(int));
    
var stringOverload = typeof(Hello).
    GetMethods(System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static).
    First(m =&gt; m.Name == &quot;World&quot; &amp;&amp; m.ReturnType == typeof(string));

Console.WriteLine(intOverload.Invoke(null, null));
Console.WriteLine(stringOverload.Invoke(null, null));</textarea></div> <div class="crayon-main"> <table class="crayon-table"> <tr class="crayon-row"> <td class="crayon-nums "> </td> <td class="crayon-code"><div class="crayon-pre"><div class="crayon-line" id="crayon-5df3a90555e51047349568-1"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">intOverload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">typeof</span><span class="crayon-sy">(</span><span class="crayon-v">Hello</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e51047349568-2"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-e">GetMethods</span><span class="crayon-sy">(</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Reflection</span><span class="crayon-sy">.</span><span class="crayon-v">BindingFlags</span><span class="crayon-sy">.</span><span class="crayon-m">Public</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Reflection</span><span class="crayon-sy">.</span><span class="crayon-v">BindingFlags</span><span class="crayon-sy">.</span><span class="crayon-m">Static</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5df3a90555e51047349568-3"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-e">First</span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-v">Name</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">&quot;World&quot;</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-v">ReturnType</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">typeof</span><span class="crayon-sy">(</span><span class="crayon-t">int</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df3a90555e51047349568-5"><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">stringOverload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">typeof</span><span class="crayon-sy">(</span><span class="crayon-v">Hello</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e51047349568-6"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-e">GetMethods</span><span class="crayon-sy">(</span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Reflection</span><span class="crayon-sy">.</span><span class="crayon-v">BindingFlags</span><span class="crayon-sy">.</span><span class="crayon-m">Public</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-v">System</span><span class="crayon-sy">.</span><span class="crayon-v">Reflection</span><span class="crayon-sy">.</span><span class="crayon-v">BindingFlags</span><span class="crayon-sy">.</span><span class="crayon-m">Static</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5df3a90555e51047349568-7"><span class="crayon-h">&#xA0;&#xA0;&#xA0;&#xA0;</span><span class="crayon-e">First</span><span class="crayon-sy">(</span><span class="crayon-v">m</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-v">Name</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">&quot;World&quot;</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">m</span><span class="crayon-sy">.</span><span class="crayon-v">ReturnType</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-e">typeof</span><span class="crayon-sy">(</span><span class="crayon-t">string</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5df3a90555e51047349568-9"><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-v">intOverload</span><span class="crayon-sy">.</span><span class="crayon-e">Invoke</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5df3a90555e51047349568-10"><span class="crayon-v">Console</span><span class="crayon-sy">.</span><span class="crayon-e">WriteLine</span><span class="crayon-sy">(</span><span class="crayon-v">stringOverload</span><span class="crayon-sy">.</span><span class="crayon-e">Invoke</span><span class="crayon-sy">(</span><span class="crayon-t">null</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td> </tr> </table> </div> </div> </div>
<h3 id="toc_6">Summary</h3>
<p>These are all little useless hacks and quirks, but hopefully they illustrate the really cool aspect of being able to just write raw IL. The code from this article is <a href="https://github.com/filipw/Strathweb.Samples.ILproj">available on Github</a>. I hope it will help you get started building IL projects.</p>
<p>For &#x201C;real world&#x201D; use cases I recommend you check out <a href="https://github.com/dotnet/corefx/blob/master/src/System.Runtime.CompilerServices.Unsafe/src/System.Runtime.CompilerServices.Unsafe.il">System.Runtime.CompilerServices.Unsafe</a> which is build using the <em>Microsoft.NET.Sdk.IL</em> SDK. The library can be used to do a bunch of unsafe operations like unsafe casts &#x2013; in a way that would not be possible to be expressed in C#.</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>