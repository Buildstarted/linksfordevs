<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Y&#x16B;binkyoku &#x1F3E3; -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Y&#x16B;binkyoku &#x1F3E3;</h1>
    <div class="container u-max-full-width">
<div class="row"> <h5><a href="//thume.ca">Tristan Hume</a>&apos;s photorealistic path tracer made for CS488</h5> </div>
<div class="row">
<div class="seven columns">
<p>
Made as my <a href="https://www.student.cs.uwaterloo.ca/~cs488/gallery-A5.html">final project for UWaterloo&apos;s CS488 Graphics class</a>, this is the demo page for my path tracing renderer made with the goal of maximum photorealism. I put about a full time month&apos;s worth of work effort into this project, way more than required, since I was having a lot of fun and had a final scene in mind I wanted to reach.
</p>
<p>
It&apos;s named after the Japanese word for &quot;post office&quot; because it made so little sense as the name for a ray tracer that it made me burst out laughing, and the fact that there&apos;s an emoji for it sealed the deal. Why the idea of naming it after the Japanese word for &quot;post office&quot; occurred to me in the first place is a long story.
</p>
<p>
It&apos;s not open source since it uses some code (e.g OBJ file loading) from the course, and there are better open source renderers out there. But if you want more technical details you can read the <a href="report.pdf">project report</a>, although it&apos;s written with an intended audience of the course TAs.
</p> </div>
</div>
<div class="row">
<img src="renders/final_1097_mc6_preview.jpg" class="u-max-full-width" alt="My Final Scene">
</div>
<div class="row section">
<div class="four columns"> <div>
<p>First, for context for the rest of the renders, all my renders use an implementation of a subset of the Disney BRDF (Burley 2012). This is a high quality physically based microfacet BRDF including proper Fresnel and other effects for dielectrics and metals. My implementation has three parameters: base colour, metalness and roughness. I also implemented Phong Shading for my meshes.</p>
<p>After implementing the Disney BRDF, I rendered a simple scene with both Blender&#x2019;s Cycles renderer and mine and they were a perfect match, which gave me confidence and allowed me to tune materials in Blender.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-1 render-active" id="render-desc-1-1">
<img src="renders/fancy_mesh_73_phong.png" class="render-thumb" id="render-thumb-1-1"> </div>
<div class="render-desc desc-1 " id="render-desc-1-2">
<img src="renders/fancy_mesh_73_nophong.png" class="render-thumb" id="render-thumb-1-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/fancy_mesh_73_phong.png" class=" u-max-full-width render-full-1 img-render-full " id="render-full-1-1">
<img src="renders/fancy_mesh_73_nophong.png" class=" u-max-full-width render-full-1 img-render-full hide " id="render-full-1-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented texture mapping by making my material take all of its attributes from a texture, and then implented the ability to create constant and image texture files from Lua. I added UV coordinates for meshes, cubes and spheres. Textures are filtered with bilinear filtering of the 4 nearest texels.</p>
<p>This allows mapping base colour, metalness and roughness. I also added special support for emission textures and rendering inside spheres to support environment maps.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-2 render-active" id="render-desc-2-1">
<img src="renders/fancy_mesh_skybox.png" class="render-thumb" id="render-thumb-2-1"> </div>
<div class="render-desc desc-2 " id="render-desc-2-2">
<img src="renders/fancy_mesh_paint.png" class="render-thumb" id="render-thumb-2-2"> </div>
<div class="render-desc desc-2 " id="render-desc-2-3">
<img src="renders/fancy_mesh_cube.png" class="render-thumb" id="render-thumb-2-3"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/fancy_mesh_skybox.png" class=" u-max-full-width render-full-2 img-render-full " id="render-full-2-1">
<img src="renders/fancy_mesh_paint.png" class=" u-max-full-width render-full-2 img-render-full hide " id="render-full-2-2">
<img src="renders/fancy_mesh_cube.png" class=" u-max-full-width render-full-2 img-render-full hide " id="render-full-2-3">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented normal mapping including the required tangents for meshes, cubes and spheres.</p>
<p>I verified with the test texture shown on the cube that the normals have the correct orientation.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-3 render-active" id="render-desc-3-1">
<video src="renders/studio_full_2.mp4" class="render-thumb" id="render-thumb-3-1">
No video :-(
</video> </div>
<div class="render-desc desc-3 " id="render-desc-3-2">
<img src="renders/fancy_mesh_cubenormal.png" class="render-thumb" id="render-thumb-3-2"> </div>
<div class="render-desc desc-3 " id="render-desc-3-3">
<img src="renders/studio_73_2.png" class="render-thumb" id="render-thumb-3-3"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<video src="renders/studio_full_2.mp4" class=" u-max-full-width render-full-3 img-render-full " id="render-full-3-1">
No video :-(
</video>
<img src="renders/fancy_mesh_cubenormal.png" class=" u-max-full-width render-full-3 img-render-full hide " id="render-full-3-2">
<img src="renders/studio_73_2.png" class=" u-max-full-width render-full-3 img-render-full hide " id="render-full-3-3">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented global illumination using path tracing. I importance sample both the diffuse and specular lobes of the Disney BRDF.</p>
<p>My integrator is based on the path formulation of the rendering equation, where the integration is done in the outer loop so that path components can be re-used as they are extended and checked against direct lights at each bounce.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-4 render-active" id="render-desc-4-1">
<img src="renders/cornell_10313_plain.png" class="render-thumb" id="render-thumb-4-1"> </div>
<div class="render-desc desc-4 " id="render-desc-4-2">
<img src="renders/cornell_10313_refl.png" class="render-thumb" id="render-thumb-4-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/cornell_10313_plain.png" class=" u-max-full-width render-full-4 img-render-full " id="render-full-4-1">
<img src="renders/cornell_10313_refl.png" class=" u-max-full-width render-full-4 img-render-full hide " id="render-full-4-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented soft shadows by overhauling my lighting model so that lights are just spheres with an emission texture on them, just like environment maps. I then changed the lights array normally passed into the render to just a list of <code class="highlighter-rouge">GeometryNode</code>s to sample explicitly.</p>
<p>The path tracing integrator then at each bounce samples the cone of directions subtended by the sphere that would fit in the bounding box of the objects. This means at the moment only spherical area lights work correctly. This is more efficient than sampling a point on the sphere since only visible positions on the light are sampled.</p>
<p>This also allows me to render the area light as a physical object that exists in the world, or I can put it in the list to be sampled but not in the scene for an invisible light.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-5 render-active" id="render-desc-5-1"> <img src="renders/cornell_10313_area.png" class="render-thumb" id="render-thumb-5-1"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/cornell_10313_area.png" class=" u-max-full-width render-full-5 img-render-full " id="render-full-5-1">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>Glossy reflection falls out directly from the path tracing integrator and the specular lobe of the Disney BRDF, which uses an empirically based GGX distribution for the microfacet normals. I importance sample the GGX distribution term of the specular lobe so glossy reflection converges quickly.</p>
<p>With path tracing the only difference between specular highlights and glossy reflection is whether the light was directly sampled!</p>
</div>
<div class="render-descs">
<div class="render-desc desc-6 render-active" id="render-desc-6-1">
<img src="renders/cornell_12361_gloss_area.png" class="render-thumb" id="render-thumb-6-1"> </div>
<div class="render-desc desc-6 " id="render-desc-6-2">
<img src="renders/cornell_10313_gloss_floor.png" class="render-thumb" id="render-thumb-6-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/cornell_12361_gloss_area.png" class=" u-max-full-width render-full-6 img-render-full " id="render-full-6-1">
<img src="renders/cornell_10313_gloss_floor.png" class=" u-max-full-width render-full-6 img-render-full hide " id="render-full-6-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>Anti-aliasing is implemented as part of the same sampling framework that the path tracing uses. On each sample a random position in a square pixel region is picked to cast the ray for.</p>
<p>For textures I only do bilinear filtering with 4 texels so for high resolution textures anti-aliasing is also necessary for textured surfaces to look correct.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-7 render-active" id="render-desc-7-1">
<img src="renders/fancy_mesh_cube_noaa.png" class="render-thumb" id="render-thumb-7-1"> </div> <div class="render-desc desc-7 " id="render-desc-7-2">
<img src="renders/fancy_mesh_cube.png" class="render-thumb" id="render-thumb-7-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/fancy_mesh_cube_noaa.png" class=" u-max-full-width render-full-7 img-render-full " id="render-full-7-1">
<img src="renders/fancy_mesh_cube.png" class=" u-max-full-width render-full-7 img-render-full hide " id="render-full-7-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implement the thin lens model of depth of field by finding where the original ray intersects the focal plane, then sampling a random point on a disk representing the aperture of the camera and casting a ray from that point to the point on the focal plane.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-8 render-active" id="render-desc-8-1">
<img src="renders/dof_6217_fancy.png" class="render-thumb" id="render-thumb-8-1"> </div>
<div class="render-desc desc-8 " id="render-desc-8-2">
<img src="renders/dof_6217_nodof.png" class="render-thumb" id="render-thumb-8-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/dof_6217_fancy.png" class=" u-max-full-width render-full-8 img-render-full " id="render-full-8-1">
<img src="renders/dof_6217_nodof.png" class=" u-max-full-width render-full-8 img-render-full hide " id="render-full-8-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented animation in Lua by constructing multiple scenes and rendering them to separate files, then using FFMPEG to stitch them together. The animation is done with math, logic and a cosine-based curve for smoothly easing in and out.</p>
<p>This scene shows a perfectly looping animation with rose gold and black plastic rounded hexagons on a metal surface. It was <em>heavily</em> inspired by <a href="https://gfycat.com/WideeyedAstonishingDonkey">this animation</a>.</p>
<p>This also shows off a bit of the distance field ray marching explained in the next section. In this case I use modulo to do a domain repetition of a rounded hexagonal bar primitive formula with the parameter being the rotation, which is driven from Lua.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-9 render-active" id="render-desc-9-1">
<video src="renders/anim_hq.mp4" class="render-thumb" id="render-thumb-9-1">
No video :-(
</video> </div>
<div class="render-desc desc-9 " id="render-desc-9-2">
<img src="renders/anim_hq_f-0t.png" class="render-thumb" id="render-thumb-9-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<video src="renders/anim_hq.mp4" class=" u-max-full-width render-full-9 img-render-full " id="render-full-9-1">
No video :-(
</video>
<img src="renders/anim_hq_f-0t.png" class=" u-max-full-width render-full-9 img-render-full hide " id="render-full-9-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented Constructive Solid Geometry (CSG) in a different way than is standard for ray tracers. I implemented a primitive for ray marching a distance field. This is a method of rendering a 3D surface given a function from a point to the distance to a surface by taking steps along a ray based on the function.</p>
<p>Once that is implemented, CSG is simple to implement by taking the minimum (union) or maximum (intersection) of two distance functions, subtraction is taking the maximum with the negative of a signed distance function.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-10 render-active" id="render-desc-10-1">
<img src="renders/csg_329_mat5.png" class="render-thumb" id="render-thumb-10-1"> </div>
<div class="render-desc desc-10 " id="render-desc-10-2">
<video src="renders/csg_copper_hq.mp4" class="render-thumb" id="render-thumb-10-2">
No video :-(
</video> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/csg_329_mat5.png" class=" u-max-full-width render-full-10 img-render-full " id="render-full-10-1">
<video src="renders/csg_copper_hq.mp4" class=" u-max-full-width render-full-10 img-render-full hide " id="render-full-10-2">
No video :-(
</video>
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>Using distance field ray marching it is possible to render Mandelbrot-style iteration fractals by using the running derivative of the iteration as a distance estimate. I implemented the distance function for one such fractal, the Mandelbox.</p>
<p>I then used CSG to subtract and intersect with some cubes to carve out an interesting region inside the fractal, since the outside isn&#x2019;t too impressive.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-11 render-active" id="render-desc-11-1">
<img src="renders/studio_585_smallmandel.png" class="render-thumb" id="render-thumb-11-1"> </div>
<div class="render-desc desc-11 " id="render-desc-11-2">
<img src="renders/studio_585_bigredmandel.png" class="render-thumb" id="render-thumb-11-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/studio_585_smallmandel.png" class=" u-max-full-width render-full-11 img-render-full " id="render-full-11-1">
<img src="renders/studio_585_bigredmandel.png" class=" u-max-full-width render-full-11 img-render-full hide " id="render-full-11-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>In order to implement my final scene concept I needed portals, which for my case meant a way to have an object act as a portal where rays passing through it would end up in a different scene, bidirectionally.</p>
<p>I implemented this by giving all rays and surface hits a world number field. Then I modified my code so all scattering and light sampling would observe the world field and cast follow up and shadow rays with the same world.</p>
<p>Then I added a portal <code class="highlighter-rouge">SceneNode</code> subclass that checks the world ID of incoming rays and first tests it against that index of its children, as well as a special portal node pointer, and if it hits the portal before it hits the current world, it spawns a new ray in the next world number modulo its number of children, and does the required changing and remapping ray t values to spawn the new ray at the portal.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-12 render-active" id="render-desc-12-1">
<img src="renders/cornell_8265_portal.png" class="render-thumb" id="render-thumb-12-1"> </div> </div>
</div>
<div class="eight columns render-full-box">
<img src="renders/cornell_8265_portal.png" class=" u-max-full-width render-full-12 img-render-full " id="render-full-12-1">
</div>
</div>
<div class="row section">
<div class="ten columns"> <div>
<p>My goal was to render a scene that was as photorealistic as possible while having whimsical elements that clearly couldn&#x2019;t be real. The scene shows off high quality textures and models (not done by me) in a scene I arranged and tuned the materials for. I also tried to compose an artistically nice scene that tells a story. Uses a portal, a Mandelbox, global illumination, and various hand-tuned Disney BRDF materials.</p>
<p>While I didn&#x2019;t make most of the models and textures, I still spent over 15 hours arranging, tuning materials and light, composing the scene, and importing various model formats.</p>
<p><strong>Extras shown:</strong> Non-filtered textures</p>
</div>
<div class="render-descs">
<div class="render-desc desc-13 render-active" id="render-desc-13-1">
<img src="renders/final_1097_mc6_4k.png" class="render-thumb" id="render-thumb-13-1"> </div>
<div class="render-desc desc-13 " id="render-desc-13-2">
<img src="renders/final_1097_mc6_1080p_dof.png" class="render-thumb" id="render-thumb-13-2"> </div>
</div>
</div>
<div>
<img src="renders/final_1097_mc6_4k.png" class=" u-max-full-width render-full-13 img-render-full " id="render-full-13-1">
<img src="renders/final_1097_mc6_1080p_dof.png" class=" u-max-full-width render-full-13 img-render-full hide " id="render-full-13-2">
</div>
</div>
<div class="row section">
<div class="ten columns"> <div>
<p>An important part of the photorealism of my renders is very high quality tone mapping. I implemented a parser for the 1D and 3D OpenColorIO lookup table (LUT) formats, and a function to apply them correctly with linear and trilinear interpolation respectively.</p>
<p>The good tone mapping allows for scenes with realistic high dynamic range lighting to render properly without getting blown out and with photo-like colour. As you can see from the render with no tone mapping where the colours are bad, the sun on the keyboard is totally blown out, and the shades of black on the display rim are lost.</p>
<p>I can also use different LUTs for different scenes. I rendered my final scene with a more camera-like LUT with lots of dynamic range, but the rest of my scenes with a higher contrast LUT that gives punchier colours but isn&#x2019;t as photorealistic.</p>
<p>I can also use a false colour LUT to see what the dynamic range of my scene is like.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-14 render-active" id="render-desc-14-1">
<img src="renders/final_585_notone.png" class="render-thumb" id="render-thumb-14-1"> </div>
<div class="render-desc desc-14 " id="render-desc-14-2">
<img src="renders/final_585_false.png" class="render-thumb" id="render-thumb-14-2"> </div>
<div class="render-desc desc-14 " id="render-desc-14-3">
<img src="renders/final_1097_mc6_4k.png" class="render-thumb" id="render-thumb-14-3"> </div>
<div class="render-desc desc-14 " id="render-desc-14-4">
<img src="renders/final_585_highcontrast.png" class="render-thumb" id="render-thumb-14-4"> </div>
</div>
</div>
<div>
<img src="renders/final_585_notone.png" class=" u-max-full-width render-full-14 img-render-full " id="render-full-14-1">
<img src="renders/final_585_false.png" class=" u-max-full-width render-full-14 img-render-full hide " id="render-full-14-2">
<img src="renders/final_1097_mc6_4k.png" class=" u-max-full-width render-full-14 img-render-full hide " id="render-full-14-3">
<img src="renders/final_585_highcontrast.png" class=" u-max-full-width render-full-14 img-render-full hide " id="render-full-14-4">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>Part of the tone mapping is a 3D LUT that desaturates very bright colours, simulating bleed between film layers, which can produce a pleasing effect with very bright colours getting desaturated. This effectively allows for more dynamic range to be shown.</p>
<p>This scene shows includes a ridiculously bright pure pink light to demonstrate.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-15 render-active" id="render-desc-15-1">
<img src="renders/outside_73_notone.png" class="render-thumb" id="render-thumb-15-1"> </div>
<div class="render-desc desc-15 " id="render-desc-15-2">
<img src="renders/outside_73_nodesat.png" class="render-thumb" id="render-thumb-15-2"> </div>
<div class="render-desc desc-15 " id="render-desc-15-3">
<img src="renders/outside_73_tone.png" class="render-thumb" id="render-thumb-15-3"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/outside_73_notone.png" class=" u-max-full-width render-full-15 img-render-full " id="render-full-15-1">
<img src="renders/outside_73_nodesat.png" class=" u-max-full-width render-full-15 img-render-full hide " id="render-full-15-2">
<img src="renders/outside_73_tone.png" class=" u-max-full-width render-full-15 img-render-full hide " id="render-full-15-3">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I implemented sampling using the Sobol (0,2) sequence with a fast gray code technique from the <a href="http://www.pbrt.org/">PBRT book</a>. These samples have better distribution in many dimensions and can be used progressively, leading to faster render convergence rates.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-16 render-active" id="render-desc-16-1">
<img src="renders/dof_9_plain_uniform.png" class="render-thumb" id="render-thumb-16-1"> </div>
<div class="render-desc desc-16 " id="render-desc-16-2">
<img src="renders/dof_9_plain_02.png" class="render-thumb" id="render-thumb-16-2"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/dof_9_plain_uniform.png" class=" u-max-full-width render-full-16 img-render-full " id="render-full-16-1">
<img src="renders/dof_9_plain_02.png" class=" u-max-full-width render-full-16 img-render-full hide " id="render-full-16-2">
</div>
</div> <div class="row section">
<div class="ten columns"> <div>
<p>I put my final scene together in Blender and it took over 15 hours to do, if I had to do it entirely with conversion scripts and lua files it would have been infeasible. So I wrote a script using Blender&#x2019;s Python API that exports all objects in the scene into OBJ files and a lua file that references them all and sets them up with the right materials.</p>
<p>I can then reference the objects defined in this lua file in my final scene&#x2019;s lua file, while adding arrangements like portals that Blender can&#x2019;t do. It also exports object transforms separately so I can do things like replace a cube with a Mandelbox.</p>
<p>I used the same set of film emulation LUTs included in Blender so that I could match Cycles almost exactly.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-17 render-active" id="render-desc-17-1">
<img src="renders/blender_1.png" class="render-thumb" id="render-thumb-17-1"> </div>
<div class="render-desc desc-17 " id="render-desc-17-2">
<img src="renders/blender_2.png" class="render-thumb" id="render-thumb-17-2"> </div>
</div>
</div>
<div>
<img src="renders/blender_1.png" class=" u-max-full-width render-full-17 img-render-full " id="render-full-17-1">
<img src="renders/blender_2.png" class=" u-max-full-width render-full-17 img-render-full hide " id="render-full-17-2">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I made my renderer progressive by saving a matrix of Sobol sampler states and running my sampler in epochs of gradually increasing sample count, while keeping the samples for each pixel in each epoch in the innermost loop for cache/branch prediction efficiency. Every epoch it saves an image of its progress so far.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-18 render-active" id="render-desc-18-1">
<img src="renders/cornell_1.png" class="render-thumb" id="render-thumb-18-1"> </div>
<div class="render-desc desc-18 " id="render-desc-18-2">
<img src="renders/cornell_9.png" class="render-thumb" id="render-thumb-18-2"> </div>
<div class="render-desc desc-18 " id="render-desc-18-3">
<img src="renders/cornell_73.png" class="render-thumb" id="render-thumb-18-3"> </div>
<div class="render-desc desc-18 " id="render-desc-18-4">
<img src="renders/cornell_10313_area.png" class="render-thumb" id="render-thumb-18-4"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/cornell_1.png" class=" u-max-full-width render-full-18 img-render-full " id="render-full-18-1">
<img src="renders/cornell_9.png" class=" u-max-full-width render-full-18 img-render-full hide " id="render-full-18-2">
<img src="renders/cornell_73.png" class=" u-max-full-width render-full-18 img-render-full hide " id="render-full-18-3">
<img src="renders/cornell_10313_area.png" class=" u-max-full-width render-full-18 img-render-full hide " id="render-full-18-4">
</div>
</div>
<div class="row section">
<div class="four columns"> <div>
<p>I made my renderer multithreaded using all available hyperthreads using the C++11 threading library. It distributes rows of image alternately to each thread for evenly distributed difficulty. I implemented a multi-threaded progress bar with proper locking to print nice console progress with ANSI escape codes.</p>
<p>It scales linearly with number of cores. I rendered most images on this page on a 64 core pre-emptible Google Cloud instance for only $0.50 an hour.</p>
</div>
<div class="render-descs">
<div class="render-desc desc-19 render-active" id="render-desc-19-1">
<img src="renders/progress_crop.png" class="render-thumb" id="render-thumb-19-1"> </div>
</div>
</div>
<div class="eight columns render-full-box">
<img src="renders/progress_crop.png" class=" u-max-full-width render-full-19 img-render-full " id="render-full-19-1">
</div>
</div>
<div class="row section">
<div class="seven columns"> <div>
<p>I implemented a number of optimizations so that I could render large scenes with path tracing in a reasonable amount of time. I don&#x2019;t have graphs because these are mostly asymptotic or varying by scene so I could make the graphs show whatever I wanted.</p>
<ul>
<li>So that I could render large meshes, I integrated the <a href="https://github.com/brandonpelfrey/Fast-BVH">FastBVH</a> bounding box hierarchy library into my mesh primitive. This took about 2 hours.</li>
<li>I implemented my own bounding box hierachy checks at the scene node level, although that hierarchy is just the manually constructed hierarchy from Lua.</li>
<li>I baked the hierarchical transform down into each <code class="highlighter-rouge">GeometryNode</code> and only apply the transform if it is not the identity, to reduce the number of matrix multiplies per ray per object.</li>
<li>When implementing formulas, I follow best practices for floating point performance and avoid or precompute square roots, trig functions and divisions wherever possible using a number of standard tricks.</li>
<li>I use the Moller-Trumbore ray-triangle intersection method which is just an algebraic improvement on the one presented in class, but is much faster.</li>
</ul>
</div>
</div>
</div>
<div class="row section">
<div class="seven columns"> <p>
<ul>
<li>I learned a lot of what I know from sitting down and reading the <a href="https://www.pbrt.org/">PBRT book</a>, many parts of my ray tracer are based on reading the theory and rationale for doing something a certain way in my paper copy of the book while reading it start to finish, and then coding up my own version later. Things built following the methods from PBRT include my path tracing, importance sampling, area light sampling, depth of field and my low-discrepancy sequence generation.</li>
<li>The primitive signed distance function equations I use for modeling including the box, sphere, ellipsoid and hex bar all come from <a href="http://iquilezles.org/www/articles/distfunctions/distfunctions.htm">Inigo Quilez&#x2019;s SDF modeling page</a>.</li>
<li>My Mandelbox distance estimator is based on code from <a href="http://blog.hvidtfeldts.net/index.php/2011/11/distance-estimated-3d-fractals-vi-the-mandelbox/">a blog post</a> by Mikael Hvidtfeldt Christensen explaining the theory behind the distance estimator. It is nigh-impossible to implement a Mandelbox estimator without referencing code since the way it is designed is based on aesthetics and approximations that don&#x2019;t always have a perfect theoretical basis.</li>
<li>All the models and textures in all my scenes except the Mandelbox pedestal and desk were downloaded from the internet, although I re-did the materials myself using the Disney BRDF. The Minecraft hill was sculpted by me in Minecraft and then exported using the jmc2obj tool. Links: <a href="https://www.modelplusmodel.com/tech/electronics/apple-macbook-pro-15.html">Macbook model</a>, <a href="https://www.blendswap.com/blends/view/73501">stapler model</a>, <a href="https://pbrt.org/scenes-v3.html">book model</a>, <a href="https://www.cgbookcase.com/">CGBookCase</a>, <a href="https://cc0textures.com/">CC0Textures</a>, <a href="https://3dtextures.me/">3DTextures</a>, <a href="https://texturehaven.com/">TextureHaven</a>, <a href="https://hdrihaven.com/">HDRIHaven</a>.</li>
<li>The Lego in my final scene was based on <a href="https://www.mecabricks.com/en/models/nKZvmlQbjG6">a model</a> found on the <a href="https://www.mecabricks.com/">Mecabricks Lego CAD site</a>, simplified a bit by me, and then exported.</li>
<li>The Film emulation LUTs I load in for tone mapping come from <a href="https://github.com/sobotka/filmic-blender">Troy Sobotka&#x2019;s Filmic Blender addon</a>, which was later incorporated directly into Blender. I also had an email conversation with Troy where he clarified some of my understanding of how the different colour spaces fit together.</li>
</ul>
</p>
</div>
</div>
<div class="row">
<div class="seven columns"> <p>
CSS template thanks to <a href="http://getskeleton.com/">Skeleton</a>, magnifying glass thanks to <a href="https://github.com/paulkr/blowup.js">blowup.js</a>. The image and animation gallery, the rest of the page, and the renders on it I did myself.
</p>
</div>
</div>
</div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>