<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Async Await -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Async Await</h1>
    <body class="wy-body-for-nav"> <p class="wy-grid-for-nav"> <nav class="wy-nav-side stickynav"> &#xA0; </nav> <section class="wy-nav-content-wrap"> <nav class="wy-nav-top"> <i class="fa fa-bars"></i> <a href="..">NetMQ</a> </nav> <div class="wy-nav-content"> <div class="rst-content"> <div> </div> <div> <div class="section"> <p>Since version (4.0.0.239-pre) NetMQ support async/await.</p>
<p>To use async/await feature you need to create a <code>NetMQRuntime</code>.</p>
<h2 id="example">Example:</h2>
<div class="codehilite"><pre><span></span><span class="k">async</span> <span class="n">Task</span> <span class="nf">ServerAsync</span><span class="p">()</span>
<span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">server</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RouterSocket</span><span class="p">(</span><span class="s">&quot;inproc://async&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">1000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span> <span class="kt">var</span> <span class="p">(</span><span class="n">routingKey</span><span class="p">,</span> <span class="n">more</span><span class="p">)</span> <span class="p">=</span> <span class="k">await</span> <span class="n">server</span><span class="p">.</span><span class="n">ReceiveRoutingKeyAsync</span><span class="p">();</span> <span class="kt">var</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">=</span> <span class="k">await</span> <span class="n">server</span><span class="p">.</span><span class="n">ReceiveFrameStringAsync</span><span class="p">();</span> <span class="c1">// TODO: process message</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="m">100</span><span class="p">);</span> <span class="n">server</span><span class="p">.</span><span class="n">SendMoreFrame</span><span class="p">(</span><span class="n">routingKey</span><span class="p">);</span> <span class="n">server</span><span class="p">.</span><span class="n">SendFrame</span><span class="p">(</span><span class="s">&quot;Welcome&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">ClientAsync</span><span class="p">()</span>
<span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DealerSocket</span><span class="p">(</span><span class="s">&quot;inproc://async&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">1000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span> <span class="n">client</span><span class="p">.</span><span class="n">SendFrame</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">);</span> <span class="kt">var</span> <span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">more</span><span class="p">)</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">ReceiveFrameStringAsync</span><span class="p">();</span> <span class="c1">// TODO: process reply</span> <span class="k">await</span> <span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="p">(</span><span class="m">100</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">runtime</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NetMQRuntime</span><span class="p">())</span> <span class="p">{</span> <span class="n">runtime</span><span class="p">.</span><span class="n">Run</span><span class="p">(</span><span class="n">ServerAsync</span><span class="p">(),</span> <span class="n">ClientAsync</span><span class="p">());</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div> <p>NetMQRuntime is a wrapper over NetMQPoller, when calling an async function the socket is automatically added to the internal poller.
NetMQRuntime is also a NetMQScheduler and SyncrhonizationContext, so any awaited function is continuing on the runtime&apos;s thread.</p>
<p>NetMQSocket should still be used only within one thread.</p>
<p><code>NetMQRuntime.Run</code> can accept multiple tasks and also a cancellation token.
<code>NetMQRuntime.Run</code> runs until all tasks are completed or cancellation token has been cancelled.</p> </div> </div> <footer> Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer> </div> </div> </section> </p> <p class="rst-versions"> <span class="rst-current-version"> <a href="https://github.com/zeromq/netmq/" class="fa fa-github"> GitHub</a> <span><a href="../receiving-sending/">&#xAB; Previous</a></span> <span><a href="../message/">Next &#xBB;</a></span> </span>
</p> </body>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>