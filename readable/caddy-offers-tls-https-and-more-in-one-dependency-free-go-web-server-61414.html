<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Caddy offers TLS, HTTPS, and more in one dependency-free Go Web server - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Caddy offers TLS, HTTPS, and more in one dependency-free Go Web server - linksfor.dev(s)"/>
    <meta property="article:author" content="Jim Salter&#xA;    -  5/6/2020, 5:56 AM"/>
    <meta property="og:description" content="We put Caddy 2.0.0 head to head against a ranking heavyweight, Apache 2.4.41."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://arstechnica.com/gadgets/2020/05/caddy-offers-tls-https-and-more-in-one-dependency-free-go-web-server/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Caddy offers TLS, HTTPS, and more in one dependency-free Go Web server</title>
<div class="readable">
        <h1>Caddy offers TLS, HTTPS, and more in one dependency-free Go Web server</h1>
            <div>by Jim Salter&#xA;    -  5/6/2020, 5:56 AM</div>
            <div>Reading time: 22-27 minutes</div>
        <div>Posted here: 06 May 2020</div>
        <p><a href="https://arstechnica.com/gadgets/2020/05/caddy-offers-tls-https-and-more-in-one-dependency-free-go-web-server/">https://arstechnica.com/gadgets/2020/05/caddy-offers-tls-https-and-more-in-one-dependency-free-go-web-server/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
    <header>
      <h4>
      works on my laptop    —
</h4>
      
      <h2 itemprop="description">We put Caddy 2.0.0 head to head against a ranking heavyweight, Apache 2.4.41.</h2>
      <section>

  
  


  
</section>    </header>

    <section>
      <div itemprop="articleBody">
        
<figure>
  <img src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/Screenshot-from-caddyserver.com-slash-v2-grey-canvas-800x444.png" alt="Production-ready in a few lines? Color us interested.">
      <figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/Screenshot-from-caddyserver.com-slash-v2-grey-canvas.png" data-height="500" data-width="900">Enlarge</a> <span>/</span> Production-ready in a few lines? Color us interested.</p></figcaption>  </figure>

  




<!-- cache hit 3156:single/related:14c090b7cfcbe6e512bfed107a9a3f69 --><!-- empty -->
<p>Yesterday, the <a href="https://caddyserver.com/">Caddy</a>&nbsp;Web server reached an important milestone, with its 2.0.0 release. Caddy bills itself as "The Ultimate Server," with no dependencies, automatic TLS certificate obtainment and renewal, and much smaller configuration files than Apache or Nginx.</p>
<p>Senior Technology Editor <a href="https://arstechnica.com/author/lee-hutchinson/">Lee Hutchinson</a> expressed both curiosity about Caddy and his own personal inertia in the Ars slack:</p>
<blockquote><p>Caddy is an app where every time i see it or think of it i say “I should mess with it, it looks neat” and then I never do. I’ve gotten so enmeshed in my haproxy - varnish - nginx stack that breaking out feels like more trouble than it’s worth.</p></blockquote>
<p>I hadn't ever heard of Caddy until Lee mentioned it, but I know a call to action when I hear one.</p>
<h2>Baby's first (mis)steps with Caddy</h2>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/caddy-a-whole-new-server-experience.png" data-height="655" data-width="1436" alt="Really fun to use, they said... HTTPS just works, they said. Spoiler alert: kinda depends on how you go about it."><img alt="Really fun to use, they said... HTTPS just works, they said. Spoiler alert: kinda depends on how you go about it." src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/caddy-a-whole-new-server-experience-640x292.png" width="640" height="292" srcset="https://cdn.arstechnica.net/wp-content/uploads/2020/05/caddy-a-whole-new-server-experience-1280x584.png 2x"></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/caddy-a-whole-new-server-experience.png" data-height="655" data-width="1436">Enlarge</a> <span>/</span> Really fun to use, they said... HTTPS just works, they said. Spoiler alert: kinda depends on how you go about it.</p></figcaption></figure>
<p>After watching a short animation demonstrating rapid deployment of Caddy, I dove right into the linked <a href="https://caddyserver.com/docs/quick-starts/https">HTTPS quick-start</a> docs. This turned out not to be the best way to experience Caddy for the first time, to put it mildly. The quick-start tutorial glossed over the actual installation of Caddy, and I'd already left the Github release page—so my next thought was to look for Caddy in the usual places, on a fresh Ubuntu 20.04 VM.</p>
<p>When <code>apt search caddy</code>&nbsp;came up empty, I tried <code>snap search caddy</code>&nbsp;instead—and, bingo:</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/000-snap-install-caddy.png" data-height="900" data-width="1440" alt="It can't be this easy... can it?"><img alt="It can't be this easy... can it?" src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/000-snap-install-caddy-640x400.png" width="640" height="400" srcset="https://cdn.arstechnica.net/wp-content/uploads/2020/05/000-snap-install-caddy-1280x800.png 2x"></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/000-snap-install-caddy.png" data-height="900" data-width="1440">Enlarge</a> <span>/</span> It can't be this easy... can it?</p><p>Jim Salter</p></figcaption></figure>
<p>Not only was caddy available in the Ubuntu snap repositories, it was 2.0.0—the version that was just released! So I did a <code>snap install caddy</code>, and I was off to the races. Unfortunately, I wasn't off to the races in a good way. The caddy snap didn't just install caddy, it also started it as a service—somewhere—which I discovered when I attempted to follow the quick-start's directive to run <code>caddy start</code>&nbsp;in any random directory where I'd created a file named <code>Caddyfile</code>.</p>
<p>Although it was&nbsp;<em>possible</em> to make Caddy do my bidding from this snap, I never did figure out where the snap kept Caddy's configs—so the only way I could get it to work was to <code>snap stop caddy</code>, <code>ps wwaux | grep caddy | grep -v grep</code>&nbsp;to make sure the snap didn't still have a process running sneakily (which it sometimes did) and kill it if so, then run it manually.</p>
<p>To be fair, the quick-start docs seemed to make out running caddy manually to be a good thing—and several of the top results I found when googling "install caddy" instructed me to pipe <code>curl https://getcaddy.com/</code>&nbsp;directly to <code>sudo bash -s personal</code>.</p>
<p>As a sysadmin, not developer—and a particularly security-aware sysadmin—I had a pretty violent reaction to that advice. It still makes my eyelid twitch just&nbsp;<em>looking</em> at that. Please, folks—do not just pipe the Internet directly into your system's brain, complete with root privileges.</p>
<h2>Installing Caddy the right way</h2>
      <div>
      <div><div><ul>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/002-install-caddy-from-apt-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/002-install-caddy-from-apt.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/002-install-caddy-from-apt-980x735.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/002-install-caddy-from-apt.png 2560" data-sub-html="#caption-1673670">
            <figure>
              
                              <figcaption id="caption-1673670">
                  <span></span>
                                      <p>
                      In addition to .deb files available directly from the Github release page, Caddy offers its own third-party apt repository (and similar resources for non-Debian-based distributions).                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/004-no-https-no-service-no-dice-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/004-no-https-no-service-no-dice.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/004-no-https-no-service-no-dice-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/004-no-https-no-service-no-dice-1440x900.png 2560" data-sub-html="#caption-1673673">
            <figure>
              
                              <figcaption id="caption-1673673">
                  <span></span>
                                      <p>
                      With the stock Caddyfile, Caddy only services requests on port 80—but its default behavior also includes mandatory redirection to HTTPS, so all you see in a browser is "Unable to connect."                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/005-caddy-running-on-localhost-with-snake-oil-cert-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/005-caddy-running-on-localhost-with-snake-oil-cert.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/005-caddy-running-on-localhost-with-snake-oil-cert-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/005-caddy-running-on-localhost-with-snake-oil-cert-1440x900.png 2560" data-sub-html="#caption-1673674">
            <figure>
              
                              <figcaption id="caption-1673674">
                  <span></span>
                                      <p>
                      For dev purposes, you can get Caddy running by replacing ":80" with "localhost" in your Caddyfile. This gets you a snake oil certificate—and security warnings in your browser.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/006-caddy-snakeoil-cert-in-firefox-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/006-caddy-snakeoil-cert-in-firefox.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/006-caddy-snakeoil-cert-in-firefox-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/006-caddy-snakeoil-cert-in-firefox-1440x900.png 2560" data-sub-html="#caption-1673677">
            <figure>
              
                              <figcaption id="caption-1673677">
                  <span></span>
                                      <p>
                      Firefox is deeply unhappy about Caddy Local Authority - ECC Intermediate, whether the rest of the system trusts it or not.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/007-caddy-default-webpage-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/007-caddy-default-webpage.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/007-caddy-default-webpage-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/007-caddy-default-webpage-1440x900.png 2560" data-sub-html="#caption-1673678">
            <figure>
              
                              <figcaption id="caption-1673678">
                  <span></span>
                                      <p>
                      Oh hey, look—it's a default webpage! Unfortunately, you really need the helpful instructions it contains well before you get to the point where you can actually see them here.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
              </ul></div></div>
    </div>
  
<p>Fortunately, there are much saner paths to happy Caddy-ing. There are native packages for several distributions and architectures available at the Github <a href="https://github.com/caddyserver/caddy/releases">release</a> page, and that's how I installed Caddy next—but&nbsp;if you steer clear of search engines and restrict yourself to Caddy's own <a href="https://caddyserver.com/docs/install">install document</a>, there is an even better path; they maintain their own apt repository.</p>
<p>When Caddy is installed either directly from a .deb at the Github release, or from the repository at apt.fury.io, you get a functional, integrated Web server that's ready to go—well, mostly, anyway. The default Caddyfile runs the server on <code>localhost:80</code>, but its default behavior also includes a mandatory HTTPS redirect—so all you'll see in a browser is "Unable to connect."</p>
<p>Updating the host line in your Caddyfile from <code>:80</code>&nbsp;to <code>localhost</code>&nbsp;and then doing <code>caddy reload</code>&nbsp;gets you an automatic <a href="https://wiki.debian.org/Self-Signed_Certificate">snake oil certificate</a> issued. It looks like Caddy also attempted to add the new snake oil certificate to my Ubuntu VM's certificate trust store—but Firefox certainly didn't trust it, and we're presented with trust errors and dire warnings.</p>
<p>These can at least be clicked through, and finally we have proof of function: a strangely slanted default webpage. That default webpage tells us something that should be obvious now: all of this would really work&nbsp;<em>much</em> better if we had a real domain to play with. Caddy doesn't just default to HTTPS/TLS available, it really doesn't want anything to do with you&nbsp;<em>without</em> TLS—and that means a real, publicly resolvable domain.</p>
<h2>Zero to WordPress—eventually</h2>
      <div>
      <div><div><ul>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/008-caddytest-vs-apache-test-fight-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/008-caddytest-vs-apache-test-fight.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/008-caddytest-vs-apache-test-fight-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/008-caddytest-vs-apache-test-fight-1440x900.png 2560" data-sub-html="#caption-1673681">
            <figure>
              
                              <figcaption id="caption-1673681">
                  <span></span>
                                      <p>
                      We're looking at WordPress installs on two Ubuntu 20.04 droplets at Digital Ocean—Caddy on the left, Apache on the right.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/009-caddytest-vs-apachetest-wp-admin-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/009-caddytest-vs-apachetest-wp-admin.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/009-caddytest-vs-apachetest-wp-admin-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/009-caddytest-vs-apachetest-wp-admin-1440x900.png 2560" data-sub-html="#caption-1673696">
            <figure>
              
                              <figcaption id="caption-1673696">
                  <span></span>
                                      <p>
                      Our Caddy droplet had a redirect loop problem with wp-admin—this turned out to be due to an odd directive in the sample Caddyfile used in the docs.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
                  <li data-thumb="https://cdn.arstechnica.net/wp-content/uploads/2020/05/010-caddytest-wp-admin-redirect-loop-solved-150x150.png" data-src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/010-caddytest-wp-admin-redirect-loop-solved.png" data-responsive="https://cdn.arstechnica.net/wp-content/uploads/2020/05/010-caddytest-wp-admin-redirect-loop-solved-980x613.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2020/05/010-caddytest-wp-admin-redirect-loop-solved-1440x900.png 2560" data-sub-html="#caption-1673684">
            <figure>
              
                              <figcaption id="caption-1673684">
                  <span></span>
                                      <p>
                      Commenting out a line in the sample Caddyfile turned out to be all that was needed to resolve the redirect loop in wp-admin.                    </p>
                                                        <p><span></span>
                                              Jim Salter                                          </p>
                                  </figcaption>
                          </figure>
          </li>
              </ul></div></div>
    </div>
  
<p>Now that I knew I could get Caddy working at all, it was time to get it working for real—or at least, "real" enough to write an article about it. A simple "hello world" static webpage wasn't enough of a test—and since WordPress powers roughly <a href="https://w3techs.com/technologies/details/cm-wordpress">36%</a> of the websites on the planet, it looked like a great place to start.</p>
<p>I also wanted to do a head-to-head comparison with a more traditional Web server, since my first exposure to Caddy was its claims of being simple, fun, and much easier to configure. Frankly, I was a little dubious of the last claim—much of the time, when a developer tells you something is "easy to configure" they really should just be telling you "I know all the pitfalls here very well."</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/011-sample-Caddyfile-with-noob-trap.png" data-height="639" data-width="1087" alt="There's a noob trap lurking in this sample Caddyfile—that try_files directive is unnecessary for most sites and caused our WordPress redirect loop."><img alt="There's a noob trap lurking in this sample Caddyfile—that try_files directive is unnecessary for most sites and caused our WordPress redirect loop." src="https://cdn.arstechnica.net/wp-content/uploads/2020/05/011-sample-Caddyfile-with-noob-trap-640x376.png" width="640" height="376" srcset="https://cdn.arstechnica.net/wp-content/uploads/2020/05/011-sample-Caddyfile-with-noob-trap.png 2x"></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2020/05/011-sample-Caddyfile-with-noob-trap.png" data-height="639" data-width="1087">Enlarge</a> <span>/</span> There's a noob trap lurking in this sample Caddyfile—that try_files directive is unnecessary for most sites and caused our WordPress redirect loop.</p><p>Jim Salter</p></figcaption></figure>
<p>One such pitfall is the sample Caddyfile presented at&nbsp;<a href="https://caddyserver.com/docs/caddyfile">https://caddyserver.com/docs/caddyfile</a>. The tutorial proudly tells you "that's a real, production-ready Caddyfile that serves a Craft CMS site with fully managed HTTPS." What it doesn't tell you is that one of the directives in that simple file will break most sites that&nbsp;<em>aren't</em> the <a href="https://craftcms.com/">Craft CMS</a>. The <code>try_files</code>&nbsp;directive shown overrides the <code>try_files</code>&nbsp;directive implicit in the <code>fastcgi</code>&nbsp;directive itself, and it caused a nasty redirect loop in the WordPress dashboard once I got it up and running.</p>
<h2>Caddy 2.0.0 vs Apache 2.4.41—installation fight!</h2>
<p>I had two major questions about Caddy 2.0.0—was it really easier to configure than a more conventional Web server, and how well would it perform? If this was a boxing match, Caddy was clearly the contender—and I chose Apache to serve as the reigning champion for it to challenge.</p>
<p>I spun up two new Digital Ocean droplets running Ubuntu 20.04 and set up WordPress from scratch on each of them—one running Caddy 2.0.0 from its third-party repository, and one running Apache 2.4 straight from the Ubuntu Focal Fossa repos.</p>
<p>The usual buzz is that Apache is old and slow compared to the other common Web service heavyweight, Nginx. Most of this reputation is undeserved—Apache has been around forever, and <a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-apache-mysql-php-lamp-stack-ubuntu-18-04">guide,</a> after <a href="https://ubuntu.com/tutorials/install-and-configure-wordpress#2-install-wordpress">guide,</a> after <a href="https://www.linode.com/docs/web-servers/lamp/how-to-install-a-lamp-stack-on-ubuntu-18-04/">guide</a> advises users to configure it poorly. Yes, if you configure Apache to use the antediluvian <code>mod_php</code> module, performance as an application server will suck—this forces Apache to use the <code>prefork</code> <a href="https://www.liquidweb.com/kb/apache-mpms-explained/" rel="nofollow">MPM</a>.</p>
<p>If you don't&nbsp;<em>force</em> Apache into using <code>prefork</code>, under modern Ubuntu it defaults instead to the <code>event</code>&nbsp;multi-processing module, which is far lighter-weight. Under <code>prefork</code>&nbsp;and <code>mod_php</code>, Apache and PHP are run as one gigantic hybrid process, which is extremely wasteful of RAM and processing power when serving static files such as CSS, images, or pure HTML.</p>
<p>When you avoid <code>mod_php</code>&nbsp;and use <code>event</code>&nbsp;with <code>php-fpm</code>&nbsp;instead, Apache changes from a sluggish beast into a real contender that can go toe to toe with nginx.</p>
<h3>Common pre-installation steps</h3>
<p>There's a lot of installation necessary to get a working WordPress instance up that doesn't have anything specific to do with either Apache or Caddy. I'm going to list those necessary steps here, which were identical for both Web servers as (eventually) configured.</p>
<p><code>root@droplet:~# apt update ; apt install mysql-server php-fpm php-common php-mbstring php-xmlrpc php-soap php-gd php-xml php-intl php-mysql php-cli php-ldap php-zip php-curl<br>
root@droplet:~# grep pass /etc/mysql/debian.cnf</code></p>
<p>First, we install the MySQL database server, the PHP fast process manager, and a whole string of PHP extensions that WordPress will need to run properly. Then we get the maintenance user's password from <code>/etc/mysql/debian.cnf</code>, so that we can install a database for our WordPress instance to use.</p>
<p><code>root@droplet:~# mysql -u debian-sys-maint -p<br>
mysql&gt; create database wordpress;<br>
mysql&gt; create user 'wordpress'@'localhost' identified by 'supersecretpassword';<br>
mysql&gt; grant all on *.* to 'wordpress'@'localhost';</code></p>
<p>This was actually a bit of a head-scratcher—the MySQL syntax for granting privileges on a database changed with MySQL 8.0, which is now the default in Ubuntu Focal. The syntax shown above is correct!</p>
<p>The other step you need is a domain to play with and working DNS that actually points to your server. I used new hostnames at one of my own domains and just updated my BIND zone file to add them. For someone with less existing infrastructure, it's easier to use the provided DNS at a registrar such as <a href="https://www.namecheap.com/" rel="nofollow">Namecheap</a>.</p>
<p>However you handle it, you're going to need a publicly accessible IP address, reachable on both ports 80 and 443—and you're going to need public, resolvable DNS to point to it. Detailing that is unfortunately out of scope here.</p>
<h3>Installing and configuring Apache 2.4</h3>
<p>Apache, unsurprisingly, is right there in Ubuntu 20.04's main apt repository. Installation is as straight-forward as it can be, with minimal reconfiguration necessary to get things working.</p>
<p><code>root@droplet:~# apt install apache2 python3-certbot-apache<br>
root@droplet:~# a2enmod proxy_fcgi<br>
root@droplet:~# a2enconf php7.4-fpm<br>
root@droplet:~# sed 's/#ServerName www.example.com/yourdomain.com/' /etc/apache2/sites-enabled/000-default.conf<br>
root@droplet:~# systemctl restart apache2<br>
root@droplet:~# certbot</code></p>
<p>If that <code>sed</code>&nbsp;command is making you nervous, don't let it—that's just a bit of shorthand to let me get away with not putting a <code>nano</code>&nbsp;in the middle of the workflow. All the <code>sed</code>&nbsp;command is doing is finding the commented-out line in the default vhost config file, which would set the <code>ServerName</code>&nbsp;directive, and replacing it with a real directive to use our working DNS hostname.</p>
<p>This is it for the Apache-specific configs—with this done, we skip to the post-installation, and we've got a working WordPress!</p>
<h3>Installing and configuring Caddy 2.0.0</h3>
<p>I didn't really find getting Caddy going any easier than I had getting Apache going. Granted, I've technically got more than 20 years of Apache experience—but this wasn't my first trip to the new-software-for-the-same-purpose rodeo, either.</p>
<p>I'm skipping most of the fumbling-toward-goal trial and error I slogged through on the way to finally getting a working Caddy configuration, in the interests of making this comparison as fair to Caddy as possible despite my much greater experience with Apache.</p>
<p><code>root@caddytest:~# echo&nbsp;"deb [trusted=yes] https://apt.fury.io/caddy/ /" &gt; /etc/apt/sources.list.d/caddy-fury.list<br>
root@caddytest:~# apt update<br>
root@caddytest:~# apt install caddy</code></p>
<p>At this point, I need to break from the workflow I had with Apache—there's no option as simple as just uncommenting a line in the default config; I needed to start over with a new Caddyfile. I used the example Caddyfile <a href="https://caddyserver.com/docs/caddyfile">provided</a> at caddyserver.com—but with the unfortunate noob trap edited out.</p>
<pre>root@caddytest:~# cat /etc/caddy/Caddyfile

yourdomain.com
root * /var/www/html

# this wasn't in the sample Caddyfile—
# and without it, Caddy gets no logging at all!
#
log {
output file /var/log/caddy/access.log
format console
}

# this is the noob trap that caused a wp-admin redirect loop
#try_files {path} /index.php?{query}&amp;p={path}

php_fastcgi unix//run/php/php-fpm.sock
file_server</pre>
<p>So far, so good—but the ownership of the <code>php-fpm</code>&nbsp;pool also needs to be changed. By default, it's owned by the <code>www-data</code>&nbsp;user—but Caddy runs as <code>caddy</code>, not <code>www-data</code>. Without updating that permission, Caddy won't be allowed to access the unix socket that&nbsp;<code>php-fpm</code>&nbsp;is operating from.</p>
<p>We could also work around this by running <code>php-fpm</code>&nbsp;over a TCP socket on <code>localhost</code>—but that would also require more configuration and would result in a lower-performance stack.</p>
<p><code>root@caddytest:~# sed -i 's/www-data/caddy/g' /etc/php/7.4/fpm/pool.d/www.conf<br>
root@caddytest:~$ systemctl restart php7.4-fpm<br>
root@caddytest:~$ systemctl restart caddy</code></p>
<p>I needed a much deeper knowledge of the <code>php-fpm</code>&nbsp;stack to get things working here than I did with Apache. There was also no working logging in the sample Caddyfile provided—and a noob trap in that sample that enables a highly unusual setup (Craft CMS, with a <a href="https://w3techs.com/technologies/details/cm-craft">0.2%</a>&nbsp;CMS marketshare), while breaking most setups, including the most common one on the planet (WordPress, with a <a href="https://w3techs.com/technologies/details/cm-wordpress">63.3%</a> CMS marketshare).</p>
<p>I'm well aware that I have a lot more experience with Apache than Caddy, but I don't see how Caddy can reasonably be granted an ease-of-use win here.</p>
<h3>Common post-installation steps</h3>
<p>We also need to download WordPress itself, unpack it, and put it in the directory where it will be served.</p>
<p><code>root@droplet:~# mkdir -p /var/www<br>
root@droplet:~# cd /var/www/<br>
root@droplet:/var/www# wget https://wordpress.org/latest.tar.gz<br>
root@droplet:/var/www# mv html html-dist ; mv wordpress html<br>
root@droplet:/var/www# chown -R $webserveruser html</code></p>
<p>Okay, we had to fudge things a little in this step: Apache doesn't actually need you to create the <code>/var/www</code>&nbsp;directory, and Caddy doesn't need you to <code>mv html html-dist</code>, since it didn't have a directory in <code>/var/www</code>&nbsp;to start with. But in the interest of getting common things out of the way, we're going to call this one a draw.</p>
<p>If some poor soul is trying to use this as a guide to getting WordPress working, I should also point out that $webserveruser isn't literal here—for Apache, it's <code>www-data</code>, and for Caddy, it's <code>caddy</code>.</p>
<p>Once this is done, you're ready to point the nearest browser to <code>https://yourdomain.com/</code>&nbsp;and walk through the WordPress installation.</p>
<h2>Caddy 2.0.0 vs Apache 2.4.41—performance fight!</h2>
<p>Once WordPress was installed and fully operational on both droplets, it was time for a performance test. I used the venerable apachebench tool running on localhost on each droplet for the testing; this was provided along with Apache itself on the Apache droplet and provided with <code>apt install apache2-utils</code>&nbsp;on the Caddy droplet.</p>
<p>The short version here is that Caddy wins. With a simple <code>ab -c5 -t10 https://yourdomain.com/</code>&nbsp;running against a default virgin WordPress with the single Hello World post, Apache pulls 37.8 requests per second to Caddy's 42.4. Caddy also delivered slightly faster median requests, at 114ms to Apache's 129ms, and faster 99th percentile requests at 182ms to Apache's 184ms.</p>
<p>With that said, this is a pretty silly artificial benchmark that isn't much use aside from giving us a reasonable overall idea of Web server performance. A real-world WordPress site tuned to survive a <a href="https://en.wikipedia.org/wiki/Slashdot_effect">Slashdotting</a>&nbsp;(Arsdotting?) is going to need a lot of configuration and tuning beyond what we did here—we need more <code>php-fpm</code>&nbsp;workers available, we need to install a WordPress performance plugin such as <a href="https://wordpress.org/plugins/w3-total-cache/">W3-Total-Cache</a>&nbsp;installed, and we need to configure that performance plugin to cache objects, files, queries, and more.</p>
<p>On the Apache side, that means installing <code>php-apc</code>&nbsp;at a minimum, preferably <code>memcached</code>&nbsp;to go along with it, and configuring both of those. I'll readily admit I'm not certain whether either or both of those are necessary for Caddy—I see one of the gears in a promo graphic for it labeled "Caching," but it's not entirely clear what Caddy's native capabilities here entail. I found documents for an optional cache&nbsp;<a href="https://caddyserver.com/v1/docs/http.cache">plugin</a> for Caddy 1.x, but this doesn't appear to be applicable to 2.0.0.</p>
<p>If you really need to get the most performance possible out of a Web stack, you're going to veer rapidly from Caddy's initial promise of "easy, fun setup" and get into the sysadmin's usual grind of determination and thoroughness, no matter your platform. Your results are also likely to differ strongly from one workload to another—"fastest" for WordPress and "fastest" for Craft or something else may be very different answers.</p>
<h2>Conclusions</h2>
<p>Caddy is a capable Web server that seems to be headed in good directions with the 2.0.0 release. The earlier version's installation advice to just pipe <code>curl</code>&nbsp;to <code>sudo bash</code>&nbsp;made me grind my teeth, but it appears that the project has matured considerably and is going for much saner, healthier recommended configurations now.</p>
<p>It also performs quite well, eking out a small but measurable win against Apache 2.4.41 running the <code>mpm_event</code>&nbsp;model. This puts it in the same general performance ballpark as nginx. When properly configured, Apache, nginx, and Caddy will all perform reasonably similarly—so if Caddy's general style and design float your boat, it appears to be a solid choice.</p>
<p>On the other hand, it's difficult to beat the decades of experience and flexibility that Apache's configuration design brings to the table. If all you're worried about is one or two sites, you may not see much difference between configuring Caddy or Apache. But if you're routinely managing tens—or hundreds—of sites, Apache's ability to cleanly separate virtual-host specific configs in their own individual files might start looking pretty indispensable.</p>
<h3>The good</h3>
<ul>
<li>Built-in everything with no dependencies makes Caddy simple to install and simple to upgrade, even outside traditional package management systems</li>
<li>World-class performance as compared to Apache 2.4.41 (event MPM) and, by extension, Nginx</li>
<li>Caddy has its own apt repos for Debian-based distributions</li>
<li>Lack of dependencies make Caddy extremely portable&nbsp;<em>between</em> distributions, with no potential library conflicts in binary builds</li>
<li>Short, if occasionally somewhat arcane,&nbsp;config files</li>
</ul>
<h3>The bad</h3>
<ul>
<li>Documentation can be a bit rough—sample files aren't entirely workable for standard usecases, are missing functionality, etc</li>
<li>Conflicts between v2.0 and v1.x configuration syntax—they're almost entirely incompatible, and it's easy to accidentally end up on a 1.x doc if you're Googling for answers</li>
<li>"Docs" and "tutorials" often seem to conflict—some focus on cowboy-style running from the CLI, others on a more sane, traditional system-oriented configuration</li>
</ul>
<h3>The ugly</h3>
<ul>
<li>HTTPS-only means snake oil certs and security warnings if you're in an environment with no public IP and/or no working DNS</li>
<li>Very low "Web server marketshare"—less than 0.1%, according to <a href="https://w3techs.com/technologies/details/ws-caddy">w3techs</a>—means you're very much on the path less traveled</li>
<li>No distribution package management—you're relying directly on the project itself for all QA and security</li>
</ul>


                  
              </div>

      
      
    </section>
  </div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>