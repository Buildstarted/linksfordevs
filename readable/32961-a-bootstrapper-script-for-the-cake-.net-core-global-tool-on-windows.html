<!DOCTYPE html>
<html lang="en">
<head>
    <title>
A bootstrapper script for the Cake .NET Core Global Tool on Windows -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>A bootstrapper script for the Cake .NET Core Global Tool on Windows</h1><div><div class="post-content"><p>In <a href="/how-to-build-with-cake-on-linux-using-cake-coreclr-or-the-cake-global-tool/">my previous post</a>, I described how to use Cake.CoreCLR and Cake.Tool versions of <a href="https://cakebuild.net/">Cake</a> to run build scripts on Linux, without requiring Mono. This post acts as a short addendum to that one, by providing a PowerShell bootstrapper script equivalent of <a href="/how-to-build-with-cake-on-linux-using-cake-coreclr-or-the-cake-global-tool/#building-on-linux-with-the-cake-global-tool">the bash bootstrapper</a>. </p><p>One of the big advantages of Cake build scripts is that they are cross platform, so the same build script can be run across Windows Linux and Mac. Unfortunately, the <em>bootstrapping</em> scripts are generally platform-specific. </p><blockquote><p>PowerShell Core provides a possible solution to this given that it's cross platform, but I don't know how widespread it really is on the Linux side. The <a href="https://github.com/dotnet/dotnet-docker/issues/1069">addition of PowerShell Core to the .NET Core 3.0 SDK images</a> may go some way to improving the situation for .NET developers.</p></blockquote><p>In the previous post I provided bootstrapping scripts for Linux, which is how all of the .NET Core apps I work on are built and deployed. When developing locally I use Windows, so the bash scripts I provided are no good. Instead, I use a PowerShell script.</p><p>On Windows, you can feasibly choose <a href="/how-to-build-with-cake-on-linux-using-cake-coreclr-or-the-cake-global-tool/#cake-cake-coreclr-and-cake-tool">any of the three versions of Cake</a> to run your build scripts. However it's definitely a good idea to use the same version as you use in your CI process, to avoid subtle differences between local builds and your build servers. </p><p>The following PowerShell script, uses <a href="/how-to-build-with-cake-on-linux-using-cake-coreclr-or-the-cake-global-tool/#building-on-linux-with-the-cake-global-tool">the global tool approach from the previous post</a>. This script is Windows specific, and assumes you already have .NET Core installed - for a much more exhaustive script that uses PowerShell Core, <a href="https://github.com/cake-build/cake/blob/06e7983704/build.ps1">see the bootstrapper from the Cake project itself</a>.</p><pre class="language-powershell"><code class="language-powershell"><span class="token namespace">[CmdletBinding()]</span><span class="token keyword">Param</span><span class="token punctuation">(</span><span class="token namespace">[string]</span><span class="token variable">$Script</span> = <span class="token string">"build.cake"</span><span class="token punctuation">,</span><span class="token namespace">[string]</span><span class="token variable">$CakeVersion</span> = <span class="token string">"0.33.0"</span><span class="token punctuation">,</span><span class="token namespace">[string]</span><span class="token variable">$Target</span><span class="token punctuation">,</span><span class="token namespace">[Parameter(Position=0,Mandatory=$false,ValueFromRemainingArguments=$true)]</span><span class="token namespace">[string[]]</span><span class="token variable">$ScriptArgs</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$PSScriptRoot</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$PSScriptRoot</span> = <span class="token function">Split-Path</span><span class="token variable">$MyInvocation</span><span class="token punctuation">.</span>MyCommand<span class="token punctuation">.</span>Path <span class="token operator">-</span>Parent
<span class="token punctuation">}</span><span class="token variable">$ToolsDir</span> = <span class="token function">Join-Path</span><span class="token variable">$PSScriptRoot</span><span class="token string">"tools"</span><span class="token variable">$CakePath</span> = <span class="token function">Join-Path</span><span class="token variable">$ToolsDir</span><span class="token string">"dotnet-cake.exe"</span><span class="token variable">$CakeInstalledVersion</span> = <span class="token function">Get-Command</span><span class="token variable">$CakePath</span><span class="token operator">-</span>ErrorAction SilentlyContinue  <span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">{</span>&amp;<span class="token variable">$_</span><span class="token punctuation">.</span>Source <span class="token operator">--</span>version<span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$CakeInstalledVersion</span><span class="token operator">-ne</span><span class="token variable">$CakeVersion</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">Test-Path</span><span class="token variable">$CakePath</span><span class="token operator">-</span>PathType leaf<span class="token punctuation">)</span><span class="token punctuation">{</span>
        &amp; dotnet tool uninstall Cake<span class="token punctuation">.</span>Tool <span class="token operator">--</span>tool<span class="token operator">-</span>path <span class="token string">"<span class="token variable">$ToolsDir</span>"</span><span class="token punctuation">}</span><span class="token function">Write-Output</span><span class="token string">"Installing Cake <span class="token variable">$CakeVersion</span>..."</span>
    &amp; dotnet tool install Cake<span class="token punctuation">.</span>Tool <span class="token operator">--</span>tool<span class="token operator">-</span>path <span class="token string">"<span class="token variable">$ToolsDir</span>"</span><span class="token operator">--</span>version <span class="token variable">$CakeVersion</span><span class="token punctuation">}</span><span class="token variable">$cakeArguments</span> = @<span class="token punctuation">(</span><span class="token string">"<span class="token variable">$Script</span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$Target</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$cakeArguments</span><span class="token operator">+=</span><span class="token string">"--target=<span class="token variable">$Target</span>"</span><span class="token punctuation">}</span><span class="token variable">$cakeArguments</span><span class="token operator">+=</span><span class="token variable">$ScriptArgs</span>

&amp; <span class="token string">"<span class="token variable">$CakePath</span>"</span><span class="token variable">$cakeArguments</span><span class="token keyword">exit</span><span class="token variable">$LASTEXITCODE</span></code></pre><p>Hopefully the script is fairly self explanatory. It starts by checking the installed version of Cake.Tool (if any). If the correct version is not installed, it installs the global tool using <code>dotnet tool install</code>, providing a <code>--tool-path</code> to install the tool locally, instead of globally. After building the script arguments, it runs the tool! </p><p>If you compare this script to <a href="https://github.com/cake-build/cake/blob/06e7983704/build.ps1">the Cake project's version</a>, you'll see that this one is definitely minimalist! Consider your use cases, such as whether you want to automate the install of .NET Core, and whether you want a cross-platform PowerShell script, and choose whichever works for you.</p><p>Another alternative is to use Cake.CoreCLR instead of the Cake.Tool global tool. <a href="https://gist.github.com/litichevskiydv/5730376e407c4a11413a7bbd274d1ca6#file-build-ps1">This gist</a> by <a href="https://medium.com/@dmitriy.litichevskiy">Dmitriy Litichevskiy</a> shows a PowerShell version of the "dummy project" approach I used <a href="/how-to-build-with-cake-on-linux-using-cake-coreclr-or-the-cake-global-tool/#building-on-linux-with-cake-coreclr">in my previous post</a> if you prefer. Personally I think the global tool is the cleaner approach, but to each their own!</p><h2 id="summary" class="heading-with-anchor">Summary<a href="#summary"><img aria-hidden="true" src="/assets/img/icons-link.svg"></a></h2><p>In this post I show a Windows PowerShell bootstrapping script for running Cake build scripts using the Cake.Tool .NET Core global tool. The script checks the version of the Cake global tool installed, and replaces it with the correct version if necessary. For a cross-platform PowerShell Core script that also scripts installing .NET Core, <a href="https://github.com/cake-build/cake/blob/06e7983704/build.ps1">see this example from the Cake project</a>.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>