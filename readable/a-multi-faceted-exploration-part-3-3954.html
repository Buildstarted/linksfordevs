<!DOCTYPE html>
<html lang="en">
<head>
    <title>
A Multi-Faceted Exploration (Part 3) - Self Shadow - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="A Multi-Faceted Exploration (Part 3) - Self Shadow - linksfor.dev(s)"/>
    <meta property="article:author" content="Stephen Hill"/>
    <meta property="og:description" content="A New Dimension In the last post, I&#x2019;d shown how a small tweak to Imageworks&#x2019; multiple-scattering Fresnel term, $\color{brown}{F_\mathrm{ms}}$, &#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://blog.selfshadow.com/2018/08/05/multi-faceted-part-3/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - A Multi-Faceted Exploration (Part 3) - Self Shadow</title>
<div class="readable">
        <h1>A Multi-Faceted Exploration (Part 3) - Self Shadow</h1>
            <div>by Stephen Hill</div>
            <div>Reading time: 7-8 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="https://blog.selfshadow.com/2018/08/05/multi-faceted-part-3/">https://blog.selfshadow.com/2018/08/05/multi-faceted-part-3/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><p><img src="https://blog.selfshadow.com/images/multi-faceted/title-3.jpg"></p>

<h2 id="a-new-dimension">A New Dimension</h2>

<p>In the <a href="https://blog.selfshadow.com/2018/06/04/multi-faceted-part-2/">last post</a>, I’d shown how a small tweak to Imageworks’ multiple-scattering Fresnel term, <span><span id="MJXp-Span-1"><span id="MJXp-Span-2"><span id="MJXp-Span-3"><span id="MJXp-Span-4">F</span><span id="MJXp-Span-5"><span id="MJXp-Span-6">m</span><span id="MJXp-Span-7">s</span></span></span></span></span></span><span id="MathJax-Element-1-Frame" tabindex="0"><span id="MJXc-Node-1"><span id="MJXc-Node-2"><span id="MJXc-Node-3"><span id="MJXc-Node-4"><span id="MJXc-Node-5"><span><span id="MJXc-Node-6"><span>F</span></span></span><span><span id="MJXc-Node-7"><span id="MJXc-Node-8"><span id="MJXc-Node-9"><span>m</span></span><span id="MJXc-Node-10"><span>s</span></span></span></span></span></span></span></span></span></span></span>, brought their approximation closer to the reference solution of Heitz et al. However, there was still a niggling difference at high roughness, most noticeable under uniform lighting:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/conductors/spi_fixed_vs_heitz_wf.png"></p>

<p><em>Figure 1: Furnace test, with roughness <span><span id="MJXp-Span-8"><span id="MJXp-Span-9">∈</span><span id="MJXp-Span-10">[</span><span id="MJXp-Span-11"><span><span id="MJXp-Span-12">1</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-13">8</span></span></span></span></span></span><span id="MJXp-Span-14">,</span><span id="MJXp-Span-15"><span><span id="MJXp-Span-16">2</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-17">8</span></span></span></span></span></span><span id="MJXp-Span-18">,</span><span id="MJXp-Span-19">…</span><span id="MJXp-Span-20">1</span><span id="MJXp-Span-21">]</span></span></span><span id="MathJax-Element-2-Frame" tabindex="0"><span id="MJXc-Node-11"><span id="MJXc-Node-12"><span id="MJXc-Node-13"><span>∈</span></span><span id="MJXc-Node-14"><span>[</span></span><span id="MJXc-Node-15"><span><span><span id="MJXc-Node-16"><span>1</span></span></span><span><span id="MJXc-Node-17"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-18"><span>,</span></span><span id="MJXc-Node-19"><span><span><span id="MJXc-Node-20"><span>2</span></span></span><span><span id="MJXc-Node-21"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-22"><span>,</span></span><span id="MJXc-Node-23"><span>…</span></span><span id="MJXc-Node-24"><span>1</span></span><span id="MJXc-Node-25"><span>]</span></span></span></span></span> (left halves: Imageworks, right halves: Heitz).</em></p>

<p>At the end of the day, <span><span id="MJXp-Span-22"><span id="MJXp-Span-23"><span id="MJXp-Span-24"><span id="MJXp-Span-25">F</span><span id="MJXp-Span-26"><span id="MJXp-Span-27">m</span><span id="MJXp-Span-28">s</span></span></span></span></span></span><span id="MathJax-Element-3-Frame" tabindex="0"><span id="MJXc-Node-26"><span id="MJXc-Node-27"><span id="MJXc-Node-28"><span id="MJXc-Node-29"><span id="MJXc-Node-30"><span><span id="MJXc-Node-31"><span>F</span></span></span><span><span id="MJXc-Node-32"><span id="MJXc-Node-33"><span id="MJXc-Node-34"><span>m</span></span><span id="MJXc-Node-35"><span>s</span></span></span></span></span></span></span></span></span></span></span> is based on a simple diffuse model, and its limitations become more apparent as multiple scattering increases with roughness.</p>

<p>A more accurate alternative would be to precalculate a multiple-scattering directional albedo LUT that incorporates Fresnel, directly from the <em>Heitz</em> model. This new term, which I’ll call <span><span id="MJXp-Span-29"><span id="MJXp-Span-30"><span id="MJXp-Span-31"><span id="MJXp-Span-32">E</span><span id="MJXp-Span-33"><span id="MJXp-Span-34">F</span><span id="MJXp-Span-35">m</span><span id="MJXp-Span-36">s</span></span></span></span></span></span><span id="MathJax-Element-4-Frame" tabindex="0"><span id="MJXc-Node-36"><span id="MJXc-Node-37"><span id="MJXc-Node-38"><span id="MJXc-Node-39"><span id="MJXc-Node-40"><span><span id="MJXc-Node-41"><span>E</span></span></span><span><span id="MJXc-Node-42"><span id="MJXc-Node-43"><span id="MJXc-Node-44"><span>F</span></span><span id="MJXc-Node-45"><span>m</span></span><span id="MJXc-Node-46"><span>s</span></span></span></span></span></span></span></span></span></span></span>, leads to the following minor change to the multiple-scattering lobe:</p>

<p><span><span id="MJXp-Span-37"><span id="MJXp-Span-38"><span><span id="MJXp-Span-39"><span id="MJXp-Span-40"><span id="MJXp-Span-41"><span id="MJXp-Span-42"><span id="MJXp-Span-43">f</span><span id="MJXp-Span-44"><span id="MJXp-Span-45">m</span><span id="MJXp-Span-46">s</span></span></span></span><span id="MJXp-Span-47">=</span><span id="MJXp-Span-48"><span id="MJXp-Span-49"><span id="MJXp-Span-50">F</span><span id="MJXp-Span-51"><span id="MJXp-Span-52">m</span><span id="MJXp-Span-53">s</span></span></span></span><span id="MJXp-Span-54"><span><span id="MJXp-Span-55">(</span><span id="MJXp-Span-56">1</span><span id="MJXp-Span-57">−</span><span id="MJXp-Span-58"><span id="MJXp-Span-59">E</span><span id="MJXp-Span-60">(</span><span id="MJXp-Span-61"><span id="MJXp-Span-62">μ</span><span id="MJXp-Span-63">o</span></span><span id="MJXp-Span-64">)</span></span><span id="MJXp-Span-65">)</span><span id="MJXp-Span-66">(</span><span id="MJXp-Span-67">1</span><span id="MJXp-Span-68">−</span><span id="MJXp-Span-69"><span id="MJXp-Span-70">E</span><span id="MJXp-Span-71">(</span><span id="MJXp-Span-72"><span id="MJXp-Span-73">μ</span><span id="MJXp-Span-74">i</span></span><span id="MJXp-Span-75">)</span></span><span id="MJXp-Span-76">)</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-77">π</span><span id="MJXp-Span-78"></span><span id="MJXp-Span-79">(</span><span id="MJXp-Span-80">1</span><span id="MJXp-Span-81">−</span><span id="MJXp-Span-82"><span id="MJXp-Span-83"><span id="MJXp-Span-84">E</span><span id="MJXp-Span-85"><span id="MJXp-Span-86">a</span><span id="MJXp-Span-87">v</span><span id="MJXp-Span-88">g</span></span></span></span><span id="MJXp-Span-89">)</span></span></span></span></span></span><span id="MJXp-Span-90">⟹</span><span id="MJXp-Span-91"><span><span id="MJXp-Span-92"><span id="MJXp-Span-93"><span id="MJXp-Span-94">E</span><span id="MJXp-Span-95"><span id="MJXp-Span-96">F</span><span id="MJXp-Span-97">m</span><span id="MJXp-Span-98">s</span></span></span><span id="MJXp-Span-99">(</span><span id="MJXp-Span-100"><span id="MJXp-Span-101">μ</span><span id="MJXp-Span-102">o</span></span><span id="MJXp-Span-103">)</span></span><span id="MJXp-Span-104"></span><span id="MJXp-Span-105">(</span><span id="MJXp-Span-106">1</span><span id="MJXp-Span-107">−</span><span id="MJXp-Span-108"><span id="MJXp-Span-109">E</span><span id="MJXp-Span-110">(</span><span id="MJXp-Span-111"><span id="MJXp-Span-112">μ</span><span id="MJXp-Span-113">i</span></span><span id="MJXp-Span-114">)</span></span><span id="MJXp-Span-115">)</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-116">π</span><span id="MJXp-Span-117"></span><span id="MJXp-Span-118">(</span><span id="MJXp-Span-119">1</span><span id="MJXp-Span-120">−</span><span id="MJXp-Span-121"><span id="MJXp-Span-122"><span id="MJXp-Span-123">E</span><span id="MJXp-Span-124"><span id="MJXp-Span-125">a</span><span id="MJXp-Span-126">v</span><span id="MJXp-Span-127">g</span></span></span></span><span id="MJXp-Span-128">)</span></span></span></span></span></span><span id="MJXp-Span-129">.</span></span></span></span></span></span></span><span><span id="MathJax-Element-5-Frame" tabindex="0"><span id="MJXc-Node-47"><span id="MJXc-Node-48"><span id="MJXc-Node-49"><span><span><span id="MJXc-Node-50"><span id="MJXc-Node-54"><span id="MJXc-Node-55"><span id="MJXc-Node-56"><span id="MJXc-Node-57"><span id="MJXc-Node-58"><span><span id="MJXc-Node-59"><span>f</span></span></span><span><span id="MJXc-Node-60"><span id="MJXc-Node-61"><span id="MJXc-Node-62"><span>m</span></span><span id="MJXc-Node-63"><span>s</span></span></span></span></span></span></span></span><span id="MJXc-Node-64"><span>=</span></span><span id="MJXc-Node-65"><span id="MJXc-Node-66"><span id="MJXc-Node-67"><span><span id="MJXc-Node-68"><span>F</span></span></span><span><span id="MJXc-Node-69"><span id="MJXc-Node-70"><span id="MJXc-Node-71"><span>m</span></span><span id="MJXc-Node-72"><span>s</span></span></span></span></span></span></span></span><span id="MJXc-Node-73"><span><span><span id="MJXc-Node-74"><span id="MJXc-Node-75"><span>(</span></span><span id="MJXc-Node-76"><span>1</span></span><span id="MJXc-Node-77"><span>−</span></span><span id="MJXc-Node-78"><span id="MJXc-Node-79"><span id="MJXc-Node-80"><span>E</span></span><span id="MJXc-Node-81"><span>(</span></span><span id="MJXc-Node-82"><span><span id="MJXc-Node-83"><span>μ</span></span></span><span><span id="MJXc-Node-84"><span>o</span></span></span></span><span id="MJXc-Node-85"><span>)</span></span></span></span><span id="MJXc-Node-86"><span>)</span></span><span id="MJXc-Node-87"><span>(</span></span><span id="MJXc-Node-88"><span>1</span></span><span id="MJXc-Node-89"><span>−</span></span><span id="MJXc-Node-90"><span id="MJXc-Node-91"><span id="MJXc-Node-92"><span>E</span></span><span id="MJXc-Node-93"><span>(</span></span><span id="MJXc-Node-94"><span><span id="MJXc-Node-95"><span>μ</span></span></span><span><span id="MJXc-Node-96"><span>i</span></span></span></span><span id="MJXc-Node-97"><span>)</span></span></span></span><span id="MJXc-Node-98"><span>)</span></span></span></span><span><span id="MJXc-Node-99"><span id="MJXc-Node-100"><span>π</span></span><span id="MJXc-Node-101"></span><span id="MJXc-Node-102"><span>(</span></span><span id="MJXc-Node-103"><span>1</span></span><span id="MJXc-Node-104"><span>−</span></span><span id="MJXc-Node-105"><span id="MJXc-Node-106"><span id="MJXc-Node-107"><span><span id="MJXc-Node-108"><span>E</span></span></span><span><span id="MJXc-Node-109"><span id="MJXc-Node-110"><span id="MJXc-Node-111"><span>a</span></span><span id="MJXc-Node-112"><span>v</span></span><span id="MJXc-Node-113"><span>g</span></span></span></span></span></span></span></span><span id="MJXc-Node-114"><span>)</span></span></span></span><span></span></span><span></span></span><span id="MJXc-Node-115"><span>⟹</span></span><span id="MJXc-Node-116"><span><span><span id="MJXc-Node-117"><span id="MJXc-Node-118"><span id="MJXc-Node-119"><span id="MJXc-Node-120"><span><span id="MJXc-Node-121"><span>E</span></span></span><span><span id="MJXc-Node-122"><span id="MJXc-Node-123"><span id="MJXc-Node-124"><span>F</span></span><span id="MJXc-Node-125"><span>m</span></span><span id="MJXc-Node-126"><span>s</span></span></span></span></span></span><span id="MJXc-Node-127"><span>(</span></span><span id="MJXc-Node-128"><span><span id="MJXc-Node-129"><span>μ</span></span></span><span><span id="MJXc-Node-130"><span>o</span></span></span></span><span id="MJXc-Node-131"><span>)</span></span></span></span><span id="MJXc-Node-132"></span><span id="MJXc-Node-133"><span>(</span></span><span id="MJXc-Node-134"><span>1</span></span><span id="MJXc-Node-135"><span>−</span></span><span id="MJXc-Node-136"><span id="MJXc-Node-137"><span id="MJXc-Node-138"><span>E</span></span><span id="MJXc-Node-139"><span>(</span></span><span id="MJXc-Node-140"><span><span id="MJXc-Node-141"><span>μ</span></span></span><span><span id="MJXc-Node-142"><span>i</span></span></span></span><span id="MJXc-Node-143"><span>)</span></span></span></span><span id="MJXc-Node-144"><span>)</span></span></span></span><span><span id="MJXc-Node-145"><span id="MJXc-Node-146"><span>π</span></span><span id="MJXc-Node-147"></span><span id="MJXc-Node-148"><span>(</span></span><span id="MJXc-Node-149"><span>1</span></span><span id="MJXc-Node-150"><span>−</span></span><span id="MJXc-Node-151"><span id="MJXc-Node-152"><span id="MJXc-Node-153"><span><span id="MJXc-Node-154"><span>E</span></span></span><span><span id="MJXc-Node-155"><span id="MJXc-Node-156"><span id="MJXc-Node-157"><span>a</span></span><span id="MJXc-Node-158"><span>v</span></span><span id="MJXc-Node-159"><span>g</span></span></span></span></span></span></span></span><span id="MJXc-Node-160"><span>)</span></span></span></span><span></span></span><span></span></span><span id="MJXc-Node-161"><span>.</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-eq:fms"><span id="MJXc-Node-52"><span id="MJXc-Node-53"><span>(1)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>The good news is that this version produces results that match <em>Heitz</em> in a furnace environment:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/conductors/lut_vs_heitz_wf.png"></p>

<p><em>Figure 2: Furnace test, with roughness <span><span id="MJXp-Span-130"><span id="MJXp-Span-131">∈</span><span id="MJXp-Span-132">[</span><span id="MJXp-Span-133"><span><span id="MJXp-Span-134">1</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-135">8</span></span></span></span></span></span><span id="MJXp-Span-136">,</span><span id="MJXp-Span-137"><span><span id="MJXp-Span-138">2</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-139">8</span></span></span></span></span></span><span id="MJXp-Span-140">,</span><span id="MJXp-Span-141">…</span><span id="MJXp-Span-142">1</span><span id="MJXp-Span-143">]</span></span></span><span id="MathJax-Element-6-Frame" tabindex="0"><span id="MJXc-Node-162"><span id="MJXc-Node-163"><span id="MJXc-Node-164"><span>∈</span></span><span id="MJXc-Node-165"><span>[</span></span><span id="MJXc-Node-166"><span><span><span id="MJXc-Node-167"><span>1</span></span></span><span><span id="MJXc-Node-168"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-169"><span>,</span></span><span id="MJXc-Node-170"><span><span><span id="MJXc-Node-171"><span>2</span></span></span><span><span id="MJXc-Node-172"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-173"><span>,</span></span><span id="MJXc-Node-174"><span>…</span></span><span id="MJXc-Node-175"><span>1</span></span><span id="MJXc-Node-176"><span>]</span></span></span></span></span> (left halves: with <span><span id="MJXp-Span-144"><span id="MJXp-Span-145"><span id="MJXp-Span-146"><span id="MJXp-Span-147">E</span><span id="MJXp-Span-148"><span id="MJXp-Span-149">F</span><span id="MJXp-Span-150">m</span><span id="MJXp-Span-151">s</span></span></span></span></span></span><span id="MathJax-Element-7-Frame" tabindex="0"><span id="MJXc-Node-177"><span id="MJXc-Node-178"><span id="MJXc-Node-179"><span id="MJXc-Node-180"><span id="MJXc-Node-181"><span><span id="MJXc-Node-182"><span>E</span></span></span><span><span id="MJXc-Node-183"><span id="MJXc-Node-184"><span id="MJXc-Node-185"><span>F</span></span><span id="MJXc-Node-186"><span>m</span></span><span id="MJXc-Node-187"><span>s</span></span></span></span></span></span></span></span></span></span></span>, right halves: Heitz).</em></p>

<p>The bad news is that we need a 3D LUT for <span><span id="MJXp-Span-152"><span id="MJXp-Span-153"><span id="MJXp-Span-154"><span id="MJXp-Span-155">E</span><span id="MJXp-Span-156"><span id="MJXp-Span-157">F</span><span id="MJXp-Span-158">m</span><span id="MJXp-Span-159">s</span></span></span></span></span></span><span id="MathJax-Element-8-Frame" tabindex="0"><span id="MJXc-Node-188"><span id="MJXc-Node-189"><span id="MJXc-Node-190"><span id="MJXc-Node-191"><span id="MJXc-Node-192"><span><span id="MJXc-Node-193"><span>E</span></span></span><span><span id="MJXc-Node-194"><span id="MJXc-Node-195"><span id="MJXc-Node-196"><span>F</span></span><span id="MJXc-Node-197"><span>m</span></span><span id="MJXc-Node-198"><span>s</span></span></span></span></span></span></span></span></span></span></span>, since it depends not only on the view angle (<span><span id="MJXp-Span-160"><span id="MJXp-Span-161"><span id="MJXp-Span-162">μ</span><span id="MJXp-Span-163">o</span></span></span></span><span id="MathJax-Element-9-Frame" tabindex="0"><span id="MJXc-Node-199"><span id="MJXc-Node-200"><span id="MJXc-Node-201"><span><span id="MJXc-Node-202"><span>μ</span></span></span><span><span id="MJXc-Node-203"><span>o</span></span></span></span></span></span></span>) and roughness, but also <span><span id="MJXp-Span-164"><span id="MJXp-Span-165"><span id="MJXp-Span-166"><span id="MJXp-Span-167">F</span><span id="MJXp-Span-168">0</span></span></span></span></span><span id="MathJax-Element-10-Frame" tabindex="0"><span id="MJXc-Node-204"><span id="MJXc-Node-205"><span id="MJXc-Node-206"><span id="MJXc-Node-207"><span id="MJXc-Node-208"><span><span id="MJXc-Node-209"><span>F</span></span></span><span><span id="MJXc-Node-210"><span>0</span></span></span></span></span></span></span></span></span> (or <em>specular reflectance</em>). Worse, for coloured metals – such as our lovely copper example – we’d need to do three separate 3D lookups for R, G and B. The only silver lining is that this cost can potentially be amortised across lights, but it’s still less than ideal for real-time applications.</p>

<p><em>Note: a secondary concern is that this change also breaks the recipriocity of the multiple-scattering model, since the results will be different if <span><span id="MJXp-Span-169"><span id="MJXp-Span-170"><span id="MJXp-Span-171">μ</span><span id="MJXp-Span-172">o</span></span></span></span><span id="MathJax-Element-11-Frame" tabindex="0"><span id="MJXc-Node-211"><span id="MJXc-Node-212"><span id="MJXc-Node-213"><span><span id="MJXc-Node-214"><span>μ</span></span></span><span><span id="MJXc-Node-215"><span>o</span></span></span></span></span></span></span> and <span><span id="MJXp-Span-173"><span id="MJXp-Span-174"><span id="MJXp-Span-175">μ</span><span id="MJXp-Span-176">i</span></span></span></span><span id="MathJax-Element-12-Frame" tabindex="0"><span id="MJXc-Node-216"><span id="MJXc-Node-217"><span id="MJXc-Node-218"><span><span id="MJXc-Node-219"><span>μ</span></span></span><span><span id="MJXc-Node-220"><span>i</span></span></span></span></span></span></span> are swapped. While this isn’t a practical issue for real-time rendering, it could be a problem in other contexts (e.g. bidirectional path tracing).</em></p>

<h2 id="schlick-alternative">Schlick Alternative</h2>

<p>If we’re willing to restrict ourselves to Schlick’s Fresnel approximation<sup id="fnref:1" data-footnote-backlink-ref="fnref:1" data-footnote-ref="#fn:1"><a href="#fn:1" rel="footnote">1</a></sup><a href="#" data-footnote-identifier="1" alt="See Footnote 1" rel="footnote" data-footnote-content="<p>This is an entirely reasonable choice given its popularly in real-time rendering, and it’s actually what I have been using in all of my examples so far.</p>"><span data-footnote-identifier="1"></span><span></span><span></span></a>, then we can adapt a popular approach that’s been used with environmental lighting in games for a number of years [<a href="https://www.guerrilla-games.com/read/killzone-shadow-fall-creating-art-tools-for-a-new-generation">Drobot 2013</a>; <a href="http://blog.selfshadow.com/publications/s2013-shading-course/">Karis 2013</a>; <a href="http://blog.selfshadow.com/publications/s2013-shading-course/">Lazarov 2013</a>]. In this context, the roughness and directional-dependent effects of microfacet shadowing and Fresnel reflection are factored out and <em>preintegrated</em> ahead of time for a given BRDF. At run time, this term is combined with separately prefiltered environmental maps to produce a cheap but effective approximation of the real integral of the BRDF and the lighting.</p>

<p>This idea goes back further (see the <em>Ambient BRDF</em> of [<a href="http://renderwonk.com/publications/s2010-shading-course/">Gotanda 2010</a>]), but the newer variants more compact as they exploit the linearity of <em>Schlick Fresnel</em>, <span><span id="MJXp-Span-177"><span id="MJXp-Span-178"><span id="MJXp-Span-179"><span id="MJXp-Span-180">F</span><span id="MJXp-Span-181"><span id="MJXp-Span-182">s</span><span id="MJXp-Span-183">c</span><span id="MJXp-Span-184">h</span><span id="MJXp-Span-185">l</span><span id="MJXp-Span-186">i</span><span id="MJXp-Span-187">c</span><span id="MJXp-Span-188">k</span></span></span></span></span></span><span id="MathJax-Element-13-Frame" tabindex="0"><span id="MJXc-Node-221"><span id="MJXc-Node-222"><span id="MJXc-Node-223"><span id="MJXc-Node-224"><span id="MJXc-Node-225"><span><span id="MJXc-Node-226"><span>F</span></span></span><span><span id="MJXc-Node-227"><span id="MJXc-Node-228"><span id="MJXc-Node-229"><span>s</span></span><span id="MJXc-Node-230"><span>c</span></span><span id="MJXc-Node-231"><span>h</span></span><span id="MJXc-Node-232"><span>l</span></span><span id="MJXc-Node-233"><span>i</span></span><span id="MJXc-Node-234"><span>c</span></span><span id="MJXc-Node-235"><span>k</span></span></span></span></span></span></span></span></span></span></span>, to factor out <span><span id="MJXp-Span-189"><span id="MJXp-Span-190"><span id="MJXp-Span-191"><span id="MJXp-Span-192">F</span><span id="MJXp-Span-193">0</span></span></span></span></span><span id="MathJax-Element-14-Frame" tabindex="0"><span id="MJXc-Node-236"><span id="MJXc-Node-237"><span id="MJXc-Node-238"><span id="MJXc-Node-239"><span id="MJXc-Node-240"><span><span id="MJXc-Node-241"><span>F</span></span></span><span><span id="MJXc-Node-242"><span>0</span></span></span></span></span></span></span></span></span>, which reduces the dimensionality of the preintegrated table (or fit, in the case of [<a href="http://blog.selfshadow.com/publications/s2013-shading-course/">Lazarov 2013</a>]). I’ll quickly recap how this works, as it naturally extends to a solution for <span><span id="MJXp-Span-194"><span id="MJXp-Span-195"><span id="MJXp-Span-196"><span id="MJXp-Span-197">E</span><span id="MJXp-Span-198"><span id="MJXp-Span-199">F</span><span id="MJXp-Span-200">m</span><span id="MJXp-Span-201">s</span></span></span></span></span></span><span id="MathJax-Element-15-Frame" tabindex="0"><span id="MJXc-Node-243"><span id="MJXc-Node-244"><span id="MJXc-Node-245"><span id="MJXc-Node-246"><span id="MJXc-Node-247"><span><span id="MJXc-Node-248"><span>E</span></span></span><span><span id="MJXc-Node-249"><span id="MJXc-Node-250"><span id="MJXc-Node-251"><span>F</span></span><span id="MJXc-Node-252"><span>m</span></span><span id="MJXc-Node-253"><span>s</span></span></span></span></span></span></span></span></span></span></span>.</p>

<p>What these approaches are effectively calculating is a version of the <em>single-scattering</em> directional albedo, <span><span id="MJXp-Span-202"><span id="MJXp-Span-203"><span id="MJXp-Span-204">E</span></span></span></span><span id="MathJax-Element-16-Frame" tabindex="0"><span id="MJXc-Node-254"><span id="MJXc-Node-255"><span id="MJXc-Node-256"><span id="MJXc-Node-257"><span id="MJXc-Node-258"><span>E</span></span></span></span></span></span></span>, that incorporates <span><span id="MJXp-Span-205"><span id="MJXp-Span-206"><span id="MJXp-Span-207"><span id="MJXp-Span-208">F</span><span id="MJXp-Span-209"><span id="MJXp-Span-210">s</span><span id="MJXp-Span-211">c</span><span id="MJXp-Span-212">h</span><span id="MJXp-Span-213">l</span><span id="MJXp-Span-214">i</span><span id="MJXp-Span-215">c</span><span id="MJXp-Span-216">k</span></span></span></span></span></span><span id="MathJax-Element-17-Frame" tabindex="0"><span id="MJXc-Node-259"><span id="MJXc-Node-260"><span id="MJXc-Node-261"><span id="MJXc-Node-262"><span id="MJXc-Node-263"><span><span id="MJXc-Node-264"><span>F</span></span></span><span><span id="MJXc-Node-265"><span id="MJXc-Node-266"><span id="MJXc-Node-267"><span>s</span></span><span id="MJXc-Node-268"><span>c</span></span><span id="MJXc-Node-269"><span>h</span></span><span id="MJXc-Node-270"><span>l</span></span><span id="MJXc-Node-271"><span>i</span></span><span id="MJXc-Node-272"><span>c</span></span><span id="MJXc-Node-273"><span>k</span></span></span></span></span></span></span></span></span></span></span>. Let’s call this <span><span id="MJXp-Span-217"><span id="MJXp-Span-218"><span id="MJXp-Span-219"><span id="MJXp-Span-220">E</span><span id="MJXp-Span-221"><span id="MJXp-Span-222">F</span><span id="MJXp-Span-223">s</span><span id="MJXp-Span-224">s</span></span></span></span></span></span><span id="MathJax-Element-18-Frame" tabindex="0"><span id="MJXc-Node-274"><span id="MJXc-Node-275"><span id="MJXc-Node-276"><span id="MJXc-Node-277"><span id="MJXc-Node-278"><span><span id="MJXc-Node-279"><span>E</span></span></span><span><span id="MJXc-Node-280"><span id="MJXc-Node-281"><span id="MJXc-Node-282"><span>F</span></span><span id="MJXc-Node-283"><span>s</span></span><span id="MJXc-Node-284"><span>s</span></span></span></span></span></span></span></span></span></span></span>:</p>

<p><span><span id="MJXp-Span-225"><span id="MJXp-Span-226"><span><span id="MJXp-Span-227"><span id="MJXp-Span-228"><span id="MJXp-Span-229"><span id="MJXp-Span-230"><span id="MJXp-Span-231">E</span><span id="MJXp-Span-232"><span id="MJXp-Span-233">F</span><span id="MJXp-Span-234">s</span><span id="MJXp-Span-235">s</span></span></span><span id="MJXp-Span-236">(</span><span id="MJXp-Span-237"><span id="MJXp-Span-238">μ</span><span id="MJXp-Span-239">o</span></span><span id="MJXp-Span-240">)</span></span><span id="MJXp-Span-241">=</span><span id="MJXp-Span-242"><span id="MJXp-Span-243"><span>∫</span></span><span id="MJXp-Span-244"><span id="MJXp-Span-245">Ω</span></span></span><span id="MJXp-Span-246"><span id="MJXp-Span-247"><span id="MJXp-Span-248">F</span><span id="MJXp-Span-249"><span id="MJXp-Span-250">s</span><span id="MJXp-Span-251">c</span><span id="MJXp-Span-252">h</span><span id="MJXp-Span-253">l</span><span id="MJXp-Span-254">i</span><span id="MJXp-Span-255">c</span><span id="MJXp-Span-256">k</span></span></span><span id="MJXp-Span-257">(</span><span id="MJXp-Span-258"><span id="MJXp-Span-259">ω</span><span id="MJXp-Span-260">h</span></span><span id="MJXp-Span-261">,</span><span id="MJXp-Span-262"><span id="MJXp-Span-263">ω</span><span id="MJXp-Span-264">o</span></span><span id="MJXp-Span-265">)</span></span><span id="MJXp-Span-266"><span id="MJXp-Span-267"><span id="MJXp-Span-268">f</span><span><span><span><span><span id="MJXp-Span-272">′</span></span></span></span><span><span><span><span id="MJXp-Span-269"><span id="MJXp-Span-270">s</span><span id="MJXp-Span-271">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-273">(</span><span id="MJXp-Span-274"><span id="MJXp-Span-275">ω</span><span id="MJXp-Span-276">o</span></span><span id="MJXp-Span-277">,</span><span id="MJXp-Span-278"><span id="MJXp-Span-279">ω</span><span id="MJXp-Span-280">i</span></span><span id="MJXp-Span-281">)</span><span id="MJXp-Span-282">cos</span><span id="MJXp-Span-283"></span><span id="MJXp-Span-284"><span id="MJXp-Span-285">θ</span><span id="MJXp-Span-286">i</span></span><span id="MJXp-Span-287"><span id="MJXp-Span-288">d</span></span><span id="MJXp-Span-289"><span id="MJXp-Span-290">ω</span><span id="MJXp-Span-291">i</span></span><span id="MJXp-Span-292">,</span></span></span></span></span></span></span><span><span id="MathJax-Element-19-Frame" tabindex="0"><span id="MJXc-Node-285"><span id="MJXc-Node-286"><span id="MJXc-Node-287"><span><span><span id="MJXc-Node-288"><span id="MJXc-Node-292"><span id="MJXc-Node-293"><span id="MJXc-Node-294"><span id="MJXc-Node-295"><span id="MJXc-Node-296"><span><span id="MJXc-Node-297"><span>E</span></span></span><span><span id="MJXc-Node-298"><span id="MJXc-Node-299"><span id="MJXc-Node-300"><span>F</span></span><span id="MJXc-Node-301"><span>s</span></span><span id="MJXc-Node-302"><span>s</span></span></span></span></span></span><span id="MJXc-Node-303"><span>(</span></span><span id="MJXc-Node-304"><span><span id="MJXc-Node-305"><span>μ</span></span></span><span><span id="MJXc-Node-306"><span>o</span></span></span></span><span id="MJXc-Node-307"><span>)</span></span></span></span><span id="MJXc-Node-308"><span>=</span></span><span id="MJXc-Node-309"><span><span id="MJXc-Node-310"><span>∫</span></span></span><span><span id="MJXc-Node-311"><span id="MJXc-Node-312"><span id="MJXc-Node-313"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-314"><span id="MJXc-Node-315"><span id="MJXc-Node-316"><span><span id="MJXc-Node-317"><span>F</span></span></span><span><span id="MJXc-Node-318"><span id="MJXc-Node-319"><span id="MJXc-Node-320"><span>s</span></span><span id="MJXc-Node-321"><span>c</span></span><span id="MJXc-Node-322"><span>h</span></span><span id="MJXc-Node-323"><span>l</span></span><span id="MJXc-Node-324"><span>i</span></span><span id="MJXc-Node-325"><span>c</span></span><span id="MJXc-Node-326"><span>k</span></span></span></span></span></span><span id="MJXc-Node-327"><span>(</span></span><span id="MJXc-Node-328"><span><span id="MJXc-Node-329"><span>ω</span></span></span><span><span id="MJXc-Node-330"><span>h</span></span></span></span><span id="MJXc-Node-331"><span>,</span></span><span id="MJXc-Node-332"><span><span id="MJXc-Node-333"><span>ω</span></span></span><span><span id="MJXc-Node-334"><span>o</span></span></span></span><span id="MJXc-Node-335"><span>)</span></span></span></span><span id="MJXc-Node-336"><span id="MJXc-Node-337"><span id="MJXc-Node-338"><span><span id="MJXc-Node-339"><span>f</span></span></span><span><span><span id="MJXc-Node-344"><span>′</span></span></span><span><span id="MJXc-Node-340"><span id="MJXc-Node-341"><span id="MJXc-Node-342"><span>s</span></span><span id="MJXc-Node-343"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-345"><span>(</span></span><span id="MJXc-Node-346"><span><span id="MJXc-Node-347"><span>ω</span></span></span><span><span id="MJXc-Node-348"><span>o</span></span></span></span><span id="MJXc-Node-349"><span>,</span></span><span id="MJXc-Node-350"><span><span id="MJXc-Node-351"><span>ω</span></span></span><span><span id="MJXc-Node-352"><span>i</span></span></span></span><span id="MJXc-Node-353"><span>)</span></span><span id="MJXc-Node-354"><span>cos</span></span><span id="MJXc-Node-355"><span></span></span><span id="MJXc-Node-356"><span><span id="MJXc-Node-357"><span>θ</span></span></span><span><span id="MJXc-Node-358"><span>i</span></span></span></span><span id="MJXc-Node-359"><span id="MJXc-Node-360"><span id="MJXc-Node-361"><span>d</span></span></span></span><span id="MJXc-Node-362"><span><span id="MJXc-Node-363"><span>ω</span></span></span><span><span id="MJXc-Node-364"><span>i</span></span></span></span><span id="MJXc-Node-365"><span>,</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-2"><span id="MJXc-Node-290"><span id="MJXc-Node-291"><span>(2)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>where <span><span id="MJXp-Span-293"><span id="MJXp-Span-294"><span id="MJXp-Span-295"><span id="MJXp-Span-296">f</span><span><span><span><span><span id="MJXp-Span-300">′</span></span></span></span><span><span><span><span id="MJXp-Span-297"><span id="MJXp-Span-298">s</span><span id="MJXp-Span-299">s</span></span></span></span></span></span></span></span></span></span><span id="MathJax-Element-20-Frame" tabindex="0"><span id="MJXc-Node-366"><span id="MJXc-Node-367"><span id="MJXc-Node-368"><span id="MJXc-Node-369"><span id="MJXc-Node-370"><span><span id="MJXc-Node-371"><span>f</span></span></span><span><span><span id="MJXc-Node-376"><span>′</span></span></span><span><span id="MJXc-Node-372"><span id="MJXc-Node-373"><span id="MJXc-Node-374"><span>s</span></span><span id="MJXc-Node-375"><span>s</span></span></span></span></span></span></span></span></span></span></span></span> is the single-scattering BRDF without Fresnel.</p>

<p>The key observation is that <em>Schlick Fresnel’s</em> additive form</p>

<p><span><span id="MJXp-Span-301"><span id="MJXp-Span-302"><span><span id="MJXp-Span-303"><span id="MJXp-Span-304"><span id="MJXp-Span-305"><span id="MJXp-Span-306"><span id="MJXp-Span-307">F</span><span id="MJXp-Span-308"><span id="MJXp-Span-309">s</span><span id="MJXp-Span-310">c</span><span id="MJXp-Span-311">h</span><span id="MJXp-Span-312">l</span><span id="MJXp-Span-313">i</span><span id="MJXp-Span-314">c</span><span id="MJXp-Span-315">k</span></span></span><span id="MJXp-Span-316">(</span><span id="MJXp-Span-317"><span id="MJXp-Span-318">ω</span><span id="MJXp-Span-319">h</span></span><span id="MJXp-Span-320">,</span><span id="MJXp-Span-321"><span id="MJXp-Span-322">ω</span><span id="MJXp-Span-323">o</span></span><span id="MJXp-Span-324">)</span></span></span><span id="MJXp-Span-325"><span id="MJXp-Span-326"></span><span id="MJXp-Span-327">=</span><span id="MJXp-Span-328"><span id="MJXp-Span-329"><span id="MJXp-Span-330">F</span><span id="MJXp-Span-331">0</span></span></span><span id="MJXp-Span-332">+</span><span id="MJXp-Span-333">(</span><span id="MJXp-Span-334">1</span><span id="MJXp-Span-335">−</span><span id="MJXp-Span-336"><span id="MJXp-Span-337"><span id="MJXp-Span-338">F</span><span id="MJXp-Span-339">0</span></span></span><span id="MJXp-Span-340">)</span><span id="MJXp-Span-341">(</span><span id="MJXp-Span-342">1</span><span id="MJXp-Span-343">−</span><span id="MJXp-Span-344"><span id="MJXp-Span-345">ω</span><span id="MJXp-Span-346">h</span></span><span id="MJXp-Span-347">⋅</span><span id="MJXp-Span-348"><span id="MJXp-Span-349">ω</span><span id="MJXp-Span-350">o</span></span><span id="MJXp-Span-351"><span id="MJXp-Span-352">)</span><span id="MJXp-Span-353">5</span></span></span></span><span id="MJXp-Span-354"><span id="MJXp-Span-355"></span><span id="MJXp-Span-356"><span id="MJXp-Span-357"></span><span id="MJXp-Span-358">=</span><span id="MJXp-Span-359"><span id="MJXp-Span-360"><span id="MJXp-Span-361">F</span><span id="MJXp-Span-362">0</span></span></span><span id="MJXp-Span-363"></span><span id="MJXp-Span-364"><span id="MJXp-Span-365">(</span><span id="MJXp-Span-366">1</span><span id="MJXp-Span-367">−</span><span id="MJXp-Span-368">s</span><span id="MJXp-Span-369">)</span></span><span id="MJXp-Span-370">+</span><span id="MJXp-Span-371"><span id="MJXp-Span-372">s</span></span><span id="MJXp-Span-373">,</span><span id="MJXp-Span-374"></span><span id="MJXp-Span-375">where&nbsp;</span><span id="MJXp-Span-376"><span id="MJXp-Span-377">s</span></span><span id="MJXp-Span-378">=</span><span id="MJXp-Span-379">(</span><span id="MJXp-Span-380">1</span><span id="MJXp-Span-381">−</span><span id="MJXp-Span-382"><span id="MJXp-Span-383">ω</span><span id="MJXp-Span-384">h</span></span><span id="MJXp-Span-385">⋅</span><span id="MJXp-Span-386"><span id="MJXp-Span-387">ω</span><span id="MJXp-Span-388">o</span></span><span id="MJXp-Span-389"><span id="MJXp-Span-390">)</span><span id="MJXp-Span-391">5</span></span><span id="MJXp-Span-392">,</span></span></span></span></span></span></span><span><span id="MathJax-Element-21-Frame" tabindex="0"><span id="MJXc-Node-377"><span id="MJXc-Node-378"><span id="MJXc-Node-379"><span><span><span id="MJXc-Node-380"><span id="MJXc-Node-384"><span id="MJXc-Node-385"><span id="MJXc-Node-386"><span id="MJXc-Node-387"><span id="MJXc-Node-388"><span><span id="MJXc-Node-389"><span>F</span></span></span><span><span id="MJXc-Node-390"><span id="MJXc-Node-391"><span id="MJXc-Node-392"><span>s</span></span><span id="MJXc-Node-393"><span>c</span></span><span id="MJXc-Node-394"><span>h</span></span><span id="MJXc-Node-395"><span>l</span></span><span id="MJXc-Node-396"><span>i</span></span><span id="MJXc-Node-397"><span>c</span></span><span id="MJXc-Node-398"><span>k</span></span></span></span></span></span><span id="MJXc-Node-399"><span>(</span></span><span id="MJXc-Node-400"><span><span id="MJXc-Node-401"><span>ω</span></span></span><span><span id="MJXc-Node-402"><span>h</span></span></span></span><span id="MJXc-Node-403"><span>,</span></span><span id="MJXc-Node-404"><span><span id="MJXc-Node-405"><span>ω</span></span></span><span><span id="MJXc-Node-406"><span>o</span></span></span></span><span id="MJXc-Node-407"><span>)</span></span></span></span><span></span></span></span><span id="MJXc-Node-408"><span id="MJXc-Node-409"><span id="MJXc-Node-410"></span><span id="MJXc-Node-411"><span>=</span></span><span id="MJXc-Node-412"><span id="MJXc-Node-413"><span id="MJXc-Node-414"><span><span id="MJXc-Node-415"><span>F</span></span></span><span><span id="MJXc-Node-416"><span>0</span></span></span></span></span></span><span id="MJXc-Node-417"><span>+</span></span><span id="MJXc-Node-418"><span>(</span></span><span id="MJXc-Node-419"><span>1</span></span><span id="MJXc-Node-420"><span>−</span></span><span id="MJXc-Node-421"><span id="MJXc-Node-422"><span id="MJXc-Node-423"><span><span id="MJXc-Node-424"><span>F</span></span></span><span><span id="MJXc-Node-425"><span>0</span></span></span></span></span></span><span id="MJXc-Node-426"><span>)</span></span><span id="MJXc-Node-427"><span>(</span></span><span id="MJXc-Node-428"><span>1</span></span><span id="MJXc-Node-429"><span>−</span></span><span id="MJXc-Node-430"><span><span id="MJXc-Node-431"><span>ω</span></span></span><span><span id="MJXc-Node-432"><span>h</span></span></span></span><span id="MJXc-Node-433"><span>⋅</span></span><span id="MJXc-Node-434"><span><span id="MJXc-Node-435"><span>ω</span></span></span><span><span id="MJXc-Node-436"><span>o</span></span></span></span><span id="MJXc-Node-437"><span><span id="MJXc-Node-438"><span>)</span></span></span><span><span id="MJXc-Node-439"><span>5</span></span></span></span><span></span></span></span></span><span id="MJXc-Node-440"><span id="MJXc-Node-444"><span id="MJXc-Node-445"><span></span></span></span><span id="MJXc-Node-446"><span id="MJXc-Node-447"><span id="MJXc-Node-448"></span><span id="MJXc-Node-449"><span>=</span></span><span id="MJXc-Node-450"><span id="MJXc-Node-451"><span id="MJXc-Node-452"><span><span id="MJXc-Node-453"><span>F</span></span></span><span><span id="MJXc-Node-454"><span>0</span></span></span></span></span></span><span id="MJXc-Node-455"></span><span id="MJXc-Node-456"><span id="MJXc-Node-457"><span id="MJXc-Node-458"><span>(</span></span><span id="MJXc-Node-459"><span>1</span></span><span id="MJXc-Node-460"><span>−</span></span><span id="MJXc-Node-461"><span>s</span></span><span id="MJXc-Node-462"><span>)</span></span></span></span><span id="MJXc-Node-463"><span>+</span></span><span id="MJXc-Node-464"><span id="MJXc-Node-465"><span id="MJXc-Node-466"><span>s</span></span></span></span><span id="MJXc-Node-467"><span>,</span></span><span id="MJXc-Node-468"></span><span id="MJXc-Node-469"><span>where&nbsp;</span></span><span id="MJXc-Node-470"><span id="MJXc-Node-471"><span id="MJXc-Node-472"><span>s</span></span></span></span><span id="MJXc-Node-473"><span>=</span></span><span id="MJXc-Node-474"><span>(</span></span><span id="MJXc-Node-475"><span>1</span></span><span id="MJXc-Node-476"><span>−</span></span><span id="MJXc-Node-477"><span><span id="MJXc-Node-478"><span>ω</span></span></span><span><span id="MJXc-Node-479"><span>h</span></span></span></span><span id="MJXc-Node-480"><span>⋅</span></span><span id="MJXc-Node-481"><span><span id="MJXc-Node-482"><span>ω</span></span></span><span><span id="MJXc-Node-483"><span>o</span></span></span></span><span id="MJXc-Node-484"><span><span id="MJXc-Node-485"><span>)</span></span></span><span><span id="MJXc-Node-486"><span>5</span></span></span></span><span id="MJXc-Node-487"><span>,</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-3"><span id="MJXc-Node-382"><span id="MJXc-Node-383"><span>(3)</span></span><span></span></span></span></span><span><span id="mjx-eqn-4"><span id="MJXc-Node-442"><span id="MJXc-Node-443"><span>(4)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>allows <span><span id="MJXp-Span-393"><span id="MJXp-Span-394"><span id="MJXp-Span-395"><span id="MJXp-Span-396">E</span><span id="MJXp-Span-397"><span id="MJXp-Span-398">F</span><span id="MJXp-Span-399">s</span><span id="MJXp-Span-400">s</span></span></span></span></span></span><span id="MathJax-Element-22-Frame" tabindex="0"><span id="MJXc-Node-488"><span id="MJXc-Node-489"><span id="MJXc-Node-490"><span id="MJXc-Node-491"><span id="MJXc-Node-492"><span><span id="MJXc-Node-493"><span>E</span></span></span><span><span id="MJXc-Node-494"><span id="MJXc-Node-495"><span id="MJXc-Node-496"><span>F</span></span><span id="MJXc-Node-497"><span>s</span></span><span id="MJXc-Node-498"><span>s</span></span></span></span></span></span></span></span></span></span></span> to be split into two parts:</p>

<p><span><span id="MJXp-Span-401"><span id="MJXp-Span-402"><span><span id="MJXp-Span-403"><span id="MJXp-Span-404"><span id="MJXp-Span-405"><span id="MJXp-Span-406"><span id="MJXp-Span-407">E</span><span id="MJXp-Span-408"><span id="MJXp-Span-409">F</span><span id="MJXp-Span-410">s</span><span id="MJXp-Span-411">s</span></span></span><span id="MJXp-Span-412">(</span><span id="MJXp-Span-413"><span id="MJXp-Span-414">μ</span><span id="MJXp-Span-415">o</span></span><span id="MJXp-Span-416">)</span></span><span id="MJXp-Span-417">=</span><span id="MJXp-Span-418"><span id="MJXp-Span-419"><span id="MJXp-Span-420">F</span><span id="MJXp-Span-421">0</span></span></span><span id="MJXp-Span-422"><span><span id="MJXp-Span-423"><span id="MJXp-Span-424"><span><span id="MJXp-Span-425"><span id="MJXp-Span-426"><span>∫</span></span><span id="MJXp-Span-427"><span id="MJXp-Span-428">Ω</span></span></span><span id="MJXp-Span-429"><span id="MJXp-Span-430">(</span><span id="MJXp-Span-431">1</span><span id="MJXp-Span-432">−</span><span id="MJXp-Span-433">s</span><span id="MJXp-Span-434">)</span></span><span id="MJXp-Span-435"><span id="MJXp-Span-436"><span id="MJXp-Span-437">f</span><span><span><span><span><span id="MJXp-Span-441">′</span></span></span></span><span><span><span><span id="MJXp-Span-438"><span id="MJXp-Span-439">s</span><span id="MJXp-Span-440">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-442">(</span><span id="MJXp-Span-443"><span id="MJXp-Span-444">ω</span><span id="MJXp-Span-445">o</span></span><span id="MJXp-Span-446">,</span><span id="MJXp-Span-447"><span id="MJXp-Span-448">ω</span><span id="MJXp-Span-449">i</span></span><span id="MJXp-Span-450">)</span><span id="MJXp-Span-451">cos</span><span id="MJXp-Span-452"></span><span id="MJXp-Span-453"><span id="MJXp-Span-454">θ</span><span id="MJXp-Span-455">i</span></span><span id="MJXp-Span-456"><span id="MJXp-Span-457">d</span></span><span id="MJXp-Span-458"><span id="MJXp-Span-459">ω</span><span id="MJXp-Span-460">i</span></span></span><span><span id="MJXp-Span-461">⏟</span></span></span></span></span><span><span id="MJXp-Span-462"><span id="MJXp-Span-463">tinted by</span><span id="MJXp-Span-464"><span id="MJXp-Span-465"><span id="MJXp-Span-466">F</span><span id="MJXp-Span-467">0</span></span></span></span></span></span><span id="MJXp-Span-468">+</span><span id="MJXp-Span-469"><span><span id="MJXp-Span-470"><span id="MJXp-Span-471"><span><span id="MJXp-Span-472"><span id="MJXp-Span-473"><span>∫</span></span><span id="MJXp-Span-474"><span id="MJXp-Span-475">Ω</span></span></span><span id="MJXp-Span-476"><span id="MJXp-Span-477">s</span></span><span id="MJXp-Span-478"><span id="MJXp-Span-479"><span id="MJXp-Span-480">f</span><span><span><span><span><span id="MJXp-Span-484">′</span></span></span></span><span><span><span><span id="MJXp-Span-481"><span id="MJXp-Span-482">s</span><span id="MJXp-Span-483">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-485">(</span><span id="MJXp-Span-486"><span id="MJXp-Span-487">ω</span><span id="MJXp-Span-488">o</span></span><span id="MJXp-Span-489">,</span><span id="MJXp-Span-490"><span id="MJXp-Span-491">ω</span><span id="MJXp-Span-492">i</span></span><span id="MJXp-Span-493">)</span><span id="MJXp-Span-494">cos</span><span id="MJXp-Span-495"></span><span id="MJXp-Span-496"><span id="MJXp-Span-497">θ</span><span id="MJXp-Span-498">i</span></span><span id="MJXp-Span-499"><span id="MJXp-Span-500">d</span></span><span id="MJXp-Span-501"><span id="MJXp-Span-502">ω</span><span id="MJXp-Span-503">i</span></span></span><span><span id="MJXp-Span-504">⏟</span></span></span></span></span><span><span id="MJXp-Span-505"><span id="MJXp-Span-506">untinted</span></span></span></span><span id="MJXp-Span-507">,</span></span></span></span></span></span></span><span><span id="MathJax-Element-23-Frame" tabindex="0"><span id="MJXc-Node-499"><span id="MJXc-Node-500"><span id="MJXc-Node-501"><span><span><span id="MJXc-Node-502"><span id="MJXc-Node-506"><span id="MJXc-Node-507"><span id="MJXc-Node-508"><span id="MJXc-Node-509"><span id="MJXc-Node-510"><span><span id="MJXc-Node-511"><span>E</span></span></span><span><span id="MJXc-Node-512"><span id="MJXc-Node-513"><span id="MJXc-Node-514"><span>F</span></span><span id="MJXc-Node-515"><span>s</span></span><span id="MJXc-Node-516"><span>s</span></span></span></span></span></span><span id="MJXc-Node-517"><span>(</span></span><span id="MJXc-Node-518"><span><span id="MJXc-Node-519"><span>μ</span></span></span><span><span id="MJXc-Node-520"><span>o</span></span></span></span><span id="MJXc-Node-521"><span>)</span></span></span></span><span id="MJXc-Node-522"><span>=</span></span><span id="MJXc-Node-523"><span id="MJXc-Node-524"><span id="MJXc-Node-525"><span><span id="MJXc-Node-526"><span>F</span></span></span><span><span id="MJXc-Node-527"><span>0</span></span></span></span></span></span><span id="MJXc-Node-528"><span><span><span><span><span id="MJXc-Node-529"><span id="MJXc-Node-530"><span id="MJXc-Node-531"><span><span><span><span><span id="MJXc-Node-532"><span id="MJXc-Node-533"><span><span id="MJXc-Node-534"><span>∫</span></span></span><span><span id="MJXc-Node-535"><span id="MJXc-Node-536"><span id="MJXc-Node-537"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-538"><span id="MJXc-Node-539"><span id="MJXc-Node-540"><span>(</span></span><span id="MJXc-Node-541"><span>1</span></span><span id="MJXc-Node-542"><span>−</span></span><span id="MJXc-Node-543"><span>s</span></span><span id="MJXc-Node-544"><span>)</span></span></span></span><span id="MJXc-Node-545"><span id="MJXc-Node-546"><span id="MJXc-Node-547"><span><span id="MJXc-Node-548"><span>f</span></span></span><span><span><span id="MJXc-Node-553"><span>′</span></span></span><span><span id="MJXc-Node-549"><span id="MJXc-Node-550"><span id="MJXc-Node-551"><span>s</span></span><span id="MJXc-Node-552"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-554"><span>(</span></span><span id="MJXc-Node-555"><span><span id="MJXc-Node-556"><span>ω</span></span></span><span><span id="MJXc-Node-557"><span>o</span></span></span></span><span id="MJXc-Node-558"><span>,</span></span><span id="MJXc-Node-559"><span><span id="MJXc-Node-560"><span>ω</span></span></span><span><span id="MJXc-Node-561"><span>i</span></span></span></span><span id="MJXc-Node-562"><span>)</span></span><span id="MJXc-Node-563"><span>cos</span></span><span id="MJXc-Node-564"><span></span></span><span id="MJXc-Node-565"><span><span id="MJXc-Node-566"><span>θ</span></span></span><span><span id="MJXc-Node-567"><span>i</span></span></span></span><span id="MJXc-Node-568"><span id="MJXc-Node-569"><span id="MJXc-Node-570"><span>d</span></span></span></span><span id="MJXc-Node-571"><span><span id="MJXc-Node-572"><span>ω</span></span></span><span><span id="MJXc-Node-573"><span>i</span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-574"><span><span></span><span></span><span></span><span></span><span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-575"><span id="MJXc-Node-576"><span id="MJXc-Node-577"><span>tinted by</span></span><span id="MJXc-Node-578"><span id="MJXc-Node-579"><span id="MJXc-Node-580"><span><span id="MJXc-Node-581"><span>F</span></span></span><span><span id="MJXc-Node-582"><span>0</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-583"><span>+</span></span><span id="MJXc-Node-584"><span><span><span><span><span id="MJXc-Node-585"><span id="MJXc-Node-586"><span id="MJXc-Node-587"><span><span><span><span><span id="MJXc-Node-588"><span id="MJXc-Node-589"><span><span id="MJXc-Node-590"><span>∫</span></span></span><span><span id="MJXc-Node-591"><span id="MJXc-Node-592"><span id="MJXc-Node-593"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-594"><span id="MJXc-Node-595"><span id="MJXc-Node-596"><span>s</span></span></span></span><span id="MJXc-Node-597"><span id="MJXc-Node-598"><span id="MJXc-Node-599"><span><span id="MJXc-Node-600"><span>f</span></span></span><span><span><span id="MJXc-Node-605"><span>′</span></span></span><span><span id="MJXc-Node-601"><span id="MJXc-Node-602"><span id="MJXc-Node-603"><span>s</span></span><span id="MJXc-Node-604"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-606"><span>(</span></span><span id="MJXc-Node-607"><span><span id="MJXc-Node-608"><span>ω</span></span></span><span><span id="MJXc-Node-609"><span>o</span></span></span></span><span id="MJXc-Node-610"><span>,</span></span><span id="MJXc-Node-611"><span><span id="MJXc-Node-612"><span>ω</span></span></span><span><span id="MJXc-Node-613"><span>i</span></span></span></span><span id="MJXc-Node-614"><span>)</span></span><span id="MJXc-Node-615"><span>cos</span></span><span id="MJXc-Node-616"><span></span></span><span id="MJXc-Node-617"><span><span id="MJXc-Node-618"><span>θ</span></span></span><span><span id="MJXc-Node-619"><span>i</span></span></span></span><span id="MJXc-Node-620"><span id="MJXc-Node-621"><span id="MJXc-Node-622"><span>d</span></span></span></span><span id="MJXc-Node-623"><span><span id="MJXc-Node-624"><span>ω</span></span></span><span><span id="MJXc-Node-625"><span>i</span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-626"><span><span></span><span></span><span></span><span></span><span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-627"><span id="MJXc-Node-628"><span id="MJXc-Node-629"><span>untinted</span></span></span></span></span></span></span></span><span id="MJXc-Node-630"><span>,</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-5"><span id="MJXc-Node-504"><span id="MJXc-Node-505"><span>(5)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>one that will be tinted by <span><span id="MJXp-Span-508"><span id="MJXp-Span-509"><span id="MJXp-Span-510"><span id="MJXp-Span-511">F</span><span id="MJXp-Span-512">0</span></span></span></span></span><span id="MathJax-Element-24-Frame" tabindex="0"><span id="MJXc-Node-631"><span id="MJXc-Node-632"><span id="MJXc-Node-633"><span id="MJXc-Node-634"><span id="MJXc-Node-635"><span><span id="MJXc-Node-636"><span>F</span></span></span><span><span id="MJXc-Node-637"><span>0</span></span></span></span></span></span></span></span></span> of the material at run time, and another that’s left untinted. This means that we can precompute a 2D LUT containing these two terms, rather than needing a 3D LUT.</p>

<p>A little more formally, we can view this as decomposing <span><span id="MJXp-Span-513"><span id="MJXp-Span-514"><span id="MJXp-Span-515">E</span></span></span></span><span id="MathJax-Element-25-Frame" tabindex="0"><span id="MJXc-Node-638"><span id="MJXc-Node-639"><span id="MJXc-Node-640"><span id="MJXc-Node-641"><span id="MJXc-Node-642"><span>E</span></span></span></span></span></span></span> into two factors, <span><span id="MJXp-Span-516"><span id="MJXp-Span-517"><span id="MJXp-Span-518"><span id="MJXp-Span-519">w</span><span id="MJXp-Span-520">0</span></span></span></span></span><span id="MathJax-Element-26-Frame" tabindex="0"><span id="MJXc-Node-643"><span id="MJXc-Node-644"><span id="MJXc-Node-645"><span id="MJXc-Node-646"><span id="MJXc-Node-647"><span><span id="MJXc-Node-648"><span>w</span></span></span><span><span id="MJXc-Node-649"><span>0</span></span></span></span></span></span></span></span></span> and <span><span id="MJXp-Span-521"><span id="MJXp-Span-522"><span id="MJXp-Span-523"><span id="MJXp-Span-524">w</span><span id="MJXp-Span-525">1</span></span></span></span></span><span id="MathJax-Element-27-Frame" tabindex="0"><span id="MJXc-Node-650"><span id="MJXc-Node-651"><span id="MJXc-Node-652"><span id="MJXc-Node-653"><span id="MJXc-Node-654"><span><span id="MJXc-Node-655"><span>w</span></span></span><span><span id="MJXc-Node-656"><span>1</span></span></span></span></span></span></span></span></span>:</p>

<p><span><span id="MJXp-Span-526"><span id="MJXp-Span-527"><span><span id="MJXp-Span-528"><span id="MJXp-Span-529"><span id="MJXp-Span-530"><span id="MJXp-Span-531">E</span><span id="MJXp-Span-532">(</span><span id="MJXp-Span-533"><span id="MJXp-Span-534">μ</span><span id="MJXp-Span-535">o</span></span><span id="MJXp-Span-536">)</span></span></span><span id="MJXp-Span-537"><span id="MJXp-Span-538"></span><span id="MJXp-Span-539">=</span><span id="MJXp-Span-540"><span id="MJXp-Span-541"><span>∫</span></span><span id="MJXp-Span-542"><span id="MJXp-Span-543">Ω</span></span></span><span id="MJXp-Span-544"><span id="MJXp-Span-545"><span id="MJXp-Span-546">f</span><span><span><span><span><span id="MJXp-Span-550">′</span></span></span></span><span><span><span><span id="MJXp-Span-547"><span id="MJXp-Span-548">s</span><span id="MJXp-Span-549">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-551">(</span><span id="MJXp-Span-552"><span id="MJXp-Span-553">ω</span><span id="MJXp-Span-554">o</span></span><span id="MJXp-Span-555">,</span><span id="MJXp-Span-556"><span id="MJXp-Span-557">ω</span><span id="MJXp-Span-558">i</span></span><span id="MJXp-Span-559">)</span><span id="MJXp-Span-560">cos</span><span id="MJXp-Span-561"></span><span id="MJXp-Span-562"><span id="MJXp-Span-563">θ</span><span id="MJXp-Span-564">i</span></span><span id="MJXp-Span-565"><span id="MJXp-Span-566">d</span></span><span id="MJXp-Span-567"><span id="MJXp-Span-568">ω</span><span id="MJXp-Span-569">i</span></span></span></span><span id="MJXp-Span-570"><span id="MJXp-Span-571"></span><span id="MJXp-Span-572"><span id="MJXp-Span-573"></span><span id="MJXp-Span-574">=</span><span id="MJXp-Span-575"><span><span id="MJXp-Span-576"><span id="MJXp-Span-577"><span><span id="MJXp-Span-578"><span id="MJXp-Span-579"><span>∫</span></span><span id="MJXp-Span-580"><span id="MJXp-Span-581">Ω</span></span></span><span id="MJXp-Span-582"><span id="MJXp-Span-583">s</span></span><span id="MJXp-Span-584"><span id="MJXp-Span-585"><span id="MJXp-Span-586">f</span><span><span><span><span><span id="MJXp-Span-590">′</span></span></span></span><span><span><span><span id="MJXp-Span-587"><span id="MJXp-Span-588">s</span><span id="MJXp-Span-589">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-591">(</span><span id="MJXp-Span-592"><span id="MJXp-Span-593">ω</span><span id="MJXp-Span-594">o</span></span><span id="MJXp-Span-595">,</span><span id="MJXp-Span-596"><span id="MJXp-Span-597">ω</span><span id="MJXp-Span-598">i</span></span><span id="MJXp-Span-599">)</span><span id="MJXp-Span-600">cos</span><span id="MJXp-Span-601"></span><span id="MJXp-Span-602"><span id="MJXp-Span-603">θ</span><span id="MJXp-Span-604">i</span></span><span id="MJXp-Span-605"><span id="MJXp-Span-606">d</span></span><span id="MJXp-Span-607"><span id="MJXp-Span-608">ω</span><span id="MJXp-Span-609">i</span></span></span><span><span id="MJXp-Span-610">⏟</span></span></span></span></span><span><span id="MJXp-Span-611"><span id="MJXp-Span-612"><span id="MJXp-Span-613"><span id="MJXp-Span-614">w</span><span id="MJXp-Span-615">0</span></span></span></span></span></span><span id="MJXp-Span-616">+</span><span id="MJXp-Span-617"><span><span id="MJXp-Span-618"><span id="MJXp-Span-619"><span><span id="MJXp-Span-620"><span id="MJXp-Span-621"><span>∫</span></span><span id="MJXp-Span-622"><span id="MJXp-Span-623">Ω</span></span></span><span id="MJXp-Span-624"><span id="MJXp-Span-625">(</span><span id="MJXp-Span-626">1</span><span id="MJXp-Span-627">−</span><span id="MJXp-Span-628">s</span><span id="MJXp-Span-629">)</span></span><span id="MJXp-Span-630"><span id="MJXp-Span-631"><span id="MJXp-Span-632">f</span><span><span><span><span><span id="MJXp-Span-636">′</span></span></span></span><span><span><span><span id="MJXp-Span-633"><span id="MJXp-Span-634">s</span><span id="MJXp-Span-635">s</span></span></span></span></span></span></span></span><span id="MJXp-Span-637">(</span><span id="MJXp-Span-638"><span id="MJXp-Span-639">ω</span><span id="MJXp-Span-640">o</span></span><span id="MJXp-Span-641">,</span><span id="MJXp-Span-642"><span id="MJXp-Span-643">ω</span><span id="MJXp-Span-644">i</span></span><span id="MJXp-Span-645">)</span><span id="MJXp-Span-646">cos</span><span id="MJXp-Span-647"></span><span id="MJXp-Span-648"><span id="MJXp-Span-649">θ</span><span id="MJXp-Span-650">i</span></span><span id="MJXp-Span-651"><span id="MJXp-Span-652">d</span></span><span id="MJXp-Span-653"><span id="MJXp-Span-654">ω</span><span id="MJXp-Span-655">i</span></span></span><span><span id="MJXp-Span-656">⏟</span></span></span></span></span><span><span id="MJXp-Span-657"><span id="MJXp-Span-658"><span id="MJXp-Span-659"><span id="MJXp-Span-660">w</span><span id="MJXp-Span-661">1</span></span></span></span></span></span><span id="MJXp-Span-662">,</span></span></span></span></span></span></span><span><span id="MathJax-Element-28-Frame" tabindex="0"><span id="MJXc-Node-657"><span id="MJXc-Node-658"><span id="MJXc-Node-659"><span><span><span id="MJXc-Node-660"><span id="MJXc-Node-664"><span id="MJXc-Node-665"><span id="MJXc-Node-666"><span id="MJXc-Node-667"><span id="MJXc-Node-668"><span>E</span></span><span id="MJXc-Node-669"><span>(</span></span><span id="MJXc-Node-670"><span><span id="MJXc-Node-671"><span>μ</span></span></span><span><span id="MJXc-Node-672"><span>o</span></span></span></span><span id="MJXc-Node-673"><span>)</span></span></span></span><span></span></span></span><span id="MJXc-Node-674"><span id="MJXc-Node-675"><span id="MJXc-Node-676"></span><span id="MJXc-Node-677"><span>=</span></span><span id="MJXc-Node-678"><span><span id="MJXc-Node-679"><span>∫</span></span></span><span><span id="MJXc-Node-680"><span id="MJXc-Node-681"><span id="MJXc-Node-682"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-683"><span id="MJXc-Node-684"><span id="MJXc-Node-685"><span><span id="MJXc-Node-686"><span>f</span></span></span><span><span><span id="MJXc-Node-691"><span>′</span></span></span><span><span id="MJXc-Node-687"><span id="MJXc-Node-688"><span id="MJXc-Node-689"><span>s</span></span><span id="MJXc-Node-690"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-692"><span>(</span></span><span id="MJXc-Node-693"><span><span id="MJXc-Node-694"><span>ω</span></span></span><span><span id="MJXc-Node-695"><span>o</span></span></span></span><span id="MJXc-Node-696"><span>,</span></span><span id="MJXc-Node-697"><span><span id="MJXc-Node-698"><span>ω</span></span></span><span><span id="MJXc-Node-699"><span>i</span></span></span></span><span id="MJXc-Node-700"><span>)</span></span><span id="MJXc-Node-701"><span>cos</span></span><span id="MJXc-Node-702"><span></span></span><span id="MJXc-Node-703"><span><span id="MJXc-Node-704"><span>θ</span></span></span><span><span id="MJXc-Node-705"><span>i</span></span></span></span><span id="MJXc-Node-706"><span id="MJXc-Node-707"><span id="MJXc-Node-708"><span>d</span></span></span></span><span id="MJXc-Node-709"><span><span id="MJXc-Node-710"><span>ω</span></span></span><span><span id="MJXc-Node-711"><span>i</span></span></span></span><span></span></span></span></span><span id="MJXc-Node-712"><span id="MJXc-Node-716"><span id="MJXc-Node-717"><span></span></span></span><span id="MJXc-Node-718"><span id="MJXc-Node-719"><span id="MJXc-Node-720"></span><span id="MJXc-Node-721"><span>=</span></span><span id="MJXc-Node-722"><span><span><span><span><span id="MJXc-Node-723"><span id="MJXc-Node-724"><span id="MJXc-Node-725"><span><span><span><span><span id="MJXc-Node-726"><span id="MJXc-Node-727"><span><span id="MJXc-Node-728"><span>∫</span></span></span><span><span id="MJXc-Node-729"><span id="MJXc-Node-730"><span id="MJXc-Node-731"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-732"><span id="MJXc-Node-733"><span id="MJXc-Node-734"><span>s</span></span></span></span><span id="MJXc-Node-735"><span id="MJXc-Node-736"><span id="MJXc-Node-737"><span><span id="MJXc-Node-738"><span>f</span></span></span><span><span><span id="MJXc-Node-743"><span>′</span></span></span><span><span id="MJXc-Node-739"><span id="MJXc-Node-740"><span id="MJXc-Node-741"><span>s</span></span><span id="MJXc-Node-742"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-744"><span>(</span></span><span id="MJXc-Node-745"><span><span id="MJXc-Node-746"><span>ω</span></span></span><span><span id="MJXc-Node-747"><span>o</span></span></span></span><span id="MJXc-Node-748"><span>,</span></span><span id="MJXc-Node-749"><span><span id="MJXc-Node-750"><span>ω</span></span></span><span><span id="MJXc-Node-751"><span>i</span></span></span></span><span id="MJXc-Node-752"><span>)</span></span><span id="MJXc-Node-753"><span>cos</span></span><span id="MJXc-Node-754"><span></span></span><span id="MJXc-Node-755"><span><span id="MJXc-Node-756"><span>θ</span></span></span><span><span id="MJXc-Node-757"><span>i</span></span></span></span><span id="MJXc-Node-758"><span id="MJXc-Node-759"><span id="MJXc-Node-760"><span>d</span></span></span></span><span id="MJXc-Node-761"><span><span id="MJXc-Node-762"><span>ω</span></span></span><span><span id="MJXc-Node-763"><span>i</span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-764"><span><span></span><span></span><span></span><span></span><span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-765"><span id="MJXc-Node-766"><span id="MJXc-Node-767"><span id="MJXc-Node-768"><span id="MJXc-Node-769"><span><span id="MJXc-Node-770"><span>w</span></span></span><span><span id="MJXc-Node-771"><span>0</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-772"><span>+</span></span><span id="MJXc-Node-773"><span><span><span><span><span id="MJXc-Node-774"><span id="MJXc-Node-775"><span id="MJXc-Node-776"><span><span><span><span><span id="MJXc-Node-777"><span id="MJXc-Node-778"><span><span id="MJXc-Node-779"><span>∫</span></span></span><span><span id="MJXc-Node-780"><span id="MJXc-Node-781"><span id="MJXc-Node-782"><span>Ω</span></span></span></span></span></span><span id="MJXc-Node-783"><span id="MJXc-Node-784"><span id="MJXc-Node-785"><span>(</span></span><span id="MJXc-Node-786"><span>1</span></span><span id="MJXc-Node-787"><span>−</span></span><span id="MJXc-Node-788"><span>s</span></span><span id="MJXc-Node-789"><span>)</span></span></span></span><span id="MJXc-Node-790"><span id="MJXc-Node-791"><span id="MJXc-Node-792"><span><span id="MJXc-Node-793"><span>f</span></span></span><span><span><span id="MJXc-Node-798"><span>′</span></span></span><span><span id="MJXc-Node-794"><span id="MJXc-Node-795"><span id="MJXc-Node-796"><span>s</span></span><span id="MJXc-Node-797"><span>s</span></span></span></span></span></span></span></span></span><span id="MJXc-Node-799"><span>(</span></span><span id="MJXc-Node-800"><span><span id="MJXc-Node-801"><span>ω</span></span></span><span><span id="MJXc-Node-802"><span>o</span></span></span></span><span id="MJXc-Node-803"><span>,</span></span><span id="MJXc-Node-804"><span><span id="MJXc-Node-805"><span>ω</span></span></span><span><span id="MJXc-Node-806"><span>i</span></span></span></span><span id="MJXc-Node-807"><span>)</span></span><span id="MJXc-Node-808"><span>cos</span></span><span id="MJXc-Node-809"><span></span></span><span id="MJXc-Node-810"><span><span id="MJXc-Node-811"><span>θ</span></span></span><span><span id="MJXc-Node-812"><span>i</span></span></span></span><span id="MJXc-Node-813"><span id="MJXc-Node-814"><span id="MJXc-Node-815"><span>d</span></span></span></span><span id="MJXc-Node-816"><span><span id="MJXc-Node-817"><span>ω</span></span></span><span><span id="MJXc-Node-818"><span>i</span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-819"><span><span></span><span></span><span></span><span></span><span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span id="MJXc-Node-820"><span id="MJXc-Node-821"><span id="MJXc-Node-822"><span id="MJXc-Node-823"><span id="MJXc-Node-824"><span><span id="MJXc-Node-825"><span>w</span></span></span><span><span id="MJXc-Node-826"><span>1</span></span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-827"><span>,</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-6"><span id="MJXc-Node-662"><span id="MJXc-Node-663"><span>(6)</span></span><span></span></span></span></span><span><span id="mjx-eqn-7"><span id="MJXc-Node-714"><span id="MJXc-Node-715"><span>(7)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>which are then multiplied by two orders of <span><span id="MJXp-Span-663"><span id="MJXp-Span-664"><span id="MJXp-Span-665"><span id="MJXp-Span-666">F</span><span id="MJXp-Span-667">0</span></span></span></span></span><span id="MathJax-Element-29-Frame" tabindex="0"><span id="MJXc-Node-828"><span id="MJXc-Node-829"><span id="MJXc-Node-830"><span id="MJXc-Node-831"><span id="MJXc-Node-832"><span><span id="MJXc-Node-833"><span>F</span></span></span><span><span id="MJXc-Node-834"><span>0</span></span></span></span></span></span></span></span></span> and summed to form <span><span id="MJXp-Span-668"><span id="MJXp-Span-669"><span id="MJXp-Span-670"><span id="MJXp-Span-671">E</span><span id="MJXp-Span-672"><span id="MJXp-Span-673">F</span><span id="MJXp-Span-674">s</span><span id="MJXp-Span-675">s</span></span></span></span></span></span><span id="MathJax-Element-30-Frame" tabindex="0"><span id="MJXc-Node-835"><span id="MJXc-Node-836"><span id="MJXc-Node-837"><span id="MJXc-Node-838"><span id="MJXc-Node-839"><span><span id="MJXc-Node-840"><span>E</span></span></span><span><span id="MJXc-Node-841"><span id="MJXc-Node-842"><span id="MJXc-Node-843"><span>F</span></span><span id="MJXc-Node-844"><span>s</span></span><span id="MJXc-Node-845"><span>s</span></span></span></span></span></span></span></span></span></span></span>:</p>

<p><span><span id="MJXp-Span-676"><span id="MJXp-Span-677"><span><span id="MJXp-Span-678"><span id="MJXp-Span-679"><span id="MJXp-Span-680"><span id="MJXp-Span-681"><span id="MJXp-Span-682">E</span><span id="MJXp-Span-683"><span id="MJXp-Span-684">F</span><span id="MJXp-Span-685">s</span><span id="MJXp-Span-686">s</span></span></span><span id="MJXp-Span-687">(</span><span id="MJXp-Span-688"><span id="MJXp-Span-689">μ</span><span id="MJXp-Span-690">o</span></span><span id="MJXp-Span-691">)</span></span></span><span id="MJXp-Span-692"><span id="MJXp-Span-693"></span><span id="MJXp-Span-694">=</span><span id="MJXp-Span-695"><span id="MJXp-Span-696"><span id="MJXp-Span-697">w</span><span id="MJXp-Span-698">0</span></span></span><span id="MJXp-Span-699"><span id="MJXp-Span-700"><span id="MJXp-Span-701"><span id="MJXp-Span-702">F</span><span id="MJXp-Span-703">0</span></span></span><span id="MJXp-Span-704">0</span></span><span id="MJXp-Span-705">+</span><span id="MJXp-Span-706"><span id="MJXp-Span-707"><span id="MJXp-Span-708">w</span><span id="MJXp-Span-709">1</span></span></span><span id="MJXp-Span-710"><span id="MJXp-Span-711"><span id="MJXp-Span-712"><span id="MJXp-Span-713">F</span><span id="MJXp-Span-714">0</span></span></span><span id="MJXp-Span-715">1</span></span></span></span><span id="MJXp-Span-716"><span id="MJXp-Span-717"></span><span id="MJXp-Span-718"><span id="MJXp-Span-719"></span><span id="MJXp-Span-720">=</span><span id="MJXp-Span-721"><span><span><span><span id="MJXp-Span-727"><span id="MJXp-Span-728">1</span></span></span><span><span id="MJXp-Span-722"><span>∑</span></span></span></span></span><span><span id="MJXp-Span-723"><span id="MJXp-Span-724">i</span><span id="MJXp-Span-725">=</span><span id="MJXp-Span-726">0</span></span></span></span><span id="MJXp-Span-729"><span id="MJXp-Span-730"><span id="MJXp-Span-731">w</span><span id="MJXp-Span-732">i</span></span></span><span id="MJXp-Span-733"><span id="MJXp-Span-734"><span id="MJXp-Span-735"><span id="MJXp-Span-736">F</span><span id="MJXp-Span-737">0</span></span></span><span id="MJXp-Span-738">i</span></span><span id="MJXp-Span-739">.</span></span></span></span></span></span></span><span><span id="MathJax-Element-31-Frame" tabindex="0"><span id="MJXc-Node-846"><span id="MJXc-Node-847"><span id="MJXc-Node-848"><span><span><span id="MJXc-Node-849"><span id="MJXc-Node-853"><span id="MJXc-Node-854"><span id="MJXc-Node-855"><span id="MJXc-Node-856"><span id="MJXc-Node-857"><span><span id="MJXc-Node-858"><span>E</span></span></span><span><span id="MJXc-Node-859"><span id="MJXc-Node-860"><span id="MJXc-Node-861"><span>F</span></span><span id="MJXc-Node-862"><span>s</span></span><span id="MJXc-Node-863"><span>s</span></span></span></span></span></span><span id="MJXc-Node-864"><span>(</span></span><span id="MJXc-Node-865"><span><span id="MJXc-Node-866"><span>μ</span></span></span><span><span id="MJXc-Node-867"><span>o</span></span></span></span><span id="MJXc-Node-868"><span>)</span></span></span></span><span></span></span></span><span id="MJXc-Node-869"><span id="MJXc-Node-870"><span id="MJXc-Node-871"></span><span id="MJXc-Node-872"><span>=</span></span><span id="MJXc-Node-873"><span id="MJXc-Node-874"><span id="MJXc-Node-875"><span><span id="MJXc-Node-876"><span>w</span></span></span><span><span id="MJXc-Node-877"><span>0</span></span></span></span></span></span><span id="MJXc-Node-878"><span><span id="MJXc-Node-879"><span id="MJXc-Node-880"><span id="MJXc-Node-881"><span><span id="MJXc-Node-882"><span>F</span></span></span><span><span id="MJXc-Node-883"><span>0</span></span></span></span></span></span></span><span><span id="MJXc-Node-884"><span>0</span></span></span></span><span id="MJXc-Node-885"><span>+</span></span><span id="MJXc-Node-886"><span id="MJXc-Node-887"><span id="MJXc-Node-888"><span><span id="MJXc-Node-889"><span>w</span></span></span><span><span id="MJXc-Node-890"><span>1</span></span></span></span></span></span><span id="MJXc-Node-891"><span><span id="MJXc-Node-892"><span id="MJXc-Node-893"><span id="MJXc-Node-894"><span><span id="MJXc-Node-895"><span>F</span></span></span><span><span id="MJXc-Node-896"><span>0</span></span></span></span></span></span></span><span><span id="MJXc-Node-897"><span>1</span></span></span></span><span></span></span></span></span><span id="MJXc-Node-898"><span id="MJXc-Node-902"><span id="MJXc-Node-903"><span></span></span></span><span id="MJXc-Node-904"><span id="MJXc-Node-905"><span id="MJXc-Node-906"></span><span id="MJXc-Node-907"><span>=</span></span><span id="MJXc-Node-908"><span><span><span><span><span><span id="MJXc-Node-915"><span id="MJXc-Node-916"><span id="MJXc-Node-917"><span>1</span></span></span></span></span><span><span id="MJXc-Node-909"><span>∑</span></span></span></span></span></span><span><span><span id="MJXc-Node-910"><span id="MJXc-Node-911"><span id="MJXc-Node-912"><span>i</span></span><span id="MJXc-Node-913"><span>=</span></span><span id="MJXc-Node-914"><span>0</span></span></span></span></span></span></span></span><span id="MJXc-Node-918"><span id="MJXc-Node-919"><span id="MJXc-Node-920"><span><span id="MJXc-Node-921"><span>w</span></span></span><span><span id="MJXc-Node-922"><span>i</span></span></span></span></span></span><span id="MJXc-Node-923"><span><span id="MJXc-Node-924"><span id="MJXc-Node-925"><span id="MJXc-Node-926"><span><span id="MJXc-Node-927"><span>F</span></span></span><span><span id="MJXc-Node-928"><span>0</span></span></span></span></span></span></span><span><span id="MJXc-Node-929"><span>i</span></span></span></span><span id="MJXc-Node-930"><span>.</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-8"><span id="MJXc-Node-851"><span id="MJXc-Node-852"><span>(8)</span></span><span></span></span></span></span><span><span id="mjx-eqn-9"><span id="MJXc-Node-900"><span id="MJXc-Node-901"><span>(9)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>Apologies if I have laboured the point, but hopefully you can see where this is going: we can do a similar decomposition with the multiple-scattering albedo, <span><span id="MJXp-Span-740"><span id="MJXp-Span-741">1</span><span id="MJXp-Span-742">−</span><span id="MJXp-Span-743"><span id="MJXp-Span-744">E</span></span></span></span><span id="MathJax-Element-32-Frame" tabindex="0"><span id="MJXc-Node-931"><span id="MJXc-Node-932"><span id="MJXc-Node-933"><span>1</span></span><span id="MJXc-Node-934"><span>−</span></span><span id="MJXc-Node-935"><span id="MJXc-Node-936"><span id="MJXc-Node-937"><span>E</span></span></span></span></span></span></span>.</p>

<p>This time I’ll present things visually, since I think we’ve seen enough integrals for now. First, here’s <span><span id="MJXp-Span-745"><span id="MJXp-Span-746">1</span><span id="MJXp-Span-747">−</span><span id="MJXp-Span-748"><span id="MJXp-Span-749">E</span></span></span></span><span id="MathJax-Element-33-Frame" tabindex="0"><span id="MJXc-Node-938"><span id="MJXc-Node-939"><span id="MJXc-Node-940"><span>1</span></span><span id="MJXc-Node-941"><span>−</span></span><span id="MJXc-Node-942"><span id="MJXc-Node-943"><span id="MJXc-Node-944"><span>E</span></span></span></span></span></span></span> for GGX, which you may recognise from Imageworks’ slides:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/fresnel/e_lut.svg" width="282"></p>

<p><em>Figure 3: <span><span id="MJXp-Span-750"><span id="MJXp-Span-751">1</span><span id="MJXp-Span-752">−</span><span id="MJXp-Span-753"><span id="MJXp-Span-754">E</span></span></span></span><span id="MathJax-Element-34-Frame" tabindex="0"><span id="MJXc-Node-945"><span id="MJXc-Node-946"><span id="MJXc-Node-947"><span>1</span></span><span id="MJXc-Node-948"><span>−</span></span><span id="MJXc-Node-949"><span id="MJXc-Node-950"><span id="MJXc-Node-951"><span>E</span></span></span></span></span></span></span>, for GGX.</em></p>

<p>and here is the decomposition into factors for the various orders of <span><span id="MJXp-Span-755"><span id="MJXp-Span-756"><span id="MJXp-Span-757"><span id="MJXp-Span-758">F</span><span id="MJXp-Span-759">0</span></span></span></span></span><span id="MathJax-Element-35-Frame" tabindex="0"><span id="MJXc-Node-952"><span id="MJXc-Node-953"><span id="MJXc-Node-954"><span id="MJXc-Node-955"><span id="MJXc-Node-956"><span><span id="MJXc-Node-957"><span>F</span></span></span><span><span id="MJXc-Node-958"><span>0</span></span></span></span></span></span></span></span></span>, over the (<span><span id="MJXp-Span-760"><span id="MJXp-Span-761">μ</span></span></span><span id="MathJax-Element-36-Frame" tabindex="0"><span id="MJXc-Node-959"><span id="MJXc-Node-960"><span id="MJXc-Node-961"><span>μ</span></span></span></span></span>, roughness) domain:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/fresnel/factors.svg"></p>

<p><em>Figure 4: Multiple-scattering Fresnel factors for GGX.</em></p>

<p>Naturally we have more factors this time, since with multiple scattering there could be <span><span id="MJXp-Span-762"><span id="MJXp-Span-763">1</span><span id="MJXp-Span-764">…</span><span id="MJXp-Span-765">N</span></span></span><span id="MathJax-Element-37-Frame" tabindex="0"><span id="MJXc-Node-962"><span id="MJXc-Node-963"><span id="MJXc-Node-964"><span>1</span></span><span id="MJXc-Node-965"><span>…</span></span><span id="MJXc-Node-966"><span>N</span></span></span></span></span> additional reflections before light leaves the microsurface. Given these factors, we can calculate <span><span id="MJXp-Span-766"><span id="MJXp-Span-767"><span id="MJXp-Span-768"><span id="MJXp-Span-769">E</span><span id="MJXp-Span-770"><span id="MJXp-Span-771">F</span><span id="MJXp-Span-772">m</span><span id="MJXp-Span-773">s</span></span></span></span></span></span><span id="MathJax-Element-38-Frame" tabindex="0"><span id="MJXc-Node-967"><span id="MJXc-Node-968"><span id="MJXc-Node-969"><span id="MJXc-Node-970"><span id="MJXc-Node-971"><span><span id="MJXc-Node-972"><span>E</span></span></span><span><span id="MJXc-Node-973"><span id="MJXc-Node-974"><span id="MJXc-Node-975"><span>F</span></span><span id="MJXc-Node-976"><span>m</span></span><span id="MJXc-Node-977"><span>s</span></span></span></span></span></span></span></span></span></span></span> thusly:</p>

<p><span><span id="MJXp-Span-774"><span id="MJXp-Span-775"><span><span id="MJXp-Span-776"><span id="MJXp-Span-777"><span id="MJXp-Span-778"><span id="MJXp-Span-779"><span id="MJXp-Span-780">E</span><span id="MJXp-Span-781"><span id="MJXp-Span-782">F</span><span id="MJXp-Span-783">m</span><span id="MJXp-Span-784">s</span></span></span><span id="MJXp-Span-785">(</span><span id="MJXp-Span-786"><span id="MJXp-Span-787">μ</span><span id="MJXp-Span-788">o</span></span><span id="MJXp-Span-789">)</span></span><span id="MJXp-Span-790">=</span><span id="MJXp-Span-791"><span><span><span><span id="MJXp-Span-797"><span id="MJXp-Span-798">N</span></span></span><span><span id="MJXp-Span-792"><span>∑</span></span></span></span></span><span><span id="MJXp-Span-793"><span id="MJXp-Span-794">i</span><span id="MJXp-Span-795">=</span><span id="MJXp-Span-796">0</span></span></span></span><span id="MJXp-Span-799"><span id="MJXp-Span-800"><span id="MJXp-Span-801">w</span><span id="MJXp-Span-802">i</span></span></span><span id="MJXp-Span-803"><span id="MJXp-Span-804"><span id="MJXp-Span-805"><span id="MJXp-Span-806">F</span><span id="MJXp-Span-807">0</span></span></span><span id="MJXp-Span-808">i</span></span><span id="MJXp-Span-809">.</span></span></span></span></span></span></span><span><span id="MathJax-Element-39-Frame" tabindex="0"><span id="MJXc-Node-978"><span id="MJXc-Node-979"><span id="MJXc-Node-980"><span><span><span id="MJXc-Node-981"><span id="MJXc-Node-985"><span id="MJXc-Node-986"><span id="MJXc-Node-987"><span id="MJXc-Node-988"><span id="MJXc-Node-989"><span><span id="MJXc-Node-990"><span>E</span></span></span><span><span id="MJXc-Node-991"><span id="MJXc-Node-992"><span id="MJXc-Node-993"><span>F</span></span><span id="MJXc-Node-994"><span>m</span></span><span id="MJXc-Node-995"><span>s</span></span></span></span></span></span><span id="MJXc-Node-996"><span>(</span></span><span id="MJXc-Node-997"><span><span id="MJXc-Node-998"><span>μ</span></span></span><span><span id="MJXc-Node-999"><span>o</span></span></span></span><span id="MJXc-Node-1000"><span>)</span></span></span></span><span id="MJXc-Node-1001"><span>=</span></span><span id="MJXc-Node-1002"><span><span><span><span><span><span id="MJXc-Node-1009"><span id="MJXc-Node-1010"><span id="MJXc-Node-1011"><span>N</span></span></span></span></span><span><span id="MJXc-Node-1003"><span>∑</span></span></span></span></span></span><span><span><span id="MJXc-Node-1004"><span id="MJXc-Node-1005"><span id="MJXc-Node-1006"><span>i</span></span><span id="MJXc-Node-1007"><span>=</span></span><span id="MJXc-Node-1008"><span>0</span></span></span></span></span></span></span></span><span id="MJXc-Node-1012"><span id="MJXc-Node-1013"><span id="MJXc-Node-1014"><span><span id="MJXc-Node-1015"><span>w</span></span></span><span><span id="MJXc-Node-1016"><span>i</span></span></span></span></span></span><span id="MJXc-Node-1017"><span><span id="MJXc-Node-1018"><span id="MJXc-Node-1019"><span id="MJXc-Node-1020"><span><span id="MJXc-Node-1021"><span>F</span></span></span><span><span id="MJXc-Node-1022"><span>0</span></span></span></span></span></span></span><span><span id="MJXc-Node-1023"><span>i</span></span></span></span><span id="MJXc-Node-1024"><span>.</span></span><span></span></span></span></span></span></span><span><span><span id="mjx-eqn-eq:ms_sum"><span id="MJXc-Node-983"><span id="MJXc-Node-984"><span>(10)</span></span><span></span></span></span></span></span></span></span></span></span></span></p><p>As with the approach for environmental lighting, these factors can be precomputed and stored in 2D LUTs. At run time, we fetch the appropriate factors (based on view angle and roughness) and calculate <span><span id="MJXp-Span-810"><span id="MJXp-Span-811"><span id="MJXp-Span-812"><span id="MJXp-Span-813">E</span><span id="MJXp-Span-814"><span id="MJXp-Span-815">F</span><span id="MJXp-Span-816">m</span><span id="MJXp-Span-817">s</span></span></span></span></span></span><span id="MathJax-Element-40-Frame" tabindex="0"><span id="MJXc-Node-1025"><span id="MJXc-Node-1026"><span id="MJXc-Node-1027"><span id="MJXc-Node-1028"><span id="MJXc-Node-1029"><span><span id="MJXc-Node-1030"><span>E</span></span></span><span><span id="MJXc-Node-1031"><span id="MJXc-Node-1032"><span id="MJXc-Node-1033"><span>F</span></span><span id="MJXc-Node-1034"><span>m</span></span><span id="MJXc-Node-1035"><span>s</span></span></span></span></span></span></span></span></span></span></span> using Eq. <span><span id="MJXp-Span-818"><span id="MJXp-Span-819"><span id="MJXp-Span-820">10</span></span></span></span><span id="MathJax-Element-41-Frame" tabindex="0"><span id="MJXc-Node-1036"><span id="MJXc-Node-1037"><a href="#mjx-eqn-eq%3Ams_sum"><span id="MJXc-Node-1038"><span id="MJXc-Node-1039"><span>10</span></span></span></a></span></span></span>.</p>

<p>While this hopefully all makes sense, it’s a little abstract, so let’s visualise <span><span id="MJXp-Span-821"><span id="MJXp-Span-822"><span id="MJXp-Span-823"><span id="MJXp-Span-824">E</span><span id="MJXp-Span-825"><span id="MJXp-Span-826">F</span><span id="MJXp-Span-827">m</span><span id="MJXp-Span-828">s</span></span></span></span></span></span><span id="MathJax-Element-42-Frame" tabindex="0"><span id="MJXc-Node-1040"><span id="MJXc-Node-1041"><span id="MJXc-Node-1042"><span id="MJXc-Node-1043"><span id="MJXc-Node-1044"><span><span id="MJXc-Node-1045"><span>E</span></span></span><span><span id="MJXc-Node-1046"><span id="MJXc-Node-1047"><span id="MJXc-Node-1048"><span>F</span></span><span id="MJXc-Node-1049"><span>m</span></span><span id="MJXc-Node-1050"><span>s</span></span></span></span></span></span></span></span></span></span></span> for our copper material:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/fresnel/f_lut.svg" width="282"></p>

<p><em>Figure 5: <span><span id="MJXp-Span-829"><span id="MJXp-Span-830"><span id="MJXp-Span-831"><span id="MJXp-Span-832">E</span><span id="MJXp-Span-833"><span id="MJXp-Span-834">F</span><span id="MJXp-Span-835">m</span><span id="MJXp-Span-836">s</span></span></span></span></span></span><span id="MathJax-Element-43-Frame" tabindex="0"><span id="MJXc-Node-1051"><span id="MJXc-Node-1052"><span id="MJXc-Node-1053"><span id="MJXc-Node-1054"><span id="MJXc-Node-1055"><span><span id="MJXc-Node-1056"><span>E</span></span></span><span><span id="MJXc-Node-1057"><span id="MJXc-Node-1058"><span id="MJXc-Node-1059"><span>F</span></span><span id="MJXc-Node-1060"><span>m</span></span><span id="MJXc-Node-1061"><span>s</span></span></span></span></span></span></span></span></span></span></span> for copper GGX material.</em></p>

<p>As we can see, it’s just like the multiple-scattering albedo shown in Figure 3, only now it’s been tinted by the different orders of Fresnel reflection. Note how the saturation increases from top left (low roughness, grazing angle) to bottom right (high roughness, incident view angle), as we would expect<sup id="fnref:2" data-footnote-backlink-ref="fnref:2" data-footnote-ref="#fn:2"><a href="#fn:2" rel="footnote">2</a></sup><a href="#" data-footnote-identifier="2" alt="See Footnote 2" rel="footnote" data-footnote-content="<p>Of course this is already visualised by the decomposition in Figure 4, but it’s consistent with the behaviour of the Fresnel function and the average number of bounces increasing with roughness.</p>"><span data-footnote-identifier="2"></span><span></span><span></span></a>.</p>

<p>Finally, here are the spheres again with this LUT-based solution, this time under direct lighting:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/conductors/lut_vs_heitz.png"></p>

<p><em>Figure 6: Lit spheres, with roughness <span><span id="MJXp-Span-837"><span id="MJXp-Span-838">∈</span><span id="MJXp-Span-839">[</span><span id="MJXp-Span-840"><span><span id="MJXp-Span-841">1</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-842">8</span></span></span></span></span></span><span id="MJXp-Span-843">,</span><span id="MJXp-Span-844"><span><span id="MJXp-Span-845">2</span></span><span><span><span><span></span></span><span><span><span id="MJXp-Span-846">8</span></span></span></span></span></span><span id="MJXp-Span-847">,</span><span id="MJXp-Span-848">…</span><span id="MJXp-Span-849">1</span><span id="MJXp-Span-850">]</span></span></span><span id="MathJax-Element-44-Frame" tabindex="0"><span id="MJXc-Node-1062"><span id="MJXc-Node-1063"><span id="MJXc-Node-1064"><span>∈</span></span><span id="MJXc-Node-1065"><span>[</span></span><span id="MJXc-Node-1066"><span><span><span id="MJXc-Node-1067"><span>1</span></span></span><span><span id="MJXc-Node-1068"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-1069"><span>,</span></span><span id="MJXc-Node-1070"><span><span><span id="MJXc-Node-1071"><span>2</span></span></span><span><span id="MJXc-Node-1072"><span>8</span></span></span><span></span></span><span></span></span><span id="MJXc-Node-1073"><span>,</span></span><span id="MJXc-Node-1074"><span>…</span></span><span id="MJXc-Node-1075"><span>1</span></span><span id="MJXc-Node-1076"><span>]</span></span></span></span></span> (left halves: with <span><span id="MJXp-Span-851"><span id="MJXp-Span-852"><span id="MJXp-Span-853"><span id="MJXp-Span-854">E</span><span id="MJXp-Span-855"><span id="MJXp-Span-856">F</span><span id="MJXp-Span-857">m</span><span id="MJXp-Span-858">s</span></span></span></span></span></span><span id="MathJax-Element-45-Frame" tabindex="0"><span id="MJXc-Node-1077"><span id="MJXc-Node-1078"><span id="MJXc-Node-1079"><span id="MJXc-Node-1080"><span id="MJXc-Node-1081"><span><span id="MJXc-Node-1082"><span>E</span></span></span><span><span id="MJXc-Node-1083"><span id="MJXc-Node-1084"><span id="MJXc-Node-1085"><span>F</span></span><span id="MJXc-Node-1086"><span>m</span></span><span id="MJXc-Node-1087"><span>s</span></span></span></span></span></span></span></span></span></span></span>, right halves: Heitz).</em></p>

<p>In this example, our revised multiple-scattering approximation (Eq.<span><span id="MJXp-Span-859"><span id="MJXp-Span-860">&nbsp;</span><span id="MJXp-Span-861"><span id="MJXp-Span-862">1</span></span></span></span><span id="MathJax-Element-46-Frame" tabindex="0"><span id="MJXc-Node-1088"><span id="MJXc-Node-1089"><span id="MJXc-Node-1090"><span>&nbsp;</span></span><a href="#mjx-eqn-eq%3Afms"><span id="MJXc-Node-1091"><span id="MJXc-Node-1092"><span>1</span></span></span></a></span></span></span>) is barely indistinguishable from the <em>Heitz</em> model. The only slight difference, at roughness = 1, comes from the multiple-scattering lobe not being a perfect match to the ground truth, as we already saw in the <a href="http://blog.selfshadow.com/2018/06/04/multi-faceted-part-2/">last post</a>:</p>

<p><img src="https://blog.selfshadow.com/images/multi-faceted/conservation/spi_vs_heitz_r1.png" width="256"></p>

<p><em>Figure 7: GGX with multiple scattering, roughness = 1<br>
(left half: Imageworks, right half: Heitz).</em></p>

<p>I will stop things here as this post has already reached a comfortable reading length, but I hope you’ll agree that we’ve made some progress.</p>

<p><em>In the <a href="https://blog.selfshadow.com/2019/03/30/multi-faceted-part-4/">next post</a>, I cover how the precomputation of <span><span id="MJXp-Span-863"><span id="MJXp-Span-864"><span id="MJXp-Span-865"><span id="MJXp-Span-866">E</span><span id="MJXp-Span-867"><span id="MJXp-Span-868">F</span><span id="MJXp-Span-869">m</span><span id="MJXp-Span-870">s</span></span></span></span></span></span><span id="MathJax-Element-47-Frame" tabindex="0"><span id="MJXc-Node-1093"><span id="MJXc-Node-1094"><span id="MJXc-Node-1095"><span id="MJXc-Node-1096"><span id="MJXc-Node-1097"><span><span id="MJXc-Node-1098"><span>E</span></span></span><span><span id="MJXc-Node-1099"><span id="MJXc-Node-1100"><span id="MJXc-Node-1101"><span>F</span></span><span id="MJXc-Node-1102"><span>m</span></span><span id="MJXc-Node-1103"><span>s</span></span></span></span></span></span></span></span></span></span></span> is achieved in practice, and how it can be further optimised for real-time use.</em></p>


</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>