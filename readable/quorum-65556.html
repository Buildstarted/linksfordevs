<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Quorum - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Quorum - linksfor.dev(s)"/>
    <meta property="og:description" content="Avoid two groups of servers making independent decisions, by requiring majority for taking every decision."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Quorum</title>
<div class="readable">
        <h1>Quorum</h1>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 12 Aug 2020</div>
        <p><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html">https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
<div>




<p>Avoid two groups of servers making independent decisions, by requiring majority for taking every decision.</p>

<p>11 August 2020</p>

<section>
<h2>Problem</h2>



<p>
     In a distributed system, whenever a server takes any action, 
     it needs to ensure that in the event of a crash the results of the actions are available to the clients. 
     This can be achieved by replicating the result to other servers in the cluster. But that leads to the question: how many other servers need to confirm the replication before the original server can be confident 
     that the update is fully recognized. If the original server waits for too many replications, then it will respond slowly - reducing liveness. 
     But if it doesn't have enough replications, then the update could be lost - a failure of safety. 
     It's critical to balance between the overall system performance and system continuity.
    </p>
</section>

<section>
<h2>Solution</h2>

<p>A cluster agrees that it's received an update when a majority of the nodes in the cluster have acknowledged the update. We call this number a quorum. So if we have a cluster of five nodes, we need a quorum of three. (For a cluster of n nodes, the quorum is n/2 + 1.)</p>

<p>The need for a quorum indicates how many failures can be tolerated - which is the size of the cluster minus the quorum. A cluster of five nodes can tolerate two of them failing. In general, if we want to tolerate 'f' failures we need a cluster size of 2f + 1</p>

<p>Consider following two examples that need a quorum:</p>

<ul>
<li><b>Updating data in a cluster of servers.</b><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/high-watermark.html">High-Water Mark</a> is used to ensure only data which is guaranteed to be available on the majority of servers is visible to clients.</li>

<li><b>Leader election.</b> In <a href="https://martinfowler.com/articles/patterns-of-distributed-systems/leader-follower.html">Leader and Followers</a>, a leader is selected only if it gets votes from a majority of the servers. </li>
</ul>

<section id="DecidingOnNumberOfServersInACluster">
<h2> Deciding on number of servers in a cluster </h2>



<p>
         The cluster can function only if majority of servers are up and running. 
         In systems doing data replication, there are two things to consider:
        </p>

<ul>
<li> The throughput of write operations. </li>

<p> 
                  Every time data is written to the cluster, it needs to be copied to multiple servers. Every additional server adds some overhead to complete this write.
                  The latency of data write is directly proportional to the number of servers forming the quorum. 
                  As we will see below, doubling the number of servers in a cluster will reduce throughput to half of the value for the original cluster.
                  </p>

<li> The number of failures which need to be tolerated.     </li>

<p>
                 The number of server failures tolerated is dependent on the size of the cluster. But just adding one more server to an existing cluster 
                 doesn't always give more fault tolerance: adding one server to a three server cluster doesn't increase failure tolerance.                             
                </p>
</ul>

<p>Considering these two factors, most practical quorum-based systems have cluster sizes of three or five. A five-server cluster tolerates two server failures and 
         has tolerable data write throughput of few thousand requests per second.
        </p>
</section>

<section id="">
<p>     
        Here is an example of how to choose the number of servers, based on the number of tolerated failures
        and approximate impact on the throughput.         
        The throughput column shows approximate relative throughput to highlight how throughput degrades with the number of servers.                                         
        The number will vary from system to system. 
        As an example, readers can refer to the actual throughput data published in <a href="https://web.stanford.edu/~ouster/cgi-bin/papers/OngaroPhD.pdf">Raft Thesis</a> and the original <a href="https://www.usenix.org/legacy/event/atc10/tech/full_papers/Hunt.pdf">Zookeeper paper</a>.
     </p>

<table>
<thead>
<tr><th>Number of Servers</th><th>Quorum</th><th>Number Of Tolerated Failures</th><th>Representative Throughput</th></tr>
</thead>

<tbody>
<tr><td>1</td><td>1</td><td>0</td><td>100</td></tr>

<tr><td>2</td><td>2</td><td>0</td><td>85</td></tr>

<tr><td>3</td><td>2</td><td>1</td><td>82</td></tr>

<tr><td>4</td><td>3</td><td>1</td><td>57</td></tr>

<tr><td>5</td><td>3</td><td>2</td><td>48</td></tr>

<tr><td>6</td><td>4</td><td>2</td><td>41</td></tr>

<tr><td>7</td><td>5</td><td>3</td><td>36</td></tr>
</tbody>
</table>
</section>
</section>

<section>
<h2>Examples</h2>

<ul>
<li>  
              All the consensus implementations like <a href="https://zookeeper.apache.org/doc/r3.4.13/zookeeperInternals.html#sc_atomicBroadcast">Zab</a>, <a href="https://raft.github.io/">Raft</a>, <a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a> are quorum based.              
           </li>

<li>
              Even in systems which don't use consensus, quorum is used to make sure the latest update is available to at least one server in case of failures or network partition.
              For instance, in databases like <a href="http://cassandra.apache.org/">Cassandra</a>, a database update can be configured to return success only 
              after a majority of the servers have updated the record successfully.
         </li>
</ul>
</section>

<nav>
<p>This page is part of:</p>

<p>Patterns of Distributed Systems</p>
<img src="https://martinfowler.com/articles/patterns-of-distributed-systems/card.png">
<p><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/index.html">Main Narrative Article</a></p>

<p>Patterns</p>

<ul>
<li>Consistent Core †</li>

<li><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/generation.html">Generation Clock</a></li>

<li><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/heartbeat.html">HeartBeat</a></li>

<li><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/high-watermark.html">High-Water Mark</a></li>

<li><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/leader-follower.html">Leader and Followers</a></li>

<li>Low-Water Mark †</li>

<li><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html">Quorum</a></li>

<li>Request Pipeline †</li>

<li>Segmented Log †</li>

<li>Single Socket Channel †</li>

<li>Singular Update Queue †</li>

<li>State Watch †</li>

<li>Time Bound Lease †</li>

<li>Write-Ahead Log †</li>
</ul>

<p>† pattern in progress</p>
</nav>

<p>
<details id="SignificantRevisions">
<summary>Significant Revisions</summary>
</details>
</p>
</div>
</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>