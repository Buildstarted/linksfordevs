<!DOCTYPE html>
<html lang="en">
<head>
    <title>
New features in 0.9.45 @ PeachPie -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>New features in 0.9.45 @  PeachPie</h1><div><div class="entry-content"><p>Leading up to the release of the first stable version of our PHP compiler, we are now implementing the first various compiler optimizations. Read more about them in this blog and why you should update or try PeachPie 0.9.45!</p><span id="more-18234"></span><p>As usually, this release fixes some issues, adds new standard PHP features that were required to run certain frameworks and also introduces the first optimizations the compiler can perform to maximize the performance of the compiled PHP apps.</p><h2>Compile-Time Enhancements</h2><p>There are some nice examples of what the compiler can do, and what the consequences of that can be. Mostly the compiler now evaluates more conditions and therefore resolves more unreachable code; not only does it make the resulting assembly smaller, but since the unreachable code may contain alternative declarations of functions and classes, the compiler now ignores those declarations, getting rid of potential ambiguities and avoiding a dynamic resolution in run-time. </p><p>Below is a list of some of the optimization we’ve tried so far. This is only a small fraction of possible performance improvements to make, but our internal benchmarks show that these have already sped up e.g. the loading of a WordPress page by about 8%!</p><ul><li>string concatenation is resolved in compile time if possible</li></ul><ul><li>more complex conditions are evaluated</li><li><code>ini_get()</code> evaluated in compile time in some cases. Usually if we know the option is not supported and ini_get() would always return FALSE</li><li><code>basename(__FILE__)</code>  and <code>dirname(__FILE__)</code>  get evaluated</li></ul><ul><li><code>include </code>and <code>require </code>can be evaluated as well; since PeachPie compiles script files into .NET static methods, they can be called directly instead of looking into a hash table and resolving the file path in run time</li></ul><ul><li><code>callables</code> can be evaluated in compile time; this is more complex and maybe it deserves its own blog post. When a constant value is about to be converted to a callable – e.g. <code>array_map('cube',&nbsp;$a);</code> – and since every PHP function is compiled into a .NET method, we can resolve the function name – ‘cube’ – and use the CLR delegate directly. The delegate is pre-allocated and results in zero overhead instead of resolving the function in run-time</li></ul><p>Most of these optimizations only take effect when compiling the PHP app in release mode (on the command line: <code>dotnet build -c release</code>). We will continue to implement these types of optimizations to release a version 1.0 that’s as performant as possible given the resources we have.</p><h2>Added Features</h2><p>More so than just fixing issues, we’re constantly working on allowing real-world legacy PHP applications to run on .NET and .NET Core. While migrating code such as Laravel, Symfony, PHPUnit, WordPress and related plugins, and when compiling our clients’ really old PHP apps, we have implemented the following:</p><ul><li>XInclude functionality (XML extension) (thanks <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/TomatorCZ" target="_blank">TomatorCZ</a>)</li><li>PHP 7.4 syntax (not all features implemented yet, however)</li><li><code>mb_str_split()</code>, <code>??=</code> operator (PHP 7.4)</li><li><code>array_merge()</code> accepts zero arguments (PHP 7.4)</li><li><code>ReflectionClass::getProperties()</code></li><li><code>ReflectionProperty.setValue()</code> overload with 1 parameter </li><li><code>SORT_NATURAL</code>,  <code>SORT_FLAG_CASE </code></li><li><code>dirname()</code> with <code>level </code>parameter</li></ul><h2>Fixed Issues</h2><p>As always, we continually fix issues our community submits on GitHub or that we run into when working on our clients’ projects. Here is a short list of some of the more prominent issues we encountered and fixed:</p><ul><li>the compiler crashed due to an unsecured critical section in logging!</li><li>the compiler crashed on a nullref exception in case of a syntax error</li><li><code>var_export()</code> did not escape outputted strings</li><li>the compiler treated all primitive types as nullable</li><li><code>get_parent_class()</code> returned invalid values when used without arg</li></ul><h2>Conclusion</h2><p>As always, we welcome any feedback, contributions, issues, questions and we continue to implement features as needed by both our clients and our community. If you’re a .NET performance connoisseur, please do consider submitting PRs with any low-level optimizations you can think of! </p><p>Follow our progress on the <a rel="noreferrer noopener" aria-label="GitHub repo (opens in a new tab)" href="https://github.com/peachpiecompiler/peachpie" target="_blank">GitHub repo</a>, <a rel="noreferrer noopener" aria-label="Twitter  (opens in a new tab)" href="https://twitter.com/pchpcompiler" target="_blank">Twitter </a>or <a href="https://facebook.com/pchpcompiler" target="_blank" rel="noreferrer noopener" aria-label="Facebook (opens in a new tab)">Facebook</a>.</p><div class="blog-subtext"><p class="readability-styled" style="display: inline;">Posted on August 7, 2019, in category </p><a href="https://www.peachpie.io/category/information" rel="category tag">Information</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/category/news" rel="category tag">News</a><p class="readability-styled" style="display: inline;">, tags: </p><a href="https://www.peachpie.io/tag/net" rel="tag">.NET</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/callables" rel="tag">callables</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/compiler" rel="tag">compiler</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/il" rel="tag">IL</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/include" rel="tag">include</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/performance" rel="tag">performance</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/php" rel="tag">PHP</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/reflection" rel="tag">reflection</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/release" rel="tag">release</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/require" rel="tag">require</a><p class="readability-styled" style="display: inline;">, </p><a href="https://www.peachpie.io/tag/xinclude" rel="tag">xinclude</a></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>