<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Improve `X % C == 0` for signed integers where C is any number (not j&#x2026; &#xB7; EgorBo/runtime-1@84016c0 - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Improve `X % C == 0` for signed integers where C is any number (not j&#x2026; &#xB7; EgorBo/runtime-1@84016c0 - linksfor.dev(s)"/>
    <meta property="article:author" content="EgorBo"/>
    <meta property="og:description" content="&#x2026;ust power of two).&#xA;&#xA;The implementation is based on LLVM sources: https://github.com/llvm/llvm-project/blob/5f91c7b9805729e94ff7e54f3f85e525f6f2427c/llvm/lib/CodeGen/SelectionDAG/TargetLowering.cpp..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/EgorBo/runtime-1/commit/84016c03e324a33f402fde08335a0c3655296bde"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Improve `X % C == 0` for signed integers where C is any number (not j&#x2026; &#xB7; EgorBo/runtime-1@84016c0</title>
<div class="readable">
        <h1>Improve `X % C == 0` for signed integers where C is any number (not j&#x2026; &#xB7; EgorBo/runtime-1@84016c0</h1>
            <div>by EgorBo</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 15 Feb 2020</div>
        <p><a href="https://github.com/EgorBo/runtime-1/commit/84016c03e324a33f402fde08335a0c3655296bde">https://github.com/EgorBo/runtime-1/commit/84016c03e324a33f402fde08335a0c3655296bde</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-hydro-view="{&quot;event_type&quot;:&quot;pull_request.select_diff_range&quot;,&quot;payload&quot;:{&quot;actor_id&quot;:null,&quot;pull_request_id&quot;:null,&quot;repository_id&quot;:null,&quot;diff_type&quot;:&quot;UNIFIED&quot;,&quot;whitespace_ignored&quot;:false,&quot;originating_url&quot;:&quot;https://github.com/EgorBo/runtime-1/commit/84016c03e324a33f402fde08335a0c3655296bde&quot;,&quot;user_id&quot;:null}}" data-hydro-view-hmac="b7adb2cc52c22ea2c9827e8c05fb4d5262d634271ac23141d5ef445d696a21f2">
        <div>
          <table data-tab-size="4" data-diff-anchor="diff-aab71f0151abd998a27f34a2616bbe5c">

                
      <tbody><tr data-position="0">
    <td colspan="2">
          <a href="#diff-aab71f0151abd998a27f34a2616bbe5c" title="Expand Up" aria-label="Expand Up" data-url="/EgorBo/runtime-1/blob_excerpt/d7bad64f6244e51125b5846688dd1db71d7a2910?diff=unified&amp;direction=up&amp;in_wiki_context=&amp;last_left=&amp;last_right=&amp;left=2296&amp;left_hunk_size=6&amp;mode=100644&amp;path=src%2Fcoreclr%2Fsrc%2Fjit%2Futils.cpp&amp;right=2296&amp;right_hunk_size=90" data-left-range="1-2295" data-right-range="1-2295">
            
          </a>
    </td>
    <td>@@ -2296,6 +2296,90 @@ T GetUnsignedMagic(T d, bool* add /*out*/, int* shift /*out*/)</td>
  </tr>

    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2296" data-line-number="2296"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2296" data-line-number="2296"></td>

  <td>
    <span data-code-marker=" ">    <span>return</span> q2 + <span>1</span>;     <span><span>//</span> resulting magic number</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2297" data-line-number="2297"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2297" data-line-number="2297"></td>

  <td>
    <span data-code-marker=" ">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2298" data-line-number="2298"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2298" data-line-number="2298"></td>

  <td>
    <span data-code-marker=" "><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2299" data-line-number="2299"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2300" data-line-number="2300"></td>

  <td>
    <span data-code-marker="+"><span>static</span> <span>void</span> <span>udivrem</span>(<span>int64_t</span> n, <span>int64_t</span> p, <span>int64_t</span>&amp; q, <span>int64_t</span>&amp; r)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2301" data-line-number="2301"></td>

  <td>
    <span data-code-marker="+">{</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2302" data-line-number="2302"></td>

  <td>
    <span data-code-marker="+">    r = n % p;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2303" data-line-number="2303"></td>

  <td>
    <span data-code-marker="+">    q = n / p;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2304" data-line-number="2304"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (p &gt; <span>0</span> &amp;&amp; r &lt; <span>0</span> || p &lt; <span>0</span> &amp;&amp; r &gt; <span>0</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2305" data-line-number="2305"></td>

  <td>
    <span data-code-marker="+">    {</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2306" data-line-number="2306"></td>

  <td>
    <span data-code-marker="+">        q--;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2307" data-line-number="2307"></td>

  <td>
    <span data-code-marker="+">        r += p;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2308" data-line-number="2308"></td>

  <td>
    <span data-code-marker="+">    }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2309" data-line-number="2309"></td>

  <td>
    <span data-code-marker="+">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2310" data-line-number="2310"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2311" data-line-number="2311"></td>

  <td>
    <span data-code-marker="+"><span>static</span> <span>int64_t</span> <span>multiplicativeInverse</span>(<span>int64_t</span> a, <span>int64_t</span> modulo)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2312" data-line-number="2312"></td>

  <td>
    <span data-code-marker="+">{</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2313" data-line-number="2313"></td>

  <td>
    <span data-code-marker="+">    <span>int64_t</span> r[<span>2</span>] = { modulo, a };</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2314" data-line-number="2314"></td>

  <td>
    <span data-code-marker="+">    <span>int64_t</span> t[<span>2</span>] = { <span>0</span>, <span>1</span> };</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2315" data-line-number="2315"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2316" data-line-number="2316"></td>

  <td>
    <span data-code-marker="+">    <span>uint32_t</span> i;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2317" data-line-number="2317"></td>

  <td>
    <span data-code-marker="+">    <span>for</span> (i = <span>0</span>; r[i ^ <span>1</span>] != <span>0</span>; i ^= <span>1</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2318" data-line-number="2318"></td>

  <td>
    <span data-code-marker="+">    {</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2319" data-line-number="2319"></td>

  <td>
    <span data-code-marker="+">        <span>int64_t</span> q = <span>0</span>;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2320" data-line-number="2320"></td>

  <td>
    <span data-code-marker="+">        <span>udivrem</span>(r[i], r[i ^ <span>1</span>], q, r[i]);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2321" data-line-number="2321"></td>

  <td>
    <span data-code-marker="+">        t[i] -= t[i ^ <span>1</span>] * q;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2322" data-line-number="2322"></td>

  <td>
    <span data-code-marker="+">    }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2323" data-line-number="2323"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2324" data-line-number="2324"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (r[i] != <span>1</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2325" data-line-number="2325"></td>

  <td>
    <span data-code-marker="+">        <span>return</span> <span>0</span>;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2326" data-line-number="2326"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2327" data-line-number="2327"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (t[i] &lt; <span>0</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2328" data-line-number="2328"></td>

  <td>
    <span data-code-marker="+">        t[i] += modulo;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2329" data-line-number="2329"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2330" data-line-number="2330"></td>

  <td>
    <span data-code-marker="+">    <span>return</span> t[i];</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2331" data-line-number="2331"></td>

  <td>
    <span data-code-marker="+">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2332" data-line-number="2332"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2333" data-line-number="2333"></td>

  <td>
    <span data-code-marker="+"><span>static</span> <span>int32_t</span> <span>clearLowBits</span>(<span>int32_t</span> a, <span>int32_t</span> b)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2334" data-line-number="2334"></td>

  <td>
    <span data-code-marker="+">{</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2335" data-line-number="2335"></td>

  <td>
    <span data-code-marker="+">    <span>uint32_t</span> clearMask = <span>0xFFFFFFFF</span> &lt;&lt; b;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2336" data-line-number="2336"></td>

  <td>
    <span data-code-marker="+">    <span>return</span> <span>static_cast</span>&lt;<span>int32_t</span>&gt;(<span>static_cast</span>&lt;<span>uint32_t</span>&gt;(a) &amp; clearMask);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2337" data-line-number="2337"></td>

  <td>
    <span data-code-marker="+">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2338" data-line-number="2338"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2339" data-line-number="2339"></td>

  <td>
    <span data-code-marker="+"><span><span>//</span> __builtin_ctz ?</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2340" data-line-number="2340"></td>

  <td>
    <span data-code-marker="+"><span>int32_t</span> <span>TrailingZeroCount</span>(<span>uint32_t</span> x)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2341" data-line-number="2341"></td>

  <td>
    <span data-code-marker="+">{</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2342" data-line-number="2342"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (x == <span>0</span>) <span>return</span>(<span>32</span>);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2343" data-line-number="2343"></td>

  <td>
    <span data-code-marker="+">    <span>int32_t</span> n = <span>1</span>;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2344" data-line-number="2344"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> ((x &amp; <span>0x0000FFFF</span>) == <span>0</span>) { n = n + <span>16</span>; x = x &gt;&gt; <span>16</span>; }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2345" data-line-number="2345"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> ((x &amp; <span>0x000000FF</span>) == <span>0</span>) { n = n + <span>8</span>; x = x &gt;&gt; <span>8</span>; }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2346" data-line-number="2346"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> ((x &amp; <span>0x0000000F</span>) == <span>0</span>) { n = n + <span>4</span>; x = x &gt;&gt; <span>4</span>; }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2347" data-line-number="2347"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> ((x &amp; <span>0x00000003</span>) == <span>0</span>) { n = n + <span>2</span>; x = x &gt;&gt; <span>2</span>; }</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2348" data-line-number="2348"></td>

  <td>
    <span data-code-marker="+">    <span>return</span> n - (x &amp; <span>1</span>);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2349" data-line-number="2349"></td>

  <td>
    <span data-code-marker="+">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2350" data-line-number="2350"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2351" data-line-number="2351"></td>

  <td>
    <span data-code-marker="+"><span>bool</span> <span>CalculateMagicNumbers</span>(<span>int32_t</span> D, <span>int32_t</span>&amp; P, <span>int32_t</span>&amp; A, <span>int32_t</span>&amp; K, <span>int32_t</span>&amp; Q)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2352" data-line-number="2352"></td>

  <td>
    <span data-code-marker="+">{</span></td>
</tr>



      
<tr>
  <td data-quote-markdown=".js-comment-body" colspan="3">
        <div>
  <div>
    

  </div>
</div>



  </td>
</tr>

    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2353" data-line-number="2353"></td>

  <td>
    <span data-code-marker="+">    P = <span>0</span>; A = <span>0</span>; K = <span>0</span>; Q = <span>0</span>;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2354" data-line-number="2354"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2355" data-line-number="2355"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (D == INT32_MIN)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2356" data-line-number="2356"></td>

  <td>
    <span data-code-marker="+">        <span>return</span> <span>false</span>; <span><span>//</span> the optimization won't work</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2357" data-line-number="2357"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2358" data-line-number="2358"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (D &lt; <span>0</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2359" data-line-number="2359"></td>

  <td>
    <span data-code-marker="+">        D = -D; <span><span>//</span>  `rem %X, -C` is equivalent to `rem %X, C`</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2360" data-line-number="2360"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2361" data-line-number="2361"></td>

  <td>
    <span data-code-marker="+">    <span>if</span> (D == <span>0</span> || D == <span>1</span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2362" data-line-number="2362"></td>

  <td>
    <span data-code-marker="+">        <span>return</span> <span>false</span>; <span><span>//</span> these cases are handled by the existing code</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2363" data-line-number="2363"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2364" data-line-number="2364"></td>

  <td>
    <span data-code-marker="+">    <span><span>//</span> TODO: if D is a power of two -&gt;  `x &amp; (c-1)`, see https://github.com/dotnet/coreclr/pull/25744</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2365" data-line-number="2365"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2366" data-line-number="2366"></td>

  <td>
    <span data-code-marker="+">    <span><span>//</span> Decompose D into D0 * 2^K</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2367" data-line-number="2367"></td>

  <td>
    <span data-code-marker="+">    K = <span>TrailingZeroCount</span>(<span>static_cast</span>&lt;<span>uint32_t</span>&gt;(D));</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2368" data-line-number="2368"></td>

  <td>
    <span data-code-marker="+">    <span>int32_t</span> D0 = D &gt;&gt; K;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2369" data-line-number="2369"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2370" data-line-number="2370"></td>

  <td>
    <span data-code-marker="+">    <span>int64_t</span> minSignedI33 = -<span>4294967296</span>; <span><span>//</span> APInt::getSignedMinValue(32 + 1)</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2371" data-line-number="2371"></td>

  <td>
    <span data-code-marker="+">    P = (<span>int32_t</span>)<span>multiplicativeInverse</span>(D0, minSignedI33);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2372" data-line-number="2372"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2373" data-line-number="2373"></td>

  <td>
    <span data-code-marker="+">    <span><span>//</span> A = floor((2^(W - 1) - 1) / D0) &amp; -2^K</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2374" data-line-number="2374"></td>

  <td>
    <span data-code-marker="+">    A = (<span>int32_t</span>)(INT32_MAX / (<span>uint32_t</span>)D0);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2375" data-line-number="2375"></td>

  <td>
    <span data-code-marker="+">    A = <span>clearLowBits</span>(A, K);</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2376" data-line-number="2376"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2377" data-line-number="2377"></td>

  <td>
    <span data-code-marker="+">    <span><span>//</span> Q = floor((2 * A) / (2^K))</span></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2378" data-line-number="2378"></td>

  <td>
    <span data-code-marker="+">    Q = (<span>int32_t</span>)(((<span>uint32_t</span>)(<span>2</span> * A)) / (<span>uint32_t</span>)(<span>1</span> &lt;&lt; K));</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2379" data-line-number="2379"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2380" data-line-number="2380"></td>

  <td>
    <span data-code-marker="+">    <span>return</span> <span>true</span>;</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2381" data-line-number="2381"></td>

  <td>
    <span data-code-marker="+">}</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2382" data-line-number="2382"></td>

  <td>
    <span data-code-marker="+"><br></span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2299" data-line-number="2299"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2383" data-line-number="2383"></td>

  <td>
    <span data-code-marker=" "><span>uint32_t</span> <span>GetUnsigned32Magic</span>(<span>uint32_t</span> d, <span>bool</span>* add <span><span>/*</span>out<span>*/</span></span>, <span>int</span>* shift <span><span>/*</span>out<span>*/</span></span>)</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2300" data-line-number="2300"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2384" data-line-number="2384"></td>

  <td>
    <span data-code-marker=" ">{</span></td>
</tr>



    <tr data-hunk="d20be7ceecd46d39435e1852d0ef3fed">
    <td id="diff-aab71f0151abd998a27f34a2616bbe5cL2301" data-line-number="2301"></td>

    <td id="diff-aab71f0151abd998a27f34a2616bbe5cR2385" data-line-number="2385"></td>

  <td>
    <span data-code-marker=" ">    <span>return</span> GetUnsignedMagic&lt;<span>uint32_t</span>&gt;(d, add, shift);</span></td>
</tr>



  <tr data-position="">
    <td colspan="2">
          <a href="#diff-aab71f0151abd998a27f34a2616bbe5c" title="Expand Down" aria-label="Expand Down" data-url="/EgorBo/runtime-1/blob_excerpt/d7bad64f6244e51125b5846688dd1db71d7a2910?diff=unified&amp;direction=down&amp;in_wiki_context=&amp;last_left=2301&amp;last_right=2385&amp;left=2551&amp;left_hunk_size=&amp;mode=100644&amp;path=src%2Fcoreclr%2Fsrc%2Fjit%2Futils.cpp&amp;right=2551&amp;right_hunk_size=" data-left-range="2302-2550" data-right-range="2386-2550">
            
          </a>
    </td>
    <td></td>
  </tr>


          </tbody></table>
        </div>

  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>