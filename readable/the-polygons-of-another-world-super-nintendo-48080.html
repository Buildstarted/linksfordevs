<!DOCTYPE html>
<html lang="en">
<head>
    <title>
The polygons of Another World: Super Nintendo - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="The polygons of Another World: Super Nintendo - linksfor.dev(s)"/>
    <meta property="og:description" content="January 19, 2020"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://fabiensanglard.net/another_world_polygons_SNES/index.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - The polygons of Another World: Super Nintendo</title>
<div class="readable">
        <h1>The polygons of Another World: Super Nintendo</h1>
            <div>Reading time: 15-19 minutes</div>
        <div>Posted here: 19 Jan 2020</div>
        <p><a href="http://fabiensanglard.net/another_world_polygons_SNES/index.html">http://fabiensanglard.net/another_world_polygons_SNES/index.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><br><center>
    
</center><p>
January 19, 2020</p><p><b>The polygons of Another World: Super Nintendo</b></p>
 <hr>


<p>
  This article is part of a study about the ports of Another World. It is highly recommended to read <a href="http://fabiensanglard.net/another_world_polygons/index.html">Another World 101</a> before reading this.
</p>    


<p><b>Super Nintendo</b></p><hr>
<div>

     <p><img src="http://fabiensanglard.net/another_world_polygons_SNES/SNES_logo.svg" width="40%">
The Super Fami-Com ("FAMIly COMputer") was released in Japan on November 21, 1990. 
The initial shipment of 300,000 units sold out within hours. The frenzy was such that the government requested Nintendo to release its future systems on weekends to avoid further disturbances.

</p><p>
 It took almost a year for the renamed SNES (Super Nintendo Entertainment System) to reach North America on September 9, 1991. Six months later the much awaited console finally got an European release on April 1992. In North America, 721<a name="back_1" href="#footnote_1"><sup>[1]</sup></a> games<a name="back_2" href="#footnote_2"><sup>[2]</sup></a> were published over the console lifespan, among them several critical and commercial successes such as Super Mario World, Zelda III, Mario Kart, F-Zero, Super Metroid, and Donkey Kong Country.

</p><p>
 Having sold close to 50 million units over its nine-year lifespan (1991-1999), it is one of the most successful and popular consoles of all time.</p><picture>
<source srcset="snes.webp" type="image/webp">
     <img src="http://fabiensanglard.net/another_world_polygons_SNES/snes.png" width="100%">
    </picture>
    <p><span><i><small>The SuperFamicom (Japan), a.k.a Super Nintendo (Rest of the World). Photo credit: Wikipedia.</small></i></span>

    </p></div><p><b>Architecture</b></p><hr>
<div><p>
  The SNES is a departure in this series. All the machines studied so far ran either on a Motorola 68000 or an Intel x86. The SNES's CPU name sounds esoteric but the Ricoh 5A22 is in fact a 6502 on steroids.
         </p><p>
         On the list of enhancements the CPU features 16-bit registers, a DMA unit, a 24-bit address Bus-A, an uncanny second 8-bit address Bus-B (the two buses are used to declare src/dst on DMA transfers), and the ability to generate interrupts on VBLANK and HBLANK.<br>
         <img src="http://fabiensanglard.net/another_world_polygons_SNES/snes_arch.svg" width="100%">
          Even though it seems to benefit from a generous 128 KiB of RAM, the machine appears much less powerful than the Genesis with a weak Ricoh running at 3.58MHz and an equally unimpressive 8-bit data bus. These hardware choices were not unwise since these components were not critical parts of a game. The system instead relies on powerful video (S-PPU) and audio (S-DSP) chips.</p></div> 


<p><b>Video System</b></p><hr>
<div><p>  
  The S-PPU (Picture Processing Unit) is the component in charge of the video system. It was at the time a sprite powerhouse with an impressive color depth allowing 15-bit per pixel and RGB blending between layers.

  </p>
<p><span><i><small>15-bit per pixel color space</small></i></span> 
The S-PPU is in fact made of two chips. The PPU-1 is in charge of deciding what to sample from the VRAM while the PPU-2 converts the bitplanes in VRAM to pixels<a name="back_3" href="#footnote_3"><sup>[3]</sup></a>.


 </p><p>
 Two video resolutions are available on NTSC with the normal 256x224 and a highRes (interlaced 512x448). To accomodate PAL TVs, the console can output respectively 256x239 and 512x478 although developers rarely bothered and often used NTSC resolution on PAL monitors.
 
 </p><p>
Like the Sega Genesis, the video generation revolves around the concept of layers, here called "backgrounds". Depending on the graphic mode, various combination of colors and backgrounds are available.
</p></div>
<pre>Mode       # Colors for BackGround       Resolution (NTSC)       Resolution (PAL)
           1       2      3      4  
=================================================================================
0          4       4      4      4            256x224                256x239
1         16      16      4      -            256x224                256x239
2         16      16      -      -            256x224                256x239
3        256      16      -      -            256x224                256x239
4        256       4      -      -            256x224                256x239
5         16       4      -      -            512x448                512x478
6         16       -      -      -            512x448                512x478
7        256       -      -      -            256x224                256x239    
7EXT     256     128      -      -            256x224                256x239
</pre>
<p>
  Background are made of tiles. For each background, the tile layout is determined by a "Tilemap". Tile dimension is usually 8x8 where pixels are grouped per line per bitplane.
</p>
<pre>4BPP SNES TILE LAYOUT:
======================

      BYTE                BYTE
Line 0 bitplane0    Line 0 bitplane1   
Line 1 bitplane0    Line 1 bitplane1   
       .                    .
       .                    .
Line 7 bitplane0    Line 7 bitplane1 
Line 0 bitplane2    Line 0 bitplane3   
Line 1 bitplane2    Line 1 bitplane3   
       .                    .
       .                    .
Line 7 bitplane2    Line 7 bitplane3                   
</pre>
<p>
  Tiles can also be 16x16 with an even weirder layout but this is a story for an other time.
  Sprites are not used during Another World gameplay and therefore not discussed further.
</p>


<p><b>NTSC vs PAL</b></p><hr>
  <div><p> 
   The resolution chosen for NTSC (256x224) and PAL (256x239) were not randomly chosen. These correspond to a known "action safe area<a name="back_4" href="#footnote_4"><sup>[4]</sup></a>" guaranteed to be visible on a TV screen of the early 90s.
   </p></div>
<blockquote>
  Actual TVs show about 224 lines of the signal, hence the commonly reported 256x224 resolution. But the vertical position may be slightly off center. Emulators and LCD HDTVs tend to use lines 8 to 231, but some TVs have been seen to show lines 12 to 235.<p>- wiki.nesdev.com (Overscan)</p>

</blockquote>
  

   <div><p>
  In the last entry about the Sega Genesis, we glanced over "Sonic, the Hedgehog" less than stellar PAL version. Nintendo did not make the same mistakes with its star title "Super Mario World".
</p><p>
   While most developers used 256x224 which looked good on North American and Japanese TVs but resulted in black vertical borders on PAL TVs, Nintendo made the effort to use 256x239 and reorganize the tilemaps. They also accounted for the 60Hz/50hz refresh rate and made everything move on a 16ms/20ms accordingly to not slow down gameplay on PAL<a name="back_5" href="#footnote_5"><sup>[5]</sup></a>. The work paid off with worldwide full-screen display and similar gameplay embodying Nintendo's commitment to high-quality.</p>
</div><p>
  Notice Nintendo's trick on PAL to fill the two extra 8x8 tile lines at the bottom with an increased "underground" visibility. Borders and text locations were adjusted accordingly. Keep in mind that PAL and NTSC TVs had 4:3 aspect ratio. Once transfered to screen, these tilemap appeared horizontally stretched. 
</p>

<p><b>Another World on Super Nintendo</b></p><hr>
<p>    
 Another World was ported to Super Nintendo by Rebecca Heineman around 1992 for Interplay. She was unable to answer questions before publication of this article. Information was gathered via "Burgertime: Out of This World" and bsnes-plus emulator to look under the hood.<br>

 </p><blockquote>
  We wanted to do Super Nintendo games and Out of This World really was a game we'd like to do. The immediate thought was that the Amiga was as super powerful computer and while the Super Nintendo was powerful it was no Amiga. There was no way we can actually do OotW on SNES, it just couldn't be done.<p>
  
  Well, anybody who's been following my career would know that "It couldn't be done" generally resulted in a "challenge accepted". And a challenge was accepted.
</p><p>- Burgertime: Out of This World</p>
</blockquote>

 <p>
  The conversion seems to have happened on an accelerated Apple 2GS (which conveniently features the same 65C816 as the SNES) connected to SNES via a Sluggo 3 ROM emulator which Rebecca built herself.<br>
   </p><blockquote>
  I took the source code and I ran off to my little office and looked at the code and
realized [...] all I really needed to do [...] was create a interpreter which would run the
scripting language and optimize the hell out of the interpreter in order for
it to run the game.<p>
 It took me about two, three weeks and I sat there doing nothing but translating line by line [...]. 
</p><p>
I looked at the
function of 68k, figure out what
it was really supposed to do, and wrote the
equivalent in 65C816. I did this for every single function until eventually I
had every single function in the game. Sure enough I was running out of this world
on an Apple IIGS! It was running only about 10 frames per second more like 5/10fps on a very accelerated IIGS because I hadn't done any real optimizations.

</p><p>- Burgertime: Out of This World</p>
</blockquote>
<p>
 These were different times. Knowing hardware in order to roll out your own Sluggo 3 devkit<a name="back_6" href="#footnote_6"><sup>[6]</sup></a> and mastering Japanese were invaluable skills back then.
</p>
   <blockquote>
   I then had a
parallel cable going from the Apple IIGS to a Sluggo 3, itself connected to a Super Nintendo. I mostly used this handmade dev kit because interplay was just too cheap to
buy me a official Super Nintendo dev kit.
In fact when we were developing stuff on
the Super Nintendo initially we were
actually victims of xenophobia
from Japan.
<p>
 When we got permission to
start doing Super Nintendo software,
Nintendo gave us their manuals. 

They were all in Japanese and they
told us that it was going to take
anywhere from you know 2 to 6 months
before they got the translations.
</p><p>
日本語を話しますか?<a name="back_7" href="#footnote_7"><sup>[7]</sup></a>, Do you speak Japanese? I do!
</p><p>- Burgertime: Out of This World</p>
</blockquote>

 


<p><b>Overall design</b></p><hr>
  <div>  
    <p><img src="http://fabiensanglard.net/another_world_polygons_SNES/snes.svg"> The architecture of Another World on Super Nintendo is similar to the Genesis. 
    The CPU renders to three local framebuffers located in RAM. When a frame is completed, it is DMA copied<a name="back_8" href="#footnote_8"><sup>[8]</sup></a> to VRAM. To avoid tearing, a double buffer is used in VRAM<a name="back_9" href="#footnote_9"><sup>[9]</sup></a>.
    </p><p>
    The console is setup in mode 1 which has three background but everything happens in Background 1. Every time a new frame is available, the tilemap of the matching double buffer is updated. The framebuffers are faked via 8x8 unique tiles.

</p><p>
    Thanks to the planar layout of its tiles, this version could render alike the Atari ST and cruise with lines segment of 8 pixel written in 4 operations.
</p><p>
     A significant slowdown is the bytecode which was designed with 16-bit registers in mind. The Ricoh has 16-bit registers but its 8-bit data bus made store/load operations twice as slow. Even with DMA pushing all these bytes from RAM to VRAM was a problem. It seems it was an even harder problem to implement COPY opcode.
</p><p>
The solution to both CPU and bandwidth issues were to use only 28x20 out of the 32x28 tiles available. This effectively lowered the resolution from 256x224 to 224x160.
</p></div>


<p><b>Enhancement Chips</b></p><hr>
<div><p>    
Perhaps the most interesting part of this port is the iteration process<a name="back_10" href="#footnote_10"><sup>[10]</sup></a>.
</p><p>
The SNES was based on two powerful chips, a S-PPU and a S-DSP, with a modest CPU as the maestro of the orchestra. 
 To provision for developers with other needs, Nintendo designed the cartridge port carefully. The Bus-A address space (which the cartridge  is connected to) features a reserved section ($6000–$7FFF)<a name="back_11" href="#footnote_11"><sup>[11]</sup></a>. The cartridge port also has a special bus line (/CART) which let the CPU signal when it is accessing the cartridge address space.
</p><p>
  These two features combined allowed developers to ship carts (a.k.a Game Pak) with special chips on-board. These "enhancement" chips monitor bus-A usage and use the reserved memory space to map their registers in order to receive commands from the CPU.

  </p><p>
   This is the feature Rebecca attempted to leverage first in a series of four different revisions.</p><u><b>Attempt 1: Super-FX chip</b></u><br>
</div><blockquote>
   I thought I could get this game running at 60 frames
per second by putting a super FX chip in
there.  I got a copy of Starfox I pull the chip out figured out how
the chip worked and started using it. I had
OotW running at 60fps! I said "hey Brian the game is getting ready
to ship, here's the cartridge I'm gonna
need". 
<p>
He looks at the price list and says "Can you get rid of super FX chip? It's too expensive!".
</p><p>- Burgertime: Out of This World</p>
</blockquote>







<p>
<u><b>Attempt 2: Static RAM</b></u><br>
</p><blockquote>
  I took all the super FX code out and then changed
it over to just software rendering. But there were certain parts of the software
rendering which was running really
really slow. One of them is like I had to
take a full screen background and copy
it to another one. I found this trick
that if I had static memory [WRAM] on the
cartridge I can actually copy that
static memory at super speeds using DMA
and I said "Give me a
cartridge that uses a static memory and
I could get to 30 frames per second".
<p>
And he goes like "That's too expensive!".
</p><p>- Burgertime: Out of This World</p>
</blockquote>




<p>
<u><b>Attempt 3: Fast cartridge (3.58Mhz)</b></u><br>
  </p><blockquote>
  So with no battery backed up
RAM, we're gonna have to save the game with little entry code [...]. When you get to a certain level it says here is your code [...] you write it down to a piece of paper
and that's how you save your games.
<p>
Okay, no super FX chip, no battery backed
up ram alright, I did make it so that  I
could get the software running again to
run at about 30 frames per second if of
course I'm using a fast cartridge
because cartridges at the time you could
buy them either 2.68Mhz [SlowROM] or 3.58Mhz [FastROM<a name="back_12" href="#footnote_12"><sup>[12]</sup></a>].
</p><p>
To give you an idea, the SNES actually runs a
3.6Mhz. It's a pretty fast chip for the time but the ROMs that
run at that speed costs a little bit
more that roms that run at a slower speed.
</p><p>
Using a 3.6Mhz ROM you know my dev kit can ran and go to run at 10Mhz so it was no problem for you just to set the switch to run to dev kit I got it running really fast frame rate so it's looking good ready. Then Fargo comes out he said "Can you use the slower ROM it'll save 50 cents a cartridge.".

</p><p>- Burgertime: Out of This World</p>
</blockquote>


<p>
<u><b>Attempt 4: Slow cartridge (2.68 Mhz)</b></u><br>
</p><blockquote>
  Forced to use a slowROM, I found out that the game
would run at best 20 frames per second. I tried little stunts like letterboxing
the game, making it look like a movie
but I'm actually rendering less which up
the framerate but it wasn't quite
getting it.

<p>
 How the hell am I
going to get this thing to run as fast
as I want? Then it dawned on me the DMA
registers in the SNES that I'm not using are sitting there. After reading the
technical specs very carefully in Japanese I came to come to find
out that those memory registers actually runs the full CPU 3.6Mhz speed.
</p><p>
The hardware registers are essentially
values you could just write into and
read into. There was about 32 bytes of memory that
are used as registers but as long as you
don't actually use them, you
just put values in and read them back.
</p><p>
I put a 32 byte function that would draw a scanline of polygon data in there. I had a 10% speed improvement
and I got my frames per second.
</p><p>
Of course emulator authors later
on would hate my guts. "Why is
it that this cartridge doesn't run on my
emulator?".

</p><p>- Burgertime: Out of This World</p>
</blockquote>

 


<p><b>More about PAL/NTSC and aspect ratio</b></p><hr>
<p> 
 With a limited development time window, Another World on PAL system did not benefit of a special horizontal makeover. The PAL version of the game shipped with the same tile resolution as the NTSC version.<br>
     
Factoring in the 4:3 aspect ratio of tilemap to TV conversion, we see that the PAL version has an aspect ratio of 1.74 while NTSC has an aspect ratio of 1.6299. Both are very close to the intended 1.666 ratio.
     
</p>





<p><b>Colors and Resolution</b></p><hr>
<p> 
  
    
    Compared to the Genesis and Amiga, the SNES was a lower resolution but the result still looks impressively good.<br>
    <img src="http://fabiensanglard.net/another_world_polygons_SNES/lester_snes.png" width="100%" id="lester_hi">
  

  </p>
<p>
Thanks to the 15-bit color depth, the colors on SNES are an exact conversion of the Amiga 12-bit colors. The facial expression on Lester were not altered which may mean the Genesis conversion was done after the SNES with special artwork requested to Eric Chahi. 
</p>

<p><b>Verdict</b></p><hr>
<p>The Creator expressed how he felt about the SNES port. Therefore I will not elaborate on it.<br>
</p><blockquote>
I have a print of the cover of "Out Of This World".
It is signed by Eric Chahi and it says in French "Congratulations
for the completion and the shipping of
the Super Nintendo version of out of
this world". He gave me that painting already framed [...] and I'm like "oh my god thank you very much". It's been hanging on my wall ever since.
<p>- Burgertime: Out of This World</p>
</blockquote>



<p><b>References</b></p><hr><p id="paperbox"><table><tbody><tr><td><a name="footnote_1"></a><a href="#back_1">^</a></td><td> [ 1]</td><td>Comment:</td><td>721 in North America, 517 in Europe, 1,448 in Japan, 231 on Satellaview, and 13 on Sufami Turbo for a grand total of 1757 titles.</td></tr><tr><td><a name="footnote_2"></a><a href="#back_2">^</a></td><td> [ 2]</td><td>Source&nbsp;:</td><td><a href="https://en.wikipedia.org/wiki/List_of_Super_Nintendo_Entertainment_System_games">Wikipedia, SNES games</a></td></tr><tr><td><a name="footnote_3"></a><a href="#back_3">^</a></td><td> [ 3]</td><td>Source&nbsp;:</td><td><a href="https://wiki.superfamicom.org/schematics-ports-and-pinouts">SNES Schematics, Ports, and Pinouts
</a></td></tr><tr><td><a name="footnote_4"></a><a href="#back_4">^</a></td><td> [ 4]</td><td>Source&nbsp;:</td><td><a href="https://wiki.nesdev.com/w/index.php/Overscan">Overscan</a></td></tr><tr><td><a name="footnote_5"></a><a href="#back_5">^</a></td><td> [ 5]</td><td>Source&nbsp;:</td><td><a href="https://smwspeedruns.com/Version_Differences">Super Mario World Wiki:  Version Differences</a></td></tr><tr><td><a name="footnote_6"></a><a href="#back_6">^</a></td><td> [ 6]</td><td>Source&nbsp;:</td><td><a href="https://wiki.superfamicom.org/sluggo-iii">Apple II RoundTable: Sluggo III</a></td></tr><tr><td><a name="footnote_7"></a><a href="#back_7">^</a></td><td> [ 7]</td><td>Comment:</td><td>Nihongo wo hanashimasuka? which actually means 'Do you speak Japanese?'. Thanks to   
an_ko@news.ycombinator.com for the explanation.</td></tr><tr><td><a name="footnote_8"></a><a href="#back_8">^</a></td><td> [ 8]</td><td>Source&nbsp;:</td><td><a href="http://fabiensanglard.net/another_world_polygons_SNES/dma_traces.png">BSnes Plus Debugger</a></td></tr><tr><td><a name="footnote_9"></a><a href="#back_9">^</a></td><td> [ 9]</td><td>Source&nbsp;:</td><td><a href="http://fabiensanglard.net/another_world_polygons_SNES/tile_viewer.png">BSnes Plus Tileviewer screenshot</a></td></tr><tr><td><a name="footnote_10"></a><a href="#back_10">^</a></td><td> [10]</td><td>Source&nbsp;:</td><td><a href="https://www.youtube.com/watch?v=tiq0OL8rzso">Burgertime 8/9/2015: Out of This World</a></td></tr><tr><td><a name="footnote_11"></a><a href="#back_11">^</a></td><td> [11]</td><td>Source&nbsp;:</td><td><a href="https://en.wikibooks.org/wiki/Super_NES_Programming/SNES_memory_map#LoROM">RESERVED (enhancement chips memory)</a></td></tr><tr><td><a name="footnote_12"></a><a href="#back_12">^</a></td><td> [12]</td><td>Source&nbsp;:</td><td><a href="https://www.mkelly.me/sno/docs/milestone1/design_doc.pdf">SNO SNES SlowROM vs FastROM</a></td></tr></tbody></table></p> <hr>
 <center>*</center></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>