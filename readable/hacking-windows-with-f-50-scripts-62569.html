<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Hacking Windows with F# 5.0 Scripts - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Hacking Windows with F# 5.0 Scripts - linksfor.dev(s)"/>
    <meta property="article:author" content="Angel D. Munoz"/>
    <meta property="og:description" content="Hello everyone, today I bring you some F# 5.0 preview niceties FSharp Conf was last Friday (June 5th,... Tagged with winrt, fsharp, dotnet, windows."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://dev.to/tunaxor/hacking-windows-with-f-5-0-scripts-4k2o"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Hacking Windows with F# 5.0 Scripts</title>
<div class="readable">
        <h1>Hacking Windows with F# 5.0 Scripts</h1>
            <div>by Angel D. Munoz</div>
            <div>Reading time: 13-17 minutes</div>
        <div>Posted here: 08 Jun 2020</div>
        <p><a href="https://dev.to/tunaxor/hacking-windows-with-f-5-0-scripts-4k2o">https://dev.to/tunaxor/hacking-windows-with-f-5-0-scripts-4k2o</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="article-show-container" data-author-id="35800" data-path="/tunaxor/hacking-windows-with-f-5-0-scripts-4k2o" data-published="true">
    <article>
      <section>
          <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--XKgsdwdV--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://res.cloudinary.com/practicaldev/image/fetch/s--cK00WcZ0--/c_imagga_scale%2Cf_auto%2Cfl_progressive%2Ch_420%2Cq_auto%2Cw_1000/https://dev-to-uploads.s3.amazonaws.com/i/w8y4af5lz2tseykc6kye.png" alt="Cover image for Hacking Windows with F# 5.0 Scripts">
      </section>
      <header id="main-title">
        
        <h3>
          <span>
            
          </span>
            <a href="http://twitter.com/Daniel_Tuna"><img alt="twitter logo" width="18" height="18" src="https://practicaldev-herokuapp-com.freetls.fastly.net/assets/twitter-logo-fe34f4c4c24dabe47c2b59aeb1397d6ae56b0501a1320f20ac523dd84230d789.svg"></a>
            <a href="http://github.com/AngelMunoz"><img alt="github logo" width="18" height="18" src="https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-28d89282e0daa1e2496205e2f218a44c755b0dd6536bbadf5ed5a44a7ca54716.svg"></a>
            <time datetime="2020-06-06T04:22:15Z" title="Friday, June 5, 2020, 9:22:15 PM">Jun  6</time>
          <span>・6 min read</span>
        </h3>
          
      </header>
      <div data-article-id="350198" id="article-body">
        <p>Hello everyone, today I bring you some F# 5.0 preview niceties <a href="http://fsharpconf.com/">FSharp Conf</a> was last Friday (June 5th, 2020) and there were many many awesome #fsharp talks 100% recommended, if you are into web development there are a couple of talks for you:</p>

<ul>
<li>SAFE Stack – The Road Ahead - Isaac Abraham</li>
<li>From Zero to F# Hero - James Randal</li>
</ul>

<p>That being said... today's content post is little different I'll talk about the nuget package references for F# scripts (fsx files), you can read more about the new F# 5.0 features <a href="https://devblogs.microsoft.com/dotnet/announcing-f-5-preview-1/">here</a>.</p>

<p>In the past if you wanted to script with F# you needed to have the library code downloaded and reference the dll file directly<br>
</p>

<div><pre><code><span>#</span><span>r</span> <span>"../libs/MyLib.dll"</span>
<span>open</span> <span>MyLib</span>
<span>/// do code with MyLib</span>
</code></pre></div>


<p>F# 5.0 is introducing the <code>nuget</code> references now if you want to reference a library it's pretty simple for example<br>
</p>
<div><pre><code><span>#</span><span>r</span> <span>"nuget: Newtonsoft.Json"</span>
<span>open</span> <span>Newtonsoft</span><span>.</span><span>Json</span>

<span>let</span> <span>o</span> <span>=</span> <span>{|</span> <span>X</span> <span>=</span> <span>2</span><span>;</span> <span>Y</span> <span>=</span> <span>"Hello"</span> <span>|}</span>

<span>printfn</span> <span>"%s"</span> <span>(</span><span>JsonConvert</span><span>.</span><span>SerializeObject</span> <span>o</span><span>)</span>
</code></pre></div>


<p>that will download the Nuwtonsoft.Json package (in a transparent way for the user) and add the referenced library, after that you will be able to open any namespaces that the library provides.</p>

<p>I feel that gives you a better experience when you want to create some scripts either for quick usage, prototyping or even API exploration as we will see.</p>

<p>Recently Microsoft released a new nuget package: <code>Microsoft.Windows.Sdk.NET</code> which exposes in a pretty nice way the native WinRT API's from Windows. The same API's you would use from UWP Apps the most modern stuff is in there <br>
</p>
<div>
  
  <div>
    
<div id="readme" data-path="README.md"><article itemprop="text"><p><a href="https://dev.azure.com/microsoft/Dart/_build/latest?definitionId=45187" rel="nofollow"><img src="https://camo.githubusercontent.com/5cc573e522a856e7b698eb4358d562486697eeb9/68747470733a2f2f6465762e617a7572652e636f6d2f6d6963726f736f66742f446172742f5f617069732f6275696c642f7374617475732f637377696e72742532304e75676574" alt="Build status" data-canonical-src="https://dev.azure.com/microsoft/Dart/_apis/build/status/cswinrt%20Nuget"></a></p>

<p>See also:</p>
<ul>
<li>Documentation: <a href="http://aka.ms/cswinrt" rel="nofollow">http://aka.ms/cswinrt</a>
</li>
<li>NuGet package: <a href="http://aka.ms/cswinrt/nuget" rel="nofollow">http://aka.ms/cswinrt/nuget</a>
</li>
</ul>
<p>C#/WinRT provides Windows Runtime (WinRT) projection support for the C# language. A "projection" is an adapter that enables programming the WinRT APIs in a natural and familiar way for the target language. For example, the C#/WinRT projection hides the details of interop between C# and WinRT interfaces, and provides mappings of many WinRT types to appropriate .NET equivalents, such as strings, URIs, common value types, and generic collections.</p>
<p>WinRT APIs are defined in <code>*.winmd</code> format, and C#/WinRT includes tooling that generates .NET Standard 2.0 C# code that can be compiled into interop assemblies, similar to how <a href="https://github.com/Microsoft/cppwinrt">C++/WinRT</a> generates headers for the C++ language projection. This means that neither the C# compiler nor the .NET Runtime require built-in knowledge of WinRT any longer.</p>
<p>C#/WinRT is part of the <a href="https://github.com/microsoft/xlang">xlang</a> family of projects that help developers create APIs that can run…</p></article></div>
  </div>
  
</div>



<p>I've done some WinRT stuff in the past with UWP applications and I have always felt that the WinRT API is just so nice to work with and remembering that everything you do with it is 100% native.</p>

<h3>
  <a name="what-can-you-do-with-the-winrt-projection" href="#what-can-you-do-with-the-winrt-projection">
  </a>
  What can you do with the WinRT projection?
</h3>

<p>Anything that does not require some sort of UI, if you want to use an API that requires a CoreWindow or that it executes on the UI thread then you would need to implement some interfaces for your application as noted <a href="https://github.com/microsoft/CsWinRT/issues/287#issuecomment-632391358">here</a> everything else that is UI-less is good to go, and as an example: In this repository I made a small Avalonia App that leverages the WinRT API. It includes examples for the following API's</p>

<ul>
<li>Windows.Media</li>
<li>Windows.Networking</li>
<li>Windows.System.Power
<div>
  <div>
    <h2>
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--vWogaON8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://practicaldev-herokuapp-com.freetls.fastly.net/assets/github-logo-28d89282e0daa1e2496205e2f218a44c755b0dd6536bbadf5ed5a44a7ca54716.svg" alt="GitHub logo" loading="lazy">
      <a href="https://github.com/AngelMunoz">
        AngelMunoz
      </a> / <a href="https://github.com/AngelMunoz/WinRTFs">
        WinRTFs
      </a>
    </h2>
    <h3>
      A small showcase of some of the WinRT APIs that can be used thanks t the C#/WinRT projection https://github.com/microsoft/CsWinRT
    </h3>
  </div>
  <div>
    
<div id="readme" data-path="README.md"><article itemprop="text">
<p>In the last build event (May 2020) one project was shown <a href="https://github.com/microsoft/CsWinRT">C#/WinRT</a> which is a projection of the WinRT API over C#, this projection is compatible with .netstandard2.0 and .net5 (once it's released). This is not the first time an attempt to expose the WinRT API to Win32 apps has been made, the last one was <a href="https://www.nuget.org/packages/Microsoft.Windows.SDK.Contracts" rel="nofollow">SDK Contracts</a> and while you could use most of the WinRT APIs it had some limitations around certain APIs like Bluetooth and if you were an F#'er like me, you were in bad luck because the SDK Contracts didn't even allow your project to compile that stuff is now past and the next iteration (which I believe is a better take) is here.</p>
<p>The projection is also available for <a href="https://github.com/microsoft/cppwinrt">C++</a>, <a href="https://github.com/microsoft/winrt-rs">Rust</a> and <a href="https://github.com/microsoft/xlang/tree/master/src/package/pywinrt/projection">Python</a>.</p>

<p>Check the <a href="https://raw.githubusercontent.com/AngelMunoz/WinRTFs/master/Core">Core</a> project where I tried to put most of the WinRT API code</p>
<ul><li>…</li></ul></article></div>
  </div>
  
</div>
</li>
</ul>

<p>And... after half day reading... Finally some code.</p>

<p>The first Example is a small gist that uses the <br>
<code>Windows.Storage</code> API to take 5 files from the the user's music library and check the its music properties.</p>


<div>
  <div id="gist103552494">
    <div>
      <div>
        <div>
  <div id="file-inspect-music-properties-fsx">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-inspect-music-properties-fsx-L1" data-line-number="1"></td>
        <td id="file-inspect-music-properties-fsx-LC1">#r <span><span>"</span>nuget: Microsoft.Windows.Sdk.NET, 10.0.18362.3-preview<span>"</span></span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L2" data-line-number="2"></td>
        <td id="file-inspect-music-properties-fsx-LC2">
</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L3" data-line-number="3"></td>
        <td id="file-inspect-music-properties-fsx-LC3"><span>open</span> <span>System</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L4" data-line-number="4"></td>
        <td id="file-inspect-music-properties-fsx-LC4"><span>open</span> <span>Windows.<span>Storage</span></span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L5" data-line-number="5"></td>
        <td id="file-inspect-music-properties-fsx-LC5">
</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L6" data-line-number="6"></td>
        <td id="file-inspect-music-properties-fsx-LC6"><span>let</span> <span>asyncGetFiles</span><span>()</span> <span>=</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L7" data-line-number="7"></td>
        <td id="file-inspect-music-properties-fsx-LC7">  <span>async {</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L8" data-line-number="8"></td>
        <td id="file-inspect-music-properties-fsx-LC8">    <span>let!</span> <span>files</span> <span>=</span> KnownFolders.MusicLibrary.GetFilesAsync<span>()</span>.AsTask<span>()</span> <span>|&gt;</span> Async.AwaitTask</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L9" data-line-number="9"></td>
        <td id="file-inspect-music-properties-fsx-LC9">    <span>return</span> files <span>|&gt;</span> Seq.take <span>5</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L10" data-line-number="10"></td>
        <td id="file-inspect-music-properties-fsx-LC10">  <span>}</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L11" data-line-number="11"></td>
        <td id="file-inspect-music-properties-fsx-LC11">
</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L12" data-line-number="12"></td>
        <td id="file-inspect-music-properties-fsx-LC12"><span>async {</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L13" data-line-number="13"></td>
        <td id="file-inspect-music-properties-fsx-LC13">  <span>let!</span> <span>files</span> <span>=</span> asyncGetFiles<span>()</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L14" data-line-number="14"></td>
        <td id="file-inspect-music-properties-fsx-LC14">  <span>for</span> file <span>in</span> files <span>do</span></td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L15" data-line-number="15"></td>
        <td id="file-inspect-music-properties-fsx-LC15">    <span>let!</span> <span>musicProps</span> <span>=</span> file.Properties.GetMusicPropertiesAsync<span>()</span>.AsTask<span>()</span> <span>|&gt;</span> Async.AwaitTask</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L16" data-line-number="16"></td>
        <td id="file-inspect-music-properties-fsx-LC16">    printfn <span><span>"</span>%s - %s<span>"</span></span> musicProps.Title musicProps.Album</td>
      </tr>
      <tr>
        <td id="file-inspect-music-properties-fsx-L17" data-line-number="17"></td>
        <td id="file-inspect-music-properties-fsx-LC17"><span>}</span> <span>|&gt;</span> Async.RunSynchronously</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>

</div>


<p>the code is very short and is async heavy the reason for that is there are a lot of Async APIs in WinRT and here's Larry Osterman explaining why<br>
</p>
<blockquote data-url="https://twitter.com/windowsdocs/status/1088118104369049601">
      

  <div data-url="https://twitter.com/windowsdocs/status/1088118104369049601">
    
    <div><p>
      ICYMI - Here's the first video we did with Larry @Osterman, when he explained why so many Windows Runtime APIs were async.</p><p>More videos coming from Larry soon!</p><p><a href="https://twitter.com/hashtag/Windows10">#Windows10</a></p></div>
    <p>
      16:55 PM - 23 Jan 2019
    </p>


    <p><a href="https://twitter.com/intent/tweet?in_reply_to=1088118104369049601">
        <img src="https://dev.to/assets/twitter-reply-action.svg" alt="Twitter reply action" loading="lazy">
      </a>
      <a href="https://twitter.com/intent/retweet?tweet_id=1088118104369049601">
        <img src="https://dev.to/assets/twitter-retweet-action.svg" alt="Twitter retweet action" loading="lazy">
      </a>
      4
      <a href="https://twitter.com/intent/like?tweet_id=1088118104369049601">
        <img src="https://dev.to/assets/twitter-like-action.svg" alt="Twitter like action" loading="lazy">
      </a>
      17
    </p>
  </div>
</blockquote>


<p>Fortunately the System namespace includes a nice extension method that converts an IAsyncAction to a usual Task, then we use some F# Async functions to make it work seamlessly in F#.<br>
</p>

<div><pre><code><span>KnownFolders</span>
    <span>.</span><span>MusicLibrary</span>
    <span>.</span><span>GetFilesAsync</span><span>()</span>
    <span>.</span><span>AsTask</span><span>()</span> <span>|&gt;</span> <span>Async</span><span>.</span><span>AwaitTask</span>
</code></pre></div>


<p>Here we use the MusicLibrary IStorageFolder to get its files in a very simple way the <code>IStorageFolder</code> contains some nice properties and methods that we can leverage to either create/delete/update new files or directories<br>
</p>
<div><pre><code><span>for</span> <span>file</span> <span>in</span> <span>files</span> <span>do</span>
    <span>file</span>
        <span>.</span><span>Properties</span>
        <span>.</span><span>GetMusicPropertiesAsync</span><span>()</span>
        <span>.</span><span>AsTask</span><span>()</span> <span>|&gt;</span> <span>Async</span><span>.</span><span>AwaitTask</span>
</code></pre></div>


<p>In this one, we just iterate over the files to read properties on each of them you can read more about the <code>StorageFile</code> type <a href="https://docs.microsoft.com/en-us/uwp/api/windows.storage.storagefile?view=winrt-19041#methods">here</a></p>

<p>And that's it. The WinRT API is at your fingertips reach now available with F#!</p>

<p>For the Full reference on these API's you can check this link</p>

<p><a href="https://docs.microsoft.com/en-us/uwp/api/">https://docs.microsoft.com/en-us/uwp/api/</a></p>


<p>What about a terminal music player prototype?<br>
As noted here...<br>
</p>
<blockquote data-url="https://twitter.com/daniel_tuna/status/1269052899910389762">
      <p><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--Q-rHAvj9--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://pbs.twimg.com/media/EZyUBhgXsAIf3-L.jpg" alt="unknown tweet media content" loading="lazy">
      </p>

  <div data-url="https://twitter.com/daniel_tuna/status/1269052899910389762">
    
    <p>
      I guess I should have been more confident and try to make a talk for <a href="https://twitter.com/hashtag/fsharpconf"></a><a href="https://twitter.com/hashtag/fsharp">#fsharp</a>conf<br>this would have been a nice title "Hacking the WinRT API with F#"<br>This produces a 100% Windows Native and simple audio player in less than 50 LoC <br><a href="https://twitter.com/hashtag/fsharp">#fsharp</a> 
    </p>
    <p>
      23:46 PM - 05 Jun 2020
    </p>


    <p><a href="https://twitter.com/intent/tweet?in_reply_to=1269052899910389762">
        <img src="https://dev.to/assets/twitter-reply-action.svg" alt="Twitter reply action" loading="lazy">
      </a>
      <a href="https://twitter.com/intent/retweet?tweet_id=1269052899910389762">
        <img src="https://dev.to/assets/twitter-retweet-action.svg" alt="Twitter retweet action" loading="lazy">
      </a>
      0
      <a href="https://twitter.com/intent/like?tweet_id=1269052899910389762">
        <img src="https://dev.to/assets/twitter-like-action.svg" alt="Twitter like action" loading="lazy">
      </a>
      3
    </p>
  </div>
</blockquote>
<p>
you can actually write a PoC of a media player in less than 50 LoC with F#!<br>
If you add some lines for the <code>System Media Transport Controls</code> (the ones that give you info when you turn up/down the volume, change or play/pause the song) and input management, you can actually write a better PoC in less than 100 LoC

</p><blockquote>
<p>To run this sample type <br>
<code>dotnet fsi --langversion:preview media-player.fsx</code><br>
(or whatever the name of the file is), also don't forget to download <a href="https://dotnet.microsoft.com/download/dotnet/5.0">.net5 preview</a></p>
</blockquote>






<p>Let's go bit by bit<br>
</p>

<div><pre><code><span>#</span><span>r</span> <span>"nuget: Microsoft.Windows.Sdk.NET, 10.0.18362.3-preview"</span>

<span>open</span> <span>System</span>

<span>open</span> <span>Windows</span><span>.</span><span>Media</span>
<span>open</span> <span>Windows</span><span>.</span><span>Media</span><span>.</span><span>Core</span>
<span>open</span> <span>Windows</span><span>.</span><span>Media</span><span>.</span><span>Playback</span>

<span>open</span> <span>Windows</span><span>.</span><span>Storage</span>
<span>open</span> <span>Windows</span><span>.</span><span>Storage</span><span>.</span><span>FileProperties</span>
<span>open</span> <span>Windows</span><span>.</span><span>Storage</span><span>.</span><span>Search</span>
<span>open</span> <span>Windows</span><span>.</span><span>Storage</span><span>.</span><span>Streams</span>
</code></pre></div>



<p>Nothing fancy so far, we are just opening the namespaces that contain the types and classes we will use along the way<br>
</p>

<div><pre><code><span>let</span> <span>asyncGetFiles</span> <span>()</span> <span>=</span>
    <span>async</span> <span>{</span>
        <span>let</span> <span>queryOpts</span> <span>=</span> <span>QueryOptions</span><span>()</span>
        <span>queryOpts</span><span>.</span><span>FileTypeFilter</span><span>.</span><span>Add</span><span>(</span><span>".mp3"</span><span>)</span>

        <span>let</span> <span>query</span> <span>=</span>
            <span>KnownFolders</span><span>.</span><span>MusicLibrary</span><span>.</span><span>CreateFileQueryWithOptions</span><span>(</span><span>queryOpts</span><span>)</span>

        <span>let</span><span>!</span> <span>files</span> <span>=</span> <span>query</span><span>.</span><span>GetFilesAsync</span><span>()</span><span>.</span><span>AsTask</span><span>()</span> <span>|&gt;</span> <span>Async</span><span>.</span><span>AwaitTask</span>
        <span>return</span> <span>files</span> <span>|&gt;</span> <span>Seq</span><span>.</span><span>take</span> <span>5</span>
    <span>}</span>

</code></pre></div>



<p>Here we define the function <code>asyncGetFiles</code> inside we do a query to get only <code>.mp3</code> files also the <a href="https://docs.microsoft.com/en-us/uwp/api/windows.storage.search?view=winrt-19041">Windows.Storage.Search</a> API contains some nice classes to create complex queries on files as well as give you a number of ways to present that information to you.</p>

<p>Like in our first example we get the files from the music library in an asynchronous way. Since this is a prototype we just take 5 but we could bring the entire in a single trip if we wanted to.</p>

<p>The next section is quite large so I'll add the explanation as comments as we go by<br>
</p>

<div><pre><code><span>let</span> <span>asyncGetPlaylist</span> <span>=</span>
    <span>async</span> <span>{</span>
        <span>let</span><span>!</span> <span>files</span> <span>=</span> <span>asyncGetFiles</span> <span>()</span>
        <span>/// create a new media playlist</span>
        <span>/// this will be the source for our player later on</span>
        <span>let</span> <span>playlist</span> <span>=</span> <span>MediaPlaybackList</span><span>()</span>
        <span>for</span> <span>item</span> <span>in</span> <span>files</span> <span>do</span>
            <span>let</span><span>!</span> <span>thumbnail</span> <span>=</span>
               <span>item</span>
                   <span>.</span><span>GetThumbnailAsync</span><span>(</span><span>ThumbnailMode</span><span>.</span><span>MusicView</span><span>)</span>
                   <span>.</span><span>AsTask</span><span>()</span> <span>|&gt;</span> <span>Async</span><span>.</span><span>AwaitTask</span>
            <span>let</span><span>!</span> <span>musicProps</span> <span>=</span>
                <span>item</span>
                    <span>.</span><span>Properties</span>
                    <span>.</span><span>GetMusicPropertiesAsync</span><span>()</span>
                    <span>.</span><span>AsTask</span><span>()</span> <span>|&gt;</span> <span>Async</span><span>.</span><span>AwaitTask</span>
            <span>/// let's create a media source for each file we found</span>
            <span>let</span> <span>source</span> <span>=</span> <span>MediaSource</span><span>.</span><span>CreateFromStorageFile</span> <span>item</span>
            <span>/// create the items from the sources</span>
            <span>let</span> <span>mediaPlaybackItem</span> <span>=</span> <span>MediaPlaybackItem</span> <span>source</span>
            <span>/// this part is important only if you want a nice</span>
            <span>/// integration with the OS, but is not really necessary</span>
            <span>let</span> <span>props</span> <span>=</span> <span>mediaPlaybackItem</span><span>.</span><span>GetDisplayProperties</span><span>()</span>
            <span>props</span><span>.</span><span>Type</span> <span>&lt;-</span> <span>MediaPlaybackType</span><span>.</span><span>Music</span>
            <span>props</span><span>.</span><span>MusicProperties</span><span>.</span><span>Title</span> <span>&lt;-</span> <span>musicProps</span><span>.</span><span>Title</span>
            <span>props</span><span>.</span><span>MusicProperties</span><span>.</span><span>AlbumArtist</span> <span>&lt;-</span> <span>musicProps</span><span>.</span><span>AlbumArtist</span>
            <span>props</span><span>.</span><span>MusicProperties</span><span>.</span><span>AlbumTitle</span> <span>&lt;-</span> <span>musicProps</span><span>.</span><span>Album</span>
            <span>props</span><span>.</span><span>MusicProperties</span><span>.</span><span>Artist</span> <span>&lt;-</span> <span>musicProps</span><span>.</span><span>Artist</span>
            <span>props</span><span>.</span><span>MusicProperties</span><span>.</span><span>TrackNumber</span> <span>&lt;-</span> <span>musicProps</span><span>.</span><span>TrackNumber</span>
            <span>props</span><span>.</span><span>Thumbnail</span> <span>&lt;-</span> <span>RandomAccessStreamReference</span><span>.</span><span>CreateFromStream</span> <span>thumbnail</span>
            <span>/// once you have set the properties don't forget to apply them</span>
            <span>/// otherwise these will not show in the SMTC</span>
            <span>/// (System Media Transport Controls)</span>
            <span>mediaPlaybackItem</span><span>.</span><span>ApplyDisplayProperties</span><span>(</span><span>props</span><span>)</span>
            <span>/// finally add the mediaplayback item to the playlist</span>
            <span>playlist</span><span>.</span><span>Items</span><span>.</span><span>Add</span> <span>mediaPlaybackItem</span>
        <span>return</span> <span>playlist</span>
    <span>}</span>

</code></pre></div>



<p>Now, it may seem convoluted having to create a source for the item then a source for the playback item then adding it to the playlist but here's the cool thing they are abstractions that will allow you to control the playlist and the player in an easy way without worrying what is the actual source of the media you will play, because you can play physical Video, Music, and even Streams the source can be in your hard drive or can come from the internet the API is pretty flexible.<br>
</p>

<div><pre><code><span>let</span> <span>player</span> <span>=</span> <span>new</span> <span>MediaPlayer</span><span>()</span>

<span>async</span> <span>{</span>
    <span>let</span><span>!</span> <span>playlist</span> <span>=</span> <span>asyncGetPlaylist</span>
    <span>player</span><span>.</span><span>Source</span> <span>&lt;-</span> <span>playlist</span>
    <span>player</span><span>.</span><span>Play</span><span>()</span>
<span>}</span>
<span>|&gt;</span> <span>Async</span><span>.</span><span>RunSynchronously</span>
</code></pre></div>



<p>This part is pretty simple I believe, just get the playlist, assign it to the player, then start playing.</p>

<p>The rest it's just to be able to change songs and pause/play by reading keystrokes<br>
</p>

<div><pre><code><span>let</span> <span>hmsg</span> <span>=</span> <span>"Press q to quit, up arrow to play or pause and arrows to move previous or next"</span>
<span>printfn</span> <span>"%s"</span> <span>hmsg</span>
<span>let</span> <span>mutable</span> <span>key</span><span>:</span> <span>ConsoleKeyInfo</span> <span>=</span> <span>Console</span><span>.</span><span>ReadKey</span><span>()</span>
<span>let</span> <span>playlist</span> <span>=</span> <span>player</span><span>.</span><span>Source</span> <span>:?&gt;</span> <span>MediaPlaybackList</span>

<span>while</span> <span>key</span><span>.</span><span>Key</span> <span>&lt;&gt;</span> <span>ConsoleKey</span><span>.</span><span>Q</span> <span>do</span>
    <span>match</span> <span>key</span><span>.</span><span>Key</span> <span>with</span>
    <span>|</span> <span>ConsoleKey</span><span>.</span><span>RightArrow</span> <span>-&gt;</span>
        <span>playlist</span><span>.</span><span>MoveNext</span><span>()</span> <span>|&gt;</span> <span>ignore</span>
    <span>|</span> <span>ConsoleKey</span><span>.</span><span>LeftArrow</span> <span>-&gt;</span>
        <span>playlist</span><span>.</span><span>MovePrevious</span><span>()</span> <span>|&gt;</span> <span>ignore</span>
    <span>|</span> <span>ConsoleKey</span><span>.</span><span>UpArrow</span> <span>-&gt;</span>
        <span>match</span> <span>player</span><span>.</span><span>CurrentState</span> <span>with</span>
        <span>|</span> <span>MediaPlayerState</span><span>.</span><span>Paused</span> <span>-&gt;</span> <span>player</span><span>.</span><span>Play</span><span>()</span>
        <span>|</span> <span>MediaPlayerState</span><span>.</span><span>Playing</span> <span>-&gt;</span> <span>player</span><span>.</span><span>Pause</span><span>()</span>
        <span>|</span> <span>_</span> <span>-&gt;</span> <span>()</span>
    <span>|</span> <span>ConsoleKey</span><span>.</span><span>H</span> <span>-&gt;</span> <span>printfn</span> <span>"</span><span>
</span><span>%s"</span> <span>hmsg</span>
    <span>|</span> <span>_</span> <span>-&gt;</span> <span>()</span>
    <span>key</span> <span>&lt;-</span> <span>Console</span><span>.</span><span>ReadKey</span><span>()</span>

<span>player</span><span>.</span><span>Dispose</span><span>()</span>
<span>exit</span><span>(</span><span>0</span><span>)</span>
</code></pre></div>



<p>when you have a player in memory you will be only able to Play/Pause if you want to stop completely you need to dispose the player <br>
<code>player.Dispose()</code> that will also release the SMTC integration you may have had added.</p>

<p>This is a prototype that if you feel confident enough you may even be able to just copy paste the functions into a console application with a few more tweaks and you have a terminal player MVP if you want to go crossp-platform you may want to use <a href="https://code.videolan.org/videolan/LibVLCSharp">LibVLCSharp</a> instead 😁</p>



<p>So... Yeah! using F# 5.0 scripts to prototype and explore API's is a blessing. Once F#5.0 is GA (Generaly Available) you could also set a few snippets of code to showcase how simple is to use F# to do complex things (like some of the stuff you can do with the WinRT API) if you want to get some of your Colleagues to adopt F#</p>

<p>If you have any doubts/comments please feel free to write them below or to ping me on twitter 😁 thanks for the time you spent here.</p>


      </div>
      
      <div id="html-variant-article-show-below-article" data-variant-id="326">
        

<div>

  <h2>You're one click away</h2>
  
  <h3><a href="https://dev.to/enter">Join DEV Now</a></h3>

  <p>Open source</p>
  <p>Free forever</p>
  <p>Level up every day</p>
  <p>🤯</p>
</div>
      </div>

    </article>
        <div id="about-the-author">
  <p><a href="https://dev.to/tunaxor">
      <img src="https://res.cloudinary.com/practicaldev/image/fetch/s--htu0Bj74--/c_fill,f_auto,fl_progressive,h_180,q_auto,w_180/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/35800/4a401302-d733-4f81-87a1-09b5f88c2279.jpeg" alt="tunaxor profile">
    </a>
  </p>
  <div>
    <h4><a href="https://dev.to/tunaxor">Angel D. Munoz</a></h4>
    <p>I'm a Mexican dude, tacos and stuff.
In a crush with F# |&gt; ❤
</p>
    
  </div>
</div>

    
      

  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>