<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Packaging a .NET Core 3.0 application with MSIX - Microsoft Tech Community -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Packaging a .NET Core 3.0 application with MSIX - Microsoft Tech Community</h1><div><div class="lia-message-body-content"><p>We have talked multiple times on this blog about<span>&nbsp;</span><a href="https://aka.ms/msix" target="_blank" rel="noopener noopener noreferrer">MSIX</a><span>&nbsp;</span>and how you can use it to package existing Win32 applications, so that you can improve the deployment and distribution of your Windows applications. If you're starting from a Visual Studio solution (like a WPF or Windows Forms project), the best way to package it with MSIX is the<span>&nbsp;</span><a href="https://docs.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-packaging-dot-net" target="_blank" rel="noopener noopener noreferrer">Windows Application Packaging Project</a>, which is a new project's type included in Visual Studio 2017 and 2019. We have talked about this project multiple times, but always using a full .NET Framework project as a reference. However, .NET Core 3.0 is emerging as the new way forward for WPF and Windows Forms application and, even it's still in preview, we can start building Windows desktop .NET Core applications today. So, what if I want to package my WPF or Windows Forms app based on .NET Core with MSIX? Can we still use the Windows Application Packaging Project?</p><p>The short answer is... yes! However, there are some specific steps to keep in mind. Let's see them!</p><p>The first step, of course, is to start from a WPF or Windows Forms project you have already built using .NET Core 3.0. The most recent .NET Core 3.0 version is Preview 3, which you can get from here<span>&nbsp;</span><a href="https://dotnet.microsoft.com/download/dotnet-core/3.0" target="_blank" rel="noopener noopener noreferrer">https://dotnet.microsoft.com/download/dotnet-core/3.0</a>. To work with .NET Core 3.0 apps you'll also need Visual Studio 2019. You can choose between<span>&nbsp;</span><a href="https://visualstudio.microsoft.com/downloads/" target="_blank" rel="noopener noopener noreferrer">the RC version</a>, which has a Go Live license and it will be automatically updated to the final bits on 2nd April; or you can get the<span>&nbsp;</span><a href="https://visualstudio.microsoft.com/vs/preview/" target="_blank" rel="noopener noopener noreferrer">Preview version</a>, which offers access to preliminary features ahead of the official release.</p><p>If you want to know more about .NET Core 3.0 development, here there are some great resources:</p><p>If you don't have an existing project but you want to give it a try anyway, you can just create a new project in Visual Studio 2019 and look for WPF (.NET Core) or Windows Forms (.NET Core) in the list of templates:</p><p><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="netcoreprojects.png"><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99071i13B51395529F4277/image-size/large?v=1.0&amp;px=999" title="netcoreprojects.png" alt="netcoreprojects.png" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99071i13B51395529F4277?v=1.0" li-image-display-id="'99071i13B51395529F4277'" li-message-uid="'386432'" li-messages-message-image="true" li-bindable="" class="lia-media-image" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false"></span></p><p>Or you can use the CLI by opening a command prompt and use one of the following two commands:</p><pre><code id="pragma-line-24" class="language-powershell hljs">dotnet new wpf
dotnet new winforms
</code></pre><p>Once you have the solution opened in Visual Studio 2019, let's follow the same steps we did in the past to package a full .NET Framework application. Right click on the solution, choose<span>&nbsp;</span><strong>Add -&gt; New project</strong><span>&nbsp;</span>and look for the Windows Application Packaging Project template. Give it a name, then press OK.</p><p><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="wapp.png"><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99072i7AE41EB686327DF4/image-size/large?v=1.0&amp;px=999" title="wapp.png" alt="wapp.png" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99072i7AE41EB686327DF4?v=1.0" li-image-display-id="'99072i7AE41EB686327DF4'" li-message-uid="'386432'" li-messages-message-image="true" li-bindable="" class="lia-media-image" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false"></span></p><p><span>Once the new project has been loaded, right click on&nbsp;</span><strong>Applications</strong><span>&nbsp;and choose&nbsp;</span><strong>Add reference</strong><span>. You will see a list of all the projects which belong to your solution. Choose the one which contains your WPF or Windows Forms .NET Core application. At the end, you should see something like this:</span></p><p><span><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="applicationreference.png"><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99073i8F670C9202112C86/image-size/large?v=1.0&amp;px=999" title="applicationreference.png" alt="applicationreference.png" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99073i8F670C9202112C86?v=1.0" li-image-display-id="'99073i8F670C9202112C86'" li-message-uid="'386432'" li-messages-message-image="true" li-bindable="" class="lia-media-image" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false"></span></span></p><p>So far, nothing special. It's the same exact process you would have done with a full .NET Framework application. However, as soon as you try to build the Windows Application Packaging Project, you will notice something not working as expected:</p><pre><code id="pragma-line-39" class="language-txt hljs text">2&gt;------ Rebuild All started: Project: ContosoExpenses.Package, Configuration: Debug x86 ------
2&gt;C:\Program Files\dotnet\sdk\3.0.100-preview3-010431\Sdks\Microsoft.NET.Sdk\targets\Microsoft.PackageDependencyResolution.targets(228,5): error NETSDK1047: Assets file 'C:\Users\mpagani\Source\Samples\ContosoExpenses-Basic\ContosoExpenses\obj\project.assets.json' doesn't have a target for '.NETCoreApp,Version=v3.0/win-x86'. Ensure that restore has run and that you have included 'netcoreapp3.0' in the TargetFrameworks for your project. You may also need to include 'win-x86' in your project's RuntimeIdentifiers.
2&gt;Done building project "ContosoExpenses.csproj" -- FAILED.
</code></pre><p>The Windows Application Packaging Project, currently, supports .NET Core 3.0 apps only using the Self Contained Deployment approach. This means that the output package won't include just the application, but also the full .NET Core runtime. The downside of this approach is that the package will be bigger, but the great advantage is that you'll be able to deploy it on any machine, regardless if it has or not the .NET Core 3.0 runtime installed. This is very important especially if you're planning to distribute the application through the Microsoft Store. One of the policies, in fact, requires that all the dependencies of the application must be satisfied during the installation (either because they're included in the package or because they're available on the Store). The user shouldn't have to go to a website and download additional libraries / frameworks / tools to run an application downloaded from the Store.</p><p>In order to build a self contained application, however, you must specify which are the supported target runtimes. In such a scenario, in fact, you can't build a cross-platform application anymore, because you must embed inside the executable the specific runtime version for the platform where the application is running. Since we're building a Windows desktop application, this isn't a big deal since WPF and Windows Forms application are still bound to Windows. In order to specify the runtime, we need to edit the .csproj file of our project. Right click on it in Solution Explorer and choose<span>&nbsp;</span><strong>Edit xyz.csproj</strong>, where<span>&nbsp;</span><strong>xyz</strong><span>&nbsp;</span>is the name of your project.</p><p>In the<span>&nbsp;</span><strong>PropertyGroup</strong><span>&nbsp;</span>section add the following line:</p><pre><code id="pragma-line-51" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">RuntimeIdentifiers</span>&gt;</span>win-x86;win-x64<span class="hljs-tag">&lt;/<span class="hljs-name">RuntimeIdentifiers</span>&gt;</span></code></pre><p>This is how the first part of your project file should look like:</p><pre><code id="pragma-line-57" class="language-xml hljs"><span class="hljs-tag">&lt;<span class="hljs-name">Project</span><span class="hljs-attr">Sdk</span>=<span class="hljs-string">"Microsoft.NET.Sdk.WindowsDesktop"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">PropertyGroup</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">OutputType</span>&gt;</span>WinExe<span class="hljs-tag">&lt;/<span class="hljs-name">OutputType</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">TargetFramework</span>&gt;</span>netcoreapp3.0<span class="hljs-tag">&lt;/<span class="hljs-name">TargetFramework</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">UseWPF</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">UseWPF</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">RuntimeIdentifiers</span>&gt;</span>win-x86;win-x64<span class="hljs-tag">&lt;/<span class="hljs-name">RuntimeIdentifiers</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">PropertyGroup</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Project</span>&gt;</span></code></pre><p>If it's a Windows Forms project, instead of<span>&nbsp;</span><strong>UseWPF</strong><span>&nbsp;</span>you will see the<span>&nbsp;</span><strong>UseWindowsForms</strong><span>&nbsp;</span>entry. With this property we have just added, we are configuring our .NET Core 3.0 project to explictly support the Windows platform, both using the x86 and x64 architecture. Of course, if your project supports only one of these two architectures, feel free to remove the not supported one.</p><p>That's it! Now just set as startup project your Windows Application Packaging Project and, in Configuration Manager, choose x86 or x64 as target architecture:</p><p><span class="lia-inline-image-display-wrapper lia-image-align-inline" image-alt="architecture.png"><img src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99074iA90F322A9DCF1FE4/image-size/large?v=1.0&amp;px=999" title="architecture.png" alt="architecture.png" li-image-url="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/99074iA90F322A9DCF1FE4?v=1.0" li-image-display-id="'99074iA90F322A9DCF1FE4'" li-message-uid="'386432'" li-messages-message-image="true" li-bindable="" class="lia-media-image" tabindex="0" li-bypass-lightbox-when-linked="true" li-use-hover-links="false"></span></p><p>Try to compile again the Windows Application Packaging Project and this time everything will work. Your application will be packaged, along with the specific .NET Core 3.0 version specific for the CPU architecture you have chosen.</p><h3 id="wrapping-up"><a id="pragma-line-78" target="_blank"></a>Wrapping up</h3><p>In this post we have seen how we can use the Windows Application Packaging Project to package not only full .NET Framework applications, but also .NET Core 3.0 ones. This feature has been added in Visual Studio 2019 Preview 2 and makes super easy to leverage two of the most interesting technologies to modernize Windows desktop applications: MSIX and .NET Core 3.0. The only limitation is that, currently, Visual Studio supports only Self Contained Deployment, which means that the whole .NET Core runtime is embedded inside the package. This approach has the great advantage of making the application esaier to distribute but it could be redundant in enterprisce scenarios, when you have many applications depenending from the same framework and, as such, it's preinstalled on each machine. However, the team is already working to enable Framework Dependent Deployment as well, which means that the packaged application will be able to leverage the .NET Core 3.0 runtime installed on the machine.</p><p>Happy coding!</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>