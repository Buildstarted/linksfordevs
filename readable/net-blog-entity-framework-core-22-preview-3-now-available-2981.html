<!DOCTYPE html>
<html lang="en">
<head>
    <title>
.NET Blog Entity Framework Core 2.2 Preview 3 Now Available! - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content=".NET Blog Entity Framework Core 2.2 Preview 3 Now Available! - linksfor.dev(s)"/>
    <meta property="article:author" content="Diego VegaProgram Manager ,&#xA0;.NET Data AccessFollow Diego"/>
    <meta property="og:description" content="Entity Framework Core 2.2 Preview 3 available with a new preview of our data provider for Cosmos DB and updated spatial extensions for various providers."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-2-2-preview-3/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - .NET Blog Entity Framework Core 2.2 Preview 3 Now Available!</title>
<div class="readable">
        <h1>.NET Blog Entity Framework Core 2.2 Preview 3 Now Available!</h1>
            <div>by Diego VegaProgram Manager ,&#xA0;.NET Data AccessFollow Diego</div>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-2-2-preview-3/">https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-2-2-preview-3/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://secure.gravatar.com/avatar/c16238388fe24348cb8d7c4cf974bb7b?s=58&amp;d=mm&amp;r=g" width="58" height="58" alt="Avatar"></p><p>Diego</p></div></div></div><p>October 17th, 2018</p><p>Today we are making EF Core 2.2 Preview 3 available, together with a new preview of our data provider for Cosmos DB and updated spatial extensions for various providers.</p><p>Preview 3 is going to be the last milestone before EF Core 2.2 RTM, so now is your last chance to try the bits and give us feedback if you want to have an impact on the quality and the shape of the APIs in this release.</p><p>Besides the new features, you can help by trying EF Core 2.2 preview 3 on applications that are using third party providers.&nbsp; Although we now have our own testing for this, there might be unforeseen compatibility problems, and the earlier we can detect them, the higher chances we have of addressing them before RTM.</p><p>We thank you in advance for reporting any issues your find on <a href="https://github.com/aspnet/EntityFrameworkCore/issues/new" target="_blank">our issue tracker on GitHub</a>.</p><h2 id="ef-core-2-2-roadmap-update">EF Core 2.2 roadmap update<a href="#ef-core-2-2-roadmap-update"></a></h2><p>EF Core 2.2 RTM is still planned for the end of the 2018 calendar year, alongside ASP.NET Core 2.2 and .NET Core 2.2.</p><p>However, based on a reassessment of the progress we have made so far, and on new information about the work we need to complete 2.2, we are no longer trying to include the following features in the EF Core 2.2 RTM:</p><ul><li><strong>Reverse engineering database views into query types:</strong> <a href="https://github.com/aspnet/EntityFrameworkCore/issues/1679" target="_blank">This feature</a> is postponed to EF Core 3.0.</li><li><strong>Cosmos DB Provider:</strong> Although we have made a lot of progress setting up the required infrastructure for document-oriented database support in EF Core, and have been steadily adding functionality to the provider, realistically we cannot arrive to a state in which we can release the provider with adequate functionality and quality in the current time frame for 2.2.Overall, we have found that the work necessary to complete the provider to be more than we initially estimated. Also, ongoing evolution in Cosmos DB is leading us to frequently revisit decisions about such things as how we use the Cosmos DB SDK, whether we map all entities to a single collection by default, etc.We plan to maintain the focus on the provider and to continue working with the Cosmos DB team and to keep releasing previews of the provider regularly. You can expect at least one more preview by the end of this year, and RTM sometime in 2019. We havenâ€™t decided yet if the Cosmos DB provider will release as part of EF Core 3.0 or earlier.A good way to keep track of our progress is <a href="https://github.com/aspnet/EntityFrameworkCore/issues/12086" target="_blank">this checklist in our issue tracker</a>.</li></ul><h2 id="obtaining-the-preview">Obtaining the preview<a href="#obtaining-the-preview"></a></h2><p>The preview bits are available <a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore/2.2.0-preview3-35497" target="_blank">on NuGet</a>, and also as part of <a href="https://blogs.msdn.microsoft.com/webdev/2018/10/17/asp-net-core-2-2-0-preview3-now-available/" target="_blank">ASP.NET Core 2.2 Preview 3</a> and the <a href="https://github.com/dotnet/core/blob/master/release-notes/2.2/preview/2.2.0-preview3.md" target="_blank">.NET Core SDK 2.2 Preview 3</a>, also releasing today. If you are want to try the preview in an application based on ASP.NET Core, we recommend you follow the instructions to upgrade to ASP.NET Core 2.2 Preview 3.</p><p>The SQL Server and in-memory providers are also included in ASP.NET Core, but for other providers and any other type of application, you will need to install the corresponding NuGet package.</p><p>For example, to add the 2.2 Preview 3 version of the SQL Server provider in a .NET Core library or application from the command line, use:</p><pre><span>$ dotnet add </span><span>package</span><span> </span><span>Microsoft</span><span>.</span><span>EntityFrameworkCore</span><span>.</span><span>SqlServer</span><span> </span><span>-</span><span>v </span><span>2.2</span><span>.</span><span>0</span><span>-</span><span>preview3</span><span>-</span><span>35497</span></pre><p>Or from the Package Manager Console in Visual Studio:</p><pre><span>PM</span><span>&gt;</span><span> </span><span>Install</span><span>-</span><span>Package</span><span> </span><span>Microsoft</span><span>.</span><span>EntityFrameworkCore</span><span>.</span><span>SqlServer</span><span> </span><span>-</span><span>Version</span><span> </span><span>2.2</span><span>.</span><span>0</span><span>-</span><span>preview3</span><span>-</span><span>35497</span></pre><p>For more details on how to add EF Core to your projects see <a href="https://docs.microsoft.com/ef/core/get-started/install/" target="_blank">our documentation on Installing Entity Framework Core</a>.</p><p>The Cosmos DB provider and the spatial extensions ship as new separate NuGet packages. Weâ€™ll explain how to get started with them in the corresponding feature descriptions.</p><h2 id="what-is-new-in-this-preview-">What is new in this preview?<a href="#what-is-new-in-this-preview-"></a></h2><p>Around <a href="https://github.com/aspnet/EntityFrameworkCore/issues?q=is%3Aissue+milestone%3A2.2.0-preview3+is%3Aclosed+label%3Aclosed-fixed" target="_blank">69 issues have been fixed</a>&nbsp;since we finished <a href="https://blogs.msdn.microsoft.com/dotnet/2018/09/12/announcing-entity-framework-core-2-2-preview-2/" target="_blank">Preview 2 last month</a>. This includes product bug fixes and improvements to the new features. Specifically about the new features, the most significant changes are:</p><h3 id="spatial-extensions">Spatial extensions</h3><ul><li>We have enabled spatial extensions to work with the SQLite provider using the popular <a href="https://www.gaia-gis.it/fossil/libspatialite/index" target="_blank">SpatiaLite</a> library.</li><li>We switched the default mapping of spatial properties on SQL Server from geometry to geography columns.</li><li>In order to use spatial extensions correctly with preview 3, it is recommended that you use the GeometryFactory provided by NetTopologySuite instead of creating new instances directly.</li><li>We collaborated with the NetTopologySuite team to create <strong>NetTopologySuite.IO.SqlServerBytes</strong> â€” a new IO module that targets .NET Standard and works directly with the SQL Server serialization format.</li><li>We enabled reverse engineering for databases containing spatial columns. Just make sure you add the spatial extension package for your database provider before you run <strong>Scaffold-DbContext</strong>&nbsp;or <strong>dotnet ef dbcontext scaffold</strong>.</li></ul><p>Here is an updated usage example:</p><pre><code><span>
</span><span>// Model class</span><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>Friend</span><span>
</span><span>{</span><span>
  </span><span>[</span><span>Key</span><span>]</span><span>
  </span><span>public</span><span> </span><span>string</span><span> </span><span>Name</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>

  </span><span>[</span><span>Required</span><span>]</span><span>
  </span><span>public</span><span> </span><span>IPoint</span><span> </span><span>Location</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
</span><span>}</span><span>

</span><span>// Program</span><span>
</span><span>private</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>Main</span><span>(</span><span>string</span><span>[]</span><span> args</span><span>)</span><span>
</span><span>{</span><span>
     </span><span>// Create spatial factory</span><span>
     </span><span>var</span><span> geometryFactory </span><span>=</span><span> </span><span>NtsGeometryServices</span><span>.</span><span>Instance</span><span>.</span><span>CreateGeometryFactory</span><span>(</span><span>srid</span><span>:</span><span> </span><span>4326</span><span>);</span><span>

     </span><span>// Setup data in datbase</span><span>
     </span><span>using</span><span> </span><span>(</span><span>var</span><span> context </span><span>=</span><span> </span><span>new</span><span> </span><span>MyDbContext</span><span>())</span><span>
     </span><span>{</span><span>
         context</span><span>.</span><span>Database</span><span>.</span><span>EnsureDeleted</span><span>();</span><span>
         context</span><span>.</span><span>Database</span><span>.</span><span>EnsureCreated</span><span>();</span><span>

         context</span><span>.</span><span>Add</span><span>(</span><span>
             </span><span>new</span><span> </span><span>Friend</span><span>
             </span><span>{</span><span>
                 </span><span>Name</span><span> </span><span>=</span><span> </span><span>"Bill"</span><span>,</span><span>
                 </span><span>Location</span><span> </span><span>=</span><span> geometryFactory</span><span>.</span><span>CreatePoint</span><span>(</span><span>new</span><span> </span><span>Coordinate</span><span>(-</span><span>122.34877</span><span>,</span><span> </span><span>47.6233355</span><span>))</span><span>
             </span><span>});</span><span>
         context</span><span>.</span><span>Add</span><span>(</span><span>
             </span><span>new</span><span> </span><span>Friend</span><span>
             </span><span>{</span><span>
                 </span><span>Name</span><span> </span><span>=</span><span> </span><span>"Paul"</span><span>,</span><span>
                 </span><span>Location</span><span> </span><span>=</span><span> geometryFactory</span><span>.</span><span>CreatePoint</span><span>(</span><span>new</span><span> </span><span>Coordinate</span><span>(-</span><span>122.3308366</span><span>,</span><span> </span><span>47.5978429</span><span>))</span><span>
             </span><span>});</span><span>
         context</span><span>.</span><span>SaveChanges</span><span>();</span><span>
     </span><span>}</span><span>

     </span><span>// find nearest friends</span><span>
     </span><span>using</span><span> </span><span>(</span><span>var</span><span> context </span><span>=</span><span> </span><span>new</span><span> </span><span>MyDbContext</span><span>())</span><span>
     </span><span>{</span><span>
         </span><span>var</span><span> myLocation </span><span>=</span><span> geometryFactory</span><span>.</span><span>CreatePoint</span><span>(</span><span>new</span><span> </span><span>Coordinate</span><span>(-</span><span>122.13345</span><span>,</span><span> </span><span>47.6418066</span><span>));</span><span>

         </span><span>var</span><span> nearestFriends </span><span>=</span><span>
             </span><span>(</span><span>from</span><span> f </span><span>in</span><span> context</span><span>.</span><span>Friends</span><span>
              </span><span>orderby</span><span> f</span><span>.</span><span>Location</span><span>.</span><span>Distance</span><span>(</span><span>myLocation</span><span>)</span><span> </span><span>descending</span><span>
              </span><span>select</span><span> f</span><span>).</span><span>Take</span><span>(</span><span>5</span><span>);</span><span>

         </span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>"Your nearest friends are:"</span><span>);</span><span>
         </span><span>foreach</span><span> </span><span>(</span><span>var</span><span> </span><span>friend</span><span> </span><span>in</span><span> nearestFriends</span><span>)</span><span>
         </span><span>{</span><span>
             </span><span>Console</span><span>.</span><span>WriteLine</span><span>(</span><span>$</span><span>"Name: {friend.Name}."</span><span>);</span><span>
         </span><span>}</span><span>
     </span><span>}</span><span>
</span><span>}</span><span>
</span></code></pre><p>In order to use this code with SQL Server, simply install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite </strong>NuGet package, and configure your <strong>DbContext</strong> as follows:</p><pre><code><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>MyDbContext</span><span> </span><span>:</span><span> </span><span>DbContext</span><span>
</span><span>{</span><span>
    </span><span>public</span><span> </span><span>DbSet</span><span> </span><span>Friends</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>

    </span><span>protected</span><span> </span><span>override</span><span> </span><span>void</span><span> </span><span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span><span> options</span><span>)</span><span>
    </span><span>{</span><span>
        options</span><span>.</span><span>UseSqlServer</span><span>(</span><span>
            </span><span>"Server=(localdb)\\mssqllocaldb;Database=SpatialFriends;ConnectRetryCount=0"</span><span>,</span><span>
            b </span><span>=&gt;</span><span> b</span><span>.</span><span>UseNetTopologySuite</span><span>());</span><span>

    </span><span>}</span><span>
</span><span>}</span></code></pre><p>In order to use this code with SQLite, you can install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite</strong> and&nbsp;<strong>Microsoft.EntityFrameworkCore.Sqlite</strong>&nbsp;packages. Then you can configure the <strong>DbContext</strong> like this:</p><pre><code><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>MyDbContext</span><span> </span><span>:</span><span> </span><span>DbContext</span><span>
</span><span>{</span><span>
    </span><span>public</span><span> </span><span>DbSet</span><span> </span><span>Friends</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>

    </span><span>protected</span><span> </span><span>override</span><span> </span><span>void</span><span> </span><span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span><span> options</span><span>)</span><span>
    </span><span>{</span><span>
        options</span><span>.</span><span>UseSqlite</span><span>(</span><span>
            </span><span>"Filename=SpatialFriends.db"</span><span>,</span><span>
            x </span><span>=&gt;</span><span> x</span><span>.</span><span>UseNetTopologySuite</span><span>());</span><span>
    </span><span>}</span><span>

    </span><span>protected</span><span> </span><span>override</span><span> </span><span>void</span><span> </span><span>OnModelCreating</span><span>(</span><span>ModelBuilder</span><span> modelBuilder</span><span>)</span><span>
    </span><span>{</span><span>
        </span><span>// For SQLite, you need to configure reference system on column</span><span>
        modelBuilder
            </span><span>.</span><span>Entity</span><span>()</span><span>
            </span><span>.</span><span>Property</span><span>(</span><span>f </span><span>=&gt;</span><span> f</span><span>.</span><span>Location</span><span>)</span><span>
            </span><span>.</span><span>ForSqliteHasSrid</span><span>(</span><span>4326</span><span>);</span><span>
    </span><span>}</span><span>
</span><span>}</span></code></pre><p>Note that the spatial extension for SQLite requires the SpatiaLite library. This will be added as a dependency by the NuGet packages previously mentioned if you are on Windows, but on other systems you will need extra steps. For example:</p><ul><li>On MacOS:<pre><span>$ brew install libspatialite</span></pre></li><li>On Ubuntu or Debian Linux:<pre><span>$ apt</span><span>-</span><span>get</span><span> install libsqlite3</span><span>-</span><span>mod</span><span>-</span><span>spatialite</span></pre></li></ul><p>In order to use this code with the in-memory provider, simply install the <strong>NetTopologySuite&nbsp;</strong>package, and the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.InMemory</strong> package. Then you can simply configure the <strong>DbContext</strong> like this:</p><pre><code><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>MyDbContext</span><span> </span><span>:</span><span> </span><span>DbContext</span><span>
</span><span>{</span><span>
    </span><span>public</span><span> </span><span>DbSet</span><span> </span><span>Friends</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>

    </span><span>protected</span><span> </span><span>override</span><span> </span><span>void</span><span> </span><span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span><span> options</span><span>)</span><span>
    </span><span>{</span><span>
        options</span><span>.</span><span>UseInMemoryDatabase</span><span>(</span><span>"SpatialFriends"</span><span>);</span><span>
    </span><span>}</span><span>
</span><span>}</span></code></pre><h3 id="cosmos-db-provider">Cosmos DB provider</h3><p>We have made several changes and improvements since preview 2:</p><ul><li>The package name has been renamed to Microsoft.EntityFrameworkCore.Cosmos</li><li>The <strong>UseCosmosSql()</strong> method has been renamed to&nbsp;UseCosmos()</li><li>We now store owned entity references and collections in the same document as the owner</li><li>Queries can now be executed asynchronously</li><li><strong>SaveChanges()</strong>, <strong>EnsureCreated()</strong>, and <strong>EnsureDeleted()</strong> can now be executed synchronously</li><li>You no longer need to manually generate unique key values for entities</li><li>We preserve values in non-mapped properties when we update documents</li><li>We added a <strong>ToContainer()</strong> API to map entity types to a Cosmos DB container (or collection) explicitly</li><li>We now use the name of the derived <strong>DbContext</strong> type, rather â€˜Unicornâ€™ for the container or collection name we use by convention</li><li>We enabled various existing features to work with Cosmos DB, including retrying execution strategies, and data seeding</li></ul><p>We still have some pending work and several limitations to remove in the provider. Most of them as tracked as uncompleted tasks <a href="https://github.com/aspnet/EntityFrameworkCore/issues/12086" target="_blank">on our task list</a>. In addition to those:</p><ul><li>Currently, synchronous methods are much slower than the corresponding asynchronous methods</li><li>The value of the â€˜idâ€™ property has to be specified for seeding</li><li>There is currently no enforcement of uniqueness of primary keys values on entities saved by multiple instances of the <strong>DbContext</strong></li></ul><p>In order to use the provider, install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.Cosmos</strong>&nbsp;package.</p><p>The following example configures the <strong>DbContext</strong> to connect to the <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator" target="_blank">Cosmos DB local emulator</a> to store a simple blogging model:</p><pre><code><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>BloggingContext</span><span> </span><span>:</span><span> </span><span>DbContext</span><span>
</span><span>{</span><span>
  </span><span>public</span><span> </span><span>DbSet</span><span> </span><span>Blogs</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>DbSet</span><span> </span><span>Posts</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>

  </span><span>protected</span><span> </span><span>override</span><span> </span><span>void</span><span> </span><span>OnConfiguring</span><span>(</span><span>DbContextOptionsBuilder</span><span> optionsBuilder</span><span>)</span><span>
  </span><span>{</span><span>
    optionsBuilder</span><span>.</span><span>UseCosmos</span><span>(</span><span>
      </span><span>"https://localhost:8081"</span><span>,</span><span>
      </span><span>"C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw=="</span><span>,</span><span>
      </span><span>"MyDocuments"</span><span>);</span><span>
  </span><span>}</span><span>
</span><span>}</span><span>

</span><span>public</span><span> </span><span>class</span><span> </span><span>Blog</span><span>
</span><span>{</span><span>
  </span><span>public</span><span> </span><span>int</span><span> </span><span>BlogId</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>string</span><span> </span><span>Name</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>string</span><span> </span><span>Url</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>List</span><span> </span><span>Posts</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
</span><span>}</span><span>

</span><span>public</span><span> </span><span>class</span><span> </span><span>Post</span><span>
</span><span>{</span><span>
  </span><span>public</span><span> </span><span>int</span><span> </span><span>PostId</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>string</span><span> </span><span>Title</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>string</span><span> </span><span>Content</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
  </span><span>public</span><span> </span><span>List</span><span> </span><span>Tags</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
</span><span>}</span><span>

</span><span>[</span><span>Owned</span><span>]</span><span>
</span><span>public</span><span> </span><span>class</span><span> </span><span>Tag</span><span>
</span><span>{</span><span>
    </span><span>[</span><span>Key</span><span>]</span><span>
    </span><span>public</span><span> </span><span>string</span><span> </span><span>Name</span><span> </span><span>{</span><span> </span><span>get</span><span>;</span><span> </span><span>set</span><span>;</span><span> </span><span>}</span><span>
</span><span>}</span></code></pre><p>If you want, you can create the database programmatically, using EF Core APIs:</p><pre><code><span>
</span><span>using</span><span> </span><span>(</span><span>var</span><span> context </span><span>=</span><span> </span><span>new</span><span> </span><span>BloggingContext</span><span>())</span><span>
</span><span>{</span><span>
  context</span><span>.</span><span>Database</span><span>.</span><span>EnsureCreated</span><span>();</span><span>
</span><span>}</span></code></pre><p>Once you have connected to an existing database and you have defined your entities, you can start storing data in the database, for example:</p><pre><code><span>
</span><span>using</span><span> </span><span>(</span><span>var</span><span> context </span><span>=</span><span> </span><span>new</span><span> </span><span>BloggingContext</span><span>())</span><span>
</span><span>{</span><span>
  context</span><span>.</span><span>Blogs</span><span>.</span><span>Add</span><span>(</span><span>
    </span><span>new</span><span> </span><span>Blog</span><span>
    </span><span>{</span><span>
        </span><span>BlogId</span><span> </span><span>=</span><span> </span><span>1</span><span>,</span><span>
        </span><span>Name</span><span> </span><span>=</span><span> </span><span>".NET Blog"</span><span>,</span><span>
        </span><span>Url</span><span> </span><span>=</span><span> </span><span>"https://blogs.msdn.microsoft.com/dotnet/"</span><span>,</span><span>
        </span><span>Posts</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>List</span><span>
        </span><span>{</span><span>
            </span><span>new</span><span> </span><span>Post</span><span>
            </span><span>{</span><span>
                </span><span>PostId</span><span> </span><span>=</span><span> </span><span>2</span><span>,</span><span>
                </span><span>Title</span><span> </span><span>=</span><span> </span><span>"Welcome to this blog!"</span><span>,</span><span>
                </span><span>Tags</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>List</span><span>
                </span><span>{</span><span>
                    </span><span>new</span><span> </span><span>Tag</span><span>
                    </span><span>{</span><span>
                        </span><span>Name</span><span> </span><span>=</span><span> </span><span>"Entity Framework Core"</span><span>
                    </span><span>},</span><span>
                    </span><span>new</span><span> </span><span>Tag</span><span>
                    </span><span>{</span><span>
                        </span><span>Name</span><span> </span><span>=</span><span> </span><span>".NET Core"</span><span>
                    </span><span>}</span><span>
                </span><span>}</span><span>
            </span><span>},</span><span>
        </span><span>}</span><span>
      </span><span>}</span><span>
    </span><span>});</span><span>
  context</span><span>.</span><span>SaveChanges</span><span>();</span><span>
</span><span>}</span></code></pre><p>And you can write queries using LINQ:</p><pre><code><span>
</span><span>var</span><span> dotNetBlog </span><span>=</span><span> context</span><span>.</span><span>Blogs</span><span>.</span><span>Single</span><span>(</span><span>b </span><span>=&gt;</span><span> b</span><span>.</span><span>Name</span><span> </span><span>==</span><span> </span><span>".NET Blog"</span><span>);</span></code></pre><h3 id="query-tags">Query tags</h3><ul><li>We fixed several issues with multiple calls of the API and with usage with multi-line strings</li><li>The API was renamed to <strong>TagWith()</strong></li></ul><p>This an updated usage example:</p><pre><code><span>
  </span><span>var</span><span> nearestFriends </span><span>=</span><span>
      </span><span>(</span><span>from</span><span> f </span><span>in</span><span> context</span><span>.</span><span>Friends</span><span>.</span><span>TagWith</span><span>(@</span><span>"This is my spatial query!"</span><span>)</span><span>
      </span><span>orderby</span><span> f</span><span>.</span><span>Location</span><span>.</span><span>Distance</span><span>(</span><span>myLocation</span><span>)</span><span> </span><span>descending</span><span>
      </span><span>select</span><span> f</span><span>).</span><span>Take</span><span>(</span><span>5</span><span>).</span><span>ToList</span><span>();</span></code></pre><p>This will generate the following SQL output:</p><pre><code><span>
</span><span>--</span><span> </span><span>This</span><span> </span><span>is</span><span> </span><span>my</span><span> spatial query</span><span>!</span><span>

SELECT TOP</span><span>(</span><span>@__p_1</span><span>)</span><span> </span><span>[</span><span>f</span><span>].[</span><span>Name</span><span>],</span><span> </span><span>[</span><span>f</span><span>].[</span><span>Location</span><span>]</span><span>
FROM </span><span>[</span><span>Friends</span><span>]</span><span> AS </span><span>[</span><span>f</span><span>]</span><span>
ORDER BY </span><span>[</span><span>f</span><span>].[</span><span>Location</span><span>].</span><span>STDistance</span><span>(</span><span>@__myLocation_0</span><span>)</span><span> DESC</span></code></pre><h3 id="collections-of-owned-entities">Collections of owned entities</h3><ul><li>The main update since preview 2 is that the Cosmos DB provider now stores owned collections as part of the same document as the owner.</li></ul><p>Here is a simple usage scenario:</p><pre><code><span>
modelBuilder</span><span>.</span><span>Entity</span><span>().</span><span>OwnsMany</span><span>(</span><span>c </span><span>=&gt;</span><span> c</span><span>.</span><span>Addresses</span><span>);</span></code></pre><h2 id="thank-you">Thank you<a href="#thank-you"></a></h2><p>The EF team would like to thank everyone for all the feedback and contributions. Once more, please try this preview and report any feedback on <a href="https://github.com/aspnet/EntityFrameworkCore/issues/new" target="_blank">our issue tracker</a>.</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>