<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Buidler, Waffle &amp; Ethers | The Geeky Grower - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Buidler, Waffle &amp; Ethers | The Geeky Grower - linksfor.dev(s)"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://pitchandrolls.com/2020/07/23/buidler-waffle-ethers/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Buidler, Waffle &amp; Ethers | The Geeky Grower</title>
<div class="readable">
        <h1>Buidler, Waffle &amp; Ethers | The Geeky Grower</h1>
            <div>Reading time: 17-22 minutes</div>
        <div>Posted here: 27 Jul 2020</div>
        <p><a href="http://pitchandrolls.com/2020/07/23/buidler-waffle-ethers/">http://pitchandrolls.com/2020/07/23/buidler-waffle-ethers/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
        <div>
  <div id="file-examplewafflettest-ts">
    

  <div itemprop="text">
      
<table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-examplewafflettest-ts-L1" data-line-number="1"></td>
        <td id="file-examplewafflettest-ts-LC1"><span>import</span> <span>{</span> <span>assert</span><span>,</span> <span>expect</span> <span>}</span> <span>from</span> <span>'chai'</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L2" data-line-number="2"></td>
        <td id="file-examplewafflettest-ts-LC2"><span>import</span> <span>{</span> <span>ethers</span><span>,</span> <span>ethereum</span> <span>}</span> <span>from</span> <span>"@nomiclabs/buidler"</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L3" data-line-number="3"></td>
        <td id="file-examplewafflettest-ts-LC3"><span>import</span> <span>{</span> <span>Signer</span><span>,</span> <span>utils</span> <span>}</span> <span>from</span> <span>"ethers"</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L4" data-line-number="4"></td>
        <td id="file-examplewafflettest-ts-LC4"><span>const</span> <span>verbose</span> <span>=</span> <span>process</span><span>.</span><span>env</span><span>.</span><span>VERBOSE</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L5" data-line-number="5"></td>
        <td id="file-examplewafflettest-ts-LC5"><span>const</span> <span>Decimal</span> <span>=</span> <span>require</span><span>(</span><span>'decimal.js'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L6" data-line-number="6"></td>
        <td id="file-examplewafflettest-ts-LC6"><span>const</span> <span>{</span> calcRelativeDiff <span>}</span> <span>=</span> <span>require</span><span>(</span><span>'./lib/calc_comparisons'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L7" data-line-number="7"></td>
        <td id="file-examplewafflettest-ts-LC7"><span>const</span> <span>errorDelta</span> <span>=</span> <span>10</span> ** <span>-</span><span>8</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L8" data-line-number="8"></td>
        <td id="file-examplewafflettest-ts-LC8">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L9" data-line-number="9"></td>
        <td id="file-examplewafflettest-ts-LC9"><span>describe</span><span>(</span><span>'ExchangeProxy Smart Swaps'</span><span>,</span> <span>function</span><span>(</span><span>)</span><span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L10" data-line-number="10"></td>
        <td id="file-examplewafflettest-ts-LC10">    <span>const</span> <span>toWei</span> <span>=</span> <span>utils</span><span>.</span><span>parseEther</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L11" data-line-number="11"></td>
        <td id="file-examplewafflettest-ts-LC11">    <span>const</span> <span>fromWei</span> <span>=</span> <span>utils</span><span>.</span><span>formatEther</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L12" data-line-number="12"></td>
        <td id="file-examplewafflettest-ts-LC12">    <span>const</span> <span>MAX</span> <span>=</span> <span>ethers</span><span>.</span><span>constants</span><span>.</span><span>MaxUint256</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L13" data-line-number="13"></td>
        <td id="file-examplewafflettest-ts-LC13">    <span>const</span> <span>errorDelta</span> <span>=</span> <span>10</span> ** <span>-</span><span>8</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L14" data-line-number="14"></td>
        <td id="file-examplewafflettest-ts-LC14">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L15" data-line-number="15"></td>
        <td id="file-examplewafflettest-ts-LC15">    <span>let</span> <span>registry</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L16" data-line-number="16"></td>
        <td id="file-examplewafflettest-ts-LC16">    <span>let</span> <span>factory</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L17" data-line-number="17"></td>
        <td id="file-examplewafflettest-ts-LC17">    <span>let</span> <span>REGISTRY</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L18" data-line-number="18"></td>
        <td id="file-examplewafflettest-ts-LC18">    <span>let</span> <span>WETH</span>: <span>string</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L19" data-line-number="19"></td>
        <td id="file-examplewafflettest-ts-LC19">    <span>let</span> <span>MKR</span>: <span>string</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L20" data-line-number="20"></td>
        <td id="file-examplewafflettest-ts-LC20">    <span>let</span> <span>ETH</span>: <span>string</span> <span>=</span> <span>"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE"</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L21" data-line-number="21"></td>
        <td id="file-examplewafflettest-ts-LC21">    <span>let</span> <span>weth</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L22" data-line-number="22"></td>
        <td id="file-examplewafflettest-ts-LC22">    <span>let</span> <span>mkr</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L23" data-line-number="23"></td>
        <td id="file-examplewafflettest-ts-LC23">    <span>let</span> <span>proxy</span>: <span>any</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L24" data-line-number="24"></td>
        <td id="file-examplewafflettest-ts-LC24">    <span>let</span> <span>_POOLS</span>: <span>any</span><span>[</span><span>]</span> <span>=</span><span>[</span><span>]</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L25" data-line-number="25"></td>
        <td id="file-examplewafflettest-ts-LC25">    <span>let</span> <span>_pools</span>: <span>any</span><span>[</span><span>]</span> <span>=</span><span>[</span><span>]</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L26" data-line-number="26"></td>
        <td id="file-examplewafflettest-ts-LC26">    <span>let</span> <span>PROXY</span>: <span>string</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L27" data-line-number="27"></td>
        <td id="file-examplewafflettest-ts-LC27">    <span>let</span> <span>admin</span>: <span>string</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L28" data-line-number="28"></td>
        <td id="file-examplewafflettest-ts-LC28">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L29" data-line-number="29"></td>
        <td id="file-examplewafflettest-ts-LC29">    <span>before</span><span>(</span><span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L30" data-line-number="30"></td>
        <td id="file-examplewafflettest-ts-LC30">        <span>const</span> <span>BRegistry</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>'BRegistry'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L31" data-line-number="31"></td>
        <td id="file-examplewafflettest-ts-LC31">        <span>const</span> <span>BFactory</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>'BFactory'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L32" data-line-number="32"></td>
        <td id="file-examplewafflettest-ts-LC32">        <span>const</span> <span>BPool</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>'BPool'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L33" data-line-number="33"></td>
        <td id="file-examplewafflettest-ts-LC33">        <span>const</span> <span>TToken</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>'TToken'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L34" data-line-number="34"></td>
        <td id="file-examplewafflettest-ts-LC34">        <span>const</span> <span>ExchangeProxy</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>"ExchangeProxy"</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L35" data-line-number="35"></td>
        <td id="file-examplewafflettest-ts-LC35">        <span>const</span> <span>Weth9</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractFactory</span><span>(</span><span>'WETH9'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L36" data-line-number="36"></td>
        <td id="file-examplewafflettest-ts-LC36">        <span>const</span> <span>[</span><span>adminSigner</span><span>]</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getSigners</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L37" data-line-number="37"></td>
        <td id="file-examplewafflettest-ts-LC37">        <span>admin</span> <span>=</span> <span>await</span> <span>adminSigner</span><span>.</span><span>getAddress</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L38" data-line-number="38"></td>
        <td id="file-examplewafflettest-ts-LC38">        <span>factory</span> <span>=</span> <span>await</span> <span>BFactory</span><span>.</span><span>deploy</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L39" data-line-number="39"></td>
        <td id="file-examplewafflettest-ts-LC39">        <span>await</span> <span>factory</span><span>.</span><span>deployed</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L40" data-line-number="40"></td>
        <td id="file-examplewafflettest-ts-LC40">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L41" data-line-number="41"></td>
        <td id="file-examplewafflettest-ts-LC41">        <span>registry</span> <span>=</span> <span>await</span> <span>BRegistry</span><span>.</span><span>deploy</span><span>(</span><span>factory</span><span>.</span><span>address</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L42" data-line-number="42"></td>
        <td id="file-examplewafflettest-ts-LC42">        <span>await</span> <span>registry</span><span>.</span><span>deployed</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L43" data-line-number="43"></td>
        <td id="file-examplewafflettest-ts-LC43">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L44" data-line-number="44"></td>
        <td id="file-examplewafflettest-ts-LC44">        <span>mkr</span> <span>=</span> <span>await</span> <span>TToken</span><span>.</span><span>deploy</span><span>(</span><span>'Maker'</span><span>,</span> <span>'MKR'</span><span>,</span> <span>18</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L45" data-line-number="45"></td>
        <td id="file-examplewafflettest-ts-LC45">        <span>await</span> <span>mkr</span><span>.</span><span>deployed</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L46" data-line-number="46"></td>
        <td id="file-examplewafflettest-ts-LC46">        <span>MKR</span> <span>=</span> <span>mkr</span><span>.</span><span>address</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L47" data-line-number="47"></td>
        <td id="file-examplewafflettest-ts-LC47">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L48" data-line-number="48"></td>
        <td id="file-examplewafflettest-ts-LC48">        <span>let</span> <span>weth9</span> <span>=</span> <span>await</span> <span>Weth9</span><span>.</span><span>deploy</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L49" data-line-number="49"></td>
        <td id="file-examplewafflettest-ts-LC49">        <span>await</span> <span>weth9</span><span>.</span><span>deployed</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L50" data-line-number="50"></td>
        <td id="file-examplewafflettest-ts-LC50">        <span>WETH</span> <span>=</span> <span>weth9</span><span>.</span><span>address</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L51" data-line-number="51"></td>
        <td id="file-examplewafflettest-ts-LC51">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L52" data-line-number="52"></td>
        <td id="file-examplewafflettest-ts-LC52">        <span>proxy</span> <span>=</span> <span>await</span> <span>ExchangeProxy</span><span>.</span><span>deploy</span><span>(</span><span>WETH</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L53" data-line-number="53"></td>
        <td id="file-examplewafflettest-ts-LC53">        <span>await</span> <span>proxy</span><span>.</span><span>deployed</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L54" data-line-number="54"></td>
        <td id="file-examplewafflettest-ts-LC54">        <span>PROXY</span> <span>=</span> <span>proxy</span><span>.</span><span>address</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L55" data-line-number="55"></td>
        <td id="file-examplewafflettest-ts-LC55">        <span>await</span> <span>proxy</span><span>.</span><span>setRegistry</span><span>(</span><span>registry</span><span>.</span><span>address</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L56" data-line-number="56"></td>
        <td id="file-examplewafflettest-ts-LC56">        <span>await</span> <span>weth9</span><span>.</span><span>approve</span><span>(</span><span>PROXY</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L57" data-line-number="57"></td>
        <td id="file-examplewafflettest-ts-LC57">        <span>await</span> <span>mkr</span><span>.</span><span>approve</span><span>(</span><span>PROXY</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L58" data-line-number="58"></td>
        <td id="file-examplewafflettest-ts-LC58">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L59" data-line-number="59"></td>
        <td id="file-examplewafflettest-ts-LC59">        <span>// Admin balances</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L60" data-line-number="60"></td>
        <td id="file-examplewafflettest-ts-LC60">        <span>await</span> <span>weth9</span><span>.</span><span>deposit</span><span>(</span><span>{</span> <span>value</span>: <span>toWei</span><span>(</span><span>'10000000000'</span><span>)</span> <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L61" data-line-number="61"></td>
        <td id="file-examplewafflettest-ts-LC61">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L62" data-line-number="62"></td>
        <td id="file-examplewafflettest-ts-LC62">        <span>await</span> <span>mkr</span><span>.</span><span>mint</span><span>(</span><span>admin</span><span>,</span>  <span>toWei</span><span>(</span><span>'1000000000000000000000'</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L63" data-line-number="63"></td>
        <td id="file-examplewafflettest-ts-LC63">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L64" data-line-number="64"></td>
        <td id="file-examplewafflettest-ts-LC64">        <span>// Copy pools printed by https://github.com/balancer-labs/python-SOR/blob/master/Onchain_SOR_test_comparison.py</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L65" data-line-number="65"></td>
        <td id="file-examplewafflettest-ts-LC65">        <span>// For the following inputs:</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L66" data-line-number="66"></td>
        <td id="file-examplewafflettest-ts-LC66">        <span>// num_pools = 5 # Number of pools available for this pair</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L67" data-line-number="67"></td>
        <td id="file-examplewafflettest-ts-LC67">        <span>// max_n_pools = 4</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L68" data-line-number="68"></td>
        <td id="file-examplewafflettest-ts-LC68">        <span>// swap_type = "swapExactOut"</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L69" data-line-number="69"></td>
        <td id="file-examplewafflettest-ts-LC69">        <span>// input_amount = 100000 # Number of tokens in the trader wants to sell</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L70" data-line-number="70"></td>
        <td id="file-examplewafflettest-ts-LC70">        <span>// output_token_eth_price = 0 # One output token buys 0.01 eth</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L71" data-line-number="71"></td>
        <td id="file-examplewafflettest-ts-LC71">        <span>// seed = 1</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L72" data-line-number="72"></td>
        <td id="file-examplewafflettest-ts-LC72">        <span>let</span> <span>poolsData</span> <span>=</span> <span>[</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L73" data-line-number="73"></td>
        <td id="file-examplewafflettest-ts-LC73">            <span>{</span>   <span>'Bmkr'</span>: <span>1033191.1981189704</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L74" data-line-number="74"></td>
        <td id="file-examplewafflettest-ts-LC74">                <span>'Bweth'</span>: <span>21709.92411864851</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L75" data-line-number="75"></td>
        <td id="file-examplewafflettest-ts-LC75">                <span>'Wmkr'</span>: <span>8.261291241849618</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L76" data-line-number="76"></td>
        <td id="file-examplewafflettest-ts-LC76">                <span>'Wweth'</span>: <span>1.7387087581503824</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L77" data-line-number="77"></td>
        <td id="file-examplewafflettest-ts-LC77">                <span>'fee'</span>: <span>0.015</span><span>}</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L78" data-line-number="78"></td>
        <td id="file-examplewafflettest-ts-LC78">            <span>{</span>   <span>'Bmkr'</span>: <span>911870.2026231368</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L79" data-line-number="79"></td>
        <td id="file-examplewafflettest-ts-LC79">                <span>'Bweth'</span>: <span>30347.518852549234</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L80" data-line-number="80"></td>
        <td id="file-examplewafflettest-ts-LC80">                <span>'Wmkr'</span>: <span>7.509918308978633</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L81" data-line-number="81"></td>
        <td id="file-examplewafflettest-ts-LC81">                <span>'Wweth'</span>: <span>2.4900816910213672</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L82" data-line-number="82"></td>
        <td id="file-examplewafflettest-ts-LC82">                <span>'fee'</span>: <span>0.025</span><span>}</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L83" data-line-number="83"></td>
        <td id="file-examplewafflettest-ts-LC83">            <span>{</span>   <span>'Bmkr'</span>: <span>1199954.250073062</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L84" data-line-number="84"></td>
        <td id="file-examplewafflettest-ts-LC84">                <span>'Bweth'</span>: <span>72017.58337846321</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L85" data-line-number="85"></td>
        <td id="file-examplewafflettest-ts-LC85">                <span>'Wmkr'</span>: <span>6.235514183655618</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L86" data-line-number="86"></td>
        <td id="file-examplewafflettest-ts-LC86">                <span>'Wweth'</span>: <span>3.764485816344382</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L87" data-line-number="87"></td>
        <td id="file-examplewafflettest-ts-LC87">                <span>'fee'</span>: <span>0.01</span><span>}</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L88" data-line-number="88"></td>
        <td id="file-examplewafflettest-ts-LC88">            <span>{</span>   <span>'Bmkr'</span>: <span>1079066.970947264</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L89" data-line-number="89"></td>
        <td id="file-examplewafflettest-ts-LC89">                <span>'Bweth'</span>: <span>77902.62602094973</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L90" data-line-number="90"></td>
        <td id="file-examplewafflettest-ts-LC90">                <span>'Wmkr'</span>: <span>5.8258602061546405</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L91" data-line-number="91"></td>
        <td id="file-examplewafflettest-ts-LC91">                <span>'Wweth'</span>: <span>4.1741397938453595</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L92" data-line-number="92"></td>
        <td id="file-examplewafflettest-ts-LC92">                <span>'fee'</span>: <span>0.01</span><span>}</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L93" data-line-number="93"></td>
        <td id="file-examplewafflettest-ts-LC93">            <span>{</span>   <span>'Bmkr'</span>: <span>1141297.6436731548</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L94" data-line-number="94"></td>
        <td id="file-examplewafflettest-ts-LC94">                <span>'Bweth'</span>: <span>128034.7686206643</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L95" data-line-number="95"></td>
        <td id="file-examplewafflettest-ts-LC95">                <span>'Wmkr'</span>: <span>4.689466127973144</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L96" data-line-number="96"></td>
        <td id="file-examplewafflettest-ts-LC96">                <span>'Wweth'</span>: <span>5.310533872026856</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L97" data-line-number="97"></td>
        <td id="file-examplewafflettest-ts-LC97">                <span>'fee'</span>: <span>0.005</span><span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L98" data-line-number="98"></td>
        <td id="file-examplewafflettest-ts-LC98">        <span>]</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L99" data-line-number="99"></td>
        <td id="file-examplewafflettest-ts-LC99">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L100" data-line-number="100"></td>
        <td id="file-examplewafflettest-ts-LC100">        <span>for</span> <span>(</span><span>var</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>poolsData</span><span>.</span><span>length</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L101" data-line-number="101"></td>
        <td id="file-examplewafflettest-ts-LC101">            <span>let</span> <span>poolAddr</span> <span>=</span> <span>await</span> <span>factory</span><span>.</span><span>callStatic</span><span>.</span><span>newBPool</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L102" data-line-number="102"></td>
        <td id="file-examplewafflettest-ts-LC102">            <span>_POOLS</span><span>.</span><span>push</span><span>(</span><span>poolAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L103" data-line-number="103"></td>
        <td id="file-examplewafflettest-ts-LC103">            <span>await</span> <span>factory</span><span>.</span><span>newBPool</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L104" data-line-number="104"></td>
        <td id="file-examplewafflettest-ts-LC104">            <span>let</span> <span>poolContract</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getContractAt</span><span>(</span><span>"BPool"</span><span>,</span> <span>poolAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L105" data-line-number="105"></td>
        <td id="file-examplewafflettest-ts-LC105">            <span>_pools</span><span>.</span><span>push</span><span>(</span><span>poolContract</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L106" data-line-number="106"></td>
        <td id="file-examplewafflettest-ts-LC106">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L107" data-line-number="107"></td>
        <td id="file-examplewafflettest-ts-LC107">            <span>await</span> <span>weth9</span><span>.</span><span>approve</span><span>(</span><span>_POOLS</span><span>[</span><span>i</span><span>]</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L108" data-line-number="108"></td>
        <td id="file-examplewafflettest-ts-LC108">            <span>await</span> <span>mkr</span><span>.</span><span>approve</span><span>(</span><span>_POOLS</span><span>[</span><span>i</span><span>]</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L109" data-line-number="109"></td>
        <td id="file-examplewafflettest-ts-LC109">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L110" data-line-number="110"></td>
        <td id="file-examplewafflettest-ts-LC110">            <span>await</span> <span>_pools</span><span>[</span><span>i</span><span>]</span><span>.</span><span>bind</span><span>(</span><span>WETH</span><span>,</span> <span>toWei</span><span>(</span><span>poolsData</span><span>[</span><span>i</span><span>]</span><span>[</span><span>'Bweth'</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>,</span> <span>toWei</span><span>(</span><span>poolsData</span><span>[</span><span>i</span><span>]</span><span>[</span><span>'Wweth'</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L111" data-line-number="111"></td>
        <td id="file-examplewafflettest-ts-LC111">            <span>await</span> <span>_pools</span><span>[</span><span>i</span><span>]</span><span>.</span><span>bind</span><span>(</span><span>MKR</span><span>,</span> <span>toWei</span><span>(</span><span>poolsData</span><span>[</span><span>i</span><span>]</span><span>[</span><span>'Bmkr'</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>,</span> <span>toWei</span><span>(</span><span>poolsData</span><span>[</span><span>i</span><span>]</span><span>[</span><span>'Wmkr'</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L112" data-line-number="112"></td>
        <td id="file-examplewafflettest-ts-LC112">            <span>await</span> <span>_pools</span><span>[</span><span>i</span><span>]</span><span>.</span><span>setSwapFee</span><span>(</span><span>toWei</span><span>(</span><span>poolsData</span><span>[</span><span>i</span><span>]</span><span>[</span><span>'fee'</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L113" data-line-number="113"></td>
        <td id="file-examplewafflettest-ts-LC113">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L114" data-line-number="114"></td>
        <td id="file-examplewafflettest-ts-LC114">            <span>await</span> <span>_pools</span><span>[</span><span>i</span><span>]</span><span>.</span><span>finalize</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L115" data-line-number="115"></td>
        <td id="file-examplewafflettest-ts-LC115">            <span>/*</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L116" data-line-number="116"></td>
        <td id="file-examplewafflettest-ts-LC116"><span>            console.log("Pool "+i.toString()+": "+_POOLS[i]+", Liquidity WETH-MKR: "+</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L117" data-line-number="117"></td>
        <td id="file-examplewafflettest-ts-LC117"><span>                await registry.getNormalizedLiquidity.call(MKR, WETH, _POOLS[i]))</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L118" data-line-number="118"></td>
        <td id="file-examplewafflettest-ts-LC118"><span>            */</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L119" data-line-number="119"></td>
        <td id="file-examplewafflettest-ts-LC119">        <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L120" data-line-number="120"></td>
        <td id="file-examplewafflettest-ts-LC120">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L121" data-line-number="121"></td>
        <td id="file-examplewafflettest-ts-LC121">        <span>// Proposing registry. NOTICE _POOLS[0] has been left out since it would make up less than 10% of total liquidity</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L122" data-line-number="122"></td>
        <td id="file-examplewafflettest-ts-LC122">        <span>await</span> <span>registry</span><span>.</span><span>addPools</span><span>(</span><span>[</span><span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span> <span>_POOLS</span><span>[</span><span>2</span><span>]</span><span>,</span> <span>_POOLS</span><span>[</span><span>3</span><span>]</span><span>,</span> <span>_POOLS</span><span>[</span><span>4</span><span>]</span><span>]</span><span>,</span> <span>MKR</span><span>,</span> <span>WETH</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L123" data-line-number="123"></td>
        <td id="file-examplewafflettest-ts-LC123">        <span>await</span> <span>registry</span><span>.</span><span>sortPools</span><span>(</span><span>[</span><span>MKR</span><span>,</span> <span>WETH</span><span>]</span><span>,</span> <span>10</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L124" data-line-number="124"></td>
        <td id="file-examplewafflettest-ts-LC124">    <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L125" data-line-number="125"></td>
        <td id="file-examplewafflettest-ts-LC125">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L126" data-line-number="126"></td>
        <td id="file-examplewafflettest-ts-LC126">    <span>it</span><span>(</span><span>'joinswapExternAmountIn, MKR In'</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L127" data-line-number="127"></td>
        <td id="file-examplewafflettest-ts-LC127">        <span>const</span> <span>[</span><span>,</span> <span>newUserSigner</span><span>]</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getSigners</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L128" data-line-number="128"></td>
        <td id="file-examplewafflettest-ts-LC128">        <span>const</span> <span>newUserAddr</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getAddress</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L129" data-line-number="129"></td>
        <td id="file-examplewafflettest-ts-LC129">        <span>const</span> <span>amountIn</span> <span>=</span> <span>toWei</span><span>(</span><span>'1000'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L130" data-line-number="130"></td>
        <td id="file-examplewafflettest-ts-LC130">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L131" data-line-number="131"></td>
        <td id="file-examplewafflettest-ts-LC131">        <span>await</span> <span>mkr</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>approve</span><span>(</span><span>PROXY</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L132" data-line-number="132"></td>
        <td id="file-examplewafflettest-ts-LC132">        <span>await</span> <span>mkr</span><span>.</span><span>mint</span><span>(</span><span>newUserAddr</span><span>,</span> <span>amountIn</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L133" data-line-number="133"></td>
        <td id="file-examplewafflettest-ts-LC133">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L134" data-line-number="134"></td>
        <td id="file-examplewafflettest-ts-LC134">        <span>const</span> <span>startingMkrBalance</span> <span>=</span> <span>await</span> <span>mkr</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L135" data-line-number="135"></td>
        <td id="file-examplewafflettest-ts-LC135">        <span>const</span> <span>startingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L136" data-line-number="136"></td>
        <td id="file-examplewafflettest-ts-LC136">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L137" data-line-number="137"></td>
        <td id="file-examplewafflettest-ts-LC137">        <span>expect</span><span>(</span><span>startingBptBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>0</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L138" data-line-number="138"></td>
        <td id="file-examplewafflettest-ts-LC138">        <span>expect</span><span>(</span><span>startingMkrBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>amountIn</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L139" data-line-number="139"></td>
        <td id="file-examplewafflettest-ts-LC139">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L140" data-line-number="140"></td>
        <td id="file-examplewafflettest-ts-LC140">        <span>const</span> <span>poolAmountOut</span> <span>=</span> <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>callStatic</span><span>.</span><span>joinswapExternAmountIn</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L141" data-line-number="141"></td>
        <td id="file-examplewafflettest-ts-LC141">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L142" data-line-number="142"></td>
        <td id="file-examplewafflettest-ts-LC142">            <span>MKR</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L143" data-line-number="143"></td>
        <td id="file-examplewafflettest-ts-LC143">            <span>amountIn</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L144" data-line-number="144"></td>
        <td id="file-examplewafflettest-ts-LC144">            <span>toWei</span><span>(</span><span>'0'</span><span>)</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L145" data-line-number="145"></td>
        <td id="file-examplewafflettest-ts-LC145">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L146" data-line-number="146"></td>
        <td id="file-examplewafflettest-ts-LC146">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L147" data-line-number="147"></td>
        <td id="file-examplewafflettest-ts-LC147">        <span>expect</span><span>(</span><span>poolAmountOut</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>'81833525388142100'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L148" data-line-number="148"></td>
        <td id="file-examplewafflettest-ts-LC148">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L149" data-line-number="149"></td>
        <td id="file-examplewafflettest-ts-LC149">        <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>joinswapExternAmountIn</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L150" data-line-number="150"></td>
        <td id="file-examplewafflettest-ts-LC150">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L151" data-line-number="151"></td>
        <td id="file-examplewafflettest-ts-LC151">            <span>MKR</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L152" data-line-number="152"></td>
        <td id="file-examplewafflettest-ts-LC152">            <span>amountIn</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L153" data-line-number="153"></td>
        <td id="file-examplewafflettest-ts-LC153">            <span>toWei</span><span>(</span><span>'0'</span><span>)</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L154" data-line-number="154"></td>
        <td id="file-examplewafflettest-ts-LC154">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L155" data-line-number="155"></td>
        <td id="file-examplewafflettest-ts-LC155">              <span>gasPrice</span>: <span>0</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L156" data-line-number="156"></td>
        <td id="file-examplewafflettest-ts-LC156">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L157" data-line-number="157"></td>
        <td id="file-examplewafflettest-ts-LC157">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L158" data-line-number="158"></td>
        <td id="file-examplewafflettest-ts-LC158">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L159" data-line-number="159"></td>
        <td id="file-examplewafflettest-ts-LC159">        <span>const</span> <span>endingMkrBalance</span> <span>=</span> <span>await</span> <span>mkr</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L160" data-line-number="160"></td>
        <td id="file-examplewafflettest-ts-LC160">        <span>const</span> <span>endingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L161" data-line-number="161"></td>
        <td id="file-examplewafflettest-ts-LC161">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L162" data-line-number="162"></td>
        <td id="file-examplewafflettest-ts-LC162">        <span>expect</span><span>(</span><span>endingMkrBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>0</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L163" data-line-number="163"></td>
        <td id="file-examplewafflettest-ts-LC163">        <span>expect</span><span>(</span><span>endingBptBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>poolAmountOut</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L164" data-line-number="164"></td>
        <td id="file-examplewafflettest-ts-LC164">    <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L165" data-line-number="165"></td>
        <td id="file-examplewafflettest-ts-LC165">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L166" data-line-number="166"></td>
        <td id="file-examplewafflettest-ts-LC166">    <span>it</span><span>(</span><span>'exitswapExternAmountOut, MKR Out'</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L167" data-line-number="167"></td>
        <td id="file-examplewafflettest-ts-LC167">        <span>const</span> <span>[</span><span>,</span> <span>newUserSigner</span><span>]</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getSigners</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L168" data-line-number="168"></td>
        <td id="file-examplewafflettest-ts-LC168">        <span>const</span> <span>newUserAddr</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getAddress</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L169" data-line-number="169"></td>
        <td id="file-examplewafflettest-ts-LC169">        <span>const</span> <span>amountOut</span> <span>=</span> <span>toWei</span><span>(</span><span>'100'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L170" data-line-number="170"></td>
        <td id="file-examplewafflettest-ts-LC170">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L171" data-line-number="171"></td>
        <td id="file-examplewafflettest-ts-LC171">        <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>approve</span><span>(</span><span>PROXY</span><span>,</span> <span>MAX</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L172" data-line-number="172"></td>
        <td id="file-examplewafflettest-ts-LC172">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L173" data-line-number="173"></td>
        <td id="file-examplewafflettest-ts-LC173">        <span>const</span> <span>startingMkrBalance</span> <span>=</span> <span>await</span> <span>mkr</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L174" data-line-number="174"></td>
        <td id="file-examplewafflettest-ts-LC174">        <span>const</span> <span>startingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L175" data-line-number="175"></td>
        <td id="file-examplewafflettest-ts-LC175">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L176" data-line-number="176"></td>
        <td id="file-examplewafflettest-ts-LC176">        <span>expect</span><span>(</span><span>startingMkrBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>0</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L177" data-line-number="177"></td>
        <td id="file-examplewafflettest-ts-LC177">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L178" data-line-number="178"></td>
        <td id="file-examplewafflettest-ts-LC178">        <span>const</span> <span>poolAmountIn</span> <span>=</span> <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>callStatic</span><span>.</span><span>exitswapExternAmountOut</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L179" data-line-number="179"></td>
        <td id="file-examplewafflettest-ts-LC179">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L180" data-line-number="180"></td>
        <td id="file-examplewafflettest-ts-LC180">            <span>MKR</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L181" data-line-number="181"></td>
        <td id="file-examplewafflettest-ts-LC181">            <span>amountOut</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L182" data-line-number="182"></td>
        <td id="file-examplewafflettest-ts-LC182">            <span>startingBptBalance</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L183" data-line-number="183"></td>
        <td id="file-examplewafflettest-ts-LC183">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L184" data-line-number="184"></td>
        <td id="file-examplewafflettest-ts-LC184">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L185" data-line-number="185"></td>
        <td id="file-examplewafflettest-ts-LC185">        <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>exitswapExternAmountOut</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L186" data-line-number="186"></td>
        <td id="file-examplewafflettest-ts-LC186">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L187" data-line-number="187"></td>
        <td id="file-examplewafflettest-ts-LC187">            <span>MKR</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L188" data-line-number="188"></td>
        <td id="file-examplewafflettest-ts-LC188">            <span>amountOut</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L189" data-line-number="189"></td>
        <td id="file-examplewafflettest-ts-LC189">            <span>startingBptBalance</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L190" data-line-number="190"></td>
        <td id="file-examplewafflettest-ts-LC190">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L191" data-line-number="191"></td>
        <td id="file-examplewafflettest-ts-LC191">              <span>gasPrice</span>: <span>0</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L192" data-line-number="192"></td>
        <td id="file-examplewafflettest-ts-LC192">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L193" data-line-number="193"></td>
        <td id="file-examplewafflettest-ts-LC193">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L194" data-line-number="194"></td>
        <td id="file-examplewafflettest-ts-LC194">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L195" data-line-number="195"></td>
        <td id="file-examplewafflettest-ts-LC195">        <span>const</span> <span>endingMkrBalance</span> <span>=</span> <span>await</span> <span>mkr</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L196" data-line-number="196"></td>
        <td id="file-examplewafflettest-ts-LC196">        <span>const</span> <span>endingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L197" data-line-number="197"></td>
        <td id="file-examplewafflettest-ts-LC197">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L198" data-line-number="198"></td>
        <td id="file-examplewafflettest-ts-LC198">        <span>expect</span><span>(</span><span>endingMkrBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>amountOut</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L199" data-line-number="199"></td>
        <td id="file-examplewafflettest-ts-LC199">        <span>expect</span><span>(</span><span>endingBptBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>startingBptBalance</span><span>.</span><span>sub</span><span>(</span><span>poolAmountIn</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L200" data-line-number="200"></td>
        <td id="file-examplewafflettest-ts-LC200">    <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L201" data-line-number="201"></td>
        <td id="file-examplewafflettest-ts-LC201">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L202" data-line-number="202"></td>
        <td id="file-examplewafflettest-ts-LC202">    <span>it</span><span>(</span><span>'joinswapExternAmountIn, ETH In'</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L203" data-line-number="203"></td>
        <td id="file-examplewafflettest-ts-LC203">        <span>const</span> <span>[</span><span>,</span> <span>newUserSigner</span><span>]</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getSigners</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L204" data-line-number="204"></td>
        <td id="file-examplewafflettest-ts-LC204">        <span>const</span> <span>newUserAddr</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getAddress</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L205" data-line-number="205"></td>
        <td id="file-examplewafflettest-ts-LC205">        <span>const</span> <span>amountIn</span> <span>=</span> <span>toWei</span><span>(</span><span>'1000'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L206" data-line-number="206"></td>
        <td id="file-examplewafflettest-ts-LC206">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L207" data-line-number="207"></td>
        <td id="file-examplewafflettest-ts-LC207">        <span>const</span> <span>startingEthBalance</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getBalance</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L208" data-line-number="208"></td>
        <td id="file-examplewafflettest-ts-LC208">        <span>const</span> <span>startingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L209" data-line-number="209"></td>
        <td id="file-examplewafflettest-ts-LC209">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L210" data-line-number="210"></td>
        <td id="file-examplewafflettest-ts-LC210">        <span>const</span> <span>poolAmountOut</span> <span>=</span> <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>callStatic</span><span>.</span><span>joinswapExternAmountIn</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L211" data-line-number="211"></td>
        <td id="file-examplewafflettest-ts-LC211">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L212" data-line-number="212"></td>
        <td id="file-examplewafflettest-ts-LC212">            <span>ETH</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L213" data-line-number="213"></td>
        <td id="file-examplewafflettest-ts-LC213">            <span>amountIn</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L214" data-line-number="214"></td>
        <td id="file-examplewafflettest-ts-LC214">            <span>toWei</span><span>(</span><span>'0'</span><span>)</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L215" data-line-number="215"></td>
        <td id="file-examplewafflettest-ts-LC215">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L216" data-line-number="216"></td>
        <td id="file-examplewafflettest-ts-LC216">              <span>value</span>: <span>amountIn</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L217" data-line-number="217"></td>
        <td id="file-examplewafflettest-ts-LC217">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L218" data-line-number="218"></td>
        <td id="file-examplewafflettest-ts-LC218">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L219" data-line-number="219"></td>
        <td id="file-examplewafflettest-ts-LC219">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L220" data-line-number="220"></td>
        <td id="file-examplewafflettest-ts-LC220">        <span>let</span> <span>tx</span> <span>=</span> <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>joinswapExternAmountIn</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L221" data-line-number="221"></td>
        <td id="file-examplewafflettest-ts-LC221">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L222" data-line-number="222"></td>
        <td id="file-examplewafflettest-ts-LC222">            <span>ETH</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L223" data-line-number="223"></td>
        <td id="file-examplewafflettest-ts-LC223">            <span>amountIn</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L224" data-line-number="224"></td>
        <td id="file-examplewafflettest-ts-LC224">            <span>toWei</span><span>(</span><span>'0'</span><span>)</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L225" data-line-number="225"></td>
        <td id="file-examplewafflettest-ts-LC225">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L226" data-line-number="226"></td>
        <td id="file-examplewafflettest-ts-LC226">              <span>gasPrice</span>: <span>0</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L227" data-line-number="227"></td>
        <td id="file-examplewafflettest-ts-LC227">              <span>value</span>: <span>amountIn</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L228" data-line-number="228"></td>
        <td id="file-examplewafflettest-ts-LC228">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L229" data-line-number="229"></td>
        <td id="file-examplewafflettest-ts-LC229">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L230" data-line-number="230"></td>
        <td id="file-examplewafflettest-ts-LC230">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L231" data-line-number="231"></td>
        <td id="file-examplewafflettest-ts-LC231">        <span>const</span> <span>endingEthBalance</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getBalance</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L232" data-line-number="232"></td>
        <td id="file-examplewafflettest-ts-LC232">        <span>const</span> <span>endingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L233" data-line-number="233"></td>
        <td id="file-examplewafflettest-ts-LC233">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L234" data-line-number="234"></td>
        <td id="file-examplewafflettest-ts-LC234">        <span>expect</span><span>(</span><span>endingEthBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>startingEthBalance</span><span>.</span><span>sub</span><span>(</span><span>amountIn</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L235" data-line-number="235"></td>
        <td id="file-examplewafflettest-ts-LC235">        <span>expect</span><span>(</span><span>poolAmountOut</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>endingBptBalance</span><span>.</span><span>sub</span><span>(</span><span>startingBptBalance</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L236" data-line-number="236"></td>
        <td id="file-examplewafflettest-ts-LC236">    <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L237" data-line-number="237"></td>
        <td id="file-examplewafflettest-ts-LC237">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L238" data-line-number="238"></td>
        <td id="file-examplewafflettest-ts-LC238">    <span>it</span><span>(</span><span>'exitswapExternAmountOut, ETH Out'</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L239" data-line-number="239"></td>
        <td id="file-examplewafflettest-ts-LC239">        <span>const</span> <span>[</span><span>,</span> <span>newUserSigner</span><span>]</span> <span>=</span> <span>await</span> <span>ethers</span><span>.</span><span>getSigners</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L240" data-line-number="240"></td>
        <td id="file-examplewafflettest-ts-LC240">        <span>const</span> <span>newUserAddr</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getAddress</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L241" data-line-number="241"></td>
        <td id="file-examplewafflettest-ts-LC241">        <span>const</span> <span>amountOut</span> <span>=</span> <span>toWei</span><span>(</span><span>'100'</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L242" data-line-number="242"></td>
        <td id="file-examplewafflettest-ts-LC242">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L243" data-line-number="243"></td>
        <td id="file-examplewafflettest-ts-LC243">        <span>const</span> <span>startingEthBalance</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getBalance</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L244" data-line-number="244"></td>
        <td id="file-examplewafflettest-ts-LC244">        <span>const</span> <span>startingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L245" data-line-number="245"></td>
        <td id="file-examplewafflettest-ts-LC245">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L246" data-line-number="246"></td>
        <td id="file-examplewafflettest-ts-LC246">        <span>const</span> <span>poolAmountIn</span> <span>=</span> <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>callStatic</span><span>.</span><span>exitswapExternAmountOut</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L247" data-line-number="247"></td>
        <td id="file-examplewafflettest-ts-LC247">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L248" data-line-number="248"></td>
        <td id="file-examplewafflettest-ts-LC248">            <span>ETH</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L249" data-line-number="249"></td>
        <td id="file-examplewafflettest-ts-LC249">            <span>amountOut</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L250" data-line-number="250"></td>
        <td id="file-examplewafflettest-ts-LC250">            <span>startingBptBalance</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L251" data-line-number="251"></td>
        <td id="file-examplewafflettest-ts-LC251">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L252" data-line-number="252"></td>
        <td id="file-examplewafflettest-ts-LC252">              <span>gasPrice</span>: <span>0</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L253" data-line-number="253"></td>
        <td id="file-examplewafflettest-ts-LC253">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L254" data-line-number="254"></td>
        <td id="file-examplewafflettest-ts-LC254">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L255" data-line-number="255"></td>
        <td id="file-examplewafflettest-ts-LC255">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L256" data-line-number="256"></td>
        <td id="file-examplewafflettest-ts-LC256">        <span>await</span> <span>proxy</span><span>.</span><span>connect</span><span>(</span><span>newUserSigner</span><span>)</span><span>.</span><span>exitswapExternAmountOut</span><span>(</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L257" data-line-number="257"></td>
        <td id="file-examplewafflettest-ts-LC257">            <span>_POOLS</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L258" data-line-number="258"></td>
        <td id="file-examplewafflettest-ts-LC258">            <span>ETH</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L259" data-line-number="259"></td>
        <td id="file-examplewafflettest-ts-LC259">            <span>amountOut</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L260" data-line-number="260"></td>
        <td id="file-examplewafflettest-ts-LC260">            <span>startingBptBalance</span><span>,</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L261" data-line-number="261"></td>
        <td id="file-examplewafflettest-ts-LC261">            <span>{</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L262" data-line-number="262"></td>
        <td id="file-examplewafflettest-ts-LC262">              <span>gasPrice</span>: <span>0</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L263" data-line-number="263"></td>
        <td id="file-examplewafflettest-ts-LC263">            <span>}</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L264" data-line-number="264"></td>
        <td id="file-examplewafflettest-ts-LC264">        <span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L265" data-line-number="265"></td>
        <td id="file-examplewafflettest-ts-LC265">        <span>// 999999998999.999291088</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L266" data-line-number="266"></td>
        <td id="file-examplewafflettest-ts-LC266">        <span>// 999999999099.999291088</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L267" data-line-number="267"></td>
        <td id="file-examplewafflettest-ts-LC267">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L268" data-line-number="268"></td>
        <td id="file-examplewafflettest-ts-LC268">        <span>const</span> <span>endingEthBalance</span> <span>=</span> <span>await</span> <span>newUserSigner</span><span>.</span><span>getBalance</span><span>(</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L269" data-line-number="269"></td>
        <td id="file-examplewafflettest-ts-LC269">        <span>const</span> <span>endingBptBalance</span> <span>=</span> <span>await</span> <span>_pools</span><span>[</span><span>1</span><span>]</span><span>.</span><span>balanceOf</span><span>(</span><span>newUserAddr</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L270" data-line-number="270"></td>
        <td id="file-examplewafflettest-ts-LC270">        <span>console</span><span>.</span><span>log</span><span>(</span><span>startingEthBalance</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L271" data-line-number="271"></td>
        <td id="file-examplewafflettest-ts-LC271">        <span>console</span><span>.</span><span>log</span><span>(</span><span>endingEthBalance</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L272" data-line-number="272"></td>
        <td id="file-examplewafflettest-ts-LC272">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L273" data-line-number="273"></td>
        <td id="file-examplewafflettest-ts-LC273">        <span>expect</span><span>(</span><span>endingEthBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>startingEthBalance</span><span>.</span><span>add</span><span>(</span><span>amountOut</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L274" data-line-number="274"></td>
        <td id="file-examplewafflettest-ts-LC274">        <span>expect</span><span>(</span><span>endingBptBalance</span><span>)</span><span>.</span><span>to</span><span>.</span><span>equal</span><span>(</span><span>startingBptBalance</span><span>.</span><span>sub</span><span>(</span><span>poolAmountIn</span><span>)</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L275" data-line-number="275"></td>
        <td id="file-examplewafflettest-ts-LC275">    <span>}</span><span>)</span><span>;</span></td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L276" data-line-number="276"></td>
        <td id="file-examplewafflettest-ts-LC276">
</td>
      </tr>
      <tr>
        <td id="file-examplewafflettest-ts-L277" data-line-number="277"></td>
        <td id="file-examplewafflettest-ts-LC277"><span>}</span><span>)</span><span>;</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>