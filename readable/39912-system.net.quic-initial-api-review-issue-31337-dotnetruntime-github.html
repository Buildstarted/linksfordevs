<!DOCTYPE html>
<html lang="en">
<head>
    <title>
System.Net.Quic initial API review &#xB7; Issue #31337 &#xB7; dotnet/runtime &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>System.Net.Quic initial API review ¬∑ Issue #31337 ¬∑ dotnet/runtime ¬∑ GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-en">QuicConnection</span>(<span class="pl-en">IPEndPoint</span><span class="pl-smi">remoteEndPoint</span>, <span class="pl-smi">System</span>.<span class="pl-smi">Net</span>.<span class="pl-smi">Security</span>.<span class="pl-smi">SslClientAuthenticationOptions</span><span class="pl-smi">sslClientAuthenticationOptions</span>, <span class="pl-smi">IPEndPoint</span><span class="pl-smi">localEndPoint</span><span class="pl-k">=</span><span class="pl-c1">null</span>, <span class="pl-smi">bool</span><span class="pl-smi">mock</span><span class="pl-k">=</span><span class="pl-c1">false</span>);</pre></div></blockquote><p>I think there may be value in other EndPoint types at some point, but we can add ctors later. One thing that comes to mind is that we could use an <code>EndPoint</code> to coordinate the mock in-memory version. If we add a ctor like this:</p><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-en">QuicConnection</span>(<span class="pl-en">MemoryEndPoint</span><span class="pl-smi">memoryEndPoint</span>, <span class="pl-smi">System</span>.<span class="pl-smi">Net</span>.<span class="pl-smi">Security</span>.<span class="pl-smi">SslClientAuthenticationOptions</span><span class="pl-smi">sslClientAuthenticationOptions</span>)</pre></div><p>Where <code>MemoryEndPoint</code> is mostly an "opaque" type from a user perspective that helps coordinate things so that two <code>QuicConnection</code> that are given the same <code>MemoryEndPoint</code> can talk to each other. Kestrel and HttpClient can be tested in memory then by using the same instance.</p><p>Since that's all just temporary during feature development, it wouldn't need a huge amount of rigorous design, as long as we were very clear on when we were getting rid of it. It could even be marked <code>Obsolete</code> in advance or something <g-emoji class="g-emoji" alias="cat" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f431.png">üê±</g-emoji>.</p><blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-en">QuicStream</span><span class="pl-en">CreateUnidirectionalStream</span>();
        <span class="pl-k">public</span><span class="pl-en">QuicStream</span><span class="pl-en">CreateBidirectionalStream</span>();</pre></div></blockquote><p>I like the name <code>Open</code>, but that's just a preference.</p><p>Any thoughts on an API that lets you set the stream ID? I'm thinking of possible protocols that assign semantics to specific stream IDs. HTTP/3 doesn't do that (instead you have to send a "stream type" message as the first message on a stream) but some protocol might. We would probably want to validate that the stream ID is valid for the purpose (which may mean the connection has to know if it's the client or the server...). Just a thought.</p><blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-smi">int</span><span class="pl-smi">StreamId</span> { <span class="pl-smi">get</span>; }</pre></div></blockquote><p>Should probably be a <code>long</code>? Or even a <code>ulong</code> (though we generally don't use those)? The largest stream ID is <code>2^62-1</code> (<a href="https://quicwg.org/base-drafts/draft-ietf-quic-transport.html#stream-id" rel="nofollow">Source</a>).</p><blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-k">void</span><span class="pl-en">ShutdownRead</span>();
        <span class="pl-k">public</span><span class="pl-k">void</span><span class="pl-en">ShutdownWrite</span>();</pre></div></blockquote><p><a href="https://source.dot.net/#System.Net.Sockets/System/Net/Sockets/Socket.cs,54ee9c8f4898f6a9" rel="nofollow"><code>Socket</code> has a single <code>Shutdown</code> API</a> with an enum to select how to shutdown (Read, Write or Both). Should we do the same? We could even borrow <a href="https://source.dot.net/#System.Net.Sockets/System/Net/Sockets/SocketShutdown.cs,54ee9c8f4898f6a9" rel="nofollow">the same enum</a>.</p><blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span><span class="pl-k">sealed</span><span class="pl-k">class</span><span class="pl-en">QuicStream</span> : <span class="pl-k">System</span>.<span class="pl-k">IO</span>.<span class="pl-en">Stream</span></pre></div></blockquote><p>Not sure I like inheriting here. I'd prefer a model where the stream is exposed as a property. That could also give us the option to expose pipes later and change which is "authoritative" (i.e. change to a Pipe and make the Stream a wrapper around the Pipe, or vice versa).</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>