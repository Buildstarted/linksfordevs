<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Introducing C# Source Generators | .NET Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Introducing C# Source Generators | .NET Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Phillip CarterProgram Manager, .NET and LanguagesFollow"/>
    <meta property="og:description" content="We&#x2019;re pleased to introduce the first preview of Source Generators, a new C# compiler feature that lets C# developers inspect user code and generate new C# source files that can be added to a compilation. This is done via a new kind of component that we&#x2019;re calling a Source Generator."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Introducing C# Source Generators | .NET Blog</title>
<div class="readable">
        <h1>Introducing C# Source Generators | .NET Blog</h1>
            <div>by Phillip CarterProgram Manager, .NET and LanguagesFollow</div>
            <div>Reading time: 22-27 minutes</div>
        <div>Posted here: 29 Apr 2020</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/">https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2018/10/Phillip-Carter-150x150.png" width="58" height="58" alt="Phillip Carter"></p><p>Phillip</p></div></div></div><p>April 29th, 2020</p><p>We’re pleased to introduce the first preview of Source Generators, a new C# compiler feature that lets C# developers inspect user code and generate new C# source files that can be added to a compilation. This is done via a new kind of component that we’re calling a Source Generator.</p><p>To get started with Source Generators, you’ll need to install the latest <a href="https://dotnet.microsoft.com/download/dotnet/5.0" target="_blank">.NET 5 preview</a> and the latest <a href="https://visualstudio.microsoft.com/vs/preview/" target="_blank">Visual Studio preview</a>.</p><h3>What is a Source Generator?</h3><p>Unless you’ve been closely following every prototype and proposal related to the C# language and compiler, then there’s a good chance you’re asking, “What is a Source Generator” right now. A Source Generator is a piece of code that runs during compilation and can inspect your program to produce additional files that are compiled together with the rest of your code.</p><p>A Source Generator is a new kind of component that C# developers can write that lets you do two major things:</p><ol><li>Retrieve a <em>Compilation</em> object that represents all user code that is being compiled. This object can be inspected and you can write code that works with the syntax and semantic models for the code being compiled, just like with analyzers today.</li><li>Generate C# source files that can be added to a <em>Compilation</em> object during the course of compilation. In other words, you can provide additional source code as input to a compilation while the code is being compiled.</li></ol><p>When combined, these two things are what make Source Generators so useful. You can inspect user code with all of the rich metadata that the compiler builds up during compilation, then emit C# code back into the same compilation that is based on the data you’ve analyzed! If you’re familiar with Roslyn Analyzers, you can think of Source Generators as analyzers that can emit C# source code.</p><p>Source generators run as a phase of compilation visualized below:</p><p><a href="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1.png" alt="Image Picture1" width="1824" height="723" srcset="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1.png 1824w, https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1-300x119.png 300w, https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1-1024x406.png 1024w, https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1-768x304.png 768w, https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/04/Picture1-1536x609.png 1536w" sizes="(max-width: 1824px) 100vw, 1824px"> </a></p><p>A Source Generator is a .NET Standard 2.0 assembly that is loaded by the compiler along with any <a href="https://docs.microsoft.com/visualstudio/code-quality/roslyn-analyzers-overview" target="_blank">analyzers</a>. It is usable in environments where .NET Standard components can be loaded and run.</p><p>Now that you know what a Source Generator is, let’s go through some of the scenarios they can improve.</p><h3>Example scenarios that can benefit from Source Generators</h3><p>The most important aspect of a Source Generator isn’t what it is, but what it can enable.</p><p>Today, there are three general approaches to inspecting user code and generating information or code based on that analysis used by technologies today: runtime reflection, IL weaving, and juggling MSBuild tasks. Source Generators can be an improvement over each approach.</p><p>Runtime reflection is a powerful technology that was added to .NET a long time ago. There are countless scenarios for using it. A very common scenario is to perform some analysis of user code when an app starts up and use that data to generate things.</p><p>For example, ASP.NET Core uses reflection when your web service first runs to discover constructs you’ve defined so that it can “wire up” things like controllers and razor pages. Although this enables you to write straightforward code with powerful abstractions, it comes with a performance penalty at runtime: when your web service or app first starts up, it cannot accept any requests until all the runtime reflection code that discovers information about your code is finished running! Although this performance penalty is not enormous, it is somewhat of a fixed cost that you cannot improve yourself in your own app.</p><p>With a Source Generator, the controller discovery phase of startup could instead happen at compile time by analyzing your source code and emitting the code it needs to “wire up” your app. This could result in some faster startup times, since an action happening at runtime today could get pushed into compile time.</p><p>Source Generators can improve performance in ways that aren’t limited to reflection at runtime to discover types, either. Some scenarios involve calling the MSBuild C# task (called <em>CSC</em>) multiple so they can inspect data from a compilation. As you might imagine, calling the compiler more than once affects the total time it takes to build you app! We’re investigating how Source Generators can be used to obviate the need for juggling MSBuild tasks like this, since this doesn’t just offer some performance benefits, but also allows tools like this to operate at the right level of abstraction.</p><p>Another capability Source Generators can offer is obviating the use of some <a href="https://wiki.c2.com/?StringlyTyped" target="_blank">“stringly-typed”</a> APIs, such as how ASP.NET Core routing between controllers and razor pages work. With a Source Generator, routing could be strongly typed with the necessary strings being generated as a compile-time detail. This could reduce the amount of times a mistyped string literal leads to a request not hitting the correct controller.</p><p>As we flesh out the API and experience writing Source Generators more, we anticipate more scenarios to become evident. We’re also planning on working with partner teams to help them adopt Source Generators if it improves their core scenarios.</p><h3>Source Generators and Ahead of Time (AOT) Compilation</h3><p>Another characteristic of Source Generators is that they can help remove major barriers to linker-based and AOT (ahead-of-time) compilation optimizations. Many frameworks and libraries make heavy use of reflection, such as <em>System.Text.Json</em>, <em>System.Text.RegularExpressions</em>, and frameworks like ASP.NET Core and WPF that discover types from user code at runtime.</p><p>We’ve also identified that many of the top <a href="https://www.nuget.org/" target="_blank">NuGet packages</a> people make heavy use of reflection to discover types at runtime. Incorporating these packages is essential for most .NET apps, so the “linkability” and ability for your code to make use of AOT compiler optimizations is greatly affected. We’re looking forward to working with our wonderful OSS community to see how these packages could use source generators and improve the overall .NET ecosystem.</p><h3>Hello World, Source Generator edition</h3><p>All the previous examples of source generators mentioned earlier are pretty complex. Let’s go through a very basic one to show some of the key pieces you’ll need to write your own Source Generator.</p><p>The goal is to let users who have installed this Source Generator always have access to a friendly “Hello World” message and all syntax trees available during compilation. They could invoke it like this:</p><div id="gist102722541">
    <div>
      <div>
        <div>
  <div id="file-srcgen0-cs">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen0-cs-L1" data-line-number="1"></td>
        <td id="file-srcgen0-cs-LC1"><span>public</span> <span>class</span> <span>SomeClassInMyCode</span></td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L2" data-line-number="2"></td>
        <td id="file-srcgen0-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L3" data-line-number="3"></td>
        <td id="file-srcgen0-cs-LC3">    <span>public</span> <span>void</span> <span>SomeMethodIHave</span>()</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L4" data-line-number="4"></td>
        <td id="file-srcgen0-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L5" data-line-number="5"></td>
        <td id="file-srcgen0-cs-LC5">        <span>HelloWorldGenerated</span>.<span>HelloWorld</span>.<span>SayHello</span>(); <span><span>//</span> calls Console.WriteLine("Hello World!") and then prints out syntax trees</span></td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L6" data-line-number="6"></td>
        <td id="file-srcgen0-cs-LC6">    }</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L7" data-line-number="7"></td>
        <td id="file-srcgen0-cs-LC7">}</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>Over time, we’ll make getting started a lot easier in tools with templates. For now, here’s how to do it manually:</p><p>1. Create a .NET Standard library project that looks like this:</p><div id="gist102722484">
    <div>
      <div>
        <div>
  <div id="file-srcgen1-csproj">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen1-csproj-L1" data-line-number="1"></td>
        <td id="file-srcgen1-csproj-LC1">&lt;<span>Project</span> <span>Sdk</span>=<span><span>"</span>Microsoft.NET.Sdk<span>"</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L2" data-line-number="2"></td>
        <td id="file-srcgen1-csproj-LC2">
</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L3" data-line-number="3"></td>
        <td id="file-srcgen1-csproj-LC3">  &lt;<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L4" data-line-number="4"></td>
        <td id="file-srcgen1-csproj-LC4">    &lt;<span>TargetFramework</span>&gt;netstandard2.0&lt;/<span>TargetFramework</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L5" data-line-number="5"></td>
        <td id="file-srcgen1-csproj-LC5">    &lt;<span>LangVersion</span>&gt;preview&lt;/<span>LangVersion</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L6" data-line-number="6"></td>
        <td id="file-srcgen1-csproj-LC6">  &lt;/<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L7" data-line-number="7"></td>
        <td id="file-srcgen1-csproj-LC7">
</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L8" data-line-number="8"></td>
        <td id="file-srcgen1-csproj-LC8">  &lt;<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L9" data-line-number="9"></td>
        <td id="file-srcgen1-csproj-LC9">    &lt;<span>RestoreAdditionalProjectSources</span>&gt;https://dotnet.myget.org/F/roslyn/api/v3/index.json ;$(RestoreAdditionalProjectSources)&lt;/<span>RestoreAdditionalProjectSources</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L10" data-line-number="10"></td>
        <td id="file-srcgen1-csproj-LC10">  &lt;/<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L11" data-line-number="11"></td>
        <td id="file-srcgen1-csproj-LC11">
</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L12" data-line-number="12"></td>
        <td id="file-srcgen1-csproj-LC12">  &lt;<span>ItemGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L13" data-line-number="13"></td>
        <td id="file-srcgen1-csproj-LC13">    &lt;<span>PackageReference</span> <span>Include</span>=<span><span>"</span>Microsoft.CodeAnalysis.CSharp.Workspaces<span>"</span></span> <span>Version</span>=<span><span>"</span>3.6.0-3.20207.2<span>"</span></span> <span>PrivateAssets</span>=<span><span>"</span>all<span>"</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L14" data-line-number="14"></td>
        <td id="file-srcgen1-csproj-LC14">    &lt;<span>PackageReference</span> <span>Include</span>=<span><span>"</span>Microsoft.CodeAnalysis.Analyzers<span>"</span></span> <span>Version</span>=<span><span>"</span>3.0.0-beta2.final<span>"</span></span> <span>PrivateAssets</span>=<span><span>"</span>all<span>"</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L15" data-line-number="15"></td>
        <td id="file-srcgen1-csproj-LC15">  &lt;/<span>ItemGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L16" data-line-number="16"></td>
        <td id="file-srcgen1-csproj-LC16">
</td>
      </tr>
      <tr>
        <td id="file-srcgen1-csproj-L17" data-line-number="17"></td>
        <td id="file-srcgen1-csproj-LC17">&lt;/<span>Project</span>&gt;</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>The key pieces of this is that the project can generate a NuGet package and it depends on the bits that enable Source Generators.</p><p>2. Modify or create an C# file that specifies your own Source Generator like so:</p><div id="gist102722503">
    <div>
      <div>
        <div>
  <div id="file-srcgen2-cs">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen2-cs-L1" data-line-number="1"></td>
        <td id="file-srcgen2-cs-LC1"><span>using</span> <span>Microsoft</span>.<span>CodeAnalysis</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L2" data-line-number="2"></td>
        <td id="file-srcgen2-cs-LC2"><span>using</span> <span>Microsoft</span>.<span>CodeAnalysis</span>.<span>Text</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L3" data-line-number="3"></td>
        <td id="file-srcgen2-cs-LC3"><span>using</span> <span>System</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L4" data-line-number="4"></td>
        <td id="file-srcgen2-cs-LC4"><span>using</span> <span>System</span>.<span>Collections</span>.<span>Generic</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L5" data-line-number="5"></td>
        <td id="file-srcgen2-cs-LC5"><span>using</span> <span>System</span>.<span>IO</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L6" data-line-number="6"></td>
        <td id="file-srcgen2-cs-LC6"><span>using</span> <span>System</span>.<span>Linq</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L7" data-line-number="7"></td>
        <td id="file-srcgen2-cs-LC7"><span>using</span> <span>System</span>.<span>Text</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L8" data-line-number="8"></td>
        <td id="file-srcgen2-cs-LC8"><span>using</span> <span>System</span>.<span>Xml</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L9" data-line-number="9"></td>
        <td id="file-srcgen2-cs-LC9">
</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L10" data-line-number="10"></td>
        <td id="file-srcgen2-cs-LC10"><span>namespace</span> <span>MyGenerator</span></td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L11" data-line-number="11"></td>
        <td id="file-srcgen2-cs-LC11">{</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L12" data-line-number="12"></td>
        <td id="file-srcgen2-cs-LC12">    [<span>Generator</span>]</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L13" data-line-number="13"></td>
        <td id="file-srcgen2-cs-LC13">    <span>public</span> <span>class</span> <span>MySourceGenerator</span> : <span>ISourceGenerator</span></td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L14" data-line-number="14"></td>
        <td id="file-srcgen2-cs-LC14">    {</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L15" data-line-number="15"></td>
        <td id="file-srcgen2-cs-LC15">        <span>public</span> <span>void</span> <span>Execute</span>(<span>SourceGeneratorContext</span> <span>context</span>)</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L16" data-line-number="16"></td>
        <td id="file-srcgen2-cs-LC16">        {</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L17" data-line-number="17"></td>
        <td id="file-srcgen2-cs-LC17">            <span><span>//</span> TODO - actual source generator goes here!</span></td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L18" data-line-number="18"></td>
        <td id="file-srcgen2-cs-LC18">        }</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L19" data-line-number="19"></td>
        <td id="file-srcgen2-cs-LC19">
</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L20" data-line-number="20"></td>
        <td id="file-srcgen2-cs-LC20">        <span>public</span> <span>void</span> <span>Initialize</span>(<span>InitializationContext</span> <span>context</span>)</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L21" data-line-number="21"></td>
        <td id="file-srcgen2-cs-LC21">        {</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L22" data-line-number="22"></td>
        <td id="file-srcgen2-cs-LC22">            <span><span>//</span> No initialization required for this one</span></td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L23" data-line-number="23"></td>
        <td id="file-srcgen2-cs-LC23">        }</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L24" data-line-number="24"></td>
        <td id="file-srcgen2-cs-LC24">    }</td>
      </tr>
      <tr>
        <td id="file-srcgen2-cs-L25" data-line-number="25"></td>
        <td id="file-srcgen2-cs-LC25">}</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>You’ll need to apply the <em>Microsoft.CodeAnalysis.Generator</em> attribute and implement the <em>Microsoft.CodeAnalysis.ISourceGenerator</em>&nbsp;interface.</p><p>3. Add generated source code to the compilation!</p><div id="gist102722514">
    <div>
      <div>
        <div>
  <div id="file-srcgen3-cs">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen3-cs-L1" data-line-number="1"></td>
        <td id="file-srcgen3-cs-LC1"><span>using</span> <span>System</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L2" data-line-number="2"></td>
        <td id="file-srcgen3-cs-LC2"><span>using</span> <span>System</span>.<span>Collections</span>.<span>Generic</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L3" data-line-number="3"></td>
        <td id="file-srcgen3-cs-LC3"><span>using</span> <span>System</span>.<span>Text</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L4" data-line-number="4"></td>
        <td id="file-srcgen3-cs-LC4"><span>using</span> <span>Microsoft</span>.<span>CodeAnalysis</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L5" data-line-number="5"></td>
        <td id="file-srcgen3-cs-LC5"><span>using</span> <span>Microsoft</span>.<span>CodeAnalysis</span>.<span>Text</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L6" data-line-number="6"></td>
        <td id="file-srcgen3-cs-LC6">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L7" data-line-number="7"></td>
        <td id="file-srcgen3-cs-LC7"><span>namespace</span> <span>SourceGeneratorSamples</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L8" data-line-number="8"></td>
        <td id="file-srcgen3-cs-LC8">{</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L9" data-line-number="9"></td>
        <td id="file-srcgen3-cs-LC9">    [<span>Generator</span>]</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L10" data-line-number="10"></td>
        <td id="file-srcgen3-cs-LC10">    <span>public</span> <span>class</span> <span>HelloWorldGenerator</span> : <span>ISourceGenerator</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L11" data-line-number="11"></td>
        <td id="file-srcgen3-cs-LC11">    {</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L12" data-line-number="12"></td>
        <td id="file-srcgen3-cs-LC12">        <span>public</span> <span>void</span> <span>Execute</span>(<span>SourceGeneratorContext</span> <span>context</span>)</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L13" data-line-number="13"></td>
        <td id="file-srcgen3-cs-LC13">        {</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L14" data-line-number="14"></td>
        <td id="file-srcgen3-cs-LC14">            <span><span>//</span> begin creating the source we'll inject into the users compilation</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L15" data-line-number="15"></td>
        <td id="file-srcgen3-cs-LC15">            <span>var</span> <span>sourceBuilder</span> <span>=</span> <span>new</span> <span>StringBuilder</span>(<span><span>@"</span></span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L16" data-line-number="16"></td>
        <td id="file-srcgen3-cs-LC16"><span>using System;</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L17" data-line-number="17"></td>
        <td id="file-srcgen3-cs-LC17"><span>namespace HelloWorldGenerated</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L18" data-line-number="18"></td>
        <td id="file-srcgen3-cs-LC18"><span>{</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L19" data-line-number="19"></td>
        <td id="file-srcgen3-cs-LC19"><span>    public static class HelloWorld</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L20" data-line-number="20"></td>
        <td id="file-srcgen3-cs-LC20"><span>    {</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L21" data-line-number="21"></td>
        <td id="file-srcgen3-cs-LC21"><span>        public static void SayHello() </span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L22" data-line-number="22"></td>
        <td id="file-srcgen3-cs-LC22"><span>        {</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L23" data-line-number="23"></td>
        <td id="file-srcgen3-cs-LC23"><span>            Console.WriteLine(<span>""</span>Hello from generated code!<span>""</span>);</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L24" data-line-number="24"></td>
        <td id="file-srcgen3-cs-LC24"><span>            Console.WriteLine(<span>""</span>The following syntax trees existed in the compilation that created this program:<span>""</span>);</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L25" data-line-number="25"></td>
        <td id="file-srcgen3-cs-LC25"><span><span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L26" data-line-number="26"></td>
        <td id="file-srcgen3-cs-LC26">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L27" data-line-number="27"></td>
        <td id="file-srcgen3-cs-LC27">            <span><span>//</span> using the context, get a list of syntax trees in the users compilation</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L28" data-line-number="28"></td>
        <td id="file-srcgen3-cs-LC28">            <span>var</span> <span>syntaxTrees</span> <span>=</span> <span>context</span>.<span>Compilation</span>.<span>SyntaxTrees</span>;</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L29" data-line-number="29"></td>
        <td id="file-srcgen3-cs-LC29">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L30" data-line-number="30"></td>
        <td id="file-srcgen3-cs-LC30">            <span><span>//</span> add the filepath of each tree to the class we're building</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L31" data-line-number="31"></td>
        <td id="file-srcgen3-cs-LC31">            <span>foreach</span> (<span>SyntaxTree</span> <span>tree</span> <span>in</span> <span>syntaxTrees</span>)</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L32" data-line-number="32"></td>
        <td id="file-srcgen3-cs-LC32">            {</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L33" data-line-number="33"></td>
        <td id="file-srcgen3-cs-LC33">                <span>sourceBuilder</span>.<span>AppendLine</span>(<span><span>$@"</span>Console.WriteLine(@<span>""</span> - {<span>tree</span>.<span>FilePath</span>}<span>""</span>);<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L34" data-line-number="34"></td>
        <td id="file-srcgen3-cs-LC34">            }</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L35" data-line-number="35"></td>
        <td id="file-srcgen3-cs-LC35">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L36" data-line-number="36"></td>
        <td id="file-srcgen3-cs-LC36">            <span><span>//</span> finish creating the source to inject</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L37" data-line-number="37"></td>
        <td id="file-srcgen3-cs-LC37">            <span>sourceBuilder</span>.<span>Append</span>(<span><span>@"</span></span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L38" data-line-number="38"></td>
        <td id="file-srcgen3-cs-LC38"><span>        }</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L39" data-line-number="39"></td>
        <td id="file-srcgen3-cs-LC39"><span>    }</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L40" data-line-number="40"></td>
        <td id="file-srcgen3-cs-LC40"><span>}<span>"</span></span>);</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L41" data-line-number="41"></td>
        <td id="file-srcgen3-cs-LC41">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L42" data-line-number="42"></td>
        <td id="file-srcgen3-cs-LC42">            <span><span>//</span> inject the created source into the users compilation</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L43" data-line-number="43"></td>
        <td id="file-srcgen3-cs-LC43">            <span>context</span>.<span>AddSource</span>(<span><span>"</span>helloWorldGenerator<span>"</span></span>, <span>SourceText</span>.<span>From</span>(<span>sourceBuilder</span>.<span>ToString</span>(), <span>Encoding</span>.<span>UTF8</span>));</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L44" data-line-number="44"></td>
        <td id="file-srcgen3-cs-LC44">        }</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L45" data-line-number="45"></td>
        <td id="file-srcgen3-cs-LC45">
</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L46" data-line-number="46"></td>
        <td id="file-srcgen3-cs-LC46">        <span>public</span> <span>void</span> <span>Initialize</span>(<span>InitializationContext</span> <span>context</span>)</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L47" data-line-number="47"></td>
        <td id="file-srcgen3-cs-LC47">        {</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L48" data-line-number="48"></td>
        <td id="file-srcgen3-cs-LC48">            <span><span>//</span> No initialization required for this one</span></td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L49" data-line-number="49"></td>
        <td id="file-srcgen3-cs-LC49">        }</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L50" data-line-number="50"></td>
        <td id="file-srcgen3-cs-LC50">    }</td>
      </tr>
      <tr>
        <td id="file-srcgen3-cs-L51" data-line-number="51"></td>
        <td id="file-srcgen3-cs-LC51">}</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>4. Add the source generator from a project as an analyzer and add <em>preview </em>to the LangVersion&nbsp;to the project file like this:</p><div id="gist102722527">
    <div>
      <div>
        <div>
  <div id="file-srcgen4-csproj">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen4-csproj-L1" data-line-number="1"></td>
        <td id="file-srcgen4-csproj-LC1"><span><span>&lt;!--</span> This goes in the top-level property group <span>--&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L2" data-line-number="2"></td>
        <td id="file-srcgen4-csproj-LC2">&lt;<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L3" data-line-number="3"></td>
        <td id="file-srcgen4-csproj-LC3">  &lt;<span>LangVersion</span>&gt;preview&lt;/<span>LangVersion</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L4" data-line-number="4"></td>
        <td id="file-srcgen4-csproj-LC4">&lt;/<span>PropertyGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L5" data-line-number="5"></td>
        <td id="file-srcgen4-csproj-LC5">
</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L6" data-line-number="6"></td>
        <td id="file-srcgen4-csproj-LC6"><span><span>&lt;!--</span> Add this as a new ItemGroup, replacing paths and names appropriately <span>--&gt;</span></span></td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L7" data-line-number="7"></td>
        <td id="file-srcgen4-csproj-LC7">&lt;<span>ItemGroup</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L8" data-line-number="8"></td>
        <td id="file-srcgen4-csproj-LC8">  &lt;<span>Analyzer</span> <span>Include</span>=<span><span>"</span>path-to-source-genertor/Debug/netstandard2.0/SourceGeneratorName.dll<span>"</span></span> /&gt;</td>
      </tr>
      <tr>
        <td id="file-srcgen4-csproj-L9" data-line-number="9"></td>
        <td id="file-srcgen4-csproj-LC9">&lt;/<span>ItemGroup</span>&gt;</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p>If you’ve written Roslyn Analyzers before, the local development experience should be similar.</p><p>When you write your code in Visual Studio, you’ll see that the Source Generator runs and the generated source file is added to your project. You can now access it as if you had created it yourself:</p><div id="gist102722541">
    <div>
      <div>
        <div>
  <div id="file-srcgen0-cs">
    

  <div itemprop="text">
      
<div><table data-tab-size="8" data-paste-markdown-skip="">
      <tbody><tr>
        <td id="file-srcgen0-cs-L1" data-line-number="1"></td>
        <td id="file-srcgen0-cs-LC1"><span>public</span> <span>class</span> <span>SomeClassInMyCode</span></td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L2" data-line-number="2"></td>
        <td id="file-srcgen0-cs-LC2">{</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L3" data-line-number="3"></td>
        <td id="file-srcgen0-cs-LC3">    <span>public</span> <span>void</span> <span>SomeMethodIHave</span>()</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L4" data-line-number="4"></td>
        <td id="file-srcgen0-cs-LC4">    {</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L5" data-line-number="5"></td>
        <td id="file-srcgen0-cs-LC5">        <span>HelloWorldGenerated</span>.<span>HelloWorld</span>.<span>SayHello</span>(); <span><span>//</span> calls Console.WriteLine("Hello World!") and then prints out syntax trees</span></td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L6" data-line-number="6"></td>
        <td id="file-srcgen0-cs-LC6">    }</td>
      </tr>
      <tr>
        <td id="file-srcgen0-cs-L7" data-line-number="7"></td>
        <td id="file-srcgen0-cs-LC7">}</td>
      </tr>
</tbody></table></div>


  </div>

  </div>
</div>

      </div>
      
    </div>
</div>
<p><strong>Note: you will currently need to restart Visual Studio to see IntelliSense and get rid of errors with the early tooling experience</strong></p><p>There are many more things you can do with Source Generators than just something simple like this:</p><ul><li>Automatically implement interfaces for classes with an attribute attached to them, such as <em>INotifyPropertyChanged</em></li><li>Generate settings files based on data inspected from a <em>SourceGeneratorContext</em></li><li>Serialize values from classes into JSON strings</li><li>etc.</li></ul><p>The <a href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md" target="_blank">Source Generators Cookbook</a> goes over some of these examples with some recommended approaches to solving them.</p><p>Additionally, we have a <a href="https://github.com/dotnet/roslyn-sdk/tree/master/samples/CSharp/SourceGenerators" target="_blank">set of samples available on GitHub</a> that you can try on your own.</p><p>As mentioned earlier, we’re working on making the experience authoring and using Source Generators better in tooling, such as adding templates, allowing for seamless IntelliSense and navigation, debugging, and improving responsiveness and performance in Visual Studio when generating source files.</p><h3>Source Generators are in preview</h3><p>As mentioned earlier in this post, this is the first preview of Source Generators. The intention of releasing this first preview is to let library authors try out the feature and give us feedback on what’s missing and what needs to change. From preview to preview, there may be changes in the API and characteristics of source generators. We intend on shipping Source Generators as GA with C# 9, and sometime later this year we intend on stabilizing the API and features it provides.</p><h3>Calling all C# library developers: try it out!</h3><p>If you own a .NET library written in C#, now is a great time to evaluate Source Generators and see if they’re a good fit. There’s a good chance that if your library makes heavy use of reflection, you’ll benefit in some way.</p><p>To help with that, we recommend reading the following docs:</p><ul><li><a href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.md" target="_blank">Source Generators design document</a>, which explains the Source Generator API and current capabilities</li><li><a href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.cookbook.md" target="_blank">Source Generators cookbook</a>, which provides examples of different Source Generators that enable different scenarios</li></ul><p>Give us your feedback and let us know what you need! We’d love to learn more about how you think Source Generators could improve your code, and what you feel is missing or needs changing.</p><h3>What’s next for Source Generators</h3><p>This first preview is is exactly that: a first preview. There is a basic editing experience in Visual Studio, but it is not what we would consider “1.0 quality” right now. We may explore a few different designs over time before we commit to a particular one. One of the biggest areas of focus between now and the .NET 5 release will be improving the editing experience for Source Generators. Additionally, we expect to modify the API to accommodate feedback from partner teams and our OSS community.</p><p>Additionally, we’ll ensure a good experience for how Source Generators are distributed. We’re currently designing them to be very similar to Analyzers that can be shipped alongside a package. They currently use the Analyzer infrastructure to handle configuration in editor tooling.</p><h3>FAQ</h3><p>Below is a list of questions we anticipate some people might have. We’ll update this list with more questions as they come.</p><h5>How do Source Generators compare to other metaprogramming features like macros or compiler plugins?</h5><p>Source Generators are a form of metaprogramming, so it’s natural to compare them to similar features in other languages like macros. The key difference is that Source Generators don’t allow you _rewrite_ user code. We view this limitation as a significant benefit, since it keeps user code predictable with respect to what it actually does at runtime. We recognize that rewriting user code is a very powerful feature, but we’re unlikely to enable Source Generators to do that.</p><h5>How do Source Generators compare with Type Providers in F#?</h5><p>If you’re an F# programmer (or familiar with the language), then you might have heard of <a href="https://docs.microsoft.com/dotnet/fsharp/tutorials/type-providers/" target="_blank">Type Providers</a>. Source Generators were inspired in part by Type Providers, but there are several differences that make them distinct. The main difference is that Type Providers are a part of the F# language proper and emit types, properties, and methods in-memory based on an external source. Source Generators are a compiler feature that analyzes C# source code, optionally with other files, emits C# source code to include back into a compilation.</p><h5>Should I delete all my reflection code?</h5><p>No! Reflection is an incredibly useful tool to use. Reflection does present some performance and “linkability” challenges that can be solvable with Source Generators in some scenarios. We recommend carefully evaluating if Source Generators fit your scenario.</p><h5>How are Source Generators this different from analyzers?</h5><p>Source Generators are similar to analyzers, since both are compiler features that let you plug into a compilation. The key difference is that analyzers ultimately emit diagnostics that can be used to associate with a code fix. Source Generators ultimately emit C# source code that is added to a compilation. There are several other differences discussed in the <a href="https://github.com/dotnet/roslyn/blob/master/docs/features/source-generators.md#discussion--open-issues--todos" target="_blank">design document</a>.</p><h5>Can I modify/rewrite existing code with a Source Generator?</h5><p>No. As mentioned earlier, Source Generators do not allow you to rewrite user source code. We do not intend on allowing them to this. They can only augment a compilation by adding C# source files to it.</p><h5>When will Source Generators be out of preview?</h5><p>We intend on shipping Source Generators with C# 9. However, in the event that they aren’t ready in time, we’ll keep them in preview and ensure that users need to opt in to use them.</p><h5>Can I change the TFM in a Source Generator?</h5><p>Source Generators are .NET Standard 2.0 components, and like any project you can change the TFM. However, they are only supported if you target .NET Standard 2.0 or .NET 5. Changing the TFM to a .NET Framework version is not guaranteed to work now or in the future.</p><h5>Will Source Generators come to Visual Basic or F#?</h5><p>Source Generators are currently a C# only feature. Because this is the first preview, there are many things that can change between now and the released version. We do not intend on adding Source Generators to Visual Basic at this time. If you’re an F# developer and want to see this feature added, please search the suggestions or file a new one in the <a href="https://github.com/fsharp/fslang-suggestions/" target="_blank">F# language suggestion repository</a>.</p><h5>Do Source Generators introduce compatibility concerns for libraries?</h5><p>This depends on how libraries are authored. Since VB and F# currently don’t support Source Generators, library authors should avoid designing their features such that they require a Source Generator. Ideally, features have fallbacks to runtime reflection and/or reflection emit. This is something that library authors will need to careful consider before adopting Source Generators. We expect most library authors will use Source Generators to augment – rather than replace – current experiences for C# developers.</p><h5>Why do I not get IntelliSense for generated code? Why does Visual Studio say there’s an error even though it builds?</h5><p>You will need to restart Visual Studio after building the source generator to make errors go away and IntelliSense appear for generated source code. After you do that, things will work. Currently, Visual Studio integration is very early on. This current behavior will change in the future so that you don’t need to restart Visual Studio.</p><h5>Can I debug or navigate to generated source in Visual Studio?</h5><p>Eventually, we’ll support navigation and debugging of generated source in Visual Studio. It is not yet supported in this early preview stage.</p><h5>How do I ship my own Source Generator?</h5><p>Source Generators can be shipped as NuGet packages, just like Analyzers today. In fact, they use the same “plumbing” as Analyzers. If you’ve ever shipped an Analyzer, then you can easily ship a Source Generator.</p><h5>Will there be Microsoft-authored Source Generators?</h5><p>Eventually, yes. But this is still the first preview of the technology, and a lot of things may need to change to accommodate various scenarios. There is currently no timeline for when Microsoft-authored Source Generators are available.</p><h5>Why do I need to use the Preview LangVersion to consume a Source Generator?</h5><p>Although Source Generators are not technically a C# language feature, they are in preview. Rather than introduce a new setting just for Source Generators, we decided it would be easier to just use the existing switch that enables preview language features for the C# compiler.</p><p>Cheers, and happy source generation!</p></div></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>