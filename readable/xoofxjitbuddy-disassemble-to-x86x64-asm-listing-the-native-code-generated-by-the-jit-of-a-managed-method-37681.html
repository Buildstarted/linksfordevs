<!DOCTYPE html>
<html lang="en">
<head>
    <title>
xoofx/JitBuddy - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="xoofx/JitBuddy - linksfor.dev(s)"/>
    <meta property="article:author" content="xoofx"/>
    <meta property="og:description" content="Disassemble to x86/x64 ASM listing the native code generated by the JIT of a managed method. - xoofx/JitBuddy"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/xoofx/JitBuddy"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - xoofx/JitBuddy</title>
<div class="readable">
        <h1>xoofx/JitBuddy</h1>
            <div>by xoofx</div>
            <div>Reading time: 2 minutes</div>
        <div>Posted here: 27 Sep 2019</div>
        <p><a href="https://github.com/xoofx/JitBuddy">https://github.com/xoofx/JitBuddy</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
        

      <div>
        <article itemprop="text">
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/xoofx/JitBuddy/blob/master/img/JitBuddy.png"><img width="160px" height="160px" src="https://github.com/xoofx/JitBuddy/raw/master/img/JitBuddy.png"></a></p>
<p>JitBuddy provides a small helper method to disassemble to a x86/x64 ASM listing the native code generated by the JIT of  a managed method.</p>
<div><pre><span>using</span> <span>System</span>;
<span>using</span> <span>System</span>.<span>Reflection</span>;
<span>using</span> <span>JitBuddy</span>;

<span>namespace</span> <span>JitBuddyExample</span>
{
    <span>public</span> <span>class</span> <span>Program</span>
    {
        <span>public</span> <span>static</span> <span>int</span> <span>Add</span>(<span>int</span> <span>a</span>, <span>int</span> <span>b</span>)
        {
            <span>return</span> <span>a</span> <span>+</span> <span>b</span>;
        }
        
        <span>static</span> <span>void</span> <span>Main</span>()
        {
            <span>var</span> <span>method</span> <span>=</span> <span>typeof</span>(<span>Program</span>).<span>GetMethod</span>(<span><span>"</span>Add<span>"</span></span>, <span>BindingFlags</span>.<span>Public</span> <span>|</span> <span>BindingFlags</span>.<span>Static</span>);
            <span>Console</span>.<span>WriteLine</span>(<span>method</span>.<span>ToAsm</span>());
        }
   }
}</pre></div>
<p>will produce the following output:</p>
<pre><code>00007FFD515B3FB0 lea       eax,[rcx+rdx]
00007FFD515B3FB3 ret
</code></pre>
<h2>Usage</h2>
<blockquote>
<p>Starting with .NET Core 3.0 Tiered compilation is enabled and you won't get the best ASM when running this code
In order to check the assembly, you should disable tiered compilation (that will fallback to best tiered model)
by setting the environment variable <code>set COMPlus_TieredCompilation=0</code></p>
</blockquote>
<div><pre><span>var</span> <span>method</span> <span>=</span> ...; <span><span>//</span> Get a MethodInfo via typeof(XXX).GetMethod(...)</span>
<span>var</span> <span>asm</span> <span>=</span> <span>method</span>.<span>ToAsm</span>();</pre></div>
<h2>Caveats</h2>
<ul>
<li>On Linux, JitBuddy only works (for now) on CoreCLR 3.0, CoreCLR 2.0-2.2 seem to not be properly supported by ClrMd: <a href="https://github.com/microsoft/clrmd/issues/303">#303</a></li>
</ul>
<h2>License</h2>
<p>This software is released under the <a href="http://opensource.org/licenses/BSD-2-Clause" rel="nofollow">BSD-Clause 2 license</a>.</p>
<h2>Credits</h2>
<p>JitBuddy is a one file simple wrapper of the following amazing library:</p>
<ul>
<li><a href="https://github.com/0xd4d/iced"><strong><code>Iced</code></strong></a> for the disassembler part.</li>
<li><a href="https://github.com/Microsoft/clrmd"><strong><code>clrmd</code></strong> aka <code>Microsoft.Diagnostics.Runtime</code></a></li>
</ul>
<p>The Logo <code>processor</code> by <a href="https://thenounproject.com/ibrandify" rel="nofollow">ibrandify</a> from the Noun Project</p>
<h2>Author</h2>
<p>Alexandre Mutel aka <a href="http://xoofx.com/" rel="nofollow">xoofx</a>.</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>