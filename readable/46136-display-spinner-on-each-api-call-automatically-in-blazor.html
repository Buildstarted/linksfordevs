<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Display spinner on each API call automatically in Blazor -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Display spinner on each API call automatically in Blazor</h1>
    <div id="content" class="col-md-12"> <p>Blazor is a free and open-source web framework that enables developers to create web apps using C# and HTML.</p>
<p>To know more about what blazor and all related stuff to it visit <a href="https://blazor.net/">official documentation site</a>.</p>
<p>If you have already up and running blazor application you are good to go along. if not, visit official documentation to setup and configure blazor on your machine.</p>
<blockquote class="blockquote">
<p>Link of official documentation to get started with Blazor<br>
<a href="https://blazor.net/">Get started with Blazor</a></p>
</blockquote>
<p>We often want to show some loading or spinner on UI when our application is making some request to the server, so that users will know that there are some operation going on and need to wait till that operation is complete, We can handle this manually on each time in our code when there is an API call we can show some loading bar but There is a better way to do this and ie let it show the spinner automatically when there is ongoing API call and we can do this my adding our own custom <code>HttpMessageHandler</code> and show spinner just before sending request and hide that after getting response from the server.</p>
<p>Steps</p>
<ol>
<li>Create Spinner Service</li>
<li>Create Spinner Component</li>
<li>Create Custom HttpMessageHandler</li>
<li>Add Spinner Component in MainLayout</li>
<li>Register Services in startup</li>
</ol>
<h2 id="step-1-create-spinner-service">Step 1 : Create Spinner Service</h2>
<p>Spinner Service class exposes two methods and two event, which will work as a communication channel between other Components (<code>MainLayout</code>) and Spinner component</p>
<pre><code>public class SpinnerService
	{
		public event Action OnShow;
		public event Action OnHide;

		public void Show()
		{
			OnShow?.Invoke();
		}

		public void Hide()
		{
			OnHide?.Invoke();
		}
	}
</code></pre>
<h2 id="step-2-create-spinner-component">Step 2 : Create Spinner Component</h2>
<p>Here in this Spinner component , I have some css to show the Spinner on top of other html elements and for Spinner I&apos;m using a Blazor Library called <code>Faso.Blazor.SpinKit</code> , which we can install from NuGet , It has a different kind of spinner , here I&apos;m using <code>&lt;SpinKitCircle /&gt;</code>. to know more about this spineer visit <a href="https://github.com/faso/Faso.Blazor.SpinKit">Github Repo</a> of this this NuGet library.</p>
<p>Here our logic is simple when <code>IsVisible</code> will be <code>true</code> it will show the spinner and in the case of <code>false</code> it will hide.</p>
<p>From our Spinner service when <code>OnShow</code> event will be fired, <code>ShowSpinner()</code> method will be called it will make <code>IsVisible</code> <code>true</code> same on <code>OnHide</code> <code>HideSpinner()</code> method will be called and it will make <code>IsVisible</code> <code>false</code>.</p>
<pre><code>@using Faso.Blazor.SpinKit
@inject SpinnerService SpinnerService

&lt;style&gt;
    .spinner-container {
        display: flex;
        flex-direction: column;
        position: fixed;
        z-index: 999;
        top: 50%;
        left: 50%;
    }
&lt;/style&gt;
@if (IsVisible)
{
    &lt;div class=&quot;spinner-container&quot;&gt;
        &lt;SpinKitCircle /&gt;
    &lt;/div&gt;
}
@code
{
    protected bool IsVisible { get; set; }
    protected override void OnInitialized()
    {
        SpinnerService.OnShow += ShowSpinner;
        SpinnerService.OnHide += HideSpinner;
    }

    public void ShowSpinner()
    {
        IsVisible = true;
        StateHasChanged();
    }

    public void HideSpinner()
    {
        IsVisible = false;
        StateHasChanged();
    }
}
</code></pre>
<h2 id="step-3-create-custom-httpmessagehandler">Step 3 : Create Custom HttpMessageHandler</h2>
<p>In order to fire <code>OnShow</code> and <code>OnHide</code> event each time our application will make request we need to add our own custom <code>HttpMessageHandler</code>. (i.e. <code>BlazorDisplaySpinnerAutomaticallyHttpMessageHandler</code>)</p>
<p>Here in our custom <code>HttpMessageHandler</code> we are injecting <code>SpinnerService</code> so that we can call <code>Show()</code> and <code>Hide()</code> method from custom <code>HttpMessageHandler</code> that will fire events.</p>
<pre><code>using System.Net.Http;
using System.Threading;
using System.Threading.Tasks;

namespace BlazorDisplaySpinnerAutomatically
{
    public class BlazorDisplaySpinnerAutomaticallyHttpMessageHandler : DelegatingHandler
    {       
        private readonly SpinnerService _spinnerService;
        public BlazorDisplaySpinnerAutomaticallyHttpMessageHandler(SpinnerService spinnerService)
        {
            _spinnerService = spinnerService;
        } 
        protected override async Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
        {
            _spinnerService.Show();
          //  await Task.Delay(1000);
            var response = await base.SendAsync(request, cancellationToken);
            _spinnerService.Hide();
            return response;            
        }
    }
}
</code></pre>
<h2 id="step-4-add-spinner-component-in-mainlayout">Step 4 : Add Spinner Component in MainLayout</h2>
<p><code>MainLayout</code> is component which will be rendered for each component so we will add our <code>Spinner</code> component on our <code>MainLayout</code> Component.</p>
<pre><code>&lt;Spinner&gt;&lt;/Spinner&gt;

&lt;div class=&quot;sidebar&quot;&gt;
    &lt;NavMenu /&gt;
&lt;/div&gt;

&lt;div class=&quot;main&quot;&gt;
    &lt;div class=&quot;top-row px-4&quot;&gt;
        &lt;a href=&quot;http://blazor.net&quot; target=&quot;_blank&quot; class=&quot;ml-md-auto&quot;&gt;About&lt;/a&gt;
    &lt;/div&gt;

    &lt;div class=&quot;content px-4&quot;&gt;
        @Body
    &lt;/div&gt;
&lt;/div&gt;

</code></pre>
<h2 id="step-5-register-services-in-startup">Step 5 : Register Services in startup</h2>
<p>Now our final step is to register our services in startup , here we are registering <code>SpinnerService</code> , Our Custom <code>HttpMessageHandler</code> (i.e. <code>BlazorDisplaySpinnerAutomaticallyHttpMessageHandler</code>) and Also we need to register <code>HttpClient</code> and pass our custom <code>HttpMessageHandler</code> as <code>InnerHandler</code>.</p>
<pre><code> public void ConfigureServices(IServiceCollection services)
        {
           services.AddScoped&lt;SpinnerService&gt;();
            services.AddScoped&lt;BlazorDisplaySpinnerAutomaticallyHttpMessageHandler&gt;();
            services.AddScoped(s =&gt;
            {
                var blazorDisplaySpinnerAutomaticallyHttpMessageHandler = s.GetRequiredService&lt;BlazorDisplaySpinnerAutomaticallyHttpMessageHandler&gt;();
                var wasmHttpMessageHandlerType = Assembly.Load(&quot;WebAssembly.Net.Http&quot;).GetType(&quot;WebAssembly.Net.Http.HttpClient.WasmHttpMessageHandler&quot;);
                var wasmHttpMessageHandler = (HttpMessageHandler)Activator.CreateInstance(wasmHttpMessageHandlerType);
                var httpClient = new HttpClient(wasmHttpMessageHandler);

                blazorDisplaySpinnerAutomaticallyHttpMessageHandler.InnerHandler = wasmHttpMessageHandler;
                var uriHelper = s.GetRequiredService&lt;NavigationManager&gt;();
                return new HttpClient(blazorDisplaySpinnerAutomaticallyHttpMessageHandler)
                {
                    BaseAddress = new Uri(uriHelper.BaseUri)
                };
            });
        }
</code></pre>
<p>Now run the application , you should see a spinner ,when application will make http calls.</p>
<img src="./images/blazor-spinner.gif" width="100%">
<p>We can show that spinner from other components as well when ever we need to show, we just has to inject <code>SpinnerService</code> and call <code>Show()</code> and <code>Hide()</code> method to show and hide spinner respectively.</p>
<p>Refrence Links</p>
<ol>
<li><a href="https://www.telerik.com/blogs/creating-a-reusable-javascript-free-blazor-modal">Creating a Reusable, JavaScript-Free Blazor Modal</a></li>
<li><a href="https://github.com/faso/Faso.Blazor.SpinKit">faso/Faso.Blazor.SpinKit</a></li>
</ol>
<p>Feel free to comment and suggests changes .</p>
<p>Full source code on <a href="https://github.com/iAmBipinPaul/BlazorDisplaySpinnerAutomatically">iAmBipinPaul/BlazorDisplaySpinnerAutomatically</a></p>
<p>Happy Coding!</p> <meta> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>