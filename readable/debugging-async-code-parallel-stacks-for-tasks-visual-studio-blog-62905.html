<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Debugging Async Code: Parallel Stacks for Tasks | Visual Studio Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Debugging Async Code: Parallel Stacks for Tasks | Visual Studio Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Leslie RichardsonProgram Manager, Visual Studio Debugging &amp; DiagnosticsFollow"/>
    <meta property="og:description" content="Want a visual depiction of how your async code is executing in Visual Studio? Check out the newly updated Parallel Stacks for Tasks window!"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/visualstudio/debugging-async-code-parallel-stacks-for-tasks/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title">devring.club</span>
				<a href="https://devring.club/site/1/previous" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Debugging Async Code: Parallel Stacks for Tasks | Visual Studio Blog</title>
<div class="readable">
        <h1>Debugging Async Code: Parallel Stacks for Tasks | Visual Studio Blog</h1>
            <div>by Leslie RichardsonProgram Manager, Visual Studio Debugging &amp; DiagnosticsFollow</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 15 Jun 2020</div>
        <p><a href="https://devblogs.microsoft.com/visualstudio/debugging-async-code-parallel-stacks-for-tasks/">https://devblogs.microsoft.com/visualstudio/debugging-async-code-parallel-stacks-for-tasks/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2018/09/Leslie-Richardson-e15367982641511-150x150.jpg" width="58" height="58" alt="Leslie Richardson"></p><p>Leslie</p></div></div></div><p>June 15th, 2020</p><p>In the <a href="https://devblogs.microsoft.com/visualstudio/how-do-i-debug-async-code-in-visual-studio/">last async debugging blog post</a>, we explored several tools in Visual Studio to help you debug your async code.&nbsp; One of the tools we discussed was the <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/using-the-parallel-stacks-window?view=vs-2019" target="_blank">Parallel Stacks window</a> for Tasks (or Parallel Tasks), a tool that provides task and thread information while debugging.&nbsp; Unlike the tabular <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/using-the-tasks-window?view=vs-2019" target="_blank">Task</a> and <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/how-to-use-the-threads-window?view=vs-2019" target="_blank">Thread</a> windows, this information is presented graphically, displaying the relationships between threads and tasks, like an illustrative version of a call stack.&nbsp; In the latest version of Visual Studio, we’ve made some major improvements to the Parallel Tasks window for .NET applications, so let’s do a deep dive into the updated feature!</p><p>The code we’ll be using to demonstrate the Parallel Tasks tool can be found at <a href="https://docs.microsoft.com/en-us/visualstudio/debugger/walkthrough-debugging-a-parallel-application?view=vs-2019" target="_blank">this in-depth Microsoft documentation walkthrough on async debugging tools</a>.</p><h4><strong>Why use the Task View in the Parallel Stacks window?</strong></h4><p>The “magic” of asynchronous programming in .NET can be both a blessing and a curse.&nbsp; The additions of&nbsp; the <em>Task</em> type, <em>async,</em> and <em>await </em>&nbsp;in .NET provide an extra layer of abstraction, which enable you to write responsive applications but also make it harder to navigate through and understand the status of each awaiting or active task while debugging.&nbsp; The Parallel Stacks window (Debug &gt; Windows &gt; Parallel Stacks, select “Tasks” dropdown) is a great way to help you visualize and better navigate through the execution of your async code.</p><p>It’s common to break up the async code into blocks that are scheduled after another piece of code is completed.&nbsp; The Threads view in the Parallel Stacks window can tell you when a code block isn’t running on a thread. Unlike the Tasks view, however, it won’t help you determine&nbsp;<em>why&nbsp;</em>a code block isn’t running.</p><figure id="attachment_229680" aria-describedby="caption-attachment-229680"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BasicExample-300x219.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BasicExample-300x219.png" alt="Basic Parallel Tasks window example" width="300" height="219" srcset="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BasicExample-300x219.png 300w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BasicExample-768x561.png 768w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BasicExample.png 806w" sizes="(max-width: 300px) 100vw, 300px"> </a><figcaption id="caption-attachment-229680"><em>Figure 1: Basic Parallel Tasks window example</em></figcaption></figure><p>An awaited Task and the code scheduled to run after it don’t share a direct caller-callee relationship (such as a call stack on a thread).&nbsp; Instead, they have a “logical” relationship. This is where each piece of code knows about the next scheduled block, creating a “logical stack”.&nbsp; Figure 2 shows four tasks sharing a call stack at the start of the program, thus sharing the same box.</p><p>If an async method is “active” (i.e. it is running on a thread), these logical stacks are sometimes displayed in the Threads view.&nbsp; However, the Tasks view will show both active and awaiting logical stacks. This is helpful for debugging hangs or figuring out why your particular task or code block is not running.</p><figure id="attachment_229682" aria-describedby="caption-attachment-229682"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Figure2_TaskView.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Figure2_TaskView.png" alt="Figure 2: Parallel Stacks window - Task View" width="808" height="589" srcset="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Figure2_TaskView.png 808w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Figure2_TaskView-300x219.png 300w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Figure2_TaskView-768x560.png 768w" sizes="(max-width: 808px) 100vw, 808px"> </a><figcaption id="caption-attachment-229682"><em>Figure 2: Parallel Stacks window – Task View</em></figcaption></figure><h4><strong>How is the new Parallel Tasks window </strong><strong>structured?</strong></h4><p>At any given program state, tasks sharing the same logical call stack are grouped into boxes/nodes.&nbsp; These nodes reveal how many tasks are doing the same operations before branching out to different functions.&nbsp; As a result, this grouping can provide a clearer picture of the whole program’s state.</p><p>By default, Parallel Tasks displays a top-down display for task progression, branching from the most recent function call to the initial caller.&nbsp; Using the reverse layout button in the Parallel Task window’s toolbar gives you a bottom-up display for task progression.&nbsp; This reverse layout shows tasks branching from an initial caller to the most recent function call.&nbsp; In Figure 3, three tasks branch from function S.C to three different call stacks, with their most recent calls being S.R, S.O, and S.M, respectively.</p><figure id="attachment_229681" aria-describedby="caption-attachment-229681"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BottomUp_Branching.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BottomUp_Branching.png" alt="Task View bottom-up layout" width="808" height="595" srcset="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BottomUp_Branching.png 808w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BottomUp_Branching-300x221.png 300w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_BottomUp_Branching-768x566.png 768w" sizes="(max-width: 808px) 100vw, 808px"> </a><figcaption id="caption-attachment-229681"><em>Figure 3: Task View bottom-up layout</em></figcaption></figure><h4><strong>What else is new in the Parallel Tasks Window?</strong></h4><p>Hovering over each line in the window and view the tabular representation of all the tasks currently in that method.&nbsp; Like the Task Window, this table lets you view the status, ID, duration, and more specific info of each Task.&nbsp; Selecting a task will now direct you to its corresponding async call stack.&nbsp; You can use this call stack to navigate to related code and inspect local variables within your async methods.</p><figure id="attachment_229687" aria-describedby="caption-attachment-229687"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_TaskHover.gif" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_TaskHover.gif" alt="Hovering over a task in the Parallel Stacks window" width="1908" height="950"> </a><figcaption id="caption-attachment-229687"><em>Figure 4: Hovering over a task in the Parallel Stacks window</em></figcaption></figure><figure id="attachment_229688" aria-describedby="caption-attachment-229688"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_CallStack2.gif" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_CallStack2.gif" alt="Accessing a task's async call stack" width="1908" height="950"> </a><figcaption id="caption-attachment-229688"><em>Figure 5: Accessing a task’s async call stack</em></figcaption></figure><p>For multi-threaded applications, you may want to navigate between a specific task and the thread running that task.&nbsp; Now, you can quickly jump between tasks in the Tasks View and their corresponding threads in the Threads View via the context menu.</p><figure id="attachment_229689" aria-describedby="caption-attachment-229689"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_GoToThread-1.gif" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_GoToThread-1.gif" alt="Swap between threads and tasks in Parallel Stacks" width="1908" height="950"> </a><figcaption id="caption-attachment-229689"><em>Figure 6: Swap between threads and tasks in Parallel Stacks</em></figcaption></figure><p>You’ll also receive notifications about tasks waiting on locks owned by specific threads or threads waiting on specific async operations to complete.&nbsp; When this happens, you can double-click the notification to navigate directly to that thread or task.</p><p>Finally, you can save the Parallel Stacks window contents as a PNG file using the save icon in the window’s toolbar.</p><figure id="attachment_229683" aria-describedby="caption-attachment-229683"><a href="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Save.png" data-featherlight="image"> <img src="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Save.png" alt="Parallel Stacks save icon" width="800" height="91" srcset="https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Save.png 800w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Save-300x34.png 300w, https://devblogs.microsoft.com/visualstudio/wp-content/uploads/sites/4/2020/06/PST_Save-768x87.png 768w" sizes="(max-width: 800px) 100vw, 800px"> </a><figcaption id="caption-attachment-229683"><em>Figure 7: Parallel Stacks save icon</em></figcaption></figure><h4><strong>Ready to try the new and improved Parallel Tasks window while debugging your asynchronous code?&nbsp; Give us your feedback!</strong></h4><p>There are still plenty of improvements we can make in future versions of this tool. Your feedback will help us do that!&nbsp; If you’d like to share your experience using the improved Parallel Stacks tool or debugging async code in general, <a href="https://www.research.net/r/87JXND5" target="_blank">please complete this survey</a>.</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>