<!DOCTYPE html>
<html lang="en">
<head>
    <title>
James Stanley - I made a macro keypad with 3d-printed switches - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="James Stanley - I made a macro keypad with 3d-printed switches - linksfor.dev(s)"/>
    <meta property="og:description" content="Mon  6 July 2020"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://incoherency.co.uk/blog/stories/3pct-keyboard.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - James Stanley - I made a macro keypad with 3d-printed switches</title>
<div class="readable">
        <h1>James Stanley - I made a macro keypad with 3d-printed switches</h1>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 07 Jul 2020</div>
        <p><a href="https://incoherency.co.uk/blog/stories/3pct-keyboard.html">https://incoherency.co.uk/blog/stories/3pct-keyboard.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

<h3>I made a macro keypad with 3d-printed switches</h3>
<p><i>Mon  6 July 2020</i></p>
<p><i>Tagged: <a href="https://incoherency.co.uk/blog/tags/electronics.html">electronics</a>, <a href="https://incoherency.co.uk/blog/tags/3dprinting.html">3dprinting</a></i></p>
<p>Latest on the 3d-printed keyboard switch project: I've reached a switch design that I think is probably reliable enough,
and I've put 3 of them together to form a macro keypad just to see how it all goes together before I commit to a
full keyboard. I don't have a number for how many presses the switch lasts, other than to say that
the motor on the testing machine stopped working before the switch did (after about 250,000 presses).</p>
<p><a href="https://img.incoherency.co.uk/2745"><img src="https://img.incoherency.co.uk/2745"></a></p>
<p>You can <a href="https://www.youtube.com/watch?v=uHkOPBxnLtM">watch my short demo video</a> if you want.</p>
<p>"80%" and "60%" keyboard layouts are quite popular, which are correspondingly reduced versions of a full keyboard layout.
I like to think of this keypad as a "3%" keyboard, it's fine as long as you only want to type "jes".</p>
<p><a href="https://img.incoherency.co.uk/2746"><img src="https://img.incoherency.co.uk/2746"></a></p>
<p>It's controlled by an Arduino Pro Micro. It's hard to tell from the pic because of the hot glue, but the switches are wired up to pins 2, 3, and 4, from
the other side of the board.</p>
<p>For the software side of it, I used the <a href="https://www.arduino.cc/reference/en/language/functions/usb/keyboard/">Arduino Keyboard library</a>,
using <a href="https://gist.github.com/jes/fe1aeb18457a06562516372684d1bd47">this quick and dirty Arduino code</a>.
Approximately all of the code is just related to the debounce logic.</p>
<p><a href="https://img.incoherency.co.uk/2748"><img src="https://img.incoherency.co.uk/2748"></a></p>
<p>The switches are printed in some generic no-name clear PETG.
The case and keycaps are printed in <a href="https://shop.prusa3d.com/en/prusament/711-prusament-pla-prusa-galaxy-black-1kg.html">Prusament Galaxy Black PLA</a>.
I'm a big fan of this filament. The glittery effect means the layer lines almost completely disappear. It's basically the same effect you get when printing with
carbon fibre-filled nylon, but with none of the difficulties of printing carbon fibre-filled nylon.</p>
<p>All of these parts, including the switches, were printed on my new <a href="https://www.prusa3d.com/original-prusa-mini/">Prusa Mini</a> printer, which arrived last week and I'm very pleased
with so far.</p>
<h2>Switches</h2>
<p>The problem with the switch design <a href="https://incoherency.co.uk/blog/stories/keyswitch-update.html">from last time</a> was that the copper tape was splitting apart, which prevents it from conducting along
its full length. I initially thought I had
solved this by applying a 2nd layer of copper tape, but that turned out not to be a workable solution. I did a bunch of tests of various combinations of 50% and 75% activation position, and 1 or 2 layers of copper
tape, and found no significant correlation between either of those 2 variables and how long the switch lasts. The switches lasted between 225 presses and 330,000 presses before
failure. 7 failed by the copper tape splitting, 2 failed by the PETG spiral spring breaking (both after more than 200,000 presses), and 1 didn't seem to have any broken parts, it just wasn't reliably working any more.</p>
<p>This is the CAD model of the latest design:</p>
<p><a href="https://img.incoherency.co.uk/2749"><img src="https://img.incoherency.co.uk/2749"></a></p>
<p>The "leaf spring" has that funny shape in its bend so that it can tilt easily, which ensures that it makes reliable contact with <i>both</i> contact wires, instead of
just the first one it happens to touch.</p>
<p>And here's a slow-motion video showing how it works (a slightly earlier iteration, but the same concept):</p>
<p><iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/peXFqVMugO4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p>
<p>Also, just for fun, I did some <a href="https://incoherency.co.uk/blog/stories/freecad-fea.html">FEA</a> on the spiral spring
design, and it behaved just like the real version:</p>
<p><a href="https://img.incoherency.co.uk/2724"><img src="https://img.incoherency.co.uk/2724"></a></p>
<p>The red areas show the areas of highest stress, and indeed the springs tend to break around
the middle of the spiral.</p>
<h2>Print your own</h2>
<p>I consider this a "release candidate" rather than a finished design, because there is still
some work to do on it (in particular, I want to make it a bit less tall). But you can have it if you want it.</p>
<p>You will need:</p>
<ul>
<li>FDM 3D printer (although I'd also be interested to see results from resin printers!)</li>
<li>PETG filament. You can try other materials. PLA works but makes for a heavier feel and breaks more quickly.</li>
<li>1.0 mm diameter copper wire, 90 mm length per switch should be more than enough</li>
</ul>
<p><a href="https://incoherency.co.uk/interest/3dpswitch-rc1.tar.gz">Download the STL files</a> and arrange them on the build plate something like this (you'll probably have to rotate the spiral spring):</p>
<p><a href="https://img.incoherency.co.uk/2750"><img src="https://img.incoherency.co.uk/2750"></a></p>
<p>I suggest printing more than 1 of the "leafspring" part as it is a small part quite likely to
have defects in the print. Make sure you're printing at
a fine enough quality level to include all the features. In particular, make sure (both) the spirals on
the spring are connected all the way around, and that the leaf spring is connected all the way
along. I use the "0.15mm QUALITY" setting in PrusaSlicer. You shouldn't need any support material.
You might need to enable "detect thin walls".</p>
<p>You might need to add up to -0.3mm of X/Y size compensation. I have found that when printing
this on the Prusa Mini, optimal clearance is achieved when the 3.0 mm plunger rides inside
a 3.0 mm hole. On previous printers I've owned, this wouldn't even fit together. I'm not sure
what's going on, but obviously I modeled it to print on my machine, so you might need to apply X/Y
compensation on yours.</p>
<p><b>Step 1:</b> Print the parts. It takes about 40 minutes for me.</p>
<p><b>Step 2:</b> Clean up any stringing inside the case from the PETG. I use a lighter to burn off the worst of it,
and then a Stanley knife to trim off what remains.</p>
<p><b>Step 3:</b> Examine the spiral spring and ensure that it moves freely. You might need to cut any
stringing between the spirals with a knife, or re-print with different X/Y compensation, depending on whether it is a few small
tight spots or bad clearance all the way along.</p>
<p><b>Step 4:</b> Slide the spiral spring into the shelf at the top of the case. The orientation is not
critical, I tend to slide it in with the smoothest sides against the case just to make life easy
for myself.</p>
<p><b>Step 5:</b> Push the plunger through the top hole in the case, through the hole in the spiral
spring, and through the middle hole in the case. Verify that it moves up and down freely and that
the spring reliably returns it to the top. If not, take it back out and trim the tight spots with
a knife.</p>
<p><b>Step 6:</b> Cut off about a 13mm length of the copper wire. Slide it into the hole in the
leaf spring. If you can't get it through, you might need to widen the hole with a pin or sharp tool of
some kind. Use whatever you have.</p>
<p><b>Step 7:</b> Press the plunger down slightly to expose the attachment end inside the lower
chamber of the switch. Using a small pair of pliers or tweezers, push the attachment part of the
leaf spring onto the end of the plunger. Make sure it is pushed home. Looking in the big hole
at the bottom of the case, you should see the leaf spring roughly centred. When you let go
of the plunger, the spiral spring should still be stretched out slightly. This is desired, without
this preload the switch would start moving at 0 force.</p>
<p><b>Step 8:</b> Cut off 2x roughly 35mm lengths of copper wire. Using a pair of pliers, put a bend about
5mm from
one end. Insert the non-bent end through 1 of the wire holes and out the other side. Bend the wire
down the other side, and then in whatever direction you want your contacts to point. Repeat for
the second wire.</p>
<p>You should now have something that looks a bit like this:</p>
<p><a href="https://img.incoherency.co.uk/2752"><img src="https://img.incoherency.co.uk/2752"></a></p>
<p>And that should be it! Manually press the switch a few times and visually verify that the middle
copper wire appears to be making good contact with the other 2 wires, and then you're ready to
assemble it into a circuit! If you want it mechanically attached to a PCB, you could leave a longer
length of wire coming out of the first side, and you'd then have 4 soldering points. Otherwise,
mount it inside a 14mm square hole. You'll probably need cut-outs in the corners to accommodate
the wires sticking out, like this:</p>
<p><a href="https://img.incoherency.co.uk/2753"><img src="https://img.incoherency.co.uk/2753"></a></p>
<p>If you make one (or more!) I'd be really interested to hear your opinion on what could be designed
better, and to see pictures of your results. Email me: <a href="mailto:james@incoherency.co.uk">james@incoherency.co.uk</a>.</p>
<h2>Next steps</h2>
<p>We're getting pretty close to being able to put together a finished keyboard. I still
have the following things to do:</p>
<h3>Testing</h3>
<p>It would be good to get an accurate value for the number of presses that the switches can take. I
think currently a lot of the variability comes from the height at which the switch is positioned
relative to the tester. If it's doing 0.1mm short of a full stroke, the switch is likely to last
significantly longer than if it is being hammered 0.1mm longer than a full stroke. This is hard to
configure as I have only very coarse control of the height.</p>
<p>I watched the Linus Tech Tips tours of <a href="https://www.youtube.com/watch?v=Pu1gP4PfqCQ">the
Cherry MX factory</a> and <a href="https://www.youtube.com/watch?v=9fNiJKh6q-E">the Omron factory</a>. They're both interesting and worth watching. I took a screenshot of this testing machine in the
Omron video:</p>
<p><a href="https://img.incoherency.co.uk/2712"><img src="https://img.incoherency.co.uk/2712"></a></p>
<p>So there we have a single motor raising a platform up and down which is pressing 10 switches
at once. The platform glides on a pair of linear rails, and the exact vertical position of the press
is finely adjusted with a separate screw for each switch. The moving platform also has
a spring at each end, I am not completely sure why, I think just to take up some of its weight, to
reduce the load on the motor.</p>
<p>But this is a much better way to gang-test switches than what I have at the moment, which involves
wiring up a separate motor for each switch and gets messy quickly:</p>
<p><a href="https://img.incoherency.co.uk/2755"><img src="https://img.incoherency.co.uk/2755"></a></p>
<p>I'm past the point where more testing is critical (famous last words, I know), but it would be good
to do anyway, so I'd like to make a small-scale copy of the Omron testing machine.</p>
<h3>Switches</h3>
<p>The switch fits in a 14mm square hole (apart from the protruding wires), which is the same size
as a Cherry MX switch, but the total height from the bottom of the switch to the top of the keycap
is almost twice as large, about 45 mm vs 25 mm:</p>
<p><a href="https://img.incoherency.co.uk/2757"><img src="https://img.incoherency.co.uk/2757"></a></p>
<p>This directly translates to increased keyboard height, so it would be good to cut this down
as much as possible. I should be able to lose 2 mm from the wire support at the bottom of the switch,
and another 1 or 2 mm in the height of the leaf spring attachment, but there's no way it's going to be
as thin as the Cherry MX.</p>
<p>I'd like to find a way to add a tactile bump (ideally with a clicky noise) to the motion of
the plunger. I did try simply adding a bump to the side of the casing that would catch on the
leaf spring, but it didn't work very reliably.</p>
<h3>Keycaps</h3>
<p>Currently my keycaps are based on the one I designed in <a href="https://incoherency.co.uk/blog/cad-dojo/stories/keycap.html">my
CAD Dojo project</a>. This is suboptimal for several reasons:</p>
<ol>
<li>adding text in FreeCAD is extremely time-consuming, and it can't be edited without deleting it and re-creating it (i.e.
there would be a substantial O(n) effort to make keycaps for an entire keyboard)</li>
<li>the keycaps should have a slightly different profile on each row</li>
<li>there should be some keycaps that are different shapes and sizes (tab, caps lock, shift, enter, space, backspace, etc.)</li>
</ol>
<p>This picture of my Filco Majestouch 2 Tenkeyless shows the different keycap profiles on each row:</p>
<p><a href="https://img.incoherency.co.uk/2650"><img src="https://img.incoherency.co.uk/2650"></a></p>
<p>I probably want to write some OpenSCAD code to generate the keycaps instead of using FreeCAD.</p>
<p>I found a project <a href="https://github.com/rsheldiii/KeyV2">KeyV2</a> that is a parametric
keycap library, although I found it quite hard to work out how to add support for custom
switches. I haven't yet worked out whether it would be easier to make KeyV2 do what I want or
whether I should start from scratch.</p>
<p>I also probably need to add some sort of stabiliser, at least to the space bar and probably
to the enter key, backspace key, and right shift key as well. A stabiliser is a mechanism
underneath the keycap that keeps the keycap moving up and down vertically, instead of rocking over
the switch, in the event that it is pressed on one side instead of in the middle. It typically
works exactly the same way as an <a href="https://en.wikipedia.org/wiki/Anti-roll_bar">anti-roll bar</a> on car suspension: when one side moves down, the bar rotates from that end. The rotation is
transmitted to the other end of the bar, which also rotates, and pulls the other side down.</p>
<p><a href="https://img.incoherency.co.uk/2758"><img src="https://img.incoherency.co.uk/2758"></a>
<a href="https://img.incoherency.co.uk/2759"><img src="https://img.incoherency.co.uk/2759"></a></p>
<p>(Keyboard image from <a href="https://support.wasdkeyboards.com/hc/en-us/community/posts/360027414954-V3-Stabilizers-are-horrible">WASD Keyboard support forum</a>; Car suspension image from <a href="https://en.wikipedia.org/wiki/Anti-roll_bar">Wikipedia</a>)</p>
<p>Finally, I might consider reducing the layer height at the top surface of the keycaps, to
reduce the "contour lines" effect:</p>
<p><a href="https://img.incoherency.co.uk/2760"><img src="https://img.incoherency.co.uk/2760"></a></p>
<h3>Keyboard</h3>
<p>Even without reducing the height of the switches, I could reduce the height of the keyboard
by sticking the Arduino vertically, behind the switches, instead of horizontally, underneath
them. That would allow the switch bodies to sit much closer to the bottom. It's probably worth doing.</p>
<p>I probably want to either remove or paint over the LEDs on the Arduino, because currently I get
a funny red and green glow coming from the bottom of the keypad, which I don't want to happen
on the real keyboard.</p>
<p>And I could consider running <a href="https://qmk.fm/">QMK</a>, instead of writing my own
control software. This would get me lots of fancy features for free, so as long as it is easy
enough to get it to work with my switches, it's probably the way to go.</p>
<p>That's all for now. If you're following along with  the keyboard switch project, please get in touch.
I'd love to hear feedback on anything you have thoughts on.
</p><p><i>If you like my blog, please consider subscribing to the <a href="http://incoherency.co.uk/blog/rss.xml">RSS feed</a> or the mailing list:</i></p>

<hr>

</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>