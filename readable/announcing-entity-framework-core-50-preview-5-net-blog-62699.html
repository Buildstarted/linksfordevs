<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Announcing Entity Framework Core 5.0 Preview 5 | .NET Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Announcing Entity Framework Core 5.0 Preview 5 | .NET Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="https://facebook.com/cdaJeremyLikness"/>
    <meta property="og:description" content="Announcing the release of Entity Framework Core 5.0 Preview 5 featuring database collations, no tracking queries with identity resolution, bug fixes, and more."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-5-0-preview-5/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Announcing Entity Framework Core 5.0 Preview 5 | .NET Blog</title>
<div class="readable">
        <h1>Announcing Entity Framework Core 5.0 Preview 5 | .NET Blog</h1>
            <div>by https://facebook.com/cdaJeremyLikness</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 10 Jun 2020</div>
        <p><a href="https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-5-0-preview-5/">https://devblogs.microsoft.com/dotnet/announcing-entity-framework-core-5-0-preview-5/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="featured"><div><div><div><div><p><img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2018/10/Jeremy-Likness-150x150.jpg" width="58" height="58" alt="Jeremy Likness"></p><p>Jeremy</p></div></div></div><p>June 10th, 2020</p><p>Today we are announcing the fifth preview release of <a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore/5.0.0-preview.5.20278.2" target="_blank">EF Core 5.0</a>.</p><p>The fifth previews of <a href="https://devblogs.microsoft.com/dotnet/announcing-net-5-0-preview-5/">.NET 5</a> and ASP.NET Core 5.0 are also available now.</p><h2 id="prerequisites">Prerequisites<a href="#prerequisites"></a></h2><p>The previews of EF Core 5.0 require .NET Standard 2.1. This means:</p><ul><li>EF Core 5.0 runs on .NET Core 3.1; it does not require .NET 5.<ul><li>This may change in future previews depending on how the plan for .NET 5 evolves.</li></ul></li><li>EF Core 5.0 runs on other platforms that support <a href="https://docs.microsoft.com/ef/core/platforms/" target="_blank">.NET Standard 2.1</a>.</li><li>EF Core 5.0 will <strong>not</strong> run on .NET Standard 2.0 platforms, including .NET Framework.</li></ul><hr><h2 id="how-to-get-ef-core-5-0-previews">How to get EF Core 5.0 previews<a href="#how-to-get-ef-core-5-0-previews"></a></h2><p>EF Core is distributed exclusively as a set of NuGet packages.<br> For example, to add the SQL Server provider to your project, you can use the following command using the dotnet tool:</p><pre><code><span><span><span>dotnet</span></span></span><span><span> </span></span><span><span><span>add</span></span></span><span><span> </span></span><span><span><span>package</span></span></span><span><span> </span></span><span><span><span>Microsoft</span></span></span><span><span><span>.</span></span><span><span>EntityFrameworkCore</span></span></span><span><span><span>.</span></span><span><span>SqlServer</span></span></span><span><span> </span></span><span><span><span>--</span></span><span><span>version</span></span></span><span><span> </span></span><span><span>5</span></span><span><span><span>.0</span></span></span><span><span><span>.</span></span><span><span>0</span></span><span><span>-</span></span><span><span>preview</span></span><span><span>.</span></span><span><span>5.20278</span></span><span><span>.</span></span><span><span>2</span></span></span>
</code></pre><p>The EF Core packages published today are:</p><ul><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore</a> – The main EF Core package</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.SqlServer</a> – Database provider for Microsoft SQL Server and SQL Azure</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Sqlite/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Sqlite</a> – Database provider for SQLite</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Cosmos/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Cosmos</a> – Database provider for Azure Cosmos DB</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.InMemory/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.InMemory</a> – The in-memory database provider</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Tools/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Tools</a> – EF Core PowerShell commands for the Visual Studio Package Manager Console</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Design/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Design</a> – Shared design-time components for EF Core tools</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite</a> – SQL Server support for spatial types</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite</a> – SQLite support for spatial types</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Proxies/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Proxies</a> – Lazy-loading and change-tracking proxies</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Abstractions/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Abstractions</a> – Decoupled EF Core abstractions</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Relational/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Relational</a> – Shared EF Core components for relational database providers</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Analyzers/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Analyzers</a> – C# analyzers for EF Core</li><li><a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Sqlite.Core/5.0.0-preview.5.20278.2" target="_blank">Microsoft.EntityFrameworkCore.Sqlite.Core</a> – Database provider for SQLite without a packaged native binary</li></ul><p>We have also published the 5.0 preview 5 release of the <a href="https://www.nuget.org/packages/Microsoft.Data.Sqlite.Core/5.0.0-preview.5.20278.2" target="_blank">Microsoft.Data.Sqlite.Core</a> ADO.NET provider.</p><h2 id="installing-dotnet-ef">Installing dotnet ef<a href="#installing-dotnet-ef"></a></h2><p>As with EF Core 3.0 and 3.1, the dotnet ef command-line tool is no longer included in the .NET Core SDK. Before you can execute EF Core migration or scaffolding commands, you'll have to install this package as either a global or local tool.</p><p><a href="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/06/efcore5preview5.jpg" data-featherlight="image"> <img src="https://devblogs.microsoft.com/dotnet/wp-content/uploads/sites/10/2020/06/efcore5preview5.jpg" alt="dotnet-ef"> </a></p><p>To install the preview tool globally, first uninstall any existing version with:</p><pre><code><span><span>dotnet tool </span></span><span><span><span>uninstall</span></span></span><span><span> </span></span>
</code></pre><p>Then install with:</p><pre><code><span><span> </span></span><span><span> </span></span><span><span> </span></span><span><span><span>-</span></span></span><span><span><span>-</span></span></span><span><span> </span></span><span><span><span>-</span></span></span><span><span> </span></span><span><span><span>-</span></span></span><span><span><span>-</span></span></span><span><span> </span></span><span><span><span>.</span></span></span><span><span><span>.</span></span></span><span><span><span>-</span></span></span>
</code></pre><p>It's possible to use this new version of dotnet ef with projects that use older versions of the EF Core runtime.</p><hr><h2 id="what-s-new-in-ef-core-5-preview-5">What's new in EF Core 5 Preview 5<a href="#what-s-new-in-ef-core-5-preview-5"></a></h2><p>We maintain documentation covering <a href="https://docs.microsoft.com/ef/core/what-is-new/ef-core-5.0/whatsnew" target="_blank">new features introduced into each preview</a>.</p><p>Some of the highlights from preview 4 are called out below. This preview also includes several bug fixes.</p><h3 id="database-collations">Database collations<a href="#database-collations"></a></h3><p>The default collation for a database can now be specified in the EF model.<br> This will flow through to generated migrations to set the collation when the database is created.<br> For example:</p><pre><code><span><span>modelBuilder</span></span><span><span>.</span></span><span><span>UseCollation</span></span><span><span>(</span></span><span><span><span>"German_PhoneBook_CI_AS"</span></span></span><span><span>)</span></span>
</code></pre><p>Migrations then generates the following to create the database on SQL Server:</p><pre><code><span><span><span>CREATE</span></span></span><span><span> </span></span><span><span><span>DATABASE</span></span></span><span><span> </span></span><span><span>[</span></span><span><span><span>Test</span></span></span><span><span>]</span></span><span><span>
</span></span><span><span><span>COLLATE</span></span></span><span><span> </span></span><span><span>German_PhoneBook_CI_AS</span></span><span><span>;</span></span></code></pre><p>The collation to use for specific database columns can also be specified.<br> For example:</p><pre><code><span><span> modelBuilder
</span></span><span><span><span>     </span></span><span><span>.</span></span><span><span>Entity</span></span></span><span><span>&lt;</span></span><span><span>User</span></span><span><span>&gt;()</span></span><span><span>
</span></span><span><span><span>     </span></span><span><span>.</span></span><span><span>Property</span></span></span><span><span>(</span></span><span><span>e </span></span><span><span>=&gt;</span></span><span><span> e</span></span><span><span>.</span></span><span><span>Name</span></span><span><span>)</span></span><span><span>
</span></span><span><span><span>     </span></span><span><span>.</span></span><span><span>UseCollation</span></span></span><span><span>(</span></span><span><span><span>"German_PhoneBook_CI_AS"</span></span></span><span><span>)</span></span>
</code></pre><p>For those not using migrations, collations are now reverse-engineered from the database when scaffolding a DbContext.</p><p>Finally, the <code><span>EF</span><span>.</span><span>Functions</span><span>.</span><span>Collate</span><span>()</span></code> allows for ad-hoc queries using different collations.<br> For example:</p><pre><code><span><span>context</span></span><span><span>.</span></span><span><span>Users</span></span><span><span>.</span></span><span><span>Single</span></span><span><span>(</span></span><span><span><span><span>e</span></span></span><span><span> </span></span><span><span>=&gt;</span></span></span><span><span> EF</span></span><span><span>.</span></span><span><span>Functions</span></span><span><span>.</span></span><span><span>Collate</span></span><span><span>(</span></span><span><span>e</span></span><span><span>.</span></span><span><span>Name</span></span><span><span>,</span></span><span><span> </span></span><span><span><span>"French_CI_AS"</span></span></span><span><span>)</span></span><span><span> </span></span><span><span>==</span></span><span><span> </span></span><span><span><span>"Jean-Michel Jarre"</span></span></span><span><span>);</span></span></code></pre><p>This will generate the following query for SQL Server:</p><pre><code><span><span><span>SELECT</span></span></span><span><span> TOP</span></span><span><span>(</span></span><span><span><span>2</span></span></span><span><span>)</span></span><span><span> </span></span><span><span>[</span></span><span><span>u</span></span><span><span>].[</span></span><span><span><span>Id</span></span></span><span><span>],</span></span><span><span> </span></span><span><span>[</span></span><span><span>u</span></span><span><span>].[</span></span><span><span><span>Name</span></span></span><span><span>]</span></span><span><span>
</span></span><span><span><span>FROM</span></span></span><span><span> </span></span><span><span>[</span></span><span><span><span>Users</span></span></span><span><span>]</span></span><span><span> </span></span><span><span><span>AS</span></span></span><span><span> </span></span><span><span>[</span></span><span><span>u</span></span><span><span>]</span></span><span><span>
</span></span><span><span><span>WHERE</span></span></span><span><span> </span></span><span><span>[</span></span><span><span>u</span></span><span><span>].[</span></span><span><span><span>Name</span></span></span><span><span>]</span></span><span><span> </span></span><span><span><span>COLLATE</span></span></span><span><span> </span></span><span><span>French_CI_AS</span></span><span><span> </span></span><span><span>=</span></span><span><span> N</span></span><span><span><span>'Jean-Michel Jarre'</span></span></span>
</code></pre><p>Note that ad-hoc collations should be used with care as they can negatively impact database performance.</p><p>Documentation is tracked by issue <a href="https://github.com/dotnet/EntityFramework.Docs/issues/2273" target="_blank">#2273</a>.</p><h3 id="flow-arguments-into-idesigntimedbcontextfactory">Flow arguments into IDesignTimeDbContextFactory<a href="#flow-arguments-into-idesigntimedbcontextfactory"></a></h3><p>Arguments are now flowed from the command line into the <code><span>CreateDbContext</span></code> method of <a href="https://docs.microsoft.com/dotnet/api/microsoft.entityframeworkcore.design.idesigntimedbcontextfactory-1?view=efcore-3.1" target="_blank">IDesignTimeDbContextFactory</a>.<br> For example, to indicate this is a dev build, a custom argument (e.g. <code><span>dev</span></code>) can passed on the command line:</p><pre><code><span><span>dotnet ef migrations </span></span><span><span><span>add</span></span></span><span><span> </span></span><span><span><span>two</span></span></span><span><span> </span></span>
</code></pre><p>This argument will then flow into the factory, where it can be used to control how the context is created and initialized.<br> For example:</p><pre><code><span><span><span>public</span></span></span><span><span> </span></span><span><span><span>class</span></span></span><span><span> </span></span><span><span>MyDbContextFactory</span></span><span><span> </span></span><span><span>:</span></span><span><span> </span></span><span><span>IDesignTimeDbContextFactory</span></span><span><span>&lt;</span></span><span><span>SomeDbContext</span></span><span><span>&gt;</span></span><span><span>
</span></span><span><span>{</span></span><span><span>
    </span></span><span><span><span><span>public</span></span></span><span><span> </span></span><span><span>SomeDbContext</span></span><span><span> </span></span><span><span><span>CreateDbContext</span></span></span><span><span><span>(</span></span><span><span><span>string</span></span></span><span><span>[]</span></span><span><span> args</span></span><span><span>)</span></span></span><span><span> 
        </span></span></span><span><span>=&gt;</span></span><span><span> </span></span><span><span><span>new</span></span></span><span><span> </span></span><span><span>SomeDbContext</span></span><span><span>(</span></span><span><span>args</span></span><span><span>.</span></span><span><span>Contains</span></span><span><span>(</span></span><span><span><span>"--dev"</span></span></span><span><span>));</span></span><span><span>
</span></span><span><span>}</span></span></code></pre><p>Documentation is tracked by issue <a href="https://github.com/dotnet/EntityFramework.Docs/issues/2419" target="_blank">#2419</a>.</p><h3 id="no-tracking-queries-with-identity-resolution">No-tracking queries with identity resolution<a href="#no-tracking-queries-with-identity-resolution"></a></h3><p>No-tracking queries can now be configured to perform identity resolution.<br> For example, the following query will create a new Blog instance for each Post, even if each Blog has the same primary key.</p><pre><code><span><span><span>context</span></span></span><span><span><span>.</span></span><span><span>Posts</span></span></span><span><span><span>.</span></span><span><span>AsNoTracking</span></span></span><span><span>()</span></span><span><span><span>.</span></span><span><span>Include</span></span></span><span><span>(</span></span><span><span>e </span></span><span><span>=&gt;</span></span><span><span> e</span></span><span><span>.</span></span><span><span>Blog</span></span><span><span>)</span></span><span><span><span>.</span></span><span><span>ToList</span></span></span><span><span>();</span></span></code></pre><p>However, at the expense of usually being slightly slower and always using more memory, this query can be changed to ensure only a single Blog instance is created:</p><pre><code><span><span><span>context</span></span></span><span><span><span>.</span></span><span><span>Posts</span></span></span><span><span><span>.</span></span><span><span>AsNoTracking</span></span></span><span><span>()</span></span><span><span><span>.</span></span><span><span>PerformIdentityResolution</span></span></span><span><span>()</span></span><span><span><span>.</span></span><span><span>Include</span></span></span><span><span>(</span></span><span><span>e </span></span><span><span>=&gt;</span></span><span><span> e</span></span><span><span>.</span></span><span><span>Blog</span></span><span><span>)</span></span><span><span><span>.</span></span><span><span>ToList</span></span></span><span><span>();</span></span></code></pre><p>Note that this is only useful for no-tracking queries since all tracking queries already exhibit this behavior.<br> Also, following API review, the <code><span>PerformIdentityResolution</span></code> syntax will be changed.<br> See <a href="https://github.com/dotnet/efcore/issues/19877#issuecomment-637371073" target="_blank">#19877</a>.</p><p>Documentation is tracked by issue <a href="https://github.com/dotnet/EntityFramework.Docs/issues/1895" target="_blank">#1895</a>.</p><h3 id="stored-persisted-computed-columns">Stored (persisted) computed columns<a href="#stored-persisted-computed-columns"></a></h3><p>Most databases allow computed column values to be stored after computation.<br> While this takes up disk space, the computed column is calculated only once on update, instead of each time its value is retrieved.<br> This also allows the column to be indexed for some databases.</p><p>EF Core 5.0 allows computed columns to be configured as stored.<br> For example:</p><pre><code><span><span>modelBuilder
    </span></span><span><span>.</span></span><span><span>Entity</span></span><span><span>&lt;</span></span><span><span>User</span></span><span><span>&gt;()</span></span><span><span>
    </span></span><span><span>.</span></span><span><span>Property</span></span><span><span>(</span></span><span><span><span><span>e</span></span></span><span><span> </span></span><span><span>=&gt;</span></span></span><span><span> e</span></span><span><span>.</span></span><span><span>SomethingComputed</span></span><span><span>)</span></span><span><span>
    </span></span><span><span>.</span></span><span><span>HasComputedColumnSql</span></span><span><span>(</span></span><span><span><span>"my sql"</span></span></span><span><span>,</span></span><span><span> </span></span><span><span><span>stored</span></span></span><span><span>:</span></span><span><span> </span></span><span><span><span>true</span></span></span><span><span>);</span></span></code></pre><h3 id="sqlite-computed-columns">SQLite computed columns<a href="#sqlite-computed-columns"></a></h3><p>EF Core now supports computed columns in SQLite databases.</p><hr><h2 id="daily-builds">Daily builds<a href="#daily-builds"></a></h2><p>EF Core previews are aligned with .NET 5 previews. These previews tend to lag behind the latest work on EF Core. Consider using the <a href="https://github.com/aspnet/AspNetCore/blob/master/docs/DailyBuilds.md" target="_blank">daily builds</a> instead to get the most up-to-date EF Core features and bug fixes.</p><p>As with the previews, the daily builds do not require .NET 5; they can be used with GA/RTM release of .NET Core 3.1.</p><hr><h2 id="documentation-and-feedback">Documentation and feedback<a href="#documentation-and-feedback"></a></h2><p>EF Core docs has a new landing page! The main page for Entity Framework documentation has been overhauled to provide you with a hub experience. We hope this new format helps you find the documentation you need faster and with fewer clicks.</p><p>The starting point for all EF Core documentation is <a href="https://docs.microsoft.com/ef/" target="_blank">docs.microsoft.com/ef/</a>.</p><p>Please file issues found and any other feedback on the <a href="https://github.com/dotnet/efcore" target="_blank">dotnet/efcore GitHub repo</a>.</p><hr><h2 id="helpful-short-links">Helpful Short Links<a href="#helpful-short-links"></a></h2><p>The following short links are provided for easy reference and access.</p><p>Main documentation:<br> <a href="https://aka.ms/efdocs" target="_blank">https://aka.ms/efdocs</a></p><p>Issues and feature requests for EF Core:<br> <a href="https://aka.ms/efcorefeedback" target="_blank">https://aka.ms/efcorefeedback</a></p><p>Entity Framework Roadmap:<br> <a href="https://aka.ms/efroadmap" target="_blank">https://aka.ms/efroadmap</a></p><p>What's new in EF Core 5.x?<br> <a href="https://aka.ms/efcore5" target="_blank">https://aka.ms/efcore5</a></p><hr><h2 id="thank-you-from-the-team">Thank you from the team<a href="#thank-you-from-the-team"></a></h2><p>A big thank you from the EF team to everyone who has used EF over the years!</p><hr><h2 id="thank-you-to-our-contributors-">Thank you to our contributors!<a href="#thank-you-to-our-contributors-"></a></h2><p>A big thank you to the following community members who have already contributed code or documentation to the EF Core 5 release! (List is in chronological order of first contribution to EF Core 5).</p></div></div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>