<!DOCTYPE html>
<html lang="en">
<head>
    <title>
The polygons of Another World: Atari ST - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="The polygons of Another World: Atari ST - linksfor.dev(s)"/>
    <meta property="og:description" content="January 3, 2020"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://fabiensanglard.net/another_world_polygons_atariST/index.html"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - The polygons of Another World: Atari ST</title>
<div class="readable">
        <h1>The polygons of Another World: Atari ST</h1>
            <div>Reading time: 11-14 minutes</div>
        <div>Posted here: 03 Jan 2020</div>
        <p><a href="http://fabiensanglard.net/another_world_polygons_atariST/index.html">http://fabiensanglard.net/another_world_polygons_atariST/index.html</a></p>
        <hr/>
<div id="readability-page-1" class="page"><br><center>
    
</center><p>
January 3, 2020</p><p><b>The polygons of Another World: Atari ST</b></p>
 <hr>



<p>
  This article is part of a study about the ports of Another World. It is highly recommended to read <a href="http://fabiensanglard.net/another_world_polygons/index.html">Another World 101</a> before reading this.
</p>    

<p><b>HISTORY of the ATARI ST</b></p><hr>
<div>

      
    <p><img src="http://fabiensanglard.net/another_world_polygons_atariST/atari_logo.svg" width="40%">
    The genesis of the Atari ST is tumultuous to say the least. It starts like a fairy tale and ends in war and betrayals involving Amiga Corp, Commodore, Atari, and Atari Computer division. 

    </p><p>
    In 1983, Hi-Toro was a Santa Clara based startup building a video-game console called "Lorraine". Featuring a powerful 68000 with breath-taking graphics capabilities, it was a technological marvel far superior to all its competitors. Hi-Toro however was running out of cash. Atari, then video-game giant, injected $500,000 to keep development ongoing in exchange of the right to add a keyboard and sell the console as a computer. Everybody won.
    </p><p>
    Far from California, in Pennsylvania, a power struggle at Commodore resulted in the departure of its founder Jack Tramiel. He immediately formed Tramel Technology, poaching Commodore engineers in the process. Needless to say the separation was far from amicable.
    </p><p>
    By mid-1984 it was Atari's turn to be in financial turmoil. When Jack Tramiel expressed interests in buying Atari's Computer division, Commodore saw an opportunity to move against its ex-CEO. They snapped the tech away by buying Hi-Toro (which had renamed itself Amiga Corporation by then) and only refunded Atari for its "loan"<a name="back_1" href="#footnote_1"><sup>[1]</sup></a>.

</p><p> 
Tramiel completed the acquisition of Atari Computers and immediately sued Amiga Corporation. The matter would not be settled until March 1987<a name="back_2" href="#footnote_2"><sup>[2]</sup></a>. Meanwhile Atari found itself without a new tech to make itself profitable again<a name="back_3" href="#footnote_3"><sup>[3]</sup></a>.

</p><p> 
For a while Jack Tramiel considered buying the Genesis from Sega who was looking for a partner with experience in North America. Ultimately, the idea was rejected. What happened next is recounted by DadHacker<a name="back_4" href="#footnote_4"><sup>[4]</sup></a><a name="back_5" href="#footnote_5"><sup>[5]</sup></a>. Jack Tramiel kept only 900 out of 10,000 Atari employees. The survivors engaged in a death march with the goal to design and release a new machine within a year.</p><p>

Amazingly they made it. The Atari ST was released in June 1985, beating the Amiga 1000 to market by a month. </p><picture>
            <source srcset="atariST.webp" type="image/webp">
    <img src="http://fabiensanglard.net/another_world_polygons_atariST/atariST.jpg" width="100%">
    </picture>
    <p><span><i><small>Atari 1040ST<sup>E</sup>. Photo Credit: Wikipedia</small></i></span>


    <img src="http://fabiensanglard.net/another_world_polygons_atariST/atari_programmin.gif">
    The machine was well received by customers. By November 1985 Jack Tramiel announced Atari had shipped 50,000 units. The pricetag was a particular tour-de-force. A color 520ST sold for $999 while an Amiga 1000 sold for $1,285.

    </p><p>
     Faced with two machines featuring the same CPU and the same amount of RAM, the additional $300 was a "tough sale" just to get "more colors". Many consumers opted for an ST.

    </p><p>
    Beside its main selling point, the machine has some noteworthy advantages over the competition. The monochrome 640x480 high-resolution mode was a thing of beauty to programmers. The built-in MIDI interface was appreciated by musicians. Small detail which may have mattered, the operating system (TOS) and the kernel were actually in the ROM. There was no need for a floppy disk to boot!
    </p><p>
    The Atari ST quickly gathered a cult-following, particularly in Europe. Devotion to the ST was such that demo-makers obsessively attempted to develop overscan techniques<a name="back_6" href="#footnote_6"><sup>[6]</sup></a><a name="back_7" href="#footnote_7"><sup>[7]</sup></a><a name="back_8" href="#footnote_8"><sup>[8]</sup></a><a name="back_9" href="#footnote_9"><sup>[9]</sup></a> to remove the black screen borders. They ultimately were successful<a name="back_10" href="#footnote_10"><sup>[10]</sup></a>.

 </p><p>
     Over the course of its life, from 1985 until 1993, Atari Computers sold 2 million units<a name="back_11" href="#footnote_11"><sup>[11]</sup></a>. To many who lived through it, this era is remembered as the infamous Amiga vs Atari ST war.
</p></div>

<p><b>Atari ST<sup>E</sup></b></p><hr>
<div><p>   
From a CG, animation and video-games standing point however, there was not much of a war. Not even a battle. With its Agnus and Denise co-processors, the Amiga was vastly superior to the Atari ST. As an example, the memory layout of the Atari ST framebuffer was excruciating when attempting to move a sprite across the screen.

 </p><p>
To palliate to its shortcomings, Atari Computers refreshed the Atari ST line in 1989 with its 520 ST<sup>E</sup> and 1040 ST<sup>E</sup>. Among the improvements, a Genlock, 12-bit colors, PCM audio, and most importantly a BLiTTER<a name="back_12" href="#footnote_12"><sup>[12]</sup></a> beefed up the Atari ST with technology enabling it to rival with the Amiga.
</p></div>




<p><b>Architecture</b></p><hr>
<p>    
  The capabilities of the ST<sup>E</sup> Blitter were invaluable to a game programmer. Unfortunately it came too late. There was a huge base of Atari ST which deterred developers from investing the time to make their game run better for a minority of users. Not to mention nobody dared releasing an "ST<sup>E</sup> only" title. Another World is no exception as the developer of the Jaguar version (who saw the Atari ST source code) confirms.<br>
</p><blockquote>
  Another World was entirely programmed to run on the 68000. The capabilities of the STE were not used at all.
 <p>- SÃ©bastien Briais</p>

</blockquote>


<p>
  Note that there is a DMA controller on all Atari ST but it can only transfer from the floppy/HDD to RAM which does not help game programming much. This left a programmer with very little. Namely the Motorola 68000 processor running at 8MHz and 512 KiB RAM.<br>
  
  
  <img src="http://fabiensanglard.net/another_world_polygons_atariST/atari_st_arch.svg" width="100%">
  <span><i><small>Good luck Jim</small></i></span>
</p>

<p><b>Video System</b></p><hr>
<div><p>
The GLUE chip in charge of generating the video signal uses 3-bit per channel (9 bits per pixel) resulting in 512 colors.</p>
<p><span><i><small>9-bit per pixel color space</small></i></span>
</p></div><p>
  <b><u>Trivia:</u></b> It is by manipulating the Shifter, the GLUE, and the MMU that demomaker managed to remove the infamous Atari screen black borders. The techniques of "overscan" and "fullscreen" switch the refresh frequency between 50Hz and 60Hz and also move from hiRes to LowRes before a scanline is completed in order to trick the GLUE into delaying VSYNC/HSYNC signals<a name="back_13" href="#footnote_13"><sup>[13]</sup></a>!
</p>




<p><b>Another World on Atari ST</b></p><hr>
<p>
  Another World on Atari ST was entirely written by Eric Chahi in parallel with the Amiga version. The 68000 CPU, similar to the Amiga, made the port easier since a lot of the VM ASM was reusable. Things differ on the graphic side where three modes are available. High resolution (640x400 2 colors) which is great for programming, Medium resolution (640x200 4 colors) which is not very interesting in this context, and Low resolution 320x200, 16 colors<a name="back_14" href="#footnote_14"><sup>[14]</sup></a> which is a perfect match for Another World.
       
       
<br> All resolutions uses 32KiB per framebuffer. There are no bitplanes here like on the Amiga we saw in the previous entry. In High resolution, each bit correspond to a pixel. In Low resolution, pixel indice are woven on 4 bits spread across 64 bits.
</p>


<p><b>WOVEN HELL</b></p><hr>
<div><p>
  To a game using sprites, the lowRes woven layout was a difficulty. Try to picture the exercise of masking/writing with one bit resolution when the bus resolution is one byte (8 bits). Now picture a sprite crossing bytes boundary and the task turns into a nightmare<a name="back_15" href="#footnote_15"><sup>[15]</sup></a>. It was in fact so CPU intensive that games did not use mask/write and instead preferred to use pre-rotated sprites (one set for each bit alignment) which, to the Atari ST credit, was not too much of a problem given the generous amount of RAM on-board. 
  
  </p><p>
   Interestingly for Another World, the interleaved graphic layout hell turns into a paradise when it comes to writing long lines of a single color. Let's see why.


  </p></div><p><b>Solving FILL AND COPY</b></p><hr>
<p> 
   With only a CPU to perform FILL and COPY, these task are done in the most simple way. There are no clever trick here but the non-planar layout of the frambuffer allows the 68000 to "cruise". With a framebuffer made of 32KiB, 8000 long (32 bits) move.l operations do the job in both cases. The disassembly output of the 68000 portion of COPY is as follow.
</p><pre>    ...
    move.w   #49,d0        ;50*160*4 = 32000 octets

.copy_loop:   
    rept     160       
    move.l   (a1)+,(a0)+
    endr

    dbra     d0,.copy_loop
    ...</pre>
    <div><p>
      Since the 68000 timing are very well documented<a name="back_16" href="#footnote_16"><sup>[16]</sup></a><a name="back_17" href="#footnote_17"><sup>[17]</sup></a> we can calculate exactly how long a framebuffer COPY operations needs to complete. Since this type of "move.l" takes 20 cycles to run, the total number of cycles required is 20 * 160 * 50 = 160,000 cycles. At 8,000,000 cycles/seconds, COPY took 20ms to complete.
      </p><p>
      Same idea for FILL except that instead of "Address register indirect with post-incrementing" operand, the first operand of move.l instruction is a "Data direct"which takes "only" 12 cycles. This give a total of 12ms for FILL.</p></div><pre>    ...
    move.w   #49,d0        ;50*160*4 = 32000 octets
    
.fill_loop: 
    rept     160  
    ; d1 = color repeated 8 times since d1=32 bits and color index=4  bits)
    move.l d1,(a0)+
    endr

    dbra     d0,.fill_loop
    ...</pre>
<div>
<!-- These kind of numbers give a deeper appreciation for the blitter of the Amiga and the Atari ST<sup>E</sup>.
<br/><br/> -->
<p><img src="http://fabiensanglard.net/another_world_polygons_atariST/scarab.gif" width="60%"></p><u><b>Trivia:</b></u><p> You can differentiate the Atari ST from the Amiga version easily if you look at the second gameplay screen. 
</p><p>
The cute  scarab encountered on the Amiga version is gone on the Atari ST. In fact, it is absent from all the other ports<a name="back_18" href="#footnote_18"><sup>[18]</sup></a>, making it an Amiga exclusivity for some an unclear reason.
</p></div>

<p><b>Solving the DRAW problem</b></p><hr>
<div><p>
  Without a "line drawing mode" and "area filling mode", the Atari ST port uses a simple Bresenham algorithm to follow polygon edges. With two edges, horizontal lines start and end screen space coordinates are generated. Then the 68000 fills the space between them<a name="back_19" href="#footnote_19"><sup>[19]</sup></a>. The overall works exactly like the Amiga Blitter except that everything is done in software here.
  
  </p><p>
   It may look really slow but the "cruising speed" can also be reached here by taking advantage of the woven layout. If you look closely, most Another World frames are made of long horizontal lines of the same color. This allows the 68000 to write lines in block of 16 pixels with the move.l instructions we saw earlier.
</p><p>
    The screen where Lester meets his "savior" is a good example.<br>



    <img src="http://fabiensanglard.net/another_world_polygons_atariST/lester_raw.gif" width="100%">

Here we can see, in red, parts of lines which cannot be rendered in 16 pixels blocks because of framebuffer layout and alignment. These "slow" pixels only account for 23% of the framebuffer at the edge of polygons. 77% of the framebuffer is rendered with "fast" 16 pixels blocks writes.<br>


<img src="http://fabiensanglard.net/another_world_polygons_atariST/lester_masked.gif" width="100%"></p></div>
 
<p><b>Solving the palette problem</b></p><hr>
<div><p>
  The last problem to solve is related to The Atari ST having a shallow-ish color depth. While the Amiga allows 12 bits per color, the AtariST can only do 9 bits per color.

  </p><p> The solution was to ship the game with the Amiga palettes and let the 68000 take care of converting from 12-bit to 9-bit with a simple 1-bit LSR for each channel at load time.
  </p><p>
  The result is a little bit darker compared to the Amiga but overall barely noticeable<a name="back_20" href="#footnote_20"><sup>[20]</sup></a>.
</p></div>

<p><b>Verdict </b></p><hr>
<p>
  Despite obvious disadvantages, the Atari ST managed to run a faithful version of Another World. Against all odds, the game does not have to shy away compared to the Amiga. The smaller color space was barely noticeable and the engine managed to perform only slightly slower<a name="back_21" href="#footnote_21"><sup>[21]</sup></a> than the Amiga (which ran close to 24fps). Chapeau bas.
</p>

<p><b>Next</b></p><hr>
<p>
Tomorrow, Another World on <a href="http://fabiensanglard.net/another_world_polygons_PC_DOS/index.html">IBM PC/DOS</a>.
</p>

<p><b>References</b></p><hr><p id="paperbox"><table><tbody><tr><td><a name="footnote_1"></a><a href="#back_1">^</a></td><td> [ 1]</td><td>Source&nbsp;:</td><td><a href="https://lowendmac.com/2016/the-amiga-story-conceived-at-atari-born-at-commodore/">The Amiga Story: Conceived at Atari, Born at Commodore</a></td></tr><tr><td><a name="footnote_2"></a><a href="#back_2">^</a></td><td> [ 2]</td><td>Source&nbsp;:</td><td><a href="https://en.wikipedia.org/wiki/Amiga_Corporation">Amiga Corporation</a></td></tr><tr><td><a name="footnote_3"></a><a href="#back_3">^</a></td><td> [ 3]</td><td>Source&nbsp;:</td><td><a href="https://en.wikipedia.org/wiki/Atari_ST#Origins">Wikipedia: Atari ST Origins</a></td></tr><tr><td><a name="footnote_4"></a><a href="#back_4">^</a></td><td> [ 4]</td><td>Source&nbsp;:</td><td><a href="http://www.dadhacker.com/blog/?p=995">Dadhacker, The Atari ST, Part 1</a></td></tr><tr><td><a name="footnote_5"></a><a href="#back_5">^</a></td><td> [ 5]</td><td>Source&nbsp;:</td><td><a href="http://dadhacker.com/blog/?p=1000">Dadhacker, The Atari ST, Part 2</a></td></tr><tr><td><a name="footnote_6"></a><a href="#back_6">^</a></td><td> [ 6]</td><td>Source&nbsp;:</td><td><a href="https://www.abandonware-magazines.org/affiche_mag.php?mag=6&amp;page=3">ST Magazine 51: 'Les techniques de l'Overscan part 1' by Shengan Short</a></td></tr><tr><td><a name="footnote_7"></a><a href="#back_7">^</a></td><td> [ 7]</td><td>Source&nbsp;:</td><td><a href="https://www.abandonware-magazines.org/affiche_mag.php?mag=6&amp;page=3">ST Magazine 52: 'Les techniques de l'Overscan part 2' by Shengan Short</a></td></tr><tr><td><a name="footnote_8"></a><a href="#back_8">^</a></td><td> [ 8]</td><td>Source&nbsp;:</td><td><a href="https://www.abandonware-magazines.org/affiche_mag.php?mag=6&amp;page=3">ST Magazine 55: 'Les techniques de l'Overscan 3' by Shengan Short</a></td></tr><tr><td><a name="footnote_9"></a><a href="#back_9">^</a></td><td> [ 9]</td><td>Source&nbsp;:</td><td><a href="https://www.abandonware-magazines.org/affiche_mag.php?mag=6&amp;page=4">ST Magazine 70: 'Les techniques de l'Overscan' by Shengan Short</a></td></tr><tr><td><a name="footnote_10"></a><a href="#back_10">^</a></td><td> [10]</td><td>Source&nbsp;:</td><td><a href="https://aldabase.com/atari-st-fullscreen-demos-history/">Atari ST Fullscreen demos history</a></td></tr><tr><td><a name="footnote_11"></a><a href="#back_11">^</a></td><td> [11]</td><td>Source&nbsp;:</td><td><a href="https://amigalove.com/viewtopic.php?t=131">Atari ST Computer Sales and Marketshare: A Comparison</a></td></tr><tr><td><a name="footnote_12"></a><a href="#back_12">^</a></td><td> [12]</td><td>Source&nbsp;:</td><td><a href="https://www.abandonware-magazines.org/affiche_mag.php?mag=6&amp;page=4">ST Magazine 70: 'Le Blitter, animation tres grande vitesse' by Mathias Agopian</a></td></tr><tr><td><a name="footnote_13"></a><a href="#back_13">^</a></td><td> [13]</td><td>Source&nbsp;:</td><td><a href="http://alive.atari.org/alive9/ovrscn1.php">Atari Overscan Techniques</a></td></tr><tr><td><a name="footnote_14"></a><a href="#back_14">^</a></td><td> [14]</td><td>Source&nbsp;:</td><td><a href="https://gitlab.com/amigasourcecodepreservation/real-time-3d-graphics-for-the-atari-st/blob/master/pdf/real-time-3d-graphics-for-the-atari-st-1991-tyler.pdf">Real-time 3d graphics for the Atari ST</a></td></tr><tr><td><a name="footnote_15"></a><a href="#back_15">^</a></td><td> [15]</td><td>Source&nbsp;:</td><td><a href="https://codetapper.com/amiga/random-rants/why-atari-st-games-were-slower-than-the-amiga-versions/">Why Atari ST games were slower than the Amiga versions</a></td></tr><tr><td><a name="footnote_16"></a><a href="#back_16">^</a></td><td> [16]</td><td>Source&nbsp;:</td><td><a href="http://oldwww.nvg.ntnu.no/amiga/MC680x0_Sections/timmove.HTML">Move Instruction Execution Times</a></td></tr><tr><td><a name="footnote_17"></a><a href="#back_17">^</a></td><td> [17]</td><td>Source&nbsp;:</td><td><a href="http://fabiensanglard.net/another_world_polygons_atariST/68000.pdf">The 68000's Instruction Set</a></td></tr><tr><td><a name="footnote_18"></a><a href="#back_18">^</a></td><td> [18]</td><td>Source&nbsp;:</td><td><a href="http://nerdlypleasures.blogspot.com/2013/01/another-world-aka-out-of-this-world.html">Nerdy Pleasures</a></td></tr><tr><td><a name="footnote_19"></a><a href="#back_19">^</a></td><td> [19]</td><td>Source&nbsp;:</td><td><a href="https://github.com/fabiensanglard/Another-World-Bytecode-Interpreter/blob/master/video.cpp#L196">Another World Source Code: Video::fillPolygon</a></td></tr><tr><td><a name="footnote_20"></a><a href="#back_20">^</a></td><td> [20]</td><td>Source&nbsp;:</td><td><a href="http://nerdlypleasures.blogspot.com/2013/01/another-world-aka-out-of-this-world.html">Nerdy Pleasures, 'ST has a slightly darker palette than the Amiga.'</a></td></tr><tr><td><a name="footnote_21"></a><a href="#back_21">^</a></td><td> [21]</td><td>Source&nbsp;:</td><td><a href="http://nerdlypleasures.blogspot.com/2013/01/another-world-aka-out-of-this-world.html">Nerdy Pleasures, 'The Atari ST version runs somewhat slower than the Amiga'</a></td></tr></tbody></table></p> <hr>
 <center>*</center></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>