<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Durable Functions: Part 1 &#x2013; The Intro - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Durable Functions: Part 1 &#x2013; The Intro - linksfor.dev(s)"/>
    <meta property="article:author" content="xximjasonxx"/>
    <meta property="og:description" content="No Code in this post. Here we establish the starting point Event Driven Programming is a popular way to approach complex systems with a heavy emphasis on breaking applications apart and into smalle&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://jfarrell.net/2020/08/09/durable-functions-part-1-the-intro/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Durable Functions: Part 1 &#x2013; The Intro</title>
<div class="readable">
        <h1>Durable Functions: Part 1 &#x2013; The Intro</h1>
            <div>by xximjasonxx</div>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 13 Aug 2020</div>
        <p><a href="https://jfarrell.net/2020/08/09/durable-functions-part-1-the-intro/">https://jfarrell.net/2020/08/09/durable-functions-part-1-the-intro/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		
<p><strong>No Code in this post. Here we establish the starting point</strong></p>



<p>Event Driven Programming is a popular way to approach complex systems with a heavy emphasis on breaking applications apart and into smaller, more fundamental pieces. Done correctly, taking an event driven approach can make coding more fun and concise and allow for “specialization” over “generalization”. In doing so, we get closer to the purity of code that does only what it needs to do and nothing more, which should always be our aim as software developers.</p>



<p>In realizing this for cloud applications I have become convinced that, with few exceptions, serverless technologies must be employed as the glue for complex systems. The more they mature, the greater the flexibility they offer for the Architect. In truth, not using serverless can, and should be, viewed in most cases as an anti-pattern. I will note that I am referring explicitly to tooling such as AWS Lamba, Google Cloud Functions, and Azure Functions, I am not speaking to “codeless” solutions such as Azure Logic Apps or similar tools in other platforms – the purpose of such tools is mainly to allow less technical persons to build out solutions. Serverless technologies, such as those mentioned, remain in the domain of the Engineer/Developer.</p>



<p>Very often I find that engineers view serverless functions as more of a “one off” technology, good for that basic endpoint that can run in Consumption. As I have shown before, Azure Functions in particular are very mature and through the use of “bindings” can enable highly sophisticated scenarios without need for writing excessive amounts of boilerplate code. Further, offerings such as Durable Functions in Azure (Step Functions in AWS) enable serverless to go a step further and actually maintain a semblance of state between calls – thus enabling sophisticated multi-part workflows that feature a wide variety of inputters for workflow progression. I wanted to demonstrate this in this series.</p>



<p>Planning Phase</p>



<p>As with any application, planning is crucial and our File Approver application shall be no different. In fact, with event driven applications planning is especially crucial because while Event Driven systems offer a host of advantages they also require certain questions to be answered. Some common questions:</p>



<ul><li>How can I ensure events get delivered to the components of my system?</li><li>How do I handle a failure in one component but success in another?</li><li>How can I be alerted if events start failing?</li><li>How can I ensure events that are sent during downtime are processed? And in the correct order?</li></ul>



<p>Understandable, I hope, these questions are too big to answer as part of this post but, are questions I hope you, as an architect, are asking your team when you embark on this style of architecture.</p>



<p>For our application, we will adopt a focus on the “golden path”. That is, the path which assumes everything goes correctly. The following diagram shows our workflow:</p>



<figure><img data-attachment-id="2160" data-permalink="https://jfarrell.net/durablefunctionsworkflow/" data-orig-file="https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png" data-orig-size="681,367" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="durablefunctionsworkflow" data-image-description="" data-medium-file="https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png?w=300" data-large-file="https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png?w=681" src="https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png?w=681" alt="" srcset="https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png 681w, https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png?w=150 150w, https://xximjasonxx.files.wordpress.com/2020/08/durablefunctionsworkflow.png?w=300 300w" sizes="(max-width: 681px) 100vw, 681px"></figure>



<p>Our flow is quite simple and straightforward</p>



<ul><li>Our user uploads a file to an Azure Function that operates off an HttpTrigger</li><li>After receiving this file, the binary data is written to Azure Blob Storage and a related entry is made in Azure Table Storage</li><li>The creation of the blob triggers Durable Function Orchestration which will manage a workflow that aims to gather data about the file contents and ultimately allow users to download it</li><li>Our Durable workflow contains three steps, two of which will pause our workflow waiting for human actions (done via Http API calls). The other is a “pure function” that is only called as part of this workflow</li><li>Once all steps are complete the file is marked available for download. When requested the <strong>Download File</strong> function will return the gathered metadata for the file AND the generated SAS Token allowing persons to download the file for a period of 1hr</li></ul>



<p>Of course, we could accomplish this same goal with a traditional approach but, that would leave us to write a far more sophisticated solution than I ended up with. For reference, here is the complete source code: <a href="https://github.com/jfarrell-examples/DurableFunctionExample">https://github.com/jfarrell-examples/DurableFunctionExample</a></p>



<p>Azure Function Bindings</p>



<p>Bindings are a crucial components of efficient Azure Function design, at present I am not aware of a similar concept in AWS but, I do not discount its existence. Using <em>bindings</em> we can write FAR LESS code and make our functions easier to understand with more focus on the actual task instead of logic for connecting and reading from various data source. In addition, the <em>triggers</em> tie very nicely into the whole Event Driven paradigm. You can find a complete list of ALL triggers here:</p>



<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob">https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob</a> – <em>Note:</em> this is a direct link to the Blob storage triggers, see the left hand side for a complete list.</p>



<p>Throughout my code sample you will see references to bindings for Durable Functions, Blobs, Azure Table Storage, and Http. Understanding these bindings is, as I said, crucial to your sanity when developing Azure Functions.</p>



<p>Visual Studio Code with Azure Function Tools</p>



<p>I recommend Visual Studio Code when developing any modern application since its lighter and the extensions give you a tremendous amount of flexibility. This is not to say you cannot use Visual Studio, the same tools and support exist, I just find Visual Studio Code (with the right extensions) to be the superior product, YMMV.</p>



<p>Once you have Visual Studio Code you will want to install two separate things:</p>



<ul><li>Azure Functions Extension VSCode</li><li>Azure Function Core Tools (<a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=linux%2Ccsharp%2Cbash">here</a>)</li></ul>



<p>I really cannot say enough good things about Azure Function Core Tools. It has come a long way from version 1.x and the recent versions are superb. In fact, I was able to complete my ENTIRE example without ever deploying to Visual Studio, using breakpoints all along the way.</p>



<p>The extension for Visual Studio Code is also very helpful for both creating and deploying Azure Functions. Unlike traditional .NET Core applications, I do not recommend using the command line to create the project. Instead, open Visual Studio Code and access your Azure Tools. If you have the Functions extension installed, you will see a dedicated blade – expand it.</p>



<figure><img data-attachment-id="2173" data-permalink="https://jfarrell.net/selection_012-2/" data-orig-file="https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png" data-orig-size="499,360" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="selection_012" data-image-description="" data-medium-file="https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png?w=300" data-large-file="https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png?w=499" src="https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png?w=499" alt="" srcset="https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png 499w, https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png?w=150 150w, https://xximjasonxx.files.wordpress.com/2020/08/selection_012.png?w=300 300w" sizes="(max-width: 499px) 100vw, 499px"></figure>



<p>The first icon (looks like a folder) enables you to create a Function project through Code. I recommend this approach since it gets you started very easily. I have not ruled out the existence of templates that could be downloaded and use through <strong>dotnet new</strong> but this works well enough.</p>



<p>Keep in mind that a Function project is 1:1 with a Function app so, you will want to target an existing directory if you play to have more than one in your <em>solution</em>. Note that this is likely completely different in Visual Studio, I do not have any advice for that approach.</p>



<p>When you go through the creation process you will be asked to create a function. For now, you can create whatever you like, I will be diving into our first function in Part 2, as you create subsequent functions use the lightning icon next to the folder. Doing this is not required, it is perfectly acceptable to build your functions up but, using this gets the VSCode settings correct to enable debugging with the Core Tools so, I highly recommend it.</p>



<p>The arrow (third icon) is for deploying. Of course, we should never use this outside of testing since we would like a CI/CD process to test and deploy code efficiently – we wont be covering CI/CD for Azure Functions in this series but, we will certainly in a future series.</p>



<p>Conclusion</p>



<p>Ok so, now we understand a little about what Durable Functions are and how they play a role in Event Driven Programming. I also walked through the tools that are used when developing Azure Functions and how to use them.</p>



<p>Moving forward into Part 2, we will construct our File Upload portion of the pipeline and show how it starts our Durable Function workflow.</p>



<p>Once again the code is available here:<br><a href="https://github.com/jfarrell-examples/DurableFunctionExample">https://github.com/jfarrell-examples/DurableFunctionExample</a></p>
			
			
						</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>