<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Elastic APM .NET agent beta released -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Elastic APM .NET agent beta released</h1>
    <div class="jsx-525428420 col-12 col-md-9 col-lg-9"><p>We are proud to announce the <a href="https://www.nuget.org/packages?q=Elastic.Apm">beta release</a> of the Elastic APM .NET agent! The version number of this release is <code>1.0.0-beta1</code>.
</p><p>Before you get too excited, a quick reminder that you should not run the beta in production. The agent is now ready for more serious testing, so you should definitely consider giving it a try in your test, pre-prod, and dev environments. If you do so, we&apos;d be thrilled to get some feedback in the <a href="https://discuss.elastic.co/c/apm">discussion forum</a>.
</p><p>Back in February we announced the <a href="/blog/elastic-apm-dot-net-agent-preview-released">alpha release</a> of the .NET APM agent. We received very positive feedback from the community, and we managed to attract lots of users already in this very early stage. Our <a href="https://www.nuget.org/packages/Elastic.Apm">base NuGet package</a> reached around 20,000 downloads.
</p><p>In this post I&apos;ll summarize what happened since the alpha release, and I&apos;ll also give a short summary about what we plan to do in the coming months.
</p><h2>Distributed tracing support</h2><p>An important new feature of the agent in the beta release is distributed tracing. If you have multiple services that communicate over HTTP with the <code>HttpClient</code> class, the agent will automatically connect these services into a single trace.
</p><p><img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blta2c27a798968828f/5d1a5ee48c85764d8812127a/DotNetDistributedTracingSample.jpg" alt="Dot Net Distributed Tracing Sample"></p><p>The agent implements the <a href="https://www.w3.org/TR/trace-context/">W3C Trace Context</a> specification. One small caveat to this is that the Trace Context spec is not yet an official standard (although it&#x2019;s already very close to it &#x2014; at this moment it&apos;s a &quot;Candidate Recommendation&quot;), therefore, in order to avoid breaking tracing in case the W3C Trace Context proposal changes before its finalization, similarly to other Elastic APM agents, we also prefix the added HTTP header with <code>elastic-apm</code>. Everything else is implemented according to the specification, and once the W3C Trace Context specification becomes a standard, we will also rename our HTTP header to completely follow the specification.
</p><p>In case of HTTP calls, with the <code>HttpClient</code> class you don&#x2019;t need to do anything; distributed tracing is automatically enabled.
</p><p>We have also added the ability to serialize and deserialize the trace-parent value manually with the Public Agent API. If your application communicates over a non-HTTP protocol (e.g. gRPC or a direct TCP connection) by using the Public Agent API, you can manually &#x201C;continue&#x201D; a distributed trace on the incoming side.
</p><p>Here is how to serialize the trace parent header:
</p><pre class="prettyprint">string outgoingDistributedTracingData = Agent.Tracer.CurrentTransaction
                     .OutgoingDistributedTracingData.SerializeToString();
</pre><p>The <code>outgoingDistributedTracingData</code> variable contains the string representation of the distributed tracing data.
</p><p>When you call another service, you can transfer this string to the callee service and continue the trace with the following method call:
</p><pre class="prettyprint">var transaction2 = Agent.Tracer.StartTransaction(&quot;Transaction2&quot;, &quot;TestTransaction&quot;, DistributedTracingData.TryDeserializeFromString(serializedDistributedTracingData));
</pre><p>where <code>serializedDistributedTracingData</code> is the string value that you serialized in the caller side.
</p><p>The result is that when you look at transactions from these two services in Kibana they will be connected as a single trace.
</p><p><img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blte33649aae8811419/5d1a5f1d3819dc4d83e0c455/DotNetDistributedTracingWithAgentApi.jpg" alt="Dot Net Distributed Tracing With Agent API"></p><p>Of course we plan to continuously add support for more and more libraries using non-HTTP protocols out of the box.
</p><h2>Sampling</h2><p>The alpha releases of the agent recorded every single transaction, which in a production system isn&#x2019;t necessarily ideal. In production, you usually want to capture only a subset of your transactions.
</p><p>Therefore we also added sampling to the agent. It works the same as in other Elastic APM agents: With the <a href="/guide/en/apm/agent/dotnet/current/config-core.html#config-transaction-sample-rate">TransactionSampleRate config</a> you can tell the agent to only record a certain percentage of the transactions. The expected value is between 0 and 1, where 0.4 means 40% of the transactions will be recorded.
</p><p>Errors and exceptions are always captured no matter whether the corresponding transaction is sampled or not.
</p><h2>Metrics</h2><p>The beta version out of the box reports the following metrics:
</p><ul><li>System free and total memory (Windows and Linux only)</li><li>Process CPU usage (every platform where .NET Core is supported)</li><li>System CPU usage (Windows and Linux only)</li><li>Process working set and private bytes (every platform where .NET Core is supported)</li></ul><p>With this, the first iteration of the metrics work landed in the 1.0.0-beta1 version of the APM .NET agent.
</p><p><img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/bltabfbf8ca9a88f939/5d1a5f445d8a9a536d15e978/DotNetMetrics.jpg" alt="Dot Net Metrics"></p><p>But we won&#x2019;t stop here: We plan to add <a href="https://github.com/elastic/apm-agent-dotnet/issues/321">runtime-specific metrics</a> (e.g. GC metrics and more), and we&apos;re also considering <a href="https://github.com/elastic/apm-agent-dotnet/issues/322">an API or an integration with an existing metrics library</a> to also send custom metrics to Elastic APM. In case you have any input, <a href="https://discuss.elastic.co/c/apm">feel free to contact us</a>.
</p><p>One interesting side note: While building this feature we found <a href="https://github.com/dotnet/corefx/issues/37614">a small glitch in the CoreFX API</a>: The <code>Process.TotalProcessorTime</code> method reported inaccurate values on macOS. We implemented a fix for this, which we <a href="https://github.com/dotnet/corefx/pull/37637">contributed back to the CoreFX codebase</a>.
</p><h2>Additional improvements based on your feedback</h2><p>The following are a few of the refinements we&apos;ve made based on your feedback.
</p><h3>ASP.NET Core transaction names based on routing information</h3><p>We changed how the agent generates transaction names in the case of ASP.NET Core <a href="https://github.com/elastic/apm-agent-dotnet/issues/166">based on your feedback</a>. The new way of generating transaction names is based on routing information, which is also in-sync with other Elastic APM agents.
</p><p>In the case of ASP.NET Core MVC, the transaction name will contain the name of the Controller class and the name of the action method. Additionally, in case the action method has parameters, those will be shown as a placeholder string.
</p><p>Let&apos;s take an example: We have an MVC controller called <code>User</code> with an action method called <code>Profile</code> that has an integer parameter, which is a user id:
</p><pre class="prettyprint">public class UserController : Controller
{
  public IActionResult Profile(int id)
     //... more code
}
</pre><p>In this case all calls that are routed to the <code>Profile</code> method will be mapped to the same transaction name, which is <code>GET User/Profile {id}</code> &#x2014; regardless of the user id. So every transaction to the same action method will be grouped to the same transaction group.
</p><p><img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blt2fad8c1668442e33/5d1a5f715f304656c2ba82eb/AspNetCoreApmTransactionName.jpg" alt="ASP Net Core APM Transaction Name"></p><p>This works similarly with Razor Pages.
</p><h3>Docker container ID</h3><p>If your .NET Core application runs in a Linux container, the agent also reports the container id, following the <a href="https://github.com/elastic/ecs">Elastic Common Schema</a>. With this feature you can jump from APM data directly to container metrics, logs, and more.
</p><p><img src="https://images.contentstack.io/v3/assets/bltefdd0b53724fa2ce/blt7aadf0d9f7940c74/5d1a5f8ec4753d564581e5a6/ApmDotNetContainerId.jpg" alt="APM Dot Net Container Id"></p><p>This feature is currently Linux only, so we only capture the container id for Linux containers. Of course we plan to have this feature also <a href="https://github.com/elastic/apm-agent-dotnet/issues/272">for Windows containers</a>.
</p><h3>Public Agent API: evolved</h3><p>The API surface of our Public Agent API has grown significantly. We know that there are lots of libraries out there that we don&#x2019;t yet cover with auto instrumentation, but we definitely don&#x2019;t want you to lose visibility because of this.
</p><p>Therefore, with the <a href="/guide/en/apm/agent/dotnet/current/public-api.html">Public Agent API</a> you can trace certain activities in your code.
</p><p>The alpha release already allowed the capturing of spans and transactions, and we now have additional context information that you can attach to your spans and transactions.
</p><p>For example, if you use a database library that we don&#x2019;t support with automatic instrumentation, here is how you send database tracing information manually to Elastic APM with the Public Agent API:
</p><pre class="prettyprint">Agent.Tracer.CurrentTransaction.CaptureSpan(&quot;MyCustomDbWrite&quot;, ApiConstants.TypeDb, (span) =&gt;
{
    span.Context.Db = new Database 
        { Statement = dbStatement, Type = dbType, Instance = dbInstance };
    //..code executing the database operation
});
</pre><p>where the string variables <code>dbStatement</code>, <code>dbType</code>, and <code>dbInstance</code> can hold any string value that you would like to capture for your database statements.
</p><p>You can also manually capture a transaction with incoming HTTP information, in case you&#x2019;d like to trace a web framework that we don&#x2019;t support currently out of the box:
</p><pre class="prettyprint">Agent.Tracer.CaptureTransaction(&quot;MyCustomTransaction&quot;,ApiConstants.TypeRequest, (transaction) =&gt;
{
  transaction.Context.Request = new Request(myRequestMethod, myRequestUri);
  //code executing the request
  transaction.Context.Response =
     new Response { StatusCode = myStatusCode, Finished = wasFinished };
});
</pre><p>If you don&apos;t want to or aren&apos;t able to wrap your code with lambda expressions, you can use the non-lambda pattern of <code>Agent.Tracer.StartTransaction(...)</code> / <code>transaction.StartSpan(...)</code> and <code>transaction.End()</code> / <code>span.End()</code> method pairs.
</p><h2>.NET flavor support, and Elastic APM Server and NuGet packages</h2><p>The supported .NET flavors and versions haven&apos;t changed. What we announced <a href="/blog/elastic-apm-dot-net-agent-preview-released">in the previous blog post</a> under &quot;Supported frameworks&quot; still holds: The agent works on every .NET flavor and version that supports .NET Standard 2.0. This means .NET Core 2.0 and newer and .NET Framework 4.6.1. For ASP.NET Core we have automatic instrumentation, and you can use the Public Agent API on every .NET Standard 2.0 compatible .NET version.
</p><p>The NuGet packages haven&apos;t changed either (except the fact that we added new versions). We still have four packages &#x2014; the <a href="https://www.nuget.org/packages/Elastic.Apm.All">Elastic.Apm.All</a> is the default package that references our three other packages. By adding this to an ASP.NET Core application, you are ready to go. Otherwise you can also reference the library specific packages. The <a href="https://www.nuget.org/packages/Elastic.Apm/">Elastic.Apm</a> package contains the base of the agent with the Public Agent API.
</p><p>The beta agents works with Elastic APM Server version 6.5 and newer. You can keep track of this in the <a href="/guide/en/apm/get-started/current/agent-server-compatibility.html#dotnet-compatibility">agent/server compatibility page</a>.
</p><h2>What&#x2019;s next?</h2><p>Of course our biggest priority for the .NET APM is to reach GA. This will happen based on your feedback &#x2014; if you have any for us please let us know. If you have a general question, just hop on our <a href="https://discuss.elastic.co/c/apm">Discuss forum</a>. If you have more-detailed feedback where you want to also reference source code, or have a more-detailed feature request, feel free to open an issue in our <a href="https://github.com/elastic/apm-agent-dotnet/issues/new/choose">GitHub repository</a>.
</p><p>In addition to making existing features production ready, we&apos;re also working hard on adding auto instrumentation for <a href="https://github.com/elastic/apm-agent-dotnet/issues/83">ASP.NET on top of .NET Framework</a>.
</p><p>And of course we&apos;re continuing work on closing the gap between the .NET agent and other Elastic APMs.
</p><h2>Thank you!</h2><p>And finally, I&apos;d like to take this opportunity to say a huge &quot;thank YOU&quot; to all the amazing community members who are already involved in the development of the .NET agent. Thanks for everyone who tried out the agent, and special thanks for community members who opened issues and also implemented features and actively contributed to the agent:
</p><p>Try out the .NET APM agent beta with your non-production workloads and let us know what you think! You can get started with Elastic APM with a free trial on the <a href="/cloud/">Elasticsearch Service</a>, or by downloading the <a href="/downloads/apm">default distribution</a>.
</p></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>