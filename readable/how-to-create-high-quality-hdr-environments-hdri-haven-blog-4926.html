<!DOCTYPE html>
<html lang="en">
<head>
    <title>
How to Create High Quality HDR Environments &#x2013; HDRI Haven Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="How to Create High Quality HDR Environments &#x2013; HDRI Haven Blog - linksfor.dev(s)"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://blog.hdrihaven.com/how-to-create-high-quality-hdri/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - How to Create High Quality HDR Environments &#x2013; HDRI Haven Blog</title>
<div class="readable">
        <h1>How to Create High Quality HDR Environments &#x2013; HDRI Haven Blog</h1>
            <div>Reading time: 19-24 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="http://blog.hdrihaven.com/how-to-create-high-quality-hdri/">http://blog.hdrihaven.com/how-to-create-high-quality-hdri/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		<p><a href="https://hdrihaven.com/hdri/?h=venice_sunset"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/venice_sunset.jpg" alt="" width="780" height="390" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/venice_sunset.jpg 780w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/venice_sunset-300x150.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/venice_sunset-768x384.jpg 768w" sizes="(max-width: 780px) 100vw, 780px"></a></p>
<p>My goal with this series of articles is to explain everything I‚Äôve learnt about creating HDRIs in order to try and raise the standard of quality of HDRIs shared online.</p>
<p>It‚Äôs not difficult to make an HDRI that‚Äôs good enough for your own use, but if you want to make really good HDRIs that provide accurate and dependable lighting no matter the use case, you need to thoroughly understand every step of the process and how it will affect the outcome.</p>
<p>I‚Äôm only going to cover only the basics here, and then follow up with a number of smaller articles for specific situations in order to avoid going on too many tangents. A list of these articles can be found at the end, though some of the articles will be linked to throughout as well.</p>

<h3>Terminology</h3>
<p>Before we begin, let‚Äôs make sure we understand each other properly. I‚Äôll be throwing around some fancy words that may mean different things in different contexts, so let me clarify what I mean here first:</p>
<ul>
<li><strong>Dynamic range</strong> ‚Äì The measure of variance in brightness that an image has ‚Äì basically the difference between an image‚Äôs brightest and darkest points. A photo of an overcast sky has a low dynamic range, while a photo that includes both the bright sun on a clear day <em>and </em>the entrance to a dark cave has a potentially high dynamic range.<br>
Cameras usually can‚Äôt capture all this high dynamic range in a single shot ‚Äì the sun will be completely over exposed, or the dark cave will have so much noise/grain you won‚Äôt be able to discern any details inside of it. Usually both. So in order to capture the complete dynamic range, we use <em>exposure bracketing</em>.</li>
<li><strong>Exposure bracket</strong> ‚Äì a set of photos from an identical point of view with increasing or decreasing brightness. When merged together, taking the best-exposed parts of each one, they create a single image with a much higher dynamic range. Our monitors can‚Äôt display this higher dynamic range image, they don‚Äôt show anything brighter than ‚Äúwhite‚Äù (RGB=255). Stitching a panorama when we can‚Äôt see all the parts of our images is hard, so to make things easier to see we can do some <em>tonemapping</em>.</li>
<li><strong>Tonemapping</strong> ‚Äì taking a high dynamic range image (which may have areas that appear completely white on your monitor but are actually brighter than white) and adjusting each area of it so that everything appears well exposed ‚Äì darkening the brightest parts and brightening the darkest parts. This has the effect of making it look more natural (our brain does this all the time in real life), and is what most photographers refer to as an <em>HDR photo</em>.<br>
For us, this is <strong>not the desired final result</strong> though, merely a useful tool to make our stitching process easier. Being able to see all parts of a pair of images at once, including bright areas that our monitors otherwise could not display, makes it a lot easier to stitch them together or notice any seams between them, but in the end <strong>we actually want a pure 32-bit high dynamic range image</strong> that has not been tonemapped in order to produce the most realistic lighting and reflections. Those brighter-than-white regions that our monitors can‚Äôt display are actually the most important part as they emit the most light.</li>
</ul>
<p><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/01/tonemapped-1.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/01/tonemapped-1.jpg" alt="" width="780" height="585" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/01/tonemapped-1.jpg 780w, http://blog.hdrihaven.com/wp-content/uploads/2019/01/tonemapped-1-300x225.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/01/tonemapped-1-768x576.jpg 768w" sizes="(max-width: 780px) 100vw, 780px"></a></p>
<p>With that out the way, we can actually start making an HDRI!</p>
<h3>Step 1: Shooting</h3>
<p>The process of shooting an HDRI is quite simple in theory, but a number of technological limitations and avenues for human error make it a bit tricky the first few times.</p>
<p>While it‚Äôs perfectly possible to create an HDRI with almost any camera (including the one in your phone), in order to get a good result that is unclipped, without major lens artifacts, seams or color issues, and in any situation‚Ä¶ you‚Äôll need some fairly specific camera gear:</p>
<ul>
<li>A camera that can shoot in raw and has full manual control.</li>
<li>It also needs to be able to shoot a minimum of 7 exposure brackets spaced by 2 EVs. Most cameras can only shoot 3 brackets with 2 EV spacing, or 5 brackets with 1 EV spacing. This is not enough.</li>
<li>A lens of approximately 15mm full-frame equivalent (10mm for APS-C). Other focal lengths can certainly be used, but may introduce some issues or simply be sub-optimal for the pano resolution/shooting speed balance.</li>
<li>A lens that can accept ND filters ‚Äì some light sources, like the sun, are brighter than your camera can capture without clipping, even using the darkest exposure settings. An ND filter allows you to capture a much darker image using the same settings. More info about this in the article about <a href="http://blog.hdrihaven.com/how-to-shoot-the-sun">shooting the sun</a>.</li>
<li>A panoramic tripod head to avoid stitching seams caused by parallax.</li>
</ul>
<p>Rather than cover everything here, <a href="http://blog.hdrihaven.com/camera-gear-for-hdris">this other article</a> goes into detail about the various gear requirements and the implications of not meeting them.</p>
<p>In essence, you need to shoot multiple angles to capture the full 360¬∫ view of your environment, with each angle being a sequence of exposure brackets to capture the full range of brightness present (dynamic range).</p>
<p>Each angle needs to overlap with the previous one by at least 30%, so that the stitching software (and you) can use the common areas to match the images together.</p>
<p>With my 10mm lens on my crop-sensor Canon 600D, I end up shooting 27 angles in total ‚Äì 9 horizontally, 9 more looking 45¬∫ up, and 9 looking 45¬∫ down:</p>

<p>For each of these angles I typically shoot between 4 and 7 images in the exposure bracket sequence depending on the dynamic range required, so that‚Äôs 108-189 photos in total.</p>
<p>As mentioned, although it‚Äôs fairly simple in theory there are a few things you need to keep in mind and watch out for:</p>
<ul>
<li>You need to be in full <strong>Manual mode</strong> to ensure that the aperture, series of shutter speeds, focal distance, white balance, etc‚Ä¶ are the same for all brackets. Any variation in these can make stitching harder or end up with a strange result.</li>
<li>Always <strong>shoot in RAW</strong> ‚Äì this is absolutely vital, we need the original sensor data to process ourselves later. If you shoot in JPG, the camera will do all sorts of nasty color adjustments that screw up the accuracy of colors and light intensities.</li>
<li>Make sure your darkest exposure is dark enough to <a href="http://blog.hdrihaven.com/how-to-shoot-the-sun">properly capture the brightest light source</a>. If it‚Äôs not, the lighting that the final HDRI produces in a 3D scene will be incorrect.</li>
<li>The brightest exposure shouldn‚Äôt be too noisy, or require too long of a shutter speed, otherwise shooting the whole panorama may take so long that the lighting has changed significantly by the time you are finished (e.g. during a sunset).</li>
<li>If you have a zoom lens, make sure the focal length is correct, normally at its widest. This is easier to screw up than it sounds. Trust me :'(</li>
<li>Make sure you‚Äôre actually in focus, especially after changing ND filters where you might accidentally twist the lens.</li>
<li>Be sure to capture the full 360¬∫ view, including the very top and bottom of the pano. No one wants a hole in their sky. If you‚Äôre not sure if you captured a particular angle (the human brain tends malfunction when doing the same series of tasks over and over), just shoot it again, there‚Äôs no harm in shooting it twice.</li>
</ul>
<p>Once you‚Äôve shot your panorama, the real work begins‚Ä¶</p>
<h3>Step 2: Processing</h3>
<p>Cameras and lenses aren‚Äôt perfect, and the images they output are not necessarily accurate representations of the real world.</p>
<p>The whole purpose of an HDRI is to provide realistic lighting and reflections for a 3D scene. To do this, we can‚Äôt just take the default output of the camera as a true representation of reality, it‚Äôs not. The software and settings you use to process the images makes a huge difference in color accuracy as well.</p>
<p>Why don‚Äôt we just import the RAW images straight into the stitching software?</p>
<p>There are a few reasons:</p>
<ul>
<li>Most stitching software assumes you want a pretty tonemapped output, so their HDR merging algorithms are not necessarily tuned to output accurate results, but rather ‚Äúpleasing‚Äù results. This can be especially problematic with very bright light sources as some of the images will be almost entirely black except for a few pixels, which can confuse the merging algorithm.</li>
<li>Stitching with typically over 100 huge RAW images is very taxing on your system, which makes the whole process quite slow. Processing and merging the images ourselves first instead makes stitching much quicker.</li>
<li>We want to do some minor cleanup to the images first, such as removing chromatic aberration and noise.</li>
</ul>
<p>While there are many, many programs out there to process RAW images into more common formats, not all of them are a good choice for what we want.</p>
<figure id="attachment_317"><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/compare.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/compare_s.jpg" alt="" width="780" height="578" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/compare_s.jpg 780w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/compare_s-300x222.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/compare_s-768x569.jpg 768w" sizes="(max-width: 780px) 100vw, 780px"></a><figcaption>Incorrect contrasty output from Lightroom vs. accurate output from RawTherapee.<br>Both images exported with no adjustments and standard color profile.</figcaption></figure>
<p>For example, the most popular choice, Adobe Lightroom, actually does some mysterious RGB curve adjustments to the images even when outputting to 16-bit TIFFs. This is meant to make the images look pretty, but for our purposes makes it impossible to <em>correctly</em> merge the exposure brackets together into a single HDR image in the next step.<br>
This mysterious curve/contrast adjustment makes the brightness relationship between the exposure brackets nonlinear, which will introduce banding where the images are blended together and ultimately produce an unrealistic result, where colors are more saturated than they should be and light sources are either darker or brighter than in real life. I haven‚Äôt been able to figure out how to disable this and get a proper linear output from Lightroom.</p>
<p>I can‚Äôt say I‚Äôve tried all the software in the world, but my current choice is <a href="https://rawtherapee.com/downloads">RawTherapee</a>.</p>
<p>It‚Äôs free and open source, has a huge amount of deep technical control over the images while still being user-friendly with good defaults. It can output true linear 16- or 32-bit images without screwing with the color like Lightroom, and even allows you to calibrate your camera with a color chart if you want to go that far (though the built-in color profiles are already quite good).</p>
<p><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/Gregs-HDRI-profile-for-RawTherapee.zip">Here is the profile/preset I use for processing HDRIs</a>.</p>
<p>It may not be 100% suitable for your camera though, so let me briefly explain what my profile does and doesn‚Äôt do in case you need to make your own:</p>
<ul>
<li>Disables all brightness and color adjustments in the exposure tab</li>
<li>Enables <em>Highlight Reconstruction</em> ‚Äì this should not be necessary and may even be a bad idea, but it can help avoid strange color artifacts in saturated over-exposed areas.</li>
<li>Minor color noise reduction. No luminance noise reduction. No sharpening.</li>
<li>Sets white balance to 5400k ‚Äì the standard I use on all outdoor day-time HDRIs.</li>
<li>Automatic lens corrections for chromatic aberration only. No distortion correction as the stitching software will calibrate itself for distortion correction anyway.</li>
<li>Hot pixel and dead pixel filtering</li>
</ul>
<p>If you do use my profile linked above, be sure to check the <a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_14-48-40_rawtherapee.png" target="_blank" rel="noopener">Profiled Lens Correction</a> settings and select your own camera and lens instead of mine, and save the profile again for yourself. If there is no built-in profile for your lens, then <a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_14-51-55_rawtherapee.png" target="_blank" rel="noopener">enable automatic chromatic aberration correction</a> instead.</p>
<p>To apply a profile to all your images, simply select them all, right click one of them and choose: <em>Processing profile operations &gt; Apply &gt; My profiles &gt; [the name of the profile]</em>.</p>
<p><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee.png"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee.png" alt="" width="1103" height="444" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee.png 1103w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee-300x121.png 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee-768x309.png 768w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-20_13-58-38_rawtherapee-780x314.png 780w" sizes="(max-width: 1103px) 100vw, 1103px"></a></p>
<p>At this point, RawTherapee may crash for you <img draggable="false" alt="üôÇ" src="https://s.w.org/images/core/emoji/11/svg/1f642.svg"> but once you restart it you‚Äôll see the profile was indeed applied to all the images successfully.</p>
<p>If you want to make some more changes, such as to white balance, you can double click one of the images, adjust whatever you like, and then click the <em>Copy</em> button at the top right. Then to apply what you copied to all the other images, select them, right click and do <em>Processing profile operations &gt; Paste.</em></p>
<p>When you‚Äôre ready to export them, select them all, right click and select <em>Put to Queue</em>. The images will now be added to the queue tab on the far left of the screen. There you can select the output format, which should be 16-bit TIFF.</p>
<p>Make sure you‚Äôre using the latest version of RawTherapee ‚Äì older versions did not include the original metadata (shutter speed info, etc) in the TIFF files which is necessary in the next step.</p>
<h3>Step 3: Merging</h3>
<p>Once you‚Äôve exported your 16-bit TIFFs from RawTherapee, we need to combine each exposure bracket sequence into a single 32-bit HDR file.</p>
<p>Here‚Äôs how HDR merging works:</p>

<p>Again, there is a lot of software to choose from when it comes to creating HDR content, however most of it is, again, catered towards normal photographers who want an 8-bit tonemapped output.</p>
<p>However what we want is a linear 32-bit output (preferably an EXR file) that was merged linearly using the exposure metadata alone.</p>
<p>A lot of software will use the metadata only as a guideline and instead look at the relative brightness between the images themselves. This causes huge problems when the majority of both images is completely black except for one very small area (the most important part for us), like when shooting the sun or any small bright light source.</p>
<figure id="attachment_214"><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/01/sun_bracket_big.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/01/sun_bracket.png" alt="" width="780" height="451" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/01/sun_bracket.png 780w, http://blog.hdrihaven.com/wp-content/uploads/2019/01/sun_bracket-300x173.png 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/01/sun_bracket-768x444.png 768w" sizes="(max-width: 780px) 100vw, 780px"></a><figcaption>The sun is tiny compared to the rest of the image.</figcaption></figure>
<p>Since several of the images are entirely black except for the tiny sun, some merging software assumes they must have very similar exposures, even though the metadata states that they are orders of magnitude apart.</p>
<p>I‚Äôve tried a lot of software and have run into various issues with each, so in the end I created my own solution that I knew would be accurate and dependable.</p>
<p>This may not have been completely necessary, but it gave me full control over the most important part of the process, as well as a greater understanding of exactly what it is we‚Äôre trying to do.</p>
<p><a href="https://github.com/gregzaal/HDR-Merge">You can download my little merging tool here</a>. Be sure to read the instructions as it requires some other software to be installed, and for your exposure brackets to be in a particular order.</p>
<p><a href="https://github.com/gregzaal/HDR-Merge"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/screenshot.png" alt="" width="452" height="118" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/screenshot.png 452w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/screenshot-300x78.png 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/screenshot-450x118.png 450w" sizes="(max-width: 452px) 100vw, 452px"></a></p>
<p>Using it is pretty self-explanatory. You choose the folder that contains the TIFF files that you exported from RawTherapee and hit the <em>Create HDRs</em> button.</p>
<p>A progress bar will be shown at the bottom of the window. Once completed, you‚Äôll see a <em>Merged</em> folder next to your TIFF files. This folder contains both an <em>exr</em> and a <em>jpg</em> folder.</p>
<p>The <em>exr</em> folder contains the sequence of 32-bit images merged from your exposure bracket, while the <em>jpg</em> folder contains 8-bit tonemapped versions of the EXR files to make stitching easier and quicker.</p>
<p>I recommend quickly going through all the JPG files to make sure everything looks correct. If the JPGs look correct then the EXRs are likely fine too, though if you feel like being extra thorough you can open the EXRs in Photoshop/Gimp/Affinity/Krita and play with the exposure to check that the full dynamic range is included and there aren‚Äôt any serious ghosting issues.</p>
<p>If you have any trouble using this tool, please <a href="https://hdrihaven.com/p/about-contact.php">shoot me an email</a> so I can help you out or improve it.</p>
<h3>Step 4: Stitching</h3>
<p>Finally we can start stitching the panorama.</p>
<p>Once again there are <a href="https://en.wikipedia.org/wiki/Comparison_of_photo_stitching_software#HDR,_tonemapping_and_exposure_fusion">some choices of software</a> available, but I have only used <a href="https://www.ptgui.com/">PTGui</a> myself so that‚Äôs what I‚Äôll cover here. Purchase of PTGui Pro is required to output HDR panoramas, as well as some vital features like masking and viewpoint correction. This costs $240 once-off at the time of writing.</p>
<p>I have tried and retried using the free and open source <a href="http://hugin.sourceforge.net/">Hugin</a> many times, but it seems to have a number of major problems. I have not been able to get any usable result from it in any reasonable amount of time. If you have actually managed to create a high quality unclipped HDRI with it, please let me know how in the comments of this post.</p>
<p>So without further ado, let‚Äôs stitch the panorama‚Ä¶</p>
<h4>4.1. Load the images</h4>
<p>Load all the JPG images into PTGui and save the project.</p>
<p>It may ask you what the camera‚Äôs sensor size is (1.0 for full frame or 1.5/1.6 for crop/APS-C), and what the focal length of your lens was.</p>
<h4>4.2. Masking</h4>
<p>Before doing any stitching, you need to mask out anything that may confuse the algorithm, such as the tripod at the bottom of the pano, any moving people, shadows, lens flares, etc.</p>
<p>If you don‚Äôt do this first, PTGui may add control points on features that moved around between images, which will create large seams in the final pano.</p>
<p><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge.jpg" alt="" width="1170" height="893" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge.jpg 1170w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge-300x229.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge-768x586.jpg 768w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_1_merge-780x595.jpg 780w" sizes="(max-width: 1170px) 100vw, 1170px"></a></p>
<h4>4.3. Align</h4>
<p>Now go back to the <em>Project Assistant</em> tab and hit the <em>Align images</em> button.</p>
<p>After a moment or two, you should have something resembling a panorama displayed in the <em>Panorama Editor</em> window.</p>
<p><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_2_pano.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_2_pano.jpg" alt="" width="780" height="543" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_2_pano.jpg 780w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_2_pano-300x209.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_2_pano-768x535.jpg 768w" sizes="(max-width: 780px) 100vw, 780px"></a></p>
<p>If PTGui has any trouble finding control points automatically, it will ask you to add some manually. Make sure you have at least 4 pairs of control points between each pair of neighboring images (i.e. 4 control point pairs between image 1 and image 2, 4 pairs between image 2 and 3‚Ä¶).</p>
<h4>4.4. Optimize</h4>
<p>Some parts of your images may look very similar or have indistinct features, such as multiple windows of a building that look the same, the edges of a wall, or clouds that move slightly between shots.</p>
<p>PTGui can get a bit confused with these, so many of your control points will be quite badly aligned.</p>
<p>To fix this, there are a few steps to take and repeat until you have fixed all the problems:</p>
<ol>
<li>Look at the control point table and sort it by distance.</li>
<li>Delete about 20 control points that have a very large distance detected (these are wrongly detected matches).</li>
<li>Run the optimizer (F5).</li>
</ol>
<p>Repeat these steps until all control points in the table have a distance <strong>lower than 3.0</strong> and the result of the optimization is <em>Very good</em>.</p>
<figure id="attachment_327"><a href="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1.jpg"><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1.jpg" alt="" width="1170" height="656" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1.jpg 1170w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1-300x168.jpg 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1-768x431.jpg 768w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/stitch_3_cp-1-780x437.jpg 780w" sizes="(max-width: 1170px) 100vw, 1170px"></a><figcaption>All control points under 3.0 distance. Way more control points than necessary but why not <img draggable="false" alt="üôÇ" src="https://s.w.org/images/core/emoji/11/svg/1f642.svg"></figcaption></figure>
<p>If you start running low on control points, you can generate more from the <em>Control Points</em> menu in between repetitions.</p>
<p>You can also use the <em>Delete worse control points</em> button in the <em>Control points</em> menu, though this will not always delete bad control points if that images pair only has a few left.</p>
<h4>4.5. Leveling</h4>
<p>The pano may look a bit wobbly now, but this is easily fixed by using <em>vertical line</em> control points.</p>
<p>In the control point editor, select the same image on both sides and add a pair of control points at the top and bottom of some vertical line (e.g. the edges of a room, a building, etc).</p>
<p>Do this for at least 3 or 4 points around all sides of the pano.</p>
<p>If no vertical lines are possible (e.g. in a nature environment), you can try create horizontal lines on the horizon instead, or simply drag the pano around in the editor to level it manually. With no vertical objects in the pano, it‚Äôs hard for anyone to tell if it‚Äôs unlevel anyway.</p>
<p>You can view the panorama better by using the <em>Preview</em> tab on the left with an appropriate resolution.</p>
<h4>4.6. Swap JPGs to EXRs</h4>
<p>This step is only necessary if you used my HDR-Merge tool.</p>
<p>The panorama is basically finished, but we‚Äôve still been using the tonemapped JPGs until now. It‚Äôs time to swap out these JPGs for the 32-bit EXRs instead and then output the actual final HDRI.</p>
<p>I‚Äôll be using a python script for this, but you could also just use the <a href="http://www.ptgui.com/ptguihelp/templates.htm">Templates</a> system inside PTGui ‚Äì the downside of the templates system is that control points are not transferred so you won‚Äôt be able to make any further alignment tweaks. My script simply swaps the file paths of the JPGs with those of the EXRs, so it‚Äôs better to use it if you can.</p>
<p>Firstly, if you don‚Äôt already have it you‚Äôll need to <a href="https://www.python.org/downloads/release/python-354/">install Python 3</a> and make sure Windows knows to open .py files with Python.</p>
<p>Save your project and close PTGui, then <a href="https://raw.githubusercontent.com/gregzaal/HDR-Merge/master/ptgui_jpg_to_hdr.py">download this python script</a> (right click &gt; Save As) and just drag your <em>.pts</em> project file onto the script.</p>
<p>It will create a backup of the project (<em>‚Äú\*__t.pts‚Äù</em>) and then replace all the JPG file paths with matching EXR ones.</p>
<p>Now you can open up your project in PTGui again (this will be done automatically if PTGui is installed in the default location) and you should see the EXR files loading in instead of the JPGs.</p>

<p>If you don‚Äôt use the script above, also be sure to enable True HDR mode to be able to output to HDR formats (my script does this automatically):</p>
<p><img src="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_15-22-41_PTGui.png" alt="" width="791" height="517" srcset="http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_15-22-41_PTGui.png 791w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_15-22-41_PTGui-300x196.png 300w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_15-22-41_PTGui-768x502.png 768w, http://blog.hdrihaven.com/wp-content/uploads/2019/02/2019-02-22_15-22-41_PTGui-780x510.png 780w" sizes="(max-width: 791px) 100vw, 791px"></p>
<h4>4.7. Export the HDRI</h4>
<p>Finally, double check all the output settings are correct (100% optimal resolution, HDR only, no LDR) and hit that <em>Create Panorama</em> button <img draggable="false" alt="üôÇ" src="https://s.w.org/images/core/emoji/11/svg/1f642.svg"></p>
<p>Congratulations, you‚Äôve created an HDRI!</p>
<p>You can view this HDRI in a few different ways, my favorite being with <a href="https://www.lizardq.com/en/viewer/">LizardQ Viewer</a>, or just Photoshop/Gimp/Affinity/Krita/Blender.</p>
<h3>The Next Steps</h3>
<p>You now know everything you need to create a basic HDRI, but if you really want to create a <em>quality</em> HDRI that could be published on HDRI Haven, there is still more to learn.</p>
<ol>
<li>Removing the tripod from the bottom of the HDRI (<em>coming soon</em>)</li>
<li><a href="http://blog.hdrihaven.com/how-to-shoot-the-sun">Avoiding clipping; capturing the full brightness of the sun</a></li>
<li>Dealing with motion: crowds and clouds (<em>coming soon</em>)</li>
<li><a href="http://blog.hdrihaven.com/camera-gear-for-hdris">What camera gear to use</a></li>
<li>HDR vs EXR: Why the inferior format is better (<em>coming soon</em>)</li>
</ol>
			</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>