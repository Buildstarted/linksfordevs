<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Opting in to runtime compilation for .NET 3 -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Opting in to runtime compilation for .NET 3</h1><div><div class="dbc-post-content"><p>I upgraded <a href="https://github.com/poppastring/dasblog-core" target="_blank" rel="noopener">DasBlog Core code base</a> to .NET 3 several weeks ago, however, every time I would attempt a deploy to App Services it failed catastrophically with a series of HTTP 500 errors. The thing that I was not prepared for was that my self contained app contained a bunch of .NET 2.X references that would not explicitly get cleaned up during the default installation process of my new app version.</p><p>Here was the error:</p><blockquote><p>2019-11-09 02:05:23.272 +00:00 [Critical] Microsoft.AspNetCore.Hosting.Diagnostics: Hosting startup assembly exception<br>System.InvalidOperationException: Startup assembly Microsoft.AspNetCore.AzureAppServices.HostingStartup failed to execute. See the inner exception for more details.</p></blockquote><p>I admit it was a little disappointing to not really get any useful data from the diagnose blades in App Services, however, the number of ways this kind of partially incorrect upgrade could go wrong means that any kind of analysis would be difficult to codify. I finally followed the suggestions of my colleagues in the ASP.NET Core team and elected to delete the entire installation folder, except my <a href="https://github.com/poppastring/dasblog-core/wiki">content and themes</a> of course, and then found that I was greeted by a 500 error of a different ilk, as follows:</p><blockquote><p>2019-11-09 02:05:28.250 +00:00 [Error] Microsoft.AspNetCore.Mvc.ViewFeatures.ViewResultExecutor: The view '_BlogPage' was not found. Searched locations: /Themes/poppastring/_BlogPage.cshtml, /Views/BlogPost/_BlogPage.cshtml, <br>/Views/Shared/_BlogPage.cshtml, /Pages/Shared/_BlogPage.cshtml<br>2019-11-09 02:05:28.259 +00:00 [Information] Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker: Executed action DasBlog.Web.Controllers.BlogPostController.Post (DasBlog.Web) in 262.6212ms</p></blockquote><p>According to this error the themes folder (which contains my _BlogPage.cshtml Razor view) could not be found, I was well aware that I needed to keep it around. So why was is it that a file on disk could not be found by my app?</p><p>In ASP.NET Core 3.0 runtime compilation of views is an opt-in scenario! This is the exact opposite of prior versions .NET Core, and <a href="../creating-web-themes-with-razor-pages" target="_blank" rel="noopener">DasBlog relied on the runtime compilation of cshtml view files</a> in order allow you to edit or add themes on demand. As soon as I upgraded my project it precompiled all views in to an assembly (DasBlog.Web.Views.dll).</p><p>In order to turn on runtime compilation in your ASP.NET Core 3 project you add the following Nuget package:</p><p>We can then tell the app to use it by enabling Razor runtime compilation as follows:</p><pre class="brush: csharp;">services.AddControllersWithViews().AddRazorRuntimeCompilation();</pre></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>