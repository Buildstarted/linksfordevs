<!DOCTYPE html>
<html lang="en">
<head>
    <title>linksfor.dev(s)</title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <div class="readable">
        <h1>Trace Context</h1>
        <p>
by Sergey Kanzhelev&#xA;            (Microsoft) <br/>Reading time: 23-29 minutes        </p>
        <p><a href="https://www.w3.org/TR/trace-context/">https://www.w3.org/TR/trace-context/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><p id="toc-nav"><a id="toc-jump" href="#toc"> <span>Jump to Table of Contents</span></a><a id="toc-toggle" href="#toc"> <span>Collapse Sidebar</span></a></p><section id="abstract"><h2>Abstract</h2><p>This specification defines standard HTTP headers and a value format to propagate context information that enables distributed tracing scenarios. The specification standardizes how context information is sent and modified between services. Context information uniquely identifies individual requests in a distributed system and also defines a means to add and propagate provider-specific context information.</p></section><section id="sotd"><h2>Status of This Document</h2><p><em>This section describes the status of this document at the time of its publication. Other documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision of this technical report can be found in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at https://www.w3.org/TR/.</em></p>

      <p>
      This document was published by the <a href="https://www.w3.org/2018/distributed-tracing/">Distributed Tracing Working Group</a> as a
      Recommendation.

    </p><p>
      <a href="https://github.com/w3c/trace-context/issues/">GitHub Issues</a> are preferred for
            discussion of this specification.

      Alternatively, you can send comments to our mailing list.
            Please send them to
            <a href="mailto:public-trace-context@w3.org?subject=trace-context">public-trace-context@w3.org</a>
            (<a href="https://lists.w3.org/Archives/Public/public-trace-context/">archives</a>)
                  with <code>trace-context</code> at the start of your
                  email's subject
                .

    </p><p>
      Please see the Working Group's
      <a href="https://github.com/w3c/trace-context/blob/master/implementations.md">implementation report</a>.
    </p>
    <p>This document has been reviewed by W3C Members, by software developers, and by other W3C groups and interested parties, and is endorsed by the Director as a W3C Recommendation. It is a stable document and may be used as reference material or cited from another document. W3C's role in making the Recommendation is to draw attention to the specification and to promote its widespread deployment. This enhances the functionality and interoperability of the Web.</p>
    <p>

        This document was produced by a group
        operating under the
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.


                  <abbr title="World Wide Web Consortium">W3C</abbr> maintains a
                  <a rel="disclosure" href="https://www.w3.org/2004/01/pp-impl/108594/status">public list of any patent disclosures</a>
            made in connection with the deliverables of
            the group; that page also includes
            instructions for disclosing a patent. An individual who has actual
            knowledge of a patent which the individual believes contains
            <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a>
            must disclose the information in accordance with
            <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.


    </p><p>
                  This document is governed by the
                  <a id="w3c_process_revision" href="https://www.w3.org/2019/Process-20190301/">1 March 2019 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                </p></section><nav id="toc"><h2 id="table-of-contents">Table of Contents</h2><ol><li><a href="#conformance"><bdi>1. </bdi>Conformance</a></li><li><a href="#overview"><bdi>2. </bdi>Overview</a><ol><li><a href="#problem-statement"><bdi>2.1 </bdi>Problem Statement</a></li><li><a href="#solution"><bdi>2.2 </bdi>Solution</a></li><li><a href="#design-overview"><bdi>2.3 </bdi>Design Overview</a></li></ol></li><li><a href="#trace-context-http-headers-format"><bdi>3. </bdi>Trace Context HTTP Headers Format</a><ol><li><a href="#relationship-between-the-headers"><bdi>3.1 </bdi>Relationship Between the Headers</a></li><li><a href="#traceparent-header"><bdi>3.2 </bdi>Traceparent Header</a><ol><li><a href="#header-name"><bdi>3.2.1 </bdi>Header Name</a></li><li><a href="#traceparent-header-field-values"><bdi>3.2.2 </bdi>traceparent Header Field Values</a><ol><li><a href="#version"><bdi>3.2.2.1 </bdi>version</a></li><li><a href="#version-format"><bdi>3.2.2.2 </bdi>version-format</a></li><li><a href="#trace-id"><bdi>3.2.2.3 </bdi>trace-id</a></li><li><a href="#parent-id"><bdi>3.2.2.4 </bdi>parent-id</a></li><li><a href="#trace-flags"><bdi>3.2.2.5 </bdi>trace-flags</a><ol><li><a href="#sampled-flag"><bdi>3.2.2.5.1 </bdi>Sampled flag</a></li><li><a href="#other-flags"><bdi>3.2.2.5.2 </bdi>Other Flags</a></li></ol></li></ol></li><li><a href="#examples-of-http-traceparent-headers"><bdi>3.2.3 </bdi>Examples of HTTP traceparent Headers</a></li><li><a href="#versioning-of-traceparent"><bdi>3.2.4 </bdi>Versioning of traceparent</a></li></ol></li><li><a href="#tracestate-header"><bdi>3.3 </bdi>Tracestate Header</a><ol><li><a href="#header-name-0"><bdi>3.3.1 </bdi>Header Name</a><ol><li><a href="#tracestate-header-field-values"><bdi>3.3.1.1 </bdi>tracestate Header Field Values</a></li><li><a href="#list"><bdi>3.3.1.2 </bdi>list</a></li><li><a href="#list-members"><bdi>3.3.1.3 </bdi>list-members</a><ol><li><a href="#key"><bdi>3.3.1.3.1 </bdi>Key</a></li><li><a href="#value"><bdi>3.3.1.3.2 </bdi>Value</a></li></ol></li><li><a href="#combined-header-value"><bdi>3.3.1.4 </bdi>Combined Header Value</a></li><li><a href="#tracestate-limits"><bdi>3.3.1.5 </bdi>tracestate Limits:</a></li></ol></li><li><a href="#examples-of-tracestate-http-headers"><bdi>3.3.2 </bdi>Examples of tracestate HTTP Headers</a></li><li><a href="#versioning-of-tracestate"><bdi>3.3.3 </bdi>Versioning of tracestate</a></li></ol></li><li><a href="#mutating-the-traceparent-field"><bdi>3.4 </bdi>Mutating the traceparent Field</a></li><li><a href="#mutating-the-tracestate-field"><bdi>3.5 </bdi>Mutating the tracestate Field</a></li></ol></li><li><a href="#processing-model"><bdi>4. </bdi>Processing Model</a><ol><li><a href="#processing-model-for-working-with-trace-context"><bdi>4.1 </bdi>Processing Model for Working with Trace Context</a></li><li><a href="#no-traceparent-received"><bdi>4.2 </bdi>No traceparent Received</a></li><li><a href="#a-traceparent-is-received"><bdi>4.3 </bdi>A traceparent is Received</a></li><li><a href="#alternative-processing"><bdi>4.4 </bdi>Alternative Processing</a></li></ol></li><li><a href="#other-communication-protocols"><bdi>5. </bdi>Other Communication Protocols</a></li><li><a href="#privacy-considerations"><bdi>6. </bdi>Privacy Considerations</a><ol><li><a href="#privacy-of-traceparent-field"><bdi>6.1 </bdi>Privacy of traceparent field</a></li><li><a href="#privacy-of-tracestate-field"><bdi>6.2 </bdi>Privacy of tracestate field</a></li><li><a href="#other-risks"><bdi>6.3 </bdi>Other risks</a></li></ol></li><li><a href="#security-considerations"><bdi>7. </bdi>Security Considerations</a><ol><li><a href="#information-exposure"><bdi>7.1 </bdi>Information Exposure</a></li><li><a href="#denial-of-service"><bdi>7.2 </bdi>Denial of Service</a></li><li><a href="#other-risks-0"><bdi>7.3 </bdi>Other Risks</a></li></ol></li><li><a href="#considerations-for-trace-id-field-generation"><bdi>8. </bdi>Considerations for trace-id field generation</a><ol><li><a href="#uniqueness-of-trace-id"><bdi>8.1 </bdi>Uniqueness of <code>trace-id</code></a></li><li><a href="#randomness-of-trace-id"><bdi>8.2 </bdi>Randomness of <code>trace-id</code></a></li><li><a href="#handling-trace-id-for-compliant-platforms-with-shorter-internal-identifiers"><bdi>8.3 </bdi>Handling <code>trace-id</code> for compliant platforms with shorter internal identifiers</a></li><li><a href="#interoperating-with-existing-systems-which-use-shorter-identifiers"><bdi>8.4 </bdi>Interoperating with existing systems which use shorter identifiers</a></li></ol></li><li><a href="#acknowledgments"><bdi>A. </bdi>Acknowledgments</a></li><li><a href="#glossary"><bdi>B. </bdi>Glossary</a></li><li><a href="#references"><bdi>C. </bdi>References</a><ol><li><a href="#normative-references"><bdi>C.1 </bdi>Normative references</a></li></ol></li></ol></nav><section id="conformance"><h2 id="x1-conformance"><bdi>1. </bdi>Conformance<a aria-label="Â§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em>MAY</em>, <em>MUST</em>, <em>MUST NOT</em>, <em>SHOULD</em>, and <em>SHOULD NOT</em> in this document
            are to be interpreted as described in
            <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>
            [<cite><a data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>]
            [<cite><a data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>] when, and only when, they appear
            in all capitals, as shown here.
          </p></section><section id="overview"><h2 id="x2-overview"><bdi>2. </bdi>Overview<a aria-label="Â§" href="#overview"></a></h2><section id="problem-statement"><h3 id="x2-1-problem-statement"><bdi>2.1 </bdi>Problem Statement<a aria-label="Â§" href="#problem-statement"></a></h3><p>Distributed tracing is a methodology implemented by tracing tools to follow, analyze and debug a transaction across multiple software components. Typically, a <a href="#dfn-distributed-traces" data-link-type="dfn">distributed trace</a> traverses more than one component which requires it to be uniquely identifiable across all participating systems. Trace context propagation passes along this unique identification. Today, trace context propagation is implemented individually by each tracing vendor. In multi-vendor environments, this causes interoperability problems, like:</p><ul>
<li>Traces that are collected by different tracing vendors cannot be correlated as there is no shared unique identifier.</li>
<li>Traces that cross boundaries between different tracing vendors can not be propagated as there is no uniformly agreed set of identification that is forwarded.</li>
<li>Vendor specific metadata might be dropped by intermediaries.</li>
<li>Cloud platform vendors, intermediaries and service providers, cannot guarantee to support trace context propagation as there is no standard to follow.</li>
</ul><p>In the past, these problems did not have a significant impact as most applications were monitored by a single tracing vendor and stayed within the boundaries of a single platform provider. Today, an increasing number of applications are highly distributed and leverage multiple middleware services and cloud platforms.</p><p>This transformation of modern applications calls for a distributed tracing context propagation standard.</p></section><section id="solution"><h3 id="x2-2-solution"><bdi>2.2 </bdi>Solution<a aria-label="Â§" href="#solution"></a></h3><p>The trace context specification defines a universally agreed-upon format for the exchange of trace context propagation data - referred to as <em>trace context</em>. Trace context solves the problems described above by</p><ul>
<li>providing an unique identifier for individual traces and requests, allowing trace data of multiple providers to be linked together.</li>
<li>providing an agreed-upon mechanism to forward vendor-specific trace data and avoid broken traces when multiple tracing tools participate in a single transaction.</li>
<li>providing an industry standard that intermediaries, platforms, and hardware providers can support.</li>
</ul><p>A unified approach for propagating trace data improves visibility into the behavior of distributed applications, facilitating problem and performance analysis. The interoperability provided by trace context is a prerequisite to manage modern micro-service based applications.</p></section><section id="design-overview"><h3 id="x2-3-design-overview"><bdi>2.3 </bdi>Design Overview<a aria-label="Â§" href="#design-overview"></a></h3><p>Trace context is split into two individual propagation fields supporting interoperability and vendor-specific extensibility:</p><ul>
<li><code>traceparent</code> describes the position of the incoming request in its trace graph in a portable, fixed-length format. Its design focuses on fast parsing. Every tracing tool <em title="MUST">MUST</em> properly set <code>traceparent</code> even when it only relies on vendor-specific information in <code>tracestate</code></li>
<li><code>tracestate</code> extends <code>traceparent</code> with vendor-specific data represented by a set of name/value pairs. Storing information in <code>tracestate</code> is optional.</li>
</ul><p>Tracing tools can provide two levels of compliant behavior interacting with trace context:</p><ul>
<li>At a minimum they <em title="MUST">MUST</em> propagate the <code>traceparent</code> and <code>tracestate</code> headers and guarantee traces are not broken. This behavior is also referred to as forwarding a trace.</li>
<li>In addition they CAN also choose to participate in a trace by modifying the <code>traceparent</code> header and relevant parts of the <code>tracestate</code> header containing their proprietary information. This is also referred to as participating in a trace.</li>
</ul><p>A tracing tool can choose to change this behavior for each individual request to a component it is monitoring.</p></section></section><section id="processing-model"><h2 id="x4-processing-model"><bdi>4. </bdi>Processing Model<a aria-label="Â§" href="#processing-model"></a></h2><p><em>This section is non-normative.</em></p><p>This section provides a step-by-step example of a tracing vendor receiving a request with trace context headers, processing the request and then potentially forwarding it. This description can be used as a reference when implementing a trace context-compliant tracing system, middleware (like a proxy or messaging bus), or a cloud service.</p><section id="processing-model-for-working-with-trace-context"><h3 id="x4-1-processing-model-for-working-with-trace-context"><bdi>4.1 </bdi>Processing Model for Working with Trace Context<a aria-label="Â§" href="#processing-model-for-working-with-trace-context"></a></h3><p>This processing model describes the behavior of a vendor that modifies and forwards trace context headers. How the model works depends on whether or not a <code>traceparent</code> header is received.</p></section><section id="no-traceparent-received"><h3 id="x4-2-no-traceparent-received"><bdi>4.2 </bdi>No traceparent Received<a aria-label="Â§" href="#no-traceparent-received"></a></h3><p>If no traceparent header is received:</p><ol>
<li>The vendor checks an incoming request for a <code>traceparent</code> and a <code>tracestate</code> header.</li>
<li>Because the <code>traceparent</code> header is not received, the vendor creates a new <code>trace-id</code> and <code>parent-id</code> that represents the current request.</li>
<li>If a <code>tracestate</code> header is received without an accompanying <code>traceparent</code> header, it is invalid and <em title="MUST">MUST</em> be discarded.</li>
<li>The vendor <em title="SHOULD">SHOULD</em> create a new <code>tracestate</code> header and add a new key/value pair.</li>
<li>The vendor sets the <code>traceparent</code> and <code>tracestate</code> header for the outgoing request.</li>
</ol></section><section id="a-traceparent-is-received"><h3 id="x4-3-a-traceparent-is-received"><bdi>4.3 </bdi>A traceparent is Received<a aria-label="Â§" href="#a-traceparent-is-received"></a></h3><p>If a <code>traceparent</code> header is received:</p><ol>
<li><p>The vendor checks an incoming request for a <code>traceparent</code> and a <code>tracestate</code> header.</p>
</li>
<li><p>Because the <code>traceparent</code> header <em>is present</em>, the vendor tries to parse the version of the <code>traceparent</code> header.</p>
</li>
<li><p>If the <em>version cannot be parsed</em>, the vendor creates a new <code>traceparent</code> header and deletes <code>tracestate</code>.</p>
</li>
<li><p>If the <em>version number is higher</em> than supported by the tracer, the vendor uses the format defined in this specification (<code>00</code>) to parse <code>trace-id</code> and <code>parent-id</code>.
The vendor will only parse the <code>trace-flags</code> values supported by this version of this specification and ignore all other values. If parsing fails, the vendor creates a new <code>traceparent</code> header and deletes the <code>tracestate</code>. Vendors will set all unparsed / unknown <code>trace-flags</code> to 0 on outgoing requests.</p>
</li>
<li><p>If the vendor <em>supports the version number</em>, it validates <code>trace-id</code> and <code>parent-id</code>. If either <code>trace-id</code>, <code>parent-id</code> or <code>trace-flags</code> are invalid, the vendor creates a new <code>traceparent</code> header and deletes <code>tracestate</code>.</p>
</li>
<li><p>The vendor <em title="MAY">MAY</em> validate the <code>tracestate</code> header. If the <code>tracestate</code> header cannot be parsed the vendor <em title="MAY">MAY</em> discard the entire header. Invalid <code>tracestate</code> entries <em title="MAY">MAY</em> also be discarded.</p>
</li>
<li><p>For each outgoing request the vendor performs the following steps:</p>
<ol>
<li><p>The vendor <em title="MUST">MUST</em> modify the <code>traceparent</code> header:</p>
<ul>
<li><strong>Update <code>parent-id</code>:</strong> The value of property <code>parent-id</code> <em title="MUST">MUST</em> be set to a value representing the ID of the current operation.</li>
<li><strong>Update <code>sampled</code>:</strong> The value of <code>sampled</code> reflects the caller's recording behavior. The value of the <code>sampled</code> flag of <code>trace-flags</code> <em title="MAY">MAY</em> be set to <code>1</code> if the trace data is likely to be recorded or to <code>0</code> otherwise. Setting the flag is no guarantee that the trace will be recorded but increases the likeliness of end-to-end recorded traces.</li>
</ul>
</li>
<li><p>The vendor <em title="MAY">MAY</em> modify the <code>tracestate</code> header:</p>
<ul>
<li><strong>Update a key value:</strong> The value of any key can be updated. Modified keys <em title="MUST">MUST</em> be moved to the beginning (left) of the list.</li>
<li><strong>Add a new key/value pair:</strong> The new key-value pair <em title="MUST">MUST</em> be added to the beginning (left) of the list.</li>
<li><strong>Delete a key/value pair:</strong> Any key/value pair <em title="MAY">MAY</em> be deleted. Vendors <em title="SHOULD NOT">SHOULD NOT</em> delete keys that weren't generated by themselves. Deletion of any key/value pair <em title="MAY">MAY</em> break correlation in other systems.</li>
</ul>
</li>
<li><p>The vendor sets the <code>traceparent</code> and <code>tracestate</code> header for the outgoing request.</p>
</li>
</ol>
</li>
</ol></section><section id="alternative-processing"><h3 id="x4-4-alternative-processing"><bdi>4.4 </bdi>Alternative Processing<a aria-label="Â§" href="#alternative-processing"></a></h3><p>The processing model above describes the complete set of steps for processing trace context headers. There are, however, situations when a vendor might only support a subset of the steps described above. Proxies or messaging middleware <em title="MAY">MAY</em> decide not to modify the <code>traceparent</code> headers but remove invalid headers or add additional information to <code>tracestate</code>.</p></section></section><section id="other-communication-protocols"><h2 id="x5-other-communication-protocols"><bdi>5. </bdi>Other Communication Protocols<a aria-label="Â§" href="#other-communication-protocols"></a></h2><p>While trace context is defined for HTTP, the authors acknowledge it is also relevant for other communication protocols. Extensions of this specification, as well as specifications produced by external organizations, define the format of trace context serialization and deserialization for other protocols. Note that these extensions may be at a different maturity level than this specification.</p><p>Please refer to the [<cite><a data-link-type="biblio" href="#bib-trace-context-protocols-registry" title="Trace Context Protocols Registry">trace-context-protocols-registry</a></cite>] for the details of trace context implementation for other protocols.</p></section><section id="privacy-considerations"><h2 id="x6-privacy-considerations"><bdi>6. </bdi>Privacy Considerations<a aria-label="Â§" href="#privacy-considerations"></a></h2><p>Requirements to propagate headers to downstream services, as well as storing values of these headers, open up potential privacy concerns. Tracing vendors <em title="MUST NOT">MUST NOT</em> use <code>traceparent</code> and <code>tracestate</code> fields for any personally identifiable or otherwise sensitive information. The only purpose of these fields is to enable trace correlation.</p><p>Vendors <em title="MUST">MUST</em> assess the risk of header abuse. This section provides some considerations and initial assessment of the risk associated with storing and propagating these headers. Tracing vendors may choose to inspect and remove sensitive information from the fields before allowing the tracing system to execute code that can potentially propagate or store these fields. All mutations should, however, conform to the list of mutations defined in this specification.</p><section id="privacy-of-traceparent-field"><h3 id="x6-1-privacy-of-traceparent-field"><bdi>6.1 </bdi>Privacy of traceparent field<a aria-label="Â§" href="#privacy-of-traceparent-field"></a></h3><p>The <code>traceparent</code> field is comprised of randomly-generated numbers. If a random number generator leverages any user identifiable information like IP address as seed state, this information may be exposed. Random number generators <em title="MUST NOT">MUST NOT</em> rely on any information that can potentially be user-identifiable.</p><p>Another privacy risk of the <code>traceparent</code> field is the ability to correlate requests made as part of a single transaction. A downstream service may track and correlate two or more requests made in a single transaction and may make assumptions about the identity of the caller of a request based on information from another request.</p><p>Note that these privacy concerns of the <code>traceparent</code> field are theoretical rather than practical. Some services initiating or receiving a request <em title="MAY">MAY</em> choose to restart a <code>traceparent</code> field to eliminate those risks completely. Vendors <em title="SHOULD">SHOULD</em> find a way to minimize the number of <a href="#dfn-distributed-traces" data-link-type="dfn">distributed trace</a> restarts to promote interoperability of tracing vendors. Instead of restarts, different techniques may be used. For example, services may define trust boundaries of upstream and downstream connections and the level of exposure that any requests may bring. For instance, a vendor might only restart <code>traceparent</code> for authentication requests from or to external services.</p><p>Services may also define an algorithm and audit mechanism to validate the randomness of incoming or outgoing random numbers in the <code>traceparent</code> field. Note that this algorithm is services-specific and not a part of this specification. One example might be a temporal algorithm where a reversible hash function is applied to the current clock time. The receiver can validate that the time is within agreed upon boundaries, meaning the random number was generated with the required algorithm and in fact doesn't contain any personally identifiable information.</p></section><section id="privacy-of-tracestate-field"><h3 id="x6-2-privacy-of-tracestate-field"><bdi>6.2 </bdi>Privacy of tracestate field<a aria-label="Â§" href="#privacy-of-tracestate-field"></a></h3><p>The <code>tracestate</code> field may contain any opaque value in any of the keys. The main purpose of this header is to provide additional vendor-specific trace-identification information across different distributed tracing systems.</p><p>Vendors <em title="MUST NOT">MUST NOT</em> include any personally identifiable information in the <code>tracestate</code> header.</p><p>Vendors extremely sensitive to personal information exposure <em title="MAY">MAY</em> implement selective removal of values corresponding to the unknown keys. Vendors <em title="SHOULD NOT">SHOULD NOT</em> mutate the <code>tracestate</code> field, as it defeats the purpose of allowing multiple tracing systems to collaborate.</p></section><section id="other-risks"><h3 id="x6-3-other-risks"><bdi>6.3 </bdi>Other risks<a aria-label="Â§" href="#other-risks"></a></h3><p>When vendors include <code>traceparent</code> and <code>tracestate</code> headers in responses, these values may inadvertently be passed to cross-origin callers. Vendors should ensure that they include only these response headers when responding to systems that participated in the trace.</p></section></section><section id="security-considerations"><h2 id="x7-security-considerations"><bdi>7. </bdi>Security Considerations<a aria-label="Â§" href="#security-considerations"></a></h2><p>There are two types of potential security risks associated with this specification: information exposure and denial-of-service attacks against the vendor.</p><p>Vendors relying on <code>traceparent</code> and <code>tracestate</code> headers should also follow all best practices for parsing potentially malicious headers, including checking for header length and content of header values. These practices help to avoid buffer overflow and HTML injection attacks.</p><section id="information-exposure"><h3 id="x7-1-information-exposure"><bdi>7.1 </bdi>Information Exposure<a aria-label="Â§" href="#information-exposure"></a></h3><p>As mentioned in the privacy section, information in the <code>traceparent</code> and <code>tracestate</code> headers may carry information that can be considered sensitive. For example, <code>traceparent</code> may allow one request to be correlated to the data sent with another requeest, or the <code>tracestate</code> header may imply the version of monitoring software used by the caller. This information could potentially be used to create a larger attack.</p><p>Application owners should either ensure that no proprietary or confidential information is stored in <code>tracestate</code>, or they should ensure that <code>tracestate</code> isn't present in requests to external systems.</p></section><section id="denial-of-service"><h3 id="x7-2-denial-of-service"><bdi>7.2 </bdi>Denial of Service<a aria-label="Â§" href="#denial-of-service"></a></h3><p>When distributed tracing is enabled on a service with a public API and naively continues any trace with the <code>sampled</code> flag set, a malicious attacker could overwhelm an application with tracing overhead, forge <code>trace-id</code> collisions that make monitoring data unusable, or run up your tracing bill with your SaaS tracing vendor.</p><p>Tracing vendors and platforms should account for these situations and make sure that checks and balances are in place to protect denial of monitoring by malicious or badly authored callers.</p><p>One example of such protection may be different tracing behavior for authenticated and unauthenticated requests. Various rate limiters for data recording can also be implemented.</p></section><section id="other-risks-0"><h3 id="x7-3-other-risks"><bdi>7.3 </bdi>Other Risks<a aria-label="Â§" href="#other-risks-0"></a></h3><p>Application owners need to make sure to test all code paths leading to the sending of <code>traceparent</code> and <code>tracestate</code> headers. For example, in single page browser applications, it is typical to make cross-origin requests. If one of these code paths leads to <code>traceparent</code> and <code>tracestate</code> headers being sent by cross-origin calls that are restricted using <a href="https://fetch.spec.whatwg.org/#http-access-control-request-headers"><code>Access-Control-Allow-Headers</code></a> [<cite><a data-link-type="biblio" href="#bib-fetch" title="Fetch Standard">FETCH</a></cite>], it may fail.</p></section></section><section id="considerations-for-trace-id-field-generation"><h2 id="x8-considerations-for-trace-id-field-generation"><bdi>8. </bdi>Considerations for trace-id field generation<a aria-label="Â§" href="#considerations-for-trace-id-field-generation"></a></h2><p><em>This section is non-normative.</em></p><p>This section suggests some best practices to consider when platform or tracing
vendor implement <code>trace-id</code> generation and propagation algorithms. These
practices will ensure better interoperability of different systems.</p><section id="uniqueness-of-trace-id"><h3 id="x8-1-uniqueness-of-trace-id"><bdi>8.1 </bdi>Uniqueness of <code>trace-id</code><a aria-label="Â§" href="#uniqueness-of-trace-id"></a></h3><p>The value of <code>trace-id</code> <em title="SHOULD">SHOULD</em> be globally unique. This field is typically used
for unique identification of a <a href="#dfn-distributed-traces" data-link-type="dfn">distributed trace</a>. It is common for
<a href="#dfn-distributed-traces" data-link-type="dfn">distributed traces</a> to span various components, including, for example,
cloud services. Cloud services tend to serve variety of clients and have a very
high throughput of requests. So global uniqueness of <code>trace-id</code> is important,
even when local uniqueness might seem like a good solution.</p></section><section id="randomness-of-trace-id"><h3 id="x8-2-randomness-of-trace-id"><bdi>8.2 </bdi>Randomness of <code>trace-id</code><a aria-label="Â§" href="#randomness-of-trace-id"></a></h3><p>Randomly generated value of <code>trace-id</code> <em title="SHOULD">SHOULD</em> be preferred over other
algorithms of generating a globally unique identifiers. Randomness of <code>trace-id</code>
addresses some <a href="#security-considerations">security</a> and <a href="#privacy-considerations">privacy
concerns</a> of exposing unwanted information. Randomness
also allows tracing vendors to base sampling decisions on <code>trace-id</code> field value
and avoid propagating an additional sampling context.</p><p>As shown in the next section, it is important for <code>trace-id</code> to carry
"uniqueness" and "randomness" in the right part of the <code>trace-id</code>, for better
inter-operability with some existing systems.</p></section><section id="handling-trace-id-for-compliant-platforms-with-shorter-internal-identifiers"><h3 id="x8-3-handling-trace-id-for-compliant-platforms-with-shorter-internal-identifiers"><bdi>8.3 </bdi>Handling <code>trace-id</code> for compliant platforms with shorter internal identifiers<a aria-label="Â§" href="#handling-trace-id-for-compliant-platforms-with-shorter-internal-identifiers"></a></h3><p>There are tracing systems which use a <code>trace-id</code> that is shorter than 16 bytes,
which are still willing to adopt this specification.</p><p>If such a system is capable of propagating a fully compliant <code>trace-id</code>, even
while still requiring a shorter, non-compliant identifier for internal purposes,
the system is encouraged to utilize the <code>tracestate</code> header to propagate the
additional internal identifier. However, if a system would instead prefer to use
the internal identifier as the basis for a fully compliant <code>trace-id</code>, it <em title="SHOULD">SHOULD</em>
be incorporated at the as rightmost part of a <code>trace-id</code>. For example, tracing
system may receive <code>234a5bcd543ef3fa53ce929d0e0e4736</code> as a <code>trace-id</code>, hovewer
internally it will use <code>53ce929d0e0e4736</code> as an identifier.</p></section><section id="interoperating-with-existing-systems-which-use-shorter-identifiers"><h3 id="x8-4-interoperating-with-existing-systems-which-use-shorter-identifiers"><bdi>8.4 </bdi>Interoperating with existing systems which use shorter identifiers<a aria-label="Â§" href="#interoperating-with-existing-systems-which-use-shorter-identifiers"></a></h3><p>There are tracing systems which are not capable of propagating the entire 16
bytes of a <code>trace-id</code>. For better interoperability between a fully compliant
systems with these existing systems, the following practices are recommended:</p><ol>
<li>When a system creates an outbound message and needs to generate a fully
compliant 16 bytes <code>trace-id</code> from a shorter identifier, it <em title="SHOULD">SHOULD</em> left pad
the original identifier with zeroes. For example, the identifier
<code>53ce929d0e0e4736</code>, <em title="SHOULD">SHOULD</em> be converted to <code>trace-id</code> value
<code>000000000000000053ce929d0e0e4736</code>.</li>
<li>When a system receives an inbound message and needs to convert the 16 bytes
<code>trace-id</code> to a shorter identifier, the rightmost part of <code>trace-id</code> <em title="SHOULD">SHOULD</em>
be used as this identifier. For instance, if the value of <code>trace-id</code> was
<code>234a5bcd543ef3fa53ce929d0e0e4736</code> on an incoming request, tracing system
<em title="SHOULD">SHOULD</em> use identifier with the value of <code>53ce929d0e0e4736</code>.</li>
</ol><p>Similar transformations are expected when tracing system converts other
distributed trace context propagation formats to <abbr title="World Wide Web Consortium">W3C</abbr> Trace Context. Shorter
identifiers <em title="SHOULD">SHOULD</em> be left padded with zeros when converted to 16 bytes
<code>trace-id</code> and rightmost part of <code>trace-id</code> <em title="SHOULD">SHOULD</em> be used as a shorter
identifier.</p><p>Note, many existing systems that are not capable of propagating the whole
<code>trace-id</code> will not propagate <code>tracestate</code> header either. However, such system
can still use <code>tracestate</code> header to propagate additional data that is known by
this system. For example, some systems use two flags indicating whether
distributed trace needs to be recorded or not. In this case one flag can be send
as <code>sampled</code> flag of <code>traceparent</code> header and <code>tracestate</code> can be used to send
and receive an additional flag. Compliant systems will propagate this flag along
all other key/value pairs. Existing systems which are not capable of
<code>tracestate</code> propagation will truncate all additional values from <code>tracestate</code>
and only pass along that flag.</p></section></section><section id="acknowledgments"><h2 id="a-acknowledgments"><bdi>A. </bdi>Acknowledgments<a aria-label="Â§" href="#acknowledgments"></a></h2><p>Thanks to Adrian Cole, Christoph NeumÃ¼ller, Daniel Khan, Erika Arnold, Fabian Lange, Matthew Wear, Reiley Yang, Ted Young, Tyler Benson, Victor Soares for their contributions to this work.</p></section><section id="glossary"><h2 id="b-glossary"><bdi>B. </bdi>Glossary<a aria-label="Â§" href="#glossary"></a></h2><p><em>This section is non-normative.</em></p><dl>
<dt><dfn data-lt="distributed traces|Distributed trace" data-dfn-type="dfn" id="dfn-distributed-traces">Distributed trace</dfn></dt>
<dd>
A distributed trace is a set of events, triggered as a result
of a single logical operation, consolidated across various
components of an application. A distributed trace contains
events that cross process, network and security boundaries.
A distributed trace may be initiated when someone presses a
button to start an action on a website - in this example, the
trace will represent calls made between the downstream services
that handled the chain of requests initiated by this button
being pressed.
</dd>
</dl></section><section id="references"><h2 id="c-references"><bdi>C. </bdi>References<a aria-label="Â§" href="#references"></a></h2><section id="normative-references">
        <h3 id="c-1-normative-references"><bdi>C.1 </bdi>Normative references<a aria-label="Â§" href="#normative-references"></a></h3>
      <dl>
        <dt id="bib-bit-field">[BIT-FIELD]</dt><dd><a href="https://en.wikipedia.org/wiki/Bit_field"><cite>8-bit field</cite></a>.  Wikipedia. URL: <a href="https://en.wikipedia.org/wiki/Bit_field">https://en.wikipedia.org/wiki/Bit_field</a></dd><dt id="bib-fetch">[FETCH]</dt><dd><a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Anne van Kesteren.  WHATWG. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a></dd><dt id="bib-rfc0020">[RFC0020]</dt><dd><a href="https://tools.ietf.org/html/rfc20"><cite>ASCII format for network interchange</cite></a>. V.G. Cerf.  IETF. October 1969. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc20">https://tools.ietf.org/html/rfc20</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc5234">[RFC5234]</dt><dd><a href="https://tools.ietf.org/html/rfc5234"><cite>Augmented BNF for Syntax Specifications: ABNF</cite></a>. D. Crocker, Ed.; P. Overell.  IETF. January 2008. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc5234">https://tools.ietf.org/html/rfc5234</a></dd><dt id="bib-rfc7230">[RFC7230]</dt><dd><a href="https://httpwg.org/specs/rfc7230.html"><cite>Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</cite></a>. R. Fielding, Ed.; J. Reschke, Ed..  IETF. June 2014. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc7230.html">https://httpwg.org/specs/rfc7230.html</a></dd><dt id="bib-rfc8174">[RFC8174]</dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc8174">https://tools.ietf.org/html/rfc8174</a></dd><dt id="bib-trace-context-protocols-registry">[trace-context-protocols-registry]</dt><dd><a href="https://www.w3.org/TR/trace-context-protocols-registry/"><cite>Trace Context Protocols Registry</cite></a>. Sergey Kanzhelev; Philippe Le HÃ©garet.  W3C. 14 March 2019. W3C Note. URL: <a href="https://www.w3.org/TR/trace-context-protocols-registry/">https://www.w3.org/TR/trace-context-protocols-registry/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">â†‘</abbr></a></p></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>