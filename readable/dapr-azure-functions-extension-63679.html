<!DOCTYPE html>
<html lang="en">
<head>
    <title>
dapr/azure-functions-extension - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="dapr/azure-functions-extension - linksfor.dev(s)"/>
    <meta property="og:description" content="Contribute to dapr/azure-functions-extension development by creating an account on GitHub."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dapr/azure-functions-extension"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - dapr/azure-functions-extension</title>
<div class="readable">
        <h1>dapr/azure-functions-extension</h1>
            <div>Reading time: 8-10 minutes</div>
        <div>Posted here: 01 Jul 2020</div>
        <p><a href="https://github.com/dapr/azure-functions-extension">https://github.com/dapr/azure-functions-extension</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
        

      <div>
        <article itemprop="text">
<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/dapr/azure-functions-extension/workflows/Build%20and%20Test/badge.svg"><img src="https://github.com/dapr/azure-functions-extension/workflows/Build%20and%20Test/badge.svg" alt="Build and Test"></a>
<a href="https://gitter.im/Dapr/community?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge" rel="nofollow"><img src="https://camo.githubusercontent.com/b22b299d2937c6bdb570c7c5c5b60073dfe35704/68747470733a2f2f6261646765732e6769747465722e696d2f446170722f636f6d6d756e6974792e737667" alt="Gitter" data-canonical-src="https://badges.gitter.im/Dapr/community.svg"></a>
<a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://camo.githubusercontent.com/3ccf4c50a1576b0dd30b286717451fa56b783512/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542d79656c6c6f772e737667" alt="License: MIT" data-canonical-src="https://img.shields.io/badge/License-MIT-yellow.svg"></a></p>
<ul>
<li><a href="https://dapr.io/" rel="nofollow">dapr.io</a></li>
<li><a href="https://twitter.com/DaprDev" rel="nofollow">@DaprDev</a></li>
</ul>
<p><g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji> This extension is currently in preview and not recommended for production. <g-emoji alias="warning" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png">⚠️</g-emoji></p>
<p>The Azure Functions Dapr extension allows you to easily interact with the Dapr APIs from an Azure Function using triggers and bindings.  This extension is supported in any environment that supports running Dapr and Azure Functions - primarily self-hosted and Kubernetes modes.</p>
<p>If you are unfamiliar with Azure Functions, it's recommended to <a href="https://docs.microsoft.com/azure/azure-functions/" rel="nofollow">try out an Azure Function's quickstart first</a> to understand the basics of the programming model.</p>
<p>You can also jump to the <a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/quickstart.md">Dapr + Functions quickstart</a> below.</p>
<p>This extension currently supports Azure Functions written in <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction">JavaScript / TypeScript</a>, and <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction">Python</a>.</p>
<div><pre><span>module</span><span>.</span><span>exports</span> <span>=</span> <span>async</span> <span>function</span> <span>(</span><span>context</span><span>,</span> <span>req</span><span>)</span> <span>{</span>
    <span>context</span><span>.</span><span>log</span><span>(</span><span>'Function triggered.  Reading Dapr state...'</span><span>)</span><span>;</span>

    <span>context</span><span>.</span><span>log</span><span>(</span><span>'Current state of this function: '</span> <span>+</span> <span>context</span><span>.</span><span>bindings</span><span>.</span><span>daprState</span><span>)</span><span>;</span>

    <span>context</span><span>.</span><span>log</span><span>(</span><span>'Using Dapr service invocation to trigger Function B'</span><span>)</span><span>;</span>

    <span>context</span><span>.</span><span>bindings</span><span>.</span><span>daprInvoke</span> <span>=</span> <span>{</span>
        <span>appId</span>: <span>'function-b'</span><span>,</span>
        <span>methodName</span>: <span>'process'</span><span>,</span>
        <span>httpVerb</span>: <span>'post'</span><span>,</span>
        <span>body</span>: <span>context</span><span>.</span><span>bindings</span><span>.</span><span>daprState</span>
    <span>}</span>

    <span>context</span><span>.</span><span>res</span> <span>=</span> <span>{</span>
        <span>status</span>: <span>200</span>
    <span>}</span><span>;</span>
<span>}</span><span>;</span></pre></div>
<h2>Function Triggers</h2>
<p>Azure Function triggers start an execution.</p>
<table>
<thead>
<tr>
<th>Trigger Type</th>
<th>Description</th>
<th>Samples</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/triggers.md#input-binding-trigger">daprBindingTrigger</a></td>
<td>Trigger on a Dapr input binding</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/ConsumeMessageFromKafka.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/ConsumeMessageFromKafka/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/ConsumeMessageFromKafka/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/triggers.md#service-invocation-trigger">daprServiceInvocationTrigger</a></td>
<td>Trigger on a Dapr service invocation</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/RetrieveOrder.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/RetrieveOrder/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/RetrieveOrder/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/triggers.md#topic-trigger">daprTopicTrigger</a></td>
<td>Trigger on a Dapr topic subscription</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/PrintTopicMessage.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/PrintTopicMessage/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/PrintTopicMessage/__init__.py">Python</a></td>
</tr>
</tbody>
</table>
<h2>Function Bindings</h2>
<p>Azure Function bindings allow you to pull data in or push data out as during an execution.  <strong>Input Bindings</strong> pass in data at the beginning of an execution at the time of triggering.  <strong>Output Bindings</strong> push data out once an execution has completed.</p>
<table>
<thead>
<tr>
<th>Binding Type</th>
<th>Direction</th>
<th>Description</th>
<th>Samples</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/input-bindings.md#state-input-binding">daprState</a></td>
<td>Input</td>
<td>Pull in Dapr state for an execution</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/StateInputBinding.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/StateInputBinding/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/StateInputBinding/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/input-bindings.md#secret-input-binding">daprSecret</a></td>
<td>Input</td>
<td>Pull in Dapr secrets for an execution</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/RetrieveSecret.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/RetrieveSecret/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/RetrieveSecret/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/output-bindings.md#state-output-binding">daprState</a></td>
<td>Output</td>
<td>Save a value to Dapr state</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/StateOutputBinding.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/StateOutputBinding/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/StateOutputBinding/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/output-bindings.md#service-invocation-output-binding">daprInvoke</a></td>
<td>Output</td>
<td>Invoke another Dapr app</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/InvokeOutputBinding.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/InvokeOutputBinding/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/InvokeOutputBinding/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/output-bindings.md#topic-publish-output-binding">daprPublish</a></td>
<td>Output</td>
<td>Publish a message to a Dapr topic</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/PublishOutputBinding.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/PublishOutputBinding/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/PublishOutputBinding/__init__.py">Python</a></td>
</tr>
<tr>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/output-bindings.md#dapr-binding-output-binding">daprBinding</a></td>
<td>Output</td>
<td>Send a value to a Dapr output binding</td>
<td><a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/dotnet-azurefunction/SendMessageToKafka.cs">C#</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/javascript-azurefunction/SendMessageToKafka/index.js">JavaScript</a>, <a href="https://github.com/dapr/azure-functions-extension/blob/master/samples/python-azurefunction/SendMessageToKafka/__init__.py">Python</a></td>
</tr>
</tbody>
</table>
<h2>Quickstart</h2>
<p>You can run through a quickstart of developing some JavaScript Azure Functions that leverage Dapr with the <a href="https://github.com/dapr/azure-functions-extension/blob/master/docs/quickstart.md">following tutorial</a></p>
<h2>Installing the extension</h2>
<h3>.NET Functions</h3>
<p><a href="https://www.nuget.org/packages/Dapr.AzureFunctions.Extension" rel="nofollow">Install the NuGet package</a> for this extension into your function app project.</p>
<h3>Non-.NET Functions</h3>
<p>While this extension is in preview it is not included in the default extension bundle for functions.  You can still include it, but will need to manually install it into the project, and opt-out to using the default extensions.</p>
<ol>
<li>Open the <code>host.json</code> file from the root of the project and remove the <code>extensionBundle</code> property and values (if they exist).  Save the file.</li>
<li>Run <code>func extensions install -p Dapr.AzureFunctions.Extension -v 0.8.0-preview01</code>.  Be sure to use the latest version as <a href="https://www.nuget.org/packages/Dapr.AzureFunctions.Extension" rel="nofollow">published on NuGet</a>.  You must have the .NET Core SDK installed in order for this command to work.</li>
</ol>
<p>This also means for other extensions your app may be leveraging (e.g. Azure Service Bus or Azure Storage) you will need to manually install them using the NuGet package for that extension.  For example, with Azure Storage the <a href="https://docs.microsoft.com/azure/azure-functions/functions-bindings-storage-blob" rel="nofollow">documentation</a> links to a NuGet package for that extension where you could include in your app with this Dapr extension by running <code>func extensions install -p Microsoft.Azure.WebJobs.Extensions.Storage -v 4.0.2</code>.</p>
<h2>Dapr ports and listeners</h2>
<p>When you are triggering a function from Dapr, the extension will expose port 3001 automatically to listen to incoming requests from the Dapr sidecar.</p>
<blockquote>
<p>IMPORTANT: Port 3001 will only be exposed and listened if a Dapr trigger is defined in the function app.  When using Dapr the sidecar will wait to receive a response from the defined port before completing instantiation.  This means it is important to NOT define the <code>dapr.io/port</code> annotation or <code>--app-port</code> unless you have a trigger.  Doing so may lock your application from the Dapr sidecar.  Port 3001 does not need to be exposed or defined if only using input and output bindings.</p>
</blockquote>
<p>By default, when Azure Functions tries to communicate with Dapr it will call Dapr over the port resolved from the environment variable <code>DAPR_HTTP_PORT</code>.  If that is null, it will default to port <code>3500</code>.</p>
<p>You can override the Dapr address used by input and output bindings by setting the <code>DaprAddress</code> property in the <code>function.json</code> for the binding (or the attribute).  By default it will use <code>http://localhost:{DAPR_HTTP_PORT}</code>.</p>
<p>The function app will still expose another port and endpoint for things like HTTP triggers (locally this defaults to 7071, in a container it defaults to 80).</p>
<h2>Running and debugging an app</h2>
<p>Normally when debugging an Azure Function you use the <code>func</code> command line tool to start up the function app process and trigger your code.  When debugging or running an Azure Function that will leverage Dapr, you need to use <code>dapr</code> alongside <code>func</code> so both processes are running.</p>
<p>So when running a Dapr app locally using the default ports, you would leverage the <code>dapr</code> CLI to start the <code>func</code> CLI.</p>
<h3>If no Dapr triggers are in the app</h3>
<p><code>dapr run --app-id functionA --port 3501 -- func host start --no-build</code></p>
<h3>If Dapr triggers are in the app</h3>
<p><code>dapr run --app-id functionA --app-port 3001 --port 3501 -- func host start --no-build</code></p>
<h2>Deploying to Kubernetes</h2>
<p>You can annotate your function Kubernetes deployments to include the Dapr sidecar.</p>
<blockquote>
<p>IMPORTANT: Port 3001 will only be exposed and listened if a Dapr trigger is defined in the function app.  When using Dapr, the sidecar will wait to receive a response from the defined port before completing instantiation.  This means it is important to NOT define the <code>dapr.io/port</code> annotation or <code>--app-port</code> unless you have a trigger.  Doing so may lock your application from the Dapr sidecar. Port 3001 does not need to be exposed or defined if only using input and output bindings.</p>
</blockquote>
<p>To generate a Dockerfile for your app if you don't already have one, you can run the following command in your function project:
<code>func init --docker-only</code>.</p>
<p>The Azure Function core tools can automatically generate for you Kubernetes deployment files based on your local app.  It's worth noting these manifests expect <a href="https://keda.sh/" rel="nofollow">KEDA</a> will be present to manage scaling, so if not using KEDA you may need to remove the <code>ScaledObjects</code> generated, or craft your own deployment YAML file.  We do recommend including KEDA in any cluster that is running Azure Functions containers (with or without Dapr), but it is an optional component to assist with scaling.</p>
<p>An example of a function app deployment for Kubernetes can be <a href="#sample-kubernetes-deployment">found below</a>.</p>
<p>The following command will generate a <code>deploy.yaml</code> file for your project:
<code>func kubernetes deploy --name {container-name} --registry {docker-registry} --dry-run &gt; deploy.yaml</code></p>
<p>You can then edit the generated <code>deploy.yaml</code> to add the dapr annotations.  You can also craft a deployment manually.</p>
<h3>Azure Storage account requirements</h3>
<p>While an Azure Storage account is required to run functions within Azure, it is NOT required for functions that run in Kubernetes or from a Docker container.  The exception to that is functions that leverage a Timer trigger or Event Hub trigger.  In those cases the storage account is used to coordinate leases for instances, so you will need to set an <code>AzureWebJobsStorage</code> connection string if using those triggers.  You can set the <code>AzureWebJobsStorage</code> value to <code>none</code> if not using any of the triggers that require it.</p>
<h3>Sample Kubernetes deployment</h3>
<div><pre><span>apiVersion</span>: <span>v1</span>
<span>kind</span>: <span>Service</span>
<span>metadata</span>:
  <span>name</span>: <span>my-function</span>
  <span>namespace</span>: <span>default</span>
<span>spec</span>:
  <span>selector</span>:
    <span>app</span>: <span>my-function</span>
  <span>ports</span>:
  - <span>protocol</span>: <span>TCP</span>
    <span>port</span>: <span>80</span>
    <span>targetPort</span>: <span>80</span>
  <span>type</span>: <span>LoadBalancer</span>
---
<span>apiVersion</span>: <span>apps/v1</span>
<span>kind</span>: <span>Deployment</span>
<span>metadata</span>:
  <span>name</span>: <span>my-function</span>
  <span>namespace</span>: <span>default</span>
  <span>labels</span>:
    <span>app</span>: <span>my-function</span>
<span>spec</span>:
  <span>replicas</span>: <span>1</span>
  <span>selector</span>:
    <span>matchLabels</span>:
      <span>app</span>: <span>my-function</span>
  <span>template</span>:
    <span>metadata</span>:
      <span>labels</span>:
        <span>app</span>: <span>my-function</span>
      <span>annotations</span>:
        <span>dapr.io/enabled</span>: <span><span>"</span>true<span>"</span></span>
        <span>dapr.io/id</span>: <span><span>"</span>functionapp<span>"</span></span>
        <span><span>#</span> Only define port of Dapr triggers are included</span>
        <span>dapr.io/port</span>: <span><span>"</span>3001<span>"</span></span>
    <span>spec</span>:
      <span>containers</span>:
      - <span>name</span>: <span>my-function</span>
        <span>image</span>: <span>myregistry/my-function</span>
        <span>ports</span>:
        <span><span>#</span> Port for HTTP triggered functions</span>
        - <span>containerPort</span>: <span>80</span>
---</pre></div>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>