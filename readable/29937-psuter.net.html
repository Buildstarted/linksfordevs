<!DOCTYPE html>
<html lang="en">
<head>
    <title>
psuter.net -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>psuter.net</h1><div><div id="" class=""><time datetime="2019-07-07">July 7, 2019</time><p>Elements on web pages are mostly side-by-side, or above and under each other. Occasionally however, a design calls for two or more elements to overlap. Familiar examples include unfolding navigation menus, preview panes when hovering a link, unhelpful banners about cookies, and of course countless popups demanding your immediate attention.</p><figure><div id="demo-wrapper"><div id="demo-text"><h5>How I became great at everything</h5><h6>A tale of courage, guile, and unsupported assertions.</h6><img src="/images/not-bali.png" alt="Not Bali" title="Not Bali"><p>It was December in Bali. I was dozing off when the Slack notification jolted me awake. I felt an unfamiliar pull, and for the first time, I looked not at the bouncing icon, but over the lotus-covered pond, and straight into the glistening sea; I was living life wrong.</p><p>My relentless pursuit of perfection had taken a toll. Running three companies was pushing me to my limits; I had been forced on multiple occasions to pull a 5- or even 6-hour work week. The Hindu temples I had come to surround myself with were whispering to me. The language was foreign and the voice indecipherable, but the message was crystal clear:</p></div><h5>Pardon the interruption.</h5></div><figcaption>When two elements overlap, their <code class="highlighter-rouge">z-index</code> values determine which one is shown on top.</figcaption></figure><p>In these situations, the browser must somehow decide which elements to draw “on top”, and which elements to keep in the background, fully or partially covered. A relatively complex<sup id="fnref:elaborate-appendix"><a href="#fn:elaborate-appendix" class="footnote">1</a></sup> set of rules in the CSS standard defines a default <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context#The_stacking_context">stacking order</a> for every element in a page.

When the default order is unsatisfactory, developers resort to the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/z-index"><code class="highlighter-rouge">z-index</code></a> property: it gives control over a virtual <code class="highlighter-rouge">z</code> axis (depth), defined conceptually as going “through” the page. An element with a higher <code class="highlighter-rouge">z-index</code> is thus displayed “closer” to the user, that is, painted on top of elements with lower indices.</p><p>An interesting property of the <code class="highlighter-rouge">z</code> axis is that it does not have natural bounds. The horizontal and vertical axes are typically restricted by the expected dimensions of the display. We would not expect any elements to be positioned “<code class="highlighter-rouge">1000000px</code> from the left” or “<code class="highlighter-rouge">-3000em</code> from the top”: they would either be invisible, or incur unpleasant amounts of scrolling.<sup id="fnref:one-million-pixels"><a href="#fn:one-million-pixels" class="footnote">2</a></sup> Values for <code class="highlighter-rouge">z-index</code> however are unitless, and only matter in relative terms: a page with two elements will look the same if the <code class="highlighter-rouge">z</code> indices are <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">2</code>, or <code class="highlighter-rouge">-10</code> and <code class="highlighter-rouge">999</code>. This, combined with the fact that pages are often assembled from components developed in isolation, leads to the curious art of picking appropriate <code class="highlighter-rouge">z</code> indices.</p><p>How do you make sure your annoying popup is shown on top of every other element in the page, when you don’t know how many there are, who wrote them, and how bad <em>they</em> wanted their elements to be on top? That’s when you set your <code class="highlighter-rouge">z-index</code> to <code class="highlighter-rouge">100</code>, or maybe <code class="highlighter-rouge">999</code>, or maybe, just maybe <code class="highlighter-rouge">99999</code> to be <em>really</em> sure yours will win.</p><p>That, at least, is how I write my CSS. In the rest of this post, we will look at millions of <code class="highlighter-rouge">z</code> indices to see what everyone else does.</p><h2 id="getting-the-data">Getting the data</h2><p>The first step was to acquire a large set of <code class="highlighter-rouge">z-index</code> values from existing webpages. For this I turned to <a href="https://commoncrawl.org/">Common Crawl</a>, a publicly available, very large, and wonderful repository of pages crawled from the web. The data is hosted on S3, meaning that it is reasonably efficient to query it from an AWS cluster, and there are fortunately multiple tutorials online showing how to do just that.</p><p>My elaborate <code class="highlighter-rouge">z-index</code> extractor consists in finding, in every page, all matches of the following regular expression:</p><div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">b</span><span class="s">'z-index *: *(-?[0-9]+|auto|inherit|initial|unset)'</span><span class="p">)</span></code></pre></div><p>Once the values are identified, we are left with a standard word-count map-reduce task. Luckily, I’m not the first person who wants to count occurrences of things, and it was enough to adapt
<a href="https://github.com/commoncrawl/cc-pyspark">one of many examples</a>. (Almost all my original code is the regex above.)</p><p>With the help of <a href="https://tech.marksblogg.com/petabytes-of-website-data-spark-emr.html">a very detailed blog post</a>, I deployed the code on an <a href="https://aws.amazon.com/emr/">Elastic Map Reduce</a> cluster, and proceeded to scan through pages from the <a href="http://commoncrawl.org/2019/04/march-2019-crawl-archive-now-available/">March 2019 crawl archive</a>. That specific snapshot is organized into 56,000 parts, from which I picked 2,500 at random, or about 4.4%. There is nothing special about that number, other than it translated roughly into the cost I was willing to invest in this experiment. After a terrifying night hoping that I had done my projections correctly, I had my results, extracted from 112.7M pages.<sup id="fnref:html-css"><a href="#fn:html-css" class="footnote">3</a></sup></p><h2 id="most-common-indices">Most common indices</h2><p>My scan yielded a total of about 176.5M <code class="highlighter-rouge">z-index</code> values, split across 36.2K unique values.</p><p>So what are the most common ones?</p><p><a href="#fig-1">Figure 1</a> shows the top 50. Note that the <em>y</em> axis uses a log scale, and shows relative frequencies. For instance, the most common value, <code class="highlighter-rouge">1</code>, accounts for 14.6% of all occurrences found across the sample. Together, the top 50 account for around 80% of all collected values.</p><figure id="fig-1" class="full-width"><figcaption>Figure 1 – Most commonly used <code class="highlighter-rouge">z-index</code> values. The <em>y</em> axis shows the relative frequency.</figcaption></figure><p>The first observation is that positive values dominate: the only negative one in the top 50 is <code class="highlighter-rouge">-1</code>. (The second most-common one, <code class="highlighter-rouge">-2</code> ranks 70th.) This maybe tells us that people are generally more interested in bringing things to front than hiding them in the back.</p><p>Generally, most of the top values have one of the following properties:</p><ul><li>They are small: e.g. all the ordinals from <code class="highlighter-rouge">0</code> to <code class="highlighter-rouge">12</code> are in the top 50.</li><li>They are powers of ten, or multiples of power of tens: <code class="highlighter-rouge">10</code>, <code class="highlighter-rouge">100</code>, <code class="highlighter-rouge">1000</code>, <code class="highlighter-rouge">2000</code>, …</li><li>They are “close” to a power of ten: <code class="highlighter-rouge">1001</code>, <code class="highlighter-rouge">999</code>, <code class="highlighter-rouge">10001</code>, …</li></ul><p>These patterns are consistent with humans picking large “familiar” values (powers of ten), and then, possibly to adjust relative depths within a component, values slightly above or under them.</p><p>It is also interesting to look at the most common values that do <em>not</em> fit any of these patterns:</p><p>At rank 36, we have <code class="highlighter-rouge">2147483647</code>, a number that many programmers will instantly recognize as <code class="highlighter-rouge">INT_MAX</code>, or 2<sup>31</sup>-1. The thought process must be that, since this is the largest value a (signed) integer can have, no <code class="highlighter-rouge">z-index</code> can possibly be higher and thus an element with index <code class="highlighter-rouge">INT_MAX</code> will always be on top. MDN however has <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/integer">this</a> to say about integers in CSS:</p><blockquote><p>There is no official range of valid <code class="highlighter-rouge">&lt;integer&gt;</code> values. Opera 12.1 supports values up to 2<sup>15</sup>-1, IE up to 2<sup>20</sup>-1, and other browsers even higher. During the CSS3 Values cycle there was a lot of discussion about setting a minimum range to support: the latest decision, in April 2012 during the LC phase, was [-2<sup>27</sup>-1; 2<sup>27</sup>-1], but other values like 2<sup>24</sup>-1 and 2<sup>30</sup>-1 were also proposed. However, the latest spec doesn’t specify a range anymore.</p></blockquote><p>So not only is there no agreed upon max value, but in every documented specification or standard proposal, <code class="highlighter-rouge">INT_MAX</code> is in fact out of range.</p><p>At rank 39, we have <code class="highlighter-rouge">8675309</code>, which I personally didn’t recognize as being particularly noteworthy. However, with over half a million collected uses, it clearly is meaningful to many. I suspect it is either instantly recognizable or completely obscure, depending on where and when you grew up. I won’t spoil it for you, the answer is just <a href="https://duckduckgo.com/?q=8675309">one search</a> away.</p><p>The last two numbers that seemed a little out of place are <code class="highlighter-rouge">1030</code> and <code class="highlighter-rouge">1050</code>, at ranks 42 and 45 respectively. Another cursory web search showed that <a href="https://stackoverflow.com/a/45796753/358642">these are the default <code class="highlighter-rouge">z-index</code> values</a> for Bootstrap’s <code class="highlighter-rouge">navbar-fixed</code> and <code class="highlighter-rouge">modal</code> classes, respectively.</p><h2 id="value-distribution">Value distribution</h2><p>Even though a small set of common values account for the vast majority of all <code class="highlighter-rouge">z</code> indices, it can be interesting to look at the broader distribution of the collected set. For instance, <a href="#fig-2">Figure 2</a> shows the frequency of all values between <code class="highlighter-rouge">-120</code> and <code class="highlighter-rouge">260</code>.</p><figure id="fig-2" class="full-width"><figcaption>Figure 2 – Relative frequency of all <code class="highlighter-rouge">z-index</code> values from <code class="highlighter-rouge">-120</code> to <code class="highlighter-rouge">260</code>.</figcaption></figure><p>In addition to the dominance of round numbers, we see an almost fractal-like quality, with patterns visible at multiple frequencies. For instance, the midpoint between two local maxima is itself a (lower) maximum: <code class="highlighter-rouge">5</code> between <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">10</code>, <code class="highlighter-rouge">15</code> between <code class="highlighter-rouge">10</code> and <code class="highlighter-rouge">20</code>, <code class="highlighter-rouge">50</code> between <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">100</code>, etc.</p><p>We can confirm this effect by considering a wider range: <a href="#fig-3">Figure 3</a> shows the frequencies of all values from <code class="highlighter-rouge">-1200</code> to <code class="highlighter-rouge">2600</code>, ignoring the last digit. That is, the frequencies of e.g. <code class="highlighter-rouge">250</code>, <code class="highlighter-rouge">257</code>, and <code class="highlighter-rouge">259</code> are summed up and shown as a single point with <em>x</em> = <code class="highlighter-rouge">250</code>. The graph is remarkably similar to Figure 2, showing that most of the structure of the distribution is preserved when considering values an order of magnitude larger.</p><figure id="fig-3" class="full-width"><figcaption>Figure 3 – Relative frequency of all <code class="highlighter-rouge">z-index</code> values from <code class="highlighter-rouge">-1200</code> to <code class="highlighter-rouge">2600</code>, grouped by ignoring their least significant digit.</figcaption></figure><p>Finally, <a href="#fig-4">Figure 4</a> shows all positive <code class="highlighter-rouge">z-index</code> values between <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">9999999999</code> grouped by their first digit (horizontal axis) and the number of digits (vertical axis).</p><figure id="fig-4"><div class="fig"><img id="fig-4-preview" src="/images/z-index-fig-4-preview.png"></div><figcaption>Figure 4 – Positive <code class="highlighter-rouge">z-index</code> values grouped by first digit and number of digits. Sizes are proportional to the group total frequency. Click or tap on a group for details.</figcaption></figure><p>We can intuitively think of a group as a pattern of values, e.g. <code class="highlighter-rouge">3xxx</code> for four-digit values starting with <code class="highlighter-rouge">3</code>. Each group is shown as a rectangle whose size is proportional to the frequency of the pattern. The figure shows, for instance, that for each order of magnitude, i.e. row of groups, the frequencies follow a similar trend, with the values starting with <code class="highlighter-rouge">1</code> being the most common, then <code class="highlighter-rouge">9</code>, then <code class="highlighter-rouge">5</code>.</p><p>The hue of each group is assigned based on its entropy, a measure of the diversity of values within the group. Yellow groups have the highest, and blue groups have the lowest entropy. This helps highlight the patterns among which developers tend to select the same values, and the ones where they pick less uniformly. (Note that the entropy for the entire dataset is 6.51 bits.)</p><p>You can click (or tap) on each group to see the top 3 values within in, and their frequency relative to the group. Can you spot the pop culture references?</p><h2 id="conclusion">Conclusion</h2><p>While it was definitely fun to collect and explore this data set, I’m sure there are better statistics, visualizations, and explanations waiting to be mined and presented. If you’d like to give it a try, feel free to download and share the <a href="/resources/z-indices/z-index-data.csv"><code class="highlighter-rouge">z-index</code> count file</a>.</p><p>Perhaps you will succeed where I failed, and find a way to include in a chart the largest <code class="highlighter-rouge">z-index</code> value I found, namely 10<sup>1242</sup>-1.</p><p>Yes, that’s the number <code class="highlighter-rouge">9</code> repeated 1242 times. I really hope they were finally able to show their <code class="highlighter-rouge">&lt;div&gt;</code> on top.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>