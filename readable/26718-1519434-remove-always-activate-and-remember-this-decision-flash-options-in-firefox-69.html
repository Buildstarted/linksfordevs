<!DOCTYPE html>
<html lang="en">
<head>
    <title>
1519434 - Remove &quot;Always Activate&quot; and &quot;Remember this decision&quot; Flash options in Firefox 69 -
linksfor.dev(s)
    </title>
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>1519434 - Remove &quot;Always Activate&quot; and &quot;Remember this decision&quot; Flash options in Firefox 69</h1>
    <div><p id="wrapper"> <aside id="message-container"> </aside> <main id="bugzilla-body">
<div id="main-inner"> <section class="module"> </section> <section class="module" id="module-status"> <div class="module-content" id="module-status-content"><div class="fields-lhs"> <div class="field" id="field-product"> <div class="value"> <span id="field-value-product"> </span> </div> </div> </div><div class="fields-rhs"> </div> <div class="field edit-show" id="field-status-edit"> <div class=" container"> <span id="field-value-status-edit"> </span> </div> </div> </div>
</section> <section class="module" id="module-people"> </section> <section class="module" id="module-tracking"> </section> <section class="module" id="module-firefox-tracking-flags"> </section> <section class="module" id="module-details"> <div class="module-content" id="module-details-content"><div class="fields-rhs"> <div class="field" id="field-bug_file_loc"> <div class="value"> <span id="field-value-bug_file_loc"> </span> </div> </div> </div> </div>
</section> <section class="module edit-show" id="module-security"> <div class="module-content" id="module-security-content"><div class="groups edit-hide"> This bug is publicly visible.
</div> </div>
</section> <section class="module edit-show" id="module-user-story"> </section> <section class="module" id="module-attachments"> <div class="module-content" id="module-attachments-content"><table class="layout-table" id="attachments"> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c9" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070657&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070657">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c10" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070658&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070658">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c11" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070660&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070660">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c12" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070661&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070661">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c13" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070662&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070662">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div class="attach-desc"> <a href="/attachment.cgi?id=9070663">Bug 1519434 - remove extant permanent flash permissions, r?johannh</a> </div> <div> <a href="#c14" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070663&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070663">Review</a> </td></tr> <tr class=" attach-patch "> <td class="attach-desc-td"> <div> <a href="#c15" class="attach-time activity-ref"><span class="rel-time">9 days ago</span></a> <span class="attach-author"></span> </div> </td> <td> </td> <td class="attach-actions"> <a href="/attachment.cgi?id=9070664&amp;action=edit">Details</a> | <a href="/attachment.cgi?id=9070664">Review</a> </td></tr>
</table> </div>
</section> <meta> <div class="change-set" id="c0"><div class="comment-text markdown-body " id="ct-0"><p>Per our Flash (plugin) deprecation roadmap, we&apos;ll disable Flash by default in Nightly 69 and let that roll out.</p>
</div></div><div class="change-set" id="a87_279663"><div class="change" id="aa87_279663"> </div></div><div class="change-set" id="a13332_430528"><div class="change" id="aa13332_430528"> </div></div><div class="change-set" id="a344295_279663"><div class="change" id="aa344295_279663"> </div><div class="activity"><div class="change">Summary: Disable Flash support by default in Firefox 69 &#x2192; [meta] Disable Flash support by default in Firefox 69</div></div></div><div class="change-set" id="a344628_279663"><div class="change" id="aa344628_279663"> </div></div><div class="change-set" id="a344893_279663"><div class="change" id="aa344893_279663"> </div></div><div class="change-set" id="a345655_279663"><div class="change" id="aa345655_279663"> </div></div><div class="change-set" id="c1"><div class="comment-text markdown-body " id="ct-1"><p>In Firefox 69, we will remove Firefox&apos;s:</p>
<ul>
<li>&quot;Always Activate&quot; Flash option in about:addons
<ul>
<li>If Flash&apos;s click-to-activate setting was previously &quot;Always Activate&quot; or &quot;Ask to Activate&quot;, it should now be &quot;Ask to Activate&quot;.</li>
<li>If Flash&apos;s click-to-activate setting was previously &quot;Never Activate&quot;, it should still be &quot;Never Activate&quot;. However, if this is difficult to implement, we can reset everyone&apos;s Flash click-to-activate setting to &quot;Ask to Activate&quot;.</li>
</ul>
</li>
<li>&quot;Remember this decision&quot; from the Flash click-to-activate door hanger. We want prompt users every time a site wants to activate Flash in each browser session.
<ul>
<li><del>But we want Firefox 69+ to remember sites that the user had checked &quot;Remember this decision&quot; in earlier Firefox versions. (Firefox only remembers the door hanger decision for 90 days, so these remembered site permissions will all phase out over 90 days.)</del></li>
</ul>
</li>
</ul>
</div><div class="activity"><div class="change">Keywords: <span class="activity-deleted"><a href="/buglist.cgi?keywords=meta&amp;resolution=---">meta</a>, <a href="/buglist.cgi?keywords=site-compat&amp;resolution=---">site-compat</a></span></div><div class="change">Summary: [meta] Disable Flash support by default in Firefox 69 &#x2192; Remove &quot;Always Activate&quot; and &quot;Remember my decision&quot; Flash options in Firefox 69</div></div></div><div class="change-set" id="a9512971_263117"><div class="change" id="aa9512971_263117"> </div></div><div class="change-set" id="a9578168_580271"><div class="change" id="aa9578168_580271"> </div><div class="activity"><div class="change">No longer blocks: <a class="bz_bug_link bz_status_NEW" href="/show_bug.cgi?id=1543600">1543600</a></div></div></div><div class="change-set" id="c3"><div class="comment-text markdown-body " id="ct-3"><p>Somehow I volunteered to do this, so taking...</p>
</div><div class="activity"><div class="change">Assignee: nobody &#x2192; gijskruitbosch+bugs</div></div></div><div class="change-set" id="c4"><div class="comment-text markdown-body " id="ct-4"><p>Is there a broader plan for what we want here? Some questions that spring to mind (which perhaps are answered in such a doc somewhere):</p>
<ol>
<li>I&apos;m assuming we want to actually make this completely impossible, not just remove the UI and keep support for the internal &quot;always run this plugin&quot; state?</li>
<li>do we need a pref to turn off this restriction if we uncover too many issues?</li>
<li>we still have a flash_only pref that allows other plugins to be used - in this bug, do we just want to remove support for &quot;always run&quot; for all plugins?</li>
<li>can we remove support for the flash_only pref except when running automated tests (to reduce the testing/complexity matrix), or is that not possible at the moment?</li>
<li>do existing users get this change applied, and/or do we need to notify them in any way beyond relnotes?</li>
</ol>
</div><div class="activity"><div class="change">Flags: needinfo?(jmathies)</div><div class="change">Flags: needinfo?(cpeterson)</div></div></div><div class="change-set" id="c5"><div class="comment-text markdown-body " id="ct-5"><p>(In reply to :Gijs (he/him) from <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="/show_bug.cgi?id=1519434#c4">comment #4</a>)</p>
<blockquote>
<p>Is there a broader plan for what we want here? Some questions that spring to mind (which perhaps are answered in such a doc somewhere):</p>
</blockquote>
<p>No, but I&apos;ll create a doc that consolidates all these answers:</p>
<p><a href="https://docs.google.com/document/d/1U5uHskPkJIUkASwLI6uVdFl2s0MM6dfPzCAoT0Bftms/edit">https://docs.google.com/document/d/1U5uHskPkJIUkASwLI6uVdFl2s0MM6dfPzCAoT0Bftms/edit</a></p>
<blockquote>
<ol>
<li>I&apos;m assuming we want to actually make this completely impossible, not just remove the UI and keep support for the internal &quot;always run this plugin&quot; state?</li>
</ol>
</blockquote>
<p>Good question! I hadn&apos;t thought of that.</p>
<p>We had planned to just remove the UI to prevent setting new always-allow site permissions and then let users&apos; existing always-allow site permissions quietly expire after 90 days. But we should probably remove Gecko&apos;s always-run Flash code (somewhere in dom/plugins/base) now so Firefox Nightly users can actually experience the always-ask Flash UX now. If there are Flash issues, we want to find them during Nightly testing, not 90 days from now. :) We&apos;ll also need to remove any Flash code in the Site Permissions UI.</p>
<p>However, we do <em>not</em> want to remove always-run support for the dummy NPAPI test plugin (used for our automated NPAPI tests), Widevine, or OpenH264! Widevine and OpenH264 are GMPs (Gecko Media Plugins), not NPAPI plugins, so they might use a different code path. Just something to watch for.</p>
<blockquote>
<ol>
<li>do we need a pref to turn off this restriction if we uncover too many issues?</li>
</ol>
</blockquote>
<p>I don&apos;t think we need a pref. Chrome has shipped a similar always-ask UX since September 2018, so there should not be any Flash sites that cause problems in Firefox but not Chrome:</p>
<p><a href="https://sites.google.com/a/chromium.org/dev/flash-roadmap#TOC-Non-Persisted-HTML5-by-Default-Target:-Chrome-69---September-2018-">https://sites.google.com/a/chromium.org/dev/flash-roadmap#TOC-Non-Persisted-HTML5-by-Default-Target:-Chrome-69---September-2018-</a></p>
<blockquote>
<ol>
<li>we still have a flash_only pref that allows other plugins to be used - in this bug, do we just want to remove support for &quot;always run&quot; for all plugins?</li>
<li>can we remove support for the flash_only pref except when running automated tests (to reduce the testing/complexity matrix), or is that not possible at the moment?</li>
</ol>
</blockquote>
<p>Flash and the dummy NPAPI test plugin are the only NPAPI plugins we support. Widevine and OpenH264 are also &quot;plugins&quot; but we do not want to remove their always-allow support.</p>
<p>The flash_only pref should only be used for our automated NPAPI tests, so we can disable or remove the pref in non-test code paths, as long as disabling it doesn&apos;t affect Widevine or OpenH264.</p>
<blockquote>
<ol>
<li>do existing users get this change applied, and/or do we need to notify them in any way beyond relnotes?</li>
</ol>
</blockquote>
<p>All users should get this change. We don&apos;t need to notify users.</p>
</div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(jmathies)</span></div><div class="change">Flags: <span class="activity-deleted">needinfo?(cpeterson)</span></div></div></div><div class="change-set" id="c7"><div class="comment-text markdown-body " id="ct-7"><p>Johann, can you help me understand how this code:</p>
<p><a href="https://searchfox.org/mozilla-central/rev/153172de0c5bfca31ef861bd8fc0995f44cada6a/browser/modules/SitePermissions.jsm#940-943">https://searchfox.org/mozilla-central/rev/153172de0c5bfca31ef861bd8fc0995f44cada6a/browser/modules/SitePermissions.jsm#940-943</a></p>
<p>fits into the permissions page in the page info dialog, and whether I need to change something there? It looks to me like right now, allowing flash without ticking the &apos;remember&apos; checkbox shows up as &quot;allow&quot;, and this permission is simply gone (because it&apos;s a per-session permission) after a restart -- but some other permissions in the page info dialog have an &quot;allow for session&quot; option; does something need to change as part of this bug or not (or only to make it slightly more correct, but kind of orthogonal to this bug) ?</p>
<p>(TL;DR for this bug: we want to remove the ability to permanently/persistently allow flash to play, including all the UI to that effect.)</p>
</div><div class="activity"><div class="change">Flags: needinfo?(jhofmann)</div></div></div><div class="change-set" id="c8"><div class="comment-text markdown-body " id="ct-8"><p>Yeah, so, the plugin permissions in the doorhanger are set here: <a href="https://searchfox.org/mozilla-central/rev/153172de0c5bfca31ef861bd8fc0995f44cada6a/browser/base/content/browser-plugins.js#143">https://searchfox.org/mozilla-central/rev/153172de0c5bfca31ef861bd8fc0995f44cada6a/browser/base/content/browser-plugins.js#143</a></p>
<p>What that code does is if you simply click &quot;allow&quot; it will set a session scoped permission to allow Flash.</p>
<p>This works independently of SitePermissions.jsm, but after the permission is updated the SitePermissions stuff is needed to display the correct permission state in the identity popup and page info.</p>
<p>As you noted, PageInfo lists all states for each permission as they are specified in SitePermissions.jsm. Then it tries to select one of them and that part is a little wrong for at least plugins. We fetch state and scope <a href="https://searchfox.org/mozilla-central/rev/153172de0c5bfca31ef861bd8fc0995f44cada6a/browser/base/content/pageinfo/permissions.js#64">here</a>, but then continue to only consider state when selecting an item. So we select &quot;Allow&quot; when there really should be an &quot;Allow for Session&quot; item.</p>
<blockquote>
<p>but some other permissions in the page info dialog have an &quot;allow for session&quot; option</p>
</blockquote>
<p>Only cookies has that and it&apos;s an entirely independent permission state, not denoted by its permission scope. It&apos;s very confusing.</p>
<blockquote>
<p>(TL;DR for this bug: we want to remove the ability to permanently/persistently allow flash to play, including all the UI to that effect.)</p>
</blockquote>
<p>Then I would suggest just dropping that option from the doorhanger (see link above) and renaming &quot;Allow&quot; into &quot;Allow for session&quot; for plugins in Page Info (the identity popup should already correctly display &quot;Temporarily Allowed&quot;).</p>
<p>Do you want to keep supporting previous permanent ALLOW entries for plugin permissions in the permission manager? Then we might need a bit of hackery to have Allow as an unselectable? option there, too.</p>
<p>I hope that helps!</p>
</div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(jhofmann)</span></div></div></div><div class="change-set" id="c17"><div class="comment-text markdown-body " id="ct-17"><p>Release Note Request (optional, but appreciated)
[Why is this notable]: flash can&apos;t be set to always activate anymore
[Affects Firefox for Android]: I don&apos;t think so, but there&apos;s also no fennec 69 so kind of moot
[Suggested wording]:</p><p>
[Links (documentation, blog post, etc)]:</p></div></div></div></main></p><div class="change-set" id="c21"><div class="comment-text markdown-body " id="ct-21"><p>It turns out that (a) we have mochitest-plain plugin tests, and (b) they rely on setting <code>plugin.enabledState</code> to &apos;enabled&apos;, from the content process, to enable plugins. Which broke because for click-to-play flash, it&apos;s no longer possible to do that. What they should be doing is giving themselves permission, but that&apos;s easier said than done...</p>
</div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>