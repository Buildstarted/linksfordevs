<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Fastly&#x2019;s native WebAssembly compiler and runtime -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Fastly’s native WebAssembly compiler and runtime</h1><div><div class="column blog-post-body"><p>Today, we are thrilled to announce the&nbsp;<a href="https://github.com/fastly/lucet">open sourcing of Lucet</a>, Fastly’s native WebAssembly compiler and runtime. WebAssembly is a technology created to enable web browsers to safely execute programs at near-native speeds. It has been shipping in the four major browsers since early 2017.</p><p>Lucet is designed to take WebAssembly beyond the browser, and build a platform for faster, safer execution on Fastly’s edge cloud. WebAssembly is already supported by many languages including Rust, TypeScript, C, and C++, and many more have WebAssembly support in development. We want to enable our customers to go beyond&nbsp;<a href="https://docs.fastly.com/vcl/">Fastly VCL</a>&nbsp;and move even more logic to the edge, and use any language they choose. Lucet is the engine behind Terrarium, our experimental platform for edge computation using WebAssembly. Soon, we will make it available on Fastly’s edge cloud as well.</p><p>A major design requirement for Lucet was to be able to execute on every single request that Fastly handles. That means creating a WebAssembly instance for each of the tens of thousands of requests per second in a single process, which requires a dramatically lower runtime footprint than possible with a browser JavaScript engine. Lucet can instantiate WebAssembly modules in under 50 microseconds, with just a few kilobytes of memory overhead. By comparison, Chromium’s V8 engine takes about 5 milliseconds, and tens of megabytes of memory overhead, to instantiate JavaScript or WebAssembly programs.</p><p>With Lucet, Fastly’s edge cloud can execute tens of thousands of WebAssembly programs simultaneously, in the same process, without compromising security. The Lucet compiler and runtime work together to ensure each WebAssembly program is allowed access to only its own resources. This means that Fastly’s customers will be able to write and run programs in more common, general-purpose languages, without compromising the security and safety we’ve always offered.</p><p>Lucet separates responsibility for executing WebAssembly into two components: a compiler, which compiles WebAssembly modules to native code, and a runtime which manages resources and traps runtime faults. Lucet is designed for ahead-of-time (AOT) compilation of WebAssembly to native code, which dramatically simplifies the design and overhead of the runtime compared to the just-in-time (JIT) compilation strategy employed in browser engines.</p><h2>How we built Lucet</h2><p>Lucet is built on top of the&nbsp;<a href="https://github.com/CraneStation/cranelift">Cranelift code generator</a>. The Cranelift project was created by Mozilla for use in Firefox’s WebAssembly and JavaScript JIT engines, and presently can be enabled by a&nbsp;<a href="https://www.reddit.com/r/rust/comments/9mvnrk/in_firefox_nightly_an_option_has_arrived_to_use/">preference flag in Firefox Nightly</a>. We&nbsp;<a href="https://github.com/CraneStation/cranelift/graphs/contributors">contributed</a>&nbsp;to the design and implementation of Cranelift, and are excited that our efforts help make the web better for Firefox users as well.</p><p>Lucet supports the&nbsp;<a href="https://wasi.dev/">WebAssembly System Interface (WASI)</a>&nbsp;— a new proposed standard for safely exposing low-level interfaces to the filesystem, networking, and other system facilities to WebAssembly programs. The Lucet team has partnered with Mozilla and others on the design, implementation, and standardization of this system interface.</p><p>We’ve been working on this project behind the scenes since 2017, so we’re thrilled to finally make it public. Lucet also happens to be the first project started at Fastly using the&nbsp;<a href="https://www.rust-lang.org/">Rust programming language</a>, and we’re happy to report that Rust has been a huge success on this project. We found that new Rust users were able to become productive with the language quickly, and the library ecosystem provides many mature libraries for working with WebAssembly. Early in Lucet’s development, we implemented the first version of the runtime in C. However, we recently went back and translated the C runtime into Rust, and in the process, discovered and fixed several safety and concurrency bugs.</p><p>As the engine behind the Terrarium project, Lucet has gotten months of production testing, running many thousands of different WebAssembly programs since launching in late 2018. It has also been the subject of an in-depth third-party security assessment.</p><h2>A quick demo of Lucet</h2><p>First, clone the Lucet repository from GitHub.</p><pre><code>$ git clone --recurse-submodules https://github.com/fastly/lucet</code></pre><p>The&nbsp;<a href="https://github.com/fastly/lucet/blob/master/README.md">README</a>&nbsp;contains instructions on using Docker to setup a development environment. If you already have Docker installed, there is just one step. It may take a few minutes to complete building everything.</p><pre><code>$ cd lucet  
$ source devenv_setenv.sh</code></pre><p>Now, lets create a small C program, and use Clang to compile it to WebAssembly:</p><pre><code>$ mkdir demo
$ cd demo
$ cat &gt; hello.c &lt;&lt;EOT

#include &lt;stdio.h&gt;
int main(int argc, char* argv[])
{
    if (argc &gt; 1) {
            printf("Hello from Lucet, %s!\n", argv[1]);
    } else {
            puts("Hello, world!");
    }
    return 0;
}
EOT
$ wasm32-unknown-wasi-clang hello.c -o hello.wasm</code></pre><p>Now we can compile the WebAssembly to native code, using the Lucet compiler, configured for use with WASI:</p><pre><code>$ lucetc-wasi hello.wasm -o hello.so</code></pre><p>Finally, we can execute the native code using the Lucet runtime configured for use with WASI:</p><pre><code>$ lucet-wasi hello.so  
Hello, world!  
$ lucet-wasi hello.so world  
Hello from Lucet, world!</code></pre><p>Documentation and additional examples are available in the Lucet repository.</p><h2>Beyond the edge cloud</h2><p>We are excited to open source Lucet because of all the possibilities WebAssembly holds beyond the web browser and edge cloud. For instance, Lucet’s support for WASI is a big step towards WebAssembly programs that can run on whatever platform the user wants — in the cloud, at the edge, on the browser, or natively on your laptop or smartphone — all while keeping the same strong guarantees about security in place. We want to enable WebAssembly to thrive inside any program that allows scripting or extensions, while using fewer resources than current solutions built on dynamic languages, interpreters, and JIT compilers.</p><p>Most importantly, we want to collaborate with the open-source community on Lucet, Cranelift, WASI, and other WebAssembly-enabling technologies. Fastly is built on, and&nbsp;<a href="https://www.fastly.com/open-source">committed to supporting</a>, open source. Without it, we could never have built Lucet — and we hope that Lucet allows you to build new things that we haven’t even dreamed of.</p><div class="blog-authors"><h3><span>Author</span></h3><div class="author"><div class="bio"><p><a href="/blog/pat-hickey">Pat Hickey</a> | Sr. software engineer</p><p>Pat Hickey is a senior software engineer on Fastly’s isolation team. Previously, he worked on operating systems and compilers for safety-critical systems.</p></div></div></div><div class="related-articles" data-swiftype-index="false"><h3><span>You may also like:</span></h3><section class="section"><div class="cards"><span class="card"><article class="card__article"><div id="newsletter-form-container"><div id="newsletter-form-thanks"><p class="post-title">Subscribe to our newsletter</p><p class="post-meta">Thanks for subscribing</p></div></div></article></span><span class="card"><a href="/blog/join-the-beta-new-serverless-compute-environment-at-the-edge"><article class="card__article"><p class="post-title"> Join the beta: our new serverless compute environment gives you more power at the edge</p><p>Fastly is now offering access to its serverless compute environment in private beta. Meet Compute@Edge, a uniquely secure, performant, and scalable approach to serverless computing.
</p></article></a></span><span class="card"><a href="/blog/build-on-fastly-with-code-blocks-and-tutorials"><article class="card__article"><p class="post-title">Build on the edge with ready-to-deploy code</p><p>We’re introducing a new collection of tools built just for developers — gathered on one easy-to-search page — so you can discover, test, and deploy edge solutions in a faster, safer way. Filter through dozens…
</p></article></a></span><span class="card"><a href="/blog/webassembly-memory-management-guide-for-c-rust-programmers"><article class="card__article"><p class="post-title">Memory management in WebAssembly: guide for C and Rust programmers</p><p>Recently we launched Fastly Terrarium, a multi-language, browser-based editor and deployment platform where you can experiment with edge technology. Now, for those well-versed in C and Rust, we’ll explore WebAssembly memory management and implementation.
</p></article></a></span></div></section></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>