<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Accelerated KVM guests on WSL 2 - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Accelerated KVM guests on WSL 2 - linksfor.dev(s)"/>
    <meta property="article:author" content="sirredbeard"/>
    <meta property="og:description" content="The internet asked for this."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
	<div class="devring" style="background: #222">
		<div class="grid">
			<div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
				<span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
				<a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
				<a href="https://devring.club/random" class="devring-random">Random</a>
				<a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
			</div>
		</div>
	</div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Accelerated KVM guests on WSL 2</title>
<div class="readable">
        <h1>Accelerated KVM guests on WSL 2</h1>
            <div>by sirredbeard</div>
            <div>Reading time: 11-14 minutes</div>
        <div>Posted here: 15 Jun 2020</div>
        <p><a href="https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/">https://boxofcables.dev/accelerated-kvm-guests-on-wsl-2/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="site-main">
    <div>

        <article>

            

            <figure>
                <img srcset="/content/images/size/w300/2020/06/Annotation-2020-06-14-203251.png 300w,
                            /content/images/size/w600/2020/06/Annotation-2020-06-14-203251.png 600w,
                            /content/images/size/w1000/2020/06/Annotation-2020-06-14-203251.png 1000w,
                            /content/images/size/w2000/2020/06/Annotation-2020-06-14-203251.png 2000w" sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px" src="https://boxofcables.dev/content/images/size/w2000/2020/06/Annotation-2020-06-14-203251.png" alt="Accelerated KVM guests on WSL 2">
            </figure>

            <section>
                <div>
                    <p><strong>Requirements</strong></p><p>Windows 10 Insider Fast Ring, tested on build 19645.1<br><a href="https://ubuntu.com/blog/ubuntu-on-wsl-2-is-generally-available">Ubuntu 20.04 on WSL 2</a><br>An Intel Core i5+ CPU* <br>An X server for Windows, e.g. <a href="https://x410.dev/">X410</a> or <a href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a> (For now, native GUI support and GPU acceleration <a href="https://ubuntu.com/blog/new-gpu-and-gui-features-announced-for-wsl-at-build">is coming</a>!)<br>At least 16GB RAM<br>At least 40GB free hard drive space</p><p>*AMD users: WSL 2 runs in a lightweight Hyper-V platform on any edition of Windows 10. Hyper-V <a href="https://techcommunity.microsoft.com/t5/virtualization/amd-nested-virtualization-support/ba-p/1434841">just got AMD nested virtualization support</a>. They have said Linux KVM guest support is coming.</p><p><strong>Recommended</strong></p><p>Familiarity with building a Linux kernel**<br>Familiarity with KVM, QEMU, or virtualization technology<br><a href="https://github.com/microsoft/terminal">Windows Terminal</a> (Get it. It's fast!)</p><p>**If you are not ready to build Linux kernel modules but want to get started, check out my guide on <a href="https://boxofcables.dev/running-windows-2000-on-wsl/">running Windows 2000 with QEMU on WSL</a>.</p><p><strong>Update, upgrade, and install dependencies</strong></p><p>You have been regularly updating your WSL distro, right?</p><pre><code>sudo apt update &amp;&amp; sudo apt -y upgrade
sudo apt -y install build-essential libncurses-dev bison flex libssl-dev libelf-dev cpu-checker qemu-kvm aria2 </code></pre><p><strong>Get kernel sources</strong></p><p>You need a kernel. You could use any kernel, including one from your distro, but for simplicity I use the default Microsoft WSL terminal as a base.</p><p>There are more recent <a href="https://github.com/microsoft/WSL2-Linux-Kernel">WSL 2 kernels</a> available but I chose the one that is currently released for Windows 10 Fast Ring Insiders for simplicity, which is 4.19.104:</p><pre><code>aria2c -x 10 https://github.com/microsoft/WSL2-Linux-Kernel/archive/4.19.104-microsoft-standard.tar.gz
tar -xf 4.19.104-microsoft-standard.tar.gz
cd WSL2-Linux-Kernel-4.19.104-microsoft-standard/</code></pre><p>If you are reading this in the future, you can check your WSL 2 version number with:</p><pre><code>uname -r</code></pre><p>You can find all the WSL 2 kernel releases on <a href="https://github.com/microsoft/WSL2-Linux-Kernel/releases">GitHub</a>.</p><p>You could also use git to retrieve specific branches and tagged releases of the WSL 2 kernel.</p><p><strong>Optimize kernel config for KVM on WSL</strong></p><p>Start by borrowing the official WSL 2 kernel configuration:</p><pre><code>cp Microsoft/config-wsl .config</code></pre><p>Then let's customize it:</p><pre><code>make menuconfig</code></pre><p>Under Virtualization set KVM for Intel processor support to build as a module and enable built-in virtio net and vsock support:</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-12.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-12.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-12.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-12.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-12.png 2400w"></figure><p><strong>Important note about building a module in WSL</strong></p><p>Building KVM for Intel as a module &lt;M&gt; makes it easier to unload, tweak, and reload the module as needed, for example:</p><pre><code>sudo modprobe -r kvm_intel # removes the module

modprobe kvm_intel enable_apicv=0 # reloads the module with apicv disable</code></pre><p>This might be useful getting certain operating systems to run or finetune their performance.</p><p><em><strong>But </strong></em>it means you will have to load the module each time manually or add it to your .bashrc.</p><p><strong>If you don't want to do this</strong>, just leave KVM for Intel processors support as built-in &lt;*&gt;, and you can skip the make modules_install step below, but make sure you still add KVM guest support, configure kvm_intel in /etc/modprobe.d/kvm-nested.conf as described below.</p><p>Exit the Virtualization menu and then proceed to Processor type and features -&gt; Linux guest support enable built-in KVM guest support:</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-2.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-2.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-2.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-2.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-2.png 2400w"></figure><p>Exit and save as .config.</p><p><strong>Flags</strong></p><p>If you are 10x and too cool to use a GUI, you can edit your .config directly in vim:</p><pre><code>KVM_GUEST=y
CONFIG_KVM=y
CONFIG_KVM_INTEL=m
CONFIG_VHOST_NET=y
CONFIG_VHOST=y</code></pre><p><strong>Build the new kernel</strong></p><pre><code>make -j 8</code></pre><p>Sit back and watch a movie while you wait:</p><figure><div><p><iframe src="https://www.youtube.com/embed/JUt2nb0mgwg?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" name="fitvid0"></iframe></p></div></figure><p><strong>Install your kernel modules</strong></p><pre><code>sudo make modules_install</code></pre><p><strong>Install your kernel in WSL 2 and enable nested KVM</strong></p><pre><code>cp arch/x86/boot/bzImage /mnt/c/Users/&lt;username&gt;/bzImage
nano /mnt/c/Users/&lt;username&gt;/.wslconfig</code></pre><p><em>Paste</em>:</p><pre><code>[wsl2]
nestedVirtualization=true
kernel=C:\Users\&lt;username&gt;\bzImage</code></pre><p><strong>WSL 2 Settings Pro Tip</strong></p><ul><li><a href="https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configure-per-distro-launch-settings-with-wslconf">/etc/wsl.conf</a> manages your distro-specific WSL settings</li><li><a href="https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configure-global-options-with-wslconfig">%HOMEPATH%.wslconfig</a> manages for global WSL settings</li></ul><p><strong>Reboot WSL 2</strong></p><p>Close all open WSL instances. If you are using Windows Terminal just open a PowerShell terminal tab and close the other tabs. See, I told you to get Windows Terminal.</p><p>In a new PowerShell terminal:</p><pre><code>wsl.exe --shutdown Ubuntu</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-14.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-14.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-14.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-14.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-14.png 2400w"></figure><p>Re-open Ubuntu on WSL:</p><pre><code>wsl.exe -d Ubuntu</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-15.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-15.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-15.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-15.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-15.png 2400w"></figure><p><strong>Check you are running your new kernel</strong></p><pre><code>uname -ar</code></pre><p>should show today's date and the time should be a few minutes ago.</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-16.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-16.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-16.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-16.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-16.png 2400w"></figure><p><strong>Configure kvm-intel</strong></p><pre><code>nano /etc/modprobe.d/kvm-nested.conf</code></pre><p><em>Paste</em>:</p><pre><code>options kvm-intel nested=1
options kvm-intel enable_shadow_vmcs=1
options kvm-intel enable_apicv=1
options kvm-intel ept=1</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-3.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-3.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-3.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-3.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-3.png 2400w"></figure><p><strong>Load kernel module</strong></p><pre><code>sudo modprobe kvm_intel</code></pre><p>Test KVM with:</p><pre><code>kvm-ok</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-17.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-17.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-17.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-17.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-17.png 2400w"></figure><p>Check for nested KVM with:</p><pre><code>cat /sys/module/kvm_intel/parameters/nested</code></pre><p>should report "Y"</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-18.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-18.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-18.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-18.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-18.png 2400w"></figure><p><strong>Configure X for WSL 2</strong></p><p>Install X410 or VcXsrv and configure firewall settings to allow on Public network. I prefer X410 because it does it for you, but it costs about $10 USD in the Store. VcXsrc is free and open source but requires a bit more manual configuration Native GUI support <a href="https://ubuntu.com/blog/new-gpu-and-gui-features-announced-for-wsl-at-build">is coming</a>, more details later in 2020.</p><p>Once you are running X on Windows, redirect your WSL X output to Windows by setting the DISPLAY environmental variable:</p><pre><code>export DISPLAY=$(cat /etc/resolv.conf | grep nameserver | awk '{print $2; exit;}'):0.0</code></pre><p>You can add this command to ~/.bashrc to run every time you open Ubuntu WSL:</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-19.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-19.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-19.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-19.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-19.png 2400w"></figure><p><strong>Download an Ubuntu desktop install ISO</strong></p><p>Go back to your home folder, or make a folder inside WSL to keep this project (NOT on /mnt/c/ it will slow you down), and then download the nightly Ubuntu desktop install ISO with aria2:</p><pre><code>cd ~
aria2c -x 10 http://cdimage.ubuntu.com/daily-live/current/groovy-desktop-amd64.iso</code></pre><p>You can ISOs for Ubuntu 20.04 LTS (focal) and many of the official flavors <a href="http://cdimage.ubuntu.com/">here</a>.</p><p><strong>aria2</strong></p><p><a href="https://aria2.github.io/">aria2</a> is a next generation download utility.</p><p>Use aria2c in place of wget for all your downloads, add -x 10 to break the download up into 10 download threads, it speeds things up quite a bit.</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-20.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-20.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-20.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-20.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-20.png 2400w"></figure><p><strong>Create a qcow2 virtual hard drive for QEMU</strong></p><p>This will be our virtual hard drive for our Ubuntu . qcow2 is the default virtual hard drive container for QEMU, similar to .vhd, .vdi, .vmdk files.</p><pre><code>qemu-img create -f qcow2 ubuntu.qcow2 15G</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-21.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-21.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-21.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-21.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-21.png 2400w"></figure><p>The Ubuntu installer will detect the virtual drive, partition, install, and install a bootloader. If you are installing another distro or operating system you may need to manually format and partition as part of the install process.</p><p><strong>Boot from the ISO and install to the virtual hard drive</strong></p><p><a href="https://pastebin.ubuntu.com/p/GqHbMQSN99/">Pastebin</a></p><pre><code>qemu-system-x86_64 
	-drive file=ubuntu.qcow2,format=qcow2 
	-drive file=groovy-desktop-amd64.iso,media=cdrom,readonly 
	-net nic -net user 
	-m 5172 
	-vga qxl 
	--enable-kvm 
	-smp 4 
	-cpu kvm64,+vmx,+vme,+msr,+x2apic,+hypervisor,+aes,+vmx-activity-hlt,+vmx-cr3-load-noexit,+vmx-cr3-store-noexit,+vmx-cr8-load-exit,+vmx-cr8-store-exit,+vmx-desc-exit,+vmx-entry-ia32e-mode,+vmx-entry-load-efer,+vmx-entry-load-pat,+vmx-entry-noload-debugctl,+vmx-ept,+vmx-ept-1gb,+vmx-ept-2mb,+vmx-ept-execonly,+vmx-eptad,+vmx-exit-ack-intr,+vmx-exit-load-efer,+vmx-exit-load-pat,+vmx-exit-nosave-debugctl,+vmx-exit-save-efer,+vmx-exit-save-pat,+vmx-exit-save-preemption-timer,+vmx-flexpriority,+vmx-hlt-exit,+vmx-intr-exit,+vmx-invept,+vmx-invept-all-context,+vmx-invept-single-context,+vmx-invept-single-context,+vmx-invept-single-context-noglobals,+vmx-invlpg-exit,+vmx-invvpid,+vmx-invvpid-all-context,+vmx-invvpid-single-addr,+vmx-io-bitmap,+vmx-io-exit,+vmx-monitor-exit,+vmx-movdr-exit,+vmx-msr-bitmap,+vmx-mwait-exit,+vmx-nmi-exit,+vmx-page-walk-4,+vmx-pause-exit,+vmx-pml,+vmx-preemption-timer,+vmx-rdpmc-exit,+vmx-rdtsc-exit,+vmx-secondary-ctls,+vmx-shadow-vmcs,+vmx-store-lma,+vmx-true-ctls,+vmx-tsc-offset,+vmx-unrestricted-guest,+vmx-vintr-pending,+vmx-vmwrite-vmexit-fields,+vmx-vnmi,+vmx-vnmi-pending,+vmx-vpid,+de,+pse,+tsc,+msr,+pae,+mce,+cx8,+apic,+sep,+mtrr,+pge,+mca,+cmov,+pat,+pse36,+clflush,+mmx,+fxsr,+sse,+sse2,+ss,+ht,+syscall,+nx,+pdpe1gb,+rdtscp,+lm,+pni,+pclmulqdq,+vmx,+ssse3,+fma,+cx16,+pcid,+sse4_1,+sse4_2,+movbe,+popcnt,+aes,+xsave,+avx,+f16c,+rdrand,+hypervisor,+lahf_lm,+abm,+3dnowprefetch,+ssbd,+ibpb,+stibp,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid,+rdseed,+adx,+smap,+clflushopt,+xsaveopt,+xsavec,+xgetbv1,+xsaves 
</code></pre><figure><img src="https://boxofcables.dev/content/images/2020/06/image-7.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-7.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-7.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-7.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-7.png 2400w"></figure><p>Then follow normal Ubuntu installation steps:</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-9.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-9.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-9.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-9.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-9.png 2400w"></figure><figure><img src="https://boxofcables.dev/content/images/2020/06/image-11.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-11.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-11.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-11.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-11.png 2400w"></figure><p><strong>What is all this?</strong></p><p>This launches <a href="https://wiki.qemu.org/Main_Page">QEMU</a>, an open source system emulator/virtualizer. QEMU is a powerful tool I use often. One of my favorite uses is to emulate vintage hardware to run vintage operating systems. I wrote a guide to <a href="https://boxofcables.dev/running-windows-2000-on-wsl/">run Windows 2000</a> on WSL using QEMU. </p><p>Most of the flags, like mounting the virtual hard drive and ISO as a cdrom, are self explanatory.</p><p>For more, check the QEMU manual page:</p><figure><a href="https://manpages.debian.org/testing/qemu-system-common/qemu-system.1.en.html"><div><p>qemu-system(1) — qemu-system-common — Debian testing — Debian Manpages</p></div><p><img src="https://manpages.debian.org/openlogo-50.svg"></p></a></figure><p>There are more links to docs on WSL 2, QEMU. and KVM below.</p><p><em><strong>Why such a long CPU line though?</strong></em></p><p>None of the stock CPU types in QEMU matched well with the WSL environment so I started with a basic kvm64 and then added back all of the CPU flags supported in Hyper-V and then tested to see which of the vmx flags worked. VMX extensions are the Intel VT-x extensions to accelerate virtual machines.</p><p>After tweaking the kernel and exposing these CPU flags I found significant performance improvements in KVM on Ubuntu WSL and, much to my surprise, the ability to run nested-upon-nested KVM.</p><p><strong>Future boots</strong></p><p>You can omit the boot ISO line:</p><pre><code>drive file=groovy-desktop-arm64.iso,media=cdrom,readonly </code></pre><p>after you install Ubuntu to ubuntu.qcow2:</p><figure><img src="https://boxofcables.dev/content/images/2020/06/image-8.png" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/image-8.png 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/image-8.png 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/image-8.png 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/image-8.png 2400w"></figure><p><strong>Make a boot script</strong></p><pre><code>cd ~
nano boot_ubuntu_kvm.sh</code></pre><p>Paste:</p><pre><code>#!/bin/bash
qemu-system-x86_64 
	-drive file=ubuntu.qcow2,format=qcow2 
	-net nic -net user 
	-m 5172 
	-vga qxl 
	--enable-kvm 
	-smp 4 
	-cpu kvm64,+vmx,+vme,+msr,+x2apic,+hypervisor,+aes,+vmx-activity-hlt,+vmx-cr3-load-noexit,+vmx-cr3-store-noexit,+vmx-cr8-load-exit,+vmx-cr8-store-exit,+vmx-desc-exit,+vmx-entry-ia32e-mode,+vmx-entry-load-efer,+vmx-entry-load-pat,+vmx-entry-noload-debugctl,+vmx-ept,+vmx-ept-1gb,+vmx-ept-2mb,+vmx-ept-execonly,+vmx-eptad,+vmx-exit-ack-intr,+vmx-exit-load-efer,+vmx-exit-load-pat,+vmx-exit-nosave-debugctl,+vmx-exit-save-efer,+vmx-exit-save-pat,+vmx-exit-save-preemption-timer,+vmx-flexpriority,+vmx-hlt-exit,+vmx-intr-exit,+vmx-invept,+vmx-invept-all-context,+vmx-invept-single-context,+vmx-invept-single-context,+vmx-invept-single-context-noglobals,+vmx-invlpg-exit,+vmx-invvpid,+vmx-invvpid-all-context,+vmx-invvpid-single-addr,+vmx-io-bitmap,+vmx-io-exit,+vmx-monitor-exit,+vmx-movdr-exit,+vmx-msr-bitmap,+vmx-mwait-exit,+vmx-nmi-exit,+vmx-page-walk-4,+vmx-pause-exit,+vmx-pml,+vmx-preemption-timer,+vmx-rdpmc-exit,+vmx-rdtsc-exit,+vmx-secondary-ctls,+vmx-shadow-vmcs,+vmx-store-lma,+vmx-true-ctls,+vmx-tsc-offset,+vmx-unrestricted-guest,+vmx-vintr-pending,+vmx-vmwrite-vmexit-fields,+vmx-vnmi,+vmx-vnmi-pending,+vmx-vpid,+de,+pse,+tsc,+msr,+pae,+mce,+cx8,+apic,+sep,+mtrr,+pge,+mca,+cmov,+pat,+pse36,+clflush,+mmx,+fxsr,+sse,+sse2,+ss,+ht,+syscall,+nx,+pdpe1gb,+rdtscp,+lm,+pni,+pclmulqdq,+vmx,+ssse3,+fma,+cx16,+pcid,+sse4_1,+sse4_2,+movbe,+popcnt,+aes,+xsave,+avx,+f16c,+rdrand,+hypervisor,+lahf_lm,+abm,+3dnowprefetch,+ssbd,+ibpb,+stibp,+fsgsbase,+bmi1,+avx2,+smep,+bmi2,+erms,+invpcid,+rdseed,+adx,+smap,+clflushopt,+xsaveopt,+xsavec,+xgetbv1,+xsaves 
</code></pre><p>Exit and save.</p><p>Mark the file executable:</p><pre><code>sudo chmod u+x boot_ubuntu_kvm.sh</code></pre><p>Now it can be run as:</p><pre><code>./boot_ubuntu_kvm.sh</code></pre><p><strong>Other Distros</strong></p><p>You can create as many different qcow2 virtual hard drives as you have space for and install different distros on each. For other distros just create a new qcow2 file, download the bootable ISO (use aria again to speed it up, tip: aria works on .torrent files too!), mount both in your qemu options, and install onto the virtual hard drive.</p><p><strong>Other Operating Systems</strong></p><figure><img src="https://boxofcables.dev/content/images/2020/06/EYQBisWWkAEdxPX.jpg" srcset="https://boxofcables.dev/content/images/size/w600/2020/06/EYQBisWWkAEdxPX.jpg 600w, https://boxofcables.dev/content/images/size/w1000/2020/06/EYQBisWWkAEdxPX.jpg 1000w, https://boxofcables.dev/content/images/size/w1600/2020/06/EYQBisWWkAEdxPX.jpg 1600w, https://boxofcables.dev/content/images/size/w2400/2020/06/EYQBisWWkAEdxPX.jpg 2400w"></figure><p>Haiku</p><ul><li>Download an ISO from the <a href="https://download.haiku-os.org/nightly-images/x86_64/">nightly images</a>.</li><li>Follow the approach used above.</li></ul><p>macOS</p><ul><li>You must comply with the terms of the macOS EULA.</li><li>Once the KVM configuration above is in place, <a href="https://github.com/foxlet/macOS-Simple-KVM">this works</a> quite well.</li><li>In basic.sh usb-tablet works better than usb-mouse.</li></ul><p><strong>Additional Reading</strong></p><figure><a href="https://github.com/sirredbeard/Awesome-WSL"><div><p>sirredbeard/Awesome-WSL</p><p>Awesome list dedicated to Windows Subsystem for Linux - sirredbeard/Awesome-WSL</p><p><img src="https://github.githubassets.com/favicons/favicon.svg"><span>GitHub</span></p></div><p><img src="https://avatars3.githubusercontent.com/u/33820650?s=400&amp;v=4"></p></a></figure><figure><a href="https://www.qemu.org/docs/master/system/index.html"><div><p>QEMU System Emulation User’s Guide — QEMU 5.0.50 (v5.0.0-1244-g7d3660e798) documentation</p><p><span>QEMU</span></p></div></a></figure><figure><a href="https://wiki.archlinux.org/index.php/QEMU"><div><p>QEMU - ArchWiki</p><p><img src="https://wiki.archlinux.org/favicon.ico"><span>ArchWiki</span></p></div><p><img src="https://wiki.archlinux.org/images/c/c9/Merge-arrows-2.png"></p></a></figure><figure><a href="https://www.linux-kvm.org/page/Nested_Guests"><div><p>Nested Guests - KVM</p><p><img src="https://www.linux-kvm.org/favicon.ico"><span>KVM</span></p></div><p><img src="https://www.linux-kvm.org/kvmless/kvmbanner-logo3.png"></p></a></figure><figure><a href="https://wiki.ubuntu.com/WSL"><div><p>WSL - Ubuntu Wiki</p><p><span>Ubuntu Wiki</span></p></div></a></figure><figure><blockquote><a href="https://microhobby.com.br/blog/2019/09/21/compiling-your-own-linux-kernel-for-windows-wsl2/">Compiling Your Own Linux Kernel for Windows? WSL 2</a></blockquote>
</figure>
                </div>
            </section>



        </article>

    </div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>