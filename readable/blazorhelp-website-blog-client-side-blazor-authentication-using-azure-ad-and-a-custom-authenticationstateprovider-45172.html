<!DOCTYPE html>
<html lang="en">
<head>
    <title>
BlazorHelp Website &gt; Blog - Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="BlazorHelp Website &gt; Blog - Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider - linksfor.dev(s)"/>
    <meta property="article:author" content="Written by:&#xA;   Michael Washington"/>
    <meta property="og:description" content="Microsoft Visual Studio Blazor"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4370/Client-Side-Blazor-Authentication-Using-Azure-AD-and-a-Custom-AuthenticationStateProvider.aspx"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - BlazorHelp Website &gt; Blog - Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</title>
<div class="readable">
        <h1>BlazorHelp Website &gt; Blog - Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</h1>
            <div>by Written by:&#xA;   Michael Washington</div>
            <div>Watching time: 20-25 minutes</div>
        <div>Posted here: 22 Dec 2019</div>
        <p><a href="http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4370/Client-Side-Blazor-Authentication-Using-Azure-AD-and-a-Custom-AuthenticationStateProvider.aspx">http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4370/Client-Side-Blazor-Authentication-Using-Azure-AD-and-a-Custom-AuthenticationStateProvider.aspx</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
 <!-- Begin Blog Entry Title -->
 
 <!-- End Blog Entry Title -->
 <!-- Begin Blog Sub Head -->
 <acronym title="12/22/2019 9:39 AM"><span>
  <span id="dnn_ctr382_MainView_ViewEntry_lblEntryMonth">Dec</span>
 </span><span>
  <span id="dnn_ctr382_MainView_ViewEntry_lblEntryDay">22</span>
 </span></acronym>
 <p>
  
  <br>
  <span id="dnn_ctr382_MainView_ViewEntry_lblDateTime">12/22/2019 9:39 AM</span>&nbsp;
  <a id="dnn_ctr382_MainView_ViewEntry_lnkRss" href="http://blazorhelpwebsite.com/Blog/tabid/61/rssid/1/Default.aspx" target="_blank"><img id="dnn_ctr382_MainView_ViewEntry_lnkRssIcon" src="http://blazorhelpwebsite.com/desktopmodules/Blog/Images/feed-icon-12x12.gif" alt="RssIcon"></a>
 </p>
 <!-- End Blog Sub Head -->
 
 <!-- Begin Blog Entry -->
 
   <p><img src="http://blazorhelpwebsite.com/images/BlazorClientADAnimation.gif"></p>  <p>You can easily implement <strong>authentication</strong> for your <strong>Client Side</strong> <strong>Blazor</strong> applications using <strong>Azure Active Directory</strong>. </p>  <p>We do this by <a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/?view=aspnetcore-3.1&amp;tabs=visual-studio#implement-a-custom-authenticationstateprovider">Implementing a custom AuthenticationStateProvider</a>.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_56546721-92f4-4f70-9055-f03f2c80add2.png" width="579" height="174"></p>  <p>When we navigate to the <strong>Fetch data</strong> page, without being <em>logged in</em>, it will indicate that you <strong>Must be logged in</strong>.</p>  <p>To <em>log in</em>, click the <strong>Log In</strong> link.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_3110380a-cab6-444b-ba44-5c35c3263827.png" width="575" height="288"></p>  <p>You can <em>log in</em> with an <strong>Azure Active Directory</strong> account that has <a href="https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/developer-guidance-for-integrating-applications">authorization to log into the Azure registered application</a>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_46165413-910c-4633-95ef-c5c82093bab6.png" width="577" height="328"></p>  <p>Once the user is <em>logged in</em>, navigating to the <strong>Fetch data</strong> page displays the data.</p>  <p>The <strong>logged in userâ€™s name</strong> is also <em>displayed</em> at the top of the application.</p>      <p>See the following directions to install <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/hosting-models?view=aspnetcore-3.1#blazor-webassembly">Blazor WebAssembly</a> (<strong>Client Side Blazor</strong>):</p>  <p><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/get-started?view=aspnetcore-3.1&amp;tabs=visual-studio">https://docs.microsoft.com/en-us/aspnet/core/blazor/get-started?view=aspnetcore-3.1&amp;tabs=visual-studio</a></p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_8052552d-b995-4580-9372-7e07f3f3fc5d.png" width="80" height="92"></p>  <p>Open <a href="https://www.visualstudio.com/vs/">Visual Studio 2019</a> (or higher).</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_62aa192b-1667-4d55-baaf-859cfed1288e.png" width="373" height="106"></p>  <p>Create a <strong>new project</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_f2a9a18a-8682-46b2-a5ca-8e3d8020bb8d.png" width="535" height="121"></p>  <p>Select <strong>Blazor App</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_58c6fd09-500a-4ef6-b0be-83e62bc0e1f4.png" width="506" height="338"></p>  <p>Name the project <strong>BlazorClientAD</strong></p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_2e9f5c29-5a91-482a-a291-26d6d4c06661.png" width="707" height="462"></p>  <p>Select the <strong>ASP.NET 3.1 (or higher) Blazor WebAssembly</strong> template and select <strong>ASP.NET Core hosted</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_92a78e52-5e94-4fc7-b6bf-472e0f15f72a.png" width="260" height="476"></p>  <p>The <strong>Solution</strong> will be created.</p>  <p>Open the <strong>launchSettings.json</strong> file.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_c6a98d8f-81fe-4697-aa18-07bb287ac632.png" width="500" height="323"></p>  <p>Note the <strong>sslPort</strong>. </p>  <p>You will need it in the next section.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_f607f0af-846b-485d-a27e-18eb954bb832.png" width="180" height="34"></p>  <p>You will need a <a href="https://azure.microsoft.com/en-us/free">free Azure Account</a> for the following steps.</p>  <p>Log into <a href="https://portal.azure.com/">https://portal.azure.com/</a> and select the <strong>Azure Active Directory</strong> node.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_c41b39f5-170c-4bcd-8598-47c92330743f.png" width="154" height="44"></p>  <p>Next, select <strong>App registrations</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_70c5a31e-f6b9-42a4-a3ad-f213861e0c4e.png" width="156" height="38"></p>  <p>Select <strong>New registration</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_63db6bf7-89ff-4a5b-b6fa-97569405ca6a.png" width="555" height="524"></p>  <p>Create a <strong>Registration</strong>.</p>  <p>For <strong>Redirect URI</strong>, select <strong>Web</strong>, and use the following url (<em>replacing</em> {<span>your sslPort</span>} with the number you copied earlier):</p>  <blockquote>   <p>https://localhost:{<span>your sslPort</span>}/signin-oidc</p> </blockquote>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_420c30b2-2619-4a81-b24c-f43a9b90ac95.png" width="662" height="310"></p>  <p>On the <strong>Overview</strong> node for the application, <em>copy</em> the <strong>Application (client) ID</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_7ff065d9-b994-4de6-82e3-2e02f237a621.png" width="742" height="270"></p>  <p>Click on the <strong>Authentication</strong> node and enable <strong>ID Tokens</strong>.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_d0e0a0f8-458a-486d-9449-d03b5c93b518.png" width="262" height="475"></p>  <p>Return to <strong>Visual Studio</strong>, and add a <strong>appsettings.json</strong> file to the <strong>Server</strong> project using the following code (replacing <span>{Your Application (client ID)}</span> with the <strong>ID</strong> you copied in the previous step):</p>    <pre><pre>{
</pre><pre>  "<span>AzureAd</span>": {
</pre><pre>    "Instance": "https://login.microsoftonline.com/common",
</pre><pre>    "ClientId": "<span>{Your Application (client) ID}</span>",
</pre><pre>    "<span>CallbackPath</span>": "/<span>signin-oidc</span>"
</pre><pre>  },
</pre><pre>  "<span>Logging</span>": {
</pre><pre>    "<span>LogLevel</span>": {
</pre><pre>      "Default": "Information",
</pre><pre>      "Microsoft": "Warning",
</pre><pre>      "Microsoft.Hosting.Lifetime": "Information"
</pre><pre>    }
</pre><pre>  },
</pre><pre>  "<span>AllowedHosts</span>": "*"
</pre><pre>}</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_8c75ce21-6313-42e0-83af-f6d1e807aca3.png" width="376" height="225"></p>

<p><em>Right-click</em> on the <strong>Server</strong> project and select <strong>Manage NuGet Packagesâ€¦</strong></p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_b91b62b3-939e-4eb0-abd9-997b198b469a.png" width="707" height="213"></p>

<p>Install:</p>

<blockquote>
  <p>Microsoft.AspNetCore.Authentication.AzureAD.UI</p>
</blockquote>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_1845272e-8f7b-47d1-a833-0697e9bd0094.png" width="298" height="327"></p>

<p><em>Right-click</em> on the <strong>Client </strong>project and select <strong>Manage NuGet Packagesâ€¦</strong></p>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_f2d8b3c1-e2d8-4e75-b613-00a54f81a115.png" width="770" height="166"></p>

<p>Install:</p>

<blockquote>
  <p>Microsoft.AspNetCore.Components.Authorization</p>
</blockquote>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_0caf410d-1836-43e8-ba6f-651835644fd0.png" width="217" height="166"></p>

<p>Open the <strong>Startup.cs</strong> file in the <strong>Server</strong> project.</p>



<p>Add the following <strong>using statements</strong>:</p>



<pre><pre><span>using</span> Microsoft.IdentityModel.Tokens;
</pre><pre><span>using</span> Microsoft.Extensions.Configuration;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication.AzureAD.UI;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication.OpenIdConnect;
</pre><pre><span>using</span> System.Threading.Tasks;</pre></pre>



<p>Add the following to the <strong>top</strong> of the class:</p>



<pre><pre>        <span>public</span> IConfiguration Configuration { <span>get</span>; }
</pre><pre>        <span>public</span> Startup(IConfiguration configuration)
</pre><pre>        {
</pre><pre>            Configuration = configuration;
</pre><pre>        }</pre></pre>



<p>Add the following to the end of the <strong>ConfigureServices</strong> section:</p>



<pre><pre>services.AddAuthentication(AzureADDefaults.AuthenticationScheme)
</pre><pre>    .AddAzureAD(options =&gt; Configuration.Bind("<span>AzureAd</span>", options));
</pre><pre></pre><pre>services.Configure&lt;OpenIdConnectOptions&gt;(AzureADDefaults.OpenIdScheme,
</pre><pre>options =&gt;
</pre><pre>{
</pre><pre>    options.TokenValidationParameters = <span>new</span> TokenValidationParameters
</pre><pre>    {
</pre><pre>        <span>// Instead of using the default validation (validating against a </span>
</pre><pre>        <span>// single issuer value, as we do in</span>
</pre><pre>        <span>// line of business apps), we inject our own multitenant </span>
</pre><pre>        <span>// validation logic</span>
</pre><pre>        ValidateIssuer = <span>false</span>,
</pre><pre></pre><pre>        <span>// If the app is meant to be accessed by entire organizations, </span>
</pre><pre>        <span>// add your issuer validation logic here.</span>
</pre><pre>        <span>// IssuerValidator = </span>
</pre><pre>        <span>// (issuer, securityToken, validationParameters) =&gt; {</span>
</pre><pre>        <span>//    if (myIssuerValidationLogic(issuer)) return issuer;</span>
</pre><pre>        <span>//}</span>
</pre><pre>    };
</pre><pre></pre><pre>    options.Events = <span>new</span> OpenIdConnectEvents
</pre><pre>    {
</pre><pre>        OnTicketReceived = context =&gt;
</pre><pre>        {
</pre><pre>            <span>// This is called on successful authentication</span>
</pre><pre>            <span>// This is an opportunity to write to the database </span>
</pre><pre>            <span>// or alter internal roles ect.</span>
</pre><pre>            <span>return</span> Task.CompletedTask;
</pre><pre>        },
</pre><pre>        OnAuthenticationFailed = context =&gt;
</pre><pre>        {
</pre><pre>            context.Response.Redirect("<span>/Error</span>");
</pre><pre>            context.HandleResponse(); <span>// Suppress the exception</span>
</pre><pre>            <span>return</span> Task.CompletedTask;
</pre><pre>        }
</pre><pre>    };
</pre><pre>});</pre></pre>



<p>Add the following to the <strong>Configure</strong> section (under the <strong>UseRouting()</strong> line):</p>



<pre><pre>            app.UseAuthentication();
</pre><pre>            app.UseAuthorization();</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_5c3cfe6a-2ce6-46d0-8c9d-2ac96b0dc586.png" width="268" height="474"></p>

<p>In the <strong>Client</strong> project, open the <strong>_Imports.razor</strong> file and <u><strong>add</strong></u> the following lines:</p>



<pre><pre>@<span>using</span> Microsoft.AspNetCore.Authorization
</pre><pre>@<span>using</span> Microsoft.AspNetCore.Components.Authorization</pre></pre>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_55dd5e17-3557-4df1-bcd6-0c6ea2c7edb1.png" width="269" height="491"></p>

<p>All security <em>must be enforced</em> in the <strong>Server</strong> project.</p>

<p>Add a file called <strong>BlazorUser.cs</strong> using the following code:</p>



<pre><pre><span>using</span> System;
</pre><pre><span>using</span> System.Collections.Generic;
</pre><pre><span>using</span> System.Text;
</pre><pre></pre><pre><span>namespace</span> BlazorClientAD.Shared
</pre><pre>{
</pre><pre>    <span>public</span> <span>class</span> BlazorUser
</pre><pre>    {
</pre><pre>        <span>public</span> <span>string</span> UserName { <span>get</span>; <span>set</span>; }
</pre><pre>    }
</pre><pre>}</pre></pre>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_223956bc-2d96-4d2b-b71e-65cfdc2f828b.png" width="250" height="187"></p>

<p>Add a file to the <strong>Controllers</strong> folder in the <strong>Server</strong> project called <strong>UserController.cs</strong> using the following code:</p>



<pre><pre><span>using</span> BlazorClientAD.Shared;</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc;</pre><pre></pre><pre><span>namespace</span> BlazorClientAD.Server.Controllers</pre><pre>{</pre><pre>    [ApiController]</pre><pre>    <span>public</span> <span>class</span> UserController : Controller</pre><pre>    {</pre><pre>        [HttpGet("<span>api/user/GetUser</span>")]</pre><pre>        <span>public</span> BlazorUser GetUser()</pre><pre>        {</pre><pre>            BlazorUser objBlazorUser = <span>new</span> BlazorUser();</pre><pre></pre><pre>            <span>if</span> (<span>this</span>.User.Identity.IsAuthenticated)
</pre><pre>            {
</pre><pre>                objBlazorUser.UserName = <span>this</span>.User.Identity.Name;
</pre><pre>            }</pre><pre>            <span>else</span>
</pre><pre>            {
</pre><pre>                objBlazorUser.UserName = "<span></span>"; <span>// Not logged in</span>
</pre><pre>            }</pre><pre></pre><pre>            <span>return</span> objBlazorUser;</pre><pre>        }</pre><pre>    }</pre><pre>}</pre></pre>



<p>This code provides a method for the<strong> Blazor client </strong>side <strong>custom authentication provider</strong> (that we will create later), to determine if the user is <em>logged in</em>.</p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_c032e04a-eb64-47df-84a2-a873fbd66e3a.png" width="255" height="190"></p>

<p>In the <strong>Controllers</strong> folder in the <strong>Server</strong> project, open the <strong>WeatherForecastController.cs</strong> file and add the following <em>using statement</em>:</p>



<pre><pre><span>using</span> Microsoft.AspNetCore.Authorization;</pre></pre>



<p>Add the following above the <em><strong>public IEnumerable&lt;WeatherForecast&gt; Get()</strong></em> method:</p>



<pre><pre>        [Authorize]</pre></pre>



<p>This will prevent <em>non-authenticated users</em> from calling this method.</p>

<p>This is where we are implementing the required <strong>server side security</strong> that <u>cannot</u> be <em>bypassed</em> by a user manipulating <strong>client side</strong> code in the <strong>Blazor WebAssembly</strong> project.</p>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_e3e660f0-8190-46f7-8e7b-a30e02e33998.png" width="284" height="412"></p>

<p>In the <strong>Client</strong> project, create a <strong>Util</strong> folder and a file called <strong>CustomAuthenticationProvider.cs</strong> with the following code:</p>



<pre><pre><span>using</span> BlazorClientAD.Shared;
</pre><pre><span>using</span> Microsoft.AspNetCore.Components;
</pre><pre><span>using</span> Microsoft.AspNetCore.Components.Authorization;
</pre><pre><span>using</span> System.Net.Http;
</pre><pre><span>using</span> System.Security.Claims;
</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre></pre><pre><span>namespace</span> BlazorClientAD</pre><pre>{</pre><pre>    <span>public</span> <span>class</span> CustomAuthenticationProvider : AuthenticationStateProvider</pre><pre>    {
</pre><pre>        <span>private</span> <span>readonly</span> HttpClient _httpClient;
</pre><pre></pre><pre>        <span>public</span> CustomAuthenticationProvider(HttpClient httpClient)
</pre><pre>        {
</pre><pre>            _httpClient = httpClient;
</pre><pre>        }</pre><pre></pre><pre>        <span>public</span> <span>override</span> async Task&lt;AuthenticationState&gt;
</pre><pre>            GetAuthenticationStateAsync()</pre><pre>        {
</pre><pre>            ClaimsPrincipal user;
</pre><pre></pre><pre>            <span>// Call the GetUser method to get the status</span>
</pre><pre>            <span>// This only sets things like the AuthorizeView</span>
</pre><pre>            <span>// and the AuthenticationState CascadingParameter</span>
</pre><pre>            var result =
</pre><pre>                await _httpClient.GetJsonAsync&lt;BlazorUser&gt;("<span>api/user/GetUser</span>");
</pre><pre></pre><pre>            <span>// Was a UserName returned?</span>
</pre><pre>            <span>if</span> (result.UserName != "<span></span>")
</pre><pre>            {
</pre><pre>                <span>// Create a ClaimsPrincipal for the user</span>
</pre><pre>                var identity = <span>new</span> ClaimsIdentity(<span>new</span>[]
</pre><pre>                {
</pre><pre>                   <span>new</span> Claim(ClaimTypes.Name, result.UserName),
</pre><pre>                }, "<span>AzureAdAuth</span>");
</pre><pre></pre><pre>                user = <span>new</span> ClaimsPrincipal(identity);
</pre><pre>            }
</pre><pre>            <span>else</span>
</pre><pre>            {
</pre><pre>                user = <span>new</span> ClaimsPrincipal(); <span>// Not logged in</span>
</pre><pre>            }
</pre><pre></pre><pre>            <span>return</span> await Task.FromResult(<span>new</span> AuthenticationState(user));</pre><pre>        }</pre><pre>    }</pre><pre>}</pre><pre></pre></pre>



<p>The purpose of this code is to call the <strong>GetUser</strong> method, created earlier, to determine if the user is <em>logged in</em>.</p>

<p>If the user is <em>logged in</em>, it creates a <strong>ClaimsPrincipal</strong> with a <strong>user</strong>, otherwise it creates a <strong>ClaimsPrincipal</strong> without a <strong>user</strong>. The <strong>Blazor</strong> security knows that a <strong>ClaimsPrincipal</strong> with a <strong>user</strong> indicates that a <strong>user</strong> is <em>logged in</em>.</p>

<p>In the next step, this class will be registered as the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/?view=aspnetcore-3.1&amp;tabs=visual-studio#authenticationstateprovider-service">AuthenticationStateProvider</a>, and the <strong>Blazor</strong> security will allow us to <em>show</em> and <em>hide</em> elements using the <em>built-in authentication</em> <strong>tags</strong> and <strong>interfaces</strong>.</p>

<p>See this <strong>video</strong>: <a href="https://youtu.be/dCgqTDki-VM?t=1777">Blazor in more depth - Steve Sanderson &amp; Ryan Nowak</a> for a detailed explanation of exactly how this works.</p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_675273c3-55db-4fb8-a061-65c26d243e90.png" width="283" height="360"></p>

<p>In the <strong>Client</strong> project, open the <strong>Program.cs</strong> file, and replace <em>all the code</em> with the following:</p>



<pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre><span>using</span> Microsoft.AspNetCore.Blazor.Hosting;
</pre><pre><span>using</span> Microsoft.Extensions.DependencyInjection;
</pre><pre><span>using</span> Microsoft.AspNetCore.Components.Authorization;
</pre><pre></pre><pre><span>namespace</span> BlazorClientAD.Client
</pre><pre>{
</pre><pre>    <span>public</span> <span>class</span> Program
</pre><pre>    {
</pre><pre>        <span>public</span> <span>static</span> async Task Main(<span>string</span>[] args)
</pre><pre>        {
</pre><pre>            var builder = WebAssemblyHostBuilder.CreateDefault(args);
</pre><pre></pre><pre>            <span>// Use our CustomAuthenticationProvider as the </span>
</pre><pre>            <span>// AuthenticationStateProvider</span>
</pre><pre>            builder.Services.AddScoped&lt;AuthenticationStateProvider,
</pre><pre>                CustomAuthenticationProvider&gt;();
</pre><pre></pre><pre>            <span>// Add Authentication support</span>
</pre><pre>            builder.Services.AddOptions();
</pre><pre>            builder.Services.AddAuthorizationCore();
</pre><pre></pre><pre>            builder.RootComponents.Add&lt;App&gt;("<span>app</span>");
</pre><pre></pre><pre>            await builder.Build().RunAsync();
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_17c80582-aa81-4539-91be-06332c05f1f1.png" width="269" height="343"></p>

<p>In the <strong>Client</strong> project, open the <strong>App.razor</strong> file and add <em>replace all the code</em> with the following:</p>



<pre><pre><span>&lt;</span><span>Router</span> <span>AppAssembly</span>=<span>"@typeof(Program).Assembly"</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>Found</span> <span>Context</span>=<span>"routeData"</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>AuthorizeRouteView</span> <span>RouteData</span>=<span>"@routeData"</span> <span>DefaultLayout</span>=<span>"@typeof(MainLayout)"</span> <span>/&gt;</span>
</pre><pre>    <span>&lt;/</span><span>Found</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>NotFound</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>CascadingAuthenticationState</span><span>&gt;</span>
</pre><pre>            <span>&lt;</span><span>LayoutView</span> <span>Layout</span>=<span>"@typeof(MainLayout)"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>p</span><span>&gt;</span>Sorry, there's nothing at this address.<span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>LayoutView</span><span>&gt;</span>
</pre><pre>        <span>&lt;/</span><span>CascadingAuthenticationState</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>NotFound</span><span>&gt;</span>
</pre><pre><span>&lt;/</span><span>Router</span><span>&gt;</span></pre></pre>



<p>This will <a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/?view=aspnetcore-3.1&amp;tabs=visual-studio#authorization-in-blazor-webassembly-apps">implement authentication in the routing</a>.</p>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_b37bdc6c-5efb-40a4-b001-b3258aa2b396.png" width="272" height="404"></p>

<p>In the <strong>Client</strong> project, add a <strong>LoginDisplay.razor</strong> file to the <strong>Shared</strong> directory using the following code:</p>



<pre><pre><span>&lt;</span><span>AuthorizeView</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>Authorized</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>h6</span><span>&gt;</span>Hello, @context.User.Identity.Name! <span>&lt;/</span><span>h6</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>a</span> <span>href</span>=<span>"AzureAD/Account/SignOut"</span><span>&gt;</span>[Log out]<span>&lt;/</span><span>a</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>Authorized</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>a</span> <span>href</span>=<span>"AzureAD/Account/SignIn"</span><span>&gt;</span>[Log in]<span>&lt;/</span><span>a</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre><span>&lt;/</span><span>AuthorizeView</span><span>&gt;</span></pre></pre>



<p>Notice this directs the user to <em>endpoints</em> that begin with <em>AzureAD/Account</em>.</p>

<p>These endpoints will be serviced by code from the <em>Microsoft.AspNetCore.Authentication.AzureAD.UI</em> <strong>NuGet package</strong> that was installed earlier.</p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_f44903b7-ae7f-4d8e-b58a-eaaaa09d4a23.png" width="261" height="403"></p>

<p>In the <strong>Client</strong> project, open the <strong>MainLayout.razor</strong> file and add <em>replace all the code</em> with the following:</p>



<pre><pre><span>@</span>inherits LayoutComponentBase
</pre><pre></pre><pre><span>&lt;</span><span>div</span> <span>class</span>=<span>"sidebar"</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>NavMenu</span> <span>/&gt;</span>
</pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre></pre><pre><span>&lt;</span><span>div</span> <span>class</span>=<span>"main"</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>div</span> <span>class</span>=<span>"top-row px-4"</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>LoginDisplay</span> <span>/&gt;</span>
</pre><pre>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre></pre><pre>    <span>&lt;</span><span>div</span> <span>class</span>=<span>"content px-4"</span><span>&gt;</span>
</pre><pre>        <span>@</span>Body
</pre><pre>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre><span>&lt;/</span><span>div</span><span>&gt;</span></pre></pre>



<p>This adds the <strong>LoginDisplay </strong>control to the top of the page in the application.</p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_cdf8254a-4f49-421e-8d9e-31f3c809bc30.png" width="256" height="391"></p>

<p>In the <strong>Client</strong> project, open the <strong>Index.razor</strong> file in the <strong>Pages</strong> directory, and add the following to the top of the file:</p>



<pre><pre><span>@</span>page "<span>/Account/SignOut</span>"</pre></pre>



<p>When the user <em>logs out</em> of the application, the user will be sent to the <em>Account/SignOut</em> url. This code allows the <strong>Index.razor</strong> page to also service that destination.</p>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4370/Windows-Live-Writer-d1e22ca31329_1218A-image_be80f2e5-10c6-4523-b4a7-fd824efffc5b.png" width="260" height="391"></p>

<p>Finally, in the <strong>Client</strong> project, open the <strong>FetchData.razor</strong> file, in the <strong>Pages</strong> directory, and add <em>replace all the code</em> with the following:</p>



<pre><pre>@page "<span>/fetchdata</span>"
</pre><pre>@<span>using</span> BlazorClientAD.Shared
</pre><pre>@inject HttpClient Http</pre></pre>

<pre><pre><span>&lt;</span><span>h1</span><span>&gt;</span>Weather forecast<span>&lt;/</span><span>h1</span><span>&gt;</span>
</pre><pre></pre><pre><span>&lt;</span><span>p</span><span>&gt;</span>This component demonstrates fetching data from the server.<span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre><span>&lt;</span><span>AuthorizeView</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>Authorized</span><span>&gt;</span>
</pre><pre>        @if (forecasts == null)
</pre><pre>        {
</pre><pre>            <span>&lt;</span><span>p</span><span>&gt;</span><span>&lt;</span><span>em</span><span>&gt;</span>Loading...<span>&lt;/</span><span>em</span><span>&gt;</span><span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre>        }
</pre><pre>        else
</pre><pre>        {
</pre><pre>            <span>&lt;</span><span>table</span> <span>class</span>=<span>"table"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>thead</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>tr</span><span>&gt;</span>
</pre><pre>                        <span>&lt;</span><span>th</span><span>&gt;</span>Date<span>&lt;/</span><span>th</span><span>&gt;</span>
</pre><pre>                        <span>&lt;</span><span>th</span><span>&gt;</span>Temp. (C)<span>&lt;/</span><span>th</span><span>&gt;</span>
</pre><pre>                        <span>&lt;</span><span>th</span><span>&gt;</span>Temp. (F)<span>&lt;/</span><span>th</span><span>&gt;</span>
</pre><pre>                        <span>&lt;</span><span>th</span><span>&gt;</span>Summary<span>&lt;/</span><span>th</span><span>&gt;</span>
</pre><pre>                    <span>&lt;/</span><span>tr</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>thead</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>tbody</span><span>&gt;</span>
</pre><pre>                    @foreach (var forecast in forecasts)
</pre><pre>                    {
</pre><pre>                        <span>&lt;</span><span>tr</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>td</span><span>&gt;</span>@forecast.Date.ToShortDateString()<span>&lt;/</span><span>td</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>td</span><span>&gt;</span>@forecast.TemperatureC<span>&lt;/</span><span>td</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>td</span><span>&gt;</span>@forecast.TemperatureF<span>&lt;/</span><span>td</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>td</span><span>&gt;</span>@forecast.Summary<span>&lt;/</span><span>td</span><span>&gt;</span>
</pre><pre>                        <span>&lt;/</span><span>tr</span><span>&gt;</span>
</pre><pre>                    }
</pre><pre>                <span>&lt;/</span><span>tbody</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>table</span><span>&gt;</span>
</pre><pre>        }
</pre><pre>    <span>&lt;/</span><span>Authorized</span><span>&gt;</span>
</pre><pre>    <span>&lt;</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>p</span><span>&gt;</span>Must be logged in<span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre><span>&lt;/</span><span>AuthorizeView</span><span>&gt;</span>
</pre><pre></pre></pre>

<pre><pre><span>@</span>code {
</pre><pre>    [CascadingParameter]
</pre><pre>    <span>private</span> Task&lt;AuthenticationState&gt;
</pre><pre>        authenticationStateTask
</pre><pre>    { <span>get</span>; <span>set</span>; }
</pre><pre></pre><pre>    <span>private</span> WeatherForecast[] forecasts;
</pre><pre></pre><pre>    <span>protected</span> <span>override</span> async Task OnInitializedAsync()
</pre><pre>    {
</pre><pre>        var authState = await authenticationStateTask;
</pre><pre>        var user = authState.User;
</pre><pre>        <span>if</span> (user.Identity != <span>null</span>)
</pre><pre>        {
</pre><pre>            <span>if</span> (user.Identity.IsAuthenticated)
</pre><pre>            {
</pre><pre>                forecasts =
</pre><pre>                    await Http
</pre><pre>                    .GetJsonAsync&lt;WeatherForecast[]&gt;("<span>WeatherForecast</span>");
</pre><pre>            }
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre>



<p>The <strong>AuthorizeView</strong> tag and <strong>AuthenticationState</strong> <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components?view=aspnetcore-3.1#cascading-values-and-parameters">Cascading Parameter</a> will be triggered by the <strong>custom authentication provider</strong> created earlier.</p>

<p><strong>Note:</strong> This is helpful for the application to determine what should be shown, but, because <strong>Blazor Client Side security</strong> can be <em>bypassed</em>, security <u>must always be enforced</u> in the <strong>server side code</strong>.</p>





<p><strong><a href="https://blazor.net/">Blazor.net</a></strong></p>

<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/?view=aspnetcore-3.0&amp;tabs=visual-studio">ASP.NET Core Blazor authentication and authorization</a></p>

<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/?view=aspnetcore-3.1&amp;tabs=visual-studio#implement-a-custom-authenticationstateprovider">Implement a custom AuthenticationStateProvider</a></p>

<p><a href="https://youtu.be/dCgqTDki-VM?t=1777">Blazor in more depth - Steve Sanderson &amp; Ryan Nowak</a></p>

<p><a href="https://chrissainty.com/building-a-blogging-app-with-blazor-adding-authentication/">Adding Authentication</a> (Chris Sainty)</p>

<p><a href="https://www.mikesdotnetting.com/article/342/managing-authentication-token-expiry-in-webassembly-based-blazor">Managing Authentication Token Expiry In WebAssembly-based Blazor</a></p>

<p><a href="http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4358/Blazor-Microsoft-Graph-Calendar-Example-With-Active-Directory-Authentication.aspx">Blazor Microsoft Graph Calendar Example With Active Directory Authentication</a></p>







<p>The project is available at <a href="http://blazorhelpwebsite.com/Downloads.aspx">http://Blazorhelpwebsite.com/Downloads.aspx</a></p>

<p>You must have <strong>Visual Studio 2019 </strong>(or higher) installed to run the code.</p>
 
 <!-- End Blog Entry -->
 <!-- Blog Entry Footer Section -->
 
 
 
 <!-- Comments Section -->
 <div id="dnn_ctr382_MainView_ViewEntry_pnlComments">
		
  <p>
   <a id="Comments" name="Comments"></a>
   <a href="#AddComment"><span id="dnn_ctr382_MainView_ViewEntry_lblComments">9 comment(s) so far...</span></a>
  </p>
  
  <br>
  <table id="dnn_ctr382_MainView_ViewEntry_lstComments">
			<tbody><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_0">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_0" src="http://www.gravatar.com/avatar/3d60c8823a64a50900e78effdc496839?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_0">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       Great tutorial! Is it possible this may be modified to accommodate Azure B2C?
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_0">By Adam on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_0">1/7/2020 7:19 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_1">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_1" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_1">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       @Adam - Yest it can. I don't have an example, sorry. However, you should be able to follow the steps from any .Net Core Azure B2C tutorial and it should work. 
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_1">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_1">1/7/2020 7:21 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_2">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_2" src="http://www.gravatar.com/avatar/379be11ca395db53892e1344e631d553?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_2">Azure AD B2C</span>
      </p>
      <div><p>
       @Adam, I used this tutorial for an Azure AD B2C Blazor project with just a few changes.</p><p>Basically, in the server project, replace AzureAD with AzureADB2C everywere. Examples:<br>- Nuget package Microsoft.AspNetCore.Authentication.AzureADB2C.UI (instead of Microsoft.AspNetCore.Authentication.AzureAD.UI)<br>- using Microsoft.AspNetCore.Authentication.AzureADB2C.UI;<br>- services.AddAuthentication(AzureADB2CDefaults.AuthenticationScheme)<br>    .AddAzureADB2C(options =&gt; Configuration.Bind("AzureADB2C", options));<br>- services.Configure(AzureADB2CDefaults.OpenIdScheme,</p><p>In the client project in LoginDisplay.razor also replace AzureAD with AzureADB2C (href="AzureADB2C/Account/SignIn")</p><p>A little bit more complicated was the GetUser() method in the UserController, because depending on the configuration of your AD B2C tenant User.Identity.Name can be empty. In that case you must find an alternative to get the user name or use some other claim.</p><p>If you need to setup an AD B2C tenant from scratch, you can start with this tutorial: https://docs.microsoft.com/en-us/azure/active-directory-b2c/tutorial-create-tenant</p></div>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_2">By Marcel Wolterbeek on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_2">1/8/2020 4:56 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_3">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_3" src="http://www.gravatar.com/avatar/d4bdd3470ca8910d2f56ba65b3b48957?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_3">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       This is great thanks! Do you have an example that shows how to do B2C/AD Auth using JWT tokens?
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_3">By Andrew on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_3">1/14/2020 5:19 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_4">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_4" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_4">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       @Andrew - Sorry, I don't have a JWT example. However, others have covered that and did a good job. See Chris Sainty.
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_4">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_4">1/14/2020 5:20 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_5">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_5" src="http://www.gravatar.com/avatar/2e7f12d7120649f453108b54228cce35?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_5">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       Hi, I've been searching around and might be missing it but I'm wanting to make a blazor app which only uses client side similar to angular. However I'm having problems finding what the best way to make calls to azure ad authenticated apis. My blazor app is using azure ad to sign and in the app registration for it there is access to the api granted. When I sign in I see that I'm being granted access to both the api and the app however I dont believe my token is being sent to the api and I've used fiddler and am seeing the token is not applied. Any thoughts?
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_5">By Scott Blankenship on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_5">1/16/2020 6:13 PM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_6">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_6" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_6">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       @Scott Blankenship - For an example of calling an API like Microsoft Graph see: http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4358/Blazor-Microsoft-Graph-Calendar-Example-With-Active-Directory-Authentication.aspx
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_6">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_6">1/16/2020 6:14 PM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_7">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_7" src="http://www.gravatar.com/avatar/6899cbc4e2e57ef521a6eccd2493df1b?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_7">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       Great tutorial! Thank you! I want to deploy my VS project to Azure. The WebApp starts locally (in Visual Studio) without any problems and the Azure AD acess works but on Azure App Service I've got an http 500 Error. I've tried to modify the URI of the App Registration in my Azure AD and the configs of my Azure App Service. But no luck! Are there any breaking changes on Blazor Components? I had to modify your code in some places (there's no Startup.cs in the Client Project). Perhaps is this a problem on Azure App Service. Can you help me? <br>Thank you <br>Sven    
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_7">By Sven Kunz on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_7">2/12/2020 4:41 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_8">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_8" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_8">Re: Client Side Blazor Authentication Using Azure AD and a Custom AuthenticationStateProvider</span>
      </p>
      <p>
       @Sven Kunz - I updated the article to deal with the breaking changes.
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_8">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_8">2/15/2020 7:39 PM</span>
     </cite>
    
				</p></div>
   </td>
			</tr>
		</tbody></table>
 
	</div>
 
 <div id="dnn_ctr382_MainView_ViewEntry_pnlAddComment">
		
  <table>
   <tbody><tr>
    <td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblAuthor">Your name:</span>
    </td>
    <td id="dnn_ctr382_MainView_ViewEntry_tdAuthor" colspan="1">
     
    </td>
		
    <td id="dnn_ctr382_MainView_ViewEntry_tdGravatarPreview" rowspan="2">
     <p><img id="dnn_ctr382_MainView_ViewEntry_imgGravatarPreview" src="http://www.gravatar.com/avatar/108eeb4a0bc2c8c85cad9dde10e1319e?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar Preview">
     </p>
    </td>
		
   </tr>
   <tr id="dnn_ctr382_MainView_ViewEntry_trGravatarEmail">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblEmail">Your email:</span>
    </td>
			<td>
     
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trUseGravatar">
			<td>
    </td>
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblEmailExplanation">(Optional) Email used only to show <a href="http://www.gravatar.com/" target="_new">Gravatar</a>.</span>
    </td>
			<td>
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trCommentWebsite">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblWebsite">Your website:</span>
    </td>
			<td colspan="2">
     
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trCommentTitle">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblCommentTitle">Title:</span>
    </td>
			<td colspan="2">
     
    </td>
		</tr>
		
   <tr>
    <td colspan="3">
     <span id="dnn_ctr382_MainView_ViewEntry_lblComment">Comment:</span>
    </td>
   </tr>
   <tr>
    <td colspan="3">
     
    </td>
   </tr>
   <tr id="dnn_ctr382_MainView_ViewEntry_rowCaptcha">
			<td colspan="3">
     <span id="dnn_ctr382_MainView_ViewEntry_lblCaptcha">Security Code</span>
     <div>
				<p><img src="http://blazorhelpwebsite.com/DesktopModules/Blog/ImageChallenge.captcha.aspx?captcha=AB88346F0A4134E351F8BFDA6B2CF8E33F7AC33D90C3D894610DF5CE9B4F86399D0AD81C2ADA56B26D6D478B9A6A1EB0F612CB70B44BD070BFCD2CFDF62EE2A3C45FFCA2C0D1E1A9B7D3C8A343A55A76ECD2405141528CE5BC383EFF0A66EA44D8BF4C11D0573B31CF9A771EAA5F618A3364557E839D221CA1608998&amp;alias=blazorhelpwebsite.com" alt="CAPTCHA image"></p><p>
					Enter the code shown above in the box below
				</p></div>
    </td>
		</tr>
		
   <tr>
    <td colspan="3">
     Add Comment&nbsp;&nbsp;
     Cancel&nbsp;
     
    </td>
   </tr>
  </tbody></table>
  
 
	</div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>