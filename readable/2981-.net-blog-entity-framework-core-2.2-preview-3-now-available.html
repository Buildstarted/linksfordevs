<!DOCTYPE html>
<html lang="en">
<head>
    <title>
.NET Blog Entity Framework Core 2.2 Preview 3 Now Available! -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>.NET Blog Entity Framework Core 2.2 Preview 3 Now Available!</h1><div><div class="entry-content col-12 sharepostcontent"><div class="row justify-content-center"><div class="col-md-4"><div><img src="https://secure.gravatar.com/avatar/c16238388fe24348cb8d7c4cf974bb7b?s=58&amp;d=mm&amp;r=g" width="58" height="58" alt="Avatar" class="avatar avatar-58 wp-user-avatar wp-user-avatar-58 photo avatar-default"><p>Diego</p></div></div></div><p>October 17th, 2018</p><p>Today we are making EF Core 2.2 Preview 3 available, together with a new preview of our data provider for Cosmos DB and updated spatial extensions for various providers.</p><p>Preview 3 is going to be the last milestone before EF Core 2.2 RTM, so now is your last chance to try the bits and give us feedback if you want to have an impact on the quality and the shape of the APIs in this release.</p><p>Besides the new features, you can help by trying EF Core 2.2 preview 3 on applications that are using third party providers.&nbsp; Although we now have our own testing for this, there might be unforeseen compatibility problems, and the earlier we can detect them, the higher chances we have of addressing them before RTM.</p><p>We thank you in advance for reporting any issues your find on <a href="https://github.com/aspnet/EntityFrameworkCore/issues/new">our issue tracker on GitHub</a>.</p><h2 id="ef-core-2-2-roadmap-update">EF Core 2.2 roadmap update</h2><p>EF Core 2.2 RTM is still planned for the end of the 2018 calendar year, alongside ASP.NET Core 2.2 and .NET Core 2.2.</p><p>However, based on a reassessment of the progress we have made so far, and on new information about the work we need to complete 2.2, we are no longer trying to include the following features in the EF Core 2.2 RTM:</p><ul><li><strong>Reverse engineering database views into query types:</strong><a href="https://github.com/aspnet/EntityFrameworkCore/issues/1679">This feature</a> is postponed to EF Core 3.0.</li><li><strong>Cosmos DB Provider:</strong> Although we have made a lot of progress setting up the required infrastructure for document-oriented database support in EF Core, and have been steadily adding functionality to the provider, realistically we cannot arrive to a state in which we can release the provider with adequate functionality and quality in the current time frame for 2.2.Overall, we have found that the work necessary to complete the provider to be more than we initially estimated. Also, ongoing evolution in Cosmos DB is leading us to frequently revisit decisions about such things as how we use the Cosmos DB SDK, whether we map all entities to a single collection by default, etc.We plan to maintain the focus on the provider and to continue working with the Cosmos DB team and to keep releasing previews of the provider regularly. You can expect at least one more preview by the end of this year, and RTM sometime in 2019. We haven’t decided yet if the Cosmos DB provider will release as part of EF Core 3.0 or earlier.A good way to keep track of our progress is <a href="https://github.com/aspnet/EntityFrameworkCore/issues/12086">this checklist in our issue tracker</a>.</li></ul><h2 id="obtaining-the-preview">Obtaining the preview</h2><p>The preview bits are available <a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore/2.2.0-preview3-35497">on NuGet</a>, and also as part of <a href="https://blogs.msdn.microsoft.com/webdev/2018/10/17/asp-net-core-2-2-0-preview3-now-available/">ASP.NET Core 2.2 Preview 3</a> and the <a href="https://github.com/dotnet/core/blob/master/release-notes/2.2/preview/2.2.0-preview3.md">.NET Core SDK 2.2 Preview 3</a>, also releasing today. If you are want to try the preview in an application based on ASP.NET Core, we recommend you follow the instructions to upgrade to ASP.NET Core 2.2 Preview 3.</p><p>The SQL Server and in-memory providers are also included in ASP.NET Core, but for other providers and any other type of application, you will need to install the corresponding NuGet package.</p><p>For example, to add the 2.2 Preview 3 version of the SQL Server provider in a .NET Core library or application from the command line, use:</p><pre class="editor-colors lang-console">$ dotnet add package Microsoft.EntityFrameworkCore.SqlServer -v 2.2.0-preview3-35497</pre><p>Or from the Package Manager Console in Visual Studio:</p><pre class="lang:default decode:true editor-colors lang-console">PM&gt; Install-Package Microsoft.EntityFrameworkCore.SqlServer -Version 2.2.0-preview3-35497</pre><p>For more details on how to add EF Core to your projects see <a href="https://docs.microsoft.com/ef/core/get-started/install/">our documentation on Installing Entity Framework Core</a>.</p><p>The Cosmos DB provider and the spatial extensions ship as new separate NuGet packages. We’ll explain how to get started with them in the corresponding feature descriptions.</p><h2 id="what-is-new-in-this-preview-">What is new in this preview?</h2><p>Around <a href="https://github.com/aspnet/EntityFrameworkCore/issues?q=is%3Aissue+milestone%3A2.2.0-preview3+is%3Aclosed+label%3Aclosed-fixed">69 issues have been fixed</a>&nbsp;since we finished <a href="https://blogs.msdn.microsoft.com/dotnet/2018/09/12/announcing-entity-framework-core-2-2-preview-2/">Preview 2 last month</a>. This includes product bug fixes and improvements to the new features. Specifically about the new features, the most significant changes are:</p><h3 id="spatial-extensions">Spatial extensions</h3><ul><li>We have enabled spatial extensions to work with the SQLite provider using the popular <a href="https://www.gaia-gis.it/fossil/libspatialite/index">SpatiaLite</a> library.</li><li>We switched the default mapping of spatial properties on SQL Server from geometry to geography columns.</li><li>In order to use spatial extensions correctly with preview 3, it is recommended that you use the GeometryFactory provided by NetTopologySuite instead of creating new instances directly.</li><li>We collaborated with the NetTopologySuite team to create <strong>NetTopologySuite.IO.SqlServerBytes</strong> — a new IO module that targets .NET Standard and works directly with the SQL Server serialization format.</li><li>We enabled reverse engineering for databases containing spatial columns. Just make sure you add the spatial extension package for your database provider before you run <strong>Scaffold-DbContext</strong>&nbsp;or <strong>dotnet ef dbcontext scaffold</strong>.</li></ul><p>Here is an updated usage example:</p><pre><code class="csharp language-csharp">
// Model class
public class Friend
{
  [Key]
  public string Name { get; set; }

  [Required]
  public IPoint Location { get; set; }
}

// Program
private static void Main(string[] args)
{
     // Create spatial factory
     var geometryFactory = NtsGeometryServices.Instance.CreateGeometryFactory(srid: 4326);

     // Setup data in datbase
     using (var context = new MyDbContext())
     {
         context.Database.EnsureDeleted();
         context.Database.EnsureCreated();

         context.Add(
             new Friend
             {
                 Name = "Bill",
                 Location = geometryFactory.CreatePoint(new Coordinate(-122.34877, 47.6233355))
             });
         context.Add(
             new Friend
             {
                 Name = "Paul",
                 Location = geometryFactory.CreatePoint(new Coordinate(-122.3308366, 47.5978429))
             });
         context.SaveChanges();
     }

     // find nearest friends
     using (var context = new MyDbContext())
     {
         var myLocation = geometryFactory.CreatePoint(new Coordinate(-122.13345, 47.6418066));

         var nearestFriends =
             (from f in context.Friends
              orderby f.Location.Distance(myLocation) descending
              select f).Take(5);

         Console.WriteLine("Your nearest friends are:");
         foreach (var friend in nearestFriends)
         {
             Console.WriteLine($"Name: {friend.Name}.");
         }
     }
}

</code></pre><p>In order to use this code with SQL Server, simply install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.SqlServer.NetTopologySuite </strong>NuGet package, and configure your <strong>DbContext</strong> as follows:</p><pre><code class="csharp language-csharp">
public class MyDbContext : DbContext
{
    public DbSet Friends { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder options)
    {
        options.UseSqlServer(
            "Server=(localdb)\\mssqllocaldb;Database=SpatialFriends;ConnectRetryCount=0",
            b =&gt; b.UseNetTopologySuite());

    }
}
</code></pre><p>In order to use this code with SQLite, you can install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.Sqlite.NetTopologySuite</strong> and&nbsp;<strong>Microsoft.EntityFrameworkCore.Sqlite</strong>&nbsp;packages. Then you can configure the <strong>DbContext</strong> like this:</p><pre><code class="csharp language-csharp">
public class MyDbContext : DbContext
{
    public DbSet Friends { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder options)
    {
        options.UseSqlite(
            "Filename=SpatialFriends.db",
            x =&gt; x.UseNetTopologySuite());
    }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // For SQLite, you need to configure reference system on column
        modelBuilder
            .Entity()
            .Property(f =&gt; f.Location)
            .ForSqliteHasSrid(4326);
    }
}
</code></pre><p>Note that the spatial extension for SQLite requires the SpatiaLite library. This will be added as a dependency by the NuGet packages previously mentioned if you are on Windows, but on other systems you will need extra steps. For example:</p><ul><li>On MacOS:<pre class="editor-colors lang-console">$ brew install libspatialite</pre></li><li>On Ubuntu or Debian Linux:<pre class="editor-colors lang-console">$ apt-get install libsqlite3-mod-spatialite</pre></li></ul><p>In order to use this code with the in-memory provider, simply install the <strong>NetTopologySuite&nbsp;</strong>package, and the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.InMemory</strong> package. Then you can simply configure the <strong>DbContext</strong> like this:</p><pre><code class="csharp language-csharp">
public class MyDbContext : DbContext
{
    public DbSet Friends { get; set; }

    protected override void OnConfiguring(DbContextOptionsBuilder options)
    {
        options.UseInMemoryDatabase("SpatialFriends");
    }
}
</code></pre><h3 id="cosmos-db-provider">Cosmos DB provider</h3><p>We have made several changes and improvements since preview 2:</p><ul><li>The package name has been renamed to Microsoft.EntityFrameworkCore.Cosmos</li><li>The <strong>UseCosmosSql()</strong> method has been renamed to&nbsp;UseCosmos()</li><li>We now store owned entity references and collections in the same document as the owner</li><li>Queries can now be executed asynchronously</li><li><strong>SaveChanges()</strong>, <strong>EnsureCreated()</strong>, and <strong>EnsureDeleted()</strong> can now be executed synchronously</li><li>You no longer need to manually generate unique key values for entities</li><li>We preserve values in non-mapped properties when we update documents</li><li>We added a <strong>ToContainer()</strong> API to map entity types to a Cosmos DB container (or collection) explicitly</li><li>We now use the name of the derived <strong>DbContext</strong> type, rather ‘Unicorn’ for the container or collection name we use by convention</li><li>We enabled various existing features to work with Cosmos DB, including retrying execution strategies, and data seeding</li></ul><p>We still have some pending work and several limitations to remove in the provider. Most of them as tracked as uncompleted tasks <a href="https://github.com/aspnet/EntityFrameworkCore/issues/12086">on our task list</a>. In addition to those:</p><ul><li>Currently, synchronous methods are much slower than the corresponding asynchronous methods</li><li>The value of the ‘id’ property has to be specified for seeding</li><li>There is currently no enforcement of uniqueness of primary keys values on entities saved by multiple instances of the <strong>DbContext</strong></li></ul><p>In order to use the provider, install the 2.2 preview 3 version of the <strong>Microsoft.EntityFrameworkCore.Cosmos</strong>&nbsp;package.</p><p>The following example configures the <strong>DbContext</strong> to connect to the <a href="https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator">Cosmos DB local emulator</a> to store a simple blogging model:</p><pre><code class="csharp language-csharp">
public class BloggingContext : DbContext
{
  public DbSet Blogs { get; set; }
  public DbSet Posts { get; set; }

  protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
  {
    optionsBuilder.UseCosmos(
      "https://localhost:8081",
      "C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==",
      "MyDocuments");
  }
}

public class Blog
{
  public int BlogId { get; set; }
  public string Name { get; set; }
  public string Url { get; set; }
  public List Posts { get; set; }
}

public class Post
{
  public int PostId { get; set; }
  public string Title { get; set; }
  public string Content { get; set; }
  public List Tags { get; set; }
}

[Owned]
public class Tag
{
    [Key]
    public string Name { get; set; }
}
</code></pre><p>If you want, you can create the database programmatically, using EF Core APIs:</p><pre><code class="csharp language-csharp">
using (var context = new BloggingContext())
{
  context.Database.EnsureCreated();
}
</code></pre><p>Once you have connected to an existing database and you have defined your entities, you can start storing data in the database, for example:</p><pre><code class="csharp language-csharp">
using (var context = new BloggingContext())
{
  context.Blogs.Add(
    new Blog
    {
        BlogId = 1,
        Name = ".NET Blog",
        Url = "https://blogs.msdn.microsoft.com/dotnet/",
        Posts = new List
        {
            new Post
            {
                PostId = 2,
                Title = "Welcome to this blog!",
                Tags = new List
                {
                    new Tag
                    {
                        Name = "Entity Framework Core"
                    },
                    new Tag
                    {
                        Name = ".NET Core"
                    }
                }
            },
        }
      }
    });
  context.SaveChanges();
}
</code></pre><p>And you can write queries using LINQ:</p><pre><code class="csharp language-csharp">
var dotNetBlog = context.Blogs.Single(b =&gt; b.Name == ".NET Blog");
</code></pre><ul><li>We fixed several issues with multiple calls of the API and with usage with multi-line strings</li><li>The API was renamed to <strong>TagWith()</strong></li></ul><p>This an updated usage example:</p><pre><code class="csharp language-csharp">
  var nearestFriends =
      (from f in context.Friends.TagWith(@"This is my spatial query!")
      orderby f.Location.Distance(myLocation) descending
      select f).Take(5).ToList();
</code></pre><p>This will generate the following SQL output:</p><pre><code class="sql language-sql">
-- This is my spatial query!

SELECT TOP(@__p_1) [f].[Name], [f].[Location]
FROM [Friends] AS [f]
ORDER BY [f].[Location].STDistance(@__myLocation_0) DESC
</code></pre><h3 id="collections-of-owned-entities">Collections of owned entities</h3><ul><li>The main update since preview 2 is that the Cosmos DB provider now stores owned collections as part of the same document as the owner.</li></ul><p>Here is a simple usage scenario:</p><pre><code class="csharp language-csharp">
modelBuilder.Entity().OwnsMany(c =&gt; c.Addresses);
</code></pre><h2 id="thank-you">Thank you</h2><p>The EF team would like to thank everyone for all the feedback and contributions. Once more, please try this preview and report any feedback on <a href="https://github.com/aspnet/EntityFrameworkCore/issues/new">our issue tracker</a>.</p><div class="authorinfoarea"><div><p>Program Manager ,&nbsp;.NET Data Access</p><p><strong>Follow Diego</strong>&nbsp;&nbsp;&nbsp;<a class="no-underline stayinformed" aria-label="Diego Vega Twitter profile" target="_blank" href="https://twitter.com/divega"></a><a class="no-underline stayinformed" aria-label="Diego Vega LinkedIn profile" target="_blank" href="https://linkedin.com/in/dbvega"><i class="fa fa-linkedin"></i></a><a class="no-underline stayinformed" aria-label="Diego Vega GitHub profile" target="_blank" href="https://github.com/divega"><i class="fa fa-github"></i></a><a class="no-underline stayinformed" aria-label="Diego Vega Stackoverflow profile" target="_blank" href="https://stackoverflow.com/users/393050/divega"><i class="fa fa-stack-overflow"></i></a><a class="no-underline stayinformed hvr-pop" aria-label="Diego Vega RSS Feed" target="_blank" href="https://devblogs.microsoft.com/dotnet/author/divegamicrosoft-com/feed/"></a></p></div></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>