<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Blog Playing with Program database paths&#x2026; -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook" xmlns=""><div id="readInner" class="margin-medium size-medium"><h1>Blog   Playing with Program database paths…</h1><div><div class="entry" xmlns="http://www.w3.org/1999/xhtml"><p>Many executables include references (typically in a form of .pdb file name) to a program database path used by the software. This path typically points to some location on the software author’s system. I actually tried to <a href="http://www.hexacorn.com/blog/2013/05/08/and-the-most-popular-windows-account-for-compiling-malware-is/">cluster these paths</a> in the past to build a list of account names used by malware authors. Of course, today it’s much harder – many modern malware authors randomize this path so it can evade signatures/yara rules.</p><p>These paths are used only by programs that actually… use them – primarily debuggers. It is a limitation, but it crossed my mind that we could still try to modify a PDB path to point it to any file really. </p><p>After test change and loading the program into Olly debugger I immediately saw that it tries to read the file from various locations. Interestingly, Olly tries to locate the pdb file based on a file name first. It looks for it in a debuggee’s current directory, then in ‘.\exe’ subdirectory, then ‘.\symbols\exe’, then comes back to the current directory and checks the same file name, but with a ‘.pdb’ extension, and finally in the fullpath provided inside the debug section:</p><figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1.png" alt="" class="wp-image-6404" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1.png 468w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_1-300x86.png 300w" sizes="(max-width: 468px) 100vw, 468px"></figure><p>This is interesting.</p><p>My first thought was to try to DoS Olly by making a reference to c:\pagefile.sys. This didn’t work, because Olly only reads a chunk at the top of the file, then bails out when the file is not present/proper. Also, it doesn’t seem to ‘see’ files with hidden/system attributes.</p><p>Another option I looked at was to point it to a file that could be e.g. including EICAR string. Any program reading such file will most likely trigger AV detection – as such killing and quarantining the debugger – – this could act as a truly naive anti-debug technique. Of course, such decoy EICAR file needs to exist first, so program would need to create it after first run. In such case tho, AV would pick the program instead! A perfect catch 22.</p><p>Then I thought of another option: we could use it as a beacon. This actually seemed to work pretty fine:</p><figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2.png" alt="" class="wp-image-6405" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2.png 439w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_2-300x69.png 300w" sizes="(max-width: 439px) 100vw, 439px"></figure><p>– I could see the request going out to the specified IP:</p><figure class="wp-block-image"><img src="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3.png" alt="" class="wp-image-6406" srcset="http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3.png 515w, http://www.hexacorn.com/blog/wp-content/uploads/2019/06/pdb_3-300x28.png 300w" sizes="(max-width: 515px) 100vw, 515px"></figure><p>This could affect not only debuggers, but also any vendor tools that load files and leverage these debug sections by default (e.g. any sort of more advanced automation). As a result, it could flag attackers that the file is ‘burnt’, or the red team’s activity got discovered. </p><p>The chances for it being really practically useful are pretty low, but again, there maybe other ideas on how to leverage it that I have not thought of.</p><p>After writing this post, one more idea came to my mind – this could be a neat trick against CTF participants. </p><p>Anyone ‘caught’ to be using debugger in an online environment could be rickrolled, or put on a ‘harder’ track as a punishment for doing analysis w/o precaution. And of course, a cleverly designed .pdb delivered if analysis was made online could actually throw analysts off as well (e.g. by creating labels in program that could mislead / confuse disassemblers/debuggers).</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>