<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Deploying Containerised Apps to Azure Web App for Containers -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Deploying Containerised Apps to Azure Web App for Containers</h1>
    <div class="post-content"> <p><strong>Part 1</strong> - <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-server-app/">Containerising a Blazor Server App</a><br><strong>Part 2</strong> - <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-webassembly-app/">Containerising a Blazor WebAssembly App</a><br><strong>Part 3</strong> - <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-publishing-to-azure-container-registry-using-azure-pipelines/">Publishing to Azure Container Registry using Azure Pipelines</a><br><strong>Part 4</strong> - Deploying Containerised Apps to Azure Web App for Containers (this post)</p><p>In the first half of this series, we covered how to containerise both <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-server-app/">Blazor Server</a> and <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-webassembly-app/">Blazor WebAssembly</a> apps. In <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-publishing-to-azure-container-registry-using-azure-pipelines/">part 3</a>, we automated that process using Azure Pipelines. We configured a CI pipeline which automatically builds code upon check-in to GitHub and publishes the Docker image to Azure Container Registry.</p><p>In this post, we&apos;re going to learn how to deploy a Docker image from our container registry to an Azure App Service, which completes the cycle of development to release. We&apos;re going to start by taking a look at the Web App for Containers service and why we would want to use it. Then we&apos;ll create a Web App for Containers instance using the Azure Portal. Finally, we&apos;ll create a build pipeline in Azure Pipelines to automate the deployment of our Docker image to that instance.</p><h2 id="web-app-for-containers-introduction">Web App for Containers - Introduction</h2><p><a href="https://azure.microsoft.com/en-gb/services/app-service/containers/">Web App for Containers</a> (WAC) is part of the <a href="https://azure.microsoft.com/en-gb/services/app-service/">Azure App Service</a> platform. It allows us to <em>&quot;easily deploy and run containerised applications on Windows and Linux&quot;</em>. The service offers built-in load balancing and auto scaling as well as full CI/CD deployment from both Docker Hub and private registries such as Azure Container Registry.</p><blockquote>It has never been easier to deploy container-based web apps...</blockquote><p>Another great thing about this service is that it manages and maintains the underlying container orchestrator, so we can focus on building our apps - which I really like. Plus, you can even run <a href="https://docs.microsoft.com/en-us/azure/app-service/containers/quickstart-multi-container">multi-container apps</a> now!</p><h2 id="creating-a-container-instance-in-wac">Creating a container instance in WAC</h2><p>We&apos;re going to start by walking through creating a container instance via the Azure Portal. Once you&apos;re logged into your Azure account, go to <strong>App Services</strong> then click the <strong>Add</strong> button near the top of the blade or the <strong>Create app service</strong> button in the centre of the blade.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/add-app-service.png" class="kg-image"></figure><p>You&apos;ll then see the <em>Create app service</em> blade. Start by selecting your subscription and resource group before moving on to the app service plan details section.</p><p>Give the instance a name, set the publish option to <strong>Docker Image</strong> and select the OS to use, then pick a region to host it. Finally either select an existing App Service Plan or create a new one if you wish.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/configure-app-service.png" class="kg-image"></figure><p>Once you&apos;re done, click <strong>Next: Docker</strong>.</p><p>On this screen we can configure our container settings. We&apos;re only deploying a single container to we can leave the first setting alone. For Image Source, select Azure Container Registry then fill in the <strong>Registry</strong>, <strong>Image</strong> and <strong>Tag</strong>.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/configure-app-service-docker.png" class="kg-image"></figure><p>When you&apos;re happy, click <strong>Review and create</strong>. You&apos;ll be presented with a summary screen, double check the details and then click <strong>Create</strong> to finish.</p><p>After a moment you should see a message stating <em>Your deployment is complete</em>. Click on the <strong>Go to resource</strong> link and you can see the overview screen for the instance. You can click on the URL link in to top right of the blade to view the running instance - This does take a few seconds to fire the app up the first time.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/web-app-for-containers.png" class="kg-image"></figure><p>Congratulations, you&apos;ve now got a fully working Blazor application running in a container on Azure!</p><p>So far so good, we have successfully deployed an image from the container registry to an app service but we don&apos;t want to have to come here and do this manually every time we update our code. </p><p>To complete our pipeline we&apos;re going to set up a release pipeline which will automatically deploy new images to our Web App for Containers instance.</p><h2 id="deploying-from-azure-pipelines">Deploying from Azure Pipelines</h2><p>We&apos;re going to continue where we left off in part 3. This time we&apos;re going to head to the <em><strong>Releases</strong></em> option under the Pipelines menu. Then we&apos;re going to click the <em><strong>New pipeline</strong></em> button.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/new-build-pipeline.png" class="kg-image"></figure><p>To start, we need to select a template to use for our pipeline, we&apos;re going to select <em><strong>empty job</strong></em> here.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/emtpy-template.png" class="kg-image"></figure><p>Once we select empty job we need to click the <strong><em>view stage tasks</em></strong> link in Stage 1.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/select-job.png" class="kg-image"></figure><p>Now click the + next to agent job to add a new task. </p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/add-job-to-task.png" class="kg-image"></figure><p>Using the add task search box, type in <em>Azure App Service</em> and then add the Azure Web App for Containers task.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/add-web-app-for-containers-task.png" class="kg-image"></figure><p>Click on the task to load its configuration screen. Select your Azure subscription, then the app name, which is the instance we created in the first half of the post. Finally, fill in the image name, this is the fully qualified image name (your<em>registry.azurecr.io/repo:tag</em>).</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/configure-task.png" class="kg-image"></figure><p>The last thing we need to configure is where to get the image we are going to deploy. Click on the <strong><em>Pipeline</em></strong> tab, then in the artifacts box click <strong><em>Add an artifact</em></strong>. Then under source type click the <em><strong>show more</strong></em> link and then select <em><strong>Azure Container Registry</strong></em>.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/configure-artifact.png" class="kg-image"></figure><p>Go ahead and select your service connection, resource group, azure container registry and repository. Then click <strong><em>Add</em></strong>.</p><p>That should be everything we need. If you save your pipeline using the save button at the top of the screen, you can also give your pipeline a more meaningful name by clicking on the <em>New release pipeline</em> text in the top left. </p><p>Now it&apos;s time to test it all out. Click the <strong><em>Create Release</em></strong> button in the top right and then click the <strong><em>Create</em></strong> button to start the release.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/create-release.png" class="kg-image"></figure><p>If all goes well, after a minute or two, you should see the stage turn green with a succeeded message.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/successful-deployment.png" class="kg-image"></figure><p>Type in the FQDN for your app instance and you should be able to see your application working.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/web-app-for-containers-1.png" class="kg-image"></figure><h2 id="enabling-continuous-deployment-optional-">Enabling Continuous Deployment (optional)</h2><p>To create a full CD pipeline, then you&apos;ll want to trigger a new deployment every-time a new image is built and pushed to the container registry repository. To enable this, edit the release pipeline and click the enable <strong>Continuous deployment trigger</strong>.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/enable-cd-trigger.png" class="kg-image"></figure><p>From here toggle the <strong>Enabled</strong> switch to turn on continuous deployments.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/enable-cd.png" class="kg-image"></figure><p>This will now create a new release automatically every-time a new image is pushed to the container registry repository. However, if you want a bit of control, say you only want to create a release when the image has a certain tag, you can add a tag filter. </p><p>This is just a regex expression, in the image below I&apos;ve added the filter <code>^latest$</code> so that only images with a tag of <code>latest</code> will get deployed. </p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/09/add-tag-filter.png" class="kg-image"></figure><p>That&apos;s it, we now have a continuous deployment pipeline configured.</p><p>In this post, we started by creating a new Web App for Containers instance using the Azure Portal. Then configuring that instance to deploy and run an image from our Azure Container Registry. </p><p>Next, we built on our CI pipeline from earlier posts, adding the ability to automatically deploy new versions to our app instance via Azure Pipelines. Then finished off with an optional step to enable full continuous deployment on our pipeline.</p> <div class="post-tags"> Tagged in: <a href="/dev-ops/">DevOps</a> | <a href="/docker/">Docker</a> | <a href="/azurepipelines/">Azure Pipelines</a> </div> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>