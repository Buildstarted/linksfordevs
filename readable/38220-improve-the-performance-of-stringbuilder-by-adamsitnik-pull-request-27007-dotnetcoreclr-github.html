<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Improve the performance of StringBuilder by adamsitnik &#xB7; Pull Request #27007 &#xB7; dotnet/coreclr &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Improve the performance of StringBuilder by adamsitnik · Pull Request #27007 · dotnet/coreclr · GitHub</h1><div><div class="comment-body markdown-body  js-comment-body"><p>The threshold is most certainly too low for StringBuilder. 1 - 2 K may work better.</p><p>The issue with UninitializedArrays is that performance depends on the call pattern.<br>There is more benefit if you call this repeatedly. If you make a normal allocation, then the benefit is diminished.</p><p>A normal allocation of size X will leave from 0 to (4K - X)  pre-cleared budget. The next allocation within this budget will not see benefits of Uninitialized if it fits.</p><p>If you mostly do normal allocations and they are relatively small, and then occasionally do Uninitialized, then threshold should be in the order of 2K. Since that is the expected average budget.<br>On the other hand - If you call the API repeatedly in a loop, then you want smaller threshold since your cost is dominated by memclearing.</p><p>So far the only use of the API is when ArrayPool rent is called repeatedly (without returning). The threshold is  tuned for the only user.</p><p>I think,  the pattern used by ArrayPool oversubscription benchmark is not common. I think for users like StringBuilder the threshold should be about 1 - 2K .</p><p>Also one number would not fit all. What will be good for StringBuilder may cause regression for ArrayPool.<br>And I think that is OK, since the ArrayPool oversubscription, while possible, is basically an anomaly. We should handle it reasonably well, but should not optimize for it at the cost to other users.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>