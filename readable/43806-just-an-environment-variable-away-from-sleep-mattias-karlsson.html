<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Just an environment variable away from sleep - Mattias Karlsson -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>Just an environment variable away from sleep - Mattias Karlsson</h1><div><div class="ac ae af ag ah cz aj ak"><p id="074c" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">It’s a quarter past midnight, you should be going to sleep, but there’s that one unit test that fails only on GitHub Action macOS build agent — it’s mocking you so you stay awake just a bit longer…</p><figure class="gb gc gd ge gf gg cl cm paragraph-image"><p id="2678" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">You bring out you Mac and execute tests, fortunately we can reproduce — the test fails on your machine too! A quick inspection of test output informs you that error only occurs on .NET Core.</p><p id="7edb" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Unfortunately, today neither VS Mac nor VSCode for some reason is your friend, solutions won’t build, tests aren’t found, break points aren’t hit and so on.</p><p id="aa32" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Probably not their fault at all, more likely a case of complex multi target solution, having preview versions and just being too tired.</p><p id="8418" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Fortunately, as the .NET CLI “dotnet test” command executed by the build script compiled and executed the tests, one could leave the VS Mac/Code IDE tooling debugging for another day and trigger debugging from the command line.</p><p id="b6f6" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">This is achieved by setting the environment variable <strong class="fo gu"><em class="gv">VSTEST_HOST_DEBUG</em></strong> to <strong class="fo gu"><em class="gv">1</em></strong></p><pre class="gb gc gd ge gf gw gx gy"><span id="53d8" class="gz ha dc bk hb b eg hc hd r he">Bash:<br>export VSTEST_HOST_DEBUG=1</span><span id="687c" class="gz ha dc bk hb b eg hf hg hh hi hj hd r he"><span class="r hk hl hm hn ho hp hq hr hs gn">P</span>owerShell:<br>$env:VSTEST_HOST_DEBUG=1</span></pre><p id="952e" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Now when executing the test (specifying only the framework I want to test)</p><pre class="gb gc gd ge gf gw gx gy"><span id="b836" class="gz ha dc bk hb b eg hc hd r he">dotnet test My.Tests.csproj — framework=netcoreapp3.0</span></pre><p id="9f80" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">It’ll will pause and wait for a debugger to attach.</p><pre class="gb gc gd ge gf gw gx gy"><span id="0f29" class="gz ha dc bk hb b eg hc hd r he">Microsoft (R) Test Execution Command Line Tool Version 16.3.0<br>Copyright (c) Microsoft Corporation.  All rights reserved.</span><span id="0440" class="gz ha dc bk hb b eg hf hg hh hi hj hd r he">Starting test execution, please wait...</span><span id="bf22" class="gz ha dc bk hb b eg hf hg hh hi hj hd r he">A total of 1 test files matched the specified pattern.<br>Host debugging is enabled. Please attach debugger to testhost process to continue.<br>Process Id: 32723, Name: dotnet<br>Waiting for debugger attach…<br>Process Id: 32723, Name: dotnet</span></pre><p id="efa8" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">And I could now attach to process both from VS Mac</p><figure class="gb gc gd ge gf gg cl cm paragraph-image"><p id="024f" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">and VS Code</p><figure class="gb gc gd ge gf gg cl cm paragraph-image"><p id="64b8" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Which allowed me to set break points, inspect variables and step through code, even though the IDEs themselves for some reason couldn’t compile and execute the tests.</p><figure class="gb gc gd ge gf gg cl cm paragraph-image"><p id="1cf4" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Fairly quickly found the issue added a commit and builds were green and I could go to sleep.</p><figure class="gb gc gd ge gf gg cl cm paragraph-image"><p id="7450" class="fm fn dc bk fo b fp fq fr fs ft fu fv fw fx fy fz cu">Sometimes you just want to attack the problem and not debug tooling, then attacking the problem from another direction might get you there quicker, today it was setting <strong class="fo gu"><em class="gv">VSTEST_HOST_DEBUG</em></strong> to <strong class="fo gu"><em class="gv">1</em></strong>.</p></figure></figure></figure></figure></figure></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>