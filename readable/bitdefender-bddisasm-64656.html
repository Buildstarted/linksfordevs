<!DOCTYPE html>
<html lang="en">
<head>
    <title>
bitdefender/bddisasm - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="bitdefender/bddisasm - linksfor.dev(s)"/>
    <meta property="article:author" content="bitdefender"/>
    <meta property="og:description" content="bddisasm is a fast, lightweight, x86/x64 instruction decoder.  The project also features a fast, basic, x86/x64 instruction emulator, designed specifically to detect shellcode-like behavior. - bitd..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/bitdefender/bddisasm"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - bitdefender/bddisasm</title>
<div class="readable">
        <h1>bitdefender/bddisasm</h1>
            <div>by bitdefender</div>
            <div>Reading time: 6-8 minutes</div>
        <div>Posted here: 22 Jul 2020</div>
        <p><a href="https://github.com/bitdefender/bddisasm">https://github.com/bitdefender/bddisasm</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div id="readme">
    
        

      <div>
        <article itemprop="text">
<p>The Bitdefender disassembler (bddisasm) is a lightweight, x86/x64 only instruction decoder. It is easy to integrate, easy to work with, it has no external dependencies, it is thread-safe, it allocates no memory at all, it works in virtually any environment (we use it inside user, kernel, hypervisor, on both Windows and Linux environments), and it provides lots of info regarding the decoded instructions, such as: operands (both explicit and implicit), access mode for each operand, CPUID feature flag, flags access, etc. More examples and info about the project can be found on the official documentation: <a href="http://bddisasm.readthedocs.io/" rel="nofollow">Bitdefender disassembler</a></p>
<h2>Projects</h2>
<ol>
<li>
<p>bddisasm - this is the main disassembler project. In order to use the Bitdefender disassembler, all you have to do is build this project, and link with the output library. The only headers you need are located inside the <code>inc</code> folder.</p>
</li>
<li>
<p>bdshemu - this project makes use of the main bddisasm lib in order to build a simple, lightweight, fast, instructions emulator, designated to target shellcodes. This project is also integrated inside the disasmtool, so you can
emulate raw binary files, and see their output. Note that this simple emulator supports basic x86/x64 instructions, and does not support emulating any kind of API call. In addition, the only supported memory accesses are inside the shellcode itself, and on the emulated stack.</p>
</li>
<li>
<p>isagenerator - this project contains the instruction definitions and the scripts required to generate the disassembly tables. If you wish to add support for a new instruction, this is the place. This project will automatically generate several header files (instructions.h, mnemonics.h, constants.h, table_*.h), so please make sure you don't manually edit any of these files. You will need Python 3 to run the generation scripts.</p>
</li>
<li>
<p>disasmtool - this project is a command line disassembler tool, used mainly as an example of how to integrate the bddisasm and bdshemu libraries.</p>
</li>
<li>
<p>disasmtool_lix - like disasmtool, but for Linux.</p>
</li>
<li>
<p>pydis - this is the Python binding for the bddisasm project. You will need Python 3 for this.</p>
</li>
</ol>
<h2>Objectives</h2>
<p>The main objectives of this disassembler are:</p>
<ol>
<li>Lightweight - it's written in C, with no external dependencies, no memory allocated, and thread safe by design.</li>
<li>Fast - less than 300 CPU clocks on an Intel Core i7-8650U per decoded instruction (more than 7M instructions per second).</li>
<li>Resilient - tested against internal fuzzers and the famous <a href="https://github.com/trailofbits/mishegos">mishegos</a> tool.</li>
<li>Easy to work with - just include the main header file, bddisasm.h, link with the bddisasm library, and call the NdDecode API!</li>
<li>Complete - support every x86 instruction to date, and provide as much information as possible.</li>
</ol>
<h2>Build</h2>
<h3>Windows</h3>
<p>In order to build the projects on Windows you need:</p>
<ul>
<li><a href="https://visualstudio.microsoft.com/vs/" rel="nofollow">Visual Studio 2019</a> with the Desktop development with C++ workload.</li>
<li><a href="https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk/" rel="nofollow">Windows SDK 10.0.18362.0</a>.</li>
<li><a href="https://www.python.org/downloads/release/python-373/" rel="nofollow">Python 3.7 or newer</a></li>
</ul>
<p>When you first open the solution Visual Studio should prompt you to install any missing components.
This should be enough to build bddisasm, disasmtool and bdshemu for the Debug and Release configurations.</p>
<p>For the DebugKernel and ReleaseKernel configurations, <a href="https://go.microsoft.com/fwlink/?linkid=2085767" rel="nofollow">WDK 1903</a> is needed, alongside the Windows Driver Kit Visual Studio extension (the WDK installer should take care of this).</p>
<p>For isagenerator, Python 3 is needed.</p>
<p>Building any of the projects is done directly from Visual Studio.</p>
<p>The results will be in the bin directory in the root of the repository.</p>
<h3>Linux</h3>
<p>In order to build the projects on Linux you need:</p>
<ul>
<li>gcc</li>
<li>make</li>
</ul>
<p>For disasmtool_lix you also need:</p>
<ul>
<li>g++</li>
<li>cmake 3.12 or newer</li>
<li><a href="https://github.com/Tencent/rapidjson/">RapidJSON</a></li>
</ul>
<p>In order to build bddisasm and bdshemu run <code>make</code> in the root of the repository. The results will be placed in the bin directory.</p>
<p>In order to build disasmtool_lix go to the disasmtool_lix directory and run <code>make</code>. The results will be in the bin directory in the disasmtool_lix/build directory.</p>
<h2>Example</h2>
<p>Working with bddisasm is very easy. Decoding and printing the disassembly of an instruction is quick &amp; simple:</p>
<div><pre>#<span>include</span> <span><span>&lt;</span>stdio.h<span>&gt;</span></span>
#<span>include</span> <span><span>"</span>bddisasm/disasmtypes.h<span>"</span></span>
#<span>include</span> <span><span>"</span>bddisasm/bddisasm.h<span>"</span></span>

<span>int</span> <span>nd_vsnprintf_s</span>(
    <span>char</span> *buffer,
    <span>size_t</span> sizeOfBuffer,
    <span>size_t</span> count,
    <span>const</span> <span>char</span> *format,
    <span>va_list</span> argptr
    )
{
    <span>return</span> <span>vsnprintf</span>(buffer, sizeOfBuffer, format, argptr);
}

<span>void</span>* <span>nd_memset</span>(<span>void</span> *s, <span>int</span> c, <span>size_t</span> n)
{
    <span>return</span> <span>memset</span>(s, c, n);
}


<span>int</span> <span>main</span>()
{
    INSTRUX ix;
    <span>uint8_t</span> code[] = { <span>0x48</span>, <span>0x8B</span>, <span>0x48</span>, <span>0x28</span> };

    NDSTATUS status = <span>NdDecodeEx</span>(&amp;ix, code, <span>sizeof</span>(code), ND_CODE_64, ND_DATA_64);

    <span><span>//</span> Check if decoding failed.</span>
    <span>if</span> (!<span>ND_SUCCESS</span>(status))
    {
        <span>printf</span>(<span><span>"</span>Decode failed with error <span>%x</span>!<span>
</span><span>"</span></span>, status);
        <span>return</span> -<span>1</span>;
    }

    <span><span>//</span> Checking if the instruction is a MOV.</span>
    <span>if</span> (ix.<span>Instruction</span> == ND_INS_MOV)
    {
        <span>printf</span>(<span><span>"</span>The instruction is mov!<span>
</span><span>"</span></span>);
    }

    <span><span>//</span> Checking if memory is read by the instruction.</span>
    <span>if</span> (!!(ix.<span>MemoryAccess</span> &amp; ND_ACCESS_ANY_READ))
    {
        <span>printf</span>(<span><span>"</span>The instruction reads memory!<span>
</span><span>"</span></span>);
    }

    <span><span>//</span> Checking if the destination is the RCX register.</span>
    <span>if</span> (<span>ND_IS_OP_REG</span>(&amp;ix.<span>Operands</span>[<span>0</span>], ND_REG_GPR, <span>8</span>, REG_RCX))
    {
        <span>printf</span>(<span><span>"</span>The first op is RCX!<span>
</span><span>"</span></span>);
    }

    <span><span>//</span> Checking if the source is memory.</span>
    <span>if</span> (ix.<span>Operands</span>[<span>1</span>].<span>Type</span> == ND_OP_MEM)
    {
        <span>printf</span>(<span><span>"</span>Source is memory!<span>
</span><span>"</span></span>);

        <span>if</span> (ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>HasSeg</span>)
        {
            <span>printf</span>(<span><span>"</span>    Segment reg: <span>%d</span><span>
</span><span>"</span></span>, ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>Seg</span>);
        }

        <span>if</span> (ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>HasBase</span>)
        {
            <span>printf</span>(<span><span>"</span>    Base reg: <span>%d</span><span>
</span><span>"</span></span>, ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>Base</span>);
        }

        <span>if</span> (ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>HasIndex</span>)
        {
            <span>printf</span>(<span><span>"</span>    Index reg: <span>%d</span>, scale: <span>%d</span><span>
</span><span>"</span></span>, ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>Index</span>, ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>Scale</span>);
        }

        <span>if</span> (ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>HasDisp</span>)
        {
            <span>printf</span>(<span><span>"</span>    Displacement: 0x<span>%llx</span><span>
</span><span>"</span></span>, ix.<span>Operands</span>[<span>1</span>].<span>Info</span>.<span>Memory</span>.<span>Disp</span>);
        }
    }

    <span><span>//</span> Create the text disassembly for this instruction.</span>
    <span>char</span> text[ND_MIN_BUF_SIZE];

    <span>NdToText</span>(&amp;ix, <span>0</span>, <span>sizeof</span>(text), text);

    <span>printf</span>(<span><span>"</span>Instruction: <span>%s</span><span>
</span><span>"</span></span>, text);

    <span>return</span> <span>0</span>;
}</pre></div>
<h2>Credits</h2>
<p>The entire Bitdefender HVI team.</p>
</article>
      </div>
  </div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>