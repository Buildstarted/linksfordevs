<!DOCTYPE html>
<html lang="en">
<head>
    <title>
April Update for WPF on .NET Core 3.0 &#xB7; Issue #607 &#xB7; dotnet/wpf &#xB7; GitHub -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>April Update for WPF on .NET Core 3.0 · Issue #607 · dotnet/wpf · GitHub</h1><div><div id="" class="d-block comment-body markdown-body  js-comment-body"><p>Last December, Scott Guthrie and Kevin  Gallo <a href="https://blogs.windows.com/buildingapps/2018/12/04/announcing-open-source-of-wpf-windows-forms-and-winui-at-microsoft-connect-2018/" rel="nofollow">announced</a> that Windows Presentation Foundation (WPF), Windows Forms and WinUI would be open sourced.  .NET Core 3.0 Preview 1 added support for building client apps using WPF, Windows Forms, and XAML Islands.  We apologize that the WPF repository has been a little quiet, but the WPF team here at Microsoft has been hard at work at the follow items:</p><ol><li>We <a href="https://github.com/dotnet/wpf/pull/473" data-hovercard-type="pull_request" data-hovercard-url="/dotnet/wpf/pull/473/hovercard">onboarded</a> to the <a href="https://github.com/dotnet/arcade">Arcade SDK</a> based Build infrastructure</li><li>The <a href="https://github.com/dotnet/wpf/pull/489" data-hovercard-type="pull_request" data-hovercard-url="/dotnet/wpf/pull/489/hovercard">WPF project template</a> has been made available</li><li>We recently open sourced <a href="https://github.com/dotnet/wpf/pull/504" data-hovercard-type="pull_request" data-hovercard-url="/dotnet/wpf/pull/504/hovercard">PresentationBuildTasks</a> along with <a href="https://github.com/dotnet/wpf/tree/master/packaging/Microsoft.NET.Sdk.WindowsDesktop">Microsoft.NET.Sdk.WindowsDesktop</a>!</li><li>We’re defining the overall test approach for WPF in a GitHub world</li></ol><p>This  work was foundational and will help us as we continue with open sourcing remaining WPF components. If you’re interested in the nitty gritty details of what we’ve been doing, take a look <strong>below</strong>.</p><h3>Going Forward</h3><p>As we move towards the .NET Core 3.0 General Availability (GA) we will post more regular updates to this repository.  For the next few months, our plan is to:</p><ul><li>Continue porting the WPF component list to this repo</li><li>Port regression tests so that validation against new Pull Requests can be automated</li></ul><h3>Community Contributions</h3><p>We know that the community is eager to contribute and we thank you for your contributions and engagement to date!</p><p>Our primary focus for the initial .NET Core 3.0 release for WPF is to achieve parity with .NET Framework. Priority will be given to contributions that align with that goal.  The most help that we need right now is on bug fixes that specifically target parity between .NET Core and .NET Framework.</p><p>You can learn more from our <a href="https://github.com/dotnet/wpf/blob/master/Documentation/contributing.md">contributing guidelines</a>.   If you have questions, suggestions, or concerns, please let us know.</p><p>The <a href="https://github.com/dotnet/arcade/blob/master/Documentation/ArcadeSdk.md">Arcade SDK</a> offers several benefits for products that build as part of NET Core. When the WPF team adopted this SDK for our builds, we realized some work needed to be done.</p><p>WPF was one of the first teams to onboard and build native C++ vcxproj based projects (as against CMake etc. projects) within the Arcade SDK ecosystem. This resulted in some focused work to ensure that C++ related properties and targets are appropriately tuned to ensure MSBuild just worked to build WPF with the same compiler, linker etc. settings that it has been historically built with.</p><p>We also realized that the <a href="https://github.com/dotnet/arcade/blob/master/Documentation/CorePackages/Packaging.md">default infrastructure in place for NuGet packaging</a> – which is quite adequate for most projects - was insufficient for the needs of WPF given the fact that we produce native assemblies in the mix.</p><p>In addition to this, we also produce transport packages out of the WPF repository that contain the WPF .NET Core assemblies (like System.Xaml.dll, WindowsBase.dll), the native-RID specific assemblies (like wpfgfx_cor3.dll, PresentationNative_cor3.dll), reference assemblies (ref\WindowsBase.dll, ref\System.Xaml.dll), and satellite (resource) assemblies (like cs\System.Xaml.resources.dll, de\System.Xaml.resources.dll).</p><p>This fact is in itself not unique to WPF – all .NET Core repositories generate transport packages – but WPF’s unique composition involving RID-specific native assemblies necessitated us to customize the <a href="https://github.com/dotnet/wpf/blob/master/eng/WpfArcadeSdk/tools/Packaging.targets">packaging process</a> to suit our needs.</p><p>Currently, we publish the following transport packages to the <a rel="nofollow" href="https://dotnetfeed.blob.core.windows.net/dotnet-windowsdesktop/index.json">https://dotnetfeed.blob.core.windows.net/dotnet-windowsdesktop/index.json</a> feed. These can be viewed using <a href="https://github.com/NuGetPackageExplorer/NuGetPackageExplorer">NuGet Package Explorer</a> (which, BTW, has been ported to WPF on .NET Core 3.0!):</p><ul><li>Microsoft.DotNet.Wpf.GitHub<br>o	runtime.win-x64.Microsoft.DotNet.Wpf.GitHub<br>o	runtime.win-x86.Microsoft.DotNet.Wpf.GitHub</li><li>Microsoft.DotNet.Wpf.DncEng<br>o	runtime.win-x64.Microsoft.DotNet.Wpf.DncEng<br>o	runtime.win-x86.Microsoft.DotNet.Wpf.DncEng</li><li>Microsoft.DotNet.Wpf.ProjectTemplates</li><li>Microsoft.NET.Sdk.WindowsDesktop</li></ul><p>And since WPF has two repositories (one on <a href="https://github.com/dotnet/wpf">GitHub</a> with the open-sourced projects, and another one internal within Microsoft), we realized that coherence in the way we build things was important. To achieve this, we have centralized all our build props/targets and published it as an MSBuild SDK onto the same NuGet feed - Microsoft.DotNet.Arcade.Wpf.Sdk.</p><p><em>Note: All of these transport packages are intended for internal use by the .NET Core build systems and repos only and should not be consumed directly for any other purpose.<br>In addition to onboarding native C++ projects and building transport packages right, we also undertook some work to build C++/CLI assemblies. WPF has two notable C++/CLI based assemblies – PresentationCore.dll and System.Printing.dll.</em></p><p><em>Note: In terms of build dependencies, PresentationBuildTasks and System.Xaml can be built independently, WindowsBase requires only System.Xaml as a dependency, PresentationCore requires WindowsBase &amp; System.Xaml, and so on. Nearly all of the remaining WPF assemblies require System.Xaml, WindowsBase, and PresentationCore. In short, PresentationCore is far in front of our build dependency chain, and we had to ensure that a build system that we open-source can handle builds for PresentationCore.dll, as well as for other C++/CLI .NET Core DLL effectively.</em></p><p>Many of you are probably aware that there is currently no support for building C++/CLI in .NET Core. In Dev16.0 (aka Visual Studio 2019), the C++ team has added limited capability (note: I didn’t write “support”) for compiling C++/CLI assemblies targeting .NET Core. For more details on how this works in the WPF codebase, please dig into Wpf.Cpp.props/Wpf.Cpp.targets and search for /clr:netcore. (If you try to use this today, it will probably not work for you due to a bug – please wait until Visual Studio 2019 Preview 2 comes out).</p><p>This limited support for C++/CLI has no SDK support yet. In other words, we couldn’t just take a C++/CLI vcxproj project that targeted .NET Framework and retarget it to .NET Core – the underlying NuGet support for discovering .NET Core references and a myriad of other build targets just didn’t exist. We worked with several colleagues in the .NET and C++ teams to build our own limited support for discovering the right NuGet references during build (see CppCliHelper in Wpf.Cpp.targets)</p><p>Over the years, WPF codebase had accumulated a number of cycles between some of the assemblies. The team never really noticed them because our builds depended on reference-assemblies from the previous builds (ref-assemblies that were checked in with sources in binary form).</p><p>In our .NET Core codebase, we do not check-in any binaries and require everything to be built from sources. In order to do this right, we spent some effort analyzing the dependencies between various assemblies and ensured that our build used project-references exclusively. Wherever we couldn’t break a cycle, we created small (and scoped) hand-crafted synthetic ref-assembly projects that could stand-in for the real one.</p><p>These “cycle-breakers” (there are 8 of these at last count) haven’t moved over to GitHub yet, but here is one illustrative example that is used to build PresentationUI.csproj. We found that PresentationFramework required PresentationUI to build, and PresentationUI required PresentationFramework (thus a cycle). We isolated just the small subset of types from PresentationFramework that were needed to build PresentationUI and put it into a special-purpose project that acts as a build-time cycle-breaker helper. This type of refactoring also helps prevents additional types from being added to these cycles, and will allow us to decide upon how to remove these cycles in the future.</p><p>dotnet-wpf-int/src/Microsoft.DotNet.Wpf/cycle-breakers/PresentationUI/PresentationUI.internals.cs</p><div class="highlight highlight-source-cs"><pre><span class="pl-c"><span class="pl-c">//</span> Licensed to the .NET Foundation under one or more agreements.</span><span class="pl-c"><span class="pl-c">//</span> The .NET Foundation licenses this file to you under the MIT license.</span><span class="pl-c"><span class="pl-c">//</span> See the LICENSE file in the project root for more information.</span><span class="pl-c"><span class="pl-c">//</span> ------------------------------------------------------------------------------</span><span class="pl-c"><span class="pl-c">//</span> Changes to this file must follow the http://aka.ms/api-review process.</span><span class="pl-c"><span class="pl-c">//</span> ------------------------------------------------------------------------------</span><span class="pl-k">using</span><span class="pl-en">System</span>.<span class="pl-en">Runtime</span>.<span class="pl-en">CompilerServices</span>;
<span class="pl-k">using</span><span class="pl-en">MS</span>.<span class="pl-en">Internal</span>.<span class="pl-en">PresentationCore</span>;

[<span class="pl-k">assembly</span>:<span class="pl-en">InternalsVisibleTo</span>(<span class="pl-smi">BuildInfo</span>.<span class="pl-smi">PresentationFramework</span>)]

<span class="pl-c"><span class="pl-c">//</span> This is the minimum set of surface area required to enable PresentationFramework to build.</span><span class="pl-k">namespace</span><span class="pl-en">MS</span>.<span class="pl-en">Internal</span>.<span class="pl-en">Documents</span>.<span class="pl-en">Application</span>
{
    <span class="pl-k">internal</span><span class="pl-k">sealed</span><span class="pl-k">partial</span><span class="pl-k">class</span><span class="pl-en">DocumentStream</span>
    {
        <span class="pl-k">internal</span><span class="pl-k">static</span><span class="pl-k">readonly</span><span class="pl-k">string</span><span class="pl-smi">XpsFileExtension</span>;
    }

    <span class="pl-k">internal</span><span class="pl-k">partial</span><span class="pl-k">struct</span><span class="pl-en">DocumentApplicationState</span>
    {
        <span class="pl-k">private</span><span class="pl-k">int</span><span class="pl-smi">_dummyPrimitive</span>;
        <span class="pl-k">public</span><span class="pl-en">DocumentApplicationState</span>(<span class="pl-k">double</span><span class="pl-smi">zoom</span>, <span class="pl-k">double</span><span class="pl-smi">horizontalOffset</span>, <span class="pl-k">double</span><span class="pl-smi">verticalOffset</span>, <span class="pl-k">int</span><span class="pl-smi">maxPagesAcross</span>) { <span class="pl-k">throw</span><span class="pl-c1">null</span>; }
        <span class="pl-k">public</span><span class="pl-k">double</span><span class="pl-smi">HorizontalOffset</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">int</span><span class="pl-smi">MaxPagesAcross</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">double</span><span class="pl-smi">VerticalOffset</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">double</span><span class="pl-smi">Zoom</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
    }
}

<span class="pl-k">namespace</span><span class="pl-en">MS</span>.<span class="pl-en">Internal</span>.<span class="pl-en">Documents</span>
{
    <span class="pl-k">internal</span><span class="pl-k">sealed</span><span class="pl-k">partial</span><span class="pl-k">class</span><span class="pl-en">DocumentApplicationDocumentViewer</span> : <span class="pl-k">System</span>.<span class="pl-k">Windows</span>.<span class="pl-k">Controls</span>.<span class="pl-en">DocumentViewer</span>
    {
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">RequestSigners</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">ShowRMCredentialManager</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">ShowRMPermissions</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">ShowRMPublishingUI</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">ShowSignatureSummary</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">static</span> System.Windows.Input.<span class="pl-en">RoutedUICommand</span><span class="pl-smi">Sign</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span> MS.Internal.Documents.Application.<span class="pl-en">DocumentApplicationState</span><span class="pl-smi">StoredDocumentApplicationState</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } <span class="pl-k">set</span> { } }
        <span class="pl-k">public</span><span class="pl-k">void</span><span class="pl-en">SetUIToStoredState</span>() { }
    }
    
    <span class="pl-k">internal</span><span class="pl-k">partial</span><span class="pl-k">class</span><span class="pl-en">FindToolBar</span> : <span class="pl-k">System</span>.<span class="pl-k">Windows</span>.<span class="pl-k">Controls</span>.<span class="pl-en">ToolBar</span><span class="pl-c"><span class="pl-c">//</span>, System.Windows.Markup.IComponentConnector</span>
    {
        <span class="pl-k">public</span><span class="pl-en">FindToolBar</span>() { }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">DocumentLoaded</span> { <span class="pl-k">set</span> { } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">FindEnabled</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">MatchAlefHamza</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">MatchCase</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">MatchDiacritic</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">MatchKashida</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">MatchWholeWord</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">string</span><span class="pl-smi">SearchText</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } }
        <span class="pl-k">public</span><span class="pl-k">bool</span><span class="pl-smi">SearchUp</span> { <span class="pl-k">get</span> { <span class="pl-k">throw</span><span class="pl-c1">null</span>; } <span class="pl-k">set</span> { } }
        <span class="pl-k">public</span> event System.<span class="pl-en">EventHandler</span><span class="pl-smi">FindClicked</span> { add { } remove { } }
        <span class="pl-k">public</span><span class="pl-k">void</span><span class="pl-en">GoToTextBox</span>() { }
    }
}</pre></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>