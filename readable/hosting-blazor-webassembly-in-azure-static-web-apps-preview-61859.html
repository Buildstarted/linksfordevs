<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Hosting Blazor WebAssembly in Azure Static Web Apps (Preview) - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Hosting Blazor WebAssembly in Azure Static Web Apps (Preview) - linksfor.dev(s)"/>
    <meta property="og:description" content="I wanted to see if I could get Blazor Wasm apps in the new Azure Static Web Apps preview service.  Turns out you can...with some caveats :-)."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://timheuer.com/blog/hosting-blazor-in-azure-static-web-apps/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Hosting Blazor WebAssembly in Azure Static Web Apps (Preview)</title>
<div class="readable">
        <h1>Hosting Blazor WebAssembly in Azure Static Web Apps (Preview)</h1>
            <div>Reading time: 10-13 minutes</div>
        <div>Posted here: 19 May 2020</div>
        <p><a href="https://timheuer.com/blog/hosting-blazor-in-azure-static-web-apps/">https://timheuer.com/blog/hosting-blazor-in-azure-static-web-apps/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div itemprop="articleBody mainEntityOfPage"> <p>At Build the Azure team launched a new service called Azure Static Web Apps in preview. This service is tailored for scenarios that really work well when you have a static web site front-end and using things like serverless APIs for your communication to services/data/etc. You should read more about it here: <a href="https://aka.ms/swapreview"><strong>Azure Static Web Apps</strong></a> .</p> <p>Awesome, so <strong>Blazor WebAssembly (Wasm) </strong>is a static site right? Can you use this new service to host your Blazor Wasm app? Let’s find out!</p> <blockquote> <p><strong>NOTE</strong>: This is just an experiment for me.&nbsp; This isn’t any official stance of what may come with the service, but only what we can do now with Blazor apps.&nbsp; As you see with Azure Static Web Apps there is a big end-to-end there with functions, debug experience, etc.&nbsp; I just wanted to see if Blazor Wasm (as a static web app) could be pushed to the service.</p> </blockquote> <p>As of this post the service is tailored toward JavaScript app development and works seamlessly in that setup. However, with a few tweaks (for now) we can get our Blazor app working. First we’ll need to get things setup!</p> <h2 id="setting-up-your-repo">Setting up your repo<a title="Bookmark link for setting-up-your-repo" href="#setting-up-your-repo"><i></i></a></h2> <p>The fundamental aspects of the service are deployment from your source in GitHub using GitHub Actions. So first you’ll need to make sure you have a repository on GitHub.com for your repository. I’m going to continue to use my <a href="https://timheuer.com/blog/deploy-blazor-webassembly-applications-on-azure-using-github-actions-wasm/">Blazor Wasm Hosting Sample repo</a> (which has different options as well to host Wasm apps) for this example. My app is the basic Blazor Wasm template, nothing fancy at all. Okay, we’ve got the repo set up, now let’s get the service setup.</p> <h2 id="create-the-azure-static-web-app-resource">Create the Azure Static Web App resource<a title="Bookmark link for create-the-azure-static-web-app-resource" href="#create-the-azure-static-web-app-resource"><i></i></a></h2> <p>You’ll need an Azure account of course and if you don’t have one, you can <a href="https://azure.com/free?WT.mc_id=timheuer-blog-timheuer">create an Azure account for free</a>. Go ahead and do that and then come back here to make it easier to follow along. Once you have the account you’ll log in to the Azure portal and create a new resource using the Static Web App (Preview) resource type. You’ll see a simple form to fill out a few things like your resource group and a name for your app and the region.</p> <p><a href="https://storage2.timheuer.com/bwasmstatic1.png"><img title="Screenshot of Azure Portal configuration" alt="Screenshot of Azure Portal configuration" src="https://storage2.timheuer.com/bwasmstatic1_thumb.png" width="1157" height="923"></a></p> <p>The last thing there is where you’ll connect to your GitHub repo and make selections for what repo to use. It will launch you to authorize Azure Static Web Apps to make changes to your repo (for workflow and adding secrets):</p> <p><a href="https://storage2.timheuer.com/bwasmstatic2.png"><img title="Picture of GitHub permission prompt" alt="Picture of GitHub permission prompt" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic2_thumb.png" width="839" height="662"></a></p> <p>Once authorized then more options show for the resource creation and just choose your org/repo/branch:</p> <p><a href="https://storage2.timheuer.com/bwasmstatic3.png"><img title="Picture of GitHub repo choices" alt="Picture of GitHub repo choices" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic3_thumb.png" width="1114" height="382"></a></p> <p>Once you complete these selections, click Review+Create and the resource will create! The process will take a few minutes, but when complete you’ll have a resource with a few key bits of information:</p> <p><a href="https://storage2.timheuer.com/bwasmstatic4.png"><img title="Picture of finished Azure resource config" alt="Picture of finished Azure resource config" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic4_thumb.png" width="1883" height="461"></a></p> <p>The URL of your app is auto-generated with probably a name that will make you chuckle a bit. Hey, it’s random, don’t try to make sense of it, just let the names like “icy cliff” inspire you. Additionally you’ll see the “Workflow file” YAML file and link. If you click it (go ahead and do that) it will take us over to your repo and the GitHub Actions workflow file that was created. We’ll take a look at the details next, but for now if you navigate to the Actions tab of your repo, you’ll see a fail. This is expected for us right now in our steps…more on that later.</p> <p><a href="https://storage2.timheuer.com/bwasmstatic5.png"><img title="Picture of workflows in Actions" alt="Picture of workflows in Actions" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic5_thumb.png" width="1554" height="361"></a></p> <p>In addition to the Actions workflow navigate to the settings tab of your repo and choose Secrets. You’ll see a new secret (with that random name) was added to your repo.</p> <p><a href="https://storage2.timheuer.com/bwasmstatic6.png"><img title="Picture of GitHub secrets" alt="Picture of GitHub secrets" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic6_thumb.png" width="1182" height="721"></a></p> <p>This is the API token needed to communicate with the service.</p> <p>Why can’t you see the token itself and give the secret a different name? Great question. For now just know that you can’t. Maybe this will change, but this is the secret name you’ll have to use. It’s cool though, the only place it is used is in your workflow file. Speaking of that file, let’s take a look more in detail now!</p> <h2 id="understanding-and-modifying-the-action">Understanding and modifying the Action<a title="Bookmark link for understanding-and-modifying-the-action" href="#understanding-and-modifying-the-action"><i></i></a></h2> <p>So the initial workflow file was created and added to your workflow has all the defaults. Namely we’re going to focus on the “jobs” node of the workflow, which should start about line 12. The previous portions in the workflow define the triggers which you can modify if you’d like but they are intended to be a part of your overall CI/CD flow with the static site (automatic PR closure, etc.). Let’s look at the jobs as-is:</p> <div><div id="highlighter_37247"><table><tbody><tr><td><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p></td><td><div><p><code>jobs:</code></p><p><code>&nbsp;&nbsp;</code><code>build_and_deploy_job:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code><code>: github.event_name == </code><code>'push'</code> <code>|| (github.event_name == </code><code>'pull_request'</code> <code>&amp;&amp; github.event.action != </code><code>'closed'</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>runs-on: ubuntu-latest</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>name: Build and Deploy Job</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>steps:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>- uses: actions</code><code>/checkout</code><code>@v2</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>- name: Build And Deploy</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>id</code><code>: builddeploy</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>uses: Azure</code><code>/static-web-apps-deploy</code><code>@v0.0.1-preview</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>with:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_ICY_CLIFF_XXXXXXXXX }}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>repo_token: ${{ secrets.GITHUB_TOKEN }} </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>action: </code><code>'upload'</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app_location: </code><code>'/'</code> </p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>api_location: </code><code>'api'</code> </p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app_artifact_location: </code><code>''</code> </p></div></td></tr></tbody></table></div></div> <p>Before we make changes, let’s just look. Oh see that parameter for api token? It’s using that secret that was added to your repo. GitHub Actions has built in a ‘secrets’ object that can reference those secrets and this is where that gets used. That is required for proper deployment. So there, that is where you can see the relationship to it being used!</p> <p>This is great, but also was failing for our Blazor Wasm app. Why? Well because it’s trying to build it and doesn’t quite know how yet. That’s fine, we can help nudge it along! I’m going to make some changes here. First, change the checkout version to @v2 on Line 18. This is faster.</p> <blockquote> <p><strong>NOTE</strong>: I suspect this will change to be the default soon, but you can change it now to use v2</p> </blockquote> <p>Now we need to get .NET SDK set up to build our Blazor app. So after the checkout step, let’s add another to first set up the .NET SDK we want to use. It will look like this, using the setup-dotnet action:</p> <div><div id="highlighter_827470"><table><tbody><tr><td><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p></td><td><div><p><code>- uses: actions</code><code>/checkout</code><code>@v2</code></p><p><code>- name: Setup .NET SDK</code></p><p><code>&nbsp;&nbsp;</code><code>uses: actions</code><code>/setup-dotnet</code><code>@v1</code></p><p><code>&nbsp;&nbsp;</code><code>with:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>dotnet-version: 3.1.201</code></p></div></td></tr></tbody></table></div></div> <p>Now that we are setup, we need to build the Blazor app. So let’s add another step that explicitly builds the app and publish to a specific output location for easy reference in a later step!</p> <div><div id="highlighter_959663"><table><tbody><tr><td><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p></td><td><div><p><code>- uses: actions</code><code>/checkout</code><code>@v2</code></p><p><code>- name: Setup .NET SDK</code></p><p><code>&nbsp;&nbsp;</code><code>uses: actions</code><code>/setup-dotnet</code><code>@v1</code></p><p><code>&nbsp;&nbsp;</code><code>with:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>dotnet-version: 3.1.201</code></p><p><code>- name: Build App</code></p><p><code>&nbsp;&nbsp;</code><code>run: dotnet publish -c Release -o published</code></p></div></td></tr></tbody></table></div></div> <p>There, now we’ve got it building!</p> <blockquote> <p><strong>NOTE</strong>: I’m taking a bit of a shortcut in this tutorial and I’d recommend the actual best practice of Restore, Build, Test, Publish as separate steps. This allows you to more precisely see what is going on in your CI and clearly see what steps may fail, etc.</p> </blockquote> <p>Our Blazor app is now build and prepared for static deployment in the location ‘published’ referenced in our ‘-o’ parameter during build. All the files we need start now at the root of that folder. A typical Blazor Wasm app published will have a web.config and a wwwroot at the published location.</p> <p><a href="https://storage2.timheuer.com/bwasmstatic7.png"><img title="Picture of Windows explorer folders" alt="Picture of Windows explorer folders" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic7_thumb.png" width="518" height="250"></a></p> <p>Let’s get back to the action defaults. Head back to the YAML file and look for the ‘app_location’ parameter in the action. We now want to change that to our published folder location, but specifically the wwwroot location as the root (as for now the web.config won’t be helpful). So you’d change it to look like this (a snippet of the YAML file)</p> <div><div id="highlighter_498409"><table><tbody><tr><td><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p></td><td><div><p><code>- uses: actions</code><code>/checkout</code><code>@v2</code></p><p><code>- name: Setup .NET SDK</code></p><p><code>&nbsp;&nbsp;</code><code>uses: actions</code><code>/setup-dotnet</code><code>@v1</code></p><p><code>&nbsp;&nbsp;</code><code>with:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>dotnet-version: 3.1.201</code></p><p><code>- name: Build App</code></p><p><code>&nbsp;&nbsp;</code><code>run: dotnet publish -c Release -o published</code></p><p><code>- name: Build And Deploy</code></p><p><code>&nbsp;&nbsp;</code><code>id</code><code>: builddeploy</code></p><p><code>&nbsp;&nbsp;</code><code>uses: Azure</code><code>/static-web-apps-deploy</code><code>@v0.0.1-preview</code></p><p><code>&nbsp;&nbsp;</code><code>with:</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN_ICY_CLIFF_XXXXXXXXX }}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>repo_token: ${{ secrets.GITHUB_TOKEN }} </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>action: </code><code>'upload'</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app_location: </code><code>'published/wwwroot'</code> </p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>api_location: </code><code>''</code> </p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app_artifact_location: </code><code>'published/wwwroot'</code> </p></div></td></tr></tbody></table></div></div> <p>This tells the Static Web App deployment steps to push our files from here. Go ahead and commit the workflow file back to your repository and the Action will trigger and you will see it complete:</p> <p><a href="https://storage2.timheuer.com/bwasmstatic8.png"><img title="Screenshot of completed workflow steps" alt="Screenshot of completed workflow steps" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" data-src="https://storage2.timheuer.com/bwasmstatic8_thumb.png" width="1361" height="1108"></a></p> <p>We have now successfully deployed our Blazor Wasm app to the Static Web App Preview service! Now you’ll note that there is a lot of output in the Deploy step, including warnings about build warnings. For now this is okay as we are not relying on the service to build our app (yet). You’ll also see the note about Functions not being found (reminder we changed our parameter to not have that value). Let’s talk about that.</p> <h2 id="what-about-the-functions?">What about the Functions?<a title="Bookmark link for what-about-the-functions?" href="#what-about-the-functions?"><i></i></a></h2> <p>For now the service will automatically build a JavaScript app including serverless functions built using JavaScript in this one step. If you are a .NET developer you’ll most likely be building your functions in C# along with your Blazor front-end. Right now the service doesn’t automatically allow you to specify an API location in your project for C# function classes and automatically build them. Hopefully in the future we will see that be enabled. Until then you’ll have to deploy your functions app separately. You can do it in the same workflow though if it is a part of your same repo. You’ll just leverage the other <a href="https://github.com/Azure/functions-action?WT.mc_id=timheuer-blog-timheuer">Azure Functions GitHub Action</a> to accomplish that. Maybe I should update my sample repo to also include that?</p> <h2 id="considerations-and-summary">Considerations and Summary<a title="Bookmark link for considerations-and-summary" href="#considerations-and-summary"><i></i></a></h2> <p>So you’ve now seen it’s possible, but you should also know the constraints. I’ve already noted that you’ll need to deploy your Functions app separately and you have to build your Blazor app in a pre-step (which I think is a good thing personally), so you may be wondering why might you use this service. I’ll leave that answer to you as I think there are scenarios will it will be helpful and I do believe this is just a point in time for the preview and more frameworks hopefully will be supported. I know those of us on the .NET team are working with the service to better support Blazor Wasm, for example.</p> <p>Another thing that Blazor build does for you is produce pre-compressed files for Brotli and Gzip compression delivered from the server. When you host Blazor Wasm using ASP.NET Core, we deliver these files to the client automatically (via middleware). When you host using Windows App Service you can supply a web.config to have rewrite rules that will solve this for you as well (you can in Linux as well). For the preview of the Static Web App service and Blazor Wasm, you won’t automatically get this, so your app size will be the default uncompressed sizes of the assemblies and static assets.</p> <p>I hope that you can give the service a try with your apps regardless of if they are Blazor or not. I just wanted to demonstrate how you would get started using the preview making it work with your Blazor Wasm app. I’ve added this specific workflow to my Blazor Wasm Deployment Samples repository where you can see other forms as well on Azure to deploy the client app.</p> <p>I hope this helps see what’s possible in preview today!</p> </div><p>Please enjoy some of these other recent posts...</p></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>