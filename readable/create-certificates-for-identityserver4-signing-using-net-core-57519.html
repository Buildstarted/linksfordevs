<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Create Certificates for IdentityServer4 signing using .NET Core - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Create Certificates for IdentityServer4 signing using .NET Core - linksfor.dev(s)"/>
    <meta property="article:author" content="damienbod"/>
    <meta property="og:description" content="This article shows how to create certificates for an IdentityServer4 application to use for signing and token validation. The certificates are created using the CertificateManager nuget package. Bo&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://damienbod.com/2020/02/10/create-certificates-for-identityserver4-signing-using-net-core/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
                <span style="cursor: default" title="linksfor.dev(s) has been running for 1 year! :partypopper:">ðŸŽ‰</span>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Create Certificates for IdentityServer4 signing using .NET Core</title>
<div class="readable">
        <h1>Create Certificates for IdentityServer4 signing using .NET Core</h1>
            <div>by damienbod</div>
            <div>Reading time: 7-8 minutes</div>
        <div>Posted here: 10 Feb 2020</div>
        <p><a href="https://damienbod.com/2020/02/10/create-certificates-for-identityserver4-signing-using-net-core/">https://damienbod.com/2020/02/10/create-certificates-for-identityserver4-signing-using-net-core/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

							<p>This article shows how to create certificates for an IdentityServer4 application to use for signing and token validation. The certificates are created using the <a href="https://www.nuget.org/packages/CertificateManager/">CertificateManager </a>nuget package. Both RSA and ECDsa certificates can be used for signing in IdentityServer4.</p>
<p><strong>Code:</strong> <a href="https://github.com/damienbod/AspNetCoreCertificates/tree/master/src/CreateIdentityServer4Certificates">Certificates for IdentityServer4 signing using .NET Core</a></p>
<p><strong>Creating the Certificates in .NET Core</strong></p>
<p>A simple <a href="https://docs.microsoft.com/en-us/dotnet/core/get-started">.NET Core console</a> application is used to create the certificates. This type of application can run on most of the standard operating systems. Create a new console application and add the package <a href="https://www.nuget.org/packages/CertificateManager/">CertificateManager</a>. The package <em>Microsoft.Extensions.DependencyInjection</em> is also required to initialize the package.</p>
<div><div id="highlighter_569945"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p></td><td><div><p><code>&lt;</code><code>Project</code> <code>Sdk</code><code>=</code><code>"Microsoft.NET.Sdk"</code><code>&gt;</code></p><p><code>&nbsp;</code><code>&lt;</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>OutputType</code><code>&gt;Exe&lt;/</code><code>OutputType</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>TargetFramework</code><code>&gt;netcoreapp3.1&lt;/</code><code>TargetFramework</code><code>&gt;</code></p><p><code>&nbsp;</code><code>&lt;/</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;</code><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>PackageReference</code> <code>Include</code><code>=</code><code>"CertificateManager"</code> <code>Version</code><code>=</code><code>"1.0.3"</code> <code>/&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>PackageReference</code> <code>Include</code><code>=</code><code>"Microsoft.Extensions.DependencyInjection"</code> <code>Version</code><code>=</code><code>"3.1.1"</code> <code>/&gt;</code></p><p><code>&nbsp;</code><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&lt;/</code><code>Project</code><code>&gt;</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Creating a RSA certificate</strong></p>
<p>A self signed RSA certificate can be created using the CertificateManager <strong>NewRsaSelfSignedCertificate</strong> method. The <strong>key size</strong> must be at least <strong>2048</strong>. The following example also adds TLS server and client authentication OID extensions, so that the certificate could also be used for client authentication.</p>
<div><div id="highlighter_171270"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p></td><td><div><p><code>public</code> <code>static</code> <code>X509Certificate2 CreateRsaCertificate(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>dnsName, </code><code>int</code> <code>validityPeriodInYears)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>basicConstraints = </code><code>new</code> <code>BasicConstraints</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>CertificateAuthority = </code><code>false</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>HasPathLengthConstraint = </code><code>false</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>PathLengthConstraint = 0,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Critical = </code><code>false</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>subjectAlternativeName = </code><code>new</code> <code>SubjectAlternativeName</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>DnsName = </code><code>new</code> <code>List&lt;</code><code>string</code><code>&gt;{ dnsName }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>x509KeyUsageFlags = X509KeyUsageFlags.DigitalSignature;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>enhancedKeyUsages = </code><code>new</code> <code>OidCollection</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>Oid(</code><code>"1.3.6.1.5.5.7.3.1"</code><code>),&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>Oid(</code><code>"1.3.6.1.5.5.7.3.2"</code><code>),&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>certificate = _cc.NewRsaSelfSignedCertificate(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>DistinguishedName { CommonName = dnsName },</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>basicConstraints,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>ValidityPeriod</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValidFrom = DateTimeOffset.UtcNow,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValidTo = DateTimeOffset.UtcNow.AddYears(validityPeriodInYears)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>subjectAlternativeName,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enhancedKeyUsages,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>x509KeyUsageFlags,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>RsaConfiguration { KeySize = 2048 }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>certificate;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Creating a ECDsa certificate</strong></p>
<p>A self signed ECDsa certificate can be created using the CertificateManager <strong>NewECDsaSelfSignedCertificate</strong> method. </p>
<div><div id="highlighter_162087"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p></td><td><div><p><code>public</code> <code>static</code> <code>X509Certificate2 CreateECDsaCertificate(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>dnsName, </code><code>int</code> <code>validityPeriodInYears)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>basicConstraints = </code><code>new</code> <code>BasicConstraints</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>CertificateAuthority = </code><code>false</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>HasPathLengthConstraint = </code><code>false</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>PathLengthConstraint = 0,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Critical = </code><code>false</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>san = </code><code>new</code> <code>SubjectAlternativeName</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>DnsName = </code><code>new</code> <code>List&lt;</code><code>string</code><code>&gt;{ dnsName }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>x509KeyUsageFlags = X509KeyUsageFlags.DigitalSignature;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>enhancedKeyUsages = </code><code>new</code> <code>OidCollection {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>Oid(</code><code>"1.3.6.1.5.5.7.3.1"</code><code>),&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>Oid(</code><code>"1.3.6.1.5.5.7.3.2"</code><code>),&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>};</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>certificate = _cc.NewECDsaSelfSignedCertificate(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>DistinguishedName { CommonName = dnsName },</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>basicConstraints,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>ValidityPeriod</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValidFrom = DateTimeOffset.UtcNow,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValidTo = DateTimeOffset.UtcNow.AddYears(validityPeriodInYears)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>san,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enhancedKeyUsages,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>x509KeyUsageFlags,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>new</code> <code>ECDsaConfiguration());</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>certificate;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Creating and exporting the pfx files</strong></p>
<p>The RSA and the ECDsa certificate can then be created and exported as a pfx file. </p>
<div><div id="highlighter_202163"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p></td><td><div><p><code>static</code> <code>CreateCertificates _cc;</code></p><p><code>static</code> <code>void</code> <code>Main(</code><code>string</code><code>[] args)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>sp = </code><code>new</code> <code>ServiceCollection()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddCertificateManager()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.BuildServiceProvider();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_cc = sp.GetService&lt;CreateCertificates&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>rsaCert = CreateRsaCertificate(</code><code>"localhost"</code><code>, 10);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>ecdsaCert = CreateECDsaCertificate(</code><code>"localhost"</code><code>, 10);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>string</code> <code>password = </code><code>"1234"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>iec = sp.GetService&lt;ImportExportCertificate&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>rsaCertPfxBytes = </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>iec.ExportSelfSignedCertificatePfx(password, rsaCert);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>File.WriteAllBytes(</code><code>"rsaCert.pfx"</code><code>, rsaCertPfxBytes);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>ecdsaCertPfxBytes = </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>iec.ExportSelfSignedCertificatePfx(password, ecdsaCert);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>File.WriteAllBytes(</code><code>"ecdsaCert.pfx"</code><code>, ecdsaCertPfxBytes);</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Using the Certificates in IdentityServer4</strong></p>
<p>The certificate pfx exports can then be used in IdentityServer4. Depending on how you deploy the web application which contains the IdentityServer4 library, you would choose the best way to load the certificates into the application, for example a thumbprint which loads from the host operating system, or a certificate loaded from Key Vault in Azure.</p>
<p>If using a RSA certificate, you can load this directly using the <strong>AddSigningCredential</strong> IdentityServer4 extension method.</p>
<div><div id="highlighter_563548"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p></td><td><div><p><code>var</code> <code>rsaCertificate = </code><code>new</code> <code>X509Certificate2(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Path.Combine(_environment.ContentRootPath, </code><code>"rsaCert.pfx"</code><code>), </code><code>"1234"</code><code>);</code></p><p><code>services.AddIdentityServer()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddSigningCredential(rsaCertificate) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryIdentityResources(Config.GetIdentityResources())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryApiResources(Config.GetApiResources())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryClients(Config.GetClients())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddAspNetIdentity&lt;ApplicationUser&gt;()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddProfileService&lt;IdentityWithAdditionalClaimsProfileService&gt;();</code></p></div></td></tr></tbody></table></div></div>
<p>using the jwks endpoint, you can view the certificate public details used for validation:</p>
<p> /.well-known/openid-configuration/jwks</p>
<p><img data-attachment-id="13283" data-permalink="https://damienbod.com/2020/02/10/create-certificates-for-identityserver4-signing-using-net-core/id4_signingcert_01/" data-orig-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png" data-orig-size="802,741" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="id4_signingCert_01" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=640" src="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=640&amp;h=591" alt="" width="640" height="591" srcset="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=640&amp;h=591 640w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=150&amp;h=139 150w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=600&amp;h=554 600w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png?w=768&amp;h=710 768w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_01.png 802w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>When using an ECDsa certificate, you need to create a <strong>ECDsaSecurityKey</strong> instance from the ECDsa certificate private key. This can then be used as a parameter in the AddSigningCredential method.</p>
<div><div id="highlighter_967893"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p></td><td><div><p><code>var</code> <code>ecdsaCertificate = </code><code>new</code> <code>X509Certificate2(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Path.Combine(_environment.ContentRootPath, </code><code>"ecdsaCert.pfx"</code><code>), </code><code>"1234"</code><code>);</code></p><p><code>ECDsaSecurityKey ecdsaCertificatePublicKey</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>= </code><code>new</code> <code>ECDsaSecurityKey(ecdsaCertificate.GetECDsaPrivateKey());</code></p><p><code>services.AddIdentityServer()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddSigningCredential(ecdsaCertificatePublicKey, </code><code>"ES256"</code><code>) </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryIdentityResources(Config.GetIdentityResources())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryApiResources(Config.GetApiResources())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddInMemoryClients(Config.GetClients())</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddAspNetIdentity&lt;ApplicationUser&gt;()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddProfileService&lt;IdentityWithAdditionalClaimsProfileService&gt;();</code></p></div></td></tr></tbody></table></div></div>
<p>The jwks endpoint uses an EC certificate.</p>
<p><img data-attachment-id="13284" data-permalink="https://damienbod.com/2020/02/10/create-certificates-for-identityserver4-signing-using-net-core/id4_signingcert_02/" data-orig-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png" data-orig-size="775,419" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="id4_signingCert_02" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=640" src="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=640&amp;h=346" alt="" width="640" height="346" srcset="https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=640&amp;h=346 640w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=150&amp;h=81 150w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=600&amp;h=324 600w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png?w=768&amp;h=415 768w, https://damienbod.files.wordpress.com/2020/01/id4_signingcert_02.png 775w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p><strong>Links:</strong></p>
<p><a href="https://github.com/damienbod/AspNetCoreCertificates" rel="nofollow">https://github.com/damienbod/AspNetCoreCertificates</a></p>
<p><a href="https://www.nuget.org/packages/CertificateManager/" rel="nofollow">https://www.nuget.org/packages/CertificateManager/</a></p>
<p><a href="http://docs.identityserver.io/en/latest/topics/crypto.html" rel="nofollow">http://docs.identityserver.io/en/latest/topics/crypto.html</a></p>
<p><a href="http://docs.identityserver.io/en/latest/topics/mtls.html" rel="nofollow">http://docs.identityserver.io/en/latest/topics/mtls.html</a></p>
<p><a href="https://docs.microsoft.com/en-us/dotnet/core/get-started" rel="nofollow">https://docs.microsoft.com/en-us/dotnet/core/get-started</a></p>

							
							
						</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
</body>
</html>