<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Remove BinaryFormatter from the shared framework in .NET 5 &#xB7; Issue #29976 &#xB7; dotnet/runtime - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Remove BinaryFormatter from the shared framework in .NET 5 &#xB7; Issue #29976 &#xB7; dotnet/runtime - linksfor.dev(s)"/>
    <meta property="article:author" content="msftgits"/>
    <meta property="og:description" content="We&amp;#39;ve known for a long while that BinaryFormatter is a dangerous type and that it&amp;#39;s responsible for many of the security vulnerabilities real-world .NET applications have seen in recent yea..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/corefx/issues/38760"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Remove BinaryFormatter from the shared framework in .NET 5 &#xB7; Issue #29976 &#xB7; dotnet/runtime</title>
<div class="readable">
        <h1>Remove BinaryFormatter from the shared framework in .NET 5 &#xB7; Issue #29976 &#xB7; dotnet/runtime</h1>
            <div>by msftgits</div>
            <div>Reading time: 52-66 minutes</div>
        <div>Posted here: 24 Jun 2019</div>
        <p><a href="https://github.com/dotnet/corefx/issues/38760">https://github.com/dotnet/corefx/issues/38760</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-channel="marked-as-read:issue:558467383">

              
<div data-gid="MDU6SXNzdWU1NTg0NjczODM=" data-url="/_render_node/MDU6SXNzdWU1NTg0NjczODM=/issues/body" data-channel="issue:558467383">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issue-558467383">
  <div data-body-version="cfd76ee5587f73ae6fbf373e25b37dbb" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>We've known for a long while that <code>BinaryFormatter</code> is a dangerous type and that it's responsible for many of the security vulnerabilities real-world .NET applications have seen in recent years. In .NET Core 1.x, the type was removed from the product entirely, and it was brought back in .NET Core 2.0 under the guise of "app compat".</p>
<p>Though as of the time of this writing there are no known types in .NET Core which can be leveraged by <code>BinaryFormatter</code> to achieve RCE, it is impractical to make this guarantee going forward. As new types are introduced (or existing types from the full Framework are re-introduced) I have no doubt that one of them will contain such a vector that we weren't able to catch during development due to the complexity of this system.</p>
<p>Some applications use a custom <code>SerializationBinder</code> to mitigate attacks both on .NET Core and in full Framework. The engineering team's current understanding is that a properly-written <code>SerializationBinder</code> is sufficient to block RCE attacks. However, <em>this is not a guarantee</em>, and even so, a custom <code>SerializationBinder</code> cannot mitigate other attacks like DoS within the <code>BinaryFormatter</code> infrastructure itself.</p>
<p>All of this said, the conclusion is that <strong><code>BinaryFormatter</code> is not an appropriate serialization format for application developers to be using in a cloud-connected world.</strong> It was a mistake for us to bring it back in .NET Core 2.0, as us re-introducing it into the shared framework gives the type an undeserved air of respectability, like we're nodding and implicitly approving its usage by modern applications.</p>
<p>To address this, and to eventually migrate applications off of <code>BinaryFormatter</code>, I propose the following steps. These steps will <em>only</em> affect customers who target .NET 5 or above for their applications.</p>
<ol>
<li>
<p>Remove <code>BinaryFormatter</code> from the shared framework and into its own standalone package that must be manually retrieved and installed into the application.</p>
</li>
<li>
<p>Mark the <code>BinaryFormatter</code> type itself with <code>[Obsolete]</code>, or include in the package a code analyzer which warns on the type's usage. Force developers to explicitly acknowledge that they're calling an extremely dangerous API and that they must be certain the data is coming from a trusted location.</p>
</li>
<li>
<p>Document the <code>BinaryFormatter</code> code base as legacy only. Clearly communicate that Microsoft is making no further investments in this code base, and all bug reports or feature requests will be immediately closed.</p>
</li>
<li>
<p>Create a separate "safe" (type-limiting, bounds-checking, etc.) serializer whose payload format is <code>BinaryFormatter</code>-compatible and which can be used to deserialize existing payloads in a safe fashion, even if those payloads originate from an untrusted source. The API surface will look different than the traditional <code>BinaryFormatter.Deserialze</code> call due to needing to configure the serializer on a per-call basis, but at minimum it gives applications a way to read existing payloads. This allows them to migrate their data without leaving them hanging. This serializer could be in the same package that <code>BinaryFormatter</code> is in.</p>
</li>
</ol>
<p>These steps would serve to modernize the runtime and SDK by eliminating a type which has no place in today's development cycle, it serves as a forcing function to get application developers to fix potential vulnerabilities in their code, and it provides <em>on an opt-in basis</em> a way for applications to continue to work if they really must continue using the type going forward.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>

</div>


              

  


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDUzODY1MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDUzODY1MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDUzODY1MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504538651">
    <div>
      

  

<details data-body-version="655531f632c47858e0b009c71fd41a66">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="655531f632c47858e0b009c71fd41a66" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/796298/59945499-ac2aec00-941c-11e9-8d67-ca25d6868a2d.gif"><img src="https://user-images.githubusercontent.com/796298/59945499-ac2aec00-941c-11e9-8d67-ca25d6868a2d.gif" alt="tenor"></a></p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDUzOTkxNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDUzOTkxNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDUzOTkxNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/Symbai/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Symbai"><img height="40" width="40" alt="@Symbai" src="https://avatars1.githubusercontent.com/u/14368203?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504539915">
    <div>
      

  

<details data-body-version="9a46a86aaca503ff9a0d15dd49b72585">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9a46a86aaca503ff9a0d15dd49b72585" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>BinaryFormatter has the advantage that it's incredibly fast. Faster than any other formatter, by a lot. If you consider to remove it, please consider to provide a reasonable alternative, which is fast and secure. If you do, then I don't see any reason to not agree with that, regardless whether my personal opinion counts or not.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MjM2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MjM2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDU0MjM2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/NickCraver/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/NickCraver"><img height="40" width="40" alt="@NickCraver" src="https://avatars0.githubusercontent.com/u/454813?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504542366">
    <div>
      

  

<details data-body-version="d80fec0dc7306dee2d3b0efaa205b556">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d80fec0dc7306dee2d3b0efaa205b556" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/Symbai/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Symbai">@Symbai</a> I think a very important thing to keep in mind here is that BinarySerializer is not fast and secure. It is fast largely because it is not secure.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MjY2NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MjY2NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDU0MjY2NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504542665">
    <div>
      

  

<details data-body-version="4ebf92bb6f0a7125f38636c31a61b05e">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4ebf92bb6f0a7125f38636c31a61b05e" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/Symbai/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Symbai">@Symbai</a> If you're looking for something where the payload format is human-readable, check out the work taking place in this repo in the <code>System.Text.Json</code> namespace. Or if you want pure performance over human readability, you may want to check out Google's ProtoBuf project, which has C# APIs.</p>
<p>In the proposal I have in this issue, I do suggest that we should create a <code>BinaryFormatter</code>-compatible "safe" deserializer, but performance wouldn't be a driving factor of such a serializer. (Though we wouldn't do anything to intentionally tank performance.) One of the other formats might be more appropriate for your needs given this.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MzczMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU0MzczMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDU0MzczMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ChrisMcKee/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ChrisMcKee"><img height="40" width="40" alt="@ChrisMcKee" src="https://avatars3.githubusercontent.com/u/83597?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504543730">
    <div>
      

  

<details data-body-version="9dbbf838d787ce549e5e0af89a546dcc">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9dbbf838d787ce549e5e0af89a546dcc" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Pushing it into its own package seems a reasonable compromise.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU4OTQ0MA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDU4OTQ0MA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDU4OTQ0MA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/tebeco/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/tebeco"><img height="40" width="40" alt="@tebeco" src="https://avatars0.githubusercontent.com/u/2266487?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504589440">
    <div>
      

  

<details data-body-version="9d4d798c3dbe466b009c05c0a9eb0ff5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDY1NTYxOA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDY1NTYxOA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDY1NTYxOA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/samsosa/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/samsosa"><img height="40" width="40" alt="@samsosa" src="https://avatars0.githubusercontent.com/u/32570890?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504655618">
    <div>
      

  

<details data-body-version="4a033f6cdfddd18406bc47c637852069">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4a033f6cdfddd18406bc47c637852069" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Or if you want pure performance over human readability, you may want to check out Google's ProtoBuf project, which has C# APIs.</p>
</blockquote>
<p>Than maybe replace the BinaryFormatter implementation under the hood with ProtoBuf?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDc3NTg3Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNDc3NTg3Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNDc3NTg3Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/ViktorHofer/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ViktorHofer"><img height="40" width="40" alt="@ViktorHofer" src="https://avatars1.githubusercontent.com/u/7412651?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-504775873">
    <div>
      

  

<details data-body-version="6ef515154a800582c0119654c86ce499">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="6ef515154a800582c0119654c86ce499" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I'm sure you are considering partners here which are relying on BinaryFormatter in .NET Core. Keep in mind to loop them in whenever you are starting this effort.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTEyMTg5Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTEyMTg5Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTEyMTg5Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell"><img height="40" width="40" alt="@mgravell" src="https://avatars0.githubusercontent.com/u/17328?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505121893">
    <div>
      

  

<details data-body-version="da033bd51a7513b8225f2ae197274f46">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="da033bd51a7513b8225f2ae197274f46" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/samsosa/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/samsosa">@samsosa</a> just to be explicit re:</p>
<blockquote>
<p>Than maybe replace the BinaryFormatter implementation under the hood with ProtoBuf?</p>
</blockquote>
<p>That isn't a realistic option. Protobuf is a powerful tool, but it has a different feature-set to <code>BinaryFormatter</code>, and there is no good way of making one pretend to be the other, in either direction. Just like <code>XmlSerializer</code>, Json.NET etc are all fundamentally serializers, but don't have he exact same feature set. If people want to use protobuf, that's fine, but they'd need to do that knowingly and deliberately.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTEyMzU0MA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTEyMzU0MA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTEyMzU0MA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mconnew/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mconnew"><img height="40" width="40" alt="@mconnew" src="https://avatars0.githubusercontent.com/u/8648390?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505123540">
    <div>
      

  

<details data-body-version="9ed71d1a1756b5d7a8a252606e725ce5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9ed71d1a1756b5d7a8a252606e725ce5" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I would like to try an put a stop to the trend I'm seeing in multiple issues of ProtoBuf being the solution to all things serialization. It is not a good serialization format, and it was never designed to be one. It is designed to be a compact way to represent a limited set of features for sending an object graph to a gRPC endpoint. It has very severe limitations when trying to be used for general purpose serialization.</p>
<p>It doesn't have support for references so if an object appears in an object graph multiple times, it will be completely serialized multiple times. We've had customers get tripped up by this before when they overrode <code>Equals</code> or <code>GetHashCode</code> incorrectly and ended up with two separate objects on deserialization which caused application logic problems.</p>
<p>The lack of references means it can't handle cycles in your object model which will cause infinite recursion on serialization. It simply cannot handle that scenario at all.</p>
<p>There have been attempts to come up with a way to support references to allow for these two scenarios. The one that protobuf.net does needs explicit opt-in for the types/members which need this support. This requires understanding your entire object model and know where cycles might exist and when having duplicates will be a problem. This could be a LOT of work depending on how complex your data model is. It greatly complicates your on-wire representation and none of the benchmarks I've seen have been against an OM using these features. Any benchmarks on size and speed of serialization need to take this into account. My understanding is that the Google implementation of gRPC serialization doesn't support this feature and expects you to support this mechanism at your OM level and not at the serializer level.</p>
<p>As the <a href="https://github.com/protocolbuffers/protobuf/issues/5504#issuecomment-475703452" data-hovercard-type="issue" data-hovercard-url="/protocolbuffers/protobuf/issues/5504/hovercard">response from the ProtoBuf team</a> has been that they aren't going to build this capability into the protocol and go implement your own solution, you lose the interoperability that ProtoBuf is supposed to bring as there will always be competing ways to do this by different ProtoBuf libraries.</p>
<p>Protobuf is a bad format for use with an existing set of classes. It's best use is when designing a new OM with these limitation in mind. E.g. I'm creating a new gRPC endpoint and so define my data model using IDL and then convert that to classes. Going the reverse direction is going to be problematic for many people as Protobuf is not a general purpose serialization format.</p>
<p>Incidentally, I read a blog post comparing MessagePack, ProtoBuf, JSON.NET and DataContractSerializer comparing size of output and speed of serialization and deserialization where it showed DataContractSerializer to be the worst on both fronts. I cloned their code and added a variation for DataContractSerializer using a binary XmlDictionaryReader/Writer and the size was about 10% bigger than ProtoBuf, and the time to serialize and deserialize was about 10% slower than ProtoBuf. If you were to have multiple duplicate objects and you turned on the reference support in DCS, you could easily create a case where DCS is both faster and smaller than ProtoBuf.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTE1NDQwOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTE1NDQwOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTE1NDQwOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505154409">
    <div>
      

  

<details data-body-version="e346df571e796ceb56941eb98199128c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e346df571e796ceb56941eb98199128c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/mconnew/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mconnew">@mconnew</a> Thank you for the excellent analysis! You're right - I should have been more careful with my wording in my earlier comment. I didn't intend to suggest that ProtoBuf is The One True Replacement(tm) going forward, just that it's one of many options available to developers depending on their scenarios.</p>
<p>I think part of the solution is that we need to convince the ecosystem that a general purpose serializer that can handle arbitrary object graphs is not a sustainable concept. Serializers like <code>DataContractSerializer</code> handle this to a limited extent, but they also place restrictions on the shape the graph must take and limits on what deserialization looks like. Even support for cyclic object graphs is inherently unsafe unless the application explicitly expects to deserialize such cycles, as <code>DataContractSerializer</code> allows on an opt-in basis.</p>
<p>Whether this is a documentation issue that gives best practices for creating DTOs which can be safely serialized, whether we recommend switching to a safe but restricted-capability serializer like <code>DataContractSerializer</code>, or whether we take some other course of action are all up in the air. (It's also possible that we do nothing, but clearly I'm opposed to that idea since I opened this issue. <g-emoji alias="blush" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f60a.png">😊</g-emoji>)</p>
<p>Another option - though one that might be more difficult to swallow since it'll require significant work within the ecosystem - would be to create a set of educational guidelines that explains in detail the concepts behind serialization, trust boundaries, and how the two interact. This would make individual developers responsible for analyzing their specific scenarios and choosing appropriate data models and serialization formats which are appropriate for their needs, while also giving them the knowledge to make trade-offs when necessary. I'm not a fan of this solution by itself because it presents a steep learning curve for our audience and goes against .NET's general premise of creating usable frameworks. But perhaps these educational guidelines could be useful in conjunction with another more approachable solution.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTE1NzA2Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTE1NzA2Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTE1NzA2Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mconnew/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mconnew"><img height="40" width="40" alt="@mconnew" src="https://avatars0.githubusercontent.com/u/8648390?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505157067">
    <div>
      

  

<details data-body-version="8d537e888a520f3f0e52da71d090be01">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8d537e888a520f3f0e52da71d090be01" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>, my comment was in response to my seeing multiple places where people were suggesting using ProtoBuf for serialization. It's NOT a serialization format and I just wanted to make sure I put my thoughts out there somewhere contextually relevant.<br>
I believe that DataContractSerializer does about the best job it's possible to do with serializing. We could do with adding some helpers to enable the use of the binary XmlDicationaryReader/Writer as the dictionary needs to be transmitted OOB otherwise you pay the high cost of the Text output.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTMwNjc0OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTMwNjc0OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTMwNjc0OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell"><img height="40" width="40" alt="@mgravell" src="https://avatars0.githubusercontent.com/u/17328?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505306749">
    <div>
      

  

<details data-body-version="cb340efacfc1a7db0b96e6b86431ae9a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="cb340efacfc1a7db0b96e6b86431ae9a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/mconnew/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mconnew">@mconnew</a> I don't want to distract from the conversation about BinaryFormatter, so I don't suggest "here", but I'd love to have an offline conversation with you about what does and doesn't qualify as a "serialization format" and why; it seems we have some different ideas there, and I'd love to hear a new perspective. I'm easy to get hold of if you're willing :)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTMyNjI1OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTMyNjI1OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTMyNjI1OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/MarcoRossignoli/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/MarcoRossignoli"><img height="40" width="40" alt="@MarcoRossignoli" src="https://avatars1.githubusercontent.com/u/7894084?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505326258">
    <div>
      

  

<details data-body-version="a3f1ceffb7682da727f36d6aed4b1c16">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a3f1ceffb7682da727f36d6aed4b1c16" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>but I'd love to have an offline conversation with you about what does and doesn't qualify as a "serialization format" and why;</p>
</blockquote>
<p>IMO would be useful for all devs have an "open" discussion/listening on it...all devs have to serialize something sometimes in career and the hide issues and choices are not so trivial.<br>
Maybe a linked "discussion" to this issue.<br>
Not mandatory though.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTQxMTc4Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNTQxMTc4Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNTQxMTc4Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell"><img height="40" width="40" alt="@mgravell" src="https://avatars0.githubusercontent.com/u/17328?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-505411782">
    <div>
      

  

<details data-body-version="a46ec9f02f85c7dc98a45b0550408578">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNzQyMjcyMQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUwNzQyMjcyMQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUwNzQyMjcyMQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-507422721">
    <div>
      

  

<details data-body-version="16d5547e99a90c493d4f678d7f058d90">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="16d5547e99a90c493d4f678d7f058d90" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>BinaryFormatter is an established format to transfer data through the clipboard and during drag'n'drop operations and likely to be in use in existing Desktop Framework applications. If you rip that out of the .NET Core framework without a replacement that can produce/consume the same binary data then .NET Core 5 applications will be unable to interact with Desktop Framework applications through drag'n'drop/clipboard when custom formats are in use.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTIxNjUwNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTIxNjUwNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUxMTIxNjUwNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-511216505">
    <div>
      

  

<details data-body-version="6d2683bf3a9526f4f135c1c05b047f98">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="6d2683bf3a9526f4f135c1c05b047f98" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Thanks <a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> for your feedback! Your point that there needs to be some replacement is well-taken, and I think the proposal outlined here addresses the issue. Let me elaborate.</p>
<p>The proposal here is to remove <code>BinaryFormatter</code> from the shared framework specifically. The consequence is that any component that is part of the shared Framework (such as WinForms or WPF) or any component that references only the shared Framework without any additional external NuGet packages will not be able to perform arbitrary object deserialization via <code>BinaryFormatter</code>. In fact, both WinForms and WPF have already made strides in this regard (e.g., <a data-error-text="Failed to load issue title" data-id="462912139" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/wpf/issues/1132" data-hovercard-type="issue" data-hovercard-url="/dotnet/wpf/issues/1132/hovercard" href="https://github.com/dotnet/wpf/issues/1132">dotnet/wpf#1132</a>) to disallow arbitrary object deserialization while still retaining support for deserializing very specific allowed types.</p>
<p>In the scenario you describe, even though the Framework itself won't have default built-in support for deserializing arbitrary objects on clipboard / drag-and-drop operations, the application can continue to support the legacy behavior via hooking the clipboard / drag-and-drop handlers. For example, if the application hooks the "paste" handler and determines that the incoming data is a <code>BinaryFormatter</code>-formatted payload, the application's custom handler can call into the deserializer directly. I conceptualized a "safe" <code>BinaryFormatter</code>-payload compatible deserializer earlier in this issue, and I'd encourage application developers to use that deserializer in place of the legacy deserializer whenever possible. But in the end, even though we may discourage it, nobody will prevent application code from invoking the old unsafe arbitrary object deserialization routine. The difference going forward is that the Framework itself shall not call into the unsafe deserializer on the application's behalf; the app developer explicitly needs to write that code.</p>
<p>This should provide a viable outline for applications which absolutely need to retain the existing Full Framework behaviors to be ported to .NET Core.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTIyMDI4NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDUxMTIyMDI4NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDUxMTIyMDI4NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-511220284">
    <div>
      

  

<details data-body-version="df4b98b87bcb0a483dd73c1dbd4e6d38">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="df4b98b87bcb0a483dd73c1dbd4e6d38" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Ok, I see where you are going with that, moving it into a separate component may work. However note that just deserialization won't be enough for all compat scenarios, interacting with Desktop Applications through clipboard or drag'n'drop may also require serialization (e.g. if you want to put something into the clipboard that the existing Desktop Application should consume, or drag something onto a Desktop Application Window).</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzAxNDY1Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzAxNDY1Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzAxNDY1Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547014657">
    <div>
      

  

<details data-body-version="e82408a5ef335a5a33dd197c2e76e6aa">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="e82408a5ef335a5a33dd197c2e76e6aa" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Just a quick reminder that new client / server applications that cost millions to develop and will have to be maintained for more than a decade are currently being built using <code>BinaryFormatter</code>. Even in times of "assume breach" using <code>BinaryFormatter</code> over a secured internal network connection has it's merits and the stability of the API surface is crucial for the credibility of the .NET platform.</p>
<p>Moving the <code>BinaryFormatter</code> to a separate Nuget package in .NET 5 maybe an option but</p>
<blockquote>
<p>Document the BinaryFormatter code base as legacy only. Clearly communicate that Microsoft is making no further investments in this code base, and all bug reports or feature requests will be immediately closed.</p>
</blockquote>
<p>goes too far from my point of view. Especially as it's not completely clear that a viable (=feature-complete; drop-in - with some configuration) more secure replacement that will handle serialization AND deserialization will be available.</p>
<p>Currently we're using .NET Framework on the client (MvvmCross, WPF) and .NET Core 2.2 (ASP.NET Core) on the server planning to migrate both to .NET Core 3. Having to live with the fear (=project risk) that Microsoft may "drop" / declare obsolete APIs just added to their newest platform is not a great outlook.</p>
<p>Still I appreciate that this discussion is happening in the open and customers can participate and hopefully be heard ;)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzA3NzU0Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzA3NzU0Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzA3NzU0Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547077542">
    <div>
      

  

<details data-body-version="1b96fbac64c3e23deed3c01470442198">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1b96fbac64c3e23deed3c01470442198" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC">@HaraldMuehlhoffCC</a> Thank you for your feedback. Your comments hit on a few key points which I think are prime examples of why I had proposed this work item to begin with.</p>
<p>You are correct in that new applications (in 2019!) are being built with <code>BinaryFormatter</code> dependencies. IMO this is in large part due to the fact that Microsoft as a whole has not presented a unified message saying "do not use this feature going forward." Yes, there's the occasional blog post or security conference where we mention the problems, and the official docs discourage its use. But out of our entire developer ecosystem only a small fraction are tuned into those channels. The proposal here is intentionally disruptive, forcing developers who are using this type (or who want to use it) to take explicit action to continue using it in future versions. The acknowledgement process doesn't need to be difficult. Perhaps the process is as easy as pulling down another nuget package into the application - that's only a few button clicks or a single NuGet Package Manager command. Or perhaps it's adding a particular line to the .csproj file.</p>
<blockquote>
<p>Even in times of "assume breach" using <code>BinaryFormatter</code> over a secured internal network connection has it's merits</p>
</blockquote>
<p>As a security professional, I <strong>strongly</strong> disagree with this statement. This might be an appropriate assumption for your application today, as perhaps you control both the client and the server in tightly restricted environments. But as the application evolves, it's almost certain that this assumption might not hold going forward. Want to move your service to the cloud? Want to deploy the client on customers' workstations? Want to add the ability for additional less-authenticated users to access the application (perhaps in a read-only mode)? These processes are all now significantly more difficult because the application protocol is based on the insecure <code>BinaryFormatter</code> format.</p>
<p>Another way to think about this is to ask the following questions: "Would the server be comfortable allowing the client to upload an arbitrary .exe to the server and run it as part of request processing? Would the client be comfortable allowing the server to transmit an arbitrary .exe and run it as part of response processing? Is it acceptable for this behavior to be a permanent part of the application's request/response protocol?"</p>
<p>I would wager that vanishingly few of our developer audience would answer affirmatively to all three questions. But because our messaging on <code>BinaryFormatter</code> has been somewhat weak, our developers by and large don't realize that this is what they're signing up for. In my mind that's far more perilous for the ecosystem than any API adjustment would be.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzA5ODc0Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzA5ODc0Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzA5ODc0Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547098746">
    <div>
      

  

<details data-body-version="c85ce8115d8857b549e66a5eb6bc2325">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c85ce8115d8857b549e66a5eb6bc2325" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a> Thanks for your comment. We have indeed control both of the client and the server and it's running in a tightly restricted environment (electric utility companies). And this won't change for the client I'm talking about. Our web client is of course using a different protocol (JSON).</p>
<p>I don't quite get your running arbitrary code analogy. In a sense all protocols use some binary encoding (in the JSON &amp; XML cases it's just UTF-8 ...). Just because the <code>BinaryFormatter</code> isn't using a human readable format doesn't mean that it's creating some sort of executable. Or is there some dark magic inside the implementation generating and executing IL? But still then it would be possible to add sanity / security checks ... this was the whole point about IL.<br>
Also we're not dependant on the exact details of the binary format as we don't store it. So if there is something wrong with the implementation details of the current encoding we'd be happy to switch to another Formatter AS LONG AS it would be feature-compatible and not much slower.</p>
<p>Finally my primary concern with your proposal was</p>
<blockquote>
<p>Document the BinaryFormatter code base as legacy only. Clearly communicate that Microsoft is making no further investments in this code base, and all bug reports or feature requests will be immediately closed.</p>
</blockquote>
<p>How does this make the systems that will still be relying on <code>BinaryFormatter</code> any safer?  Especially the "all bug reports [...] will be immediately closed" part ...</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEwMDY1OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEwMDY1OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzEwMDY1OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547100659">
    <div>
      

  

<details data-body-version="5f797af86616cffb465dd808b69fbaef">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="5f797af86616cffb465dd808b69fbaef" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><em>Just because the BinaryFormatter isn't using a human readable format doesn't mean that it's creating some sort of executable.</em></p>
<p>I'm afraid you're incorrect. It's not a matter of human readable versus binary, it's how the serialization works. BinaryFormatter puts the class information inside the serialized data. When it's deserialized that information is used to create the objects embedded in the file. This is dangerous, as there are classes within .NET which can be abused to deliver code execution. In fact json.net has the same option, but it's off by default. In BinaryFormatter we can't turn it off at all.</p>
<p>There have been numerous presentations about this at various hacker conferences, the seminal work being <a href="https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH_US_12_Forshaw_Are_You_My_Type_WP.pdf" rel="nofollow">Are you my type?</a> and the best recent one is <a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf" rel="nofollow">Friday the 13th JSON Attacks</a>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEyMDYzMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEyMDYzMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzEyMDYzMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell"><img height="40" width="40" alt="@mgravell" src="https://avatars0.githubusercontent.com/u/17328?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547120633">
    <div>
      

  

<details data-body-version="384be9ada2e8b5d2266c13c26a557f0c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="384be9ada2e8b5d2266c13c26a557f0c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p> we'd be happy to switch to another Formatter AS LONG AS it would be feature-compatible and not much slower.</p>
<p>It is hard to comment on "feature-compatible" here without talking about
what features you're using, as several of BinaryFormatter's "features" are
really anti-features, but: you might find it relatively easy and performant
to try protobuf-net (I'm hugely biased, disclosure blah blah). I should
note that protobuf-net *also* had a similar optional / opt-in "bake your
type meta into the data" feature, but I'm killing it hard in V3 for
multiple reasons including the security aspect and the fact that a lot of
types have moved around in .NET Core. Fortunately protobuf has a related
"any" concept, which I'll be implemented very soon.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEyOTQ5Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzEyOTQ5Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzEyOTQ5Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547129497">
    <div>
      

  

<details data-body-version="6ba223ebc18a1f0ee6e38f27c9a62141">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0MDU4OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0MDU4OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE0MDU4OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547140589">
    <div>
      

  

<details data-body-version="205208f51505ce4b98dccee9a72b5e53">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="205208f51505ce4b98dccee9a72b5e53" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Thank you, <a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a> and <a data-hovercard-type="user" data-hovercard-url="/users/mgravell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mgravell">@mgravell</a>! I get that security is not free &amp; I've been actively following quite a few security folks on Twitter. Nevertheless for our very large object model I wouldn't necessarily want to add as much metadata as protobuf-net seems to require (even though we generate part of our model via a custom ORM and could generate attributes for some of the classes programmatically).</p>
<p>We also do some clever stuff serializing LINQ-Queries using custom serializable Expression trees; even serializing Types (via their names &amp; structural info in some cases). But we make sure on the server that the resulting queries are safe.</p>
<p>I would prefer some sort of whitelisting the classes over all this verbosity. Actually shouldn't I be able to do exactly this in a custom <code>ISurrogateSelector</code> implementation (or custom <code>SerializationBinder</code>)?!</p>
<p>Also we control the server, the client, the network and secure the communication channel; so I'm still not completely sold that the security implications are so pressing in our case.</p>
<p>And as other formatters can be made unsafe by adding types / classes (see <a rel="nofollow" href="https://www.newtonsoft.com/json/help/html/SerializationSettings.htm#TypeNameHandling">https://www.newtonsoft.com/json/help/html/SerializationSettings.htm#TypeNameHandling</a>) <code>BinaryFormatter</code> can be made safe(er) by controlling the (de)serialized types.<br>
So from my point of view there's nothing inherently "evil" with regards to <code>BinaryFormatter</code>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0MjM5NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0MjM5NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE0MjM5NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547142394">
    <div>
      

  

<details data-body-version="5a14f3aa566b3f0794c5c2bbdc3e2f23">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="5a14f3aa566b3f0794c5c2bbdc3e2f23" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>As soon as we start adding limitations it's no longer compatible. We can't break the entire world like that. And surrogates have their own problems with DoS and OOM attacks.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0Nzg1Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0Nzg1Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE0Nzg1Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547147852">
    <div>
      

  

<details data-body-version="5239626e420a5b7295834b36070a04f9">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="5239626e420a5b7295834b36070a04f9" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a> "With great power comes great responsibility" ;)</p>
<p>The currently available API should make it possible to add whitelisting types if required; see <code>public virtual ISerializationSurrogate GetSurrogate(Type type, StreamingContext context, out ISurrogateSelector selector)</code> in <code>ISurrogateSelector</code> (or <code>SerializationBinder</code> - whichever works best).</p>
<p>I'm with you that it's a good idea to make using the <code>BinaryFormatter</code> a conscious choice; even maybe adding whitelisting as a (changeable) default in .NET 5. I'm not seeing how this would be no longer compatible... (changes would have to be made anyway to reference an external Nuget package).</p>
<p>But forcing your customers to roll their own solutions won't make the world safer either.</p>
<p>Thanks everyone for the enlightening discussion; I have to get a few hours sleep as I have to get up quite early over here in Germany.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0ODkwNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE0ODkwNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE0ODkwNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547148905">
    <div>
      

  

<details data-body-version="4b88a5c6e82cb047a65cde1b20ca4f81">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4b88a5c6e82cb047a65cde1b20ca4f81" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Moving it to a separate package doesn't mean you roll your own, you just have to opt-in to using it, with suitable dire warnings.</p>
<p>And then point <a data-error-text="Failed to load issue title" data-id="48337485" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/corefx/issues/4" data-hovercard-type="pull_request" data-hovercard-url="/dotnet/corefx/pull/4/hovercard" href="https://github.com/dotnet/corefx/pull/4">dotnet/corefx#4</a> in Levi's plan would get you a safer one anyway.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE1NDA2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE1NDA2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE1NDA2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547154066">
    <div>
      

  

<details data-body-version="16d093e944d698f72b13164c8495b756">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="16d093e944d698f72b13164c8495b756" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a>  Then just keep it supported (or at the very least hand it to the community like WCF) ... otherwise customers would still be required to "roll their own" or use some other formatter - that wouldn't necessarily be safer - once critical (security) bugs were discovered. (I'm not talking about the architectural shortcomings you've written about)</p>
<blockquote>
<p>Document the BinaryFormatter code base as legacy only. Clearly communicate that Microsoft is making no further investments in this code base, and all bug reports or feature requests will be immediately closed.</p>
</blockquote>
<p>I will look into adding whitelisting for our <code>BinaryFormatter</code> usage utilizing the existing APIs. So hopefully something good will come from this discussion! ;)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE1NzA3OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzE1NzA3OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzE1NzA3OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547157078">
    <div>
      

  

<details data-body-version="1c264e3774ee31ad5dc778376f7d6b6d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1c264e3774ee31ad5dc778376f7d6b6d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>I will look into adding whitelisting for our BinaryFormatter usage utilizing the existing APIs. So hopefully something good will come from this discussion! ;)</p>
</blockquote>
<p>Per <a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a>'s earlier comment (and my original description in the issue), surrogates have their own problems that won't always protect you.</p>
<p><strong>The simple and unfortunate fact is that the <code>BinaryFormatter</code> type is unfixably insecure. Full stop.</strong></p>
<p>That fact is what led to this issue being opened in the first place. Most customers aren't aware that the above sentence explains the state of the world. Hence my desire for somewhat drastic measures to make them aware of this, to migrate existing code away from <code>BinaryFormatter</code>, and to institute within their organizations a blanket ban on using the type in all new code.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>



  

    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzUyMTQ2Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzUyMTQ2Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzUyMTQ2Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547521462">
    <div>
      

  

<details data-body-version="91deca0e660da339ffa4c92d8b459916">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="91deca0e660da339ffa4c92d8b459916" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><em>I'm just not convinced that it really needs to be marked as Obsolete and be left unsupported.</em></p>
<p>What support would you expect? It simply cannot be secured, we cannot touch it without breaking compatibility. It's unsupported now, it's just marking it as obsolete would make that more public.</p>
<p><em>Personal opinion time</em></p>
<p>I want to get .net to the point where you specifically have to opt-in to using insecure code patterns and insecure classes, and, eventually, remove them all together in a future major version because of their dangers. We're not doing the industry any favours by keeping easily abused code in a framework, we have to move on and help our customers find safer alternatives, or let them make the choice to stay with older versions of .net, and the lack of support that entails. Ruby does it. Swift does it. Why not .NET? Back compat is a security albatross around our necks.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU0ODk3Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU0ODk3Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU0ODk3Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547548973">
    <div>
      

  

<details data-body-version="d7766c0ba95c94ebb5e037aaf5d7d0a4">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d7766c0ba95c94ebb5e037aaf5d7d0a4" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>If back compat is so bad why would anyone even bother to be compatible with Desktop Framework in the first place? Right, because it isn't bad, because it is important. Its the only way to win over the devs which have investments on Desktop Framework.</p>
<p>UWP tried exactly that, dropping compatibility in favor of a shiny new model designed for "security". It didn't work out.</p>
<p>Now BinaryFormatter is just a tiny part of the big picture, and there are already a lot of things dropping compatibility on the road to .NET 5. Will it make the difference between success and failure? Probably not. But it will contribute.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU1MzY1Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU1MzY1Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU1MzY1Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547553653">
    <div>
      

  

<details data-body-version="c6f2e96d702f94a70b031270314fbef9">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c6f2e96d702f94a70b031270314fbef9" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>So we shouldn't ever improve?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU2NjAyNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU2NjAyNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU2NjAyNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547566024">
    <div>
      

  

<details data-body-version="2a8eff25ca608bbbadfb9b50aa23d8a5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="2a8eff25ca608bbbadfb9b50aa23d8a5" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Why has the comment by <a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> been marked as off-topic? If even the well-meant comments of collaborators aren't welcome here how can this be an inclusive platform for discourse?<br>
How can Microsoft hope to better understand and serve the needs of it's community &amp; customers if even this civilized discussion between Microsoft-friendly folks makes some "grab their pitchforks" (excuse the pun)?</p>
<blockquote>
<p>When Levi / Barry/ Nick / Mark (and others) are saying to stop using BF, why are you still spending energy trying to "understand use cases"? To me, this reads as: "trying to find scenario's to justify using a BF"?</p>
</blockquote>
<p>My customers don't necessarily know Levi / Barry / Nick / Mark  ... So I have to understand use cases ... and so - in my humble opinion - should everyone that wants to advance security.<br>
Listening to the (very mildy) critical voices shouldn't be that hard.</p>
<blockquote>
<p>So we shouldn't ever improve?</p>
</blockquote>
<p>Discuss (in a friendly way) &amp; deeply understand the multiple different use cases in detail and work out clear migration pathes for each of them. This is hard but will ultimately lead to the best results security-wise &amp; in customer satisfaction. Just my 5ct.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU2NzM3Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU2NzM3Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU2NzM3Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547567372">
    <div>
      

  

<details data-body-version="0b51519a8b7e94e843d2f4c1f6f8bd95">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="0b51519a8b7e94e843d2f4c1f6f8bd95" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Because it's not really off topic, we would like to understand why people would don't want to go through an extra gesture to keep their insecure code going.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MDcwNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MDcwNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU3MDcwNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547570705">
    <div>
      

  

<details data-body-version="0785ddee755a192ababe30bf52b447d5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MDg4OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MDg4OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU3MDg4OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547570888">
    <div>
      

  

<details data-body-version="d54c26f7571750ef99a266a44789e4ab">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="d54c26f7571750ef99a266a44789e4ab" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Why has the comment by <a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> been marked as off-topic?</p>
</blockquote>
<p>Because I marked it as such, I collapse my comments if they aren't directly on topic but still worth posting. I agree this was a border case here.</p>
<blockquote>
<p>we would like to understand why people would don't want to go through an extra gesture to keep their insecure code going.</p>
</blockquote>
<p>doesn't parse for me, but I don't mind if its moved in a separate package or marked obsolete, as long as its still <em>supported</em> (meaning the annotations and class layouts in Core can't change because they are required for BF to work, unless you introduce a compatibility layer). I think it is very premature to declare getting rid of it entirely eventually while still having no plan for a replacement. .NET 3.1 LTS will ship with UI frameworks using BinaryFormatter as default for clipboard/drag'n'drop and you need to have technical knowledge and use some tricks to even store a different serialization format if you are programming new applications instead of porting existing ones.</p>
<p>.NET 5 should have full support, sure you can start marking obsolete if you provide an alternative, but IMHO it should still be in the framework, considering that 3.1 LTS has it as the default. This whole movement to getting rid of it is very much rushed.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MTIyOA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MTIyOA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU3MTIyOA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547571228">
    <div>
      

  

<details data-body-version="44ef7e117d8285aee8cd7cb20310c9df">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MzAzMA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU3MzAzMA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU3MzAzMA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/HaraldMuehlhoffCC/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/HaraldMuehlhoffCC"><img height="40" width="40" alt="@HaraldMuehlhoffCC" src="https://avatars3.githubusercontent.com/u/2997561?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547573030">
    <div>
      

  

<details data-body-version="5f3da6562e802e3a0e7777d5c0fa3fa6">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="5f3da6562e802e3a0e7777d5c0fa3fa6" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Good to know that <a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> hid his comment himself. Peace! ;)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4NDgzNg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4NDgzNg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU4NDgzNg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547584836">
    <div>
      

  

<details data-body-version="4f35204f581f92897fe3863e2246e958">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4f35204f581f92897fe3863e2246e958" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Also I think the whole discussion about BinaryFormatter on the clipboard making a security breach possible is ill placed. The clipboard isn't a security boundary, it is a communication channel.</p>
<p>If a browser (or other application) is allowing placement of untrusted data of arbitrary formats on the clipboard its a browser security issue, just the same as if the browser were executing untrusted data directly.</p>
<p>Making it impossible for applications to communicate in the name of "security", regardless of it being the clipboard or something else, isn't providing any value to the developer or end user, its just adding a false sense of security by dumbing down the applications you can run. Eventually the developers will implement other ways to solve their communication problem between applications, be it named pipes or files in a data exchange folder or whatever else people come up with, and you have the same problem all over again (but probably worse because implemented in nonstandard ways). Removing functionality does not introduce security, it just pretends to and pushes responsibility to the one providing the replacement. Taken to the extreme, if Windows would not exist any longer it wouldn't be their security problem anymore, but the one who provides the replacement. I don't think thats a solution.</p>
<p>So, yes, I believe removing BinaryFormatter doesn't fix any security problems, it just shifts the blame. People who used it in the wrong context will also use the 3rd party replacement in the wrong context. Removing it will not educate them.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4NjQxNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4NjQxNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU4NjQxNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547586414">
    <div>
      

  

<details data-body-version="01693c42748df04e8fe3043912949fe9">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="01693c42748df04e8fe3043912949fe9" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Removing BinaryFormatter doesn't stop applications communicating, it just means they need to find another way to do it, be it json or bson or anything else that is a constrained, safe, serializer. You are painting BinaryFormatter as the only way to do something and that simply isn't true.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4Njk4MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU4Njk4MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU4Njk4MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547586981">
    <div>
      

  

<details data-body-version="c1259a38618f1cb4e346340f9cd5401b">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c1259a38618f1cb4e346340f9cd5401b" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>You are painting BinaryFormatter as the only way to do something and that simply isn't true.</p>
</blockquote>
<p>It is the only builtin and comfortably usable way when using the clipboard. We need new applications to communicate with legacy applications through the clipboard/dnd. As I said before, provide a replacement, give it time to get adopted, THEN you can remove BinaryFormatter from clipboard/dragndrop.</p>
<p>Right now nothing of this happened, there is a discussion about false security, the whole thing looks premature and rushed. Obsoleting it now, splitting it into a separate package in .NET 5 and removing it entirely in say, .NET 6 or something (by dropping the required attributes/interfaces from Core classes), just will lead to soemeone else reimplementing it with the same "security problems". Thats what I tried to describe above.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU5MzczMw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzU5MzczMw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzU5MzczMw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart"><img height="40" width="40" alt="@blowdart" src="https://avatars0.githubusercontent.com/u/796298?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547593733">
    <div>
      

  

<details data-body-version="dc2ce37ea156552dfcf790d9b5d392d3">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="dc2ce37ea156552dfcf790d9b5d392d3" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Given that you can paste data to the clipboard as json with a couple of lines of code, and json is now built in, and re-hydrate to a known object type from json calling binary formatter the only built in way seems quite disingenuous.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzYzNDc1NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzYzNDc1NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzYzNDc1NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547634754">
    <div>
      

  

<details data-body-version="2e4067371867227fe595958724209382">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="2e4067371867227fe595958724209382" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a> either you are I are very mistaken, strings <a href="https://source.dot.net/#System.Windows.Forms/System/Windows/Forms/DataObject.cs,821" rel="nofollow">get serialized via BinaryFormatter</a> and you can't change that because that would break compatibility with existing .NET applications (including Core 3.1 LTS if things are going the way they are, but compatibility with Desktop is my main concern at this point)</p>
<p>Note that I'm talking of custom formats, not the default <code>TEXT</code> format, as any professional application will put a user-readable string into the <code>TEXT</code> format, not some serialized garbage, because when the user pastes/drags into notepad or some textbox you want a readable representation. Data content goes into custom formats so receivers which understand the format can filter for it.</p>
<p>Its not impossible to work around it, but you need indepth knowledge of how WinForms/WPF implement clipboard/drag'n'drop. <a href="https://source.dot.net/#System.Windows.Forms/System/Windows/Forms/DataObject.cs,781" rel="nofollow">Streams get special treatment</a> and serialize their binary content, so if you serialize to json text, then serialize the text into binary data MemoryStream, then put the stream object into the clipboard you get the treatment you want.</p>
<p>Note that this is entirely non-discoverable and not at all default behavior. Default behavior is using BinaryFormatter. People who are just putting their objects into a DataObject to implement copy/paste or drag'n'drop will not think a second thought about how to serialize in a custom format because it just works once you slap a <code>[Serializable]</code> attribute on it. I've seen that done all the time without questioning what this actually does, people just do it to get it working because thats what the exception says is the problem. Once you have published such an application any application (or future version) wanting to interact with it has to use the same format.</p>
<p>Developer experience:</p>
<ul>
<li>you need a custom format to exchange complex data structures during copy/paste or drag'n'drop</li>
<li>the API says you can put any object into, so you put a strongly typed data structure into it</li>
<li>it works just fine within the same process because nothing ever gets serialized</li>
<li>when you try to use it cross-process you get an exception saying its not serializable, so you slap <code>[Serializable]</code> on it to fix the problem and support copy/paste or drag'n'drop between multiple instances of the application</li>
</ul>
<p>at no point you are encouraged to use JSON or something else, the default for any practical purpose is BinaryFormatter</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY2OTE2Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY2OTE2Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzY2OTE2Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/poke/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/poke"><img height="40" width="40" alt="@poke" src="https://avatars0.githubusercontent.com/u/132240?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547669162">
    <div>
      

  

<details data-body-version="1c650ab36e7e6a5b49612ee4de2b9671">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1c650ab36e7e6a5b49612ee4de2b9671" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>I think it is very premature to declare getting rid of it entirely eventually while still having no plan for a replacement.</p>
</blockquote>
<blockquote>
<p>This whole movement to getting rid of it is very much rushed.</p>
</blockquote>
<blockquote>
<p>As I said before, provide a replacement, give it time to get adopted, THEN you can remove BinaryFormatter from clipboard/dragndrop.</p>
</blockquote>
<blockquote>
<p>Right now nothing of this happened, there is a discussion about false security, the whole thing looks premature and rushed.</p>
</blockquote>
<p>Comments like these makes me wonder if you actually read the very first post of this issue. This is a <strong>suggested plan</strong> for .NET 5 where <code>BinaryFormatter</code> does not ship by default but will require an additional and separate dependency to use the <em>exact same</em> <code>BinaryFormatter</code>. In <em>addition</em>, there is the idea of a <em>new</em> serializer which is similar to <code>BinaryFormatter</code> but safe and secure which also ships separately.</p>
<p>So of course, nothing happened yet. As such, there isn’t anything that is rushed at all. .NET 3.1 isn’t even here yet, so planning something like this for .NET 5 is actually very realistic. And if we do this for .NET 5, then there is really no problem with your existing applications that rely on this functionality at all since the *real <code>BinaryFormatter</code> will be still available; just as an opt-in functionality.</p>
<p>So yes, having a good and safe replacement eventually will certainly make things better but that replacement will be breaking <em>anyway</em>. So you will have to actively migrate to a different serializer at that point. Until then, you can continue to use <code>BinaryFormatter</code> if you want to accept the security implications.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY4MDI1OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY4MDI1OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzY4MDI1OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/caioproiete/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/caioproiete"><img height="40" width="40" alt="@caioproiete" src="https://avatars1.githubusercontent.com/u/177608?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547680258">
    <div>
      

  

<details data-body-version="f96819537d3139b22040f79dbec2f147">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="f96819537d3139b22040f79dbec2f147" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> If I understand correctly, <a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a>'s proposed plan is to move <code>BinaryFormatter</code> away from <strong>.NET Core</strong>. The code you linked to is from the <strong>Windows Forms</strong> codebase - a <em>consumer</em> of <code>BinaryFormatter</code> - that will be affected by this just like you and me on our desktop apps, and we'll all have to make a decision: Find/implement a better solution or accept the risk by using this separate package... The Windows Forms team included.</p>
<p>It doesn't seem like you appreciate how serious this problem is, though.</p>
<p>After watching five minutes of <a data-hovercard-type="user" data-hovercard-url="/users/blowdart/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/blowdart">@blowdart</a>'s <a href="https://youtu.be/kz7wmRV9xsU?t=1553" rel="nofollow">video</a> linked above (starting at 25:53), I'd expect any developer to start looking for ways to completely remove <code>BinaryFormatter</code> from their codebase <em>asap</em>, even before Microsoft can offer a better solution - And when that comes, then great, maybe you can replace whatever solution you put in place before, with the new/better way that MS (or somebody else) comes up with...</p>
<p><a href="https://youtu.be/kz7wmRV9xsU?t=1553" rel="nofollow"><img src="https://user-images.githubusercontent.com/177608/67817410-04898e80-fa8c-11e9-910f-8037350cc321.png" alt="image"></a></p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY5MDM4OQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY5MDM4OQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzY5MDM4OQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547690389">
    <div>
      

  

<details data-body-version="56434e2eb6b456bf484b753327099e3c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="56434e2eb6b456bf484b753327099e3c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Ok you changed my mind, I won't bother arguing for compatibility any more. Not that it affects me and my argument, I still believe clipboard and drag'n'drop aren't a security boundary for your average UI application as the attacker must be in the same security context to access the clipboard or initiate/receive a drag'n'drop operation - but yeah, I see the problem and the risk of other people who do work on a security boundary getting it wrong. IMHO the main problem is that the security implications of using BinaryFormatter are not well known, so its probably better to take the tools away as soon as possible so people don't hurt themselves (or their users) by chosing the wrong tool (and I do mean that, not being ironic here). It's easier and has more effect than any other option.</p>
<p>We'll have to see if they can get it out of the default WPF and WinForms behavior in time for .NET 5.0, they'll have to provide an entirely alternate way of operating the clipboard and drag'n'drop, otherwise if you are an UI application you will automatically pull in BinaryFormatter, defeating the purpose of moving it into a separate package. Well, I guess they could pull it in without adding a reference so the API doesn't become visible, but it would still be present and implicitely used in any UI application.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY5Nzg2NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzY5Nzg2NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzY5Nzg2NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547697864">
    <div>
      

  

<details data-body-version="a7410d05ddfaf57e24d0c9c77e8c0b1a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="a7410d05ddfaf57e24d0c9c77e8c0b1a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I appreciate the difficulties this might impose on WinForms applications. Check out my comments at <a href="https://github.com/dotnet/corefx/issues/38760#issuecomment-511216505">https://github.com/dotnet/corefx/issues/38760#issuecomment-511216505</a> and <a href="https://github.com/dotnet/corefx/issues/38760#issuecomment-547183707">https://github.com/dotnet/corefx/issues/38760#issuecomment-547183707</a> where I describe a possible way to address this. Those comments propose that though there would be no <em>in-box</em> support for using <code>BinaryFormatter</code>, there would still be extensibility hooks for hooking up custom deserializers (including the out-of-band <code>BinaryFormatter</code>). You could imagine that there might exist a shim / compatibility package which can be installed into a WinForms application if you require the existing behavior.</p>
<p>The developer flow would be that you upgrade the application and notice that the clipboard functionality doesn't work as expected for rich object graphs. (Primitives should still work just fine.) At this point you'd have a few options: use a different serialization technique if you're able, use the proposed "safe" serializer if you require payload compatibility with the existing format, or install the compatibility package if you're willing to accept the risks. Those options are very roughly ranked from safest (though taking the most work) to least safe (though taking the least work).</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzgyNTc5OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0NzgyNTc5OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0NzgyNTc5OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jaykrell/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jaykrell"><img height="40" width="40" alt="@jaykrell" src="https://avatars3.githubusercontent.com/u/1635728?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-547825798">
    <div>
      

  

<details data-body-version="92039c3b178b78bb2e060e3aeeafec2d">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="92039c3b178b78bb2e060e3aeeafec2d" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Can the format underlying RPC (DCE?) be used instead?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTYzNDUzNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTYzNDUzNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTYzNDUzNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549634534">
    <div>
      

  

<details data-body-version="546325bdc88c9efda120bac9051b5d7c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="546325bdc88c9efda120bac9051b5d7c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Another proposal - if it can't be ripped out but applications want to protect themselves against improper usage of this type - would be to introduce a static API that would permanently disable the type for the lifetime of the application. For example:</p>
<div><pre><span>public</span> <span>partial</span> <span>class</span> <span>BinaryFormatter</span>
{
    <span><span>//</span> NEW API</span>
    <span>public</span> <span>static</span> <span>void</span> <span>Disable</span>();
}</pre></div>
<p>If this method is called, the <code>BinaryFormatter</code> type would be permanently disabled for the lifetime of the application. There would be no functionality to re-enable the type without restarting the application. Calling the <code>BinaryFormatter</code> APIs would throw a runtime exception.</p>
<p>The scenario for such a switch would be web applications who pull in DLLs which reference the <code>BinaryFormatter</code> type. In a nutshell, these applications don't intend on <code>BinaryFormatter</code> code paths being executed in the normal course of request processing, but due to external dependencies they can't remove those code paths entirely. So they'd be able to opt in to this switch to block those code paths from executing in the event a request is able to activate them unexpectedly.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTY0NzEyMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTY0NzEyMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTY0NzEyMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/vcsjones/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/vcsjones"><img height="40" width="40" alt="@vcsjones" src="https://avatars1.githubusercontent.com/u/361677?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549647122">
    <div>
      

  

<details data-body-version="ceaae52a8f9d11da2e7b9bfd82331998">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="ceaae52a8f9d11da2e7b9bfd82331998" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks">@GrabYourPitchforks</a> how about an AppContext switch? That lets it be set via registry and environment variable so it's disabled as early as possible in the application.</p>
<p>EDIT: hmm. I don't think those are immutable.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTY4NTg3Mw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTY4NTg3Mw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTY4NTg3Mw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/GrabYourPitchforks/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/GrabYourPitchforks"><img height="40" width="40" alt="@GrabYourPitchforks" src="https://avatars2.githubusercontent.com/u/1746272?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549685873">
    <div>
      

  

<details data-body-version="381e3952f4c3c8c815cf25c605e70db3">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="381e3952f4c3c8c815cf25c605e70db3" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>AppContext / environment variable / registry / etc. would also work. The value would be locked in the first time we read it.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTcyOTI0Nw==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTcyOTI0Nw==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTcyOTI0Nw==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/gfoidl/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gfoidl"><img height="40" width="40" alt="@gfoidl" src="https://avatars1.githubusercontent.com/u/5755834?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549729247">
    <div>
      

  

<details data-body-version="61a6b39f324a6c0da71825ea4b19afa6">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="61a6b39f324a6c0da71825ea4b19afa6" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>Or the other way round, to enable it explicitely.<br>
Default is disabled, but a user has to think about it when he wants to enable it.<br>
The runtime exception should point to a document describing why this behavior is so.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1MTAyMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1MTAyMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTc1MTAyMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549751022">
    <div>
      

  

<details data-body-version="9a7870e1775c9e73592940a81a3dd6ff">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9a7870e1775c9e73592940a81a3dd6ff" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/gfoidl/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gfoidl">@gfoidl</a> then it'll just get enabled as a side effect of a random 3rd party library which thinks it needs it</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1NDg2Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1NDg2Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTc1NDg2Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/gfoidl/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gfoidl"><img height="40" width="40" alt="@gfoidl" src="https://avatars1.githubusercontent.com/u/5755834?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549754866">
    <div>
      

  

<details data-body-version="1f052fb0180f6eea4687bc685ba906a4">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="1f052fb0180f6eea4687bc685ba906a4" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> why?</p>
<blockquote>
<p>AppContext / environment variable / registry</p>
</blockquote>
<p>I wouldn't use a 3rd party lib that manipulates these values.</p>
<p>How this is achieved depends on the implementation, but first we should find a consensus on the <em>what</em>.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1ODc3NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTc1ODc3NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTc1ODc3NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante"><img height="40" width="40" alt="@weltkante" src="https://avatars3.githubusercontent.com/u/5845814?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549758775">
    <div>
      

  

<details data-body-version="11caffbd0a2f6564367fe58850a16687">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="11caffbd0a2f6564367fe58850a16687" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/weltkante/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/weltkante">@weltkante</a> why?</p>
</blockquote>
<p>because thats what people do when they have a feature they need to get working.</p>
<blockquote>
<p>I wouldn't use a 3rd party lib that manipulates these values.</p>
</blockquote>
<p>You don't always notice immediately (or ever) what horrible workarounds or hacks they have in their codebase</p>
<p>I'm just saying an opt-in can get triggered by 3rd party code without you ever making the decision. It has always been the case in the past with process wide Windows API opt-ins, which are usually reserved for the application (exe) to make the decision but I have seen enough libraries which apply process wide settings anyways (and you usually don't notice until you run into problems because of it)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU4MjE2ODM4Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU4MjE2ODM4Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU4MjE2ODM4Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/eiriktsarpalis/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/eiriktsarpalis"><img height="40" width="40" alt="@eiriktsarpalis" src="https://avatars2.githubusercontent.com/u/2813363?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-582168386">
    <div>
      

  

<details data-body-version="7bbabadf5252720bf71fc0c50ed66bcf">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="7bbabadf5252720bf71fc0c50ed66bcf" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I generally agree with the proposal to move BF out of shared framework. That being said, there's a counterpoint to be made about applications where remote code execution is a desired feature. One example is closure serialization, which is something used to drive distributed compute in frameworks like spark in the case of the JVM.</p>
<p>To my knowledge, BF is the only serializer in the shared framework that is capable of serializing closures.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  





<!-- Rendered timeline since 2020-02-10 08:21:41 -->



            </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
		<div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>