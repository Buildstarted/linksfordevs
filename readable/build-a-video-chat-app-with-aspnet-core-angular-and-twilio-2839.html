<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Build a Video Chat App with ASP.NET Core, Angular, and Twilio - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Build a Video Chat App with ASP.NET Core, Angular, and Twilio - linksfor.dev(s)"/>
    <meta property="article:author" content="By David Pine&#xA;      2019-02-02"/>
    <meta property="og:description" content="Use ASP.NET Core and Angular to build a video chat application using Twilio. See sample code, testing steps, and deployment. Repo with features and ideas."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.twilio.com/blog/video-chat-app-asp-net-core-angular-twilio"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Build a Video Chat App with ASP.NET Core, Angular, and Twilio</title>
<div class="readable">
        <h1>Build a Video Chat App with ASP.NET Core, Angular, and Twilio</h1>
            <div>by By David Pine&#xA;      2019-02-02</div>
            <div>Reading time: 55-70 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="https://www.twilio.com/blog/video-chat-app-asp-net-core-angular-twilio">https://www.twilio.com/blog/video-chat-app-asp-net-core-angular-twilio</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
      

      <section>
        
          <ul>
        
          
          
    
      


<article>
  <header>
  
  
  </header>
  <section>
    
    
      <div><p>Realtime user interaction is a great way to enhance the communication and collaboration capabilities of a web application. Video chat is an obvious choice for sales, customer support, and education sites, but how can you quickly implement it? Twilio Programmable Video enables you to efficiently add robust video chat to your applications, whether you are using a JavaScript Model-View-Controller framework like Angular or server-side templates.</p>
<p>This post will show you how to create a video chat application using the <a href="https://www.twilio.com/docs/video/javascript">Twilio JavaScript SDK</a>&nbsp;in your Angular single page application (SPA) and the <a href="https://www.twilio.com/docs/libraries/csharp-dotnet">Twilio SDK for C# and .NET</a>&nbsp;in your ASP.NET Core server code. You’ll build the interactions required to create and join video chat rooms, and to publish and subscribe to participant audio and video tracks.</p>
<h2>Prerequisites to a Angular and ASP.NET Core Video App</h2>
<p>You’ll need the following technologies and tools to build the video chat project described in this post:</p>
<ul>
<li><a href="https://dotnet.microsoft.com/download">.NET Core 2.2 SDK</a>&nbsp;(version 2.2.101+)</li>
<li><a href="https://www.npmjs.com/get-npm">npm and </a>Node.js&nbsp;(version 10.10.0+)</li>
<li><a href="https://github.com/angular/angular-cli/wiki">Angular CLI</a>&nbsp;(version 7.1.4+)</li>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a>, <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio 2017</a>, or another IDE compatible with the above</li>
<li><a href="https://git-scm.com/downloads">Git</a>&nbsp;(if you’re going to clone the companion repository)</li>
</ul>
<p>To get the most out of this post you should have knowledge of:</p>
<ul>
<li>Angular, including observables and promises</li>
<li>ASP.NET Core, including dependency injection</li>
<li>C# 7</li>
<li>TypeScript</li>
</ul>
<p>The source code for this project is available on <a href="https://github.com/IEvangelist/IEvangelist.VideoChat">GitHub</a>.</p>
<h2>Get started with Twilio Programmable Video</h2>
<p>You’ll need a free <a href="https://www.twilio.com/try-twilio" data-glinktype="blog post" data-glinklocation="blog:Build a Video Chat App with ASP.NET Core, Angular, and Twilio" data-glinkname="sign up">Twilio trial account</a><a href="https://www.twilio.com/try-twilio" data-glinktype="blog post" data-glinklocation="blog:Build a Video Chat App with ASP.NET Core, Angular, and Twilio" data-glinkname="sign up">&nbsp;</a>and a Twilio Programmable Video project to be able to build this project with the Twilio Video SDK. Getting set up will take just a few minutes.</p>
<p>Once you have a Twilio account, go to the <a href="https://twilio.com/console">Twilio Console</a>&nbsp;and perform the following steps:</p>
<ol>
<li>On the dashboard home, locate your Account SID and Auth Token and copy them to a safe place.</li>
<li>Select the <a href="https://www.twilio.com/console/video/dashboard">Programmable Video section</a> of the Console.</li>
<li>Under Tools &gt; API Keys, create a new API key with a friendly name of your choosing and copy the SID and API Secret to a safe place.</li>
</ol>
<p>The credentials you just acquired are user secrets, so it’s a good idea not to store them in the project source code. One way to keep them safe and make them accessible in your project configuration is to store them as environment variables on your development machine.</p>
<p>ASP.NET Core can access environment variables through the <code>Microsoft.Extensions.Configuration</code> package so they can be used as properties of a <code>IConfiguration</code> object in the <code>Startup</code> class. The following instructions show you how to do this on Windows.</p>
<p>Execute the following commands at a Windows command prompt, substituting your credentials for the placeholders. For other operating systems, use comparable commands to create the same environment variables.</p></div>
    
      

<div>
    <div><pre><span><span>setx</span> <span>TwilioSettings__AccountSid</span> <span>[</span><span>Account</span> <span>SID</span><span>]</span>
</span><span><span>setx</span> <span>TwilioSettings__ApiSecret</span> <span>[</span><span>API</span> <span>Secret</span><span>]</span>
</span><span><span>setx</span> <span>TwilioSettings__ApiKey</span> <span>[</span><span>SID</span><span>]</span>
</span></pre></div>
</div>

    
      <p>If you prefer, or if your development environment requires it, you can place these values in the <em>appsettings.development.json</em>&nbsp;file as follows, but be careful not to expose this file in a source code repository or other easily accessible location.</p>
    
      

<div>
    <div><pre><span><span>{</span>
</span><span>  <span>"Logging"</span><span>:</span> <span>{</span>
</span><span>    <span>"LogLevel"</span><span>:</span> <span>{</span>
</span><span>      <span>"Default"</span><span>:</span> <span>"Warning"</span>
</span><span>    <span>}</span>
</span><span>  <span>},</span>
</span><span>  <span>"AllowedHosts"</span><span>:</span> <span>"*"</span><span>,</span>
</span><span>  <span>"TwilioSettings"</span><span>:</span> <span>{</span>
</span><span>    <span>"AccountSid"</span><span>:</span> <span>"Account SID"</span><span>,</span>
</span><span>    <span>"ApiSecret"</span><span>:</span> <span>"API Secret"</span><span>,</span>
</span><span>    <span>"ApiKey"</span><span>:</span> <span>"SID"</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><h2>Create the ASP.NET Core application</h2>
<p>Create a new ASP.NET Core Web Application&nbsp;named “VideoChat” with .NET Core 2.2 and Angular templating&nbsp;using the Visual Studio 2017 user interface or the following <code>dotnet</code>&nbsp;command line:</p></div>
    
      

<div>
    <div><pre><span>dotnet new angular -o VideoChat
</span></pre></div>
</div>

    
      <div><p>This command will create a Visual Studio solution containing an ASP.NET Core project configured to use an Angular application, <em>ClientApp</em>, as the front end.</p>
<p>The server-side code is written in C# and has two primary purposes:&nbsp;first, it serves the Angular web application, HTML, CSS,&nbsp;and JavaScript. Second, it acts as a Web API. The client-side application has the logic for presenting how video chat rooms are created and joined, and it hosts the &nbsp;participant video stream for live video chats.</p>
<h3>Add the Twilio SDK for C# and .NET</h3>
<p>The ASP.NET Core&nbsp;server&nbsp;application will use the&nbsp;<a href="https://www.twilio.com/docs/libraries/csharp-dotnet">Twilio SDK for C# and .NET</a>. Install it with the NuGet Package Manager, Package Manager Console, or the following <code>dotnet</code> command line instruction:</p></div>
    
      

<div>
    <div><pre><span>dotnet add package Twilio
</span></pre></div>
</div>

    
      <p>The <em>VideoChat.csproj</em> file should include the package references in an <code>&lt;ItemGroup&gt;</code>&nbsp;node, as shown below, if the command completed successfully. (The version numbers in your project may be higher.)</p>
    
      

<div>
    <div><pre><span><span>&lt;ItemGroup&gt;</span>
</span><span>    <span>&lt;PackageReference</span> <span>Include=</span><span>"Microsoft.AspNetCore.App"</span> <span>/&gt;</span>
</span><span>    <span>&lt;PackageReference</span> <span>Include=</span><span>"Microsoft.AspNetCore.SpaServices.Extensions"</span> <span>Version=</span><span>"2.2.0"</span> <span>/&gt;</span>
</span><span>    <span>&lt;PackageReference</span> <span>Include=</span><span>"Twilio"</span> <span>Version=</span><span>"5.25.1"</span> <span>/&gt;</span>
</span><span><span>&lt;/ItemGroup&gt;</span>
</span></pre></div>
</div>

    
      <div><h3>Create the folder and file structure</h3>
<p>Create the following folders and and files:</p>
<ul>
<li><em>/Abstractions</em></li>
<li><em>IVideoService.cs</em></li>
<li><em>/Hubs</em></li>
<li><em>NotificationHub.cs</em></li>
<li><em>/Models</em></li>
<li><em>RoomDetails.cs</em></li>
<li><em>/Options</em></li>
<li><em>TwilioSettings.cs</em></li>
<li><em>/Services</em></li>
<li><em>VideoService.cs</em></li>
</ul>
<p>In the <em>/Controllers</em>&nbsp;directory, rename <em>SampleDataController.cs</em>&nbsp;to <em>VideoController.cs</em><em>&nbsp;</em>and update the class name to match the new new file name.</p>
<h3>Create services</h3>
<p>The server-side code needs to do several key things. One of them is to provide a <a href="https://jwt.io/">JSON Web Token (JWT)</a>&nbsp;to the client so the client can connect to the Twilio Programmable Video API. Doing so requires&nbsp;the Twilio Account SID, API Key,&nbsp;and API Secret&nbsp;you stored as environment variables. In ASP.NET Core, it is common to leverage a strongly typed C# class that will represent the various settings.</p>
<p>Add the following C# code to&nbsp;the <em>Options/TwilioSettings.cs</em>&nbsp;file&nbsp;below the declarations:</p></div>
    
      

<div>
    <div><pre><span><span>namespace</span> <span>VideoChat.Options</span>
</span><span><span>{</span>
</span><span>    <span>public</span> <span>class</span> <span>TwilioSettings</span>
</span><span>    <span>{</span>
</span><span>        <span>/// &lt;summary&gt;</span>
</span><span>        <span>/// The primary Twilio account SID, displayed prominently on your twilio.com/console dashboard.</span>
</span><span>        <span>/// &lt;/summary&gt;</span>
</span><span>        <span>public</span> <span>string</span> <span>AccountSid</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>        
</span><span>        <span>/// &lt;summary&gt;</span>
</span><span>        <span>/// The auth token for your primary Twilio account, hidden on your twilio.com/console dashboard.</span>
</span><span>        <span>/// &lt;/summary&gt;</span>
</span><span>        <span>public</span> <span>string</span> <span>AuthToken</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>
</span><span>        <span>/// &lt;summary&gt;</span>
</span><span>        <span>/// Signing Key SID, also known as the API SID or API Key.</span>
</span><span>        <span>/// &lt;/summary&gt;</span>
</span><span>        <span>public</span> <span>string</span> <span>ApiKey</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>
</span><span>        <span>/// &lt;summary&gt;</span>
</span><span>        <span>/// The API Secret that corresponds to the &lt;see cref="ApiKey"/&gt;.</span>
</span><span>        <span>/// &lt;/summary&gt;</span>
</span><span>        <span>public</span> <span>string</span> <span>ApiSecret</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>These settings are configured in the <code>Startup.ConfigureServices</code> method, which maps the values from environment variables and the <em>appsettings.json</em>&nbsp;file&nbsp;to the <code>IOptions&lt;TwilioSettings&gt;</code> instances that are available for dependency injection. In this case, the environment variables are the only values needed for the <code>TwilioSettings</code> class.</p>
<p>Insert the following C# code in the <em>Models/RoomDetails.cs</em>&nbsp;file below the declarations:</p></div>
    
      

<div>
    <div><pre><span><span>namespace</span> <span>VideoChat.Models</span>
</span><span><span>{</span>
</span><span>    <span>public</span> <span>class</span> <span>RoomDetails</span>
</span><span>    <span>{</span>
</span><span>        <span>public</span> <span>string</span> <span>Id</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>        <span>public</span> <span>string</span> <span>Name</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>        <span>public</span> <span>int</span> <span>ParticipantCount</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>        <span>public</span> <span>int</span> <span>MaxParticipants</span> <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>The <code>RoomDetails</code> class is an object that represents a video chat room.</p>
<p>With dependency injection in mind, create an abstraction for the server-side video service as an interface.</p>
<p>Replace the contents of the <em>Abstractions/IVideoService.cs</em>&nbsp;file with the following C# code:</p></div>
    
      

<div>
    <div><pre><span><span>using</span> <span>System.Collections.Generic</span><span>;</span>
</span><span><span>using</span> <span>System.Threading.Tasks</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Models</span><span>;</span>
</span><span>
</span><span><span>namespace</span> <span>VideoChat.Abstractions</span>
</span><span><span>{</span>
</span><span>    <span>public</span> <span>interface</span> <span>IVideoService</span>
</span><span>    <span>{</span>
</span><span>        <span>string</span> <span>GetTwilioJwt</span><span>(</span><span>string</span> <span>identity</span><span>);</span>
</span><span>        <span>Task</span><span>&lt;</span><span>IEnumerable</span><span>&lt;</span><span>RoomDetails</span><span>&gt;&gt;</span> <span>GetAllRoomsAsync</span><span>();</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>This&nbsp;is a very simple interface that exposes the ability to get the Twilio JWT when it is given an identity. It also provides the ability to get all the rooms.</p>
<p>To implement the <code>IVideoService</code> interface, replace the contents of the&nbsp;<em>Services/VideoService.cs</em>&nbsp;file with the following code:</p></div>
    
      

<div>
    <div><pre><span><span>using</span> <span>System</span><span>;</span>
</span><span><span>using</span> <span>System.Collections.Generic</span><span>;</span>
</span><span><span>using</span> <span>System.Linq</span><span>;</span>
</span><span><span>using</span> <span>System.Threading.Tasks</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Abstractions</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Models</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Options</span><span>;</span>
</span><span><span>using</span> <span>Twilio</span><span>;</span>
</span><span><span>using</span> <span>Twilio.Base</span><span>;</span>
</span><span><span>using</span> <span>Twilio.Jwt.AccessToken</span><span>;</span>
</span><span><span>using</span> <span>Twilio.Rest.Video.V1</span><span>;</span>
</span><span><span>using</span> <span>Twilio.Rest.Video.V1.Room</span><span>;</span>
</span><span><span>using</span> <span>ParticipantStatus</span> <span>=</span> <span>Twilio</span><span>.</span><span>Rest</span><span>.</span><span>Video</span><span>.</span><span>V1</span><span>.</span><span>Room</span><span>.</span><span>ParticipantResource</span><span>.</span><span>StatusEnum</span><span>;</span>
</span><span>
</span><span><span>namespace</span> <span>VideoChat.Services</span>
</span><span><span>{</span>
</span><span>    <span>public</span> <span>class</span> <span>VideoService</span> <span>:</span> <span>IVideoService</span>
</span><span>    <span>{</span>
</span><span>        <span>readonly</span> <span>TwilioSettings</span> <span>_twilioSettings</span><span>;</span>
</span><span>
</span><span>        <span>public</span> <span>VideoService</span><span>(</span><span>Microsoft</span><span>.</span><span>Extensions</span><span>.</span><span>Options</span><span>.</span><span>IOptions</span><span>&lt;</span><span>TwilioSettings</span><span>&gt;</span> <span>twilioOptions</span><span>)</span>
</span><span>        <span>{</span>
</span><span>            <span>_twilioSettings</span> <span>=</span>
</span><span>                <span>twilioOptions</span><span>?.</span><span>Value</span>
</span><span>             <span>??</span> <span>throw</span> <span>new</span> <span>ArgumentNullException</span><span>(</span><span>nameof</span><span>(</span><span>twilioOptions</span><span>));</span>
</span><span>
</span><span>            <span>TwilioClient</span><span>.</span><span>Init</span><span>(</span><span>_twilioSettings</span><span>.</span><span>ApiKey</span><span>,</span> <span>_twilioSettings</span><span>.</span><span>ApiSecret</span><span>);</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>public</span> <span>string</span> <span>GetTwilioJwt</span><span>(</span><span>string</span> <span>identity</span><span>)</span>
</span><span>            <span>=&gt;</span> <span>new</span> <span>Token</span><span>(</span><span>_twilioSettings</span><span>.</span><span>AccountSid</span><span>,</span>
</span><span>                         <span>_twilioSettings</span><span>.</span><span>ApiKey</span><span>,</span>
</span><span>                         <span>_twilioSettings</span><span>.</span><span>ApiSecret</span><span>,</span>
</span><span>                         <span>identity</span> <span>??</span> <span>Guid</span><span>.</span><span>NewGuid</span><span>().</span><span>ToString</span><span>(),</span>
</span><span>                         <span>grants</span><span>:</span> <span>new</span> <span>HashSet</span><span>&lt;</span><span>IGrant</span><span>&gt;</span> <span>{</span> <span>new</span> <span>VideoGrant</span><span>()</span> <span>}).</span><span>ToJwt</span><span>();</span>
</span><span>
</span><span>        <span>public</span> <span>async</span> <span>Task</span><span>&lt;</span><span>IEnumerable</span><span>&lt;</span><span>RoomDetails</span><span>&gt;&gt;</span> <span>GetAllRoomsAsync</span><span>()</span>
</span><span>        <span>{</span>
</span><span>            <span>var</span> <span>rooms</span> <span>=</span> <span>await</span> <span>RoomResource</span><span>.</span><span>ReadAsync</span><span>();</span>
</span><span>            <span>var</span> <span>tasks</span> <span>=</span> <span>rooms</span><span>.</span><span>Select</span><span>(</span>
</span><span>                <span>room</span> <span>=&gt;</span> <span>GetRoomDetailsAsync</span><span>(</span>
</span><span>                    <span>room</span><span>,</span>
</span><span>                    <span>ParticipantResource</span><span>.</span><span>ReadAsync</span><span>(</span>
</span><span>                        <span>room</span><span>.</span><span>Sid</span><span>,</span>
</span><span>                        <span>ParticipantStatus</span><span>.</span><span>Connected</span><span>)));</span>
</span><span>
</span><span>            <span>return</span> <span>await</span> <span>Task</span><span>.</span><span>WhenAll</span><span>(</span><span>tasks</span><span>);</span>
</span><span>
</span><span>            <span>async</span> <span>Task</span><span>&lt;</span><span>RoomDetails</span><span>&gt;</span> <span>GetRoomDetailsAsync</span><span>(</span>
</span><span>                <span>RoomResource</span> <span>room</span><span>,</span>
</span><span>                <span>Task</span><span>&lt;</span><span>ResourceSet</span><span>&lt;</span><span>ParticipantResource</span><span>&gt;&gt;</span> <span>participantTask</span><span>)</span>
</span><span>            <span>{</span>
</span><span>                <span>var</span> <span>participants</span> <span>=</span> <span>await</span> <span>participantTask</span><span>;</span>
</span><span>                <span>return</span> <span>new</span> <span>RoomDetails</span>
</span><span>                <span>{</span>
</span><span>                    <span>Name</span> <span>=</span> <span>room</span><span>.</span><span>UniqueName</span><span>,</span>
</span><span>                    <span>MaxParticipants</span> <span>=</span> <span>room</span><span>.</span><span>MaxParticipants</span> <span>??</span> <span>0</span><span>,</span>
</span><span>                    <span>ParticipantCount</span> <span>=</span> <span>participants</span><span>.</span><span>ToList</span><span>().</span><span>Count</span>
</span><span>                <span>};</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>The <code>VideoService</code> class constructor takes an <code>IOptions&lt;TwilioSettings&gt;</code> instance and initializes the <code>TwilioClient</code>, given the supplied API key and corresponding API secret. This is done statically, and it enables future use of various resource-based functions. The implementation of the <code>GetTwilioJwt</code> is used to issue a new <code>Twilio.Jwt.AccessToken.Token</code>, given the Account SID, API key, API secret, identity, and a new instance of <code>HashSet&lt;IGrant&gt;</code> with a single <code>VideoGrant</code> object. Before returning, an invocation to the <code>.ToJwt</code> function converts the token instance into its <code>string</code> equivalent.</p>
<p>The <code>GetAllRoomsAsync</code> function returns a listing of <code>RoomDetails</code> objects. It starts by awaiting the <code>RoomResource.ReadAsync</code> function, which will given us a <code>ResourceSet&lt;RoomResource&gt;</code> once awaited. From this listing of rooms we'll project a series of <code>Task&lt;RoomDetails&gt;</code> where we'll ask for the corresponding <code>ResourceSet&lt;ParticipantResource&gt;</code> currently connected to the room specified with the room identifier, <code>room.UniqueName</code>.</p>
<p>You may notice some unfamiliar syntax in the <code>GetAllRoomsService</code> function if you’re not used to code after the <code>return</code> statement. C# 7 includes a <a href="https://blogs.msdn.microsoft.com/seteplia/2017/10/03/dissecting-the-local-functions-in-c-7/">local functions</a>&nbsp;feature that enables functions to be written within the scope of the method body (“locally”), even after the return statement.</p>
<p>Note that for every room <em>n</em>&nbsp;that exists, <code>GetRoomDetailsAsync</code> is invoked to fetch the room’s connected participants. This can be a performance concern! Even though this is done asynchronously&nbsp;and in parallel, it should be considered a potential bottleneck and marked for refactoring. It isn't a concern in this demo project, as there are, at most, a few rooms.</p>
<h3>Create the API controller</h3>
<p>The video controller will provide two HTTP GET endpoints for the Angular client to use.</p>
<table>
<tbody>
<tr>
<td colspan="1">
<p><strong>Endpoint</strong></p>
</td>
<td colspan="1">
<p><strong>Verb</strong></p>
</td>
<td colspan="1">
<p><strong>Type</strong></p>
</td>
<td colspan="1">
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td colspan="1">
<p><em>api/video/token</em></p>
</td>
<td colspan="1">
<p>GET</p>
</td>
<td colspan="1">
<p>JSON</p>
</td>
<td colspan="1">
<p>an object with a <code>token</code>&nbsp;member assigned from the Twilio JWT</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><em>api/video/rooms</em></p>
</td>
<td colspan="1">
<p>GET</p>
</td>
<td colspan="1">
<p>JSON</p>
</td>
<td colspan="1">
<p>array of room details: <code>{ name, participantCount, maxParticipants }</code></p>
</td>
</tr>
</tbody>
</table>
<p>Replace the contents of the <em>Controllers/VideoController.cs</em>&nbsp;file with the following C# code:</p></div>
    
      

<div>
    <div><pre><span><span>using</span> <span>System.Threading.Tasks</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Abstractions</span><span>;</span>
</span><span><span>using</span> <span>Microsoft.AspNetCore.Mvc</span><span>;</span>
</span><span>
</span><span><span>namespace</span> <span>VideoChat.Controllers</span>
</span><span><span>{</span>
</span><span><span>    [</span>
</span><span><span>        ApiController,</span>
</span><span><span>        Route("api/video")</span>
</span><span><span>    ]</span>
</span><span>    <span>public</span> <span>class</span> <span>VideoController</span> <span>:</span> <span>ControllerBase</span>
</span><span>    <span>{</span>
</span><span>        <span>readonly</span> <span>IVideoService</span> <span>_videoService</span><span>;</span>
</span><span>
</span><span>        <span>public</span> <span>VideoController</span><span>(</span><span>IVideoService</span> <span>videoService</span><span>)</span>
</span><span>            <span>=&gt;</span> <span>_videoService</span> <span>=</span> <span>videoService</span><span>;</span>
</span><span>
</span><span><span>        [HttpGet("token")]</span>
</span><span>        <span>public</span> <span>IActionResult</span> <span>GetToken</span><span>()</span>
</span><span>            <span>=&gt;</span> <span>new</span> <span>JsonResult</span><span>(</span><span>new</span> <span>{</span> <span>token</span> <span>=</span> <span>_videoService</span><span>.</span><span>GetTwilioJwt</span><span>(</span><span>User</span><span>.</span><span>Identity</span><span>.</span><span>Name</span><span>)</span> <span>});</span>
</span><span>
</span><span><span>        [HttpGet("rooms")]</span>
</span><span>        <span>public</span> <span>async</span> <span>Task</span><span>&lt;</span><span>IActionResult</span><span>&gt;</span> <span>GetRooms</span><span>()</span>
</span><span>            <span>=&gt;</span> <span>new</span> <span>JsonResult</span><span>(</span><span>await</span> <span>_videoService</span><span>.</span><span>GetAllRoomsAsync</span><span>());</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>The controller is decorated with the <code>ApiController</code> attribute and a <code>Route</code> attribute containing the template <code>"api/video"</code>.</p>
<p>In the <code>VideoController</code> constructor <code>IVideoService</code> is injected and assigned to a <code>readonly</code> field instance.</p>
<h3>Create the notification hub</h3>
<p>The ASP.NET Core application wouldn't be complete without the use of <a href="https://docs.microsoft.com/en-us/aspnet/core/signalr/introduction?view=aspnetcore-2.2">SignalR</a>, which “... is an open-source library that simplifies adding real-time web functionality to apps. Real-time web functionality enables server-side code to push content to clients instantly.”</p>
<p>When a user creates a room in the application their client-side code will notify the server and, ultimately, other clients of the new room. This is done with a SignalR notification hub.</p>
<p>Replace the contents of the <em>Hubs/NotificationHub.cs</em>&nbsp;file with the following C# code:</p></div>
    
      

<div>
    <div><pre><span><span>using</span> <span>System.Threading.Tasks</span><span>;</span>
</span><span><span>using</span> <span>Microsoft.AspNetCore.SignalR</span><span>;</span>
</span><span>
</span><span><span>namespace</span> <span>VideoChat.Hubs</span>
</span><span><span>{</span>
</span><span>    <span>public</span> <span>class</span> <span>NotificationHub</span> <span>:</span> <span>Hub</span>
</span><span>    <span>{</span>
</span><span>        <span>public</span> <span>async</span> <span>Task</span> <span>RoomsUpdated</span><span>(</span><span>bool</span> <span>flag</span><span>)</span>
</span><span>            <span>=&gt;</span> <span>await</span> <span>Clients</span><span>.</span><span>Others</span><span>.</span><span>SendAsync</span><span>(</span><span>"RoomsUpdated"</span><span>,</span> <span>flag</span><span>);</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>The <code>NotificationHub</code> will asynchronously send a message to all other clients notifying them when a room is added.</p>
<h3>Configure <em>Startup.cs</em></h3>
<p>There are a few things that need to be added and changed in the <code>Startup</code> class and in the <code>ConfigureServices</code> method.</p>
<p>Add&nbsp;the following C# <code>using</code> statements&nbsp;to the top of <em>Startup.cs</em>:</p></div>
    
      

<div>
    <div><pre><span><span>using</span> <span>VideoChat.Abstractions</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Hubs</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Options</span><span>;</span>
</span><span><span>using</span> <span>VideoChat.Services</span><span>;</span>
</span></pre></div>
</div>

    
      <p>In the <code>ConfigureServices</code> method, replace the <code>services.AddSpaStaticFiles</code>&nbsp;call with the following code:</p>
    
      

<div>
    <div><pre><span><span>services</span><span>.</span><span>Configure</span><span>&lt;</span><span>TwilioSettings</span><span>&gt;(</span><span>Configuration</span><span>.</span><span>GetSection</span><span>(</span><span>nameof</span><span>(</span><span>TwilioSettings</span><span>)))</span>
</span><span>        <span>.</span><span>AddTransient</span><span>&lt;</span><span>IVideoService</span><span>,</span> <span>VideoService</span><span>&gt;()</span>
</span><span>        <span>.</span><span>AddSpaStaticFiles</span><span>(</span><span>configuration</span> <span>=&gt;</span> <span>configuration</span><span>.</span><span>RootPath</span> <span>=</span> <span>"ClientApp/dist/ClientApp"</span><span>);</span>
</span><span>
</span><span><span>services</span><span>.</span><span>AddSignalR</span><span>();</span>
</span></pre></div>
</div>

    
      <div><p>This configures the application settings containing the Twilio API credentials, maps the abstraction of the video service to its corresponding implementation, fixes the root path for the SPA, and adds SignalR.</p>
<p>In the <code>Configure</code>&nbsp;method, just <strong>before</strong>&nbsp;the <code>app.UseMvc</code>&nbsp;call, add the following lines:</p></div>
    
      

<div>
    <div><pre><span><span>app</span><span>.</span><span>UseSignalR</span><span>(</span><span>routes</span> <span>=&gt;</span>
</span><span>   <span>{</span>
</span><span>       <span>routes</span><span>.</span><span>MapHub</span><span>&lt;</span><span>NotificationHub</span><span>&gt;(</span><span>"/notificationHub"</span><span>);</span>
</span><span>   <span>});</span>
</span></pre></div>
</div>

    
      <div><p>This maps the notification endpoint to the implementation of the <code>NotificationHub</code>. Using this endpoint, the Angular SPA running in client browsers can send messages to all the other clients. SignalR provides the notification infrastructure for this process.</p>
<p>This concludes&nbsp;the server-side setup. Compile the project and ensure there are no errors.</p>
<h2>Build the client-side&nbsp;Angular app</h2>
<p>The ASP.NET Core templates are not updated regularly&nbsp;while Angular is constantly being updated. To build the client app with the newest Angular code, it’s best to start with a current Angular template.</p>
<p>Delete the <em>ClientApp</em>&nbsp;directory from the <em>VideoChat</em>&nbsp;project.</p>
<p>Open a command prompt in the <em>VideoChat</em>&nbsp;project directory and execute the following Angular CLI command:</p></div>
    
      

<div>
    <div><pre><span>ng n ClientApp --style css --routing <span>false</span> --minimal <span>true</span> --skipTests <span>true</span>
</span></pre></div>
</div>

    
      <div><p>This command should create a new <em>ClientApp</em>&nbsp;folder in the <em>VideoChat</em>&nbsp;project along with the basic folder and file structure for an Angular application.</p>
<p>The Angular application has a number of &nbsp;dependencies, including the <code>twilio-video</code> and <code>@aspnet/signalr</code> packages. Its development dependencies include the type definitions for the <code>@types/twilio-video</code>.</p>
<p>Replace the contents of the <em>package.json</em>&nbsp;with the following JSON code:</p></div>
    
      

<div>
    <div><pre><span><span>{</span>
</span><span>  <span>"name"</span><span>:</span> <span>"video-chat"</span><span>,</span>
</span><span>  <span>"version"</span><span>:</span> <span>"0.0.1"</span><span>,</span>
</span><span>  <span>"scripts"</span><span>:</span> <span>{</span>
</span><span>    <span>"ng"</span><span>:</span> <span>"ng"</span><span>,</span>
</span><span>    <span>"start"</span><span>:</span> <span>"ng serve"</span><span>,</span>
</span><span>    <span>"build"</span><span>:</span> <span>"ng build"</span><span>,</span>
</span><span>    <span>"lint"</span><span>:</span> <span>"ng lint"</span>
</span><span>  <span>},</span>
</span><span>  <span>"private"</span><span>:</span> <span>true</span><span>,</span>
</span><span>  <span>"dependencies"</span><span>:</span> <span>{</span>
</span><span>    <span>"@angular/animations"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/common"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/compiler"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/core"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/forms"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/platform-browser"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/platform-browser-dynamic"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/router"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@aspnet/signalr"</span><span>:</span> <span>"1.1.0"</span><span>,</span>
</span><span>    <span>"twilio-video"</span><span>:</span> <span>"2.0.0-beta5"</span><span>,</span>
</span><span>    <span>"core-js"</span><span>:</span> <span>"^2.5.4"</span><span>,</span>
</span><span>    <span>"rxjs"</span><span>:</span> <span>"~6.3.3"</span><span>,</span>
</span><span>    <span>"tslib"</span><span>:</span> <span>"^1.9.0"</span><span>,</span>
</span><span>    <span>"zone.js"</span><span>:</span> <span>"~0.8.26"</span>
</span><span>  <span>},</span>
</span><span>  <span>"devDependencies"</span><span>:</span> <span>{</span>
</span><span>    <span>"@angular-devkit/build-angular"</span><span>:</span> <span>"~0.11.0"</span><span>,</span>
</span><span>    <span>"@angular/cli"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/compiler-cli"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@angular/language-service"</span><span>:</span> <span>"~7.1.4"</span><span>,</span>
</span><span>    <span>"@types/node"</span><span>:</span> <span>"~8.9.4"</span><span>,</span>
</span><span>    <span>"codelyzer"</span><span>:</span> <span>"~4.5.0"</span><span>,</span>
</span><span>    <span>"ts-node"</span><span>:</span> <span>"~7.0.0"</span><span>,</span>
</span><span>    <span>"tslint"</span><span>:</span> <span>"~5.11.0"</span><span>,</span>
</span><span>    <span>"typescript"</span><span>:</span> <span>"~3.1.6"</span>
</span><span>  <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <p>With the updates to the package.json complete, execute the following npm command line instruction in the <em>ClientApp</em>&nbsp;directory:</p>
    
      



    
      <div><p>The <code>npm install</code> command ensures that all required JavaScript dependencies are downloaded.</p>
<p>Open the /ClientApp/src/index.html file and notice the <code>&lt;app-root&gt;</code> element. This non-standard element is used by Angular to render the Angular application on the HTML page. The <code>app-root</code> element is the selector for the <code>AppComponent</code> component.</p>
<p>Add the following HTML markup to the index.html file, in the <code>&lt;head&gt;</code> element below the <code>&lt;link&gt;</code> element for the favicon:</p></div>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>link</span> <span>rel</span><span>=</span><span>"stylesheet"</span>
</span><span>      <span>href</span><span>=</span><span>"https://use.fontawesome.com/releases/v5.6.3/css/all.css"</span>
</span><span>     <span>integrity</span><span>=</span><span>"sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"</span>
</span><span>      <span>crossorigin</span><span>=</span><span>"anonymous"</span><span>&gt;</span>
</span><span><span>&lt;</span><span>link</span> <span>rel</span><span>=</span><span>"stylesheet"</span>
</span><span>      <span>href</span><span>=</span><span>"https://bootswatch.com/4/darkly/bootstrap.min.css"</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>This markup enables the application to use the free version of <a href="https://fontawesome.com/">Font Awesome</a>&nbsp;and the <a href="https://bootswatch.com/darkly/">Bootswatch Darkly</a>&nbsp;theme.</p>
<p>Continue to the <em>/src/app/app.component.html</em>&nbsp;file and replace the contents with the following HTML markup:</p>
</div>
    
      



    
      <p>From the command line in the <em>ClientApp</em>&nbsp;directory,&nbsp;execute the following Angular CLI&nbsp;commands to generate the components:</p>
    
      

<div>
    <div><pre><span>ng g c camera --nospec
</span><span>ng g c home --nospec
</span><span>ng g c participants --nospec
</span><span>ng g c rooms --nospec
</span><span>ng g c settings --nospec
</span><span>ng g c settings/device-select --nospec --flat <span>true</span>
</span></pre></div>
</div>

    
      <p>Then execute the following Angular CLI commands to generate the required services:</p>
    
      

<div>
    <div><pre><span>ng g s services/videochat --nospec
</span><span>ng g s services/device --nospec
</span></pre></div>
</div>

    
      <div><p>These commands add all the boilerplate code,&nbsp;enabling&nbsp;you&nbsp;to focus on the implementation of the app. They&nbsp;add new components and services&nbsp;and&nbsp;update the <em>app.module.ts</em>&nbsp;file by importing and declaring the components&nbsp;the commands create.</p>
<p>The folder and file structure should look like&nbsp;the following:</p>
<p><img alt="ASP.NET Core and Angular Twilio Video app folder stucture" height="623" sizes="334px" src="https://twilio-cms-prod.s3.amazonaws.com/images/jXp2-GWdNjRzhl1cBAaGp9Hd3QpwUJcZjnNYVlCMd4lfEN.width-500.png" srcset="https://twilio-cms-prod.s3.amazonaws.com/images/jXp2-GWdNjRzhl1cBAaGp9Hd3QpwUJcZjnNYVlCMd4lfEN.width-500.png 334w, https://twilio-cms-prod.s3.amazonaws.com/images/jXp2-GWdNjRzhl1cBAaGp9Hd3QpwUJcZjnNYVlCMd4lfE.width-1000.png 334w" width="334"></p>
<h3>Updating the Angular App Module</h3>
<p>The application relies on two additional modules: one to implement forms and one to use HTTP.</p>
<p>Add the following two import statements to the top of <em>ClientApp/src/app/app.module.ts</em>:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>FormsModule</span> <span>}</span> <span>from</span> <span>'@angular/forms'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>HttpClientModule</span> <span>}</span> <span>from</span> <span>'@angular/common/http'</span><span>;</span>
</span></pre></div>
</div>

    
      <p>Next, add these modules to the <code>imports</code> array of the <code>@NgModule</code> as follows:</p>
    
      

<div>
    <div><pre><span><span>imports</span><span>:</span> <span>[</span>
</span><span>  <span>BrowserModule</span><span>,</span>
</span><span>  <span>HttpClientModule</span><span>,</span>
</span><span>  <span>FormsModule</span>
</span><span><span>],</span>
</span></pre></div>
</div>

    
      <div><h3>Add JavaScript polyfills</h3>
<p>A JavaScript project wouldn’t be complete without polyfills, right? Angular is no exception to this. Luckily, the Angular tooling provides a polyfill file.</p>
<p>Add the following JavaScript to the bottom of the existing <em>ClientApp/src/polyfill.ts</em>&nbsp;file:</p>
</div>
    
      

<div>
    <div><pre><span><span>// https://github.com/angular/angular-cli/issues/9827#issuecomment-386154063</span>
</span><span><span>// Add global to window, assigning the value of window itself.</span>
</span><span><span>(</span><span>window</span> <span>as</span> <span>any</span><span>).</span><span>global</span> <span>=</span> <span>window</span><span>;</span>
</span></pre></div>
</div>

    
      <div><h3>Create Angular services</h3>
<p>The <code>DeviceService</code> class will provide information about the media devices used in the application, including their availability and whether the user has granted the app permission to use them.</p>
<p>Replace the contents of the <em>services/device.service.ts</em>&nbsp;file with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>Injectable</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>ReplaySubject</span><span>,</span> <span>Observable</span> <span>}</span> <span>from</span> <span>'rxjs'</span><span>;</span>
</span><span>
</span><span><span>export</span> <span>type</span> <span>Devices</span> <span>=</span> <span>MediaDeviceInfo</span><span>[];</span>
</span><span>
</span><span><span>@Injectable</span><span>({</span>
</span><span>    <span>providedIn</span><span>:</span> <span>'root'</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>DeviceService</span> <span>{</span>
</span><span>    <span>$devicesUpdated</span>: <span>Observable</span><span>&lt;</span><span>Promise</span><span>&lt;</span><span>Devices</span><span>&gt;&gt;</span><span>;</span>
</span><span>
</span><span>    <span>private</span> <span>deviceBroadcast</span> <span>=</span> <span>new</span> <span>ReplaySubject</span><span>&lt;</span><span>Promise</span><span>&lt;</span><span>Devices</span><span>&gt;&gt;</span><span>();</span>
</span><span>
</span><span>    <span>constructor</span><span>()</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>navigator</span> <span>&amp;&amp;</span> <span>navigator</span><span>.</span><span>mediaDevices</span><span>)</span> <span>{</span>
</span><span>            <span>navigator</span><span>.</span><span>mediaDevices</span><span>.</span><span>ondevicechange</span> <span>=</span> <span>(</span><span>_</span>: <span>Event</span><span>)</span> <span>=&gt;</span> <span>{</span>
</span><span>                <span>this</span><span>.</span><span>deviceBroadcast</span><span>.</span><span>next</span><span>(</span><span>this</span><span>.</span><span>getDeviceOptions</span><span>());</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>this</span><span>.</span><span>$devicesUpdated</span> <span>=</span> <span>this</span><span>.</span><span>deviceBroadcast</span><span>.</span><span>asObservable</span><span>();</span>
</span><span>        <span>this</span><span>.</span><span>deviceBroadcast</span><span>.</span><span>next</span><span>(</span><span>this</span><span>.</span><span>getDeviceOptions</span><span>());</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>async</span> <span>isGrantedMediaPermissions() {</span>
</span><span>        <span>if</span> <span>(</span><span>navigator</span> <span>&amp;&amp;</span> <span>navigator</span><span>[</span><span>'permissions'</span><span>])</span> <span>{</span>
</span><span>            <span>try</span> <span>{</span>
</span><span>                <span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>navigator</span><span>[</span><span>'permissions'</span><span>].</span><span>query</span><span>({</span> <span>name</span><span>:</span> <span>'camera'</span> <span>});</span>
</span><span>                <span>if</span> <span>(</span><span>result</span><span>)</span> <span>{</span>
</span><span>                    <span>if</span> <span>(</span><span>result</span><span>.</span><span>state</span> <span>===</span> <span>'granted'</span><span>)</span> <span>{</span>
</span><span>                        <span>return</span> <span>true</span><span>;</span>
</span><span>                    <span>}</span> <span>else</span> <span>{</span>
</span><span>                        <span>const</span> <span>isGranted</span> <span>=</span> <span>await</span> <span>new</span> <span>Promise</span><span>&lt;</span><span>boolean</span><span>&gt;</span><span>(</span><span>resolve</span> <span>=&gt;</span> <span>{</span>
</span><span>                            <span>result</span><span>.</span><span>onchange</span> <span>=</span> <span>(</span><span>_</span>: <span>Event</span><span>)</span> <span>=&gt;</span> <span>{</span>
</span><span>                                <span>const</span> <span>granted</span> <span>=</span> <span>_</span><span>.</span><span>target</span><span>[</span><span>'state'</span><span>]</span> <span>===</span> <span>'granted'</span><span>;</span>
</span><span>                                <span>if</span> <span>(</span><span>granted</span><span>)</span> <span>{</span>
</span><span>                                    <span>resolve</span><span>(</span><span>true</span><span>);</span>
</span><span>                                <span>}</span>
</span><span>                            <span>}</span>
</span><span>                        <span>});</span>
</span><span>
</span><span>                        <span>return</span> <span>isGranted</span><span>;</span>
</span><span>                    <span>}</span>
</span><span>                <span>}</span>
</span><span>            <span>}</span> <span>catch</span> <span>(</span><span>e</span><span>)</span> <span>{</span>
</span><span>                <span>// This is only currently supported in Chrome.</span>
</span><span>                <span>// https://stackoverflow.com/a/53155894/2410379</span>
</span><span>                <span>return</span> <span>true</span><span>;</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>return</span> <span>false</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>async</span> <span>getDeviceOptions</span><span>()</span><span>:</span> <span>Promise</span><span>&lt;</span><span>Devices</span><span>&gt;</span> <span>{</span>
</span><span>        <span>const</span> <span>isGranted</span> <span>=</span> <span>await</span> <span>this</span><span>.</span><span>isGrantedMediaPermissions</span><span>();</span>
</span><span>        <span>if</span> <span>(</span><span>navigator</span> <span>&amp;&amp;</span> <span>navigator</span><span>.</span><span>mediaDevices</span> <span>&amp;&amp;</span> <span>isGranted</span><span>)</span> <span>{</span>
</span><span>            <span>let</span> <span>devices</span> <span>=</span> <span>await</span> <span>this</span><span>.</span><span>tryGetDevices</span><span>();</span>
</span><span>            <span>if</span> <span>(</span><span>devices</span><span>.</span><span>every</span><span>(</span><span>d</span> <span>=&gt;</span> <span>!</span><span>d</span><span>.</span><span>label</span><span>))</span> <span>{</span>
</span><span>                <span>devices</span> <span>=</span> <span>await</span> <span>this</span><span>.</span><span>tryGetDevices</span><span>();</span>
</span><span>            <span>}</span>
</span><span>            <span>return</span> <span>devices</span><span>;</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>return</span> <span>null</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>async</span> <span>tryGetDevices() {</span>
</span><span>        <span>const</span> <span>mediaDevices</span> <span>=</span> <span>await</span> <span>navigator</span><span>.</span><span>mediaDevices</span><span>.</span><span>enumerateDevices</span><span>();</span>
</span><span>        <span>const</span> <span>devices</span> <span>=</span> <span>[</span><span>'audioinput'</span><span>,</span> <span>'audiooutput'</span><span>,</span> <span>'videoinput'</span><span>].</span><span>reduce</span><span>((</span><span>options</span><span>,</span> <span>kind</span><span>)</span> <span>=&gt;</span> <span>{</span>
</span><span>            <span>return</span> <span>options</span><span>[</span><span>kind</span><span>]</span> <span>=</span> <span>mediaDevices</span><span>.</span><span>filter</span><span>(</span><span>device</span> <span>=&gt;</span> <span>device</span><span>.</span><span>kind</span> <span>===</span> <span>kind</span><span>);</span>
</span><span>        <span>},</span> <span>[]</span> <span>as</span> <span>Devices</span><span>);</span>
</span><span>
</span><span>        <span>return</span> <span>devices</span><span>;</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>This service provides a media devices observable to which concerned listeners can subscribe. When media device information changes, such as unplugging or plugging in a USB web camera, this service will notify all listeners. It also attempts to wait for the user to grant permissions to the various media devices consumed by the <code>twilio-video</code> SDK.</p>
<p>The <code>VideoChatService</code> is used to access the server-side ASP.NET Core Web API endpoints. It exposes the ability to get the list of rooms and the ability to create or join a named room.</p>
<p>Replace the contents of the &nbsp;<em>services/videochat.service.ts</em>&nbsp;file&nbsp;with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>connect</span><span>,</span> <span>ConnectOptions</span><span>,</span> <span>LocalTrack</span><span>,</span> <span>Room</span> <span>}</span> <span>from</span> <span>'twilio-video'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>Injectable</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>HttpClient</span> <span>}</span> <span>from</span> <span>'@angular/common/http'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>ReplaySubject</span> <span>,</span> <span>Observable</span> <span>}</span> <span>from</span> <span>'rxjs'</span><span>;</span>
</span><span>
</span><span><span>interface</span> <span>AuthToken</span> <span>{</span>
</span><span>    <span>token</span>: <span>string</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>export</span> <span>interface</span> <span>NamedRoom</span> <span>{</span>
</span><span>    <span>id</span>: <span>string</span><span>;</span>
</span><span>    <span>name</span>: <span>string</span><span>;</span>
</span><span>    <span>maxParticipants?</span>: <span>number</span><span>;</span>
</span><span>    <span>participantCount</span>: <span>number</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>export</span> <span>type</span> <span>Rooms</span> <span>=</span> <span>NamedRoom</span><span>[];</span>
</span><span>
</span><span><span>@Injectable</span><span>({</span>
</span><span>    <span>providedIn</span><span>:</span> <span>'root'</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>VideoChatService</span> <span>{</span>
</span><span>    <span>$roomsUpdated</span>: <span>Observable</span><span>&lt;</span><span>boolean</span><span>&gt;</span><span>;</span>
</span><span>
</span><span>    <span>private</span> <span>roomBroadcast</span> <span>=</span> <span>new</span> <span>ReplaySubject</span><span>&lt;</span><span>boolean</span><span>&gt;</span><span>();</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span><span>private</span> <span>readonly</span> <span>http</span>: <span>HttpClient</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>$roomsUpdated</span> <span>=</span> <span>this</span><span>.</span><span>roomBroadcast</span><span>.</span><span>asObservable</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>async</span> <span>getAuthToken() {</span>
</span><span>        <span>const</span> <span>auth</span> <span>=</span>
</span><span>            <span>await</span> <span>this</span><span>.</span><span>http</span>
</span><span>                      <span>.</span><span>get</span><span>&lt;</span><span>AuthToken</span><span>&gt;</span><span>(</span><span>`api/video/token`</span><span>)</span>
</span><span>                      <span>.</span><span>toPromise</span><span>();</span>
</span><span>
</span><span>        <span>return</span> <span>auth</span><span>.</span><span>token</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>getAllRooms() {</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>http</span>
</span><span>                   <span>.</span><span>get</span><span>&lt;</span><span>Rooms</span><span>&gt;</span><span>(</span><span>'api/video/rooms'</span><span>)</span>
</span><span>                   <span>.</span><span>toPromise</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>joinOrCreateRoom</span><span>(</span><span>name</span>: <span>string</span><span>,</span> <span>tracks</span>: <span>LocalTrack</span><span>[])</span> <span>{</span>
</span><span>        <span>let</span> <span>room</span>: <span>Room</span> <span>=</span> <span>null</span><span>;</span>
</span><span>        <span>try</span> <span>{</span>
</span><span>            <span>const</span> <span>token</span> <span>=</span> <span>await</span> <span>this</span><span>.</span><span>getAuthToken</span><span>();</span>
</span><span>            <span>room</span> <span>=</span>
</span><span>                <span>await</span> <span>connect</span><span>(</span>
</span><span>                    <span>token</span><span>,</span> <span>{</span>
</span><span>                        <span>name</span><span>,</span>
</span><span>                        <span>tracks</span><span>,</span>
</span><span>                        <span>dominantSpeaker</span>: <span>true</span>
</span><span>                    <span>}</span> <span>as</span> <span>ConnectOptions</span><span>);</span>
</span><span>        <span>}</span> <span>catch</span> <span>(</span><span>error</span><span>)</span> <span>{</span>
</span><span>            <span>console</span><span>.</span><span>error</span><span>(</span><span>`Unable to connect to Room: </span><span>${</span><span>error</span><span>.</span><span>message</span><span>}</span><span>`</span><span>);</span>
</span><span>        <span>}</span> <span>finally</span> <span>{</span>
</span><span>            <span>if</span> <span>(</span><span>room</span><span>)</span> <span>{</span>
</span><span>                <span>this</span><span>.</span><span>roomBroadcast</span><span>.</span><span>next</span><span>(</span><span>true</span><span>);</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>return</span> <span>room</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>nudge() {</span>
</span><span>        <span>this</span><span>.</span><span>roomBroadcast</span><span>.</span><span>next</span><span>(</span><span>true</span><span>);</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>Notice that the retrieval of the Twilio JWT is marked <code>private</code>&nbsp;The <code>getAuthToken</code> method&nbsp;is only used&nbsp;within the <code>VideoChatService</code> class&nbsp;for the invocation of <code>connect</code> from the <code>twilio-video</code> module, which is done asynchronously in the <code>joinOrCreateRoom</code> method.</p>
<h3>General concepts</h3>
<p>Now that the core services are in place, how should they interact with one another and how should they behave?&nbsp;<em>Users</em>&nbsp;need to be able to create or join <em>rooms</em>. A room is a Twilio resource, and a room can have one or more <em>participant</em>. A participant is also a Twilio resource. Likewise, participants have <em>track publications</em>&nbsp;that provide access to video and audio media tracks.&nbsp;Participants and rooms share <em>cameras</em>&nbsp;which provide track publications for both audio and video tracks. The app has Angular components for each of these.</p>
<h3>Implement the Camera&nbsp;component</h3>
<p>In addition to providing audio and video tracks for room participants to share, the <code>CameraComponent</code> also displays a local camera preview. By rendering locally-created audio and video tracks to the DOM as the <code>&lt;app-camera&gt;</code> element. The Twilio Programmable Video <a href="https://www.twilio.com/docs/video/javascript">JavaScript Platform SDK</a>, imported from &nbsp;<code>twilio-video</code>, provides an easy-to-use API for creating and managing the local tracks.</p>
<p>Replace the contents of the <em>camera/camera.component.ts</em>&nbsp;file with the following&nbsp;TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>Component</span><span>,</span> <span>ElementRef</span><span>,</span> <span>ViewChild</span><span>,</span> <span>AfterViewInit</span><span>,</span> <span>Renderer2</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>createLocalTracks</span><span>,</span> <span>LocalTrack</span><span>,</span> <span>LocalVideoTrack</span> <span>}</span> <span>from</span> <span>'twilio-video'</span><span>;</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-camera'</span><span>,</span>
</span><span>    <span>styleUrls</span><span>:</span> <span>[</span><span>'./camera.component.css'</span><span>],</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./camera.component.html'</span><span>,</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>CameraComponent</span> <span>implements</span> <span>AfterViewInit</span> <span>{</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'preview'</span><span>)</span> <span>previewElement</span>: <span>ElementRef</span><span>;</span>
</span><span>
</span><span>    <span>get</span> <span>tracks</span><span>()</span><span>:</span> <span>LocalTrack</span><span>[]</span> <span>{</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>localTracks</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>isInitializing</span>: <span>boolean</span> <span>=</span> <span>true</span><span>;</span>
</span><span>
</span><span>    <span>private</span> <span>videoTrack</span>: <span>LocalVideoTrack</span><span>;</span>
</span><span>    <span>private</span> <span>localTracks</span>: <span>LocalTrack</span><span>[]</span> <span>=</span> <span>[];</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span>
</span><span>        <span>private</span> <span>readonly</span> <span>renderer</span>: <span>Renderer2</span><span>)</span> <span>{</span> <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>ngAfterViewInit() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>previewElement</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>previewElement</span><span>.</span><span>nativeElement</span><span>)</span> <span>{</span>
</span><span>            <span>await</span> <span>this</span><span>.</span><span>initializeDevice</span><span>();</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>initializePreview</span><span>(</span><span>deviceInfo?</span>: <span>MediaDeviceInfo</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>deviceInfo</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>initializeDevice</span><span>(</span><span>deviceInfo</span><span>.</span><span>kind</span><span>,</span> <span>deviceInfo</span><span>.</span><span>deviceId</span><span>);</span>
</span><span>        <span>}</span> <span>else</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>initializeDevice</span><span>();</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>finalizePreview() {</span>
</span><span>        <span>try</span> <span>{</span>
</span><span>            <span>if</span> <span>(</span><span>this</span><span>.</span><span>videoTrack</span><span>)</span> <span>{</span>
</span><span>                <span>this</span><span>.</span><span>videoTrack</span><span>.</span><span>detach</span><span>().</span><span>forEach</span><span>(</span><span>element</span> <span>=&gt;</span> <span>element</span><span>.</span><span>remove</span><span>());</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span> <span>catch</span> <span>(</span><span>e</span><span>)</span> <span>{</span>
</span><span>            <span>console</span><span>.</span><span>error</span><span>(</span><span>e</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>async</span> <span>initializeDevice</span><span>(</span><span>kind?</span>: <span>MediaDeviceKind</span><span>,</span> <span>deviceId?</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>try</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>isInitializing</span> <span>=</span> <span>true</span><span>;</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>finalizePreview</span><span>();</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>localTracks</span> <span>=</span> <span>kind</span> <span>&amp;&amp;</span> <span>deviceId</span>
</span><span>                <span>?</span> <span>await</span> <span>this</span><span>.</span><span>initializeTracks</span><span>(</span><span>kind</span><span>,</span> <span>deviceId</span><span>)</span>
</span><span>                <span>:</span> <span>await</span> <span>this</span><span>.</span><span>initializeTracks</span><span>();</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>videoTrack</span> <span>=</span> <span>this</span><span>.</span><span>localTracks</span><span>.</span><span>find</span><span>(</span><span>t</span> <span>=&gt;</span> <span>t</span><span>.</span><span>kind</span> <span>===</span> <span>'video'</span><span>)</span> <span>as</span> <span>LocalVideoTrack</span><span>;</span>
</span><span>            <span>const</span> <span>videoElement</span> <span>=</span> <span>this</span><span>.</span><span>videoTrack</span><span>.</span><span>attach</span><span>();</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>setStyle</span><span>(</span><span>videoElement</span><span>,</span> <span>'height'</span><span>,</span> <span>'100%'</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>setStyle</span><span>(</span><span>videoElement</span><span>,</span> <span>'width'</span><span>,</span> <span>'100%'</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>appendChild</span><span>(</span><span>this</span><span>.</span><span>previewElement</span><span>.</span><span>nativeElement</span><span>,</span> <span>videoElement</span><span>);</span>
</span><span>        <span>}</span> <span>finally</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>isInitializing</span> <span>=</span> <span>false</span><span>;</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>initializeTracks</span><span>(</span><span>kind?</span>: <span>MediaDeviceKind</span><span>,</span> <span>deviceId?</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>kind</span><span>)</span> <span>{</span>
</span><span>            <span>switch</span> <span>(</span><span>kind</span><span>)</span> <span>{</span>
</span><span>                <span>case</span> <span>'audioinput'</span><span>:</span>
</span><span>                    <span>return</span> <span>createLocalTracks</span><span>({</span> <span>audio</span><span>:</span> <span>{</span> <span>deviceId</span> <span>},</span> <span>video</span>: <span>true</span> <span>});</span>
</span><span>                <span>case</span> <span>'videoinput'</span><span>:</span>
</span><span>                    <span>return</span> <span>createLocalTracks</span><span>({</span> <span>audio</span>: <span>true</span><span>,</span> <span>video</span><span>:</span> <span>{</span> <span>deviceId</span> <span>}</span> <span>});</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>return</span> <span>createLocalTracks</span><span>({</span> <span>audio</span>: <span>true</span><span>,</span> <span>video</span>: <span>true</span> <span>});</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <p>Replace the contents of&nbsp;the <em>camera/camera.component.html</em>&nbsp;file&nbsp;with the following HTML markup:</p>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>div</span> <span>id</span><span>=</span><span>"preview"</span> <span>#</span><span>preview</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>*</span><span>ngIf</span><span>=</span><span>"isInitializing"</span><span>&gt;</span>Loading preview... Please wait.<span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>div</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>In the TypeScript code above, the Angular <code>@ViewChild</code> decorator is used to get a reference to the <code>#preview</code> HTML element used the view. With the reference to the element, the Twilio JavaScript SDK can create local video and audio tracks associated with the device.</p>
<p>Once the tracks are created, the code finds the video track and appends it to the <code>#preview</code> element. The result is a live video feed rendered on the HTML page.</p>
<h3>Implement the Rooms&nbsp;component</h3>
<p>The <code>RoomsComponent</code> provides an interface for users to create rooms by entering a <code>roomName</code> through an <code>&lt;input type=’text’&gt;</code> element and a <code>&lt;button&gt;</code> element bound to the <code>onTryAddRoom</code> method of the class. The user interface looks like the following:</p>
<p><img alt="Angular create a room with Twilio Video UI" height="253" sizes="438px" src="https://twilio-cms-prod.s3.amazonaws.com/images/bU656GHcn7gfMRnPFB9NzqFWWGOul4973iNQj60MpyFBeJ.width-500.png" srcset="https://twilio-cms-prod.s3.amazonaws.com/images/bU656GHcn7gfMRnPFB9NzqFWWGOul4973iNQj60MpyFBeJ.width-500.png 438w, https://twilio-cms-prod.s3.amazonaws.com/images/bU656GHcn7gfMRnPFB9NzqFWWGOul4973iNQj60MpyFBe.width-1000.png 438w" width="438"></p>
<p>As users add rooms the list of existing rooms will appear below the room creation controls. The name of each existing room will appear along with the number of active participants and the room’s capacity, like the example shown below.</p>
<p><img alt="Angular Twilio Video showing a created room" height="213" sizes="436px" src="https://twilio-cms-prod.s3.amazonaws.com/images/YMA3TnLWqEG3r76TtURX4xTbzjY43WJjFnK-IwGVBjV6-8.width-500.png" srcset="https://twilio-cms-prod.s3.amazonaws.com/images/YMA3TnLWqEG3r76TtURX4xTbzjY43WJjFnK-IwGVBjV6-8.width-500.png 436w, https://twilio-cms-prod.s3.amazonaws.com/images/YMA3TnLWqEG3r76TtURX4xTbzjY43WJjFnK-IwGVBjV6-.width-1000.png 436w" width="436"></p>
<p>To implement the rooms user interface, replace the markup in the <em>rooms/rooms.component.html</em><em>&nbsp;</em>file with the following HTML markup:</p></div>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"jumbotron"</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>h5</span> <span>class</span><span>=</span><span>"display-4"</span><span>&gt;&lt;</span><span>i</span> <span>class</span><span>=</span><span>"fas fa-video"</span><span>&gt;&lt;/</span><span>i</span><span>&gt;</span> Rooms<span>&lt;/</span><span>h5</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"list-group"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"list-group-item d-flex justify-content-between align-items-center"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"input-group"</span><span>&gt;</span>
</span><span>                <span>&lt;</span><span>input</span> <span>type</span><span>=</span><span>"text"</span> <span>class</span><span>=</span><span>"form-control form-control-lg"</span>
</span><span>                       <span>placeholder</span><span>=</span><span>"Room Name"</span> <span>aria-label</span><span>=</span><span>"Room Name"</span>
</span><span>                       <span>[(</span><span>ngModel</span><span>)]="</span><span>roomName</span><span>"</span> <span>(</span><span>keydown</span><span>.</span><span>enter</span><span>)="</span><span>onTryAddRoom</span><span>()"</span><span>&gt;</span>
</span><span>                <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"input-group-append"</span><span>&gt;</span>
</span><span>                    <span>&lt;</span><span>button</span> <span>class</span><span>=</span><span>"btn btn-lg btn-outline-secondary twitter-red"</span>
</span><span>                            <span>type</span><span>=</span><span>"button"</span> <span>[</span><span>disabled</span><span>]="!</span><span>roomName</span><span>"</span>
</span><span>                            <span>(</span><span>click</span><span>)="</span><span>onAddRoom</span><span>(</span><span>roomName</span><span>)"</span><span>&gt;</span>
</span><span>                        <span>&lt;</span><span>i</span> <span>class</span><span>=</span><span>"far fa-plus-square"</span><span>&gt;&lt;/</span><span>i</span><span>&gt;</span> Create
</span><span>                    <span>&lt;/</span><span>button</span><span>&gt;</span>
</span><span>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>            <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>*</span><span>ngIf</span><span>=</span><span>"!rooms || !rooms.length"</span> <span>class</span><span>=</span><span>"list-group-item d-flex justify-content-between align-items-center"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>p</span> <span>class</span><span>=</span><span>"lead"</span><span>&gt;</span>
</span><span>                Add a room to begin. Other online participants can join or create rooms.
</span><span>            <span>&lt;/</span><span>p</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>a</span> <span>href</span><span>=</span><span>"#"</span> <span>*</span><span>ngFor</span><span>=</span><span>"let room of rooms"</span>
</span><span>           <span>(</span><span>click</span><span>)="</span><span>onJoinRoom</span><span>(</span><span>room</span><span>.</span><span>name</span><span>)"</span> <span>[</span><span>ngClass</span><span>]="{</span> <span>'</span><span>active</span><span>'</span><span>:</span> <span>activeRoomName </span><span>=</span><span>==</span> <span>room</span><span>.</span><span>name</span> <span>}"</span>
</span><span>           <span>class</span><span>=</span><span>"list-group-item list-group-item-action d-flex justify-content-between align-items-center"</span><span>&gt;</span>
</span><span>            {{ room.name }}
</span><span>            <span>&lt;</span><span>span</span> <span>class</span><span>=</span><span>"badge badge-primary badge-pill"</span><span>&gt;</span>
</span><span>                {{ room.participantCount }} / {{ room.maxParticipants }}
</span><span>            <span>&lt;/</span><span>span</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>a</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>div</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>The <code>RoomsComponent</code> subscribes to the <code>videoChatService.$roomsUpdated</code> observable. Any time a room is created, <code>RoomsComponent</code> will signal its creation through the observable and the <code>NotificationHub</code> service will be listening. Using SignalR, the <code>NotificationHub</code> echos this message out to all the other connected clients. This mechanism enables the server-side code to provide real-time web functionality to client apps. In this application, the <code>RoomsComponent</code> will automatically update the list of available rooms.</p>
<p>To implement the <code>RoomsComponent</code> functionality replace the contents of the&nbsp;<em>rooms/rooms.component.ts </em>file&nbsp;with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>Component</span><span>,</span> <span>OnInit</span><span>,</span> <span>OnDestroy</span><span>,</span> <span>EventEmitter</span><span>,</span> <span>Output</span><span>,</span> <span>Input</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>Subscription</span> <span>}</span> <span>from</span> <span>'rxjs'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>tap</span> <span>}</span> <span>from</span> <span>'rxjs/operators'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>NamedRoom</span><span>,</span> <span>VideoChatService</span> <span>}</span> <span>from</span> <span>'../services/videochat.service'</span><span>;</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-rooms'</span><span>,</span>
</span><span>    <span>styleUrls</span><span>:</span> <span>[</span><span>'./rooms.component.css'</span><span>],</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./rooms.component.html'</span><span>,</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>RoomsComponent</span> <span>implements</span> <span>OnInit</span><span>,</span> <span>OnDestroy</span> <span>{</span>
</span><span>    <span>@Output</span><span>()</span> <span>roomChanged</span> <span>=</span> <span>new</span> <span>EventEmitter</span><span>&lt;</span><span>string</span><span>&gt;</span><span>();</span>
</span><span>    <span>@Input</span><span>()</span> <span>activeRoomName</span>: <span>string</span><span>;</span>
</span><span>
</span><span>    <span>roomName</span>: <span>string</span><span>;</span>
</span><span>    <span>rooms</span>: <span>NamedRoom</span><span>[];</span>
</span><span>
</span><span>    <span>private</span> <span>subscription</span>: <span>Subscription</span><span>;</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span>
</span><span>        <span>private</span> <span>readonly</span> <span>videoChatService</span>: <span>VideoChatService</span><span>)</span> <span>{</span> <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>ngOnInit() {</span>
</span><span>        <span>await</span> <span>this</span><span>.</span><span>updateRooms</span><span>();</span>
</span><span>        <span>this</span><span>.</span><span>subscription</span> <span>=</span>
</span><span>            <span>this</span><span>.</span><span>videoChatService</span>
</span><span>                <span>.</span><span>$roomsUpdated</span>
</span><span>                <span>.</span><span>pipe</span><span>(</span><span>tap</span><span>(</span><span>_</span> <span>=&gt;</span> <span>this</span><span>.</span><span>updateRooms</span><span>()))</span>
</span><span>                <span>.</span><span>subscribe</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>ngOnDestroy() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>subscription</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>subscription</span><span>.</span><span>unsubscribe</span><span>();</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onTryAddRoom() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>roomName</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>onAddRoom</span><span>(</span><span>this</span><span>.</span><span>roomName</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onAddRoom</span><span>(</span><span>roomName</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>roomName</span> <span>=</span> <span>null</span><span>;</span>
</span><span>        <span>this</span><span>.</span><span>roomChanged</span><span>.</span><span>emit</span><span>(</span><span>roomName</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onJoinRoom</span><span>(</span><span>roomName</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>roomChanged</span><span>.</span><span>emit</span><span>(</span><span>roomName</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>updateRooms() {</span>
</span><span>        <span>this</span><span>.</span><span>rooms</span> <span>=</span> <span>(</span><span>await</span> <span>this</span><span>.</span><span>videoChatService</span><span>.</span><span>getAllRooms</span><span>())</span> <span>as</span> <span>NamedRoom</span><span>[];</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>Under the hood, when a user selects a room to join or creates a room, they connect to that room via the <code>twilio-video</code> SDK.</p>
<p>The <code>RoomsComponent</code> expects a room name and an array of <code>LocalTrack</code> objects. These local tracks come from the local camera preview, which provides both an audio and a video track. The <code>LocalTrack</code> objects are published to rooms that a user joins so other participants can subscribe to and receive them.</p>
<h3>Implement the Participants&nbsp;component</h3>
<p>What good is a room without any participants?&nbsp;It's just an empty room—that's no fun!</p>
<p>But rooms do have something very cool: they extend <code>EventEmitter</code>. This means a room enables the registration of event listeners.</p>
<p>To implement&nbsp;the <code>ParticipantsComponent</code>, replace&nbsp;the contents of the <em>participants/participants.component.ts</em>&nbsp;file&nbsp;with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span>
</span><span>    <span>Component</span><span>,</span>
</span><span>    <span>ViewChild</span><span>,</span>
</span><span>    <span>ElementRef</span><span>,</span>
</span><span>    <span>Output</span><span>,</span>
</span><span>    <span>Input</span><span>,</span>
</span><span>    <span>EventEmitter</span><span>,</span>
</span><span>    <span>Renderer2</span>
</span><span><span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span>
</span><span>    <span>Participant</span><span>,</span>
</span><span>    <span>RemoteTrack</span><span>,</span>
</span><span>    <span>RemoteAudioTrack</span><span>,</span>
</span><span>    <span>RemoteVideoTrack</span><span>,</span>
</span><span>    <span>RemoteParticipant</span><span>,</span>
</span><span>    <span>RemoteTrackPublication</span>
</span><span><span>}</span> <span>from</span> <span>'twilio-video'</span><span>;</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-participants'</span><span>,</span>
</span><span>    <span>styleUrls</span><span>:</span> <span>[</span><span>'./participants.component.css'</span><span>],</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./participants.component.html'</span><span>,</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>ParticipantsComponent</span> <span>{</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'list'</span><span>)</span> <span>listRef</span>: <span>ElementRef</span><span>;</span>
</span><span>    <span>@Output</span><span>(</span><span>'participantsChanged'</span><span>)</span> <span>participantsChanged</span> <span>=</span> <span>new</span> <span>EventEmitter</span><span>&lt;</span><span>boolean</span><span>&gt;</span><span>();</span>
</span><span>    <span>@Output</span><span>(</span><span>'leaveRoom'</span><span>)</span> <span>leaveRoom</span> <span>=</span> <span>new</span> <span>EventEmitter</span><span>&lt;</span><span>boolean</span><span>&gt;</span><span>();</span>
</span><span>    <span>@Input</span><span>(</span><span>'activeRoomName'</span><span>)</span> <span>activeRoomName</span>: <span>string</span><span>;</span>
</span><span>
</span><span>    <span>get</span> <span>participantCount() {</span>
</span><span>        <span>return</span> <span>!!</span><span>this</span><span>.</span><span>participants</span> <span>?</span> <span>this</span><span>.</span><span>participants.size</span> : <span>0</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>get</span> <span>isAlone() {</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>participantCount</span> <span>===</span> <span>0</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>participants</span>: <span>Map</span><span>&lt;</span><span>Participant</span><span>.</span><span>SID</span><span>,</span> <span>RemoteParticipant</span><span>&gt;</span><span>;</span>
</span><span>    <span>private</span> <span>dominantSpeaker</span>: <span>RemoteParticipant</span><span>;</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span><span>private</span> <span>readonly</span> <span>renderer</span>: <span>Renderer2</span><span>)</span> <span>{</span> <span>}</span>
</span><span>
</span><span>    <span>clear() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>participants</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>participants</span><span>.</span><span>clear</span><span>();</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>initialize</span><span>(</span><span>participants</span>: <span>Map</span><span>&lt;</span><span>Participant</span><span>.</span><span>SID</span><span>,</span> <span>RemoteParticipant</span><span>&gt;</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>participants</span> <span>=</span> <span>participants</span><span>;</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>participants</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>participants</span><span>.</span><span>forEach</span><span>(</span><span>participant</span> <span>=&gt;</span> <span>this</span><span>.</span><span>registerParticipantEvents</span><span>(</span><span>participant</span><span>));</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>add</span><span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>participants</span> <span>&amp;&amp;</span> <span>participant</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>participants</span><span>.</span><span>set</span><span>(</span><span>participant</span><span>.</span><span>sid</span><span>,</span> <span>participant</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>registerParticipantEvents</span><span>(</span><span>participant</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>remove</span><span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>participants</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>participants</span><span>.</span><span>has</span><span>(</span><span>participant</span><span>.</span><span>sid</span><span>))</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>participants</span><span>.</span><span>delete</span><span>(</span><span>participant</span><span>.</span><span>sid</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>loudest</span><span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>dominantSpeaker</span> <span>=</span> <span>participant</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onLeaveRoom() {</span>
</span><span>        <span>this</span><span>.</span><span>leaveRoom</span><span>.</span><span>emit</span><span>(</span><span>true</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>registerParticipantEvents</span><span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>participant</span><span>)</span> <span>{</span>
</span><span>            <span>participant</span><span>.</span><span>tracks</span><span>.</span><span>forEach</span><span>(</span><span>publication</span> <span>=&gt;</span> <span>this</span><span>.</span><span>subscribe</span><span>(</span><span>publication</span><span>));</span>
</span><span>            <span>participant</span><span>.</span><span>on</span><span>(</span><span>'trackPublished'</span><span>,</span> <span>publication</span> <span>=&gt;</span> <span>this</span><span>.</span><span>subscribe</span><span>(</span><span>publication</span><span>));</span>
</span><span>            <span>participant</span><span>.</span><span>on</span><span>(</span><span>'trackUnpublished'</span><span>,</span>
</span><span>                <span>publication</span> <span>=&gt;</span> <span>{</span>
</span><span>                    <span>if</span> <span>(</span><span>publication</span> <span>&amp;&amp;</span> <span>publication</span><span>.</span><span>track</span><span>)</span> <span>{</span>
</span><span>                        <span>this</span><span>.</span><span>detachRemoteTrack</span><span>(</span><span>publication</span><span>.</span><span>track</span><span>);</span>
</span><span>                    <span>}</span>
</span><span>                <span>});</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>subscribe</span><span>(</span><span>publication</span>: <span>RemoteTrackPublication</span> <span>|</span> <span>any</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>publication</span> <span>&amp;&amp;</span> <span>publication</span><span>.</span><span>on</span><span>)</span> <span>{</span>
</span><span>            <span>publication</span><span>.</span><span>on</span><span>(</span><span>'subscribed'</span><span>,</span> <span>track</span> <span>=&gt;</span> <span>this</span><span>.</span><span>attachRemoteTrack</span><span>(</span><span>track</span><span>));</span>
</span><span>            <span>publication</span><span>.</span><span>on</span><span>(</span><span>'unsubscribed'</span><span>,</span> <span>track</span> <span>=&gt;</span> <span>this</span><span>.</span><span>detachRemoteTrack</span><span>(</span><span>track</span><span>));</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>attachRemoteTrack</span><span>(</span><span>track</span>: <span>RemoteTrack</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>isAttachable</span><span>(</span><span>track</span><span>))</span> <span>{</span>
</span><span>            <span>const</span> <span>element</span> <span>=</span> <span>track</span><span>.</span><span>attach</span><span>();</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>data</span><span>.</span><span>id</span> <span>=</span> <span>track</span><span>.</span><span>sid</span><span>;</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>setStyle</span><span>(</span><span>element</span><span>,</span> <span>'width'</span><span>,</span> <span>'95%'</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>setStyle</span><span>(</span><span>element</span><span>,</span> <span>'margin-left'</span><span>,</span> <span>'2.5%'</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>renderer</span><span>.</span><span>appendChild</span><span>(</span><span>this</span><span>.</span><span>listRef</span><span>.</span><span>nativeElement</span><span>,</span> <span>element</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>participantsChanged</span><span>.</span><span>emit</span><span>(</span><span>true</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>detachRemoteTrack</span><span>(</span><span>track</span>: <span>RemoteTrack</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>isDetachable</span><span>(</span><span>track</span><span>))</span> <span>{</span>
</span><span>            <span>track</span><span>.</span><span>detach</span><span>().</span><span>forEach</span><span>(</span><span>el</span> <span>=&gt;</span> <span>el</span><span>.</span><span>remove</span><span>());</span>
</span><span>            <span>this</span><span>.</span><span>participantsChanged</span><span>.</span><span>emit</span><span>(</span><span>true</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>isAttachable</span><span>(</span><span>track</span>: <span>RemoteTrack</span><span>)</span><span>:</span> <span>track</span> <span>is</span> <span>RemoteAudioTrack</span> <span>|</span> <span>RemoteVideoTrack</span> <span>{</span>
</span><span>        <span>return</span> <span>!!</span><span>track</span> <span>&amp;&amp;</span>
</span><span>            <span>((</span><span>track</span> <span>as</span> <span>RemoteAudioTrack</span><span>).</span><span>attach</span> <span>!==</span> <span>undefined</span> <span>||</span>
</span><span>            <span>(</span><span>track</span> <span>as</span> <span>RemoteVideoTrack</span><span>).</span><span>attach</span> <span>!==</span> <span>undefined</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>isDetachable</span><span>(</span><span>track</span>: <span>RemoteTrack</span><span>)</span><span>:</span> <span>track</span> <span>is</span> <span>RemoteAudioTrack</span> <span>|</span> <span>RemoteVideoTrack</span> <span>{</span>
</span><span>        <span>return</span> <span>!!</span><span>track</span> <span>&amp;&amp;</span>
</span><span>            <span>((</span><span>track</span> <span>as</span> <span>RemoteAudioTrack</span><span>).</span><span>detach</span> <span>!==</span> <span>undefined</span> <span>||</span>
</span><span>            <span>(</span><span>track</span> <span>as</span> <span>RemoteVideoTrack</span><span>).</span><span>detach</span> <span>!==</span> <span>undefined</span><span>);</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>A&nbsp;<code>ParticipantComponent</code>&nbsp;also extends an <code>EventEmitter</code>&nbsp;and offers its own set of valuable events. Between the room, participant, publication,&nbsp;and track,&nbsp;there is a complete set of events to handle when participants join&nbsp;or leave a room. When participants join,&nbsp;an event fires and provides&nbsp;publication details of their tracks&nbsp;so the&nbsp;application can render their audio and video to the user interface DOM of each client as the tracks become&nbsp;available.</p>
<p>To implement the user interface for the participants component, replace the&nbsp;contents of the&nbsp;<em>participants/participants.component.html</em>&nbsp;file&nbsp;with the following HTML markup:</p></div>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>div</span> <span>id</span><span>=</span><span>"participant-list"</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>id</span><span>=</span><span>"alone"</span> <span>[</span><span>ngClass</span><span>]="{</span> <span>'</span><span>table</span><span>'</span><span>:</span> <span>isAlone</span><span>,</span> <span>'</span><span>d-none</span><span>'</span><span>:</span> <span>!</span><span>isAlone</span> <span>}"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>p</span> <span>class</span><span>=</span><span>"text-center text-monospace h3"</span> <span>style</span><span>=</span><span>"display: table-cell"</span><span>&gt;</span>
</span><span>            You're the only one in this room. <span>&lt;</span><span>i</span> <span>class</span><span>=</span><span>"far fa-frown"</span><span>&gt;&lt;/</span><span>i</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>br</span> <span>/&gt;</span>
</span><span>            <span>&lt;</span><span>br</span> <span>/&gt;</span>
</span><span>            As others join, they'll start showing up here...
</span><span>        <span>&lt;/</span><span>p</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>[</span><span>ngClass</span><span>]="{</span> <span>'</span><span>d-none</span><span>'</span><span>:</span> <span>isAlone</span> <span>}"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>nav</span> <span>class</span><span>=</span><span>"navbar navbar-expand-lg navbar-dark bg-light shadow"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>ul</span> <span>class</span><span>=</span><span>"navbar-nav ml-auto"</span><span>&gt;</span>
</span><span>                <span>&lt;</span><span>li</span> <span>class</span><span>=</span><span>"nav-item"</span><span>&gt;</span>
</span><span>                    <span>&lt;</span><span>button</span> <span>type</span><span>=</span><span>"button"</span> <span>class</span><span>=</span><span>"btn btn-lg leave-room"</span>
</span><span>                            <span>title</span><span>=</span><span>"Click to leave this room."</span> <span>(</span><span>click</span><span>)="</span><span>onLeaveRoom</span><span>()"</span><span>&gt;</span>
</span><span>                        Leave "{{ activeRoomName }}" Room?
</span><span>                    <span>&lt;/</span><span>button</span><span>&gt;</span>
</span><span>                <span>&lt;/</span><span>li</span><span>&gt;</span>
</span><span>            <span>&lt;/</span><span>ul</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>nav</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>#</span><span>list</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>div</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>Much like the <code>CameraComponent</code>, the audio and&nbsp;video elements associated with a participant are render targets to the <code>#list</code>&nbsp;element of the DOM. But instead of being local tracks,&nbsp;these are remote tracks published from remote participants.</p>
<h3>Implement device settings&nbsp;management</h3>
<p>There are a few components in play with the concept of settings. We’ll have a <code>camera</code> component beneath several <code>DeviceSelectComponents</code>&nbsp;objects.</p>
<p>Replace the contents of the <em>settings/settings.component.ts</em>&nbsp;file with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span>
</span><span>    <span>Component</span><span>,</span>
</span><span>    <span>OnInit</span><span>,</span>
</span><span>    <span>OnDestroy</span><span>,</span>
</span><span>    <span>EventEmitter</span><span>,</span>
</span><span>    <span>Input</span><span>,</span>
</span><span>    <span>Output</span><span>,</span>
</span><span>    <span>ViewChild</span>
</span><span><span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>CameraComponent</span> <span>}</span> <span>from</span> <span>'../camera/camera.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>DeviceSelectComponent</span> <span>}</span> <span>from</span> <span>'./device-select.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>DeviceService</span> <span>}</span> <span>from</span> <span>'../services/device.service'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>debounceTime</span> <span>}</span> <span>from</span> <span>'rxjs/operators'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>Subscription</span> <span>}</span> <span>from</span> <span>'rxjs'</span><span>;</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-settings'</span><span>,</span>
</span><span>    <span>styleUrls</span><span>:</span> <span>[</span><span>'./settings.component.css'</span><span>],</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./settings.component.html'</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>SettingsComponent</span> <span>implements</span> <span>OnInit</span><span>,</span> <span>OnDestroy</span> <span>{</span>
</span><span>    <span>private</span> <span>devices</span>: <span>MediaDeviceInfo</span><span>[]</span> <span>=</span> <span>[];</span>
</span><span>    <span>private</span> <span>subscription</span>: <span>Subscription</span><span>;</span>
</span><span>    <span>private</span> <span>videoDeviceId</span>: <span>string</span><span>;</span>
</span><span>
</span><span>    <span>get</span> <span>hasAudioInputOptions</span><span>()</span><span>:</span> <span>boolean</span> <span>{</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>devices</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>filter</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>kind</span> <span>===</span> <span>'audioinput'</span><span>).</span><span>length</span> <span>&gt;</span> <span>0</span><span>;</span>
</span><span>    <span>}</span>
</span><span>    <span>get</span> <span>hasAudioOutputOptions</span><span>()</span><span>:</span> <span>boolean</span> <span>{</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>devices</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>filter</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>kind</span> <span>===</span> <span>'audiooutput'</span><span>).</span><span>length</span> <span>&gt;</span> <span>0</span><span>;</span>
</span><span>    <span>}</span>
</span><span>    <span>get</span> <span>hasVideoInputOptions</span><span>()</span><span>:</span> <span>boolean</span> <span>{</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>devices</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>filter</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>kind</span> <span>===</span> <span>'videoinput'</span><span>).</span><span>length</span> <span>&gt;</span> <span>0</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'camera'</span><span>)</span> <span>camera</span>: <span>CameraComponent</span><span>;</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'videoSelect'</span><span>)</span> <span>video</span>: <span>DeviceSelectComponent</span><span>;</span>
</span><span>
</span><span>    <span>@Input</span><span>(</span><span>'isPreviewing'</span><span>)</span> <span>isPreviewing</span>: <span>boolean</span><span>;</span>
</span><span>    <span>@Output</span><span>()</span> <span>settingsChanged</span> <span>=</span> <span>new</span> <span>EventEmitter</span><span>&lt;</span><span>MediaDeviceInfo</span><span>&gt;</span><span>();</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span>
</span><span>        <span>private</span> <span>readonly</span> <span>deviceService</span>: <span>DeviceService</span><span>)</span> <span>{</span> <span>}</span>
</span><span>
</span><span>    <span>ngOnInit() {</span>
</span><span>        <span>this</span><span>.</span><span>subscription</span> <span>=</span>
</span><span>            <span>this</span><span>.</span><span>deviceService</span>
</span><span>                <span>.</span><span>$devicesUpdated</span>
</span><span>                <span>.</span><span>pipe</span><span>(</span><span>debounceTime</span><span>(</span><span>350</span><span>))</span>
</span><span>                <span>.</span><span>subscribe</span><span>(</span><span>async</span> <span>deviceListPromise</span> <span>=&gt;</span> <span>{</span>
</span><span>                    <span>this</span><span>.</span><span>devices</span> <span>=</span> <span>await</span> <span>deviceListPromise</span><span>;</span>
</span><span>                    <span>this</span><span>.</span><span>handleDeviceAvailabilityChanges</span><span>();</span>
</span><span>                <span>});</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>ngOnDestroy() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>subscription</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>subscription</span><span>.</span><span>unsubscribe</span><span>();</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>onSettingsChanged</span><span>(</span><span>deviceInfo</span>: <span>MediaDeviceInfo</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>isPreviewing</span><span>)</span> <span>{</span>
</span><span>            <span>await</span> <span>this</span><span>.</span><span>showPreviewCamera</span><span>();</span>
</span><span>        <span>}</span> <span>else</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>settingsChanged</span><span>.</span><span>emit</span><span>(</span><span>deviceInfo</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>showPreviewCamera() {</span>
</span><span>        <span>this</span><span>.</span><span>isPreviewing</span> <span>=</span> <span>true</span><span>;</span>
</span><span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>videoDeviceId</span> <span>!==</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>videoDeviceId</span> <span>=</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>;</span>
</span><span>            <span>const</span> <span>videoDevice</span> <span>=</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>find</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>deviceId</span> <span>===</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>);</span>
</span><span>            <span>await</span> <span>this</span><span>.</span><span>camera</span><span>.</span><span>initializePreview</span><span>(</span><span>videoDevice</span><span>);</span>
</span><span>        <span>}</span>
</span><span>        
</span><span>        <span>return</span> <span>this</span><span>.</span><span>camera</span><span>.</span><span>tracks</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>hidePreviewCamera() {</span>
</span><span>        <span>this</span><span>.</span><span>isPreviewing</span> <span>=</span> <span>false</span><span>;</span>
</span><span>        <span>this</span><span>.</span><span>camera</span><span>.</span><span>finalizePreview</span><span>();</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>find</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>deviceId</span> <span>===</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>handleDeviceAvailabilityChanges() {</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>devices</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>length</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>video</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>)</span> <span>{</span>
</span><span>            <span>let</span> <span>videoDevice</span> <span>=</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>find</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>deviceId</span> <span>===</span> <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span><span>);</span>
</span><span>            <span>if</span> <span>(</span><span>!</span><span>videoDevice</span><span>)</span> <span>{</span>
</span><span>                <span>videoDevice</span> <span>=</span> <span>this</span><span>.</span><span>devices</span><span>.</span><span>find</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>kind</span> <span>===</span> <span>'videoinput'</span><span>);</span>
</span><span>                <span>if</span> <span>(</span><span>videoDevice</span><span>)</span> <span>{</span>
</span><span>                    <span>this</span><span>.</span><span>video</span><span>.</span><span>selectedId</span> <span>=</span> <span>videoDevice</span><span>.</span><span>deviceId</span><span>;</span>
</span><span>                    <span>this</span><span>.</span><span>onSettingsChanged</span><span>(</span><span>videoDevice</span><span>);</span>
</span><span>                <span>}</span>
</span><span>            <span>}</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><p>The <code>SettingsComponent</code> object gets all the available devices and binds them to the <code>DeviceSelectComponent</code> objects that it parents. As video input device selections change the local camera component preview is updated to reflect those changes. The <code>deviceService.$devicesUpdated</code> observable fires as system level device availability changes. The list of available devices updates to accordingly.</p>
<p>To implement the user interface for settings, replace the contents of the <em>settings/settings.component.html</em>&nbsp;file with the following HTML markup:</p></div>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"jumbotron"</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>h4</span> <span>class</span><span>=</span><span>"display-4"</span><span>&gt;&lt;</span><span>i</span> <span>class</span><span>=</span><span>"fas fa-cogs"</span><span>&gt;&lt;/</span><span>i</span><span>&gt;</span> Settings<span>&lt;/</span><span>h4</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>form</span> <span>class</span><span>=</span><span>"form"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"form-group"</span> <span>*</span><span>ngIf</span><span>=</span><span>"hasAudioInputOptions"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>app-device-select</span> <span>[</span><span>kind</span><span>]="'</span><span>audioinput</span><span>'"</span>
</span><span>                               <span>[</span><span>label</span><span>]="'</span><span>Audio</span> <span>Input</span> <span>Source</span><span>'"</span> <span>[</span><span>devices</span><span>]="</span><span>devices</span><span>"</span>
</span><span>                               <span>(</span><span>settingsChanged</span><span>)="</span><span>onSettingsChanged</span><span>($</span><span>event</span><span>)"</span><span>&gt;&lt;/</span><span>app-device-select</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"form-group"</span> <span>*</span><span>ngIf</span><span>=</span><span>"hasAudioOutputOptions"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>app-device-select</span> <span>[</span><span>kind</span><span>]="'</span><span>audiooutput</span><span>'"</span>
</span><span>                               <span>[</span><span>label</span><span>]="'</span><span>Audio</span> <span>Output</span> <span>Source</span><span>'"</span> <span>[</span><span>devices</span><span>]="</span><span>devices</span><span>"</span>
</span><span>                               <span>(</span><span>settingsChanged</span><span>)="</span><span>onSettingsChanged</span><span>($</span><span>event</span><span>)"</span><span>&gt;&lt;/</span><span>app-device-select</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"form-group"</span> <span>*</span><span>ngIf</span><span>=</span><span>"hasVideoInputOptions"</span><span>&gt;</span>
</span><span>            <span>&lt;</span><span>app-device-select</span> <span>[</span><span>kind</span><span>]="'</span><span>videoinput</span><span>'"</span> <span>#</span><span>videoSelect</span>
</span><span>                               <span>[</span><span>label</span><span>]="'</span><span>Video</span> <span>Input</span> <span>Source</span><span>'"</span> <span>[</span><span>devices</span><span>]="</span><span>devices</span><span>"</span>
</span><span>                               <span>(</span><span>settingsChanged</span><span>)="</span><span>onSettingsChanged</span><span>($</span><span>event</span><span>)"</span><span>&gt;&lt;/</span><span>app-device-select</span><span>&gt;</span>
</span><span>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>form</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>[</span><span>style</span><span>.</span><span>display</span><span>]="</span><span>isPreviewing</span> <span>?</span> <span>'</span><span>block</span><span>'</span> <span>:</span> <span>'</span><span>none</span><span>'"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>app-camera</span> <span>#</span><span>camera</span><span>&gt;&lt;/</span><span>app-camera</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>div</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>If a media device option is not available to select, the <code>DeviceSelectComponent</code> object is not rendered. When an option is available, the user can configure their desired device.</p>
<p>As the user changes the selected device,&nbsp;the component emits an event to any active listeners, enabling them to take action on the currently selected device. The list of available devices is &nbsp;dynamically updated&nbsp;as devices are connected to, or removed from,&nbsp;the user’s computer.</p>
<p>The user also sees a preview of the selected video device, as shown below:</p>
<p><img alt="Selecting a video inpout source component" height="502" sizes="461px" src="https://twilio-cms-prod.s3.amazonaws.com/images/Uah1QRhyf-2RRUR3aCG-3DakJ_rFADgWmXt5JjP-X02LsQ.width-500.png" srcset="https://twilio-cms-prod.s3.amazonaws.com/images/Uah1QRhyf-2RRUR3aCG-3DakJ_rFADgWmXt5JjP-X02LsQ.width-500.png 461w, https://twilio-cms-prod.s3.amazonaws.com/images/Uah1QRhyf-2RRUR3aCG-3DakJ_rFADgWmXt5JjP-X02Ls.width-1000.png 461w" width="461"></p>
<p>To implement the settings user interface, replace the contents of the <em>settings/device-select.component.ts</em>&nbsp;file with the following TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>Component</span><span>,</span> <span>EventEmitter</span><span>,</span> <span>Input</span><span>,</span> <span>Output</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span>
</span><span><span>class</span> <span>IdGenerator</span> <span>{</span>
</span><span>    <span>protected</span> <span>static</span> <span>id</span>: <span>number</span> <span>=</span> <span>0</span><span>;</span>
</span><span>    <span>static</span> <span>getNext() {</span>
</span><span>        <span>return</span> <span>++</span> <span>IdGenerator</span><span>.</span><span>id</span><span>;</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-device-select'</span><span>,</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./device-select.component.html'</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>DeviceSelectComponent</span> <span>{</span>
</span><span>    <span>private</span> <span>localDevices</span>: <span>MediaDeviceInfo</span><span>[]</span> <span>=</span> <span>[];</span>
</span><span>
</span><span>    <span>id</span>: <span>string</span><span>;</span>
</span><span>    <span>selectedId</span>: <span>string</span><span>;</span>
</span><span>
</span><span>    <span>get</span> <span>devices</span><span>()</span><span>:</span> <span>MediaDeviceInfo</span><span>[]</span> <span>{</span>
</span><span>        <span>return</span> <span>this</span><span>.</span><span>localDevices</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>@Input</span><span>()</span> <span>label</span>: <span>string</span><span>;</span>
</span><span>    <span>@Input</span><span>()</span> <span>kind</span>: <span>MediaDeviceKind</span><span>;</span>
</span><span>    <span>@Input</span><span>()</span> <span>set</span> <span>devices</span><span>(</span><span>devices</span>: <span>MediaDeviceInfo</span><span>[])</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>selectedId</span> <span>=</span> <span>this</span><span>.</span><span>find</span><span>(</span><span>this</span><span>.</span><span>localDevices</span> <span>=</span> <span>devices</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>@Output</span><span>()</span> <span>settingsChanged</span> <span>=</span> <span>new</span> <span>EventEmitter</span><span>&lt;</span><span>MediaDeviceInfo</span><span>&gt;</span><span>();</span>
</span><span>
</span><span>    <span>constructor</span><span>()</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>id</span> <span>=</span> <span>`device-select-</span><span>${</span><span>IdGenerator</span><span>.</span><span>getNext</span><span>()</span><span>}</span><span>`</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onSettingsChanged</span><span>(</span><span>deviceId</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>setAndEmitSelections</span><span>(</span><span>this</span><span>.</span><span>selectedId</span> <span>=</span> <span>deviceId</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>find</span><span>(</span><span>devices</span>: <span>MediaDeviceInfo</span><span>[])</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>devices</span> <span>&amp;&amp;</span> <span>devices</span><span>.</span><span>length</span> <span>&gt;</span> <span>0</span><span>)</span> <span>{</span>
</span><span>            <span>return</span> <span>devices</span><span>[</span><span>0</span><span>].</span><span>deviceId</span><span>;</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>return</span> <span>null</span><span>;</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>setAndEmitSelections</span><span>(</span><span>deviceId</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>settingsChanged</span><span>.</span><span>emit</span><span>(</span><span>this</span><span>.</span><span>devices</span><span>.</span><span>find</span><span>(</span><span>d</span> <span>=&gt;</span> <span>d</span><span>.</span><span>deviceId</span> <span>===</span> <span>deviceId</span><span>));</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <p>Replace the contents of the <em>settings/device-select.component.html</em> file with the following HTML markup:</p>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>label</span> <span>for</span><span>=</span><span>"{{ id }}"</span> <span>class</span><span>=</span><span>"h5"</span><span>&gt;</span>{{ label }}<span>&lt;/</span><span>label</span><span>&gt;</span>
</span><span><span>&lt;</span><span>select</span> <span>class</span><span>=</span><span>"custom-select"</span> <span>id</span><span>=</span><span>"{{ id }}"</span>
</span><span>        <span>(</span><span>change</span><span>)="</span><span>onSettingsChanged</span><span>($</span><span>event</span><span>.</span><span>target</span><span>.</span><span>value</span><span>)"</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>option</span> <span>*</span><span>ngFor</span><span>=</span><span>"let device of devices"</span>
</span><span>            <span>[</span><span>value</span><span>]="</span><span>device</span><span>.</span><span>deviceId</span><span>"</span> <span>[</span><span>selected</span><span>]="</span><span>device</span><span>.</span><span>deviceId </span><span>=</span><span>==</span> <span>selectedId</span><span>"</span><span>&gt;</span>
</span><span>        {{ device.label }}
</span><span>    <span>&lt;/</span><span>option</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>select</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>The <code>DeviceSelectComponent</code> object is intended to encapsulate the selection of devices. Rather than bloating the settings component with redundancy, there is a single component that is reused and parameterized with <code>@Input</code> and <code>@Output</code> decorators.</p>
<h3>Implement the Home&nbsp;component</h3>
<p>The <code>HomeComponent</code>&nbsp;acts as the orchestration piece between the various components and is responsible for the layout&nbsp;of&nbsp;the app.</p>
<p>To implement the home user interface, replace the contents of the <em>home/home.component.ts</em>&nbsp;file with the following&nbsp;TypeScript code:</p></div>
    
      

<div>
    <div><pre><span><span>import</span> <span>{</span> <span>Component</span><span>,</span> <span>ViewChild</span><span>,</span> <span>OnInit</span> <span>}</span> <span>from</span> <span>'@angular/core'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>Room</span><span>,</span> <span>LocalTrack</span><span>,</span> <span>LocalVideoTrack</span><span>,</span> <span>LocalAudioTrack</span><span>,</span> <span>RemoteParticipant</span> <span>}</span> <span>from</span> <span>'twilio-video'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>RoomsComponent</span> <span>}</span> <span>from</span> <span>'../rooms/rooms.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>CameraComponent</span> <span>}</span> <span>from</span> <span>'../camera/camera.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>SettingsComponent</span> <span>}</span> <span>from</span> <span>'../settings/settings.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>ParticipantsComponent</span> <span>}</span> <span>from</span> <span>'../participants/participants.component'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>VideoChatService</span> <span>}</span> <span>from</span> <span>'../services/videochat.service'</span><span>;</span>
</span><span><span>import</span> <span>{</span> <span>HubConnection</span><span>,</span> <span>HubConnectionBuilder</span><span>,</span> <span>LogLevel</span> <span>}</span> <span>from</span> <span>'@aspnet/signalr'</span><span>;</span>
</span><span>
</span><span><span>@Component</span><span>({</span>
</span><span>    <span>selector</span><span>:</span> <span>'app-home'</span><span>,</span>
</span><span>    <span>styleUrls</span><span>:</span> <span>[</span><span>'./home.component.css'</span><span>],</span>
</span><span>    <span>templateUrl</span><span>:</span> <span>'./home.component.html'</span><span>,</span>
</span><span><span>})</span>
</span><span><span>export</span> <span>class</span> <span>HomeComponent</span> <span>implements</span> <span>OnInit</span> <span>{</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'rooms'</span><span>)</span> <span>rooms</span>: <span>RoomsComponent</span><span>;</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'camera'</span><span>)</span> <span>camera</span>: <span>CameraComponent</span><span>;</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'settings'</span><span>)</span> <span>settings</span>: <span>SettingsComponent</span><span>;</span>
</span><span>    <span>@ViewChild</span><span>(</span><span>'participants'</span><span>)</span> <span>participants</span>: <span>ParticipantsComponent</span><span>;</span>
</span><span>
</span><span>    <span>activeRoom</span>: <span>Room</span><span>;</span>
</span><span>
</span><span>    <span>private</span> <span>notificationHub</span>: <span>HubConnection</span><span>;</span>
</span><span>
</span><span>    <span>constructor</span><span>(</span>
</span><span>        <span>private</span> <span>readonly</span> <span>videoChatService</span>: <span>VideoChatService</span><span>)</span> <span>{</span> <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>ngOnInit() {</span>
</span><span>        <span>const</span> <span>builder</span> <span>=</span>
</span><span>            <span>new</span> <span>HubConnectionBuilder</span><span>()</span>
</span><span>                <span>.</span><span>configureLogging</span><span>(</span><span>LogLevel</span><span>.</span><span>Information</span><span>)</span>
</span><span>                <span>.</span><span>withUrl</span><span>(</span><span>`</span><span>${</span><span>location</span><span>.</span><span>origin</span><span>}</span><span>/notificationHub`</span><span>);</span>
</span><span>
</span><span>        <span>this</span><span>.</span><span>notificationHub</span> <span>=</span> <span>builder</span><span>.</span><span>build</span><span>();</span>
</span><span>        <span>this</span><span>.</span><span>notificationHub</span><span>.</span><span>on</span><span>(</span><span>'RoomsUpdated'</span><span>,</span> <span>async</span> <span>updated</span> <span>=&gt;</span> <span>{</span>
</span><span>            <span>if</span> <span>(</span><span>updated</span><span>)</span> <span>{</span>
</span><span>                <span>await</span> <span>this</span><span>.</span><span>rooms</span><span>.</span><span>updateRooms</span><span>();</span>
</span><span>            <span>}</span>
</span><span>        <span>});</span>
</span><span>        <span>await</span> <span>this</span><span>.</span><span>notificationHub</span><span>.</span><span>start</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>onSettingsChanged</span><span>(</span><span>deviceInfo</span>: <span>MediaDeviceInfo</span><span>)</span> <span>{</span>
</span><span>        <span>await</span> <span>this</span><span>.</span><span>camera</span><span>.</span><span>initializePreview</span><span>(</span><span>deviceInfo</span><span>);</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>onLeaveRoom</span><span>(</span><span>_</span>: <span>boolean</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>activeRoom</span><span>)</span> <span>{</span>
</span><span>            <span>this</span><span>.</span><span>activeRoom</span><span>.</span><span>disconnect</span><span>();</span>
</span><span>            <span>this</span><span>.</span><span>activeRoom</span> <span>=</span> <span>null</span><span>;</span>
</span><span>        <span>}</span>
</span><span>
</span><span>        <span>this</span><span>.</span><span>camera</span><span>.</span><span>finalizePreview</span><span>();</span>
</span><span>        <span>const</span> <span>videoDevice</span> <span>=</span> <span>this</span><span>.</span><span>settings</span><span>.</span><span>hidePreviewCamera</span><span>();</span>
</span><span>        <span>this</span><span>.</span><span>camera</span><span>.</span><span>initializePreview</span><span>(</span><span>videoDevice</span><span>);</span>
</span><span>
</span><span>        <span>this</span><span>.</span><span>participants</span><span>.</span><span>clear</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>async</span> <span>onRoomChanged</span><span>(</span><span>roomName</span>: <span>string</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>roomName</span><span>)</span> <span>{</span>
</span><span>            <span>if</span> <span>(</span><span>this</span><span>.</span><span>activeRoom</span><span>)</span> <span>{</span>
</span><span>                <span>this</span><span>.</span><span>activeRoom</span><span>.</span><span>disconnect</span><span>();</span>
</span><span>            <span>}</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>camera</span><span>.</span><span>finalizePreview</span><span>();</span>
</span><span>            <span>const</span> <span>tracks</span> <span>=</span> <span>await</span> <span>this</span><span>.</span><span>settings</span><span>.</span><span>showPreviewCamera</span><span>();</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>activeRoom</span> <span>=</span>
</span><span>                <span>await</span> <span>this</span><span>.</span><span>videoChatService</span>
</span><span>                          <span>.</span><span>joinOrCreateRoom</span><span>(</span><span>roomName</span><span>,</span> <span>tracks</span><span>);</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>participants</span><span>.</span><span>initialize</span><span>(</span><span>this</span><span>.</span><span>activeRoom</span><span>.</span><span>participants</span><span>);</span>
</span><span>            <span>this</span><span>.</span><span>registerRoomEvents</span><span>();</span>
</span><span>
</span><span>            <span>this</span><span>.</span><span>notificationHub</span><span>.</span><span>send</span><span>(</span><span>'RoomsUpdated'</span><span>,</span> <span>true</span><span>);</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>onParticipantsChanged</span><span>(</span><span>_</span>: <span>boolean</span><span>)</span> <span>{</span>
</span><span>        <span>this</span><span>.</span><span>videoChatService</span><span>.</span><span>nudge</span><span>();</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>registerRoomEvents() {</span>
</span><span>        <span>this</span><span>.</span><span>activeRoom</span>
</span><span>            <span>.</span><span>on</span><span>(</span><span>'disconnected'</span><span>,</span>
</span><span>                <span>(</span><span>room</span>: <span>Room</span><span>)</span> <span>=&gt;</span> <span>room</span><span>.</span><span>localParticipant</span><span>.</span><span>tracks</span><span>.</span><span>forEach</span><span>(</span><span>publication</span> <span>=&gt;</span> <span>this</span><span>.</span><span>detachLocalTrack</span><span>(</span><span>publication</span><span>.</span><span>track</span><span>)))</span>
</span><span>            <span>.</span><span>on</span><span>(</span><span>'participantConnected'</span><span>,</span>
</span><span>                <span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span><span>participants</span><span>.</span><span>add</span><span>(</span><span>participant</span><span>))</span>
</span><span>            <span>.</span><span>on</span><span>(</span><span>'participantDisconnected'</span><span>,</span>
</span><span>                <span>(</span><span>participant</span>: <span>RemoteParticipant</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span><span>participants</span><span>.</span><span>remove</span><span>(</span><span>participant</span><span>))</span>
</span><span>            <span>.</span><span>on</span><span>(</span><span>'dominantSpeakerChanged'</span><span>,</span>
</span><span>                <span>(</span><span>dominantSpeaker</span>: <span>RemoteParticipant</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span><span>participants</span><span>.</span><span>loudest</span><span>(</span><span>dominantSpeaker</span><span>));</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>detachLocalTrack</span><span>(</span><span>track</span>: <span>LocalTrack</span><span>)</span> <span>{</span>
</span><span>        <span>if</span> <span>(</span><span>this</span><span>.</span><span>isDetachable</span><span>(</span><span>track</span><span>))</span> <span>{</span>
</span><span>            <span>track</span><span>.</span><span>detach</span><span>().</span><span>forEach</span><span>(</span><span>el</span> <span>=&gt;</span> <span>el</span><span>.</span><span>remove</span><span>());</span>
</span><span>        <span>}</span>
</span><span>    <span>}</span>
</span><span>
</span><span>    <span>private</span> <span>isDetachable</span><span>(</span><span>track</span>: <span>LocalTrack</span><span>)</span><span>:</span> <span>track</span> <span>is</span> <span>LocalAudioTrack</span> <span>|</span> <span>LocalVideoTrack</span> <span>{</span>
</span><span>        <span>return</span> <span>!!</span><span>track</span>
</span><span>            <span>&amp;&amp;</span> <span>((</span><span>track</span> <span>as</span> <span>LocalAudioTrack</span><span>).</span><span>detach</span> <span>!==</span> <span>undefined</span>
</span><span>            <span>||</span> <span>(</span><span>track</span> <span>as</span> <span>LocalVideoTrack</span><span>).</span><span>detach</span> <span>!==</span> <span>undefined</span><span>);</span>
</span><span>    <span>}</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <p>To implement the home user interface, replace the contents of the <em>home/home.component.html</em>&nbsp;file with the following HTML markup:</p>
    
      

<div>
    <div><pre><span><span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-container"</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-bottom-right"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>a</span> <span>href</span><span>=</span><span>"https://twitter.com/davidpine7"</span> <span>target</span><span>=</span><span>"_blank"</span><span>&gt;&lt;</span><span>i</span> <span>class</span><span>=</span><span>"fab fa-twitter"</span><span>&gt;&lt;/</span><span>i</span><span>&gt;</span> @davidpine7<span>&lt;/</span><span>a</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-left"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>app-rooms</span> <span>#</span><span>rooms</span> <span>(</span><span>roomChanged</span><span>)="</span><span>onRoomChanged</span><span>($</span><span>event</span><span>)"</span>
</span><span>                   <span>[</span><span>activeRoomName</span><span>]="!!</span><span>activeRoom</span> <span>?</span> <span>activeRoom</span><span>.</span><span>name</span> <span>:</span> <span>null</span><span>"</span><span>&gt;&lt;/</span><span>app-rooms</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-content"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>app-camera</span> <span>#</span><span>camera</span> <span>[</span><span>style</span><span>.</span><span>display</span><span>]="!!</span><span>activeRoom</span> <span>?</span> <span>'</span><span>none</span><span>'</span> <span>:</span> <span>'</span><span>block</span><span>'"</span><span>&gt;&lt;/</span><span>app-camera</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>app-participants</span> <span>#</span><span>participants</span>
</span><span>                          <span>(</span><span>leaveRoom</span><span>)="</span><span>onLeaveRoom</span><span>($</span><span>event</span><span>)"</span>
</span><span>                          <span>(</span><span>participantsChanged</span><span>)="</span><span>onParticipantsChanged</span><span>($</span><span>event</span><span>)"</span>
</span><span>                          <span>[</span><span>style</span><span>.</span><span>display</span><span>]="!!</span><span>activeRoom</span> <span>?</span> <span>'</span><span>block</span><span>'</span> <span>:</span> <span>'</span><span>none</span><span>'"</span>
</span><span>                          <span>[</span><span>activeRoomName</span><span>]="!!</span><span>activeRoom</span> <span>?</span> <span>activeRoom</span><span>.</span><span>name</span> <span>:</span> <span>null</span><span>"</span><span>&gt;&lt;/</span><span>app-participants</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-right"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>app-settings</span> <span>#</span><span>settings</span> <span>(</span><span>settingsChanged</span><span>)="</span><span>onSettingsChanged</span><span>($</span><span>event</span><span>)"</span><span>&gt;&lt;/</span><span>app-settings</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span>    <span>&lt;</span><span>div</span> <span>class</span><span>=</span><span>"grid-top-left"</span><span>&gt;</span>
</span><span>        <span>&lt;</span><span>a</span> <span>href</span><span>=</span><span>"https://www.twilio.com/video"</span> <span>target</span><span>=</span><span>"_blank"</span><span>&gt;</span>
</span><span>            Powered by Twilio
</span><span>        <span>&lt;/</span><span>a</span><span>&gt;</span>
</span><span>    <span>&lt;/</span><span>div</span><span>&gt;</span>
</span><span><span>&lt;/</span><span>div</span><span>&gt;</span>
</span></pre></div>
</div>

    
      <div><p>The home component provides&nbsp;the layout for the client user interface, so it needs some styling to arrange and format the UI elements.</p>
<p>Replace the contents of&nbsp;the <em>home/home.component.css</em>&nbsp;file&nbsp;with the following CSS code:</p></div>
    
      

<div>
    <div><pre><span><span>.</span><span>grid-container</span> <span>{</span>
</span><span>  <span>display</span><span>:</span> <span>grid</span><span>;</span>
</span><span>  <span>height</span><span>:</span> <span>100</span><span>vh</span><span>;</span>
</span><span>  <span>grid-template-columns</span><span>:</span> <span>2</span><span>fr</span> <span>4</span><span>fr</span> <span>2</span><span>fr</span><span>;</span>
</span><span>  <span>grid-template-rows</span><span>:</span> <span>1</span><span>fr</span> <span>7</span><span>fr</span> <span>1</span><span>fr</span><span>;</span>
</span><span>  <span>grid-template-areas</span><span>:</span> <span>"top-left . top-right"</span> <span>"left content right"</span> <span>"bottom-left . bottom-right"</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>.</span><span>grid-content</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>content</span><span>;</span>
</span><span>  <span>display</span><span>:</span> <span>flex</span><span>;</span>
</span><span>  <span>justify-content</span><span>:</span> <span>center</span><span>;</span>
</span><span>  <span>align-items</span><span>:</span> <span>center</span><span>;</span>
</span><span>  <span>background-color</span><span>:</span> <span>rgb</span><span>(</span><span>56</span><span>,</span> <span>56</span><span>,</span> <span>56</span><span>);</span>
</span><span>  <span>border-top</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span>  <span>border-bottom</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>.</span><span>grid-left</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>left</span><span>;</span>
</span><span>  <span>background</span><span>:</span> <span>linear-gradient</span><span>(</span><span>to</span> <span>left</span><span>,</span> <span>rgb</span><span>(</span><span>56</span><span>,</span> <span>56</span><span>,</span> <span>56</span><span>)</span> <span>0</span><span>,</span> <span>transparent</span> <span>100</span><span>%</span><span>);</span>
</span><span>  <span>border-top</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span>  <span>border-bottom</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>.</span><span>grid-right</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>right</span><span>;</span>
</span><span>  <span>background</span><span>:</span> <span>linear-gradient</span><span>(</span><span>to</span> <span>right</span><span>,</span> <span>rgb</span><span>(</span><span>56</span><span>,</span> <span>56</span><span>,</span> <span>56</span><span>)</span> <span>0</span><span>,</span> <span>transparent</span> <span>100</span><span>%</span><span>);</span>
</span><span>  <span>border-top</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span>  <span>border-bottom</span><span>:</span> <span>solid</span> <span>6</span><span>px</span> <span>#F22F46</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>.</span><span>grid-top-left</span><span>,</span>
</span><span><span>.</span><span>grid-top-right</span><span>,</span>
</span><span><span>.</span><span>grid-bottom-left</span><span>,</span>
</span><span><span>.</span><span>grid-bottom-right</span> <span>{</span>
</span><span>  <span>display</span><span>:</span> <span>flex</span><span>;</span>
</span><span>  <span>justify-content</span><span>:</span> <span>center</span><span>;</span>
</span><span>  <span>align-items</span><span>:</span> <span>center</span><span>;</span>
</span><span><span>}</span>
</span><span>
</span><span><span>.</span><span>grid-top-left</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>top</span><span>-</span><span>left</span><span>;</span>
</span><span><span>}</span>
</span><span><span>.</span><span>grid-top-right</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>top</span><span>-</span><span>right</span><span>;</span>
</span><span><span>}</span>
</span><span><span>.</span><span>grid-bottom-left</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>bottom</span><span>-</span><span>left</span><span>;</span>
</span><span><span>}</span>
</span><span><span>.</span><span>grid-bottom-right</span> <span>{</span>
</span><span>  <span>grid-area</span><span>:</span> <span>bottom</span><span>-</span><span>right</span><span>;</span>
</span><span><span>}</span>
</span></pre></div>
</div>

    
      <div><h2>Understand video chat events</h2>
<p>The Angular client app uses a number of resources in the Twilio Programmable Video SDK. The following is a comprehensive list of each event associated with an SDK resource:</p>
<table>
<tbody>
<tr>
<td colspan="1">
<p><strong>Event Registration</strong></p>
</td>
<td colspan="1">
<p><strong>Description</strong></p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>room.on('disconnected', room =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a user leaves the room</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>room.on('participantConnected', participant =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a new participant joins the room</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>room.on('participantDisconnected', participant =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a participant leaves the room</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>participant.on('trackPublished', publication =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a track publication is published</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>participant.on('trackUnpublished', publication =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a track publication is unpublished</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>publication.on('subscribed', track =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a track is subscribed</p>
</td>
</tr>
<tr>
<td colspan="1">
<p><code>publication.on('unsubscribed', track =&gt; { });</code></p>
</td>
<td colspan="1">
<p>Occurs when a track is unsubscribed</p>
</td>
</tr>
</tbody>
</table>
<h2>Putting it all together</h2>
<p>Phew, this was quite the project! Time to try it out.</p>
<p>Run the application. If you’re running the application in Visual Studio 2017 using IIS Express, the user interface will appear at a randomly assigned port. If you run it another way, navigate to: https://localhost:5001.</p>
<p>After the application loads your browser will prompt you to allow camera access: grant it.</p>
<p>If you have two video sources&nbsp;on your computer, open two different browsers&nbsp;(or an incognito window) and select different devices on each browser. Settings enable you to choose the preferred video input source. In one browser, create a room and then join it in the other browser.</p>
<p>When a room is created the local preview is moved just under the settings so that remote room participants join their video stream will render in the larger viewing area.</p>
<p><em>If you don’t have two video sources on your computer,</em>&nbsp;watch for a forthcoming post that will teach you how to deploy this application on Microsoft Azure. When you’ve deployed the app to the cloud you can have multiple users join video chat rooms.</p>
<h2>Summary of building a video chat app with ASP.NET Core, Angular, and Twilio</h2>
<p>This post showed you how to build a fully functioning video chat application with Angular, ASP.NET Core, SignalR, and Twilio Programmable Video. The Twilio .NET SDK provides JWTs to client-side Angular code as well as getting room details via the ASP.NET Core Web API. The client-side Angular SPA integrates the Twilio JavaScript SDK.</p>
<h2>Additional resources</h2>
<p>A working example of the application is available on the author’s Azure domain: <a href="https://ievangelist-videochat.azurewebsites.net/">https://ievangelist-videochat.azurewebsites.net/</a></p>
<p>The <a href="https://github.com/IEvangelist/IEvangelist.VideoChat">companion repository</a>&nbsp;on GitHub includes better styling, persistent selections, and other features you may want to include in your production app.</p>
<p>You can learn more about the technologies used in this post from the following sources:</p>
<ul>
<li>Angular Observables and Promises: <a href="https://angular.io/guide/observables">Observables</a>&nbsp;on <a href="https://angular.io/">angular.io</a>, <a href="https://medium.com/@luukgruijs/understanding-creating-and-subscribing-to-observables-in-angular-426dbf0b04a3">Understanding, creating and subscribing to observables in Angular</a>&nbsp;and<a href="https://dwmkerr.com/promises-in-angularjs-the-definitive-guide/">&nbsp;AngularJS Promises – The Definitive Guide</a>&nbsp;on Medium</li>
<li>C# local functions: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/local-functions">Local functions (C# Programming Guide)</a>&nbsp;on docs.microsoft.com</li>
<li>SignalR: <a href="https://www.asp.net/signalr">Learn About ASP.NET SignalR</a>&nbsp;on ASP.NET</li>
<li><a href="https://www.twilio.com/docs/video">Twilio Programmable Video</a>&nbsp;on Twilio Docs</li>
</ul>
<p><em>David Pine is a </em><em>Microsoft MVP</em><em>, </em><em>Google Developer Expert</em><em>, technical evangelist, and </em><em>international speaker</em><em>. You can follow him on Twitter at </em><em>@davidpine7</em><em>.</em><em>&nbsp;Be sure to checkout his blog at </em><em><a href="https://davidpine.net/">https://davidpine.net</a></em><em>.</em></p></div>
    

    

    


    
      




    
  </section>
</article>


    
    

        
          </ul>
        
      </section>
    </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>