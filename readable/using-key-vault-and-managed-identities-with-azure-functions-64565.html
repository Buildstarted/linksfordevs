<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Using Key Vault and Managed Identities with Azure Functions - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Using Key Vault and Managed Identities with Azure Functions - linksfor.dev(s)"/>
    <meta property="article:author" content="damienbod"/>
    <meta property="og:description" content="This article shows how Azure Key Vault could be used together with Azure Functions. The Azure Functions can use the system assigned identity to access the Key Vault. This needs to be configured in &#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Using Key Vault and Managed Identities with Azure Functions</title>
<div class="readable">
        <h1>Using Key Vault and Managed Identities with Azure Functions</h1>
            <div>by damienbod</div>
            <div>Reading time: 6-8 minutes</div>
        <div>Posted here: 21 Jul 2020</div>
        <p><a href="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/">https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

							<p>This article shows how Azure Key Vault could be used together with Azure Functions. The Azure Functions can use the system assigned identity to access the Key Vault. This needs to be configured in the Key Vault access policies using the service principal. By using the <strong>Microsoft.Azure.KeyVault</strong> and the <strong>Microsoft.Extensions.Configuration.AzureKeyVault</strong> nuget packages, defining direct references in the Azure Functions configuration is not required. The secrets can be read directly from the Key Vault. This also has the advantage of referencing only the secret and not the direct version of the secret. The latest version of the secret is used (depending on the cache)</p>
<p><strong>Code:</strong> <a href="https://github.com/damienbod/AzureDurableFunctions" rel="nofollow">https://github.com/damienbod/AzureDurableFunctions</a></p>
<p>Posts in this series</p>
<ul>
<li><a href="https://damienbod.com/2020/07/06/using-external-inputs-in-azure-durable-functions/">Using External Inputs in Azure Durable functions</a></li>
<li><a href="https://damienbod.com/2020/07/12/azure-functions-configuration-and-secrets-management/">Azure Functions Configuration and Secrets Management</a></li>
<li>Using Key Vault and Managed Identities with Azure Functions</li>
</ul>
<p>The configuration is setup in the Startup  class which inherits from the FunctionsStartup class. We use a string property <strong>AzureKeyVaultEndpoint</strong> which is used to decide if the Key Vault configuration should be used or not. For local development, Key Vault is not used, user secrets are used. For the Azure deployment, the <strong>AzureKeyVaultEndpoint</strong> is set with the value of your Key Vault. The configuration is read into the application and added as options to the DI.</p>
<div><div id="highlighter_88239"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p></td><td><div><p><code>using</code> <code>Microsoft.Azure.Functions.Extensions.DependencyInjection;</code></p><p><code>using</code> <code>Microsoft.Azure.KeyVault;</code></p><p><code>using</code> <code>Microsoft.Azure.Services.AppAuthentication;</code></p><p><code>using</code> <code>Microsoft.Extensions.Configuration;</code></p><p><code>using</code> <code>Microsoft.Extensions.DependencyInjection;</code></p><p><code>using</code> <code>MyAzureFunctions;</code></p><p><code>using</code> <code>MyAzureFunctions.Activities;</code></p><p><code>using</code> <code>System;</code></p><p><code>using</code> <code>System.Reflection;</code></p><p><code>[assembly: FunctionsStartup(</code><code>typeof</code><code>(Startup))]</code></p><p><code>namespace</code> <code>MyAzureFunctions</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>Startup : FunctionsStartup</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>override</code> <code>void</code> <code>Configure(IFunctionsHostBuilder builder)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>keyVaultEndpoint = Environment.GetEnvironmentVariable(</code><code>"AzureKeyVaultEndpoint"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(!</code><code>string</code><code>.IsNullOrEmpty(keyVaultEndpoint))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>azureServiceTokenProvider = </code><code>new</code> <code>AzureServiceTokenProvider();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>keyVaultClient = </code><code>new</code> <code>KeyVaultClient(</code><code>new</code> <code>KeyVaultClient.AuthenticationCallback(azureServiceTokenProvider.KeyVaultTokenCallback));</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>config = </code><code>new</code> <code>ConfigurationBuilder()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddAzureKeyVault(keyVaultEndpoint)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.SetBasePath(Environment.CurrentDirectory)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddJsonFile(</code><code>"local.settings.json"</code><code>, </code><code>true</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddEnvironmentVariables()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Build();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.Services.AddSingleton&lt;IConfiguration&gt;(config);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>else</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>config = </code><code>new</code> <code>ConfigurationBuilder()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.SetBasePath(Environment.CurrentDirectory)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddJsonFile(</code><code>"local.settings.json"</code><code>, </code><code>true</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddUserSecrets(Assembly.GetExecutingAssembly(), </code><code>true</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.AddEnvironmentVariables()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Build();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.Services.AddSingleton&lt;IConfiguration&gt;(config);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.Services.AddScoped&lt;MyActivities&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.Services.AddOptions&lt;MyConfiguration&gt;()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Configure&lt;IConfiguration&gt;((settings, configuration) =&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>configuration.GetSection(</code><code>"MyConfiguration"</code><code>).Bind(settings);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>});</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.Services.AddOptions&lt;MyConfigurationSecrets&gt;()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Configure&lt;IConfiguration&gt;((settings, configuration) =&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>configuration.GetSection(</code><code>"MyConfigurationSecrets"</code><code>).Bind(settings);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>});</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>The local.settings.json contains the configurations for the Azure Functions. (No secrets). The AzureKeyVaultEndpoint has no value. If this was set with the URL of a Key Vault, this would activate the Key Vault for local development.</p>
<div><div id="highlighter_126562"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p></td><td><div><p><code>{</code></p><p><code>&nbsp;&nbsp;</code><code>"IsEncrypted"</code><code>: </code><code>false</code><code>,</code></p><p><code>&nbsp;&nbsp;</code><code>"Values"</code><code>: {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"AzureWebJobsStorage"</code><code>: </code><code>"UseDevelopmentStorage=true"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"AzureWebJobsSecretStorageType"</code><code>: </code><code>"Files"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"FUNCTIONS_WORKER_RUNTIME"</code><code>: </code><code>"dotnet"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"AzureKeyVaultEndpoint"</code><code>: </code><code>""</code></p><p><code>&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;</code><code>"MyConfiguration"</code><code>: {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"Name"</code><code>: </code><code>"Lilly"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"AmountOfRetries"</code><code>: 7</code></p><p><code>&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>The MyConfigurationSecrets class is used to hold the secret configurations.</p>
<div><div id="highlighter_330315"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p></td><td><div><p><code>namespace</code> <code>MyAzureFunctions</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>MyConfigurationSecrets</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>MySecretOne { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>MySecretTwo { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>The configuration can be used then like any ASP.NET Core application. The services are added in the constructor and can be used as required.</p>
<div><div id="highlighter_306624"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p></td><td><div><p><code>using</code> <code>Microsoft.Azure.WebJobs;</code></p><p><code>using</code> <code>Microsoft.Azure.WebJobs.Extensions.DurableTask;</code></p><p><code>using</code> <code>Microsoft.Extensions.Logging;</code></p><p><code>using</code> <code>Microsoft.Extensions.Options;</code></p><p><code>namespace</code> <code>MyAzureFunctions.Activities</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>MyActivities</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>readonly</code> <code>MyConfiguration _myConfiguration;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>readonly</code> <code>MyConfigurationSecrets _myConfigurationSecrets;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>MyActivities(IOptions&lt;MyConfiguration&gt; myConfiguration, </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>IOptions&lt;MyConfigurationSecrets&gt; myConfigurationSecrets)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_myConfiguration = myConfiguration.Value;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_myConfigurationSecrets = myConfigurationSecrets.Value;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>When deploying, the Azure Functions needs access to the Key Vault. The Azure Functions requires a system assigned Identity. You can activate this, or check that it is created in the Azure portal.</p>
<p><img data-attachment-id="14066" data-permalink="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/kv_durable_azure_01/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png" data-orig-size="1185,1010" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="kv_durable_azure_01" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=640&amp;h=545" alt="" width="640" height="545" srcset="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=640&amp;h=545 640w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=150&amp;h=128 150w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=600&amp;h=511 600w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=768&amp;h=655 768w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png?w=1024&amp;h=873 1024w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_01.png 1185w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>In the Azure Key Vault add a new Access policy.</p>
<p><img data-attachment-id="14067" data-permalink="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/kv_durable_azure_02/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png" data-orig-size="1180,845" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="kv_durable_azure_02" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=640&amp;h=458" alt="" width="640" height="458" srcset="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=640&amp;h=458 640w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=150&amp;h=107 150w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=600&amp;h=430 600w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=768&amp;h=550 768w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png?w=1024&amp;h=733 1024w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_02.png 1180w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>Search for the required system Identity, ie your Azure Functions, and add the required permissions as your app needs. </p>
<p><img data-attachment-id="14068" data-permalink="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/kv_durable_azure_03/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png" data-orig-size="1170,1023" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="kv_durable_azure_03" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=640&amp;h=560" alt="" width="640" height="560" srcset="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=640&amp;h=560 640w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=150&amp;h=131 150w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=600&amp;h=525 600w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=768&amp;h=672 768w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png?w=1024&amp;h=895 1024w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_03.png 1170w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>The secret configurations are no longer required in the App.Settings of the Azure Functions.</p>
<p><img data-attachment-id="14072" data-permalink="https://damienbod.com/2020/07/20/using-key-vault-and-managed-identities-with-azure-functions/kv_durable_azure_04/" data-orig-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png" data-orig-size="1719,1145" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="kv_durable_azure_04" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=640" src="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=640&amp;h=426" alt="" width="640" height="426" srcset="https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=640&amp;h=426 640w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=1280&amp;h=852 1280w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=150&amp;h=100 150w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=600&amp;h=400 600w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=768&amp;h=512 768w, https://damienbod.files.wordpress.com/2020/07/kv_durable_azure_04.png?w=1024&amp;h=682 1024w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>When the functions are called, the actual version is used depending on the cache. </p>
<p><strong>Links:</strong></p>
<p><a href="https://damienbod.com/2018/12/23/using-azure-key-vault-with-asp-net-core-and-azure-app-services/" rel="nofollow">https://damienbod.com/2018/12/23/using-azure-key-vault-with-asp-net-core-and-azure-app-services/</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings" rel="nofollow">https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/" rel="nofollow">https://docs.microsoft.com/en-us/azure/azure-functions/durable/</a></p>
<p><a href="https://github.com/Azure/azure-functions-durable-extension" rel="nofollow">https://github.com/Azure/azure-functions-durable-extension</a></p>
<p><a href="https://damienbod.com/2019/03/14/running-local-azure-functions-in-visual-studio-with-https/" rel="nofollow">https://damienbod.com/2019/03/14/running-local-azure-functions-in-visual-studio-with-https/</a></p>
<p><a href="https://azure.microsoft.com/en-us/features/storage-explorer/">Microsoft Azure Storage Explorer</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-emulator">Microsoft Azure Storage Emulator</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local">Install the Azure Functions Core Tools</a></p>
<p><a href="https://nodejs.org/en/">NodeJS</a></p>
<p><a href="https://docs.microsoft.com/en-us/cli/azure/">Azure CLI</a></p>
<p><a href="https://azure.microsoft.com/en-us/downloads/">Azure SDK</a></p>
<p><a href="http://install%20the%20azure%20development%20extensions/">Visual Studio zure development extensions</a></p>

							
							
						</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>