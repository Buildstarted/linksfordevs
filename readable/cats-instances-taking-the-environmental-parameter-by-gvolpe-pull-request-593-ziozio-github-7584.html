<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Cats instances taking the environmental parameter by gvolpe &#xB7; Pull Request #593 &#xB7; zio/zio - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Cats instances taking the environmental parameter by gvolpe &#xB7; Pull Request #593 &#xB7; zio/zio - linksfor.dev(s)"/>
    <meta property="article:author" content="jdegoes"/>
    <meta property="og:description" content="Now that ZIO became a trifunctor, interop instances should also take into account the environmental parameter R as well. Here&amp;#39;s the summary of changes:&#xA;&#xA;A new type alias type TaskR[-R, &#x2B;A] = ZI..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/scalaz/scalaz-zio/pull/593"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Cats instances taking the environmental parameter by gvolpe &#xB7; Pull Request #593 &#xB7; zio/zio</title>
<div class="readable">
        <h1>Cats instances taking the environmental parameter by gvolpe &#xB7; Pull Request #593 &#xB7; zio/zio</h1>
            <div>by jdegoes</div>
            <div>Reading time: 12-15 minutes</div>
        <div>Posted here: 06 Mar 2019</div>
        <p><a href="https://github.com/scalaz/scalaz-zio/pull/593">https://github.com/scalaz/scalaz-zio/pull/593</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
  
      
  
<div>
  <table id="discussion-diff-262369161">
    


    <tbody><tr>

        <td id="discussion-diff-262369161L122" data-line-number="122"></td>

        <td></td>

      <td>
        <span>        <span>val</span> <span>v1</span>  <span>=</span> unsafeRunSync(io1.timeout(<span>20</span>.seconds)).map(_.get)</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-262369161L123" data-line-number="123"></td>

        <td></td>

      <td>
        <span>        <span>val</span> <span>v2</span>  <span>=</span> unsafeRunSync(io2.timeout(<span>20</span>.seconds)).map(_.get)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-262369161R142" data-line-number="142"></td>

      <td>
        <span>      <span>def</span> <span>eqv</span>(<span>io1</span>: <span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>], <span>io2</span>: <span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>])<span>:</span> <span>Boolean</span> <span>=</span> {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-262369161R143" data-line-number="143"></td>

      <td>
        <span>        <span>val</span> <span>v1</span>  <span>=</span> unsafeRunSync(io1.<span>asInstanceOf</span>[<span>IO</span>[<span>E</span>, <span>A</span>]].timeout(<span>20</span>.seconds)).map(_.get)</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r262369161" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjM2OTE2MQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjM2OTE2MQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="24b44772034f4a2d3eb4284d116ed649">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="24b44772034f4a2d3eb4284d116ed649" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r262369161">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r262369161-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes"><img height="28" width="28" alt="@jdegoes" src="https://avatars1.githubusercontent.com/u/156745?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>

        

<div id="discussion_r262386089" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjM4NjA4OQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjM4NjA4OQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="4cb941392a046525b8931e0d193263fe">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="4cb941392a046525b8931e0d193263fe" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r262386089">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r262386089-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe"><img height="28" width="28" alt="@gvolpe" src="https://avatars0.githubusercontent.com/u/443978?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe">gvolpe</a>
  

          </strong>
          <span>

              <a href="#discussion_r262386089" id="discussion_r262386089-permalink">
                <relative-time datetime="2019-03-05T08:15:22Z" title="Mar 5, 2019, 12:15 AM PST">on Mar 5, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span>

        
    <span aria-label="This user has previously committed to the zio repository.">
      Contributor
    </span></p><task-lists disabled="" sortable="">
          <p>How do I get the R in this case? By creating an <code>Arbitrary</code> for <code>R</code>?</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r262919475" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjkxOTQ3NQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MjkxOTQ3NQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="c9e2fbfeb6b6273ebac8d4fa3cc97997">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="c9e2fbfeb6b6273ebac8d4fa3cc97997" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r262919475">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r262919475-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes"><img height="28" width="28" alt="@jdegoes" src="https://avatars1.githubusercontent.com/u/156745?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes">jdegoes</a>
  

          </strong>
          <span>

              <a href="#discussion_r262919475" id="discussion_r262919475-permalink">
                <relative-time datetime="2019-03-06T12:29:15Z" title="Mar 6, 2019, 4:29 AM PST">on Mar 6, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the ZIO organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>You need an implicit runtime. Or you can provide equality for <code>IO[E, A]</code> or even <code>Task[A]</code> if the tests will permit it. I don't think the tests use anything except for <code>Task</code>.</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263221227" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzIyMTIyNw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzIyMTIyNw==/comments/review_comment">
    <div>
      

  

<details data-body-version="c7bf83ae5a30c53f8413f8c111d31226">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="c7bf83ae5a30c53f8413f8c111d31226" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263221227">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263221227-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe"><img height="28" width="28" alt="@gvolpe" src="https://avatars0.githubusercontent.com/u/443978?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe">gvolpe</a>
  

          </strong>
          <span>

              <a href="#discussion_r263221227" id="discussion_r263221227-permalink">
                <relative-time datetime="2019-03-07T02:57:21Z" title="Mar 6, 2019, 6:57 PM PST">on Mar 6, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span>

        
    <span aria-label="This user has previously committed to the zio repository.">
      Contributor
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p><a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes">@jdegoes</a> as I mentioned on Gitter I'm still lost with this part. Adding an <code>implicit rts: Runtime[R]</code> constraint to derive the <code>Eq</code> instances makes sense but the issue is where to get this instance from? If you look at how the spec class is defined maybe you'll see the problem?</p>
<div><pre><span>class</span> <span>catzSpec</span>
    <span>extends</span> <span>FunSuite</span>
    <span>with</span> <span>BeforeAndAfterAll</span>
    <span>with</span> <span>Matchers</span>
    <span>with</span> <span>Checkers</span>
    <span>with</span> <span>Discipline</span>
    <span>with</span> <span>TestInstances</span>
    <span>with</span> <span>GenIO</span>
    <span>with</span> <span>DefaultRuntime</span> {

  <span>override</span> <span>val</span> <span>Platform</span> <span>=</span> <span>PlatformLive</span>.makeDefault().withReportFailure(_ <span>=&gt;</span> ())

  <span>implicit</span> <span>val</span> <span>runtime</span><span>:</span> <span>Runtime</span>[<span>Any</span>] <span>=</span> <span>this</span></pre></div>
<p>If I remove the <code>with DefaultRuntime</code> how do I get a runtime? This class is instantiated by the test framework AFAIU.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263234475" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzIzNDQ3NQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzIzNDQ3NQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="091a44f707f786e7a96238a060cd39f2">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="091a44f707f786e7a96238a060cd39f2" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263234475">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263234475-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/ghostdogpr/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ghostdogpr"><img height="28" width="28" alt="@ghostdogpr" src="https://avatars0.githubusercontent.com/u/7413894?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>


        <!-- '"` --><!-- </textarea></xmp> -->

        

<div id="discussion_r263335940" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzMzNTk0MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzMzNTk0MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="c160595fdbe73f773c20d4e1c38615a0">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="c160595fdbe73f773c20d4e1c38615a0" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263335940">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263335940-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes"><img height="28" width="28" alt="@jdegoes" src="https://avatars1.githubusercontent.com/u/156745?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes">jdegoes</a>
  

          </strong>
          <span>

              <a href="#discussion_r263335940" id="discussion_r263335940-permalink">
                <relative-time datetime="2019-03-07T11:09:16Z" title="Mar 7, 2019, 3:09 AM PST">on Mar 7, 2019</relative-time>
              </a>

              
  <span>‚Ä¢</span>

  <details>
    <summary aria-haspopup="menu" role="button">
      
    </summary>
    <details-menu src="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzMzNTk0MA==/comments/comment_edit_history_log" preload="" role="menu">
      <include-fragment aria-label="Loading"></include-fragment>
    </details-menu>
  </details>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the ZIO organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p>You need to get the R from somewhere. Define an implicit def that for any type <code>R: Arbitrary</code> can return a <code>Arbitrary[Runtime[R]]</code>. Then you can easily summon a Runtime for any arbitrary R inside the test.</p>
<p>A more hacky way to do that is to define an implicit def that provides an inolicit Runtime for any Arbitrary R. By running the Gen to get some R.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263371829" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzM3MTgyOQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzM3MTgyOQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="203e9172d7b851ed6e113c182e84ab98">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="203e9172d7b851ed6e113c182e84ab98" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263371829">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263371829-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe"><img height="28" width="28" alt="@gvolpe" src="https://avatars0.githubusercontent.com/u/443978?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe">gvolpe</a>
  

          </strong>
          <span>

              <a href="#discussion_r263371829" id="discussion_r263371829-permalink">
                <relative-time datetime="2019-03-07T13:02:17Z" title="Mar 7, 2019, 5:02 AM PST">on Mar 7, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span>

        
    <span aria-label="This user has previously committed to the zio repository.">
      Contributor
    </span></p><task-lists disabled="" sortable="">
          <p>The arbitrary trick is what I suggested at first but we were probably thinking of different things <g-emoji alias="laughing" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png">üòÜ</g-emoji> Now it makes sense, will try to get it done! Thanks :)</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263658603" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY1ODYwMw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY1ODYwMw==/comments/review_comment">
    <div>
      

  

<details data-body-version="b19c1f2ef31ba594c652cd646e82f925">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="b19c1f2ef31ba594c652cd646e82f925" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263658603">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263658603-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe"><img height="28" width="28" alt="@gvolpe" src="https://avatars0.githubusercontent.com/u/443978?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe">gvolpe</a>
  

          </strong>
          <span>

              <a href="#discussion_r263658603" id="discussion_r263658603-permalink">
                <relative-time datetime="2019-03-08T03:55:49Z" title="Mar 7, 2019, 7:55 PM PST">on Mar 7, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span>

        
    <span aria-label="This user has previously committed to the zio repository.">
      Contributor
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p><a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes">@jdegoes</a> Unfortunately I'm still stuck with this. The idea sounds good but it seems I require more than just <code>Runtime[R]</code>: I need <code>Runtime[R with Clock with System .... ]</code>. So this was my attempt:</p>
<div><pre>  <span>implicit</span> <span>val</span> <span>anyArb</span><span>:</span> <span>Arbitrary</span>[<span>Any</span>] <span>=</span> <span>Arbitrary</span>(<span>Gen</span>.const(()))

  <span>type</span> <span>Env</span>[<span>R</span>] <span>=</span> <span>R</span> <span>with</span> <span>Clock</span> <span>with</span> <span>Console</span> <span>with</span> <span>System</span> <span>with</span> <span>Random</span> <span>with</span> <span>Blocking</span>

  <span>implicit</span> <span>def</span> <span>deriveRuntime</span>[<span>R</span><span>:</span> <span>Arbitrary</span>]<span>:</span> <span>Gen</span>[<span>Runtime</span>[<span>Env</span>[<span>R</span>]]] <span>=</span>
    <span>Arbitrary</span>.arbitrary[<span>R</span>].map { env <span>=&gt;</span>
      <span>Runtime</span>[<span>Env</span>[<span>R</span>]](runtime.<span>Environment</span> <span>+</span> env, <span>PlatformLive</span>.<span>Default</span>)
    }

  <span>implicit</span> <span>def</span> <span>catsEQ</span>[<span>R</span><span>:</span> <span>Arbitrary</span>, <span>E</span>, <span>A</span><span>:</span> <span>Eq</span>](<span>implicit</span> <span>rts</span>: <span>Runtime</span>[<span>Env</span>[<span>R</span>]])<span>:</span> <span>Eq</span>[<span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>]] <span>=</span>
    <span>new</span> <span>Eq</span>[<span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>]] {
      <span>import</span> <span>scalaz</span>.<span>zio</span>.<span>duration</span>.<span>_</span>

      <span>def</span> <span>eqv</span>(<span>io1</span>: <span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>], <span>io2</span>: <span>ZIO</span>[<span>R</span>, <span>E</span>, <span>A</span>])<span>:</span> <span>Boolean</span> <span>=</span> {
        <span>val</span> <span>v1</span>  <span>=</span> rts.unsafeRunSync(io1.timeout(<span>20</span>.seconds)).map(_.get)
        <span>val</span> <span>v2</span>  <span>=</span> rts.unsafeRunSync(io2.timeout(<span>20</span>.seconds)).map(_.get)
        <span>val</span> <span>res</span> <span>=</span> v1 <span>===</span> v2
        <span>if</span> (<span>!</span>res) {
          println(<span>s</span><span>"</span><span>Mismatch: </span>$v1<span> != </span>$v2<span>"</span>)
        }
        res
      }
    }

  <span>implicit</span> <span>def</span> <span>catsParEQ</span>[<span>R</span><span>:</span> <span>Arbitrary</span>, <span>E</span><span>:</span> <span>Eq</span>, <span>A</span><span>:</span> <span>Eq</span>](<span>implicit</span> <span>rts</span>: <span>Runtime</span>[<span>Env</span>[<span>R</span>]])<span>:</span> <span>Eq</span>[<span>ParIO</span>[<span>R</span>, <span>E</span>, <span>A</span>]] <span>=</span>
    <span>new</span> <span>Eq</span>[<span>ParIO</span>[<span>R</span>, <span>E</span>, <span>A</span>]] {
      <span>def</span> <span>eqv</span>(<span>io1</span>: <span>ParIO</span>[<span>R</span>, <span>E</span>, <span>A</span>], <span>io2</span>: <span>ParIO</span>[<span>R</span>, <span>E</span>, <span>A</span>])<span>:</span> <span>Boolean</span> <span>=</span>
        rts.unsafeRun(<span>Par</span>.unwrap(io1).either) <span>===</span> rts.unsafeRun(<span>Par</span>.unwrap(io2).either)
    }</pre></div>
<p>In order to create the environment I need to mixin some traits (<code>Runtime.apply</code>) and all I've got is a plain value of type <code>R</code> so this doesn't seem possible.</p>
<p>Also notice that where I require an <code>implicit rts: Runtime[Env[R]]</code> I'm not going to get one. Instead I'll have a <code>Gen</code> in scope to create a <code>Runtime[Env[R]]</code> which seems overkill. Why not just casting the given <code>ZIO[R, E, A]</code> to <code>IO[E, A]</code> as I've done to get it working? After all it's just tests to <code>unsafeRunSync</code> some computation but if there's a better way I'd like to know it.</p>
<p>So once again I'm on a dead end here <g-emoji alias="disappointed" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f61e.png">üòû</g-emoji></p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263684182" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY4NDE4Mg==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY4NDE4Mg==/comments/review_comment">
    <div>
      

  

<details data-body-version="c043927f50f0e0f100c85f52643d077c">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="c043927f50f0e0f100c85f52643d077c" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263684182">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263684182-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes"><img height="28" width="28" alt="@jdegoes" src="https://avatars1.githubusercontent.com/u/156745?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/jdegoes/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jdegoes">jdegoes</a>
  

          </strong>
          <span>

              <a href="#discussion_r263684182" id="discussion_r263684182-permalink">
                <relative-time datetime="2019-03-08T07:10:49Z" title="Mar 7, 2019, 11:10 PM PST">on Mar 7, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the ZIO organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p>Any attempt to cast away the <code>R</code> will result in a runtime exception somewhere, unless the <code>R</code> is not actually used.</p>
<p>I see now that you cannot use an arbitrary <code>R</code> here. If you like, you could create a "test" module, like this one:</p>
<div><pre><span>trait</span> <span>TestModule</span>[<span>+</span><span>A</span>] {
  <span>def</span> <span>testModule</span><span>:</span> <span>A</span>
}</pre></div>
<p>Then you could make an <code>Arbitrary</code> for that (given an <code>Arbitrary</code> for <code>A</code>), and finally, you could supply an <code>Arbitrary[Runtime[TestModule[A] with Clock with System ...]</code>.</p>
<p>However, the question is why? In my opinion, testing with <code>R = Int</code> and <code>R = String</code> like is being done is not that useful. You may as well fix the environment to <code>Clock with System</code> or weaker in the tests, rather than using <code>R = Int</code> or <code>R = String</code>.</p>
<p>If you fix the environment to the above, you can just use <code>implicit val TestRuntime = new DefaultRuntime</code>. Then fix the two or so compiler errors where a test is using a different <code>R</code>. Then you should be good to go.</p>
<p>It's a nice idea in theory to make the test <code>R agnostic</code> but you can't use a single <code>R</code> for the whole test suite in that case, which will cause lots of pain. Just best to fix the <code>R</code> for the test suite, because it's already as polymorphic as it can be in the instances.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r263690955" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY5MDk1NQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI2MzY5MDk1NQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="012803c5f03b6ed1ac2952a13fb9cbbf">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="012803c5f03b6ed1ac2952a13fb9cbbf" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r263690955">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r263690955-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe"><img height="28" width="28" alt="@gvolpe" src="https://avatars0.githubusercontent.com/u/443978?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/gvolpe/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/gvolpe">gvolpe</a>
  

          </strong>
          <span>

              <a href="#discussion_r263690955" id="discussion_r263690955-permalink">
                <relative-time datetime="2019-03-08T07:48:29Z" title="Mar 7, 2019, 11:48 PM PST">on Mar 7, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span>

        
    <span aria-label="This user has previously committed to the zio repository.">
      Contributor
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p>Thanks for bearing with me, John.</p>
<blockquote>
<p>However, the question is why? In my opinion, testing with R = Int and R = String like is being done is not that useful. You may as well fix the environment to Clock with System or weaker in the tests, rather than using R = Int or R = String.</p>
</blockquote>
<p>You're right. I just want to verify that there are Cats instances in scope for <code>TaskR[R, ?]</code> so I could just add the code that summons such instances somewhere, don't need property tests. If something is wrong, the code just won't compile.</p>
<blockquote>
<p>If you fix the environment to the above, you can just use implicit val TestRuntime = new DefaultRuntime. Then fix the two or so compiler errors where a test is using a different R. Then you should be good to go.</p>
</blockquote>
<p>I don't understand this. Having a <code>DefaultRuntime</code> works fine for the other tests but what do you mean with "fix the compiler errors where a test is using a different <code>R</code>"? I think this is the whole issue and why I'm stuck here, it needs a <code>Runtime[R]</code> <g-emoji alias="smile" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png">üòÑ</g-emoji></p>
<blockquote>
<p>It's a nice idea in theory to make the test R agnostic but you can't use a single R for the whole test suite in that case, which will cause lots of pain. Just best to fix the R for the test suite, because it's already as polymorphic as it can be in the instances.</p>
</blockquote>
<p>Completely agree <g-emoji alias="+1" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png">üëç</g-emoji> I just want to make this as simple as possible, I just haven't found the way.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

    </div>

  </div>


</div>




</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>