<!DOCTYPE html>
<html lang="en">
<head>
    <title>
SRE keeps digging to prevent problems | Google Cloud Blog - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="SRE keeps digging to prevent problems | Google Cloud Blog - linksfor.dev(s)"/>
    <meta property="article:author" content="Steve McGhee  Solutions Architect, Google Cloud"/>
    <meta property="og:description" content="See a real-world example of how Google&#x2019;s SRE practices can identify and help fix issues, even at the bottom of the hardware stack."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://cloud.google.com/blog/products/management-tools/sre-keeps-digging-to-prevent-problems"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - SRE keeps digging to prevent problems | Google Cloud Blog</title>
<div class="readable">
        <h1>SRE keeps digging to prevent problems | Google Cloud Blog</h1>
            <div>by Steve McGhee  Solutions Architect, Google Cloud</div>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 16 Mar 2020</div>
        <p><a href="https://cloud.google.com/blog/products/management-tools/sre-keeps-digging-to-prevent-problems">https://cloud.google.com/blog/products/management-tools/sre-keeps-digging-to-prevent-problems</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><article-page><main id="jump-content"><article><article-header-block><section></section></article-header-block><!----><!----><div><article-cta _nghost-c13=""><!----><div _ngcontent-c13=""><div _ngcontent-c13=""><h4 _ngcontent-c13=""><!----><!----><span _ngcontent-c13="">Try GCP</span><!----><!----><!----><!----><!----></h4><p _ngcontent-c13=""><!----><!----><span _ngcontent-c13="">Get $300 free credit to spend over 12 months.</span><!----><!----><!----><!----><!----></p><a _ngcontent-c13="" clicktracker="" rel="external" track-type="freeTrial" track-name="gcpCta" track-metadata-eventdetail="body" href="https://cloud.google.com/free/"><!----><!----><span _ngcontent-c13="">Free Trial</span><!----><!----><!----><!----><!----></a></div></div></article-cta></div><article-share-block></article-share-block><article-sticky-share-block></article-sticky-share-block><section><div><div><!----><article-content-stream-block><!----><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><p>At Google, our teams follow site reliability engineering (SRE) practices to help keep systems healthy and users productive. There is a phrase we often use on our SRE teams: "At Google scale, million-to-one chances happen all the time." This illustrates the massive complexity of the system that powers Google Search, Gmail, Ads, Cloud, Android, Maps, and many more. That type of scale creates complex, emergent modes of failure that aren’t seen elsewhere. Thus, SREs within Google have become adept at developing systems to track failures deep into the many layers of our infrastructure. Not every failure can be automatically detected, so investigative tools, techniques, and most importantly, attitude are essential. Rare, unexpected chains of events happen often. Some have visible impact, but most don't.</p></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div><div><!----><!----><!----><!----><!----><!----><!----><article-pull-quote-block><div><section><div><p><q>At Google scale, million-to-one chances happen all the time.</q></p></div></section></div></article-pull-quote-block><!----></div><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><div _ngcontent-c16=""><p>This was illustrated in a recent incident that Google users would likely not have noticed. We consider these types of failures "<a href="https://cloud.google.com/blog/products/gcp/understanding-error-budget-overspend-cre-life-lessons">within error budget</a>" events. They are expected, accepted, and engineered into the design criteria of our systems. However, they still get tracked down to make sure they aren’t forgotten and accumulated into technical debt—we use them to prevent this class of failures across a range of systems, not just the one that had the problem. This incident serves as a good example of tracking down a problem once initial symptoms were mitigated, finding underlying causes and preventing it from happening again—without users noticing. This level of rigor and responsibility is what underlies the SRE approach to running systems in production.&nbsp;</p><p><b>Digging deep for a problem’s roots</b></p><p>In this event, an SRE on the traffic and load balancing team was alerted that some GFEs (Google front ends) in <a href="https://peering.google.com/" target="_blank">Google's edge network</a>, which statelessly cache frequently accessed content, were producing an abnormally high number of errors. The on-call SRE was paged. They immediately removed ("drained") the machines from serving, thus eliminating the errors that might result in a degraded state for customers. This ability to rapidly mitigate an incident in this way is a core competency within Google SRE. Because we have confidence in our capacity models, we know that we have redundant resources to allow for this mitigation at any time.</p><p>At this point, our SRE had mitigated the issue with the drain, but they weren’t done yet. Based on previous similar issues, they knew this type of error is often caused by a transient network issue. After finding evidence of packet loss, isolated to a single rack of machines, our SRE got in touch with the edge networking team, which identified correlated <a href="https://en.wikipedia.org/wiki/Border_Gateway_Protocol" target="_blank">BGP</a> <a href="https://en.wikipedia.org/wiki/Route_flapping" target="_blank">flapping</a> on the router in the affected rack. However, the nature of the flaps hinted at a problem with the machines rather than the router. This indicated that the problem revolved around a particular machine or set of machines.<br></p><p>Further investigation uncovered kernel messages in the GFE machines' base system log. These errors indicated CPU throttling:</p><p><code>MMM DD HH:mm:ss xxxxxxx kernel: [3220998.149713] CPU16: Package temperature above threshold, cpu clock throttled (total events = 1596886)</code></p><p>The process on the machine responsible for BGP announcements showed higher-than-usual CPU usage, which perfectly correlated with both the onset of the errors and the CPU throttling. This confirmed the theory that the throttling was significant enough to be impactful and measurable by Google's monitoring system:<br></p></div></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><div _ngcontent-c16=""><p>The SRE then checked on adjacent machines to find if there were any other similarly failing systems. Notably, the only machines that were affected were on a single rack. Machines on adjacent racks were not affected!</p><p>Why would a single rack be overheating to the point of CPU throttling when its neighbors were totally unaffected?? What is it about the physical support for machines that would cause kernel errors? It didn't add up.</p><p>The SRE then sent the machine to repairs, which means that they filed a bug in our company-wide issue tracking system. In this case, the bug was sent to the on-site hardware operations and management team.</p><p>This bug was clear and to the point:</p><p><code>Please repair the following:</code><br><code>Machines in XXXXXX are seeing thermal events in syslog:</code><br><code>MMM DD HH:mm:ss xxxxxxx kernel: [3220998.149713] CPU16: Package temperature above threshold, cpu clock throttled (total events = 1596886)</code><br><code>This throttling is ultimately causing user harm, so I've drained user traffic.</code></p><p>This bug, or ticket, clearly specified the machine(s) that were affected and described the symptoms and actions taken up to that point. At this point, the hardware team took over the investigation and determined the physical issue that resulted in this chain of events in the software. Google's 24x7 team is composed of many teams, working together to ensure problems are well-understood at all levels of the stack.</p><p>Finding the cause of a chain of events</p><p>So what was the problem?</p><p><code>Hello, we have inspected the rack. The casters on the rear wheels have failed and the machines are overheating as a consequence of being tilted.</code></p></div></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><p>The wheels (casters) supporting the rack had been crushed under the weight of the fully loaded rack. The rack then had physically tilted forward, disrupting the flow of liquid coolant and resulting in some CPUs heating up to the point of being throttled.</p></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><div _ngcontent-c16=""><p>The caster got fixed and the rack was returned to proper alignment. But the greater issues of "How did this happen?" and "How can we prevent it?" needed to be addressed.</p><p>The hardware teams discussed potential options, ranging from distributing wheel repair kits to all locations to improving the rack-moving procedures to avoid damaging the wheels, and even considered improving the method of transporting new racks to data centers during initial build-out.</p><p>The team also considered how many existing racks risk similar failures. This then resulted in a systematic replacement of all racks with the same issue, while avoiding any customer impact.</p><p>Talk about deep analysis! The SRE tracked the problem all the way from an external, front-end system down to the hardware that holds up the machines. This type of deep troubleshooting happens within Google's production teams due to clear communication, shared goals, and a common expectation to not only fix problems, but prevent all future occurrences.&nbsp;&nbsp;</p><p>Another phrase we commonly use here on SRE teams is "All incidents should be novel"—they should never occur more than once. In this case, the SREs and hardware operation teams worked together to ensure that this class of failure would never happen again.</p></div></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div><div><!----><!----><!----><!----><!----><!----><!----><article-pull-quote-block><div><section><div><p><q>All incidents should be novel.</q></p></div></section></div></article-pull-quote-block><!----></div><div><!----><!----><div><div><div><!----><!----><paragraph-block _nghost-c16=""><div _ngcontent-c16=""><p>This level of rigorous analysis and persistence is a great example of incident response using deep and broad monitoring and the culture of responsibility that keeps Google running 24x7.&nbsp;</p><p>Google Cloud customers often ask how SRE can work in a hybrid, on-prem, or multi-cloud environment. SRE practices can be used to work across teams within an organization, across multiple environments. SRE helps teams work together during incidents like this, from traffic management to data center hardware operations.&nbsp;&nbsp;</p><p>Find out more about the SRE approach to running systems and <a href="https://cloud.google.com/blog/products/devops-sre/how-sre-teams-are-organized-and-how-to-get-started">how your team can adopt SRE best practices</a>.</p></div></paragraph-block><!----><!----><!----></div></div></div><!----><!----><!----><!----><!----><!----></div></article-content-stream-block><!----><article-tag-list-block><!----></article-tag-list-block></div><related-articles-block _nghost-c14=""></related-articles-block><related-articles-drawer-block _nghost-c15=""></related-articles-drawer-block></div></section></article></main></article-page></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>