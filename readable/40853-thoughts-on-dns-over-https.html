<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Thoughts on DNS-over-HTTPS -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Thoughts on DNS-over-HTTPS</h1>
    <div class="entry-content"> <p>Type <a href="https://example.com">https://example.com</a> in your web browser&#x2019;s address bar and hit enter.</p>
<p>What happens?</p>
<p>Before connecting to the example.com server, your browser must convert &#x201C;example.com&#x201D; to the network address at which that server is located.</p>
<p><img class=" size-full wp-image-2468 aligncenter" src="https://textplain.files.wordpress.com/2019/11/dns.png?w=382" alt="dns" srcset="https://textplain.files.wordpress.com/2019/11/dns.png 382w, https://textplain.files.wordpress.com/2019/11/dns.png?w=150 150w, https://textplain.files.wordpress.com/2019/11/dns.png?w=300 300w" sizes="(max-width: 382px) 100vw, 382px"></p>
<p>It does this lookup using a protocol called &#x201C;<a href="https://www.cloudflare.com/learning/dns/what-is-dns/">DNS</a>.&#x201D; Today, most DNS transactions are conducted in plaintext (not encrypted) by sending&#xA0;<a href="https://en.wikipedia.org/wiki/User_Datagram_Protocol">UDP</a>&#xA0;messages to the DNS resolver your computer is configured to use.</p>
<p>There are a number of problems with the 36-year-old DNS protocol, but a key one is that the unencrypted use of UDP traffic means that network intermediaries can see (and potentially modify) your lookups, such that attackers can know where you&#x2019;re browsing, and potentially even direct your traffic to some other server.</p>
<p>The&#xA0;<a href="https://en.wikipedia.org/wiki/DNS_over_HTTPS">DNS-over-HTTPS</a>&#xA0;protocol attempts to address some of these problems by sending DNS traffic over a HTTPS connection to the DNS resolver. The encryption of a TLS connection helps prevent network intermediaries from knowing what addresses your browser is looking up&#x2013; your queries are private between your PC and the DNS resolver that is providing the answers. The expressiveness of HTTP (with request and response headers) provides interesting options for future extensibility, and the modern HTTP2 and HTTP3 protocols aim to provide high-performance and parallel transactions with a single connection.</p>
<h2>Try It</h2>
<p>Support for DNS-over-HTTPS is coming to many browsers and operating systems, and you can even try it out in the newest version of Microsoft Edge (v79+) by starting the browser with a special command line flag. The following command line will start the browser and instruct it to perform DNS lookups using the Cloudflare DoH server:</p>
<p><code>msedge.exe --enable-features=&quot;DnsOverHttps&lt;DoHTrial&quot; --force-fieldtrials=&quot;DoHTrial/Group1&quot; --force-fieldtrial-params=&quot;DoHTrial.Group1:Fallback/false/Templates/https%3A%2F%cloudflare-dns.com%2Fdns-query&quot;</code></p>
<p>You can test to see whether the feature is working as expected by visiting <a href="https://1.1.1.1/help">https://1.1.1.1/help</a>.&#xA0;Unfortunately, this command line flag presently only works on <em>unmanaged&#xA0;</em>PCs, meaning it doesn&#x2019;t do anything from PCs that are joined to a Windows domain.</p>
<h2>Some Thoughts, In No Particular Order</h2>
<p>Long-time readers of this blog know that I want to &#x201C;HTTPS ALL THE THINGS&#x201D; and DNS is no exception. Unfortunately, as with most protocol transitions, this turns out to be very very complicated.</p>
<h3>SNI</h3>
<p>The privacy benefits of DNS-over-HTTPS are predicated on the idea that a network observer, blinded from your DNS lookups by encryption, will not be able to see where you&#x2019;re browsing.</p>
<p>Unfortunately, network observers, by definition, can observe your traffic, even if it&#x2019;s encrypted.</p>
<p>The network observer will still see the IP addresses you&#x2019;re connecting to, and that&#x2019;s often sufficient to know what sites you&#x2019;re browsing.</p>
<p>Worse, they are usually still able to tell what <em>specific</em> HTTPS site you&#x2019;re visiting on that IP address. That&#x2019;s because one of the current <a href="https://textslashplain.com/2018/02/14/understanding-the-limitations-of-https/">limitations of HTTPS</a> is that the browser sends, in unencrypted form, the hostname it expects to see in the server&#x2019;s certificate as a part of the ClientHello message in the HTTPS handshake. Closing this Server Name Indication (SNI) hole requires implementation of Encrypted SNI (ESNI) and this feature is <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=908132">not yet implemented in Chromium</a>.</p>
<h3>Privacy From Observers, Not the Resolver</h3>
<p>If your Internet Service Provider (say, for example, Comcast) is configured to offer DNS-over-HTTPS, and your browser uses their resolver, your network lookups are protected from observers on the local network, but&#xA0;<em>not&#xA0;</em>from the Comcast resolver.</p>
<p>Because the data handling practices of resolvers are often opaque, and because there are business incentives for resolvers to make use of lookup data (for advertising targeting or analytics revenue), it could be the case that the very actor you are trying to hide your traffic from (e.g. your ISP) is exactly the one holding the encryption key you&#x2019;re using to encrypt the lookup traffic.</p>
<p>To address this, some users choose to send their traffic not to the default resolver their device is configured to use (typically provided by the ISP) but instead send the lookups to a &#x201C;Public Resolver&#x201D; provided by a third-party with a stronger privacy promise.</p>
<p>However, this introduces its own complexities.</p>
<h3>Public Resolvers Don&#x2019;t Know Private Addresses</h3>
<p>A key problem in the deployment of DNS-over-HTTPS is that public resolvers (Google Public DNS, Cloudflare, Open DNS, etc) cannot know the addresses of servers that are within an intranet. If your browser attempts to look up a hostname on your intranet (say MySecretServer.intranet.MyCo.com) using the public resolver, the public resolver not only gets information about your internal network (e.g. now Google knows that you have a server called MySecretServer.intranet) but it also returns &#x201C;Sorry, never heard of it.&#x201D; At this point, your browser has to decide what to do next. It might fail entirely (&#x201C;Sorry, site not found&#x201D;) or it might &#x201C;Fail open&#x201D; and perform a plain UDP lookup using the system-configured resolver provided by e.g. your corporate network administrator.</p>
<p>This fallback means that a network attacker might simply block your DoH traffic such that you perform&#xA0;<em>all&#xA0;</em>of your queries in unprotected fashion. Not great.</p>
<p>Even <em>alerting</em> the user to such a problem is tricky: What could the browser even say that a human might understand? &#x201C;Nerdy McNerdy Nerd Nerd Nerd Nerd Nerd Address Nerd Resolution Nerd Geek. Privacy. Network. Nerdery. Geekery. Continue?&#x201D;</p>
<h3>Centralization Isn&#x2019;t Great</h3>
<p>Centralizing DNS resolutions to the (relatively small) set of public DNS providers is contentious, at best. Some European jurisdictions are uncomfortable about the idea that their citizens&#x2019; DNS lookups might be sent to an American tech giant.</p>
<p>Some privacy-focused users are primarily&#xA0;<em>worried&#xA0;</em>about the internet giants (e.g. Google, Cloudflare) and are very nervous that the rise of DoH will result in browsers sending traffic to these resolvers by default. Google has said <a href="https://blog.chromium.org/2019/10/addressing-some-misconceptions-about.html">they won&#x2019;t do that in Chrome</a>, while Firefox is experimenting with using Cloudflare by default in some locales.</p>
<h3>Content Filtering</h3>
<p>Historically, DNS resolutions were a convenient choke point for schools, corporations, and parents to implement content filtering policies. By interfering with DNS lookups for sites that network users are forbidden to visit (e.g adult content, sites that put the user&#x2019;s security at risk, or sites that might result in legal liability for the organization), these organizations were able to easily prevent non-savvy users from connecting to unwanted sites. Using DoH to a Public DNS provider bypasses these types of content filters, leaving the organization with unappealing choices: start using lower-granularity network interception (e.g. blocking by IP addresses), installing content-filters on the user&#x2019;s devices directly, or attempting to block DoH resolvers entirely and forcing the user&#x2019;s devices to fall back to the filtered resolver.</p>
<h3>Geo CDNs and Other Tricks</h3>
<p>In the past, DNS was one mechanism that a geographically distributed CDN could use to load-balance its traffic such that users get the &#x201C;best&#x201D; answers for their current locale. For instance, if the resolver was answering a query from a user in Australia, it might return a different server address than when resolving a query from a user in Florida.</p>
<p>These schemes and others get more complicated when the user isn&#x2019;t using a local DNS resolver and is instead using a central public resolver, possibly provided by a competitor to the sites that the user is trying to visit.</p>
<h2>Don&#x2019;t Despair</h2>
<p>Despite these challenges and others, DNS-over-HTTPS represents an improvement over the status quo, and as browser and OS engineering teams and standards bodies invest in addressing these problems, we can expect that deployment and use of DoH will grow more common in the coming years.</p>
<p>DoH will eventually be a part of a more private and secure web.</p>
<p>-Eric Lawrence</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>