<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Add Span&lt;T&gt;.Sort(...) by changing Array.Sort internals to be Span based by nietras &#xB7; Pull Request #24419 &#xB7; dotnet/coreclr - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Add Span&lt;T&gt;.Sort(...) by changing Array.Sort internals to be Span based by nietras &#xB7; Pull Request #24419 &#xB7; dotnet/coreclr - linksfor.dev(s)"/>
    <meta property="article:author" content="nietras"/>
    <meta property="og:description" content="After the exercise in futility of my previous PRs #16986 (and dotnet/corefx#26859), where I tried adding Sort(...) in as performant a way as possible in C# code only  (using refs throughout and wit..."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://github.com/dotnet/coreclr/pull/24419"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Add Span&lt;T&gt;.Sort(...) by changing Array.Sort internals to be Span based by nietras &#xB7; Pull Request #24419 &#xB7; dotnet/coreclr</title>
<div class="readable">
        <h1>Add Span&lt;T&gt;.Sort(...) by changing Array.Sort internals to be Span based by nietras &#xB7; Pull Request #24419 &#xB7; dotnet/coreclr</h1>
            <div>by nietras</div>
            <div>Reading time: 45-57 minutes</div>
        <div>Posted here: 03 Jun 2019</div>
        <p><a href="https://github.com/dotnet/coreclr/pull/24419">https://github.com/dotnet/coreclr/pull/24419</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div data-channel="marked-as-read:pull-request:276290092">

        
<div data-gid="MDExOlB1bGxSZXF1ZXN0Mjc2MjkwMDky" data-url="/_render_node/MDExOlB1bGxSZXF1ZXN0Mjc2MjkwMDky/pull_requests/body" data-channel="pull_request:276290092">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>

  


</div>


        

  


  
  


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0MTM2ODAx">
  
      

<div>
  
<div id="pullrequestreview-234136801" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0MTM2ODAx" data-channel="pull_request_review:234136801" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0MTM2ODAx/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-281308858">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-281308858R1673" data-line-number="1673"></td>

      <td>
        <span>                        <span>ref</span> <span>byte</span> <span>byteRef</span> <span>=</span> <span>ref</span> <span>Unsafe</span>.<span>As</span>&lt;<span>T</span>, <span>byte</span>&gt;(<span>ref</span> <span>array</span>.<span>GetPinnableReference</span>());</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308858R1674" data-line-number="1674"></td>

      <td>
        <span>                        <span>fixed</span> (<span>byte</span><span>*</span> <span>ptr</span> <span>=</span> <span>&amp;</span><span>byteRef</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308858R1675" data-line-number="1675"></td>

      <td>
        <span>                        {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308858R1676" data-line-number="1676"></td>

      <td>
        <span>                            <span>if</span> (<span>Array</span>.<span>TrySZSort</span>(<span>new</span> <span>IntPtr</span>(<span>ptr</span>), <span>typeof</span>(<span>T</span>), <span>IntPtr</span>.<span>Zero</span>, <span>typeof</span>(<span>T</span>), <span>index</span>, <span>index</span> <span>+</span> <span>length</span> <span>-</span> <span>1</span>))</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r281308858" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTMwODg1OA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTMwODg1OA==/comments/review_comment">
    <div>
      

  

<details data-body-version="f8488ce5d0d91d15adb7a55ac46eeeaf">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="f8488ce5d0d91d15adb7a55ac46eeeaf" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r281308858">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r281308858-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>


        



<div>
  
      
  
<div>
  <table id="discussion-diff-281308900">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-281308900R1714" data-line-number="1714"></td>

      <td>
        <span>                        <span>fixed</span> (<span>byte</span><span>*</span> <span>keysPtr</span> <span>=</span> <span>&amp;</span><span>keysRef</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308900R1715" data-line-number="1715"></td>

      <td>
        <span>                        <span>fixed</span> (<span>byte</span><span>*</span> <span>itemsPtr</span> <span>=</span> <span>&amp;</span><span>itemsRef</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308900R1716" data-line-number="1716"></td>

      <td>
        <span>                        {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281308900R1717" data-line-number="1717"></td>

      <td>
        <span>                            <span>if</span> (<span>Array</span>.<span>TrySZSort</span>(<span>new</span> <span>IntPtr</span>(<span>keysPtr</span>), <span>typeof</span>(<span>TKey</span>), <span>new</span> <span>IntPtr</span>(<span>itemsPtr</span>), <span>typeof</span>(<span>TValue</span>), <span>index</span>, <span>index</span> <span>+</span> <span>length</span> <span>-</span> <span>1</span>))</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r281308900" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTMwODkwMA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTMwODkwMA==/comments/review_comment">
    <div>
      

  

<details data-body-version="f8488ce5d0d91d15adb7a55ac46eeeaf">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="f8488ce5d0d91d15adb7a55ac46eeeaf" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r281308900">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r281308900-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTgyMDUxOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTgyMDUxOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTgyMDUxOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489820519">
    <div>
      

  

<details data-body-version="215e82aa9449df55eb7ef1d27ee03200">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="215e82aa9449df55eb7ef1d27ee03200" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>This general approach makes sense to me for 3.0, as long as it can be done without regressing array sorting perf. If array perf doesn't regress, then at least we end up with something functional for spans, and it can be optimized for subsequent releases.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjAzOA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjAzOA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTg5NjAzOA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489896038">
    <div>
      

  

<details data-body-version="790dba8bc39af970ee01d52dc22deb27">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="790dba8bc39af970ee01d52dc22deb27" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I agree with <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> that a simple, safe, less-optimized implementation is a good way to start on this.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjI3OA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjI3OA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTg5NjI3OA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489896278">
    <div>
      

  

<details data-body-version="3e50ab5e3381a2cb1ad05ea99ae19a6a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="3e50ab5e3381a2cb1ad05ea99ae19a6a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>The array to Span conversion throws for co-variant array. There may be a bit of unsafe code needed to avoid throwing for Sort on co-variant arrays.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0Mjk3MTQw">
  
      

<div>
  
<div id="pullrequestreview-234297140" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0Mjk3MTQw" data-channel="pull_request_review:234297140" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0Mjk3MTQw/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-281451317">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-281451317R1660" data-line-number="1660"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281451317R1661" data-line-number="1661"></td>

      <td>
        <span>            <span>if</span> (<span>length</span> <span>&gt;</span> <span>1</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281451317R1662" data-line-number="1662"></td>

      <td>
        <span>            {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-281451317R1663" data-line-number="1663"></td>

      <td>
        <span>#<span>if</span> <span>CORECLR</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r281451317" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTQ1MTMxNw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTQ1MTMxNw==/comments/review_comment">
    <div>
      

  

<details data-body-version="75b58a64966546a7ad713f2d4047e2d5">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="75b58a64966546a7ad713f2d4047e2d5" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r281451317">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r281451317-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="28" width="28" alt="@jkotas" src="https://avatars2.githubusercontent.com/u/6668460?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">jkotas</a>
  

          </strong>
          <span>

              <a href="#discussion_r281451317" id="discussion_r281451317-permalink">
                <relative-time datetime="2019-05-07T03:46:42Z" title="May 6, 2019, 8:46 PM PDT">on May 6, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>I think it would be fine to skip this optimization in the initial implementation.</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r281828003" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTgyODAwMw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4MTgyODAwMw==/comments/review_comment">
    <div>
      

  

<details data-body-version="88b8e7b16909a0497407821b60572500">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="88b8e7b16909a0497407821b60572500" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r281828003">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r281828003-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r281828003" id="discussion_r281828003-permalink">
                <relative-time datetime="2019-05-07T21:01:19Z" title="May 7, 2019, 2:01 PM PDT">on May 7, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <p>removed the #if CORECLR, note the comment though, this will mean Span sort might be different for equal keys since the different Sort variants are not 100% identical as discussed in <a data-error-text="Failed to load issue title" data-id="305857039" data-permission-text="Issue title is private" data-url="https://github.com/dotnet/coreclr/issues/16986" data-hovercard-type="pull_request" data-hovercard-url="/dotnet/coreclr/pull/16986/hovercard" href="https://github.com/dotnet/coreclr/pull/16986">#16986</a></p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjYwNQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ4OTg5NjYwNQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ4OTg5NjYwNQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-489896605">
    <div>
      

  

<details data-body-version="0d8a8d6345c7908820fb62ddfcd96bbe">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="0d8a8d6345c7908820fb62ddfcd96bbe" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>as long as it can be done without regressing array sorting perf</p>
</blockquote>
<p>Could you please collect some performance numbers on this?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDA3NDU0NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDA3NDU0NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDA3NDU0NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490074544">
    <div>
      

  

<details data-body-version="396ab97844ae3ae903da95aa12f8cb8c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="396ab97844ae3ae903da95aa12f8cb8c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>a simple, safe, less-optimized implementation is a good way to start</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> <a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> good :) Your initial thoughts mirror mine, we are facing two issues with changing the "backbone" of sort with Span-based versions:</p>
<ul>
<li>Co-variant arrays</li>
<li>Possible performance regressions</li>
</ul>
<blockquote>
<p>array to Span conversion throws for co-variant array. There may be a bit of unsafe code needed to avoid throwing for Sort on co-variant arrays.</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> yes exactly, which is why I was wondering if this was a viable path, could you expand on the "bit of unsafe code" needed? I assume we have to convert to a Span with the same type as the underlying array, but what about the custom comparers then?</p>
<blockquote>
<p>as long as it can be done without regressing array sorting perf</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> right that is the question. Lets for now assume that the creation of the Spans for the input arrays has neglible overhead even for small numbers of elements. The biggest problem here then is whether the Span based sorting code will not regress performance.</p>
<p>I haven't done a lot <code>coreclr</code> based development so I will have to get into how to do benchmarks of this first. :)</p>
<p>One thing I can say though, from the experience from the previous PRs, if Span API methods does not call <code>TrySZSort</code>, which is what <a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> is suggesting and I think is a good start, then the performance for Span for the types supported by <code>TrySZSort</code> will be significantly slower will high likelihood. This could be addressed later I think that is a good plan.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDA3ODA0NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDA3ODA0NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDA3ODA0NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490078044">
    <div>
      

  

<details data-body-version="c765fc2d8f56eb15434f62016f422869">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="c765fc2d8f56eb15434f62016f422869" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>Could you please collect some performance numbers on this?</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> I assume there are existing benchmarks in place I can use or?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDExMTI4MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDExMTI4MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDExMTI4MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490111281">
    <div>
      

  

<details data-body-version="12175097181dcd72b198c5794bab301c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOmRkZDM2ZDdmMWM1NjlkZjc2NDRjODcxY2Q1ZjhjNjhiOTk1N2ZlNTg=">
  
      <div>
    
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:ddd36d7f1c569df7644c871cd5f8c68b9957fe58" data-url="/dotnet/coreclr/pull/24419/commits/ddd36d7f1c569df7644c871cd5f8c68b9957fe58/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:056709d89cca9845aecde8d27bd767f691c36ef7" data-url="/dotnet/coreclr/pull/24419/commits/056709d89cca9845aecde8d27bd767f691c36ef7/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDI1NDExOQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDI1NDExOQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDI1NDExOQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490254119">
    <div>
      

  

<details data-body-version="9542dbd473aedd65b1cdf95ec9b3327e">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9542dbd473aedd65b1cdf95ec9b3327e" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>new Span(ref Unsafe.As&lt;byte, T&gt;(ref array.GetRawSzArrayData()), a.Length)</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> I should have updated to do that for all array to span conversion. Let me know if it looks ok. :)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOjZhMzE1OTMzNDJkMmQ2YjlkZjIzNTk3OWRjZGIyZTM4MzdjMzVjYWU=">
  
      <div>
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:6a31593342d2d6b9df235979dcdb2e3837c35cae" data-url="/dotnet/coreclr/pull/24419/commits/6a31593342d2d6b9df235979dcdb2e3837c35cae/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MTYw">
  
      

<div>
  
<div id="pullrequestreview-234838160" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MTYw" data-channel="pull_request_review:234838160" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MTYw/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MjE0">
  
      

<div>
  
<div id="pullrequestreview-234838214" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MjE0" data-channel="pull_request_review:234838214" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM4MjE0/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM5NTk5">
  
      

<div>
  
<div id="pullrequestreview-234839599" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM5NTk5" data-channel="pull_request_review:234839599" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM0ODM5NTk5/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  


  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM1MDAyOTYx">
  
      

<div>
  
<div id="pullrequestreview-235002961" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM1MDAyOTYx" data-channel="pull_request_review:235002961" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjM1MDAyOTYx/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

  
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOjc3MDBjYjFjMDFiM2ZiYmQ2OGRmMTc1ODYzOTZjNWUyOGQ0ZTE5Nzc=">
  
      <div>
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:7700cb1c01b3fbbd68df17586396c5e28d4e1977" data-url="/dotnet/coreclr/pull/24419/commits/7700cb1c01b3fbbd68df17586396c5e28d4e1977/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDQ1MzI2NA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDQ1MzI2NA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDQ1MzI2NA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490453264">
    <div>
      

  

<details data-body-version="0da8fd422e5fcda70648e8e59c06de56">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="0da8fd422e5fcda70648e8e59c06de56" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> now that I have added the proper Span Sort(...) methods, the first issues arise. And things are coming back to me from a year ago :)</p>
<p>The span Sort methods take a <code>TComparer</code> to allow value type use and inlining of the comparer. I have added support for that for <code>TKey, TValue</code> scenarios, since this was easy for the existing code. However, for just <code>TKey</code> the only version that exist is based on <code>Comparison&lt;TKey&gt;</code> and changing a comparer to a delegate by forwarding the method <code>comparer.Compare</code>.</p>
<p>Overall, the array sorting API and code is not exactly consistent in API surface and underlying code across situations. The Span sort API is. But we then face how to use existing sort code and if we can change that or have to add/duplicate sorting code, which means bigger changes.</p>
<p>How do you think we should proceed?</p>
<p>I think we should limit changes and do initial benchmarks as soon as possible to be sure these changes do not lead to performance regressions. But would like at least to have "complete" code that supports both Array and Span APIs so changes needed for that are present and hence benchmarked.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


  
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDQ1NzIxNA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5MDQ1NzIxNA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5MDQ1NzIxNA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/mikedn/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mikedn"><img height="40" width="40" alt="@mikedn" src="https://avatars3.githubusercontent.com/u/9973420?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-490457214">
    <div>
      

  

<details data-body-version="6e31933392c6af813a7ebe0459a46e9a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="6e31933392c6af813a7ebe0459a46e9a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>However, for just TKey the only version that exist is based on Comparison and changing a comparer to a delegate by forwarding the method comparer.Compare.</p>
</blockquote>
<p>That's because delegate calls are slightly faster than interface calls. I suppose you can replace the delegate with <code>TComparer</code> throughout the sorting code and wrap the existing delegate in a suitable <code>TComparer</code>.</p>
<p>That said, the whole thing with <code>TComparer</code> is a bit unusual. While it's true that it allows inlining of the compare predicate and that should speed up things, it can also result in significant code bloat if this technique becomes widely used. Well, I suppose it won't since it's far more convenient to write <code>Sort((x, y) =&gt; …)</code> than to create a special struct comparer.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>



  

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOmYxMDMxYjgwM2VhOGFiNTMyYTdiMjFlYWUyMDllNDgwMzcyOWFjYzE=">
  
      <div>
    
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:f1031b803ea8ab532a7b21eae209e4803729acc1" data-url="/dotnet/coreclr/pull/24419/commits/f1031b803ea8ab532a7b21eae209e4803729acc1/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
    
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:93648bca9118d9d32533863707e07cc47d4614f5" data-url="/dotnet/coreclr/pull/24419/commits/93648bca9118d9d32533863707e07cc47d4614f5/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyMjE1MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyMjE1MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5ODAyMjE1MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-498022151">
    <div>
      

  

<details data-body-version="9bada9299f192c06ecc76e135923eee0">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="9bada9299f192c06ecc76e135923eee0" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> ah it appears the master had changed which was the reason for nullables changes, I have merged with latest master to resolve conflict.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyNzMzMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyNzMzMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5ODAyNzMzMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-498027332">
    <div>
      

  

<details data-body-version="53eaabc76388e4e3bb3575f674b34463">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="53eaabc76388e4e3bb3575f674b34463" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>ci build fails with:</p>
<pre><code>shared\System\Collections\Generic\ArraySortHelper.cs(155,10): error CS0246: The type or namespace name 'MethodImplAttribute' could not be found (are you missing a using directive or an assembly reference?) [F:\workspace\_work\1\s\src\System.Private.CoreLib\System.Private.CoreLib.csproj]
shared\System\Collections\Generic\ArraySortHelper.cs(155,10): error CS0246: The type or namespace name 'MethodImpl' could not be found (are you missing a using directive or an assembly reference?) [F:\workspace\_work\1\s\src\System.Private.CoreLib\System.Private.CoreLib.csproj]
shared\System\Collections\Generic\ArraySortHelper.cs(155,21): error CS0103: The name 'MethodImplOptions' does not exist in the current context [F:\workspace\_work\1\s\src\System.Private.CoreLib\System.Private.CoreLib.csproj]
</code></pre>
<p>i.e. <code> type or namespace name 'MethodImpl' could not be found</code> how can I resolve this?</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyNzc3NQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODAyNzc3NQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5ODAyNzc3NQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-498027775">
    <div>
      

  

<details data-body-version="35e9a0d883ccc6810b060535487c4bf5">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="35e9a0d883ccc6810b060535487c4bf5" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I also have problems building locally after merging with master... even <code>clean.cmd</code> fails:</p>
<pre><code>.\clean.cmd
Installing dotnet using Arcade...
running: powershell -NoProfile -ExecutionPolicy unrestricted -Command ". C:\git\oss\coreclr\eng\configure-toolset.ps1; . C:\git\oss\coreclr\eng\common\tools.ps1; InitializeBuildTool"

Name                           Value
----                           -----
Path                           C:\git\oss\coreclr\.dotnet\dotnet.exe
Command                        msbuild
Tool                           dotnet
Framework                      netcoreapp2.1
Running: dotnet msbuild /nologo /verbosity:minimal /clp:Summary /nodeReuse:false /flp:v=normal;LogFile=clean.log /t:CleanAllProjects
C:\git\oss\coreclr\all.locproj(14,3): error MSB4019: The imported project "C:\tools\devdiv\loc\Loctask\Localization.settings.targets" was not found. Confirm that the path in the &lt;Import&gt; declaration is correct, and that the file exists on disk.

Build FAILED.

C:\git\oss\coreclr\all.locproj(14,3): error MSB4019: The imported project "C:\tools\devdiv\loc\Loctask\Localization.settings.targets" was not found. Confirm that the path in the &lt;Import&gt; declaration is correct, and that the file exists on disk.
</code></pre>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI1NDc5">
  
      

<div>
  
<div id="pullrequestreview-244625479" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI1NDc5" data-channel="pull_request_review:244625479" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI1NDc5/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289641663">
    


    <tbody><tr data-position="0">
      <td id="discussion-diff-289641663HL1577" data-line-number="..."></td>
      <td id="discussion-diff-289641663HR1577" data-line-number="..."></td>
      <td colspan="2">@@ -1578,7 +1578,9 @@ public static void Sort&lt;T&gt;(T[] array, int index, int length, System.Collections.</td>
    </tr>
    <tr>

        <td id="discussion-diff-289641663L1578" data-line-number="1578"></td>

        <td id="discussion-diff-289641663R1578" data-line-number="1578"></td>

      <td>
        <span>                    <span>return</span>;</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289641663L1579" data-line-number="1579"></td>

        <td id="discussion-diff-289641663R1579" data-line-number="1579"></td>

      <td>
        <span>                }</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289641663L1580" data-line-number="1580"></td>

        <td id="discussion-diff-289641663R1580" data-line-number="1580"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289641663L1581" data-line-number="1581"></td>

        <td></td>

      <td>
        <span>                <span>ArraySortHelper</span>&lt;<span>TKey</span>, <span>TValue</span>&gt;.<span>Default</span>.<span>Sort</span>(<span>keys</span>, <span>items</span>, <span>index</span>, <span>length</span>, <span>comparer</span>);</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289641663R1581" data-line-number="1581"></td>

      <td>
        <span>                <span>var</span> <span>spanKeys</span> <span>=</span> <span>new</span> <span>Span</span>&lt;<span>TKey</span>&gt;(<span>ref</span> <span>Unsafe</span>.<span>As</span>&lt;<span>byte</span>, <span>TKey</span>&gt;(<span>ref</span> <span>keys</span>.<span>GetRawArrayData</span>()), <span>keys</span>.<span>Length</span>);</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289641663R1582" data-line-number="1582"></td>

      <td>
        <span>                <span>var</span> <span>spanItems</span> <span>=</span> <span>new</span> <span>Span</span>&lt;<span>TValue</span>&gt;(<span>ref</span> <span>Unsafe</span>.<span>As</span>&lt;<span>byte</span>, <span>TValue</span>&gt;(<span>ref</span> <span>items</span><span>!</span>.<span>GetRawArrayData</span>()), <span>items</span><span>!</span>.<span>Length</span>); <span><span>//</span> TODO-NULLABLE: https://github.com/dotnet/csharplang/issues/538</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289641663" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MTY2Mw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MTY2Mw==/comments/review_comment">
    <div>
      

  

<details data-body-version="36249bb2e09fb5c2ca54acf611911a15">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="36249bb2e09fb5c2ca54acf611911a15" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289641663">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289641663-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289641663" id="discussion_r289641663-permalink">
                <relative-time datetime="2019-06-02T13:03:00Z" title="Jun 2, 2019, 6:03 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p>Nit: please change the comment to:</p>
<pre><code>// TODO-NULLABLE: Remove ! when [DoesNotReturn] respected
</code></pre>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654027" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDAyNw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDAyNw==/comments/review_comment">
    <div>
      

  

<details data-body-version="cec315e3d0975e5cc2811d5d8725f149">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="cec315e3d0975e5cc2811d5d8725f149" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654027">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654027-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mjgz">
  
      

<div>
  
<div id="pullrequestreview-244626283" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mjgz" data-channel="pull_request_review:244626283" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mjgz/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642370">
    


    <tbody><tr data-position="0">
      <td id="discussion-diff-289642370HL153" data-line-number="..."></td>
      <td id="discussion-diff-289642370HR151" data-line-number="..."></td>
      <td colspan="2">@@ -154,7 +152,8 @@ private static void SwapIfGreater(T[] keys, Comparison&lt;T&gt; comparer, int a, int b</td>
    </tr>
    <tr>

        <td id="discussion-diff-289642370L154" data-line-number="154"></td>

        <td id="discussion-diff-289642370R152" data-line-number="152"></td>

      <td>
        <span>            }</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289642370L155" data-line-number="155"></td>

        <td id="discussion-diff-289642370R153" data-line-number="153"></td>

      <td>
        <span>        }</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289642370L156" data-line-number="156"></td>

        <td id="discussion-diff-289642370R154" data-line-number="154"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-289642370L157" data-line-number="157"></td>

        <td></td>

      <td>
        <span>        <span>private</span> <span>static</span> <span>void</span> <span>Swap</span>(<span>T</span>[] <span>a</span>, <span>int</span> <span>i</span>, <span>int</span> <span>j</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642370R155" data-line-number="155"></td>

      <td>
        <span>        [<span>MethodImpl</span>(<span>MethodImplOptions</span>.<span>AggressiveInlining</span>)]</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642370" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjM3MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjM3MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="40c79c3b2cd13700b2982a5e660e3123">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="40c79c3b2cd13700b2982a5e660e3123" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642370">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642370-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289642370" id="discussion_r289642370-permalink">
                <relative-time datetime="2019-06-02T13:21:30Z" title="Jun 2, 2019, 6:21 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>If this was found to important on Swap, I'm curious that it wasn't found to be important on SwapIfGreater?  Is that because SwapIfGreater already wasn't getting inlined?</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289653926" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1MzkyNg==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1MzkyNg==/comments/review_comment">
    <div>
      

  

<details data-body-version="f1cd1d90088c83744dfe39a8d0b805d5">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="f1cd1d90088c83744dfe39a8d0b805d5" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289653926">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289653926-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289653926" id="discussion_r289653926-permalink">
                <relative-time datetime="2019-06-02T18:58:59Z" title="Jun 2, 2019, 11:58 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <blockquote>
<p>because SwapIfGreater already wasn't getting inlined?</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> yes. And depending on input <code>SwapIfGreater</code> is not called nearly as often. Depends a lot on specific input data "median of three killer sequence" would probably change that statement. There are plenty of things that can be done to improve the performance of existing sorting code, as my previous PRs did. Although, .NET Core has also moved since so some things might no longer be needed.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2MzU3">
  
      

<div>
  
<div id="pullrequestreview-244626357" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2MzU3" data-channel="pull_request_review:244626357" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2MzU3/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642439">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642439R1609" data-line-number="1609"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642439R1610" data-line-number="1610"></td>

      <td>
        <span>        <span><span>///</span> &lt;<span><span>summary</span></span>&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642439R1611" data-line-number="1611"></td>

      <td>
        <span>        <span><span>///</span> Sorts the elements in the entire &lt;<span><span>see</span></span> <span><span>cref</span></span>=<span><span>"</span>Span{T}<span>"</span></span> /&gt; </span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642439R1612" data-line-number="1612"></td>

      <td>
        <span>        <span><span>///</span> using the &lt;<span><span>see</span></span> <span><span>cref</span></span>=<span><span>"</span>IComparable<span>"</span></span> /&gt; implementation of each </span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642439" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQzOQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQzOQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="2afdad4aeeb133ad7ecea26217884f41">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="2afdad4aeeb133ad7ecea26217884f41" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642439">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642439-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289642439" id="discussion_r289642439-permalink">
                <relative-time datetime="2019-06-02T13:23:11Z" title="Jun 2, 2019, 6:23 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>Nit: This is going to link to the non-generic IComparable rather than the generic one.  Same for other occurrences.</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mzg1">
  
      

<div>
  
<div id="pullrequestreview-244626385" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mzg1" data-channel="pull_request_review:244626385" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Mzg1/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642460">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642460R1623" data-line-number="1623"></td>

      <td>
        <span>        <span><span>///</span> Sorts the elements in the entire &lt;<span><span>see</span></span> <span><span>cref</span></span>=<span><span>"</span>Span{T}<span>"</span></span> /&gt; </span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642460R1624" data-line-number="1624"></td>

      <td>
        <span>        <span><span>///</span> using the &lt;<span><span>typeparamref</span></span> <span><span>name</span></span>=<span><span>"</span>TComparer<span>"</span></span> /&gt;.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642460R1625" data-line-number="1625"></td>

      <td>
        <span>        <span><span>///</span> &lt;/<span><span>summary</span></span>&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642460R1626" data-line-number="1626"></td>

      <td>
        <span>        <span>public</span> <span>static</span> <span>void</span> <span>Sort</span>&lt;<span>T</span>, <span>TComparer</span>&gt;(<span>this</span> <span>Span</span>&lt;<span>T</span>&gt; <span>span</span>, <span>TComparer</span> <span>comparer</span>)</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642460" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQ2MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQ2MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="1bbafbac5ec6dd5d69c29d1b527b7414">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="1bbafbac5ec6dd5d69c29d1b527b7414" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642460">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642460-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>

        

<div id="discussion_r289642507" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjUwNw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjUwNw==/comments/review_comment">
    <div>
      

  

<details data-body-version="9139b067b9030a747e76841f10c3ed8b">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="9139b067b9030a747e76841f10c3ed8b" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642507">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642507-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289642507" id="discussion_r289642507-permalink">
                <relative-time datetime="2019-06-02T13:25:17Z" title="Jun 2, 2019, 6:25 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>Is this actually the desired / approved shape, having Sort be generic on both the T and the comparer type?</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289653872" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1Mzg3Mg==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1Mzg3Mg==/comments/review_comment">
    <div>
      

  

<details data-body-version="3c764e4ba1bc932c4c22294de47b2b13">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="3c764e4ba1bc932c4c22294de47b2b13" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289653872">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289653872-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289653872" id="discussion_r289653872-permalink">
                <relative-time datetime="2019-06-02T18:56:42Z" title="Jun 2, 2019, 11:56 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <blockquote>
<p>approved shape, having Sort be generic on both the T and the comparer type?</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> yes, this is the approved API. It was specifically designed to allow for value type comparers and hence specific code paths for that. Yes that means "code bloat" that is the purpose of it. :) In fact, it was a specific design goal of mine for the API after struggling for years with the restrictive and somewhat inconsistent <code>Array.Sort</code> API, where we have often had to simply  resort to put <code>stl::sort</code> in a native dll and interop to it, given we had native memory and a memory copy would be too expensive, and had specific sorting needs.</p>
<p>There already is specific code paths and "code bloat" for value types in current sorting code for <code>IComparable&lt;T&gt;</code> where <code>T : struct</code>, nothing new here, this simply adds orthogonality to it.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654040" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDA0MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDA0MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="e15581520eae2a93ce46597cf88ea617">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="e15581520eae2a93ce46597cf88ea617" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654040">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654040-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654040" id="discussion_r289654040-permalink">
                <relative-time datetime="2019-06-02T19:01:43Z" title="Jun 2, 2019, 12:01 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <div>
            <blockquote>
<p>It was specifically designed to allow for value type comparers and hence specific code paths for that</p>
</blockquote>
<p>Is that really a common case?  This implementation also doesn't appear to be benefiting from that at all, and worse, hides the fact that it's allocating.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654419" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDQxOQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDQxOQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="e986d1908bdc411361bdc6f4ef1834cd">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="e986d1908bdc411361bdc6f4ef1834cd" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654419">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654419-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654419" id="discussion_r289654419-permalink">
                <relative-time datetime="2019-06-02T19:15:04Z" title="Jun 2, 2019, 12:15 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <blockquote>
<p>Is that really a common case?</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> in my view yes. I have seen enough <code>Array.Reverse</code> too. In my view there is no downside to this, most users will simply use <code>Sort()</code> or <code>Sort((x, y) =&gt; x.CompareTo(y))</code>, advanced users who need this can use the value type comparer.</p>
<blockquote>
<p>doesn't appear to be benefiting from that at all, and worse, hides the fact that it's allocating.</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> we agreed to do this step wise. One step at a time. I intend to fix this in later PRs, this will require code duplication etc.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



        

<div id="discussion_r289654497" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDQ5Nw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDQ5Nw==/comments/review_comment">
    <div>
      

  

<details data-body-version="e99192ebd93dc703d5c22eae9a64b044">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="e99192ebd93dc703d5c22eae9a64b044" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654497">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654497-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654497" id="discussion_r289654497-permalink">
                <relative-time datetime="2019-06-02T19:17:45Z" title="Jun 2, 2019, 12:17 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> note that <code>Array.Sort</code> already does allocs for a custom comparer, converting it to <code>Comparison&lt;T&gt;</code>. I have noted this before and shown this in benchmarks. Can't run the latest ones now since I can't build coreclr anymore.</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654550" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDU1MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDU1MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="5dadc59d533cbbed763cdf087b333cbf">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="5dadc59d533cbbed763cdf087b333cbf" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654550">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654550-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="28" width="28" alt="@jkotas" src="https://avatars2.githubusercontent.com/u/6668460?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">jkotas</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654550" id="discussion_r289654550-permalink">
                <relative-time datetime="2019-06-02T19:19:37Z" title="Jun 2, 2019, 12:19 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <div>
            <p>I think it would be best to omit this shape of the API from this step.</p>
<p>The value prop of this special API is better performance. If the implementation does not actually provide better performance, it is just going to cause confusion.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDA4">
  
      

<div>
  
<div id="pullrequestreview-244626408" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDA4" data-channel="pull_request_review:244626408" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDA4/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642480">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642480R1617" data-line-number="1617"></td>

      <td>
        <span>        <span><span>///</span> One or more elements do not implement the &lt;<span><span>see</span></span> <span><span>cref</span></span>=<span><span>"</span>IComparable<span>"</span></span> /&gt; interface.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642480R1618" data-line-number="1618"></td>

      <td>
        <span>        <span><span>///</span> &lt;/<span><span>exception</span></span>&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642480R1619" data-line-number="1619"></td>

      <td>
        <span>        <span>public</span> <span>static</span> <span>void</span> <span>Sort</span>&lt;<span>T</span>&gt;(<span>this</span> <span>Span</span>&lt;<span>T</span>&gt; <span>span</span>) <span>=&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642480R1620" data-line-number="1620"></td>

      <td>
        <span>            <span>Sort</span>(<span>span</span>, (<span>IComparer</span>&lt;<span>T</span>&gt;)<span>null</span><span>!</span>);</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642480" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQ4MA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjQ4MA==/comments/review_comment">
    <div>
      

  

<details data-body-version="9cf0ea7e8b6f44c99342d21316fb2524">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="9cf0ea7e8b6f44c99342d21316fb2524" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642480">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642480-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>

        

<div id="discussion_r289643904" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MzkwNA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MzkwNA==/comments/review_comment">
    <div>
      

  

<details data-body-version="9a41e12f97811ffb2ad8b8d1b69ba934">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="9a41e12f97811ffb2ad8b8d1b69ba934" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289643904">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289643904-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDcz">
  
      

<div>
  
<div id="pullrequestreview-244626473" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDcz" data-channel="pull_request_review:244626473" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDcz/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642544">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642544R1648" data-line-number="1648"></td>

      <td>
        <span>                <span>ThrowHelper</span>.<span>ThrowArgumentNullException</span>(<span>ExceptionArgument</span>.<span>comparison</span>);</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642544R1649" data-line-number="1649"></td>

      <td>
        <span>            <span>if</span> (<span>span</span>.<span>Length</span> <span>&gt;</span> <span>1</span>)</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642544R1650" data-line-number="1650"></td>

      <td>
        <span>            {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642544R1651" data-line-number="1651"></td>

      <td>
        <span>                <span>ArraySortHelper</span>&lt;<span>T</span>&gt;.<span>Sort</span>(<span>span</span>, <span>0</span>, <span>span</span>.<span>Length</span>, <span>comparison</span><span>!</span>); <span><span>//</span> TODO-NULLABLE: https://github.com/dotnet/csharplang/issues/538</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642544" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU0NA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU0NA==/comments/review_comment">
    <div>
      

  

<details data-body-version="f58c4612479b518be47f59c0115544be">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="f58c4612479b518be47f59c0115544be" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642544">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642544-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDc4">
  
      

<div>
  
<div id="pullrequestreview-244626478" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDc4" data-channel="pull_request_review:244626478" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDc4/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        



</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDk2">
  
      

<div>
  
<div id="pullrequestreview-244626496" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDk2" data-channel="pull_request_review:244626496" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NDk2/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642573">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642573R1661" data-line-number="1661"></td>

      <td>
        <span>        <span><span>///</span> element of the &lt;<span><span>see</span></span> <span><span>cref</span></span>= <span><span>"</span>Span{TKey}<span>"</span></span>/&gt;.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642573R1662" data-line-number="1662"></td>

      <td>
        <span>        <span><span>///</span> &lt;/<span><span>summary</span></span>&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642573R1663" data-line-number="1663"></td>

      <td>
        <span>        <span>public</span> <span>static</span> <span>void</span> <span>Sort</span>&lt;<span>TKey</span>, <span>TValue</span>&gt;(<span>this</span> <span>Span</span>&lt;<span>TKey</span>&gt; <span>keys</span>, <span>Span</span>&lt;<span>TValue</span>&gt; <span>items</span>) <span>=&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642573R1664" data-line-number="1664"></td>

      <td>
        <span>            <span>Sort</span>(<span>keys</span>, <span>items</span>, (<span>IComparer</span>&lt;<span>TKey</span>&gt;)<span>null</span><span>!</span>);</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642573" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU3Mw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU3Mw==/comments/review_comment">
    <div>
      

  

<details data-body-version="1fb1eb72dec82368eb82e47da2e9be9b">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="1fb1eb72dec82368eb82e47da2e9be9b" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642573">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642573-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTEw">
  
      

<div>
  
<div id="pullrequestreview-244626510" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTEw" data-channel="pull_request_review:244626510" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTEw/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642582">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642582R1671" data-line-number="1671"></td>

      <td>
        <span>        <span><span>///</span> using the &lt;<span><span>typeparamref</span></span> <span><span>name</span></span>=<span><span>"</span>TComparer<span>"</span></span> /&gt;.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642582R1672" data-line-number="1672"></td>

      <td>
        <span>        <span><span>///</span> &lt;/<span><span>summary</span></span>&gt;</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642582R1673" data-line-number="1673"></td>

      <td>
        <span>        <span>public</span> <span>static</span> <span>void</span> <span>Sort</span>&lt;<span>TKey</span>, <span>TValue</span>, <span>TComparer</span>&gt;(<span>this</span> <span>Span</span>&lt;<span>TKey</span>&gt; <span>keys</span>,</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642582R1674" data-line-number="1674"></td>

      <td>
        <span>            <span>Span</span>&lt;<span>TValue</span>&gt; <span>items</span>, <span>TComparer</span> <span>comparer</span>)</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642582" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU4Mg==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU4Mg==/comments/review_comment">
    <div>
      

  

<details data-body-version="761f21d2af1fbcda8ec63309de6249b8">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="761f21d2af1fbcda8ec63309de6249b8" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642582">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642582-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTI0">
  
      

<div>
  
<div id="pullrequestreview-244626524" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTI0" data-channel="pull_request_review:244626524" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NTI0/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642597">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642597R1708" data-line-number="1708"></td>

      <td>
        <span>            {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642597R1709" data-line-number="1709"></td>

      <td>
        <span>                <span><span>//</span> TODO: Add Comparison&lt;T&gt; overload that is not available in existing Sort code.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642597R1710" data-line-number="1710"></td>

      <td>
        <span>                <span><span>//</span>       Hence Comparison&lt;T&gt; is wrapped in ComparisonComparer&lt;T&gt; for now.</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642597R1711" data-line-number="1711"></td>

      <td>
        <span>                <span>var</span> <span>comparisonComparer</span> <span>=</span> <span>new</span> <span>ComparisonComparer</span>&lt;<span>TKey</span>&gt;(<span>comparison</span><span>!</span>); <span><span>//</span> TODO-NULLABLE: https://github.com/dotnet/csharplang/issues/538</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642597" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU5Nw==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjU5Nw==/comments/review_comment">
    <div>
      

  

<details data-body-version="3d4929137a1fe10f85884983b9a387d3">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="3d4929137a1fe10f85884983b9a387d3" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642597">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642597-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NjU0">
  
      

<div>
  
<div id="pullrequestreview-244626654" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NjU0" data-channel="pull_request_review:244626654" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2NjU0/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642714">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642714R1633" data-line-number="1633"></td>

      <td>
        <span>                <span><span>//</span> might differ in both performance and sorting for equal keys</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642714R1634" data-line-number="1634"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642714R1635" data-line-number="1635"></td>

      <td>
        <span>                <span><span>//</span> TODO: Add TComparer support until then value type comparers will be boxed</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642714R1636" data-line-number="1636"></td>

      <td>
        <span>                <span><span>//</span>       and performance will be affected</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642714" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjcxNA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjcxNA==/comments/review_comment">
    <div>
      

  

<details data-body-version="491fd397469b86ac4a03e1d32b197ec8">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="491fd397469b86ac4a03e1d32b197ec8" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642714">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642714-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289642714" id="discussion_r289642714-permalink">
                <relative-time datetime="2019-06-02T13:30:35Z" title="Jun 2, 2019, 6:30 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>This is a TODO for when... as part of this PR, or subsequently?  If subsequently, please make sure there's an open issue for it and include the issue # here in the TODO.  But this also contributes to my question about whether the TComparer needs to be generic.</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Njk0">
  
      

<div>
  
<div id="pullrequestreview-244626694" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Njk0" data-channel="pull_request_review:244626694" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MjQ0NjI2Njk0/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-289642736">
    


    <tbody><tr>

        <td></td>

        <td id="discussion-diff-289642736R1681" data-line-number="1681"></td>

      <td>
        <span>            {</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642736R1682" data-line-number="1682"></td>

      <td>
        <span>                <span><span>//</span> Span based Sort does not call `TrySZSort`, but instead</span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642736R1683" data-line-number="1683"></td>

      <td>
        <span>                <span><span>//</span> uses the managed generic code only. This means Span based Sort </span></span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-289642736R1684" data-line-number="1684"></td>

      <td>
        <span>                <span><span>//</span> might differ in both performance and sorting for equal keys</span></span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r289642736" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjczNg==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY0MjczNg==/comments/review_comment">
    <div>
      

  

<details data-body-version="3a52c5fe602f929835d1538e5aee8ace">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="3a52c5fe602f929835d1538e5aee8ace" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289642736">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289642736-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="28" width="28" alt="@stephentoub" src="https://avatars3.githubusercontent.com/u/2642209?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">stephentoub</a>
  

          </strong>
          <span>

              <a href="#discussion_r289642736" id="discussion_r289642736-permalink">
                <relative-time datetime="2019-06-02T13:31:23Z" title="Jun 2, 2019, 6:31 AM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        
        
    <p><span aria-label="This user is a member of the .NET Platform organization.">
      Member
    </span></p><task-lists disabled="" sortable="">
          <p>It shouldn't affect this PR, but have you measure to see what the difference is between an array-based sort that does use TrySZSort and a span-based sort that doesn't?  How far off are they?</p>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654295" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDI5NQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDI5NQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="1a8b42c41017b6eaa82edbe044fa0e57">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="1a8b42c41017b6eaa82edbe044fa0e57" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654295">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654295-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654295" id="discussion_r289654295-permalink">
                <relative-time datetime="2019-06-02T19:10:52Z" title="Jun 2, 2019, 12:10 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> comparing <code>int</code> vs <code>IntStruct</code> can indicate this (showing the reverse in this case).</p>

<table>
<thead>
<tr>
<th>Method</th>
<th>Toolchain</th>
<th>Size</th>
<th>Mean</th>
<th>Error</th>
<th>StdDev</th>
<th>Median</th>
<th>Min</th>
<th>Max</th>
<th>Ratio</th>
<th>RatioSD</th>
<th>Gen 0/1k Op</th>
<th>Gen 1/1k Op</th>
<th>Gen 2/1k Op</th>
<th>Allocated Memory/Op</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>\coreclr-base</td>
<td>512</td>
<td>5.665 us</td>
<td>0.0367 us</td>
<td>0.0343 us</td>
<td>5.670 us</td>
<td>5.608 us</td>
<td>5.725 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array</td>
<td>\coreclr</td>
<td>512</td>
<td>5.697 us</td>
<td>0.0393 us</td>
<td>0.0368 us</td>
<td>5.693 us</td>
<td>5.636 us</td>
<td>5.779 us</td>
<td>1.01</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>Method</th>
<th>Toolchain</th>
<th>Size</th>
<th>Mean</th>
<th>Error</th>
<th>StdDev</th>
<th>Median</th>
<th>Min</th>
<th>Max</th>
<th>Ratio</th>
<th>RatioSD</th>
<th>Gen 0/1k Op</th>
<th>Gen 1/1k Op</th>
<th>Gen 2/1k Op</th>
<th>Allocated Memory/Op</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>\coreclr-base\</td>
<td>512</td>
<td>3.785 us</td>
<td>0.1062 us</td>
<td>0.1222 us</td>
<td>3.714 us</td>
<td>3.684 us</td>
<td>4.021 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array</td>
<td>\coreclr\</td>
<td>512</td>
<td>3.641 us</td>
<td>0.0299 us</td>
<td>0.0280 us</td>
<td>3.646 us</td>
<td>3.581 us</td>
<td>3.701 us</td>
<td>0.96</td>
<td>0.03</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Quite a difference here in favor of the managed code path.</p>
<p>Note that this is not just about perf, native sorting code does a <code>NaNPrepass</code> (if I remember correctly) for floats, that the span version would then not do.</p>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654328" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDMyOA==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDMyOA==/comments/review_comment">
    <div>
      

  

<details data-body-version="b48bc845bd5bbc508b6da5a8de32f747">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="b48bc845bd5bbc508b6da5a8de32f747" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654328">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654328-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289654328" id="discussion_r289654328-permalink">
                <relative-time datetime="2019-06-02T19:11:52Z" title="Jun 2, 2019, 12:11 PM PDT">on Jun 2, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <p>Above is for</p>
<div><pre><span>BenchmarkDotNet</span>=v0.11.3.1003-nightly, <span>OS</span>=Windows 10.0.17763.503 (1809/October2018Update/Redstone5)
Intel Core i7-8700 CPU 3.20GHz (Coffee Lake), 1 CPU, 12 logical and 6 physical cores
.NET Core <span>SDK</span>=3.0.100-preview5-011568
  [Host]     : .NET Core 3.0.0-preview5-27626-15 (CoreCLR 4.6.27622.75, CoreFX 4.700.19.22408), 64bit RyuJIT
  Job-JTKJDV : .NET Core ? (CoreCLR 4.6.27803.0, CoreFX 4.700.19.22901), 64bit RyuJIT
  Job-DBBNCI : .NET Core ? (CoreCLR 4.6.27808.0, CoreFX 4.700.19.22901), 64bit RyuJIT

<span>Runtime</span>=Core  <span>InvocationCount</span>=10000  <span>IterationTime</span>=250.0000 ms  
<span>MaxIterationCount</span>=20  <span>MinIterationCount</span>=15  <span>UnrollFactor</span>=1  
<span>WarmupCount</span>=1  
</pre></div>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>

        

<div id="discussion_r289654611" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDYxMQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTY1NDYxMQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="5714f3e9c2ceca3b4d6651c1f93b3980">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="5714f3e9c2ceca3b4d6651c1f93b3980" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289654611">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289654611-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>

        

<div id="discussion_r289800215" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTgwMDIxNQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDI4OTgwMDIxNQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="d347d16adcbc7fa2982ca0ba4d54bf5f">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="d347d16adcbc7fa2982ca0ba4d54bf5f" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r289800215">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r289800215-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="28" width="28" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4"></a>
      </span></p><div data-thread-side="right">
        <h4>
          <strong>
              

  <a show_full_name="false" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">nietras</a>
  

          </strong>
          <span>

              <a href="#discussion_r289800215" id="discussion_r289800215-permalink">
                <relative-time datetime="2019-06-03T11:30:28Z" title="Jun 3, 2019, 4:30 AM PDT">on Jun 3, 2019</relative-time>
              </a>

          </span>
        </h4>

        <p><span aria-label="This user is the author of this pull request.">
  Author
</span></p><task-lists disabled="" sortable="">
          <div>
            <p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> after merging with master I have rerun the benchmarks with higher invocation count (25000). This is more inline with what I expected with regards to native (<code>int</code>) vs managed code (<code>IntStruct</code>). native being a bit faster with the caveats that this is based on using <code>IntStruct</code> as a replacement for <code>int</code>.</p>
<p>coreclr-base = <a data-hovercard-type="commit" data-hovercard-url="https://github.com/dotnet/coreclr/commit/5af77fa0dcc99abb3c9610f1a062493ddc2e0584/hovercard" href="https://github.com/dotnet/coreclr/commit/5af77fa0dcc99abb3c9610f1a062493ddc2e0584"><tt>5af77fa</tt></a> (master)<br>
coreclr = <a data-hovercard-type="commit" data-hovercard-url="https://github.com/dotnet/coreclr/commit/11dd34a67f2a78b46dabc921e32ba63731057d63/hovercard" href="https://github.com/dotnet/coreclr/commit/11dd34a67f2a78b46dabc921e32ba63731057d63"><tt>11dd34a</tt></a> (from this PR branch)</p>

<div><pre><span>BenchmarkDotNet</span>=v0.11.3.1003-nightly, <span>OS</span>=Windows 10.0.17763.503 (1809/October2018Update/Redstone5)
Intel Core i7-8700 CPU 3.20GHz (Coffee Lake), 1 CPU, 12 logical and 6 physical cores
.NET Core <span>SDK</span>=3.0.100-preview5-011568
  [Host]     : .NET Core 3.0.0-preview5-27626-15 (CoreCLR 4.6.27622.75, CoreFX 4.700.19.22408), 64bit RyuJIT
  Job-VKBMMT : .NET Core ? (CoreCLR 4.700.19.30301, CoreFX 4.700.19.27908), 64bit RyuJIT
  Job-SABOCD : .NET Core ? (CoreCLR 4.700.19.30301, CoreFX 4.700.19.27908), 64bit RyuJIT

<span>Runtime</span>=Core  <span>InvocationCount</span>=25000  <span>IterationTime</span>=250.0000 ms  
<span>MaxIterationCount</span>=20  <span>MinIterationCount</span>=15  <span>UnrollFactor</span>=1  
<span>WarmupCount</span>=1  
</pre></div>
<table>
<thead>
<tr>
<th>Method</th>
<th></th>
<th>Size</th>
<th>Mean</th>
<th>Error</th>
<th>StdDev</th>
<th>Median</th>
<th>Min</th>
<th>Max</th>
<th>Ratio</th>
<th>RatioSD</th>
<th>Gen 0/1k Op</th>
<th>Gen 1/1k Op</th>
<th>Gen 2/1k Op</th>
<th>Allocated Memory/Op</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>\coreclr-base</td>
<td>512</td>
<td>3.495 us</td>
<td>0.1296 us</td>
<td>0.1387 us</td>
<td>3.469 us</td>
<td>3.323 us</td>
<td>3.753 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array</td>
<td>\coreclr</td>
<td>512</td>
<td>3.640 us</td>
<td>0.2213 us</td>
<td>0.2460 us</td>
<td>3.573 us</td>
<td>3.317 us</td>
<td>4.222 us</td>
<td>1.05</td>
<td>0.08</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_ComparerClass</td>
<td>\coreclr-base</td>
<td>512</td>
<td>19.367 us</td>
<td>0.1069 us</td>
<td>0.0948 us</td>
<td>19.357 us</td>
<td>19.207 us</td>
<td>19.560 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>64 B</td>
</tr>
<tr>
<td>Array_ComparerClass</td>
<td>\coreclr</td>
<td>512</td>
<td>19.474 us</td>
<td>0.1196 us</td>
<td>0.1060 us</td>
<td>19.452 us</td>
<td>19.321 us</td>
<td>19.695 us</td>
<td>1.01</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>64 B</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_ComparerStruct</td>
<td>\coreclr-base</td>
<td>512</td>
<td>22.870 us</td>
<td>0.1593 us</td>
<td>0.1490 us</td>
<td>22.820 us</td>
<td>22.696 us</td>
<td>23.192 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>88 B</td>
</tr>
<tr>
<td>Array_ComparerStruct</td>
<td>\coreclr</td>
<td>512</td>
<td>23.718 us</td>
<td>0.0634 us</td>
<td>0.0593 us</td>
<td>23.709 us</td>
<td>23.614 us</td>
<td>23.859 us</td>
<td>1.04</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>88 B</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_Comparison</td>
<td>\coreclr-base</td>
<td>512</td>
<td>18.615 us</td>
<td>0.0971 us</td>
<td>0.0861 us</td>
<td>18.598 us</td>
<td>18.519 us</td>
<td>18.826 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array_Comparison</td>
<td>\coreclr</td>
<td>512</td>
<td>19.760 us</td>
<td>0.2582 us</td>
<td>0.2415 us</td>
<td>19.647 us</td>
<td>19.556 us</td>
<td>20.369 us</td>
<td>1.06</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>\coreclr-base</td>
<td>512</td>
<td>3.385 us</td>
<td>0.0916 us</td>
<td>0.0980 us</td>
<td>3.335 us</td>
<td>3.298 us</td>
<td>3.607 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>List</td>
<td>\coreclr</td>
<td>512</td>
<td>3.759 us</td>
<td>0.4917 us</td>
<td>0.5465 us</td>
<td>3.534 us</td>
<td>3.279 us</td>
<td>5.224 us</td>
<td>1.10</td>
<td>0.17</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<div><pre><span>BenchmarkDotNet</span>=v0.11.3.1003-nightly, <span>OS</span>=Windows 10.0.17763.503 (1809/October2018Update/Redstone5)
Intel Core i7-8700 CPU 3.20GHz (Coffee Lake), 1 CPU, 12 logical and 6 physical cores
.NET Core <span>SDK</span>=3.0.100-preview5-011568
  [Host]     : .NET Core 3.0.0-preview5-27626-15 (CoreCLR 4.6.27622.75, CoreFX 4.700.19.22408), 64bit RyuJIT
  Job-VKBMMT : .NET Core ? (CoreCLR 4.700.19.30301, CoreFX 4.700.19.27908), 64bit RyuJIT
  Job-SABOCD : .NET Core ? (CoreCLR 4.700.19.30301, CoreFX 4.700.19.27908), 64bit RyuJIT

<span>Runtime</span>=Core  <span>InvocationCount</span>=25000  <span>IterationTime</span>=250.0000 ms  
<span>MaxIterationCount</span>=20  <span>MinIterationCount</span>=15  <span>UnrollFactor</span>=1  
<span>WarmupCount</span>=1  
</pre></div>
<table>
<thead>
<tr>
<th>Method</th>
<th></th>
<th>Size</th>
<th>Mean</th>
<th>Error</th>
<th>StdDev</th>
<th>Median</th>
<th>Min</th>
<th>Max</th>
<th>Ratio</th>
<th>RatioSD</th>
<th>Gen 0/1k Op</th>
<th>Gen 1/1k Op</th>
<th>Gen 2/1k Op</th>
<th>Allocated Memory/Op</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>\coreclr-base</td>
<td>512</td>
<td>3.729 us</td>
<td>0.0498 us</td>
<td>0.0416 us</td>
<td>3.731 us</td>
<td>3.635 us</td>
<td>3.786 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array</td>
<td>\coreclr</td>
<td>512</td>
<td>3.925 us</td>
<td>0.2357 us</td>
<td>0.2522 us</td>
<td>3.913 us</td>
<td>3.654 us</td>
<td>4.505 us</td>
<td>1.07</td>
<td>0.08</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_ComparerClass</td>
<td>\coreclr-base</td>
<td>512</td>
<td>20.788 us</td>
<td>0.0535 us</td>
<td>0.0474 us</td>
<td>20.782 us</td>
<td>20.669 us</td>
<td>20.867 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>64 B</td>
</tr>
<tr>
<td>Array_ComparerClass</td>
<td>\coreclr</td>
<td>512</td>
<td>21.212 us</td>
<td>0.0889 us</td>
<td>0.0788 us</td>
<td>21.192 us</td>
<td>21.101 us</td>
<td>21.398 us</td>
<td>1.02</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>64 B</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_ComparerStruct</td>
<td>\coreclr-base</td>
<td>512</td>
<td>23.963 us</td>
<td>0.0966 us</td>
<td>0.0856 us</td>
<td>23.949 us</td>
<td>23.830 us</td>
<td>24.183 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>88 B</td>
</tr>
<tr>
<td>Array_ComparerStruct</td>
<td>\coreclr</td>
<td>512</td>
<td>22.890 us</td>
<td>0.1253 us</td>
<td>0.1047 us</td>
<td>22.894 us</td>
<td>22.684 us</td>
<td>23.034 us</td>
<td>0.96</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>88 B</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Array_Comparison</td>
<td>\coreclr-base</td>
<td>512</td>
<td>20.161 us</td>
<td>0.1313 us</td>
<td>0.1164 us</td>
<td>20.157 us</td>
<td>19.995 us</td>
<td>20.401 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array_Comparison</td>
<td>\coreclr</td>
<td>512</td>
<td>21.104 us</td>
<td>0.0972 us</td>
<td>0.0910 us</td>
<td>21.101 us</td>
<td>20.995 us</td>
<td>21.292 us</td>
<td>1.05</td>
<td>0.01</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>List</td>
<td>\coreclr-base</td>
<td>512</td>
<td>4.891 us</td>
<td>1.0011 us</td>
<td>1.1528 us</td>
<td>4.679 us</td>
<td>3.741 us</td>
<td>7.906 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>List</td>
<td>\coreclr</td>
<td>512</td>
<td>4.047 us</td>
<td>0.1858 us</td>
<td>0.1988 us</td>
<td>4.076 us</td>
<td>3.765 us</td>
<td>4.503 us</td>
<td>0.84</td>
<td>0.17</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
          </div>
        </task-lists>


          



      </div>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOjY2MDQ0ZDdjZDc3NzgwNmU0YzY3YjU1YzMzY2Q3OTFkMGNkY2E0NWY=">
  
      <div>
    
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:66044d7cd777806e4c67b55c33cd791d0cdca45f" data-url="/dotnet/coreclr/pull/24419/commits/66044d7cd777806e4c67b55c33cd791d0cdca45f/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:1c1e87791bab591cc5554cdae82a093e96e09558" data-url="/dotnet/coreclr/pull/24419/commits/1c1e87791bab591cc5554cdae82a093e96e09558/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODA1OTE5MA==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODA1OTE5MA==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5ODA1OTE5MA==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-498059190">
    <div>
      

  

<details data-body-version="4d82d235d55bef1296833a96bee7b967">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="4d82d235d55bef1296833a96bee7b967" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>The name 'MethodImplOptions' does not exist in the current context</p>
</blockquote>
<p>Are you missing <code>using System.Runtime.CompilerServices;</code>?</p>
<blockquote>
<p>I also have problems building locally after merging with master.</p>
</blockquote>
<p>You can try deleting <code>%USERPROFILE%\.dotnet</code>, <code>%USERPROFILE%\.netcoreeng</code> and <code>%USERPROFILE%\.nuget</code>. The build system started caching stuff in these global locations recently, and things fail in cryptic ways when these cached bits are corrupted.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0Q29tbWl0Mjc2MjkwMDkyOjQ3ODYzMmUxZWYyNTlhNDdjZmNhYTllYTMyMDc4NzdiMGYxOGFmYWM=">
  
      <div>
    
  <div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:478632e1ef259a47cfcaa9ea3207877b0f18afac" data-url="/dotnet/coreclr/pull/24419/commits/478632e1ef259a47cfcaa9ea3207877b0f18afac/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
      <div>
        
        <div>
          

<div data-channel="repo:30092893:commit:11dd34a67f2a78b46dabc921e32ba63731057d63" data-url="/dotnet/coreclr/pull/24419/commits/11dd34a67f2a78b46dabc921e32ba63731057d63/_render_node/commit/pull_condensed">
  <div>
      
<div>
  <p><a data-skip-pjax="true" data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras">
          <img height="20" width="20" alt="@nietras" src="https://avatars3.githubusercontent.com/u/10798831?s=60&amp;v=4">
</a>  </p>
</div>


    

    

    

    
  </div>
</div>


        </div>
      </div>
  </div>
</div>


</div>

    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODIyNzE0MQ==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDQ5ODIyNzE0MQ==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDQ5ODIyNzE0MQ==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-498227141">
    <div>
      

  

<details data-body-version="cc4b0b85a61410a06bbeef510768ee2c">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="cc4b0b85a61410a06bbeef510768ee2c" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas">@jkotas</a> <a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> added a gist with the latest benchmark run (without string).</p>
<p><a rel="nofollow" href="https://gist.github.com/nietras/c206d4a7d9f173cc9271eabc8d01b1e6">https://gist.github.com/nietras/c206d4a7d9f173cc9271eabc8d01b1e6</a></p>
<p>This is for:</p>
<p>coreclr-base = <a data-hovercard-type="commit" data-hovercard-url="https://github.com/dotnet/coreclr/commit/5af77fa0dcc99abb3c9610f1a062493ddc2e0584/hovercard" href="https://github.com/dotnet/coreclr/commit/5af77fa0dcc99abb3c9610f1a062493ddc2e0584"><tt>5af77fa</tt></a> (master)<br>
coreclr = <a data-hovercard-type="commit" data-hovercard-url="https://github.com/dotnet/coreclr/commit/11dd34a67f2a78b46dabc921e32ba63731057d63/hovercard" href="https://github.com/dotnet/coreclr/commit/11dd34a67f2a78b46dabc921e32ba63731057d63"><tt>11dd34a</tt></a> (from this PR branch)</p>
<p>Notably, <code>BigStruct</code> sees some big improvements when switching to <code>Span&lt;T&gt;</code>. Perhaps, indicating that swapping is inlined here and not for the old code without <code>AggressiveInlining</code>.</p>
<table>
<thead>
<tr>
<th>Method</th>
<th></th>
<th>Size</th>
<th>Mean</th>
<th>Error</th>
<th>StdDev</th>
<th>Median</th>
<th>Min</th>
<th>Max</th>
<th>Ratio</th>
<th>RatioSD</th>
<th>Gen 0/1k Op</th>
<th>Gen 1/1k Op</th>
<th>Gen 2/1k Op</th>
<th>Allocated Memory/Op</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>\coreclr-base\</td>
<td>512</td>
<td>11.964 us</td>
<td>0.3498 us</td>
<td>0.3743 us</td>
<td>11.769 us</td>
<td>11.610 us</td>
<td>13.004 us</td>
<td>1.00</td>
<td>0.00</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Array</td>
<td>\coreclr\</td>
<td>512</td>
<td>8.234 us</td>
<td>0.0504 us</td>
<td>0.0472 us</td>
<td>8.245 us</td>
<td>8.159 us</td>
<td>8.310 us</td>
<td>0.69</td>
<td>0.02</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><code>IntClass</code> appears to regress by about 3-4%. <code>IntStruct</code> is probably within variance but there are 8% regressions with the 25000 invocations per iteration, but then <code>List</code> is 16% faster so there is no doubt some variance here for these. <code>int</code> sees minor regressions too, which of course makes no sense, since code is the same when running default.</p>
<p>I'll try to run it with more invocations later at some point.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTUwODA2Mg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTUwODA2Mg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTUwODA2Mg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549508062">
    <div>
      

  

<details data-body-version="8d3652c86b19140387798d7890889485">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8d3652c86b19140387798d7890889485" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <p>I'm taking a look at fixing this up.</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  
<div data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzExMzgwOTMx">
  
      

<div>
  
<div id="pullrequestreview-311380931" data-gid="MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzExMzgwOTMx" data-channel="pull_request_review:311380931" data-url="/_render_node/MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzExMzgwOTMx/pull_request_reviews/body">

  <div>
    
<p><a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="40" width="40" alt="@jkotas" src="https://avatars3.githubusercontent.com/u/6668460?s=88&amp;v=4"></a>

</p>


    


    


  </div>
</div>

  
        
<div>
  <div>
        



<div>
  
      
  
<div>
  <table id="discussion-diff-342287341">
    


    <tbody><tr data-position="0">
      <td id="discussion-diff-342287341HL1577" data-line-number="..."></td>
      <td id="discussion-diff-342287341HR1577" data-line-number="..."></td>
      <td colspan="2">@@ -1578,7 +1578,9 @@ public static void Sort&lt;T&gt;(T[] array, int index, int length, System.Collections.</td>
    </tr>
    <tr>

        <td id="discussion-diff-342287341L1578" data-line-number="1578"></td>

        <td id="discussion-diff-342287341R1578" data-line-number="1578"></td>

      <td>
        <span>                    <span>return</span>;</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-342287341L1579" data-line-number="1579"></td>

        <td id="discussion-diff-342287341R1579" data-line-number="1579"></td>

      <td>
        <span>                }</span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-342287341L1580" data-line-number="1580"></td>

        <td id="discussion-diff-342287341R1580" data-line-number="1580"></td>

      <td>
        <span><br></span>

      </td>
    </tr>
    <tr>

        <td id="discussion-diff-342287341L1581" data-line-number="1581"></td>

        <td></td>

      <td>
        <span>                <span>ArraySortHelper</span>&lt;<span>TKey</span>, <span>TValue</span>&gt;.<span>Default</span>.<span>Sort</span>(<span>keys</span>, <span>items</span>, <span>index</span>, <span>length</span>, <span>comparer</span>);</span>

      </td>
    </tr>
    <tr>

        <td></td>

        <td id="discussion-diff-342287341R1581" data-line-number="1581"></td>

      <td>
        <span>                <span>var</span> <span>spanKeys</span> <span>=</span> <span>new</span> <span>Span</span>&lt;<span>TKey</span>&gt;(<span>ref</span> <span>Unsafe</span>.<span>As</span>&lt;<span>byte</span>, <span>TKey</span>&gt;(<span>ref</span> <span>keys</span>.<span>GetRawArrayData</span>()), <span>keys</span>.<span>Length</span>);</span>

      </td>
    </tr>

  </tbody></table>
</div>

<div>
  <div data-quote-markdown=".js-comment-body">
    <div>
        

<div id="discussion_r342287341" data-gid="MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjI4NzM0MQ==" data-url="/_render_node/MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM0MjI4NzM0MQ==/comments/review_comment">
    <div>
      

  

<details data-body-version="91fb866b9968535bfdae215f8ee13a3b">
    <summary>
      <div>
        <h3>
          
          <p>
                This comment has been minimized.

          </p>
        </h3>
        
      </div>
    </summary>
</details>


    </div>

  <div data-body-version="91fb866b9968535bfdae215f8ee13a3b" data-thread-side="right">
    <div>
      <p>
        <details id="details-discussion_r342287341">
          <summary aria-label="Show more options" aria-haspopup="menu" role="button">
            
          </summary>

          <details-menu role="menu">

            <clipboard-copy for="discussion_r342287341-permalink" role="menuitem" tabindex="0">
              Copy link
            </clipboard-copy>

            








          </details-menu>
        </details>
      </p>

      <p><span>
        <a data-hovercard-type="user" data-hovercard-url="/users/jkotas/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/jkotas"><img height="28" width="28" alt="@jkotas" src="https://avatars2.githubusercontent.com/u/6668460?s=60&amp;v=4"></a>
      </span></p>
    </div>

  </div>
</div>



    </div>

  </div>


</div>




</div>




  </div>
</div>


</div>

</div>

    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTcxNTQyMg==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU0OTcxNTQyMg==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU0OTcxNTQyMg==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/nietras/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/nietras"><img height="40" width="40" alt="@nietras" src="https://avatars2.githubusercontent.com/u/10798831?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-549715422">
    <div>
      

  

<details data-body-version="8b7aff067664db4888c0e01582cd831a">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  <div data-body-version="8b7aff067664db4888c0e01582cd831a" data-unfurl-hide-url="/content_reference_attachments/hide">
    


    <div>

      
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p>I'm taking a look at fixing this up.</p>
</blockquote>
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub">@stephentoub</a> sounds good :) It took a long time before the changes/fixes to benchmarks got added to <a href="https://github.com/dotnet/performance/">https://github.com/dotnet/performance/</a> and at that time I unfortunately did not have time to revisit this. Sorry about that. Let me know if you have any questions or need review or similar :)</p>
      </div>
</task-lists>


        



    </div>

  </div>
</div>


</div>


</div>


    
  


    
  
<div data-gid="MDEyOklzc3VlQ29tbWVudDU1MDEzODE4Ng==">
  
    
<div data-gid="MDEyOklzc3VlQ29tbWVudDU1MDEzODE4Ng==" data-url="/_render_node/MDEyOklzc3VlQ29tbWVudDU1MDEzODE4Ng==/timeline/issue_comment">

  
<p><a data-hovercard-type="user" data-hovercard-url="/users/stephentoub/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/stephentoub"><img height="40" width="40" alt="@stephentoub" src="https://avatars2.githubusercontent.com/u/2642209?s=88&amp;v=4"></a>

</p>


  
<div id="issuecomment-550138186">
    <div>
      

  

<details data-body-version="d346eade8363d394bc87ed5664e1e4f0">
    <summary>
      <div>
        <h3>
              This comment has been minimized.

        </h3>
        
      </div>
    </summary>
</details>


    </div>
  
</div>


</div>


</div>


    
  





<!-- Rendered timeline since 2019-11-05 20:28:45 -->



      </div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>