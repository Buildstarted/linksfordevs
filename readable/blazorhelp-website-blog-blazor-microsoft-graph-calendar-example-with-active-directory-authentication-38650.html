<!DOCTYPE html>
<html lang="en">
<head>
    <title>
BlazorHelp Website &gt; Blog - Blazor Microsoft Graph Calendar Example With Active Directory Authentication - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="BlazorHelp Website &gt; Blog - Blazor Microsoft Graph Calendar Example With Active Directory Authentication - linksfor.dev(s)"/>
    <meta property="article:author" content="Written by:&#xA;   Michael Washington"/>
    <meta property="og:description" content="Microsoft Visual Studio Blazor"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4358/Blazor-Microsoft-Graph-Calendar-Example-With-Active-Directory-Authentication.aspx"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - BlazorHelp Website &gt; Blog - Blazor Microsoft Graph Calendar Example With Active Directory Authentication</title>
<div class="readable">
        <h1>BlazorHelp Website &gt; Blog - Blazor Microsoft Graph Calendar Example With Active Directory Authentication</h1>
            <div>by Written by:&#xA;   Michael Washington</div>
            <div>Reading time: 21-27 minutes</div>
        <div>Posted here: 13 Oct 2019</div>
        <p><a href="http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4358/Blazor-Microsoft-Graph-Calendar-Example-With-Active-Directory-Authentication.aspx">http://blazorhelpwebsite.com/Blog/tabid/61/EntryId/4358/Blazor-Microsoft-Graph-Calendar-Example-With-Active-Directory-Authentication.aspx</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
 <!-- Begin Blog Entry Title -->
 
 <!-- End Blog Entry Title -->
 <!-- Begin Blog Sub Head -->
 <acronym title="10/12/2019 2:59 PM"><span>
  <span id="dnn_ctr382_MainView_ViewEntry_lblEntryMonth">Oct</span>
 </span><span>
  <span id="dnn_ctr382_MainView_ViewEntry_lblEntryDay">12</span>
 </span></acronym>
 <p>
  
  <br>
  <span id="dnn_ctr382_MainView_ViewEntry_lblDateTime">10/12/2019 2:59 PM</span>&nbsp;
  <a id="dnn_ctr382_MainView_ViewEntry_lnkRss" href="http://blazorhelpwebsite.com/Blog/tabid/61/rssid/1/Default.aspx" target="_blank"><img id="dnn_ctr382_MainView_ViewEntry_lnkRssIcon" src="http://blazorhelpwebsite.com/desktopmodules/Blog/Images/feed-icon-12x12.gif" alt="RssIcon"></a>
 </p>
 <!-- End Blog Sub Head -->
 
 <!-- Begin Blog Entry -->
 
   <p><img src="http://blazorhelpwebsite.com/images/BlazorGraphCalendar.gif"></p>  <p>You can easily access the <a href="https://developer.microsoft.com/en-us/graph">Microsoft Graph</a> with <a href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor">Blazor</a>, as well as use <a href="https://azure.microsoft.com/en-us/services/active-directory/">Microsoft Azure Active Directory</a> authentication.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_8665112a-9f5f-4dc8-bc36-5170c33ecb20.png" width="644" height="214"></p>  <p>When the application starts up, we have to click the <strong>Log in</strong> button to log in.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_25b626c5-5738-4fa8-a22f-a0cb0847021f.png" width="510" height="428"></p>  <p>We use an account in our <strong>Microsoft Office tenant</strong> to log in.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_aed02178-1da1-4b73-ae9a-fb9001501b58.png" width="678" height="359"></p>  <p>After we log in, our <strong>user name</strong> will display in the application header.</p>  <p>We can then navigate to the <strong>Calendars</strong> page.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_79475bb0-c778-4782-a953-a8d923bf0f58.png" width="463" height="505"></p>  <p>Finally, we can <strong>select a user</strong>, <strong>start and end</strong> <strong>dates</strong>, and click the <strong>Submit</strong> button to show the <strong>calendar events</strong> for the selected user during that period.</p>  <p><strong>Note:</strong> Even though we are logging in as a user, we are reading the calendars of the users using <strong><a href="https://docs.microsoft.com/en-us/graph/security-authorization">Application-level authorization</a></strong> not the logged in users permissions. This allows all users to see all calendars.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_f7ba5628-af2e-4fa6-85f8-c1ab87002d31.png" width="689" height="276"></p>  <p>To work with <strong>Calendars</strong>, you will need an <a href="https://docs.microsoft.com/en-us/office365/enterprise/subscriptions-licenses-accounts-and-tenants-for-microsoft-cloud-offerings">Office 365 tenant</a>. If you do not have one, you can go to: <a href="https://docs.microsoft.com/en-us/office/developer-program/office-365-developer-program">Welcome to the Office 365 Developer Program</a> for directions to sign up for one.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image87.png" width="690" height="450"></p>  <p>After you create the account, you will want to go to <a href="https://outlook.office365.com/calendar">https://outlook.office365.com/calendar</a> and log in and select the <strong>calendar</strong> and enter some <strong>calendar</strong> entries.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_d459341b-73d6-461a-ac19-6b7c03e2b3d4.png" width="85" height="95"></p>  <p>Open <strong>Visual Studio</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_1fce3f2d-2f05-48f3-952a-c05404081cf6.png" width="357" height="97"></p>  <p>Create a <strong>new Project</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_f9b77334-f24f-470e-aa7b-dda7533b297a.png" width="577" height="217"></p>  <p>Select <strong>Blazor App</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_0879a8e5-9f8e-40d8-bb8a-0390467bd3e4.png" width="639" height="456"></p>  <p>Name the project <strong>BlazorAzureActiveDirectory</strong>.</p>  <p>Click the <strong>Create</strong> button.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_285405e6-a871-448f-a711-afaccbb5d79d.png" width="669" height="443"></p>  <p>Select <strong>Blazor Server App</strong> then <strong>Change</strong> under <strong>Authentication</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_d001dae3-a016-48d3-8297-f656615b0e1e.png" width="713" height="333"></p>  <p>Select the options shown above.</p>  <p>For <strong>#3</strong> use the <strong>Office tenant</strong> you created in the earlier step.</p>  <p>Click the <strong>OK</strong> button.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_3f815a7e-1483-494e-bc96-71fabadbbb00.png" width="540" height="484"></p>  <p>You may be asked to sign in with the <strong>Global Administrator</strong> account you created.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image93.png" width="417" height="551"></p>  <p>Click <strong>Create</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_a0d91465-2f5d-446e-997b-7334b8d3e5fd.png" width="338" height="342"></p>  <p>The application will be created and open in <strong>Visual Studio</strong>.</p>        <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_c864dba8-a015-4f73-9dc1-7c84c6cc0446.png" width="182" height="37"></p>  <p>Using the account you created, log into <a href="https://portal.azure.com/">https://portal.azure.com/</a> and select the <strong>Azure Active Directory</strong> node.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_7c10c977-6311-441c-9e7e-0c78f1e5c703.png" width="152" height="41"></p>  <p>Next, select <strong>App registrations</strong>.</p>  <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_5fce45c5-82f2-43f3-85fe-591dfa3d5171.png" width="537" height="83"></p>  <p>You will find the <strong>application</strong> created by the <strong>Visual Studio</strong> wizard, click on it.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image99.png" width="141" height="41"></p>  <p>Select<strong> API permissions</strong>.</p>  <p>Use the <strong>Add a permission</strong> button to create the permissions below:</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image101.png" width="634" height="392"></p>  <p><strong><u>After </u></strong>you have entered the permissions, scroll down to the <strong>Grant consent</strong> section (that is on the same page)…</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_2949ce1c-0d27-43e3-8553-fb88d9acd3cd.png" width="559" height="149"></p>  <p>Click the <strong>Grant admin consent</strong> button.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_f2086991-8742-46c0-84d8-720309e68f45.png" width="528" height="137"></p>  <p>Click <strong>Yes</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_85f783d3-d7d4-4100-a6ed-9633b0f153f1.png" width="171" height="40"></p>  <p>Select <strong>Certificates &amp; secrets</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_9de30195-73cf-40d2-a22c-b68deaf934d5.png" width="514" height="133"></p>  <p>Select <strong>New client secret</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_9bdf54ad-a5a3-4616-bee6-9cbe9852fb76.png" width="336" height="277"></p>  <p>Give it a <strong>name</strong>, an <strong>expiration period</strong>, and click the <strong>Add</strong> button.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_2993a94e-e8a4-43db-b5c1-cd67bd00f438.png" width="659" height="223"></p>  <p>The key will display.</p>  <p><strong>Copy</strong> it, you will need it for a later step.</p>      <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_ca5198f7-8a4c-4786-90cf-7e559404e751.png" width="319" height="346"></p>  <p>Return to <strong>Visual Studio</strong> and open the <strong>appsettings.json</strong> file:</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_2509adf4-884e-4b3f-814a-4210560a0fd8.png" width="493" height="320"></p>  <p><strong><u>Add</u></strong> an entry for the <strong>ClientSecret</strong> you copied earlier.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_8adab315-b724-413c-a035-029051e565e4.png" width="532" height="335"></p>  <p>Also, add the word <strong><em>common</em></strong> to the end of the <strong>Instance</strong> value.</p>  <p><strong>Save</strong>, and <em>close</em> the file.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_11f1a435-ab2f-42b7-aa70-ab49eb62ee2f.png" width="387" height="83"></p>  <p>Hit <strong>F5</strong> to run the application…</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_17862bd3-2648-4ee2-9ee9-84e6f48e9726.png" width="592" height="522"></p>  <p>It will open a <strong>web browser</strong> and immediately ask us to sign in.</p>  <p>We don’t want this.</p>  <p><em>Close</em> the <strong>web browser</strong> and return to <strong>Visual Studio</strong>.</p>    <p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_a6fb90d5-3516-4cf1-94f0-03bd2f84b9f2.png" width="326" height="347"></p>  <p><em>Open</em> the <strong>startup.cs</strong> file and <u><em><strong>remove</strong></em></u> the following lines:</p>    <pre><pre>            services.AddControllersWithViews(options =&gt;
</pre><pre>            {
</pre><pre>                var policy = <span>new</span> AuthorizationPolicyBuilder()
</pre><pre>                    .RequireAuthenticatedUser()
</pre><pre>                    .Build();
</pre><pre>                options.Filters.Add(<span>new</span> AuthorizeFilter(policy));
</pre><pre>            });</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_650c7b2a-a06f-41ab-a534-57f25e6dbe61.png" width="643" height="281"></p>

<p>Now when we run the application we see a<strong> log in</strong> button that we can click to <strong>log in</strong>.</p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_04b5d62e-6acc-4382-ac56-a7e9439b20b7.png" width="636" height="216"></p>

<p>When we <strong>log in</strong>, we can see our <strong>user name</strong> in the <strong>application header</strong>.</p>

<p>We will also see a button to <strong>Log out</strong>.</p>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_42f99427-8246-4ece-b245-0cc5378f249a.png" width="301" height="476"></p>

<p><em>Right-click</em> on the project node and select <strong>Manage NuGet Packages…</strong></p>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_7e928fdf-2dfc-42e9-b689-1c9078b28208.png" width="640" height="153"></p>

<p>Install:</p>

<ul>
  <li>Microsoft.Graph </li>

  <li>Microsoft.Graph.Auth (make sure to check the <strong>Include prerelease</strong> box) </li>

  <li>Microsoft.Identity.Client </li>
</ul>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_3ab650b3-9b53-472b-a477-08ba0345493a.png" width="259" height="350"></p>

<p>Open the <strong>_Imports.razor</strong> file and <u><strong>add</strong></u> the following lines:</p>



<pre><pre>@<span>using</span> Microsoft.Graph
</pre><pre>@<span>using</span> Microsoft.Extensions.Configuration
</pre><pre>@<span>using</span> Microsoft.Graph.Auth</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_29455526-4c8a-47be-b236-b62075d3ad35.png" width="267" height="394"></p>

<p>Add a folder called <strong>GraphCode</strong> and the following files:</p>



<h2>GraphClasses.cs</h2>



<pre><pre><span>using</span> System;
</pre><pre><span>using</span> System.Collections.Generic;
</pre><pre><span>using</span> System.Linq;
</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre></pre><pre><span>public</span> <span>class</span> GraphUser
</pre><pre>{
</pre><pre>    <span>public</span> <span>string</span>[] businessPhones { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> displayName { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> givenName { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> jobTitle { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> mail { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> mobilePhone { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>object</span> officeLocation { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> preferredLanguage { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> surname { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> userPrincipalName { <span>get</span>; <span>set</span>; }
</pre><pre>    <span>public</span> <span>string</span> id { <span>get</span>; <span>set</span>; }
</pre><pre>}</pre></pre>



<h2>ProtectedApiCallHelper.cs</h2>



<pre><pre><span>/*</span></pre><pre> The MIT License (MIT)</pre><pre></pre><pre>Copyright (c) 2015 Microsoft Corporation</pre><pre></pre><pre>Permission is hereby granted, free of charge, to any person obtaining a copy</pre><pre>of this software and associated documentation files (the "Software"), to deal</pre><pre>in the Software without restriction, including without limitation the rights</pre><pre>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</pre><pre>copies of the Software, and to permit persons to whom the Software is</pre><pre>furnished to do so, subject to the following conditions:</pre><pre></pre><pre>The above copyright notice and this permission notice shall be included in all</pre><pre>copies or substantial portions of the Software.</pre><pre></pre><pre>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</pre><pre>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</pre><pre>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</pre><pre>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</pre><pre>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</pre><pre>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</pre><pre>SOFTWARE.</pre><pre>*/</pre><pre></pre><pre><span>using</span> Newtonsoft.Json;</pre><pre><span>using</span> Newtonsoft.Json.Linq;</pre><pre><span>using</span> System;</pre><pre><span>using</span> System.Linq;</pre><pre><span>using</span> System.Net.Http;</pre><pre><span>using</span> System.Net.Http.Headers;</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre></pre><pre><span>/// &lt;summary&gt;</span></pre><pre><span>/// Helper class to call a protected API and process its result</span></pre><pre><span>/// &lt;/summary&gt;</span></pre><pre><span>public</span> <span>class</span> ProtectedApiCallHelper
</pre><pre>{
</pre><pre>    <span>/// &lt;summary&gt;</span></pre><pre>    <span>/// Constructor</span></pre><pre>    <span>/// &lt;/summary&gt;</span></pre><pre>    <span>/// &lt;param name="httpClient"&gt;HttpClient used to </span></pre><pre>    <span>/// call the protected API&lt;/param&gt;</span></pre><pre>    <span>public</span> ProtectedApiCallHelper(HttpClient httpClient)
</pre><pre>    {
</pre><pre>        HttpClient = httpClient;
</pre><pre>    }
</pre><pre></pre><pre>    <span>protected</span> HttpClient HttpClient { <span>get</span>; <span>private</span> <span>set</span>; }
</pre><pre></pre><pre>    <span>/// &lt;summary&gt;</span></pre><pre>    <span>/// Calls the protected Web API and processes the result</span></pre><pre>    <span>/// &lt;/summary&gt;</span></pre><pre>    <span>/// &lt;param name="webApiUrl"&gt;Url of the Web API to call </span></pre><pre>    <span>/// (supposed to return Json)&lt;/param&gt;</span></pre><pre>    <span>/// &lt;param name="accessToken"&gt;Access token used as a bearer </span></pre><pre>    <span>/// security token to call the Web API&lt;/param&gt;</span></pre><pre>    <span>/// &lt;param name="processResult"&gt;Callback used to process the result </span></pre><pre>    <span>/// of the call to the Web API&lt;/param&gt;</span></pre><pre>    <span>public</span> async Task CallWebApiAndProcessResultASync(
</pre><pre>        <span>string</span> webApiUrl,
</pre><pre>        <span>string</span> accessToken,
</pre><pre>        Action&lt;JObject&gt; processResult)
</pre><pre>    {
</pre><pre>        <span>if</span> (!<span>string</span>.IsNullOrEmpty(accessToken))
</pre><pre>        {
</pre><pre>            var defaultRequetHeaders = HttpClient.DefaultRequestHeaders;
</pre><pre></pre><pre>            <span>if</span> (defaultRequetHeaders.Accept == <span>null</span> ||
</pre><pre>            !defaultRequetHeaders.Accept.Any(m =&gt; m.MediaType == "<span>application/json</span>"))
</pre><pre>            {
</pre><pre>                HttpClient.DefaultRequestHeaders
</pre><pre>                .Accept
</pre><pre>                .Add(<span>new</span> MediaTypeWithQualityHeaderValue("<span>application/json</span>"));
</pre><pre>            }
</pre><pre>            defaultRequetHeaders.Authorization =
</pre><pre>            <span>new</span> AuthenticationHeaderValue("<span>bearer</span>", accessToken);
</pre><pre></pre><pre>            HttpResponseMessage response =
</pre><pre>            await HttpClient.GetAsync(webApiUrl);
</pre><pre>            <span>if</span> (response.IsSuccessStatusCode)
</pre><pre>            {
</pre><pre>                <span>string</span> json = await response.Content.ReadAsStringAsync();
</pre><pre>                JObject result = JsonConvert.DeserializeObject(json) <span>as</span> JObject;
</pre><pre>                processResult(result);
</pre><pre>            }
</pre><pre>            <span>else</span>
</pre><pre>            {
</pre><pre>                <span>string</span> content =
</pre><pre>                await response.Content.ReadAsStringAsync();
</pre><pre></pre><pre>                <span>// Note that if you got reponse.Code == 403 </span>
</pre><pre>                <span>// and reponse.content.code == "Authorization_RequestDenied"</span>
</pre><pre>                <span>// this is because the tenant admin as not granted </span>
</pre><pre>                <span>// consent for the application to call the Web API</span>
</pre><pre>                Console.WriteLine($"<span>Content: {content}</span>");
</pre><pre>            }
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_22c8d921-4a25-4101-a17e-965027555a2d.png" width="326" height="367"></p>

<p>Open the <strong>startup.cs</strong> file and add the following line to the <strong>public void ConfigureServices(IServiceCollection services)</strong> section:</p>



<pre><pre>services.AddHttpClient&lt;ProtectedApiCallHelper&gt;();</pre></pre>





<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_6c65cc74-0aac-4ab1-855a-498890d35b92.png" width="243" height="453"></p>

<p>Add a new page called <strong>Calendars.razor</strong> (also add a link to it in the navigation menu) using the following code:</p>



<pre><pre>@page "/calendars"
</pre><pre>@using Microsoft.Identity.Client;
</pre><pre>@using Newtonsoft.Json;
</pre><pre>@using Newtonsoft.Json.Linq;
</pre><pre>@inject IConfiguration _configuration
</pre><pre>@inject ProtectedApiCallHelper ProtectedApiCallHelper</pre></pre>



<p>Next add the following <strong>page markup</strong> code:</p>



<pre><pre><span>&lt;!-- AuthorizeView allows us to only show sections of the page --&gt;</span>
</pre><pre><span>&lt;!-- based on the security on the current user --&gt;</span>
</pre><pre><span>&lt;</span><span>AuthorizeView</span><span>&gt;</span>
</pre><pre>    <span>&lt;!-- Show this section if the user is logged in --&gt;</span>
</pre><pre>    <span>&lt;</span><span>Authorized</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>br</span> <span>/&gt;</span>
</pre><pre>        <span>&lt;</span><span>div</span> <span>class</span>=<span>"container-fluid"</span><span>&gt;</span>
</pre><pre>            <span>&lt;</span><span>div</span> <span>class</span>=<span>"row"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-12"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>Select User:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@UserId"</span><span>&gt;</span>
</pre><pre>                        @foreach (var user in
</pre><pre>                          colGraphUsers.OrderBy(x =&gt; x.displayName))
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@user.id"</span><span>&gt;</span>
</pre><pre>                                @user.displayName
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>        <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>Authorized</span><span>&gt;</span>
</pre><pre>    <span>&lt;!-- Show this section if the user is not logged in --&gt;</span>
</pre><pre>    <span>&lt;</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre>        <span>&lt;</span><span>p</span><span>&gt;</span>You must be logged in to use this page<span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre>    <span>&lt;/</span><span>NotAuthorized</span><span>&gt;</span>
</pre><pre><span>&lt;/</span><span>AuthorizeView</span><span>&gt;</span></pre></pre>



<p>Finally add the following procedure code:</p>



<pre><pre>@code {
</pre><pre>    <span>string</span> strError = "<span></span>";
</pre><pre>    <span>string</span> UserId = "<span></span>";
</pre><pre>    <span>int</span> intStartMonth = 1;
</pre><pre>    <span>int</span> intStartDay = 1;
</pre><pre>    <span>int</span> intStartYear = 2019;
</pre><pre>    <span>int</span> intEndMonth = 1;
</pre><pre>    <span>int</span> intEndDay = 1;
</pre><pre>    <span>int</span> intEndYear = 2019;
</pre><pre></pre><pre>    List&lt;GraphUser&gt; colGraphUsers = <span>new</span> List&lt;GraphUser&gt;();
</pre><pre>    List&lt;Calendar&gt; colCalendars = <span>new</span> List&lt;Calendar&gt;();
</pre><pre>    DateTime StartDateValue, EndDateValue;
</pre><pre>    List&lt;<span>int</span>&gt; colMonths = Enumerable.Range(1, 12).ToList();
</pre><pre>    List&lt;<span>int</span>&gt; colDays = Enumerable.Range(1, 31).ToList();
</pre><pre>    List&lt;<span>string</span>&gt; colYears = <span>new</span> List&lt;<span>string</span>&gt;() { "<span>2018</span>", "<span>2019</span>", "<span>2020</span>", "<span>2021</span>" };
</pre><pre>    
</pre><pre>    <span>protected</span> <span>override</span> async Task OnInitializedAsync()
</pre><pre>    {
</pre><pre>        <span>try</span>
</pre><pre>        {
</pre><pre>            IConfidentialClientApplication confidentialClientApplication =
</pre><pre>            ConfidentialClientApplicationBuilder
</pre><pre>            .Create(_configuration["<span>AzureAd:ClientId</span>"])
</pre><pre>            .WithTenantId(_configuration["<span>AzureAd:TenantId</span>"])
</pre><pre>            .WithClientSecret(_configuration["<span>AzureAd:ClientSecret</span>"])
</pre><pre>            .Build();
</pre><pre></pre><pre>            <span>// With client credentials flows the scopes is ALWAYS of the shape</span>
</pre><pre>            <span>// "resource/.default", as the</span>
</pre><pre>            <span>// application permissions need to be set statically</span>
</pre><pre>            <span>// (in the portal or by PowerShell),</span>
</pre><pre>            <span>// and then granted by a tenant administrator</span>
</pre><pre>            <span>string</span>[] scopes = <span>new</span> <span>string</span>[] { "<span>https://graph.microsoft.com/.default</span>" };
</pre><pre></pre><pre>            AuthenticationResult result = <span>null</span>;
</pre><pre></pre><pre>            result = await confidentialClientApplication.AcquireTokenForClient(scopes)
</pre><pre>            .ExecuteAsync();
</pre><pre></pre><pre>            var httpClient = <span>new</span> HttpClient();
</pre><pre>            var apiCaller = <span>new</span> ProtectedApiCallHelper(httpClient);
</pre><pre></pre><pre>            await apiCaller
</pre><pre>            .CallWebApiAndProcessResultASync(
</pre><pre>            "<span>https://graph.microsoft.com/v1.0/users</span>",
</pre><pre>            result.AccessToken,
</pre><pre>            DisplayUsers
</pre><pre>            );
</pre><pre></pre><pre>        }
</pre><pre>        <span>catch</span> (Exception ex)
</pre><pre>        {
</pre><pre>            strError = ex.GetBaseException().Message;
</pre><pre>        }
</pre><pre>    }
</pre><pre></pre><pre>    <span>private</span> <span>void</span> DisplayUsers(JObject result)
</pre><pre>    {
</pre><pre>        colGraphUsers = <span>new</span> List&lt;GraphUser&gt;();
</pre><pre></pre><pre>        <span>foreach</span> (JProperty child <span>in</span> result.Properties()
</pre><pre>            .Where(p =&gt; !p.Name.StartsWith("<span>@</span>")))
</pre><pre>        {
</pre><pre>            colGraphUsers.AddRange(
</pre><pre>                child.Value.ToObject&lt;List&lt;GraphUser&gt;&gt;()
</pre><pre>                );
</pre><pre>        }
</pre><pre></pre><pre>        <span>// If there are users set the first as the default</span>
</pre><pre>        <span>if</span> (colGraphUsers.Count &gt; 0)
</pre><pre>        {
</pre><pre>            UserId = colGraphUsers
</pre><pre>                .OrderBy(x =&gt; x.displayName)
</pre><pre>                .FirstOrDefault().id;
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_1647a98b-b8ee-4b9c-a03f-214f9e7d3976.png" width="684" height="332"></p>

<p>When we <em>run</em> the application, <strong>log in</strong>, and navigate to the <strong>Calendars</strong> page, we will see a <strong>dropdown</strong> that will show us the users in our <strong>Microsoft Office tenant</strong>.</p>

<p>Next, add the following markup to the page:</p>



<pre><pre>            <span>&lt;</span><span>div</span> <span>class</span>=<span>"row"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>Start Month:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intStartMonth"</span><span>&gt;</span>
</pre><pre>                        @foreach (var month in colMonths)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@month"</span><span>&gt;</span>
</pre><pre>                                @month
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>Start Day:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intStartDay"</span><span>&gt;</span>
</pre><pre>                        @foreach (var day in colDays)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@day"</span><span>&gt;</span>
</pre><pre>                                @day
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>Start Year:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intStartYear"</span><span>&gt;</span>
</pre><pre>                        @foreach (var year in colYears)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@year"</span><span>&gt;</span>
</pre><pre>                                @year
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;</span><span>div</span> <span>class</span>=<span>"row"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>End Month:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intEndMonth"</span><span>&gt;</span>
</pre><pre>                        @foreach (var month in colMonths)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@month"</span><span>&gt;</span>
</pre><pre>                                @month
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>End Day:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intEndDay"</span><span>&gt;</span>
</pre><pre>                        @foreach (var day in colDays)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@day"</span><span>&gt;</span>
</pre><pre>                                @day
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-4"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span><span>&lt;</span><span>label</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>End Year:<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>label</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>select</span> <span>class</span>=<span>"form-control"</span>
</pre><pre>                            @<span>bind</span>=<span>"@intEndYear"</span><span>&gt;</span>
</pre><pre>                        @foreach (var year in colYears)
</pre><pre>                        {
</pre><pre>                            <span>&lt;</span><span>option</span> <span>value</span>=<span>"@year"</span><span>&gt;</span>
</pre><pre>                                @year
</pre><pre>                            <span>&lt;/</span><span>option</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>select</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;</span><span>div</span> <span>class</span>=<span>"row"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-3"</span> <span>style</span>=<span>"text-align:left"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span>                    
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-9"</span> <span>style</span>=<span>"text-align:left"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span>
</pre><pre>                    <span>&lt;</span><span>span</span> <span>style</span>=<span>"color:red"</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>@strError<span>&lt;/</span><span>b</span><span>&gt;</span><span>&lt;/</span><span>span</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>        <span>&lt;/</span><span>div</span><span>&gt;</span></pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_c7654261-5df4-47da-a44e-288cb8cece4e.png" width="556" height="271"></p>

<p>When we <em>run</em> the application, we now see we have the ability to select the <strong>start</strong> and <strong>end</strong> dates.</p>

<p>Add the markup for a <strong>Submit</strong> button:</p>



<pre><pre>                    <span>&lt;</span><span>button</span> <span>class</span>=<span>"btn btn-primary"</span>
</pre><pre>                            @<span>onclick</span>=<span>"Submit"</span><span>&gt;</span>
</pre><pre>                        Submit
</pre><pre>                    <span>&lt;/</span><span>button</span><span>&gt;</span></pre></pre>



<p>Add the <strong>methods</strong> to handle the <strong>Submit</strong> button and to <em>generate the display</em> the <strong>calendar</strong>:</p>



<pre><pre>    async Task Submit()
</pre><pre>    {
</pre><pre>        strError = "<span></span>";
</pre><pre></pre><pre>        <span>// Try to create valid start and Stop dates</span>
</pre><pre>        <span>string</span> dateString;
</pre><pre></pre><pre>        dateString = $"<span>{intStartMonth}/{intStartDay}/{intStartYear}</span>";
</pre><pre>        <span>if</span> (!DateTime.TryParse(dateString, <span>out</span> StartDateValue))
</pre><pre>        {
</pre><pre>            strError = "<span>Start Date is not valid</span>";
</pre><pre>            <span>return</span>;
</pre><pre>        }
</pre><pre></pre><pre>        dateString = $"<span>{intEndMonth}/{intEndDay}/{intEndYear}</span>";
</pre><pre>        <span>if</span> (!DateTime.TryParse(dateString, <span>out</span> EndDateValue))
</pre><pre>        {
</pre><pre>            strError = "<span>End Date is not valid</span>";
</pre><pre>            <span>return</span>;
</pre><pre>        }
</pre><pre></pre><pre>        <span>try</span>
</pre><pre>        {
</pre><pre>            IConfidentialClientApplication confidentialClientApplication =
</pre><pre>                ConfidentialClientApplicationBuilder
</pre><pre>                .Create(_configuration["<span>AzureAd:ClientId</span>"])
</pre><pre>                .WithTenantId(_configuration["<span>AzureAd:TenantId</span>"])
</pre><pre>                .WithClientSecret(_configuration["<span>AzureAd:ClientSecret</span>"])
</pre><pre>                .Build();
</pre><pre></pre><pre>            <span>string</span>[] scopes = <span>new</span> <span>string</span>[] { "<span>https://graph.microsoft.com/.default</span>" };
</pre><pre></pre><pre>            AuthenticationResult result = <span>null</span>;
</pre><pre></pre><pre>            result = await confidentialClientApplication.AcquireTokenForClient(scopes)
</pre><pre>                .ExecuteAsync();
</pre><pre></pre><pre>            var httpClient = <span>new</span> HttpClient();
</pre><pre>            var apiCaller = <span>new</span> ProtectedApiCallHelper(httpClient);
</pre><pre></pre><pre>            await apiCaller
</pre><pre>                .CallWebApiAndProcessResultASync(
</pre><pre>                $"<span>https://graph.microsoft.com/v1.0/users/{UserId}/calendar/</span>" + 
</pre><pre>                $"<span>calendarView?startDateTime={intStartYear}-{intStartMonth}-{intStartDay}</span>" + 
</pre><pre>                $"<span>&amp;endDateTime={intEndYear}-{intEndMonth}-{intEndDay}</span>"
</pre><pre>                , result.AccessToken,
</pre><pre>                DisplayCalendars
</pre><pre>                );
</pre><pre>        }
</pre><pre>        <span>catch</span> (Exception ex)
</pre><pre>        {
</pre><pre>            strError = ex.GetBaseException().Message;
</pre><pre>        }
</pre><pre>    }
</pre><pre></pre><pre>    <span>private</span> <span>void</span> DisplayCalendars(JObject result)
</pre><pre>    {
</pre><pre>        colCalendars = <span>new</span> List&lt;Calendar&gt;();
</pre><pre></pre><pre>        <span>foreach</span> (JProperty child <span>in</span> result.Properties()
</pre><pre>            .Where(p =&gt; !p.Name.StartsWith("<span>@</span>")))
</pre><pre>        {
</pre><pre>            colCalendars.AddRange(
</pre><pre>                child.Value.ToObject&lt;List&lt;Calendar&gt;&gt;()
</pre><pre>                );
</pre><pre>        }
</pre><pre>    }</pre></pre>



<p>Add the <strong>markup</strong> to <strong>display</strong> the calendar:</p>



<pre><pre>            <span>&lt;</span><span>div</span> <span>class</span>=<span>"row"</span><span>&gt;</span>
</pre><pre>                <span>&lt;</span><span>div</span> <span>class</span>=<span>"col-sm-12"</span> <span>style</span>=<span>"text-align:left"</span><span>&gt;</span>
</pre><pre>                    <span>&lt;</span><span>br</span> <span>/&gt;</span>
</pre><pre>                    <span>&lt;</span><span>ul</span> <span>class</span>=<span>"list-group"</span> 
</pre><pre>                        <span>style</span>=<span>"height: 500px; overflow-y: scroll;"</span><span>&gt;</span>
</pre><pre>                        @foreach (var calendar in colCalendars)
</pre><pre>                        {
</pre><pre>                        <span>&lt;</span><span>li</span> <span>class</span>=<span>"list-group-item"</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>p</span><span>&gt;</span><span>&lt;</span><span>b</span><span>&gt;</span>Subject:<span>&lt;/</span><span>b</span><span>&gt;</span> 
</pre><pre>                            @calendar.AdditionalData["subject"]<span>&lt;/</span><span>p</span><span>&gt;</span>
</pre><pre>                            <span>&lt;</span><span>div</span><span>&gt;</span>
</pre><pre>                                <span>&lt;</span><span>b</span><span>&gt;</span>Start:<span>&lt;/</span><span>b</span><span>&gt;</span> 
</pre><pre>                                @FormatJSONDate(
</pre><pre>                               calendar.AdditionalData["start"].ToString())
</pre><pre>                                <span>&lt;</span><span>b</span><span>&gt;</span>End:<span>&lt;/</span><span>b</span><span>&gt;</span> 
</pre><pre>                                @FormatJSONDate(
</pre><pre>                               calendar.AdditionalData["end"].ToString())
</pre><pre>                            <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>                        <span>&lt;/</span><span>li</span><span>&gt;</span>
</pre><pre>                        }
</pre><pre>                    <span>&lt;/</span><span>ul</span><span>&gt;</span>
</pre><pre>                <span>&lt;/</span><span>div</span><span>&gt;</span>
</pre><pre>            <span>&lt;/</span><span>div</span><span>&gt;</span></pre></pre>



<p>Finally add the method to <strong>format</strong> the <strong>dates and times</strong>:</p>



<pre><pre>    <span>public</span> <span>string</span> FormatJSONDate(<span>string</span> json)
</pre><pre>    {
</pre><pre>        JObject jObject = JObject.Parse(json);
</pre><pre>        var dateTime = (<span>string</span>) jObject["<span>dateTime</span>"];
</pre><pre>        var timeZone = (<span>string</span>) jObject["<span>timeZone</span>"];
</pre><pre></pre><pre>        <span>return</span> dateTime;
</pre><pre>    }</pre></pre>



<p><img title="image" alt="image" src="http://blazorhelpwebsite.com/Portals/0/Blog/Files/1/4358/Windows-Live-Writer-Blazor-Microsoft-Graph_544D-image_7bca6f69-0bbf-44ac-b744-54fc92e85077.png" width="663" height="471"></p>

<p>When we run the application, it works.</p>





<p><strong><a href="https://blazor.net/">Blazor.net</a></strong></p>

<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/social/microsoft-logins?view=aspnetcore-3.0">Microsoft Account external login setup with ASP.NET Core</a></p>

<p><a href="https://docs.microsoft.com/en-us/graph/auth-v2-service">Microsoft Graph - Get access without a user</a></p>

<p><a href="https://docs.microsoft.com/en-us/graph/tutorials/dotnet-core">Build .NET Core apps with Microsoft Graph</a></p>

<p><a href="https://docs.microsoft.com/en-us/office/developer-program/office-365-developer-program">Welcome to the Office 365 Developer Program</a></p>





<p>The project is available at <a href="http://blazorhelpwebsite.com/Downloads.aspx">http://BlazorHelpWebsite.com/Downloads.aspx</a></p>

<p>You must have <strong>Visual Studio 2019 </strong>(or higher) installed to run the code.</p>
 
 <!-- End Blog Entry -->
 <!-- Blog Entry Footer Section -->
 
 
 
 <!-- Comments Section -->
 <div id="dnn_ctr382_MainView_ViewEntry_pnlComments">
		
  <p>
   <a id="Comments" name="Comments"></a>
   <a href="#AddComment"><span id="dnn_ctr382_MainView_ViewEntry_lblComments">4 comment(s) so far...</span></a>
  </p>
  
  <br>
  <table id="dnn_ctr382_MainView_ViewEntry_lstComments">
			<tbody><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_0">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_0" src="http://www.gravatar.com/avatar/e6445c8506f03e636f5627d930e55710?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_0">Re: Blazor Microsoft Graph Calendar Example With Active Directory Authentication</span>
      </p>
      <p>
       Do you have any teachings for users permissions?<br>I need <br>Thank
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_0">By KennethTang on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_0">11/15/2019 11:57 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_1">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_1" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_1">Re: Blazor Microsoft Graph Calendar Example With Active Directory Authentication</span>
      </p>
      <p>
       @KennethTang  - Sorry no.
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_1">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_1">11/15/2019 11:57 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_2">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_2" src="http://www.gravatar.com/avatar/2e7f12d7120649f453108b54228cce35?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_2">Re: Blazor Microsoft Graph Calendar Example With Active Directory Authentication</span>
      </p>
      <p>
       Hi Michael thank you for guiding me here. Do you have anything that is calling an api with the currently signed in user. What I've noticed is that when calling the api with this method I'm not sharing the same user identity name. Any ideas? 
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_2">By Scott Blankenship on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_2">1/18/2020 11:23 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr><tr>
				<td>
    <div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_3">
					
     <blockquote>
      <p><img id="dnn_ctr382_MainView_ViewEntry_lstComments_imgGravatar_3" src="http://www.gravatar.com/avatar/7127d88b22518f086edc3f3edc6c24db?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar">
      
					</p>
      <p>
       
       
       
       
       
       
       <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_3">Re: Blazor Microsoft Graph Calendar Example With Active Directory Authentication</span>
      </p>
      <p>
       @Scott Blankenship - Sorry, I don't have any examples passing the current logged in user's authentication token to the Microsoft Graph.
      </p>
     </blockquote>
     <p><cite>
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_3">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_3">1/18/2020 11:24 AM</span>
     </cite>
    
				</p></div>
   </td>
			</tr>
		</tbody></table>
 
	</div>
 
 <div id="dnn_ctr382_MainView_ViewEntry_pnlAddComment">
		
  <table>
   <tbody><tr>
    <td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblAuthor">Your name:</span>
    </td>
    <td id="dnn_ctr382_MainView_ViewEntry_tdAuthor" colspan="1">
     
    </td>
		
    <td id="dnn_ctr382_MainView_ViewEntry_tdGravatarPreview" rowspan="2">
     <p><img id="dnn_ctr382_MainView_ViewEntry_imgGravatarPreview" src="http://www.gravatar.com/avatar/108eeb4a0bc2c8c85cad9dde10e1319e?s=48&amp;r=G&amp;d=http%3a%2f%2fwww.gravatar.com%2favatar%2fb6267c6fe44b457964aed2218e3ef8fe%3fsize%3d48" alt="Gravatar Preview">
     </p>
    </td>
		
   </tr>
   <tr id="dnn_ctr382_MainView_ViewEntry_trGravatarEmail">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblEmail">Your email:</span>
    </td>
			<td>
     
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trUseGravatar">
			<td>
    </td>
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblEmailExplanation">(Optional) Email used only to show <a href="http://www.gravatar.com/" target="_new">Gravatar</a>.</span>
    </td>
			<td>
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trCommentWebsite">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblWebsite">Your website:</span>
    </td>
			<td colspan="2">
     
    </td>
		</tr>
		
   <tr id="dnn_ctr382_MainView_ViewEntry_trCommentTitle">
			<td>
     <span id="dnn_ctr382_MainView_ViewEntry_lblCommentTitle">Title:</span>
    </td>
			<td colspan="2">
     
    </td>
		</tr>
		
   <tr>
    <td colspan="3">
     <span id="dnn_ctr382_MainView_ViewEntry_lblComment">Comment:</span>
    </td>
   </tr>
   <tr>
    <td colspan="3">
     
    </td>
   </tr>
   <tr id="dnn_ctr382_MainView_ViewEntry_rowCaptcha">
			<td colspan="3">
     <span id="dnn_ctr382_MainView_ViewEntry_lblCaptcha">Security Code</span>
     <div>
				<p><img src="http://blazorhelpwebsite.com/DesktopModules/Blog/ImageChallenge.captcha.aspx?captcha=B47D18521211DED320F7AF6053AFE1E9C5170C25E6B457CD51189780225B295E571A6F85281EE811F8227AA3E7A3B19AB23E7F45B21781B6A7ADE5B51CB7C2304F2E47A6D51E25550AB83F31F955E1796D97D15D99953B13D5267335C851AC6B3ABAD4E3D9894A245FAE3D7C72DA606DEAD5E1F386652645AB42A5FA&amp;alias=blazorhelpwebsite.com" alt="CAPTCHA image"></p><p>
					Enter the code shown above in the box below
				</p></div>
    </td>
		</tr>
		
   <tr>
    <td colspan="3">
     Add Comment&nbsp;&nbsp;
     Cancel&nbsp;
     
    </td>
   </tr>
  </tbody></table>
  
 
	</div>
</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>