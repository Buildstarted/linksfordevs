<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Don&#x27;t Code Tired | Using C# Source Generators with Microsoft Feature Management Feature Flags - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Don&#x27;t Code Tired | Using C# Source Generators with Microsoft Feature Management Feature Flags - linksfor.dev(s)"/>
    <meta property="article:author" content="Jason"/>
    <meta property="og:description" content="Don&#x27;t Code Tired - Jason Roberts on Software Development and .NET -"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://dontcodetired.com/blog/post/Using-C-Source-Generators-with-Microsoft-Feature-Management-Feature-Flags"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Don&#x27;t Code Tired | Using C# Source Generators with Microsoft Feature Management Feature Flags</title>
<div class="readable">
        <h1>Don&#x27;t Code Tired | Using C# Source Generators with Microsoft Feature Management Feature Flags</h1>
            <div>by Jason</div>
            <div>Reading time: 7-8 minutes</div>
        <div>Posted here: 18 May 2020</div>
        <p><a href="https://dontcodetired.com/blog/post/Using-C-Source-Generators-with-Microsoft-Feature-Management-Feature-Flags">https://dontcodetired.com/blog/post/Using-C-Source-Generators-with-Microsoft-Feature-Management-Feature-Flags</a></p>
        <hr/>
<div id="readability-page-1" class="page"><article id="post0">

    
    <section>
        <p>C# Source Generators allow you to generate and compile source code dynamically. You can read more about them in <a href="https://dontcodetired.com/blog/post/C-Source-Generators-Less-Boilerplate-Code-More-Productivity">this previous article</a>.</p> <p>In my <a href="https://dontcodetired.com/blog/?tag=msftseries">series</a> on Microsoft Feature Management, <a href="https://dontcodetired.com/blog/post/Reducing-Magic-Strings-with-Microsoft-Feature-Toggles-(MicrosoftFeatureManagement)">part 2</a> showed how to reduce magic strings by using an enum.</p> <p>Using this approach still requires that the enum and the configuration file be manually kept in sync.</p> <p>One use case for C# Source Generators (that are currently in preview) is to generate code from a file in the project, for example generating a class from an XML settings file.</p> <p>We can process any external file in a source generator, including json files such as appsettings.json.</p> <p>This means that if the feature flags are defined in the appsettings.json file, we can create a source generator to read this file and output an enum containing all the features that have been defined in the appsettings.json. This means that the feature flags in the app will always be in sync with configuration file. It also means that if you were to remove a flag from the appsettings.json then compilation would break if you were still referencing the feature flag in the app.</p> <h2>Creating a C# Source Generator</h2> <p>To get this all to work in Visual Studio 2019 Preview first create a new .NET Standard 2.0 class library project called <strong>FeatureFlagGenerator</strong>.</p> <p>Modify the FeatureFlagGenerator.csproj to the following:</p><div><div id="highlighter_13014"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p></td><td><div><p><code>&lt;</code><code>Project</code> <code>Sdk</code><code>=</code><code>"Microsoft.NET.Sdk"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>TargetFramework</code><code>&gt;netstandard2.0&lt;/</code><code>TargetFramework</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>LangVersion</code><code>&gt;preview&lt;/</code><code>LangVersion</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>PackageReference</code> <code>Include</code><code>=</code><code>"Microsoft.CodeAnalysis.CSharp.Workspaces"</code> <code>Version</code><code>=</code><code>"3.6.0-3.20207.2"</code> <code>PrivateAssets</code><code>=</code><code>"all"</code> <code>/&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>PackageReference</code> <code>Include</code><code>=</code><code>"Microsoft.CodeAnalysis.Analyzers"</code> <code>Version</code><code>=</code><code>"3.0.0-beta2.final"</code> <code>PrivateAssets</code><code>=</code><code>"all"</code> <code>/&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&lt;/</code><code>Project</code><code>&gt;</code></p></div></td></tr></tbody></table></div></div>
<p>Next add a new class called FeatureFlagEnumGenerator with the following code:</p><div><div id="highlighter_988567"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p></td><td><div><p><code>using</code> <code>System.Collections.Generic;</code></p><p><code>using</code> <code>System.Linq;</code></p><p><code>using</code> <code>System.Text;</code></p><p><code>using</code> <code>Microsoft.CodeAnalysis;</code></p><p><code>using</code> <code>Microsoft.CodeAnalysis.Text;</code></p><p><code>namespace</code> <code>FeatureFlagGenerator</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[Generator]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>FeatureFlagEnumGenerator : ISourceGenerator</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>void</code> <code>Execute(SourceGeneratorContext context)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>IEnumerable&lt;AdditionalText&gt; files = context.AdditionalFiles.Where(at =&gt; at.Path.EndsWith(</code><code>"appsettings.json"</code><code>));</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>AdditionalText appsettings = files.First();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>StringBuilder enumString = </code><code>new</code> <code>StringBuilder();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"namespace GeneratedCode"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"{"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"&nbsp;&nbsp; public enum GeneratedFeatureFlags"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"&nbsp;&nbsp; {"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>bool</code> <code>isInFeatureManagamentSection = </code><code>false</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>foreach</code> <code>(</code><code>var</code> <code>line </code><code>in</code> <code>appsettings.GetText(context.CancellationToken).Lines)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(isInFeatureManagamentSection &amp;&amp; line.ToString().Contains(</code><code>"}"</code><code>))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isInFeatureManagamentSection = </code><code>false</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(isInFeatureManagamentSection)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>int</code> <code>featureNameStartIndex = line.ToString().IndexOf(</code><code>'"'</code><code>)+1;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>int</code> <code>featureNameEndIndex = line.ToString().IndexOf(</code><code>':'</code><code>)-1;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(line.ToString().Substring(featureNameStartIndex, featureNameEndIndex - featureNameStartIndex) + </code><code>","</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>if</code> <code>(line.ToString().Contains(</code><code>"FeatureManagement"</code><code>))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isInFeatureManagamentSection = </code><code>true</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"&nbsp;&nbsp; }"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>enumString.AppendLine(</code><code>"}"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>SourceText sourceText = SourceText.From(enumString.ToString(), Encoding.UTF8);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>const</code> <code>string</code> <code>desiredFileName = </code><code>"GeneratedFeaturesEnum.cs"</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>context.AddSource(desiredFileName, sourceText);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>void</code> <code>Initialize(InitializationContext context)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>Essentially the preceding code will search for the appsettings.json file in the project where the source generator is being used and then find all the configured feature flag names - for some reason trying to use System.Text.Json was causing errors so I implemented a very clunky solution using string manipulation.</p>
<h2>Using a C# Source Generator</h2>
<p>Now the generator is defined, it can be used in another project.</p>
<p>Go and add a new ASP.NET Core MVC project to the solution and modify the .csproj file to the following:</p><div><div id="highlighter_249439"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p></td><td><div><p><code>&lt;</code><code>Project</code> <code>Sdk</code><code>=</code><code>"Microsoft.NET.Sdk.Web"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>TargetFramework</code><code>&gt;net5.0&lt;/</code><code>TargetFramework</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>LangVersion</code><code>&gt;preview&lt;/</code><code>LangVersion</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>PropertyGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>AdditionalFiles</code> <code>Include</code><code>=</code><code>"appsettings.json"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>CopyToOutputDirectory</code><code>&gt;PreserveNewest&lt;/</code><code>CopyToOutputDirectory</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>AdditionalFiles</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>PackageReference</code> <code>Include</code><code>=</code><code>"Microsoft.FeatureManagement.AspNetCore"</code> <code>Version</code><code>=</code><code>"2.0.0"</code> <code>/&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>ProjectReference</code> <code>Include</code><code>=</code><code>"..\FeatureFlagGenerator\FeatureFlagGenerator.csproj"</code> <code>OutputItemType</code><code>=</code><code>"Analyzer"</code> <code>ReferenceOutputAssembly</code><code>=</code><code>"false"</code> <code>/&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>&lt;/</code><code>ItemGroup</code><code>&gt;</code></p><p><code>&lt;/</code><code>Project</code><code>&gt;</code></p></div></td></tr></tbody></table></div></div>
<p>There is a secret ingredient in the preceding project file and that is the <strong>AdditionalFiles Include="appsettings.json"</strong> part. This makes the file available to C# Source Generators and took me a while to work out.</p>
<p>Now when the web application is built, the source generator will run and create an enum with every configured flag name.</p>
<p>For example given the following appsettings.json:</p><div><div id="highlighter_859555"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p></td><td><div><p><code>{</code></p><p><code>&nbsp;&nbsp;</code><code>"Logging"</code><code>: {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"LogLevel"</code><code>: {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"Default"</code><code>: </code><code>"Information"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"Microsoft"</code><code>: </code><code>"Warning"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"Microsoft.Hosting.Lifetime"</code><code>: </code><code>"Information"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;</code><code>},</code></p><p><code>&nbsp;&nbsp;</code><code>"AllowedHosts"</code><code>: </code><code>"*"</code><code>,</code></p><p><code>&nbsp;&nbsp;</code><code>"FeatureManagement"</code><code>: {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"Printing"</code><code>: </code><code>true</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"LiveChat"</code><code>: </code><code>true</code></p><p><code>&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>This will generate and compile the following into the web application dll:</p><div><div id="highlighter_5831"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p></td><td><div><p><code>namespace</code> <code>GeneratedCode</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;</code><code>public</code> <code>enum</code> <code>GeneratedFeatureFlags</code></p><p><code>&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Printing,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>LiveChat,</code></p><p><code>&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>Notice the Printing and LiveChat enum values come from the appsettings FeatureManagement section.</p>
<p>Now the feature flags can be referenced in code:</p><div><div id="highlighter_930821"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p></td><td><div><p><code>if</code> <code>(await _featureManager.IsEnabledAsync(nameof(GeneratedCode.GeneratedFeatureFlags.Printing)))</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ViewData[</code><code>"PrintMessage"</code><code>] = </code><code>"On"</code><code>;</code></p><p><code>}</code></p><p><code>else</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ViewData[</code><code>"PrintMessage"</code><code>] = </code><code>"Off"</code><code>;</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>Or in the UI:</p><div><div id="highlighter_872199"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p></td><td><div><p><code>&lt;</code><code>feature</code> <code>name</code><code>=</code><code>"@nameof(GeneratedCode.GeneratedFeatureFlags.Printing)"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>li</code> <code>class</code><code>=</code><code>"nav-item"</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;</code><code>a</code> <code>class</code><code>=</code><code>"nav-link text-dark"</code> <code>asp-area</code><code>=</code><code>""</code> <code>asp-controller</code><code>=</code><code>"Home"</code> <code>asp-action</code><code>=</code><code>"Print"</code><code>&gt;Print Preview&lt;/</code><code>a</code><code>&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>&lt;/</code><code>li</code><code>&gt;</code></p><p><code>&lt;/</code><code>feature</code><code>&gt;</code></p></div></td></tr></tbody></table></div></div>
<p>It is these kinds of use cases, where there would otherwise be manual boilerplate code work, that C# Source Generators will be really useful.</p>



		
		

	<p>
		<span>SHARE:</span>
		<a href="https://twitter.com/share?url=http%3a%2f%2fdontcodetired.com%2fblog%2fpost%2fTesting-EventGridTrigger-Azure-Functions-Locally-(Without-Using-ngrok)&amp;text=Testing+EventGridTrigger+Azure+Functions+Locally+(Without+Using+ngrok)&amp;via=robertsjason" title="Share post on Twitter" rel="external nofollow noopener" target="_blank"><i></i></a>
            
        <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fdontcodetired.com%2fblog%2fpost%2fTesting-EventGridTrigger-Azure-Functions-Locally-(Without-Using-ngrok)&amp;title=Testing+EventGridTrigger+Azure+Functions+Locally+(Without+Using+ngrok)&amp;source=dontcodetired.com" title="Share post on LinkedIn" rel="external nofollow noopener" target="_blank"><i></i></a>
			
		<a rel="nofollow" href="mailto:?subject=Testing%20EventGridTrigger%20Azure%20Functions%20Locally%20(Without%20Using%20ngrok)&amp;body=Thought%20you%20might%20like%20this:%20http://dontcodetired.com/blog/post/Testing-EventGridTrigger-Azure-Functions-Locally-(Without-Using-ngrok)" title="Email a link to this post"><i></i></a>     
	</p>
		
        
    </section>
    
    
   
</article></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function () {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs" /></noscript>
</body>
</html>