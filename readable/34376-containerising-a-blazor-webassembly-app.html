<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Containerising a Blazor WebAssembly App -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <style type="text/css">
        html {
            font-family: sans-serif;
            line-height: 1.15;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
        }

        *, ::after, ::before {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #60656a;
            text-align: left;
            background-color: #323b44;
        }

        h1 {
            font-size: 6rem;
            font-weight: 300;
            line-height: 1.2;
            margin-top: 0;
            margin-bottom: 0.5rem;
            margin-bottom: 0.5rem
        }

        a {
            color: #007bff;
            color: #ccc;
            text-decoration: none;
            background-color: transparent;
            word-break: break-all;
        }

        .unseen a {
            font-weight: bold;
        }

        h3 {
            margin-top: 0;
            padding-top: 0;
            font-weight: normal;
        }

        .grid {
            -ms-flex-direction: column;
            flex-direction: column;
            width: 1024px;
            margin: 0 auto;
            flex: 1 0 auto;
        }

        .row {
            -ms-flex-direction: row;
            flex-direction: row;
            width: 100%;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
            display: -ms-flexbox;
            display: flex;
        }

        .col {
            margin: 0 10px 0 10px;
            box-sizing: border-box;
            vertical-align: top;
        }

        .col-3-of-4, .col-6-of-8, .col-9-of-12 {
            width: calc(75% - 20px);
        }

        .col-1-of-4, .col-2-of-8, .col-3-of-12 {
            width: calc(25% - 20px);
        }

        @media (max-width:1023px) {
            /* big landscape tablets, laptops, and desktops */
            body {
                overflow-x: hidden;
            }

            main {
                width: 99%;
            }

            h1 {
                font-size: 50px;
            }
        }

        .text-right {
            text-align: right;
        }

        footer {
            left: 0;
            width: 100%;
            margin-top: 2em;
            padding: 50px 0;
            text-align: center;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }

        .readable {
            color: #949ba2;
        }

        svg:not(:root).svg-inline--fa {
            color: #60656a;
            overflow: visible;
        }

        .svg-inline--fa.fa-w-12 {
            width: 0.75em;
        }

        svg:not(:root) {
            overflow: hidden;
        }

        .svg-inline--fa {
            display: inline-block;
            font-size: inherit;
            height: 1em;
            overflow: visible;
            vertical-align: -0.125em;
        }

        img {
            max-width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .readable h1 {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>Containerising a Blazor WebAssembly App</h1>
    <div class="post-content"> <p>This is the second post in the series: Containerising Blazor Applications With Docker.</p><p><strong>Part 1</strong> - <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-server-app/">Containerising a Blazor Server App</a><br><strong>Part 2</strong> - Containerising a Blazor WebAssembly App (this post)</p><p>In <a href="https://chrissainty.com/containerising-blazor-applications-with-docker-containerising-a-blazor-server-app/">part 1 </a>of the series, we took a look Docker and some of its key concepts. Then we took the default template for a Blazor Server app and containerised it using Docker. In this post, we are going to take a look at doing the same thing but with a Blazor WebAssembly app.</p><blockquote>All the code for this post is <a href="https://github.com/chrissainty/BlazorWasmWithDocker">available on GitHub</a>.</blockquote><h2 id="different-challenges">Different Challenges</h2><p>Creating a dockerfile for a Blazor Server app was pretty trivial. In-fact, if you use Visual Studio then it generates the file automatically for you with just a couple of clicks, albeit with some quirks.</p><p>Blazor WebAssembly projects present us with a different challenge, when published they produce static files. Unlike Blazor Server apps, we don&apos;t need the .NET Core runtime to serve them. This means we can drop the .NET Core runtime Docker image we used in part 1 as the base for our final image. So how are we going to serve our files? The answer is NGINX.</p><h3 id="what-is-nginx">What is NGINX?</h3><p>If you&apos;ve not come across it before, <a href="https://nginx.org/">NGINX is a free and open source web server</a> which can also be used as a reverse proxy, load balancer and HTTP cache. It&apos;s really great at serving static content, fast. When compared to apache it uses significantly less memory and can handle up to 4 times the number of requests per second.</p><p>Of course there&apos;s a Docker image for NGINX, several versions in-fact, but the one we&apos;ll be looking to use is NGINX:Alpine. This is a really tiny image, <strong>less than 5mb</strong>!! And it has everything we&apos;ll need to serve our Blazor WebAssembly application.</p><h2 id="prerequisites">Prerequisites</h2><p>If you&apos;ve not done any work with Docker before you will need to install <a href="https://docs.docker.com/docker-for-windows/install/">Docker Desktop for Windows</a> or <a href="https://docs.docker.com/docker-for-mac/install/">Docker Desktop for Mac</a>. Just follow the setup instructions and you will be up and running in a couple of minutes. For the purpose of this post we&apos;re going to be using the default project template for a Blazor WebAssembly app. I&apos;m going to be working in VS Code for this project but use whatever IDE/Editor you choose.</p><h2 id="adding-nginx-configuration">Adding NGINX Configuration</h2><p>We&apos;re going to be using NGINX to serve our application inside our container however, as our app is a SPA (Single Page Application), we need to tell NGINX to route all requests to the <code>index.html</code>. </p><p>As NGINX configuration is all opt-in it doesn&apos;t handle different mime types unless we tell it to. Also we will need to add in a mime type for <code>wasm</code> as this is not included in NGINXs default mime type list.</p><p>In the root of the project add a new file called <code>nginx.conf</code> and add in the following code.</p><pre><code class="language-nginx">events { }
http {
    include mime.types;
    types {
        application/wasm wasm;
    }

    server {
        listen 80;

        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html =404;
        }
    }
}
</code></pre>
<p>This is a really bare bones configuration which will allow our app to be served. But if you&apos;re looking to move into production with this then I would highly recommend you head over to the <a href="https://nginx.org/en/docs/">NGINX docs site</a> and have a read of all the options you can configure.</p><p>Essentially we&apos;ve setup a simple web server listening on port 80 with files being served from <code>/usr/share/nginx/html</code>. The <code>try_files</code> configuration tells NGINX to serve the <code>index.html</code> whenever it can&apos;t find the requested file on disk. </p><p>Above the <code>server</code> block we&apos;ve included the default mime types as well as a custom mime type for <code>wasm</code> files.</p><h2 id="adding-a-dockerfile">Adding a Dockerfile</h2><p>Now let&apos;s add a dockerfile to the root of our project with the following code.</p><pre><code class="language-dockerfile">FROM mcr.microsoft.com/dotnet/core/sdk:3.0-buster AS build
WORKDIR /src
COPY BlazorWasmDocker.csproj .
RUN dotnet restore &quot;BlazorWasmDocker.csproj&quot;
COPY . .
RUN dotnet build &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/build

FROM build AS publish
RUN dotnet publish &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/publish

FROM nginx:alpine AS final
WORKDIR /usr/share/nginx/html
COPY --from=publish /app/publish/BlazorWasmDocker/dist .
COPY nginx.conf /etc/nginx/nginx.conf
</code></pre>
<p>Just as we did in part 1, let&apos;s break this down a section at a time to understand what is going on.</p><pre><code class="language-dockerfile">FROM mcr.microsoft.com/dotnet/core/sdk:3.0-buster AS build
WORKDIR /src
COPY BlazorWasmDocker.csproj .
RUN dotnet restore &quot;BlazorWasmDocker.csproj&quot;
COPY . .
RUN dotnet build &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/build
</code></pre>
<p>This first section is going to build our app. We&apos;re using Microsofts official .NET Core 3 SDK image as the base for the build. We set the <code>WORKDIR</code> in the container to <code>/src</code> and then <code>COPY</code> over the <code>csproj</code> file from our project. Next we run a <code>dotnet restore</code> before <code>COPY</code>ing over the rest of the files from our project to the container. Finally, we build the project by <code>RUN</code>ing <code>dotnet build</code> on our project file setting the configuration to release.</p><pre><code class="language-dockerfile">FROM build AS publish
RUN dotnet publish &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/publish
</code></pre>
<p>The next section publishes our app. This is pretty straightforward, we use the previous section as a base and then <code>RUN</code> the <code>dotnet publish</code> command to publish the project.</p><pre><code class="language-dockerfile">FROM nginx:alpine AS final
WORKDIR /usr/share/nginx/html
COPY --from=publish /app/publish/BlazorWasmDocker/dist .
COPY nginx.conf /etc/nginx/nginx.conf
</code></pre>
<p>The last section produces our final image. We use the <code>nginx:alpine</code> image as a base and start by setting the <code>WORKDIR</code> to <code>/usr/share/nginx/html</code> - this is the directory where we&apos;ll serve our application from. Next, we <code>COPY</code> over our published app from the previous publish section to the current working directory. Finally, we <code>COPY</code> over the <code>nginx.conf</code> we created earlier to replace the default configuration file.</p><h2 id="building-the-image">Building the image</h2><p>Now we have our dockerfile all setup and ready to go we need to build our image.</p><pre><code class="language-bash">docker build -t blazor-webassembly-with-docker .
</code></pre>
<p>Just as in part 1, we&apos;re using the <code>docker build</code> command, the <code>-t</code> switch allows us to tag the image with a friendly name so we can identify it a bit easier later on. The dot (.) at the end tells docker to look for the dockerfile in the current directory.</p><p>The output from the build looks like this.</p><pre><code class="language-bash">Sending build context to Docker daemon  12.67MB
Step 1/12 : FROM mcr.microsoft.com/dotnet/core/sdk:3.0-buster AS build
 ---&gt; 3930ade3a33a
Step 2/12 : WORKDIR /src
 ---&gt; Running in 5887e6f8651b
Removing intermediate container 5887e6f8651b
 ---&gt; d2a6ace2af2a
Step 3/12 : COPY BlazorWasmDocker.csproj .
 ---&gt; 89996f9b08b3
Step 4/12 : RUN dotnet restore &quot;BlazorWasmDocker.csproj&quot;
 ---&gt; Running in 58339cda1a29
  Restore completed in 4.26 sec for /src/BlazorWasmDocker.csproj.
Removing intermediate container 58339cda1a29
 ---&gt; 877f9732fb20
Step 5/12 : COPY . .
 ---&gt; 5d524b3a005a
Step 6/12 : RUN dotnet build &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/build
 ---&gt; Running in e21142de9958
Microsoft (R) Build Engine version 16.3.0-preview-19377-01+dd8019d9e for .NET Core
Copyright (C) Microsoft Corporation. All rights reserved.

  Restore completed in 113.14 ms for /src/BlazorWasmDocker.csproj.
  You are using a preview version of .NET Core. See: https://aka.ms/dotnet-core-preview
  BlazorWasmDocker -&gt; /app/build/BlazorWasmDocker.dll
  Processing embedded resource linker descriptor: mscorlib.xml
  Duplicate preserve in resource mscorlib.xml in mscorlib, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e of System.Threading.WasmRuntime (All).  Duplicate uses (All)
  Type System.Reflection.Assembly has no fields to preserve
  Type Mono.ValueTuple has no fields to preserve
  Output action:     Link assembly: BlazorWasmDocker, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
  Output action:     Save assembly: System.Threading.Tasks.Extensions, Version=4.2.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: System.Text.Json, Version=4.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: System.Text.Encodings.Web, Version=4.0.4.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: System.Runtime.CompilerServices.Unsafe, Version=4.0.5.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Output action:     Save assembly: System.Numerics.Vectors, Version=4.1.4.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Output action:     Save assembly: System.Memory, Version=4.0.1.1, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: System.ComponentModel.Annotations, Version=4.2.1.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Output action:     Save assembly: System.Buffers, Version=4.0.3.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: Mono.WebAssembly.Interop, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.JSInterop, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Extensions.Primitives, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Extensions.Options, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Extensions.Logging.Abstractions, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Extensions.DependencyInjection.Abstractions, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Extensions.DependencyInjection, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.Bcl.AsyncInterfaces, Version=1.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Save assembly: Microsoft.AspNetCore.Metadata, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.AspNetCore.Components.Web, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.AspNetCore.Components, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.AspNetCore.Blazor.HttpClient, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.AspNetCore.Blazor, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:     Save assembly: Microsoft.AspNetCore.Authorization, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
  Output action:   Delete assembly: netstandard, Version=2.1.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:     Link assembly: mscorlib, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e
  Output action:     Link assembly: System, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e
  Output action:     Link assembly: Mono.Security, Version=2.0.5.0, Culture=neutral, PublicKeyToken=0738eb9f132ed756
  Output action:   Delete assembly: System.Xml, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e
  Output action:   Delete assembly: System.Numerics, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:     Link assembly: System.Core, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e
  Output action:   Delete assembly: System.Data, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:   Delete assembly: System.Drawing.Common, Version=4.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51
  Output action:   Delete assembly: System.IO.Compression, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:   Delete assembly: System.IO.Compression.FileSystem, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:   Delete assembly: System.ComponentModel.Composition, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:     Link assembly: System.Net.Http, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Output action:   Delete assembly: System.Runtime.Serialization, Version=2.0.5.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e
  Output action:   Delete assembly: System.Transactions, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
  Output action:   Delete assembly: System.Web.Services, Version=2.0.5.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Output action:   Delete assembly: System.Xml.Linq, Version=2.0.5.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35
  Output action:   Delete assembly: System.ServiceModel.Internals, Version=0.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35
  Output action:   Delete assembly: System.Runtime, Version=4.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
  Writing boot data to: /src/obj/Release/netstandard2.0/blazor/blazor.boot.json
  Blazor Build result -&gt; 34 files in /app/build/dist

Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:06.48
Removing intermediate container e21142de9958
 ---&gt; 2baa60070e68
Step 7/12 : FROM build AS publish
 ---&gt; 2baa60070e68
Step 8/12 : RUN dotnet publish &quot;BlazorWasmDocker.csproj&quot; -c Release -o /app/publish
 ---&gt; Running in 8dbc22b721d6
Microsoft (R) Build Engine version 16.3.0-preview-19377-01+dd8019d9e for .NET Core
Copyright (C) Microsoft Corporation. All rights reserved.

  Restore completed in 18.34 ms for /src/BlazorWasmDocker.csproj.
  You are using a preview version of .NET Core. See: https://aka.ms/dotnet-core-preview
  BlazorWasmDocker -&gt; /src/bin/Release/netstandard2.0/BlazorWasmDocker.dll
  Blazor Build result -&gt; 34 files in /src/bin/Release/netstandard2.0/dist
  BlazorWasmDocker -&gt; /app/publish/
Removing intermediate container 8dbc22b721d6
 ---&gt; fbcddda6346a
Step 9/12 : FROM nginx:alpine AS final
 ---&gt; 41c8c3458a93
Step 10/12 : WORKDIR /usr/share/nginx/html
 ---&gt; Using cache
 ---&gt; 6130c816d7b1
Step 11/12 : COPY --from=publish /app/publish/BlazorWasmDocker/dist .
 ---&gt; a59305f74889
Step 12/12 : COPY nginx.conf /etc/nginx/nginx.conf
 ---&gt; 62ec166940dc
Successfully built 62ec166940dc
Successfully tagged blazor-webassembly-with-docker:latest
</code></pre>
<h2 id="starting-a-container">Starting a container</h2><p>Now we have built our image we can go ahead and start a container and check if everything is working.</p><pre><code class="language-bash">docker run -p 8080:80 blazor-webassembly-with-docker
</code></pre>
<p>This command tells Docker to start a container with the tag <code>blazor-webassembly-with-docker</code>. The <code>-p</code> switch maps port <code>8080</code> on the host to port <code>80</code> in the container.</p><p>Once you have run the command then open a browser and navigate to <code>http://localhost:8080</code> and you should be able to load the app.</p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/Screenshot-2019-08-21-at-11.01.29.png" class="kg-image"></figure><h3 id="detached-mode">Detached Mode</h3><p>If you want to leave your container running but you don&apos;t want it hogging a terminal window, you can start it in <em>detached mode</em>. This mode runs the container in the background so it doesn&apos;t receive any inputs or display any outputs. To use detached mode add the <code>-d</code> switch to the <code>docker run</code> command.</p><pre><code class="language-bash">docker run -d -p 8080:80 blazor-webassembly-with-docker
</code></pre>
<p>When executed you&apos;ll see the unique identifier for your container appear on the screen and then you&apos;ll be returned back to the terminal prompt.</p><p>To view any container you currently have running in the background you can use the <code>docker ps</code> command. </p><figure class="kg-card kg-image-card"><img src="https://chrissainty.com/content/images/2019/08/docker-ps-1.png" class="kg-image"></figure><p>If you want to stop a container running in the background then use the <code>docker stop</code> command with either the containers ID or name.</p><pre><code class="language-bash">docker stop youthful_wozniak
</code></pre>
<p>In this post, we&apos;ve looked at the different challenges we face running a Blazor WebAssembly application in a container. We then built an image for our app which uses NGINX to serve the static content which Blazor WebAssembly applications produce. We finished up be checking everything worked by starting a container using our new image.</p><p>Next time we&apos;ll take a look at how we can automate building and deploying with Azure DevOps and hopefully get our containers running on Azure.</p> <div class="post-tags"> Tagged in: <a href="/docker/">Docker</a> | <a href="/blazor-client-side/">Blazor (client-side)</a> </div> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
</body>
</html>