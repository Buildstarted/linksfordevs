<!DOCTYPE html>
<html lang="en">
<head>
    <title>
.NET Core 3.1 Migration - Quick Reference for WEB API Projects - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content=".NET Core 3.1 Migration - Quick Reference for WEB API Projects - linksfor.dev(s)"/>
    <meta property="article:author" content="Anish_Ravindran"/>
    <meta property="og:description" content="Quick basic reference to migrate Web API projects to .NET Core 3.1"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.codeproject.com/Tips/5270519/NET-Core-3-1-Migration-Quick-Reference-for-WEB-AP"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - .NET Core 3.1 Migration - Quick Reference for WEB API Projects</title>
<div class="readable">
        <h1>.NET Core 3.1 Migration - Quick Reference for WEB API Projects</h1>
            <div>by Anish_Ravindran</div>
            <div>Reading time: 5-6 minutes</div>
        <div>Posted here: 08 Jun 2020</div>
        <p><a href="https://www.codeproject.com/Tips/5270519/NET-Core-3-1-Migration-Quick-Reference-for-WEB-AP">https://www.codeproject.com/Tips/5270519/NET-Core-3-1-Migration-Quick-Reference-for-WEB-AP</a></p>
        <hr/>
<div id="readability-page-1" class="page"><p>In this basic reference for migrating Web API projects to .NET Core 3.1 from the previous major framework, we will cover only the common breaking changes, not each and every aspect of migration to .NET Core 3.1.</p><div id="contentdiv">
						



<h2>Background</h2>

<p>The support life span of the previous .NET Core version like 2.2 is stopped, projects need to migrate to the latest stable .NET core version 3.1.</p>

<h2>Using the Code</h2>

<h3>Step 1 - Environment Setup</h3>

<ul>
	<li>Install Visual Studio 2019 if not available; once installed, you will be having the required framework .NET Core 3.1.</li>	<li>Install .NET Core 3.1 SDK if not available in current VS 2019.</li>	<li>A quick check for the environment can be done as below:
	<p><span id="prehide492319" onclick="processCodeBlocks.togglePre(492319);">Hide</span>  &nbsp; <span id="copycode492319" onclick="return processCodeBlocks.copyCode(492319);">Copy Code</span></p><pre lang="text" data-lang-orig="text" id="pre492319">C:&gt;dotnet --version  

3.1.100  </pre>
	</li></ul>

<h3>Step 2 - Framework Upgrade</h3>

<ol>
	<li>Open the project in VS 2019 you would like to migrate and change the framework to 3.1 for each project as part of the solution. Select the properties option to change the same.
	<h4>Note</h4>

	<p>.NET Core 3.1 requires Visual Studio 2019 version 16.5. Check your version of the Visual Studio. If it's not 16.5, update it and try again.</p>

	<p><img src="https://www.codeproject.com/KB/aspnet/5270519/1.png" alt="Image 1" data-sizes="auto" data-srcset="/KB/aspnet/5270519/1-r-400.png 400w, /KB/aspnet/5270519/1.png 642w" sizes="600px" srcset="/KB/aspnet/5270519/1-r-400.png 400w, /KB/aspnet/5270519/1.png 642w"></p>
	</li>	<li>Remove the reference to <code>Microsoft.AspNetCore.App</code>; this is obsolete from 3.0 onwards.
	<p><a href="https://www.codeproject.com/KB/Articles/5270519/2.png" target="_blank" title="Opens in a new window"><img src="https://www.codeproject.com/KB/aspnet/5270519/2.png" alt="Image 2" data-src="/KB/aspnet/5270519/2.png" data-sizes="auto" data-srcset="/KB/aspnet/5270519/2-r-400.png 400w, /KB/aspnet/5270519/2.png 600w" sizes="600px" srcset="/KB/aspnet/5270519/2-r-400.png 400w, /KB/aspnet/5270519/2.png 600w"></a></p>

	<p><img src="https://www.codeproject.com/KB/aspnet/5270519/3.png" alt="Image 3" data-src="/KB/aspnet/5270519/3.png" data-sizes="auto" data-srcset="/KB/aspnet/5270519/3-r-400.png 400w, /KB/aspnet/5270519/3.png 500w" sizes="500px" srcset="/KB/aspnet/5270519/3-r-400.png 400w, /KB/aspnet/5270519/3.png 500w"></p>
	</li></ol>

<h3>Step 3 - Changes in Startup.cs File</h3>

<h4>Note</h4>

<p>The previous version code and the change is provided sequentially.</p>

<ol>
	<li>Change the compatibility version as given below:
	<p><span id="prehide230588" onclick="processCodeBlocks.togglePre(230588);">Hide</span>  &nbsp; <span id="copycode230588" onclick="return processCodeBlocks.copyCode(230588);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre230588">services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Version_2_2);  </pre>

	<p><span id="prehide256319" onclick="processCodeBlocks.togglePre(256319);">Hide</span>  &nbsp; <span id="copycode256319" onclick="return processCodeBlocks.copyCode(256319);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre256319">services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Version_3_0);  </pre>
	</li>	<li>Change the dependency injection for <code>IHostingEnvironment</code> to <code>IWebHostEnvironment</code>.
	<p><span id="prehide744134" onclick="processCodeBlocks.togglePre(744134);">Hide</span>  &nbsp; <span id="copycode744134" onclick="return processCodeBlocks.copyCode(744134);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre744134"><strong><span>public</span> <span>void</span></strong> Configure(IApplicationBuilder app,IHostingEnvironment env)  </pre>

	<p>Import the below namespace to include the change:</p>

	<p><span id="prehide726365" onclick="processCodeBlocks.togglePre(726365);">Hide</span>  &nbsp; <span id="copycode726365" onclick="return processCodeBlocks.copyCode(726365);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre726365"><strong><span>using</span></strong> Microsoft.Extensions.Hosting;  
<strong><span>public</span> <span>void</span></strong> Configure(IApplicationBuilder app, IWebHostEnvironment env)  </pre>
	</li>	<li>MVC pipeline change:
	<p><span id="prehide71085" onclick="processCodeBlocks.togglePre(71085);">Hide</span>  &nbsp; <span id="copycode71085" onclick="return processCodeBlocks.copyCode(71085);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre71085">app.UseMvc();      </pre>

	<p>After the change, this will be as below (<code>app.UseMVC()</code> is deprecated):</p>

	<p><span id="prehide642456" onclick="processCodeBlocks.togglePre(642456);">Hide</span>  &nbsp; <span id="copycode642456" onclick="return processCodeBlocks.copyCode(642456);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre642456">app.UseRouting();    
app.UseEndpoints(endpoints =<span>&gt;</span>    
{    
    endpoints.MapControllers();    
});    </pre>
	</li></ol>

<h3>Step 4 - Swagger Changes (This is Relevant if Swagger is Used for API)</h3>

<p>Import latest <code>Swashbuckle.AspNetCore</code> if you are using old versions using Nuget (the version is 5.4.1 at this time).</p>

<p><img src="https://www.codeproject.com/KB/aspnet/5270519/4.png" alt="Image 4" data-src="/KB/aspnet/5270519/4.png" data-sizes="auto" data-srcset="/KB/aspnet/5270519/4-r-400.png 400w, /KB/aspnet/5270519/4.png 600w" srcset="/KB/aspnet/5270519/4-r-400.png 400w, /KB/aspnet/5270519/4.png 600w"></p>

<p>Library changes:</p>

<p><span id="prehide467406" onclick="processCodeBlocks.togglePre(467406);">Hide</span>  &nbsp; <span id="copycode467406" onclick="return processCodeBlocks.copyCode(467406);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre467406">services.AddSwaggerGen(x =<span>&gt;</span>  
           {  
               x.SwaggerDoc(<span>"</span><span>v1"</span>, <strong><span>new</span></strong> Info  
               {  
                   Title = <span>"</span><span>My API"</span>,  
                   Version = <span>"</span><span>v1"</span>, 
               });                       
           });  </pre>

<p>Add the below namespace (Explanation - Microsoft is using OpenAPI specification models):</p>

<p><span id="prehide253288" onclick="processCodeBlocks.togglePre(253288);">Hide</span>  &nbsp; <span id="copycode253288" onclick="return processCodeBlocks.copyCode(253288);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre253288"><strong><span>using</span></strong> Microsoft.OpenApi.Models;  
services.AddSwaggerGen(x =<span>&gt;</span>  
           {  
               x.SwaggerDoc(<span>"</span><span>v1"</span>, <strong><span>new</span></strong> OpenApiInfo  
               {  
                   Title = <span>"</span><span>My API"</span>,  
                   Version = <span>"</span><span>v1"</span>, 
               });  
           });  </pre>

<h3>Step 5 - CORS Changes (This is Relevant if CORS Policy is Defined)</h3>

<p>(Explanation - Mutually exclusive CORS policy from 3.0 onwards, <code>System.InvalidOperationException</code>: 'The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the CORS policy by listing individual origins if credentials need to be supported.')</p>

<p><span id="prehide675812" onclick="processCodeBlocks.togglePre(675812);">Hide</span>  &nbsp; <span id="copycode675812" onclick="return processCodeBlocks.copyCode(675812);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre675812">services.AddCors(policy =<span>&gt;</span> 
               { 
                   policy.AddPolicy(<span>"</span><span>Default"</span>, builder =<span>&gt;</span> 
                   { 
                       builder.AllowAnyOrigin() 
                       .AllowAnyHeader() 
                       .AllowCredentials()                     
                       .AllowAnyMethod() 
                       .Build(); 
                   });           
               }); </pre>

<p><span id="prehide588754" onclick="processCodeBlocks.togglePre(588754);">Hide</span>  &nbsp; <span id="copycode588754" onclick="return processCodeBlocks.copyCode(588754);">Copy Code</span></p><pre lang="cs" data-lang-orig="cs" id="pre588754">services.AddCors(policy =<span>&gt;</span> 
               { 
                   policy.AddPolicy(<span>"</span><span>Default"</span>, builder =<span>&gt;</span> 
                   { 
                       builder.AllowAnyOrigin() 
                       .AllowAnyHeader()                    
                       .AllowAnyMethod() 
                       .Build(); 
                   });           
               });  </pre>

<h3>Step 6 - Final Clean and Build</h3>

<p>Do a solution clean and build.</p>

<p>At this point, your code will be successfully migrated to .NET Core 3.1 and should run as expected.</p>

<h2>Reference</h2>

<ul>
	<li><a href="https://docs.microsoft.com/en-us/aspnet/core/migration/22-to-30?view=aspnetcore-3.1&amp;tabs=visual-studio">Migrate from ASP.NET Core 2.2 to 3.0</a></li></ul>

<h2>History</h2>

<ul>
	<li>V 1.0 - First version</li></ul>


						</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>