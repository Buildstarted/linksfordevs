<!DOCTYPE html>
<html lang="en">
<head>
    <title>
OData with ASP.NET Core - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="OData with ASP.NET Core - linksfor.dev(s)"/>
    <meta property="article:author" content="damienbod"/>
    <meta property="og:description" content="This article explores how to setup an OData API with ASP.NET Core. The application uses Entity Framework Core with a database first approach using the adventureworks 2016 Microsoft SQL Database. Co&#x2026;"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://damienbod.com/2018/10/12/odata-with-asp-net-core/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - OData with ASP.NET Core</title>
<div class="readable">
        <h1>OData with ASP.NET Core</h1>
            <div>by damienbod</div>
            <div>Reading time: 9-11 minutes</div>
        <div>Posted here: 06 Jul 2020</div>
        <p><a href="https://damienbod.com/2018/10/12/odata-with-asp-net-core/">https://damienbod.com/2018/10/12/odata-with-asp-net-core/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>

							<p>This article explores how to setup an OData API with ASP.NET Core. The application uses Entity Framework Core with a database first approach using the adventureworks 2016 Microsoft SQL Database.</p>
<p><strong>Code:</strong> <a href="https://github.com/damienbod/AspNetCoreOData" rel="nofollow">https://github.com/damienbod/AspNetCoreOData</a></p>
<p>Part 2: Using an OData Client with an ASP.NET Core API</p>
<p><a href="https://damienbod.com/2018/10/18/using-an-odata-client-with-an-asp-net-core-api/" rel="nofollow">https://damienbod.com/2018/10/18/using-an-odata-client-with-an-asp-net-core-api/</a></p>
<p><strong>History</strong></p>
<p><strong>2020-07-06</strong> Updated .NET Core 3.1</p>
<p><strong>Setting up the Database</strong></p>
<p>The adventureworks 2016 database from the <a href="https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks">Microsoft/sql-server-samples</a> was used to setup the database. This backup was  restored to the SQL database and Entity Framework Core was then used to create the models and the context as described here:</p>
<p><a href="https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/existing-db" rel="nofollow">https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/existing-db</a></p>
<p>Powershell was used to setup like this:</p>
<p><em>Scaffold-DbContext “Data Source=”your_instance_name”\sqlexpress;Initial Catalog=AdventureWorks2016;Integrated Security=True” Microsoft.EntityFrameworkCore.SqlServer -OutputDir Database</em></p>
<p>This created the Entity Framework Core AdventureWorks2016Context Context class, which is used to access the database.</p>
<p>The AdventureWorks2016Context class is then added to the Startup ConfigureServices using the default connection string whch is configured in the app.settings file.</p>
<div><div id="highlighter_213764"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>public</code> <code>void</code> <code>ConfigureServices(IServiceCollection services)</code></p><p><code>{</code></p><p><code>&nbsp;</code><code>services.AddDbContext&lt;AdventureWorks2016Context&gt;(options =&gt;</code></p><p><code>&nbsp;&nbsp;</code><code>options.UseSqlServer(Configuration.GetConnectionString(</code><code>"DefaultConnection"</code><code>)));</code></p></div></td></tr></tbody></table></div></div>
<p>The created entities need to be changed a bit to work. For example, the Person entity class which was scaffolded in, requires that the key attribute be added to the BusinessEntityId. This attribute needs to be added to the required properties in the entities.</p>
<div><div id="highlighter_692578"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p></td><td><div><p><code>using</code> <code>System;</code></p><p><code>using</code> <code>System.Collections.Generic;</code></p><p><code>using</code> <code>System.ComponentModel.DataAnnotations;</code></p><p><code>namespace</code> <code>AspNetCoreOData.Service.Database</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>partial</code> <code>class</code> <code>Person</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>Person()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>BusinessEntityContact = </code><code>new</code> <code>HashSet&lt;BusinessEntityContact&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Customer = </code><code>new</code> <code>HashSet&lt;Customer&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EmailAddress = </code><code>new</code> <code>HashSet&lt;EmailAddress&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>PersonCreditCard = </code><code>new</code> <code>HashSet&lt;PersonCreditCard&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>PersonPhone = </code><code>new</code> <code>HashSet&lt;PersonPhone&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[Key]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>int</code> <code>BusinessEntityId { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>PersonType { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>bool</code> <code>NameStyle { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Title { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>FirstName { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>MiddleName { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>LastName { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Suffix { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>int</code> <code>EmailPromotion { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>AdditionalContactInfo { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>string</code> <code>Demographics { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>Guid Rowguid { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>DateTime ModifiedDate { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>BusinessEntity BusinessEntity { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>Employee Employee { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>Password Password { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>ICollection&lt;BusinessEntityContact&gt; BusinessEntityContact { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>ICollection&lt;Customer&gt; Customer { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>ICollection&lt;EmailAddress&gt; EmailAddress { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>ICollection&lt;PersonCreditCard&gt; PersonCreditCard { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>virtual</code> <code>ICollection&lt;PersonPhone&gt; PersonPhone { </code><code>get</code><code>; </code><code>set</code><code>; }</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p><strong>Adding OData to the ASP.NET Core application</strong></p>
<p>Add the<strong> Microsoft.AspNetCore.OData</strong> NuGet package to the application using NuGet or directly add it to the project file.</p>
<div><div id="highlighter_514083"><table><tbody><tr><td><p>1</p></td><td><div><p><code>&lt;PackageReference Include=</code><code>"Microsoft.AspNetCore.OData"</code> <code>Version=</code><code>"7.0.1"</code> <code>/&gt;</code></p></div></td></tr></tbody></table></div></div>
<p>In the startup class ConfigureServices method, add the OData services. The AddMvc extension method requires, that the EnableEndpointRouting property is set to false in an ASP.NET Core app targeting netcoreapp2.2.</p>
<div><div id="highlighter_612000"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p></td><td><div><p><code>public</code> <code>void</code> <code>ConfigureServices(IServiceCollection services)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>...</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddOData();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddODataQueryFilter();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>services.AddControllers(options =&gt; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>options.EnableEndpointRouting = </code><code>false</code><code>;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>);</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>Create the OData IEdmModel  as required:</p>
<div><div id="highlighter_926154"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p></td><td><div><p><code>private</code> <code>static</code> <code>IEdmModel GetEdmModel(IServiceProvider serviceProvider)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ODataModelBuilder builder = </code><code>new</code> <code>ODataConventionModelBuilder(serviceProvider);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>builder.EntitySet&lt;Person&gt;(</code><code>"Person"</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.EntityType</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Filter()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Count()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Expand()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.OrderBy()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Page()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.Select();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>...</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>...</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EntitySetConfiguration&lt;ContactType&gt; contactType = builder.EntitySet&lt;ContactType&gt;(</code><code>"ContactType"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>actionY = contactType.EntityType.Action(</code><code>"ChangePersonStatus"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>actionY.Parameter&lt;</code><code>string</code><code>&gt;(</code><code>"Level"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>actionY.Returns&lt;</code><code>bool</code><code>&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>var</code> <code>changePersonStatusAction = contactType.EntityType.Collection.Action(</code><code>"ChangePersonStatus"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>changePersonStatusAction.Parameter&lt;</code><code>string</code><code>&gt;(</code><code>"Level"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>changePersonStatusAction.Returns&lt;</code><code>bool</code><code>&gt;();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EntitySetConfiguration&lt;Person&gt; persons = builder.EntitySet&lt;Person&gt;(</code><code>"Person"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>FunctionConfiguration myFirstFunction = persons.EntityType.Collection.Function(</code><code>"MyFirstFunction"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>myFirstFunction.ReturnsCollectionFromEntitySet&lt;Person&gt;(</code><code>"Person"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EntitySetConfiguration&lt;EntityWithEnum&gt; entitesWithEnum = builder.EntitySet&lt;EntityWithEnum&gt;(</code><code>"EntityWithEnum"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>FunctionConfiguration functionEntitesWithEnum = entitesWithEnum.EntityType.Collection.Function(</code><code>"PersonSearchPerPhoneType"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>functionEntitesWithEnum.Parameter&lt;PhoneNumberTypeEnum&gt;(</code><code>"PhoneNumberTypeEnum"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>functionEntitesWithEnum.ReturnsCollectionFromEntitySet&lt;EntityWithEnum&gt;(</code><code>"EntityWithEnum"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>builder.GetEdmModel();</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>And use the created OData EdmModel in the Configure method in the startup class.</p>
<div><div id="highlighter_245303"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p></td><td><div><p><code>public</code> <code>void</code> <code>Configure(IApplicationBuilder app)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseExceptionHandler(</code><code>"/Home/Error"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseCors(</code><code>"AllowAllOrigins"</code><code>);</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseSerilogRequestLogging();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseStaticFiles();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseRouting();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseAuthentication();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseAuthorization();</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>app.UseMvc(b =&gt;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>b.MapODataServiceRoute(</code><code>"odata"</code><code>, </code><code>"odata"</code><code>, </code></p><p><code>GetEdmModel(app.ApplicationServices)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>));</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>An ODataController controller can now be created for the OData API.</p>
<div><div id="highlighter_937613"><table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p></td><td><div><p><code>using</code> <code>System.Linq;</code></p><p><code>using</code> <code>Microsoft.AspNetCore.Mvc;</code></p><p><code>using</code>&nbsp; <code>AspNetCoreOData.Service.Database;</code></p><p><code>using</code>&nbsp; <code>AspNetCoreOData.Service.Models;</code></p><p><code>using</code> <code>Microsoft.AspNet.OData.Routing;</code></p><p><code>using</code> <code>Microsoft.AspNet.OData;</code></p><p><code>using</code> <code>Microsoft.AspNet.OData.Query;</code></p><p><code>namespace</code>&nbsp; <code>AspNetCoreOData.Service.Controllers</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ODataRoutePrefix(</code><code>"Person"</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>class</code> <code>PersonController : ODataController</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>private</code> <code>AdventureWorks2016Context _db;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>PersonController(AdventureWorks2016Context AdventureWorks2016Context)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>_db = AdventureWorks2016Context;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ODataRoute]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[EnableQuery(PageSize = 20, AllowedQueryOptions= AllowedQueryOptions.All&nbsp; )]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>IActionResult Get()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{&nbsp; </code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>Ok(_db.Person.AsQueryable());</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ODataRoute(</code><code>"({key})"</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[EnableQuery(PageSize = 20, AllowedQueryOptions = AllowedQueryOptions.All)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>IActionResult Get([FromODataUri] </code><code>int</code> <code>key)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>Ok(_db.Person.Find(key));</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[EnableQuery(PageSize = 20, AllowedQueryOptions = AllowedQueryOptions.All)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ODataRoute(</code><code>"Default.MyFirstFunction"</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[HttpGet]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>public</code> <code>IActionResult MyFirstFunction()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>Ok(_db.Person.Where(t =&gt; t.FirstName.StartsWith(</code><code>"K"</code><code>)));</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table></div></div>
<p>Start the application and the API can be queried in the browser. Here are some examples:</p>
<p><em><a href="https://localhost:44345/odata/Person?$select=FirstName,MiddleName,LastName" rel="nofollow">https://localhost:44345/odata/Person?$select=FirstName,MiddleName,LastName</a></em></p><p><em>
<p><a href="https://localhost:44345/odata?$metadata" rel="nofollow">https://localhost:44345/odata?$metadata</a></p>
<p><a href="https://localhost:44345/odata/Person?$expand=EmailAddress" rel="nofollow">https://localhost:44345/odata/Person?$expand=EmailAddress</a><br>
<a href="https://localhost:44345/odata/Person(7)" rel="nofollow">https://localhost:44345/odata/Person(7)</a>?$expand=EmailAddress<br>
<a href="https://localhost:44345/odata/Person?$expand=PersonPhone" rel="nofollow">https://localhost:44345/odata/Person?$expand=PersonPhone</a><br>
<a href="https://localhost:44345/odata/Person(7)" rel="nofollow">https://localhost:44345/odata/Person(7)</a>?$expand=PersonPhone($expand=PhoneNumberType)</p>
<p><a href="https://localhost:44345/odata/Person?$filter=FirstName" rel="nofollow">https://localhost:44345/odata/Person?$filter=FirstName</a> eq ‘Ken’<br>
<a href="https://localhost:44345/odata/Person?$filter=EmailAddress/any(q" rel="nofollow">https://localhost:44345/odata/Person?$filter=EmailAddress/any(q</a>: q/EmailAddress1 eq ‘kevin0@adventure-works.com’)</p>
<p><a href="https://localhost:44345/odata/Person?$expand=EmailAddress&amp;$filter=EmailAddress/any(q" rel="nofollow">https://localhost:44345/odata/Person?$expand=EmailAddress&amp;$filter=EmailAddress/any(q</a>: q/EmailAddress1 eq ‘kevin0@adventure-works.com’)</p>
<p><a href="https://localhost:44345/odata/PersonPhone?$filter=startswith(PhoneNumber" rel="nofollow">https://localhost:44345/odata/PersonPhone?$filter=startswith(PhoneNumber</a>, cast(’42’, Edm.String))</p>
</em></p><p><em><a href="https://localhost:44345/odata/Person?$count=true" rel="nofollow">https://localhost:44345/odata/Person?$count=true</a></em></p>
<p><img data-attachment-id="11372" data-permalink="https://damienbod.com/2018/10/12/odata-with-asp-net-core/aspnet_core_odata_01/" data-orig-file="https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png" data-orig-size="1103,815" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="aspnet_core_odata_01" data-image-description="" data-medium-file="https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=600" data-large-file="https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=640" src="https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=640&amp;h=473" alt="" width="640" height="473" srcset="https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=640&amp;h=473 640w, https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=150&amp;h=111 150w, https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=600&amp;h=443 600w, https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=768&amp;h=567 768w, https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png?w=1024&amp;h=757 1024w, https://damienbod.files.wordpress.com/2018/10/aspnet_core_odata_01.png 1103w" sizes="(max-width: 640px) 100vw, 640px"></p>
<p>This works without much effort and is easy to setup. In the next post, we will setup an OData client to consume the data.</p>
<p><strong>Links:</strong></p>
<p><a href="https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks" rel="nofollow">https://github.com/Microsoft/sql-server-samples/releases/tag/adventureworks</a></p>
<p><a href="https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/existing-db" rel="nofollow">https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/existing-db</a></p>
<p><a href="https://blogs.msdn.microsoft.com/odatateam/2018/07/03/asp-net-core-odata-now-available/" rel="nofollow">https://blogs.msdn.microsoft.com/odatateam/2018/07/03/asp-net-core-odata-now-available/</a></p>
<p><a href="http://odata.github.io/" rel="nofollow">http://odata.github.io/</a></p>
<p><a href="https://blogs.msdn.microsoft.com/odatateam/" rel="nofollow">https://blogs.msdn.microsoft.com/odatateam/</a></p>
<blockquote data-secret="IvJPFZdFze"><p><a href="http://azurecoder.net/2018/02/19/creating-odata-api-asp-net-core-2-0/">Creating an OData v4 API with ASP.NET Core 2.0</a></p></blockquote>

<p><a href="https://dotnetthoughts.net/getting-started-with-odata-in-aspnet-core/" rel="nofollow">https://dotnetthoughts.net/getting-started-with-odata-in-aspnet-core/</a></p>
<p><a href="https://github.com/damienbod/WebAPIODataV4" rel="nofollow">https://github.com/damienbod/WebAPIODataV4</a></p>

							
							
						</div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>