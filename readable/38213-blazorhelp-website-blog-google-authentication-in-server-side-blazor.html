<!DOCTYPE html>
<html lang="en">
<head>
    <title>
BlazorHelp Website &gt; Blog - Google Authentication in Server Side Blazor -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>BlazorHelp Website &gt; Blog - Google Authentication in Server Side Blazor</h1><div><div class="BlogBody"><acronym class="BlogPublished" title="10/3/2019 5:55 PM"><span class="BlogPubMonth"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryMonth">Oct</span></span><span class="BlogPubDate"><span id="dnn_ctr382_MainView_ViewEntry_lblEntryDay">3</span></span></acronym><p class="BlogSubHead"><span class="blog_author"><span id="dnn_ctr382_MainView_ViewEntry_lblPostedBy">Written by:</span><span id="dnn_ctr382_MainView_ViewEntry_lblUserID">Michael Washington</span></span><br><span id="dnn_ctr382_MainView_ViewEntry_lblDateTime" class="BlogDate">10/3/2019 5:55 PM</span>&nbsp;
  <a id="dnn_ctr382_MainView_ViewEntry_lnkRss" href="http://blazorhelpwebsite.com/Blog/tabid/61/rssid/1/Default.aspx" target="_blank"><img id="dnn_ctr382_MainView_ViewEntry_lnkRssIcon" src="/desktopmodules/Blog/Images/feed-icon-12x12.gif" alt="RssIcon"></a></p><p><img src="/images/GoogleLoginAnimation.gif"></p><p>You can log users into your server side <strong>Blazor</strong> application using <strong>Google authentication</strong>.  </p><p>Server-side <strong>Blazor</strong> provides options for deeper integration between the ‘client side’ and ‘server side’ code because the ‘client side’ code is <em>processed</em> server-side. With server-side <strong>Blazor</strong>, we end up using less code, and things are a lot less <em>complex</em> because we can <em>trust</em> that the end-user was not able to <em>alter</em> or <em>hack</em> the ‘client side’ code.  </p><p>If the ‘client side’ code says a user is who they say they are, we can trust them. Otherwise, we have to always make a ‘round trip’ to the server, before permitting operations or returning sensitive data. The ‘round trip’ is still being made (because the ‘client site’ code is being generated ‘server side’), but, our code structure is now cleaner and more streamlined.  </p><p><strong>Note:</strong> This example works <em><u>without</u> using</em> the <strong>Google+</strong> API that <strong>Google</strong> started to <a href="https://developers.google.com/+/api-shutdown">shut down</a>. This sample incorporates the work-around that <strong>Microsoft</strong> is in the process of rolling out officially. See <a href="https://github.com/aspnet/AspNetCore/issues/6486">this GitHub issue</a> for more information.  </p><p><strong>Note:</strong> Many examples, showing <strong>Google</strong> authentication in an .Net Core application, use the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.identity.signinmanager-1?view=aspnetcore-2.2">SignInManager</a>. The problem is, the <strong>SignInManager</strong> requires a data store. This example does not.  </p><h1>The Application</h1><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_72c06bfb-dd54-4ae2-bd14-45e02865d8c2.png" width="392" height="214"></p><p>Initially the user clicks the <strong>Login</strong> button.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_ad161951-a26f-4512-bac3-c6ecd723f5e5.png" width="412" height="375"></p><p>They are taken to the <strong>Google Login</strong> page where they enter their <strong>Google</strong> username and password.  </p><p><strong>Note:</strong> If the user is already logged into <strong>Google</strong>, they will be automatically logged in without the need to go through this step.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_930fa201-efe0-49af-9739-57ff9b929c72.png" width="496" height="195"></p><p>They are returned to the application.  </p><p>Their name, and if they have an <strong>Avatar</strong>, will display.  </p><p>The <strong>Logout</strong> button will also appear. Clicking the <strong>Logout</strong> button will log the user out of the application.  </p><h1>Create The Application</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_59a311f4-4387-490b-ad32-6ebda1db5aa1.png" width="82" height="91"></p><p>Open <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio 2019 (or higher)</a>.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_26d367c1-f173-4e62-95d1-8322c7102c63.png" width="344" height="94"></p><p>Select <strong>Create a new p</strong><strong>roject</strong>.  </p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4318/Windows-Live-Writer-80d4843c2355_E94F-image_f6857cb1-d388-4b22-97e3-15ae0482acb3.png" width="567" height="316"></p><p>Select <strong>Blazor App</strong>.  </p><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_cacca8aa-0265-4b05-9ec4-9e210b14a9c3.png" width="638" height="384"></p><p>Name the project <strong>BlazorGmail</strong>.  </p><h1>Add Nuget Package</h1><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_20e1a919-3efb-45b3-8935-6efe2b714e2a.png" width="314" height="268"></p><p><em>Right-click</em> on the <em>solution </em>node in the <strong>Solution Explorer</strong>, and select <strong>Manage NuGet Packages for Solution</strong>.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_0b645b1a-d1b1-471a-9a09-6d9eb7715f64.png" width="650" height="323"></p><p>Install:  </p><p><strong>Microsoft.AspNetCore.Authentication.Google</strong></p><h1>Set Up the Google Application</h1><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_9f4bdb6b-0d14-4ab7-9890-88372c0a2591.png" width="609" height="437"></p><p>You need to create a <strong>Google API Console project</strong> to obtain a <strong>client ID</strong>.  </p><p>Go to:  </p><p><a href="https://developers.google.com/identity/sign-in/web/devconsole-project">https://developers.google.com/identity/sign-in/web/devconsole-project</a></p><p>Sign in with your <strong>Google</strong> account and click <strong>CONFIGURE A PROJECT</strong>.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_109e311f-020b-4aa4-a0ff-c64a01b714e7.png" width="610" height="422"></p><p>Give the <strong>project</strong> a name.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_e59cb8be-3ebd-4ac9-b141-1fdd6bc129a3.png" width="619" height="301"></p><p>Fill in the information for the remaining screens  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_16169eb7-219c-4da6-95c1-b6a17705205d.png" width="473" height="174"></p><p>Select <strong>Other</strong> for <strong>OAuth client</strong>.  </p><p>Click the <strong>CREATE</strong> button.  </p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_0399cdf9-09ad-44e6-8bbd-55a558826781.png" width="497" height="350"></p><p>Copy and save the <strong>Client ID</strong> and <strong>Client Secret</strong> and click the <strong>DONE</strong> button.  </p><p><strong>Note:</strong> You can return to the configuration at anytime by going to:  </p><p><a href="https://console.developers.google.com">https://console.developers.google.com</a></p><h1>Configure the Authentication Pipeline</h1><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_70d50e9d-6511-4b4a-9c91-f8ab7c50aec0.png" width="235" height="309"></p><p>Open the <strong>appsettings.json</strong> file and change <u>all</u> the code to the following:</p><pre><pre>&nbsp;</pre><pre><pre>{
</pre><pre>  "<span>Google</span>": {
</pre><pre>    "<span>Instance</span>": "<span>https://accounts.google.com/o/oauth2/v2/auth</span>",
</pre><pre>    "<span>ClientId</span>": "<span>{{{ YOUR APP ID }}}</span>",
</pre><pre>    "<span>ClientSecret</span>": "<span>{{{ YOUR CLIENT SECRET }}}</span>",
</pre><pre>    "<span>CallbackPath</span>": "<span>/signin-google</span>"
</pre><pre>  },
</pre><pre>  "<span>Logging</span>": {
</pre><pre>    "<span>LogLevel</span>": {
</pre><pre>      "<span>Default</span>": "<span>Warning</span>",
</pre><pre>      "<span>Microsoft.Hosting.Lifetime</span>": "<span>Information</span>"
</pre><pre>    }
</pre><pre>  },
</pre><pre>  "<span>AllowedHosts</span>": "<span>*</span>"
</pre><pre>}</pre></pre><pre>&nbsp;</pre></pre><pre></pre><p class="readability-styled" style="display: inline;">Replace&nbsp; </p><strong>{{{ YOUR APP ID }}}</strong><p class="readability-styled" style="display: inline;"> with the </p><strong>Client ID </strong><p class="readability-styled" style="display: inline;">you saved earlier. 
</p><p>Replace&nbsp; <strong>{{{ YOUR CLIENT SECRET }}}</strong> with the <strong>Client Secret </strong>you saved earlier. 
</p><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_b7042593-e87f-474c-8f88-e9313c8fd641.png" width="233" height="324"></p><p>Open the <strong>Startup.cs</strong> file. 
</p><p>Add the following using statements to the top of the file:</p><pre><pre>&nbsp;</pre><pre><pre><pre><span>using</span> System.Net.Http;
</pre><pre><span>using</span> Microsoft.Extensions.Configuration;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication.Cookies;</pre></pre></pre><pre>&nbsp;</pre></pre><p>Add the following to the <strong>Startup</strong> class:</p><pre><pre>&nbsp;</pre><pre><pre><span>// To hold the values from the appsettings.json file</span></pre><pre><span>public</span> IConfiguration Configuration { <span>get</span>; }
</pre><pre><span>public</span> Startup(IConfiguration configuration)
</pre><pre>        {
</pre><pre>            Configuration = configuration;
</pre><pre>        }</pre></pre><pre>&nbsp;</pre></pre><p>Add the following to the bottom of <strong>public void ConfigureServices(IServiceCollection services)</strong> method: 
</p><pre><pre>            services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
</pre><pre>                .AddCookie();
</pre><pre></pre><pre>            services.AddAuthentication().AddGoogle(options =&gt;
</pre><pre>            {
</pre><pre>                options.ClientId = Configuration["<span>Google:ClientId</span>"];
</pre><pre>                options.ClientSecret = Configuration["<span>Google:ClientSecret</span>"];
</pre><pre>                options.ClaimActions.MapJsonKey("<span>urn:google:profile</span>", "<span>link</span>");
</pre><pre>                options.ClaimActions.MapJsonKey("<span>urn:google:image</span>", "<span>picture</span>");
</pre><pre>            });
</pre><pre></pre><pre><span>// From: https://github.com/aspnet/Blazor/issues/1554</span></pre><pre><span>// Adds HttpContextAccessor</span></pre><pre><span>// Used to determine if a user is logged in</span></pre><pre><span>// and what their username is</span></pre><pre>            services.AddHttpContextAccessor();
</pre><pre>            services.AddScoped&lt;HttpContextAccessor&gt;();
</pre><pre></pre><pre><span>// Required for HttpClient support in the Blazor Client project</span></pre><pre>            services.AddHttpClient();
</pre><pre>            services.AddScoped&lt;HttpClient&gt;();
</pre><pre></pre><pre><span>// Pass settings to other components</span></pre><pre>            services.AddSingleton&lt;IConfiguration&gt;(Configuration);</pre></pre><p>Add the following to the <strong>public void Configure(IApplicationBuilder app, IHostingEnvironment env)</strong> method (after the <strong>app.UseStaticFiles()</strong> line):</p><pre><pre>&nbsp;</pre><pre><pre>            app.UseCookiePolicy();
</pre><pre>            app.UseAuthentication();</pre></pre><pre>&nbsp;</pre></pre><p>&nbsp;<img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_889b8804-cf78-4b4f-9426-8d51e28ea1b1.png" width="157" height="86"></p><p><strong>Save</strong> the file. 
</p><p><strong>Rebuild</strong> the <strong>Solution</strong>. 
</p><p>It should build without errors. 
</p><h1>Create Login and Logout Pages</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_8330d97d-dc41-48cd-b4bb-1983455600db.png" width="253" height="484"></p><p>In the <strong>Pages</strong> folder, add the following pages using the following code: 
</p><h2><u>Login.cshtml</u></h2><pre><pre><pre>@page
</pre><pre>@model BlazorGmail.Server.Pages.LoginModel
</pre><pre>@{
</pre><pre>    ViewData["Title"] = "Log in";
</pre><pre>}
</pre><pre><span>&lt;</span><span>h2</span><span>&gt;</span>Login<span>&lt;/</span><span>h2</span><span>&gt;</span></pre></pre><pre></pre></pre><h4><u></u>&nbsp;</h4><h2><u>Login.cshtml.cs</u></h2><pre><pre><span>using</span> System;
</pre><pre><span>using</span> System.Collections.Generic;
</pre><pre><span>using</span> System.ComponentModel.DataAnnotations;
</pre><pre><span>using</span> System.Linq;
</pre><pre><span>using</span> System.Security.Claims;
</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication.Cookies;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authorization;
</pre><pre><span>using</span> Microsoft.AspNetCore.Identity;
</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc;
</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc.RazorPages;
</pre><pre></pre><pre><span>namespace</span> BlazorGmail.Server.Pages
</pre><pre>{
</pre><pre>    [AllowAnonymous]
</pre><pre><span>public</span><span>class</span> LoginModel : PageModel
</pre><pre>    {
</pre><pre><span>public</span> IActionResult OnGetAsync(<span>string</span> returnUrl = <span>null</span>)
</pre><pre>        {
</pre><pre><span>string</span> provider = "<span>Google</span>";
</pre><pre></pre><pre><span>// Request a redirect to the external login provider.</span></pre><pre>            var authenticationProperties = <span>new</span> AuthenticationProperties
</pre><pre>            {
</pre><pre>                RedirectUri = Url.Page("<span>./Login</span>", 
</pre><pre>                pageHandler: "<span>Callback</span>", 
</pre><pre>                values: <span>new</span> { returnUrl }),
</pre><pre>            };
</pre><pre></pre><pre><span>return</span><span>new</span> ChallengeResult(provider, authenticationProperties);
</pre><pre>        }
</pre><pre></pre><pre><span>public</span> async Task&lt;IActionResult&gt; OnGetCallbackAsync(
</pre><pre><span>string</span> returnUrl = <span>null</span>, <span>string</span> remoteError = <span>null</span>)
</pre><pre>        {
</pre><pre><span>// Get the information about the user from the external login provider</span></pre><pre>            var GoogleUser = <span>this</span>.User.Identities.FirstOrDefault();
</pre><pre></pre><pre><span>if</span> (GoogleUser.IsAuthenticated)
</pre><pre>            {
</pre><pre>                var authProperties = <span>new</span> AuthenticationProperties
</pre><pre>                {
</pre><pre>                    IsPersistent = <span>true</span>,
</pre><pre>                    RedirectUri = <span>this</span>.Request.Host.Value
</pre><pre>                };
</pre><pre></pre><pre>                await HttpContext.SignInAsync(
</pre><pre>                CookieAuthenticationDefaults.AuthenticationScheme,
</pre><pre><span>new</span> ClaimsPrincipal(GoogleUser),
</pre><pre>                authProperties);
</pre><pre>            }
</pre><pre></pre><pre><span>return</span> LocalRedirect("<span>/</span>");
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre><h2><u>Logout.cshtml</u></h2><pre><pre><pre>@page
</pre><pre>@model BlazorGmail.Server.Pages.LogoutModel
</pre><pre>@{
</pre><pre>    ViewData["Title"] = "Logout";
</pre><pre>}
</pre><pre></pre><pre><span>&lt;</span><span>h2</span><span>&gt;</span>Logout<span>&lt;/</span><span>h2</span><span>&gt;</span></pre><pre></pre><pre></pre></pre><pre>&nbsp;</pre></pre><h2><u>Logout.cshtml.cs</u></h2><pre><pre><span>using</span> System;
</pre><pre><span>using</span> System.Collections.Generic;
</pre><pre><span>using</span> System.Linq;
</pre><pre><span>using</span> System.Threading.Tasks;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication;
</pre><pre><span>using</span> Microsoft.AspNetCore.Authentication.Cookies;
</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc;
</pre><pre><span>using</span> Microsoft.AspNetCore.Mvc.RazorPages;
</pre><pre></pre><pre><span>namespace</span> BlazorGmail.Server.Pages
</pre><pre>{
</pre><pre><span>public</span><span>class</span> LogoutModel : PageModel
</pre><pre>    {
</pre><pre><span>public</span><span>string</span> ReturnUrl { <span>get</span>; <span>private</span><span>set</span>; }
</pre><pre></pre><pre><span>public</span> async Task&lt;IActionResult&gt; OnGetAsync(
</pre><pre><span>string</span> returnUrl = <span>null</span>)
</pre><pre>        {
</pre><pre>            returnUrl = returnUrl ?? Url.Content("<span>~/</span>");
</pre><pre></pre><pre><span>// Clear the existing external cookie</span></pre><pre><span>try</span></pre><pre>            {
</pre><pre>                await HttpContext
</pre><pre>                    .SignOutAsync(
</pre><pre>                    CookieAuthenticationDefaults.AuthenticationScheme);
</pre><pre>            }
</pre><pre><span>catch</span> (Exception ex)
</pre><pre>            {
</pre><pre><span>string</span> error = ex.Message;
</pre><pre>            }
</pre><pre></pre><pre><span>return</span> LocalRedirect("<span>/</span>");
</pre><pre>        }
</pre><pre>    }
</pre><pre>}</pre></pre><h1>Create Login Control</h1><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_813b3e32-efc5-4686-84b3-f3fbc5c4b9be.png" width="245" height="401"></p><p>In the <strong>Shared </strong>folder, add <strong>LoginControl.razor </strong>using the following code: 
</p><pre><pre>@using System.Security.Claims
</pre><pre>@using Microsoft.AspNetCore.Http
</pre><pre>@inject IHttpContextAccessor _httpContextAccessor
</pre><pre>@inject HttpClient Http
</pre><pre></pre><pre>@if (User.Identity.Name != null)
</pre><pre>{
</pre><pre><span>&lt;</span><span>img</span><span>src</span>=<span>"@Avatar"</span><span>/&gt;</span></pre><pre><span>&lt;</span><span>b</span><span>&gt;</span>You are logged in as: @GivenName @Surname<span>&lt;/</span><span>b</span><span>&gt;</span></pre><pre><span>&lt;</span><span>a</span><span>class</span>=<span>"ml-md-auto btn btn-primary"</span></pre><pre><span>href</span>=<span>"/Logout"</span></pre><pre><span>target</span>=<span>"_top"</span><span>&gt;</span>Logout<span>&lt;/</span><span>a</span><span>&gt;</span></pre><pre>}
</pre><pre>else
</pre><pre>{
</pre><pre><span>&lt;</span><span>a</span><span>class</span>=<span>"ml-md-auto btn btn-primary"</span></pre><pre><span>href</span>=<span>"/Login"</span></pre><pre><span>target</span>=<span>"_top"</span><span>&gt;</span>Login<span>&lt;/</span><span>a</span><span>&gt;</span></pre><pre>}</pre></pre><pre><pre><span>@code</span> {
</pre><pre><span>private</span> ClaimsPrincipal User;
</pre><pre><span>private</span><span>string</span> GivenName;
</pre><pre><span>private</span><span>string</span> Surname;
</pre><pre><span>private</span><span>string</span> Avatar;
</pre><pre></pre><pre><span>protected</span><span>override</span><span>void</span> OnInitialized()
</pre><pre>    {
</pre><pre><span>base</span>.OnInitialized();
</pre><pre></pre><pre><span>try</span></pre><pre>        {
</pre><pre><span>// Set the user to determine if they are logged in</span></pre><pre>            User = _httpContextAccessor.HttpContext.User;
</pre><pre></pre><pre><span>// Try to get the GivenName</span></pre><pre>            var givenName =
</pre><pre>                _httpContextAccessor.HttpContext.User
</pre><pre>                .FindFirst(ClaimTypes.GivenName);
</pre><pre></pre><pre><span>if</span> (givenName != <span>null</span>)
</pre><pre>            {
</pre><pre>                GivenName = givenName.Value;
</pre><pre>            }
</pre><pre><span>else</span></pre><pre>            {
</pre><pre>                GivenName = User.Identity.Name;
</pre><pre>            }
</pre><pre></pre><pre><span>// Try to get the Surname</span></pre><pre>            var surname =
</pre><pre>                _httpContextAccessor.HttpContext.User
</pre><pre>                .FindFirst(ClaimTypes.Surname);
</pre><pre></pre><pre><span>if</span> (surname != <span>null</span>)
</pre><pre>            {
</pre><pre>                Surname = surname.Value;
</pre><pre>            }
</pre><pre><span>else</span></pre><pre>            {
</pre><pre>                Surname = "<span></span>";
</pre><pre>            }
</pre><pre></pre><pre><span>// Try to get Avatar</span></pre><pre>            var avatar =
</pre><pre>            _httpContextAccessor.HttpContext.User
</pre><pre>            .FindFirst("<span>urn:google:image</span>");
</pre><pre></pre><pre><span>if</span> (avatar != <span>null</span>)
</pre><pre>            {
</pre><pre>                Avatar = avatar.Value;
</pre><pre>            }
</pre><pre><span>else</span></pre><pre>            {
</pre><pre>                Avatar = "<span></span>";
</pre><pre>            }
</pre><pre>        }
</pre><pre><span>catch</span> { }
</pre><pre>    }
</pre><pre>}</pre></pre><p><img title="image" border="0" alt="image" src="/Portals/0/Blog/Files/1/4356/Windows-Live-Writer-01727bd966e7_104D3-image_ab7b0368-ff54-4382-a585-e6bcb80305b7.png" width="201" height="98"></p><p>To display the <strong>Login</strong> control, open <strong>Shared/MainLayout.razor </strong>and change <em>all</em> the code to the following: 
</p><pre><pre><pre>@inherits LayoutComponentBase
</pre><pre></pre><pre>&lt;div <span>class</span>="<span>sidebar</span>"&gt;
</pre><pre>    &lt;NavMenu /&gt;
</pre><pre>&lt;/div&gt;
</pre><pre></pre><pre>&lt;div <span>class</span>="<span>main</span>"&gt;
</pre><pre></pre><pre>    &lt;div <span>class</span>="<span>top-row px-4</span>"&gt;
</pre><pre>        &lt;!-- ******************************** --&gt;
</pre><pre>        &lt;LoginControl /&gt;
</pre><pre>        &lt;!-- ******************************** --&gt;
</pre><pre>    &lt;/div&gt;
</pre><pre></pre><pre>    &lt;div <span>class</span>="<span>content px-4</span>"&gt;
</pre><pre>        @Body
</pre><pre>    &lt;/div&gt;
</pre><pre>&lt;/div&gt;</pre></pre><pre></pre></pre><h3>&nbsp;</h3><h1>Links</h1><p><strong><a href="https://blazor.net/">Blazor.net</a></strong></p><p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/social/google-logins?view=aspnetcore-3.0">Google external login setup in ASP.NET Core</a></p><p><a href="https://console.developers.google.com/">Google Developers Dashboard</a></p><h1>Download</h1><p>The project is available at <a href="/Downloads.aspx">http://BlazorHelpWebsite.com/Downloads.aspx</a></p><p>You must have <strong>Visual Studio 2019 </strong>(or higher) installed to run the code.</p><div id="dnn_ctr382_MainView_ViewEntry_pnlComments"><p><a href="#AddComment"><span id="dnn_ctr382_MainView_ViewEntry_lblComments" class="BlogComments">12 comment(s) so far...</span></a></p><br><table id="dnn_ctr382_MainView_ViewEntry_lstComments" cellspacing="0" width="100%"><tbody><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_0" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_0" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Hi, Michael, thank you for your step by step tutorial to integrate Google authentication in server-side Blazor. I reproduce all of your steps, but when I click at "Login", the app is trying to get google auth screen, but end in default MainLayout message "Sorry, there's nothing at this address".
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_0" class="NormalBold">By Alexander on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_0" class="Normal">11/7/2019 4:09 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_1" class="BlogBubbleOwner"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_1" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       @Alexander - Please download the code from the download page on this site and compare it to your own.
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_1" class="NormalBold">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_1" class="Normal">11/7/2019 4:09 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_2" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_2" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Hi, again Michael, I wrote a comment before a few hours, that I can`t log in with google. Everything now is ok. I am not sure what was the problem, maybe the order in ConfigureService, or this line in .csproj - . I am not sure but now is working and I am going to resize the avatar because it is too big and somehow uses google account and relates to my own app user and store in EntityFramework to have more data. Thank you for your post :)!
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_2" class="NormalBold">By Sashko on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_2" class="Normal">11/7/2019 4:37 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_3" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_3" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Hi, Michael, as I mentioned last week, all of your code is working properly. I am trying for many hours to add IdentityCore, and use the extended user that I have been created and the "Roles". The problem is that every time when I am getting the callback from google the "ClaimsPrincipal PageModel.User" is empty. When I comment out "services.AddIdentityCore()", everything is fine, but I cannot use identity functions. I don`t want to use the build-in Identity template, because I only want Google login, after that, I will get the user from my db and used additional properties that I have. I was close to success, but I get "InvalidOperationException: No sign-in authentication handler is registered for the scheme 'IdentityApplication'. The registered sign-in schemes are: Cookies". Sorry for the long comment, but I already spent many hours and decide to write you. Thank you for your time :).
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_3" class="NormalBold">By Sashko on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_3" class="Normal">11/12/2019 5:06 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_4" class="BlogBubbleOwner"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_4" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       @Sashko - I am also unable to use any of the built-in Microsoft identity assemblies or code with this Google log in code. You can see how I handle everything 'manually' in the following project: https://github.com/ADefWebserver/FatSecretDataExporter/blob/master/FatSecretWebApp/Pages/GetData.razor
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_4" class="NormalBold">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_4" class="Normal">11/12/2019 5:08 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_5" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_5" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Finally, it is ready! Michael, I succeed, and now I have:<br>1. Identity.<br>2. External login from Google.</p><p>The difference is this, that I scaffolded Identity, make some changes on Register, Login, External Login, make some other edits, and now the system leans only on google accounts, even I can put a role when a user is login for the first time in the system. If you want I can write the steps, or make a Github repo with a sample project. Thank you for your time and tutorials.</p><p>P.S. Check your site security code function because every time, my first attempt is failed, and after that in second try, it is okay.
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_5" class="NormalBold">By Sashko on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_5" class="Normal">11/12/2019 12:05 PM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_6" class="BlogBubbleOwner"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_6" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       @Sashko  - Great news. A GitHub repo would be really helpful for people
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_6" class="NormalBold">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_6" class="Normal">11/12/2019 12:06 PM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_7" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_7" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Thank you for this great explanation. I'm restricting my users to be from my domain (Google G Suite) and I added a custom role (MyAppAdmin) to a user in Google G Suite. How can I get the role in Blazor? In `OnCreatingTicket` `context.User` doesn't contain this role. </p><p>Second question. Because we're limiting access to our domain users we can block or delete users. The app is now never checking for this. How to configure that the user/cookie is validated now and then? I posted this also on https://stackoverflow.com/questions/59194273/how-to-validate-if-a-user-logged-in-with-google-is-still-valid</p><p>Again, this is a great site. I will also purchase your book in a few days.
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_7" class="NormalBold">By Paul Meems on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_7" class="Normal">12/5/2019 6:17 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_8" class="BlogBubbleOwner"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_8" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       @Paul Meems - You have to enable the ability to call Google APIs (https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.group) to get this information, but, before you can do that, the G-Suite Domain Admin has to authorize that access using https://developers.google.com/admin-sdk/directory/v1/guides/authorizing 
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_8" class="NormalBold">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_8" class="Normal">12/5/2019 6:28 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_9" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_9" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Thanks again for your help. Just to let you know I've set up a new repo at https://bitbucket.org/pmeems/matblazorgooglegsuite/src/develop/ merging your examples and other samples I've found to create a Material Design Blazor application using Google Login and restrict to a specific domain. So far it works great, except for the extras like checking if the user is still valid and getting the roles from Google.<br>When you've got the time could you show me how to get the roles and validate the user?
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_9" class="NormalBold">By <a href="https://bitbucket.org/pmeems/matblazorgooglegsuite/src/develop/" rel="nofollow">Paul Meems</a> on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_9" class="Normal">12/9/2019 9:05 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_10" class="BlogBubbleOwner"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_10" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       @Paul Meems - I will respond to your post on Stack Overflow at: https://stackoverflow.com/questions/59194273/how-to-validate-if-a-user-logged-in-with-google-is-still-valid/59197327?noredirect=1#comment104701558_59197327
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_10" class="NormalBold">By Michael Washington on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_10" class="Normal">12/9/2019 9:07 AM</span></cite></div></td></tr><tr><td><div id="dnn_ctr382_MainView_ViewEntry_lstComments_divBlogBubble_11" class="BlogBubble"><blockquote><p><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblTitle_11" class="NormalBold">Re: Google Authentication in Server Side Blazor</span></p><p>
       Hi, Michael, sorry for the delay for the GitHub repository, that I was told you. The repo is ready and there is a simple project based on this post, and scaffolded Identity ready for customization. I used in other project and so far everything is okay with one exception. From a few days, I cannot log in with Google(when the browser is opened by application), because of cookie warning("A cookie associated with a cross-site resource at http://accounts.youtube.com/ was set without the `SameSite` attribute."). I try to fix this, but for now, nothing is happening. When I open a new browser window everything is fine.<br>This is the link for the repository if somebody wants to see it: <br>https://github.com/Alexander-Lazarov88/CustomGoogleAuthentication<br>Thank you, again for your support and blog posts :)!
      </p></blockquote><cite><span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblUserName_11" class="NormalBold">By Sashko on </span>
      &nbsp;
      <span id="dnn_ctr382_MainView_ViewEntry_lstComments_lblCommentDate_11" class="Normal">12/29/2019 9:33 AM</span></cite></div></td></tr></tbody></table></div></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>