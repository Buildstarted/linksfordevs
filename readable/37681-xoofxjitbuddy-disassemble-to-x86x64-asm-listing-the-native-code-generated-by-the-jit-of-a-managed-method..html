<!DOCTYPE html>
<html lang="en">
<head>
    <title>
xoofx/JitBuddy: Disassemble to x86/x64 ASM listing the native code generated by the JIT of a managed method. -
linksfor.dev(s)
    </title>
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <div id="readOverlay" class="style-ebook"><div id="readInner" class="margin-medium size-medium"><h1>xoofx/JitBuddy: Disassemble to x86/x64 ASM listing the native code generated by the JIT of a managed method.</h1><div><div id="" class="markdown-body entry-content p-5"><p><a target="_blank" rel="noopener noreferrer" href="/xoofx/JitBuddy/blob/master/img/JitBuddy.png"><img align="right" width="160px" height="160px" src="/xoofx/JitBuddy/raw/master/img/JitBuddy.png"></a></p><p>JitBuddy provides a small helper method to disassemble to a x86/x64 ASM listing the native code generated by the JIT of  a managed method.</p><div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span><span class="pl-en">System</span>;
<span class="pl-k">using</span><span class="pl-en">System</span>.<span class="pl-en">Reflection</span>;
<span class="pl-k">using</span><span class="pl-en">JitBuddy</span>;

<span class="pl-k">namespace</span><span class="pl-en">JitBuddyExample</span>
{
    <span class="pl-k">public</span><span class="pl-k">class</span><span class="pl-en">Program</span>
    {
        <span class="pl-k">public</span><span class="pl-k">static</span><span class="pl-k">int</span><span class="pl-en">Add</span>(<span class="pl-k">int</span><span class="pl-smi">a</span>, <span class="pl-k">int</span><span class="pl-smi">b</span>)
        {
            <span class="pl-k">return</span><span class="pl-smi">a</span><span class="pl-k">+</span><span class="pl-smi">b</span>;
        }
        
        <span class="pl-k">static</span><span class="pl-k">void</span><span class="pl-en">Main</span>()
        {
            <span class="pl-k">var</span><span class="pl-smi">method</span><span class="pl-k">=</span><span class="pl-k">typeof</span>(<span class="pl-en">Program</span>).<span class="pl-en">GetMethod</span>(<span class="pl-s"><span class="pl-pds">"</span>Add<span class="pl-pds">"</span></span>, <span class="pl-smi">BindingFlags</span>.<span class="pl-smi">Public</span><span class="pl-k">|</span><span class="pl-smi">BindingFlags</span>.<span class="pl-smi">Static</span>);
            <span class="pl-smi">Console</span>.<span class="pl-en">WriteLine</span>(<span class="pl-smi">method</span>.<span class="pl-en">ToAsm</span>());
        }
   }
}</pre></div><p>will produce the following output:</p><pre><code>00007FFD515B3FB0 lea       eax,[rcx+rdx]
00007FFD515B3FB3 ret
</code></pre><h2><a id="user-content-usage" class="anchor" aria-hidden="true" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Usage</h2><blockquote><p>Starting with .NET Core 3.0 Tiered compilation is enabled and you won't get the best ASM when running this code
In order to check the assembly, you should disable tiered compilation (that will fallback to best tiered model)
by setting the environment variable <code>set COMPlus_TieredCompilation=0</code></p></blockquote><div class="highlight highlight-source-cs"><pre><span class="pl-k">var</span><span class="pl-smi">method</span><span class="pl-k">=</span> ...; <span class="pl-c"><span class="pl-c">//</span> Get a MethodInfo via typeof(XXX).GetMethod(...)</span><span class="pl-k">var</span><span class="pl-smi">asm</span><span class="pl-k">=</span><span class="pl-smi">method</span>.<span class="pl-en">ToAsm</span>();</pre></div><h2><a id="user-content-caveats" class="anchor" aria-hidden="true" href="#caveats"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caveats</h2><ul><li>On Linux, JitBuddy only works (for now) on CoreCLR 3.0, CoreCLR 2.0-2.2 seem to not be properly supported by ClrMd: <a href="https://github.com/microsoft/clrmd/issues/303">#303</a></li></ul><h2><a id="user-content-license" class="anchor" aria-hidden="true" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>License</h2><p>This software is released under the <a href="http://opensource.org/licenses/BSD-2-Clause" rel="nofollow">BSD-Clause 2 license</a>.</p><h2><a id="user-content-credits" class="anchor" aria-hidden="true" href="#credits"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Credits</h2><p>JitBuddy is a one file simple wrapper of the following amazing library:</p><p>The Logo <code>processor</code> by <a href="https://thenounproject.com/ibrandify" rel="nofollow">ibrandify</a> from the Noun Project</p><h2><a id="user-content-author" class="anchor" aria-hidden="true" href="#author"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Author</h2><p>Alexandre Mutel aka <a href="http://xoofx.com" rel="nofollow">xoofx</a>.</p></div></div></div></div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
    </footer>
    
    <script>
        (function () {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function () {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) { }
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>