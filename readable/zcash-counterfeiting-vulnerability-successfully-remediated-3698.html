<!DOCTYPE html>
<html lang="en">
<head>
    <title>
Zcash Counterfeiting Vulnerability Successfully Remediated - Electric Coin Company - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Zcash Counterfeiting Vulnerability Successfully Remediated - Electric Coin Company - linksfor.dev(s)"/>
    <meta property="og:description" content="Eleven months ago we discovered a counterfeiting vulnerability in the cryptography underlying some kinds of zero-knowledge proofs. This post provides details on the vulnerability, how we fixed it and the steps taken to protect Zcash users."/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://z.cash/blog/zcash-counterfeiting-vulnerability-successfully-remediated/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1>
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - Zcash Counterfeiting Vulnerability Successfully Remediated - Electric Coin Company</title>
<div class="readable">
        <h1>Zcash Counterfeiting Vulnerability Successfully Remediated - Electric Coin Company</h1>
            <div>Reading time: 29-37 minutes</div>
        <div>Posted here: 27 Feb 2019</div>
        <p><a href="https://z.cash/blog/zcash-counterfeiting-vulnerability-successfully-remediated/">https://z.cash/blog/zcash-counterfeiting-vulnerability-successfully-remediated/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div>
		<div>
			<div>
				
<h2>Document Outline:</h2>



<ul><li><a href="#summary">Summary</a></li><li><a href="#background">Background</a></li><li><a href="#counterfeiting-vulnerability-details">Counterfeiting Vulnerability Details</a></li><li><a href="#third-party-disclosure">Third Party Disclosure</a></li><li><a href="#timeline-of-events">Timeline of Events</a></li><li><a href="#list-of-references">List of References</a></li><li><a href="#technical-details">Technical Details of CVE-2019-7167</a></li><li><a href="#correspondence-horizen-komodo">Correspondence to Horizen and Komodo</a></li></ul>



<h2 id="summary">Summary</h2>



<p>Eleven months ago we discovered a counterfeiting vulnerability in the cryptography underlying some kinds of zero-knowledge proofs. This post provides details on the vulnerability, how we fixed it and the steps taken to protect Zcash users. <br></p>



<p>The counterfeiting vulnerability was fixed by the Sapling network upgrade that activated on October 28th, 2018. The vulnerability was specific to counterfeiting and did not affect user privacy in any way. Prior to its remediation, an attacker could have created fake Zcash without being detected. <strong>The counterfeiting vulnerability has been fully remediated in Zcash and no action is required by Zcash users</strong>.<br></p>



<p>The counterfeiting vulnerability was discovered by a cryptographer employed by the Zerocoin Electric Coin Company (aka The Zcash Company) on March 1st, 2018. It was not reported publicly at the time in order to protect against it being exploited prior to its remediation, and to provide information and remediated code to other projects that were also vulnerable. We employed stringent operational security measures to keep its existence a secret, even from our own engineers.<br></p>



<p>We believe that no one else was aware of the vulnerability and that no counterfeiting occurred in Zcash for the following reasons:<br></p>



<ul><li>Discovery of the vulnerability would have required a high level of technical and cryptographic sophistication that very few people possess.</li><li>The vulnerability had existed for years but was undiscovered by numerous expert cryptographers, scientists, third-party auditors, and third-party engineering teams who initiated new projects based upon the Zcash code.</li><li>The Zcash Company has seen no evidence that counterfeiting has occurred as might be discovered by monitoring the the total amount of Zcash held in Sprout addresses (i.e., the Sprout shielded pool). As long as the value in the shielded pools are greater than zero, no counterfeiting has been detected. Bitfly’s <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://zcha.in/statistics/network" target="_blank">Zcha.in displays these values on the network statistics page</a>, and Zcash nodes report them in the output of the <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://zcash.readthedocs.io/en/latest/rtd_pages/sapling_turnstile.html" target="_blank">getblockchaininfo command</a>.</li><li>Upon discovering the vulnerability, the Zcash Company took extraordinary measures to minimize the possibility of exploitation. The specifics of our steps taken are documented in the detail below.</li><li>The Zcash Company studied the blockchain for evidence of exploitation: An attack might leave a specific kind of footprint. We found no such footprint.</li></ul>



<p>Although we believe that no counterfeiting occurred, we are monitoring pool totals and will act in accordance with our <a href="https://z.cash/blog/defense-against-counterfeiting-in-shielded-pools/">published defense against counterfeiting</a> in an effort to preserve the monetary supply.<br></p>



<p>Zcash makes use of the most sophisticated and novel cryptography available on a public blockchain. Pushing cryptographic boundaries is inherently risky and user safety is of highest importance for the Zcash Company. We believe that the steps we have taken to mitigate the issue while working to ensure the safety of Zcash users has been successful. More information on the specific events that transpired from the initial discovery of the counterfeiting vulnerability through this disclosure will be covered in a future post.</p>



<h3>Key Points:</h3>



<ul><li>A counterfeiting vulnerability was discovered in Zcash by a Zcash Company cryptographer.</li><li>The counterfeiting vulnerability has been fully remediated in Zcash and no action is required by Zcash users.</li><li>The successful remediation for Sprout addresses was introduced by the Zcash Company in the Zcash Sapling upgrade that occurred on the 28th of October, 2018.</li><li>The vulnerability was specific to counterfeiting and its exploitation would not have impacted privacy.</li><li>Zcash has not been susceptible to this attack since the Sapling activation.</li><li>We have found no evidence that the vulnerability was discovered by anyone else or that counterfeiting occurred.</li><li>The Zcash Company used best practices in operational security to keep this information private, and responsible disclosure to share it with two affected projects.</li></ul>



<h2 id="background">Background</h2>



<p>On March 1, 2018, Ariel Gabizon, a cryptographer employed by the Zcash Company at the time, discovered a subtle cryptographic flaw in the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] paper that describes the zk-SNARK construction used in the original launch of Zcash. The flaw allows an attacker to create counterfeit shielded value in any system that depends on parameters which are generated as described by the paper.</p>



<p>This vulnerability is so subtle that it evaded years of analysis by expert cryptographers focused on zero-knowledge proving systems and zk-SNARKs. In an analysis [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2015/437" target="_blank">Parno15</a>] in 2015, Bryan Parno from Microsoft Research discovered a different mistake in the paper. However, the vulnerability we discovered appears to have evaded his analysis. The vulnerability also appears in the subversion zero-knowledge SNARK scheme of [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/587" target="_blank">Fuchsbauer17</a>], where an adaptation of [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] inherits the flaw. The vulnerability also appears in the ADSNARK construction described in [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2014/617" target="_blank">BBFR14</a>]. Finally, the vulnerability evaded the Zcash Company’s own cryptography team, which includes experts in the field that had<a href="https://z.cash/blog/fixing-zcash-vulns/"> identified several flaws in other parts of the system</a>.<br></p>



<p>Importantly, the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] construction did not have a dedicated security proof, as noted in [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2015/437" target="_blank">Parno15</a>], and relied mainly on the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/279" target="_blank">PGHR13</a>] security proof and the similarity between the two schemes. The Zcash Company team did attempt to write a security proof in [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">BGG17</a>], but it did not uncover this vulnerability. Zcash has since upgraded to a new proving system [<a href="https://eprint.iacr.org/2016/260" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Groth16</a>] which has multiple independent proofs and significantly better analysis.<br></p>



<p>After finding the vulnerability, Ariel immediately contacted another cryptographer at the Zcash Company, Sean Bowe. After Sean confirmed the existence of the vulnerability, Zooko Wilcox (CEO of the Zcash Company) and Nathan Wilcox (CTO of the Zcash Company) were briefed. Through careful coordination, the counterfeiting vulnerability was mitigated in the Zcash network without any known further disclosure outside this group of four people.<br></p>



<p>With the activation of Sapling, Sprout transactions were moved onto the new [<a href="https://eprint.iacr.org/2016/260" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Groth16</a>] proving system, fixing the issue on the Zcash network as described below.<br></p>



<p>To exploit the counterfeiting vulnerability, an attacker would have needed to possess information found in the large MPC protocol transcript that was made available shortly after the launch of Zcash. This transcript had not been widely downloaded and was removed from public availability immediately upon discovery of the vulnerability to make it more difficult to exploit. The Zcash Company adopted and maintained a cover story that the transcript was missing due to accidental deletion. The transcript was later reconstructed from DVDs collected from the participants of the original ceremony and posted following the Sapling activation. &nbsp;<br></p>



<p>We have been monitoring the total of funds in the Sprout pool against time and have not found any indication that any counterfeiting activity has taken place. </p>



<h2 id="counterfeiting-vulnerability-details">Counterfeiting Vulnerability Details</h2>



<p>The [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] parameter setup algorithm, as described by the paper, mistakenly produces extra elements that violate the soundness of the proving system. The construction described by [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] Appendix B is a variant of the [<a href="https://eprint.iacr.org/2013/279" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">PGHR13</a>] zk-SNARK scheme with modifications to improve performance and adapt the scheme for the asymmetric pairing setting. This scheme was used in the original launch of Zcash and has been independently implemented by several other projects.<br></p>



<p>Ariel Gabizon, a cryptographer employed by the Zcash Company at the time of discovery, uncovered a soundness vulnerability. The key generation procedure of [<a href="https://eprint.iacr.org/2013/879" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">BCTV14</a>], in step 3, produces various elements that are the result of evaluating polynomials related to the statement being proven. Some of these elements are unused by the prover and were included by mistake; but their presence allows a cheating prover to circumvent a consistency check, and thereby transform the proof of one statement into a valid-looking proof of a different statement. This breaks the soundness of the proving system.<br></p>



<p>The [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">BGG17</a>] multi-party computation (MPC) protocol that produced Sprout parameters for the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] construction follows the paper’s setup procedure, including the computation of the extra elements. These are not included in the actual parameters distributed to Zcash nodes since they are omitted from the parameter file format used by the proving routine implementation of [<a href="https://eprint.iacr.org/2013/879" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">BCTV14</a>] in the libsnark library (used by Sprout). However, these elements do appear in the MPC ceremony transcript. Consequently, anyone with access to the ceremony transcript would have been able to create false proofs.<br></p>



<h3>What is affected?</h3>



<p>While Zcash is no longer affected, any project that depends on the MPC ceremony used by the original Sprout system that was distributed in the initial launch of Zcash is vulnerable. This original Sprout system for shielded funds is comprised of the original Sprout circuit, the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] proving system using libsnark, and the parameters generated by an MPC ceremony [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">BGG17</a>]. It was used by the 1.x series of Zcash software (which also carried the “Sprout” name).<br></p>



<p>The algorithm described in [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>], before the update corresponding to this disclosure, is vulnerable (though its <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/scipr-lab/libsnark" target="_blank">libsnark</a> implementation, when used with its built-in parameter generation is not). The vulnerability was included in some independent implementations of [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>], such as [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/iden3/snarkjs" target="_blank">snarkjs</a>], even though they do not require an MPC. Similar flaws can be found in the [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2014/617" target="_blank">BBFR14</a>] and [<a href="https://eprint.iacr.org/2017/587" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Fuchsbauer17</a>] zk-SNARK schemes.</p>



<p>We do not have an exhaustive list of all systems affected by this vulnerability, and we encourage all users, developers and maintainers of systems using [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] to take the time to triage this issue and check if they are affected.</p>



<h4>Resources:</h4>



<p><a href="https://github.com/zcash/zcash/tree/master/src/zcash/circuit" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Original Sprout circuit implementation</a></p>



<p>Original Sprout zk-SNARK parameters: <a href="https://z.cash/downloads/sprout-proving.key">proving key</a> and <a href="https://z.cash/downloads/sprout-verifying.key">verifying key</a>. </p>



<p><a href="https://github.com/zcash/zcash/blob/master/src/zcash/JoinSplit.cpp" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Sprout proving and verifying routines</a> </p>



<p>[<a href="https://eprint.iacr.org/2013/879" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">BCTV14</a>]</p>



<p><a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/scipr-lab/libsnark/tree/master/libsnark/zk_proof_systems/ppzksnark" target="_blank">libsnark proving system</a> and its <a href="https://github.com/zcash/zcash/tree/master/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Zcash fork</a></p>



<h3>What is not affected?</h3>



<p>The newer Sprout-on-Groth16 system used by Zcash mainnet for Sprout addresses ever since the Sapling activation (block 419200 at 28 Oct 2018) is not affected by the counterfeiting vulnerability. It uses a new Sprout circuit, that runs on the Groth16 proving system, with new parameters, and operates on the BLS12-381 curve implemented in the Bellman library. The newer Sapling system for shielded funds, activated at the same time and using a new address format, is not vulnerable either.<br></p>



<p>The vulnerability is not present in the algorithms of [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/279" target="_blank">PGHR13</a>] (which underlies [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>]), nor in [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/507" target="_blank">BCGTV13</a>], which used similar techniques. It is also not present in other zk-SNARKs constructions, such as [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/540.pdf" target="_blank">GM17</a>] or [<a href="https://eprint.iacr.org/2018/187" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">BG18</a>], or in zero-knowledge proof systems that do not rely on a structured reference string. It is not present in libsnark when used with its built-in parameter generator.<br></p>



<h4>Resources:</h4>



<p><a href="https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">New Sprout-on-Groth16 circuit implementation</a></p>



<p><a href="https://z.cash/downloads/sprout-groth16.params" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">New Sprout-on-Groth16 zk-SNARK parameters</a> </p>



<p><a href="https://github.com/zcash/librustzcash" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">New Sprout-on-Groth16 proving and verifying routines</a> </p>



<p><a href="https://github.com/zkcrypto/bellman" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">Groth16 proving system</a> </p>



<h2 id="third-party-disclosure">Third Party Disclosure</h2>



<p>An analysis of the market cap of affected projects revealed that we could reach more than a two thirds majority of affected capital with only two disclosures: Horizen, with whom we already had a reciprocal vulnerability disclosure agreement, and Komodo who we worked with to form a disclosure agreement in order to disclose this issue to them privately.<br></p>



<p>We established a ninety-day maximum public disclosure timeline with both parties, and provided the conditions required for a workable solution.<br></p>



<p>Further disclosure would have significantly increased the risk of exploitation of the majority of capital for much smaller gains in terms of coverage of users and capital. To protect the shielded pools of these and other projects, exact details of the cause of the vulnerability were redacted from the private disclosures. It appears that both Horizen and Komodo have taken appropriate actions per our recommendation. We recommend that third parties including affected projects, wallets, and exchanges, carefully consider how best to work through the upgrades needed to fix this issue.</p>



<h2 id="timeline-of-events">Timeline of Events</h2>



<h3>01 March 2018<br></h3>



<p>Ariel Gabizon, a cryptographer working for the Zcash Company, discovered the flaw while attending the Financial Cryptography 2018 conference, where he had been invited to present [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">BGG17</a>] to the Bitcoin’18 workshop. Sean Bowe, a cryptographer at the Zcash Company, and Zooko Wilcox, the CEO of the Zcash Company, were also attending the conference.</p>



<p>The issue was discovered by Ariel the night before his presentation, and he contacted Sean to confirm. Sean met Ariel in person and the two contacted Zooko immediately. Zooko then met Sean and Ariel in person to determine a response strategy. It was quickly determined that the transcript (which would allow an adversary to create false proofs) should be deleted from where it had been publicly made available by the company, since it appeared unlikely that many had downloaded it until that point. Zooko contacted Nathan Wilcox, the CTO of the Zcash Company, to ask him to delete the transcript. <br></p>



<h3>02 March 2018 – 27 October 2018<br></h3>



<p>Nathan deleted the transcript under a coinciding operational security cover story. <br></p>



<p>Sean had an additional backup of the transcript, which was later transferred into the dual possession of Sean and Zooko (Sean kept an encryption key, while Zooko deposited the USB in a safe deposit box) until it was later decided to destroy the backup entirely.</p>



<p>Two mitigation strategies were proposed. Ariel proposed a mitigation which involved an emergency hardfork that required users to switch to new zk-SNARK parameters that did not suffer from the vulnerability, by re-randomizing or replacing the existing parameters in a subsequent ceremony. Sean proposed that the mitigation be covertly included in the Sapling network upgrade by switching to the Groth16 proving system and parameters constructed in the upcoming Sapling ceremony. The team agreed to adopt Sean’s recommendation.</p>



<p>Covert mitigations were developed and deployed without further known disclosures beyond these four individuals. <br></p>



<h3>28 October 2018<br></h3>



<p>The Sapling network upgrade activated successfully on the Zcash mainnet, removing the counterfeiting vulnerability.<br></p>



<h3>01 November 2018</h3>



<p>The director of product security at the Zcash Company, Benjamin Winston, was briefed on the vulnerability and worked with the existing team to prepare disclosure packages for other affected projects. <br></p>



<h3>09 November 2018<br></h3>



<p>Josh Swihart, vice president of marketing and business development at the Zcash Company was briefed on the vulnerability in order to coordinate and prepare communications for two possible scenarios: full disclosure (this and related communications), or a leak by the parties to which information was initially released prior to the full disclosure date. <br></p>



<h3>13 November 2018<br></h3>



<p>The Zcash Company disclosed the impact and fix path of this issue to Horizen’s (previously known as ZenCash) security team (security@zencash.com) and Komodo (ca333@komodoplatform.com) using PGP encrypted email.<br></p>



<p>The Zcash Company did not disclose the specifics of the vulnerability, only its existence and our recommendation to upgrade their proving system to Groth16. We also did not tell them who else was notified. The <a href="#correspondence-horizen-komodo">complete message and disclosure sent to both Horizen and Komodo</a> is copied below.<br></p>



<p>Three hours later, Zencash responded to say that they had decrypted our message and that they were looking into the issue.<br></p>



<h3>16 November 2018<br></h3>



<p>Komodo responded to say that they’d received the notification. Later communication made it clear that they were working on a fix.<br></p>



<h3>18 November 2018<br></h3>



<p>Sean reconstructed the transcript from the DVDs collected from the participants of the original ceremony. Sean posted the reconstituted <a href="https://s3.amazonaws.com/zcashfinalmpc/transcript" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">transcript</a>.<br></p>



<h3>10 December 2018<br></h3>



<p>Zcash Company team members (Benjamin, Josh, Zooko) met with the Horizen team by video conference. The Horizen team members present were Alberto Garofollo, Dean Steinbeck, Maurizio Binello, Rob Viglione, Rosario Pabst. In the meeting we discussed the timeline for full disclosure. The Horizen team asked to be given the details of the full disclosure prior to posting. We did not agree to provide them these details. <br></p>



<h3>20 December 2018<br></h3>



<p>Zooko notified and briefed David Campbell, COO of the Zcash Company.<br></p>



<h3>05 January 2019<br></h3>



<p>Zooko notified and briefed Zcash founding scientists Eli-Ben Sasson, Eran Tromer, Madars Virza and Matthew Green. These founding scientists, along with Alessandro Chiesa, were the original authors of [<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">BCTV14</a>] and [<a href="https://eprint.iacr.org/2017/602" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">BGG17</a>].<br></p>



<h3>08 January 2019<br></h3>



<p>Zooko notified and briefed Zcash founding scientist Alessandro Chiesa.<br></p>



<h3>25 January 2019<br></h3>



<p>Benjamin and Josh briefed John O’Brien, partner at Strange Brew Strategies, who serves as the Zcash Company PR firm, in preparation for supporting press inquiries.<br></p>



<h3>29 January 2019<br></h3>



<p>Sean and Ariel briefed Zcash company cryptographers Daira Hopwood and Jack Grigg.<br></p>



<p>Benjamin filed for a CVE number for this issue, and received CVE-2019-7167 from mitre.org.<br></p>



<h3>31 January 2019<br></h3>



<p>Benjamin and Josh met with Steve Lee from Komodo to coordinate the public release of information.<br></p>



<h3>01 February 2019<br></h3>



<p>Benjamin and Josh briefed Zcash team members Brad Miller, Elise Hamdon and Paige Peterson for readiness and assistance in preparation for public disclosure. Andy Murray, Zcash Company CFO, was briefed by David Campbell.<br></p>



<h3>04 February 2019 &nbsp;&nbsp;<br></h3>



<p>Jack Gavigan, head of product and regulatory relations was briefed.<br></p>



<p>The Zcash Foundation and its board members were briefed. <br></p>



<p>All employees and contractors working full time at the Zcash Company were briefed on a joint conference call.<br></p>



<p>Community member and forum moderator mineZcash (pseudonym) was briefed.<br></p>



<p>Sprout ceremony participants Derek Hinch of the NCC Group and John Dobbertin (pseudonym) were briefed.<br></p>



<p>CVE-2019-7167 details were updated.<br></p>



<h3>05 February 2019<br></h3>



<p>The Zcash Company public disclosure through the blog post, social media channels and direct contacts with other 3rd parties.<br></p>



<p>CVE-2019-7167 released with the text as shown in this post.</p>



<h2 id="list-of-references">List of References</h2>



<p>[BCTV14] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">https://eprint.iacr.org/2013/879</a></p>



<p>[PGHR13] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/279.pdf" target="_blank">https://eprint.iacr.org/2013/279</a></p>



<p>[BGG17] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">https://eprint.iacr.org/2017/602</a> </p>



<p>[Parno15] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2015/437" target="_blank">https://eprint.iacr.org/2015/437</a> </p>



<p>[snarkjs] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://github.com/iden3/snarkjs" target="_blank">https://github.com/iden3/snarkjs</a></p>



<p>[<a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2016/260" target="_blank">Groth16</a>] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2016/260" target="_blank">https://eprint.iacr.org/2016/260</a></p>



<h3>Papers inheriting the soundness vulnerability from [BCTV14]:</h3>



<p>[BBFR14] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2014/617" target="_blank">https://eprint.iacr.org/2014/617</a></p>



<p>[Fuchsbauer17] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2017/587" target="_blank">https://eprint.iacr.org/2017/587</a></p>



<h2 id="technical-details">Technical Details of CVE-2019-7167</h2>



<p>Title<br>*****</p>



<p>BCTV14 setup produces elements that violate soundness leading to Counterfeiting Vulnerability in Zcash and others<br></p>



<p>Description<br>**********</p>



<p>The construction described by [BCTV14] in Appendix B, is a variant of the [PGHR13] zk-SNARK scheme with modifications to improve performance. This scheme was used in the original 2016 launch of Zcash and has been independently implemented by several other projects.<br></p>



<p>Ariel Gabizon, while working for the Zcash company, discovered a soundness bug in [BCTV14] that is described in this security notice: <br></p>



<p>The key generation procedure of [BCTV14], in step 3, produces various elements that are the result of evaluating polynomials related to the statement being proven. Some of these elements are unused by the prover and were included by mistake; but their presence allows a cheating prover to circumvent a consistency check, and thereby transform the proof of one statement into a valid-looking proof of a different statement. This breaks the soundness of the proof system. We refer to these elements as “bypass elements.” <br></p>



<p>The [BGG17] multi-party computation (MPC) protocol that produces parameters for the [BCTV14] construction follows the setup procedure closely, and so the bypass elements are produced. They are not included in the actual proving key distributed to Zcash nodes since they are explicitly excluded from the parameter file format used by the proving routine implementation of [BCTV14] in the “libsnark” library (used by Sprout). However, these elements do appear in the MPC ceremony transcript. Consequently, anyone with access to the ceremony transcript would have been able to create false proofs.<br></p>



<p>The vulnerability also affects an older MPC scheme [BCGTV15]. This vulnerability was also included in some independent implementations of [BCTV14], such as [snarkjs], even though they do not require an MPC. Similar flaws can be found in the [BBFR14] and [Fuchsbauer17] zk-SNARK schemes, which are adaptations of [BCTV14].<br></p>



<p>Impact<br>*****</p>



<p>The ability to break soundness in the proving system permits the creation of false proofs. Zero-knowledge proofs are used in a system like Zcash to ensure that transactions are valid, so this implies the ability to create an unlimited amount of shielded coins where the verifier is affected by this bug.<br></p>



<p>Credit<br>******</p>



<p>This vulnerability was discovered by Ariel Gabizon while he was working for the Zerocoin Electric Coin Company.<br></p>



<p>What is affected?<br>*****************</p>



<p>Any project that implements [BCTV14] and does not completely dispose of the bypass elements as part of the setup process.<br></p>



<p>That includes but is not limited to any project that depends on the trusted setup used by the original Sprout system that was distributed in the initial 2016 launch of Zcash. This original Sprout system for shielded funds is comprised of the original Sprout circuit, the [BCTV14] proving system using libsnark, and the parameters generated by an MPC ceremony [BGG17]. It was used by the 1.x series of Zcash software (which also carried the “Sprout” name).<br></p>



<p>[BCTV14] is available at <a href="https://eprint.iacr.org/2013/879" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://eprint.iacr.org/2013/879</a><br></p>



<p>The original Sprout circuit implementation is here: <a href="https://github.com/zcash/zcash/tree/32d3a3352e45457f689585cc49d554599583bbd0/src/zcash/circuit" target="_blank" rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/tree/32d3a3352e45457f689585cc49d554599583bbd0/src/zcash/circuit (opens in a new tab)">https://github.com/zcash/zcash/tree/32d3a3352e45457f689585cc49d554599583bbd0/src/zcash/circuit</a><br></p>



<p>The original Sprout zk-SNARK parameters are here: <a href="https://z.cash/downloads/sprout-proving.key">https://z.cash/downloads/sprout-proving.key</a> (sha256sum: 8bc20a7f013b2b58970cddd2e7ea028975c88ae7ceb9259a5344a16bc2c0eef7) and <a href="https://z.cash/downloads/sprout-verifying.key">https://z.cash/downloads/sprout-verifying.key</a> (sha256sum: 4bd498dae0aacfd8e98dc306338d017d9c08dd0918ead18172bd0aec2fc5df82)<br></p>



<p>The Sprout proving and verifying routines are here: <a href="https://github.com/zcash/zcash/blob/685c0ab07fd90b244dac5e2cb1f069ac6151ec5c/src/zcash/JoinSplit.cpp" target="_blank" rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/blob/685c0ab07fd90b244dac5e2cb1f069ac6151ec5c/src/zcash/JoinSplit.cpp (opens in a new tab)">https://github.com/zcash/zcash/blob/685c0ab07fd90b244dac5e2cb1f069ac6151ec5c/src/zcash/JoinSplit.cpp</a><br></p>



<p>The BCTV14 proving system implementation (in libsnark) is here: <a href="https://github.com/zcash/zcash/tree/c938fb1f179d9bdefc5bc7e55fc6330a8b8d3713/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark" target="_blank" rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/tree/c938fb1f179d9bdefc5bc7e55fc6330a8b8d3713/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark (opens in a new tab)">https://github.com/zcash/zcash/tree/c938fb1f179d9bdefc5bc7e55fc6330a8b8d3713/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark</a><br></p>



<p>What is not affected?<br>*********************</p>



<p>The newer Sprout-on-Groth16 system used by Zcash mainnet for Sprout addresses ever since the Sapling activation (block 419200 at 28 Oct 2018) is not affected by the counterfeiting vulnerability. It uses a new Sprout circuit, that runs on the Groth16 proving system, with new parameters, and operates on the BLS12-381 curve implemented in the Bellman library. The newer Sapling system for shielded funds, activated at the same time and using a new address format, is not vulnerable either.<br></p>



<p>The vulnerability is not present in the algorithms of [PGHR13] (which underlies [BCTV14]), nor in [BCGTV13], which used similar techniques. It is also not present in other zk-SNARKs constructions, such as [GM17] or [BG18], or in zero-knowledge proof systems that do not rely on a structured reference string. It is not present in libsnark when used with its built-in parameter generator.<br></p>



<p>The new Sprout-on-Groth16 circuit implementation is located here at time of publishing this information: <a href="https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit</a><br></p>



<p>The new Sprout-on-Groth16 zk-SNARK parameters are located here at time of publishing this information: <a href="https://z.cash/downloads/sprout-groth16.params">https://z.cash/downloads/sprout-groth16.params</a><br></p>



<p>The new Sprout-on-Groth16 proving and verifying routines are located in the librustzcash library (at time of publishing): <a href="https://github.com/zcash/librustzcash" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://github.com/zcash/librustzcash</a><br></p>



<p>The Groth16 proving system is implemented in the Bellman Rust library: <a href="https://github.com/zkcrypto/bellman" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://github.com/zkcrypto/bellman</a><br></p>



<p>Mitigation<br>*********</p>



<p>Users of projects still affected by this issue should change the zk-SNARK parameters to some that are not affected by this bug. Zcash switched to new parameters using a new “Sprout-on-Groth16” proving system as of the Sapling network upgrade on October 28th 2018, and so is not affected by the bug. <br></p>



<p>Therefore, users of Zcash do not need to take any action.<br></p>



<p>Projects still affected by this vulnerability that do not wish to switch proving systems might instead wish to perform their own parameter setup to produce replacement parameters. Projects following this path are strongly encouraged to use a large, public MPC with thorough security analysis. In the interim, they are advised to disable functionality (e.g., shielded transactions) that relies on the affected proof system.<br></p>



<p>References<br>**********</p>



<p>[BCTV14] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/879" target="_blank">https://eprint.iacr.org/2013/879</a></p>



<p>[PGHR13] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2013/279.pdf" target="_blank">https://eprint.iacr.org/2013/279</a></p>



<p>[BGG17] <a rel="noreferrer noopener" aria-label="https://eprint.iacr.org/2017/602 (opens in a new tab)" href="https://eprint.iacr.org/2017/602" target="_blank">https://eprint.iacr.org/2017/602</a></p>



<p>[Parno15] <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://eprint.iacr.org/2015/437" target="_blank">https://eprint.iacr.org/2015/437</a></p>



<p>[BCGTV15] <a rel="noreferrer noopener" aria-label="https://www.ieee-security.org/TC/SP2015/papers-archived/6949a287.pdf (opens in a new tab)" href="https://www.ieee-security.org/TC/SP2015/papers-archived/6949a287.pdf" target="_blank">https://www.ieee-security.org/TC/SP2015/papers-archived/6949a287.pdf</a></p>



<p>[snarkjs] <a rel="noreferrer noopener" aria-label="https://github.com/iden3/snarkjs (opens in a new tab)" href="https://github.com/iden3/snarkjs" target="_blank">https://github.com/iden3/snarkjs</a></p>



<p>Papers inheriting this issue from [BCTV14]:</p>



<p>[BBFR14] <a href="https://eprint.iacr.org/2014/617" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://eprint.iacr.org/2014/617</a></p>



<p>[Fuchsbauer17] <a href="https://eprint.iacr.org/2017/587" target="_blank" rel="noreferrer noopener" aria-label="https://eprint.iacr.org/2017/587 (opens in a new tab)">https://eprint.iacr.org/2017/587</a></p>



<h2 id="correspondence-horizen-komodo">Correspondence to Horizen and Komodo</h2>



<p>Hello,</p>



<p>There is a serious vulnerability in your software. Enclosed is a private advisory with more detail about the vulnerability. We strongly recommend keeping the impact of this issue secret until your project is able to deploy mitigations, because of the associated risks to projects that are still affected and people who know the details.</p>



<p>The issue was discovered internally at Zcash and extreme caution has been exercised to protect its existence from premature disclosure, to avoid exploitation anywhere and to assure the availability of our network and the safety of our people. With the activation of Sapling, our network is no longer vulnerable to this bug, but we’d like to take the right steps to provide you a similar opportunity without putting any of our people at risk.</p>



<p>The vulnerability allows an attacker to create very large, virtually unlimited amounts of counterfeit shielded tokens without detection.</p>



<p>In order to mitigate this bug, we recommend a hardfork that adopts the newer Groth16 implementation of Sprout shielded transactions, which uses a more secure circuit implementation and parameters and is not affected by this bug.</p>



<p>This mitigation was successfully deployed in Zcash as part of the Sapling network upgrade. This mitigation has several advantages, but among them is that it does not require alerting anyone to the existence of a security bug in order to deploy, because the upgrade has legitimate performance and security benefits beyond fixing this bug.</p>



<p>Other possible mitigations for this bug have been analyzed and determined to be too expensive and risky to undertake. Further, revealing those considerations would make it harder for you to protect your users, given that other projects are also affected. Our best effort has been put into developing a strong mitigation to this bug in our own software, which we believe now presents you with a far simpler upgrade path than you might otherwise face.</p>



<p>We have disclosed this to the largest projects who use this code by market cap in order to protect the largest possible amount of capital, however we have decided not to alert all other affected projects yet.</p>



<p>I would like to assign a CVE to this issue, then publish the full details of this vulnerability publicly and notify all remaining affected projects no later than ninety days from today’s date: Today is Tuesday November 13th 2018, meaning I’d like to publicly disclose full details of this issue before Monday February 11th 2019 at the latest.</p>



<p>I will do my best to assist you in understanding the software upgrade path.</p>



<p>Benjamin Winston bambam@z.cash<br>Director of Product Security, z.cash<br></p>



<p>Title<br>*****</p>



<p>Sprout shielded transaction bug allows for unlimited counterfeiting.</p>



<p>Description<br>***********</p>



<p>A fundamental cryptographic flaw exists that allows an attacker to create proofs that falsely convince the original Sprout zk-SNARK verifier of the correctness of a transaction.</p>



<p>Impact<br>******</p>



<p>By exploiting this bug, an attacker could create fake Sprout shielded notes containing large amounts of counterfeit funds without being detected.</p>



<p>Credit<br>******</p>



<p>We would like to include credit for this discovery in a coordinated public release after your software is fixed and your users are safe.</p>



<p>What is affected?<br>*****************</p>



<p>Any project that depends on the original Sprout system that was distributed in the initial launch of Zcash.</p>



<p>The original Sprout zk-SNARK system is comprised of the original Sprout circuit and parameters on the [BCTV14] proving system using libsnark and was used by the 1.x series of Zcash software (which also carried the “Sprout” name).</p>



<p>The original Sprout circuit implementation is here:<br><a rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/tree/master/src/zcash/circuit (opens in a new tab)" href="https://github.com/zcash/zcash/tree/master/src/zcash/circuit" target="_blank">https://github.com/zcash/zcash/tree/master/src/zcash/circuit</a></p>



<p>The original Sprout zk-SNARK parameters are here:<br><a href="https://z.cash/downloads/sprout-proving.key">https://z.cash/downloads/sprout-proving.key</a><br><a href="https://z.cash/downloads/sprout-verifying.key">https://z.cash/downloads/sprout-verifying.key</a></p>



<p>The Sprout proving and verifying routines are here:<br><a rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/blob/master/src/zcash/JoinSplit.cpp (opens in a new tab)" href="https://github.com/zcash/zcash/blob/master/src/zcash/JoinSplit.cpp" target="_blank">https://github.com/zcash/zcash/blob/master/src/zcash/JoinSplit.cpp</a></p>



<p>The BCTV14 proving system implementation (in libsnark) is here:<br><a rel="noreferrer noopener" aria-label="https://github.com/zcash/zcash/tree/master/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark (opens in a new tab)" href="https://github.com/zcash/zcash/tree/master/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark" target="_blank">https://github.com/zcash/zcash/tree/master/src/snark/libsnark/zk_proof_systems/ppzksnark/r1cs_ppzksnark</a></p>



<p>What is not affected?<br>*********************</p>



<p>The newer Sprout-on-Groth16 system used by Zcash mainnet for Sprout transactions on and after block 419200 is not affected by this bug. It uses a new Sprout circuit, that runs on the Groth16 proving system, new parameters and operates on the BLS12-381 curve implemented in the Bellman library.</p>



<p>The new Sprout-on-Groth16 circuit implementation is located here:<br><a rel="noreferrer noopener" aria-label="https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit (opens in a new tab)" href="https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit" target="_blank">https://github.com/zcash-hackworks/sapling-crypto/tree/master/src/circuit</a></p>



<p>The new Sprout-on-Groth16 zk-SNARK parameters are located here:<br><a href="https://z.cash/downloads/sprout-groth16.params">https://z.cash/downloads/sprout-groth16.params</a></p>



<p>The new Sprout-on-Groth16 proving and verifying routines are located in the librustzcash library:<br><a href="https://github.com/zcash/librustzcash" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://github.com/zcash/librustzcash</a></p>



<p>The Groth16 proving system is implemented in the Bellman Rust library:<br><a rel="noreferrer noopener" aria-label="https://github.com/zkcrypto/bellman (opens in a new tab)" href="https://github.com/zkcrypto/bellman" target="_blank">https://github.com/zkcrypto/bellman</a></p>



<p>Mitigation<br>**********</p>



<p>We strongly recommend that you switch to the newer Sprout-on-Groth16 zk-SNARK system, as it is not vulnerable to this bug. </p>



<p>Publication Timeline<br>********************</p>



<p>We would like to publish this vulnerability publicly and notify all other affected projects who are not in our initial distribution list using Github’s security response system, and on our social media channels and website no later than 90 days from today’s date. Today is Tuesday November 13th 2018, meaning I’d like to publicly disclose full details of this issue before Monday February 11th 2019 at the latest.</p>



<p>References<br>**********</p>



<p>[BCTV14] <a href="https://eprint.iacr.org/2013/879" target="_blank" rel="noreferrer noopener" aria-label="https://eprint.iacr.org/2013/879 (opens in a new tab)">https://eprint.iacr.org/2013/879</a></p>
			</div><!-- .entry-content -->
		</div>
	</div></div></div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>