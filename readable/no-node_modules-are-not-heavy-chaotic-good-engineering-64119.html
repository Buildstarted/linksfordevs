<!DOCTYPE html>
<html lang="en">
<head>
    <title>
No, node_modules are not heavy - Chaotic good engineering - linksfor.dev(s)    </title>
    <meta charset="utf-8">
    <link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="No, node_modules are not heavy - Chaotic good engineering - linksfor.dev(s)"/>
    <meta property="og:description" content="node_modules are often discussed as a sink hole of a disk space, but is&#x27;t that different from other platforms?"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://korshakov.com/posts/no-node-modules-are-not-heavy/"/>

<meta property="og:site_name" content="linksfor.dev(s)" />
</head>
<body>
    <div class="devring" style="background: #222">
        <div style="text-align:center">Explore other dev related sites in this ring. If you would like to join this ring <a href="https://devring.club">click here</a>.</div>
        <div class="grid">
            <div style="display: grid; grid-template-columns: .5fr 1fr 1fr 1fr; text-align: center;">
                <span class="devring-title"><a href="https://devring.club/">devring.club</a></span>
                <a href="https://devring.club/sites/1/prev" class="devring-previous">Previous</a>
                <a href="https://devring.club/random" class="devring-random">Random</a>
                <a href="https://devring.club/sites/1/next" class="devring-next">Next</a>
            </div>
        </div>
    </div>
    <div class="grid">
        <h1 style="margin: unset">
<a href="/" style="color:inherit">linksfor.dev(s)</a>
        </h1>
        <title>linksfor.dev(s) - No, node_modules are not heavy - Chaotic good engineering</title>
<div class="readable">
        <h1>No, node_modules are not heavy - Chaotic good engineering</h1>
            <div>Reading time: 7-9 minutes</div>
        <div>Posted here: 10 Jul 2020</div>
        <p><a href="https://korshakov.com/posts/no-node-modules-are-not-heavy/">https://korshakov.com/posts/no-node-modules-are-not-heavy/</a></p>
        <hr/>
<div id="readability-page-1" class="page"><div><p>Javascript became the most popular language in the world and with popularity “hardcore” engineers started to harass js developers and ecosystem. I have no interest in finding where this toxicity came from, but one of the stated issues is the size of a <code>node_modules</code> directory. I always wondered how this is that different from other toolchains: I have a lot of experience with C# (backend), Java/Kotlin (Android), Go (backend), Python (ML), ObjectiveC/Swift (iOS), Scala (backend) and some experience with ocaml/f#/haskel, and experience with NodeJS is so far the most predictable and depdendency tree is actually very <strong>compact</strong>.</p>
<p>TLDR: Sizes of installations for various languages to build UI app:</p>
<ul>
<li>NodeJS: 527MB (plain installation) + 182MB (node_modules)</li>
<li>Android: 914MB (plain installation)</li>
<li>iOS: 20+GB (plain installation)</li>
<li>Go: 659MB (plain installation) + 125MB (linux ui libraries)</li>
</ul>
<p><img src="https://korshakov.com/content/node_modules_meme.png" alt="node_modules meme"></p>
<h2 id="main-difference-from-other-dependency-systems"><a href="#main-difference-from-other-dependency-systems" aria-label="main difference from other dependency systems permalink"></a>Main difference from other dependency systems</h2>
<p>One of the main power of NodeJS is an ability to use multiple versions of a single library within the same build. JS ecosystem is huge mostly because of how it is easy to publish anything, low bar for starting coding and the fact that this is most used language in the world that could run almost anywhere. Since JS is quite old at lack some huge stdlib you just need to use a lot small libraries that solves some specific problem for you. There was a lot of attempts to build some stdlib, but community simply too versatile to have a one-fits-all solution. You can think of it as a Scala ecosystem with a lot of ideas and experimental libraries that sometimes not that practical. Diversity is a huge win. For example because of React we now see declarative paradigms of UI programming in almost any ecosystem. Because you could have so many types of libraries you can choose between performance and easy of use. You can pick native bindings for sql, but could choose JS one, you can have a dozen of different ORMs or write yor own. All this makes JS ecosystem very strong and diverse.</p>
<h2 id="nodejs-benchmark-application"><a href="#nodejs-benchmark-application" aria-label="nodejs benchmark application permalink"></a>NodeJS benchmark application</h2>
<p>We are going to measure NodeJS size with Docker with base image <code>ubuntu:20.04</code>. Base image size is ~74MB and we will substract this size to get net size of nodejs setup.</p>
<p>Using docker</p>
<div data-language="text"><pre><code>FROM ubuntu:20.04
ENV DEBIAN_FRONTEND=noninteractive
RUN apt update &amp;&amp; apt install -y nodejs npm</code></pre></div>
<p>We get size:</p>
<div data-language="text"><pre><code>REPOSITORY          SIZE
test-node           601MB</code></pre></div>
<p>So far our plain node installation is 527MB. This is not the smallest installation possible, there are a slim packages avaiable that have size ~55MB total, but we are here to test dev environment, not production deployment.</p>
<p>Let’s add some npm packages:</p>
<div data-language="text"><pre><code>npm install express typescript webpack next</code></pre></div>
<p>We get image size:</p>
<div data-language="text"><pre><code>REPOSITORY          SIZE
test-node           783MB</code></pre></div>
<p>And resulting installation of nodejs with some frameworks is <strong>709MB</strong>. This makes <code>node_modules</code> to be <strong>182MB</strong> (709MB - 527MB), where Typescript size is ~80MB. NextJS is another ~80MB.</p>

<p>Well you could say that this is awful comparing NodeJS to Android, but i would say no, it is completely adequate: you are going to build an app for the most used OS in the world that makes this toolchain the most popular one.</p>
<p>To measure Android SDK actual size on disk i am going to use Docker images for predictable results. I found that a very minimal and clean <a href="https://github.com/thyrlian/AndroidSDK/blob/master/android-sdk/Dockerfile" target="_blank" rel="nofollow noopener noreferrer">Dockerfile for Android SDK</a> already exist. It was built on top of <code>ubuntu:20.04</code>. To measure Android SDK size we will simply subsctract size of result image from base one.</p>
<div data-language="text"><pre><code>REPOSITORY             SIZE
thyrlian/android-sdk   988MB</code></pre></div>
<p>So, just to compile your android app you need a minimum of a wooping <strong>914MB</strong>. Also this docker image <strong>DOES NOT</strong> have an actual SDK in it, just java, kotlin, SDK manager and needed dependencies. Adding required platforms would boost it for another couple of megabytes. We can also try to count emulators as you probabbly will need couple of them instead of dozen of hardware devices, each emulator will be at least 1gb, much less than an additional browser (that requires only 100MB free on disk).</p>
<p>And you would say: this disk space is reused! Yes and no. SDK could be reused, that’t true, but android development is a combination of Android Studio, Gradle and Java/Kotlin. This trio deeply integrated and if you want to upgrade something you have to upgrade something else. Often you just pick to stick to specific versions for a while until something will require an upgrade and if it would require upgrade of a Kotlin than it could mean that you have to update your code, some libraries and what’s not. Sometimes latest versions simply not working. Sometimes libraries just dissapear from google repositories and you just have to upgrade and once in a while it happens just in the day of release.</p>

<p>Measuring size of an iOS toolchain is a very tricky part. But XCode requires you to have at least 20GB of disk space. Each version of iOS would eat another gigabyte. This list could go and go. Any fat binary usualy have 100MB+ size. Cocoapods and friends download sources for your projects and you have to wait for minutes to compile. My current app on top MBP takes 10+ minutes right now. During build they spawn a large amount of binary files that could became quite large.</p>
<p>Talking about dependency tree it is much more flat, but it is mostly about dificulities of reusing libraries. For example it is almost impossible to mix two versions of a single library, like, React Native use one version of Yoga and Texture uses another one and they are incompatible. Most of the libraries if need something they just vendor it or implement small feature by themself instead of relying on a community. Dependencies between projects are mostly whithin a single entity (organization, community) and almost never reused between. We all wish if it could work, but it is simply impossible to have anything deep in practice. This leads that usually every library have their own LRU cache, their own collections and etc. All of them have bugs and not developed within a single community.</p>
<h2 id="golang"><a href="#golang" aria-label="golang permalink"></a>Golang</h2>
<p>Installing a golang in a Docker is quite simple, but we need to also install gcc since a lot of packages requires.</p>
<p>For empty installation we are getting</p>
<div data-language="text"><pre><code>REPOSITORY          SIZE
test-node           733MB</code></pre></div>
<p>So our pure installation of a Go is <strong>659MB</strong></p>
<p>But this is not fair, we are benchmarking building ui apps, web or desktop. Google have UI library (gxui) for go that requires dependencies: </p>
<div data-language="text"><pre><code>libxi-dev libxcursor-dev libxrandr-dev libxinerama-dev mesa-common-dev libgl1-mesa-dev libxxf86vm-dev</code></pre></div>
<p>Lets’s install them:</p>
<div data-language="text"><pre><code>REPOSITORY          SIZE
test-node           858MB</code></pre></div>
<p>So installation that is ready to use without application dependencies is <strong>784MB</strong>.</p>
<p>Before go modules dependencies was quite fragile in golang world, but not everyone moved to them yet. In golang an actual dependency tree could go very deep just like NodeJS.</p>
<h2 id="results"><a href="#results" aria-label="results permalink"></a>Results</h2>
<p>If you pick any generic ecosystem that wasn’t built for small developer environment footprint you will always get to use a lot of disk space. </p></div></div></div>
    </div>
    <footer>
        <div>created by <a href="https://buildstarted.com">buildstarted</a> &copy; 2020 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
        <div>If you prefer RSS: <a href="https://linksfor.dev/feed.xml">https://linksfor.dev/feed.xml</a></div>
        <div>Customer satisfaction guaranteed to be optional.</div>
    </footer>
    
    <script async defer>
        _dna = window._dna || {};
        _dna.siteId = "linksfor.devs";
        _dna.outlink = true;

        (function() {
            let dna = document.createElement('script');
            dna.type = 'text/javascript';
            dna.async = true;
            dna.src = '//dna.buildstarted.com/t.js';
            let s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(dna, s);
        })();
    </script>
    <noscript><img src="//dna.buildstarted.com/g?siteId=linksfor.devs"/></noscript>
</body>
</html>