<!DOCTYPE html>
<html lang="en">
<head>
    <title>
v5.7 Release Notes -
linksfor.dev(s)
    </title>
	<link rel="alternate" type="application/rss+xml" title="Linksfor.dev(s) feed" href="https://linksfor.dev/feed.rss" />
    <meta charset="utf-8">
    <meta name="Description" content="A curated source of links that devs might find interesting. Updated around the clock." />
    <meta name="google" value="notranslate">
    <link rel="stylesheet" type="text/css" href="/style.css" />
</head>
<body>
    <div class="grid">
        
<div class="readable">
    <h1>v5.7 Release Notes</h1>
    <div id="content"> <p>Ordinarily we&#x2019;d have a longer release cadence in between releases with more features, but with the recent release of .NET Core 3
we&#x2019;ve cut this release cycle short so we can release a version of ServiceStack compatible with .NET Core 3+. Other than that the major focus on this release was <code class="highlighter-rouge">#Script</code> with <a href="#script">many new features</a> we&#x2019;re excited to share after covering the ServiceStack changes.</p> <h3 id="sync-writes-disabled-by-default">Sync writes disabled by default</h3> <p>The primary issue in supporting .NET Core 3 was accommodating its decision to disable sync <code class="highlighter-rouge">Stream</code> writes by default, in-effect disallowing most .NET Serializers from being able to write directly to the Response OutputStream. To work around this, in <strong>.NET Core 3</strong> all sync serializers are first written to a pooled <code class="highlighter-rouge">MemoryStream</code> before being asynchronously written to the Response&#x2019;s Output Stream.</p> <p>Essentially all Content Type Serializers (i.e. Serialization Formats) used in ServiceStack other than HTML View Engines (Razor/Markdown/JSON Report) and <a href="https://sharpscript.net/docs/sharp-pages">#Script Pages</a> (written from ground-up to support async writes) are currently buffered in .NET Core 3. (we&#x2019;ll look into extending native async serialization support to our own serializers in a future release).</p> <p>.NET Core 3 does allow you to <a href="https://github.com/aspnet/AspNetCore/issues/7644">turn off this restriction on a per-request basis</a>
which can be controlled by turning off buffering of sync serializers with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">SetConfig</span><span class="p">(</span><span class="k">new</span> <span class="n">HostConfig</span> <span class="p">{</span> <span class="n">BufferSyncSerializers</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div> <p>Which restores the existing behavior to .NET Core 3 of serializing directly to the Output Stream and marking the request with <code class="highlighter-rouge">AllowSynchronousIO=true</code>.</p> <h3 id="internal-changes">Internal Changes</h3> <p>Whilst most of ServiceStack&#x2019;s other internal HTTP Handlers were already being written asynchronously when ServiceStack was rewritten to be built on top of Async Handlers <a href="/releases/v4.0.0#server-side-async-support">back in its first v4 Release</a>, .NET Core 3&#x2019;s mandate
highlighted our <a href="/metadata-page">Metadata Pages</a> needed to be refactored to use async writes as well as some existing deprecated sync Response Write APIs that needed to be marked to allow Sync. Each of the deprecated sync write APIs have async API equivalents that you can move to when ready.</p> <h3 id="server-events-async-apis">Server Events Async APIs</h3> <p>As all Server Events existing <a href="/server-events#sending-server-events">Notification APIs</a> were synchronous, they couldn&#x2019;t be refactored to use async writes, instead usage of these existing APIs have been marked with <code class="highlighter-rouge">AllowSynchronousIO=true</code>.</p> <p>To perform async writes in <a href="/server-events">Server Events</a> you can use the new <code class="highlighter-rouge">*Async</code> API equivalents available to all existing sync Notification APIs:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IServerEvents</span> <span class="p">{</span> <span class="n">Task</span> <span class="nf">NotifyAllAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span> <span class="n">Task</span> <span class="nf">NotifyChannelAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">chan</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span> <span class="n">Task</span> <span class="nf">NotifySubscriptionAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">subId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span><span class="kt">string</span> <span class="n">chan</span><span class="p">,</span><span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span> <span class="n">Task</span> <span class="nf">NotifyUserIdAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">userId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">string</span> <span class="n">chan</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span> <span class="n">Task</span> <span class="nf">NotifyUserNameAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">userName</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">string</span> <span class="n">chan</span><span class="p">,</span><span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span> <span class="n">Task</span> <span class="nf">NotifySessionAsync</span><span class="p">(</span><span class="kt">string</span> <span class="n">sessionId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">sel</span><span class="p">,</span> <span class="kt">object</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">string</span> <span class="n">chan</span><span class="p">,</span><span class="n">CancellationToken</span> <span class="n">ct</span><span class="p">=</span><span class="k">default</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>If you&#x2019;re utilizing any Server Event handlers, you can change them over to use new Async Handler APIs as well:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ServerEventsFeature</span> <span class="p">:</span> <span class="n">IPlugin</span> <span class="p">{</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">IEventSubscription</span><span class="p">,</span> <span class="n">Task</span><span class="p">&gt;</span> <span class="n">OnSubscribeAsync</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">IEventSubscription</span><span class="p">,</span><span class="n">Task</span><span class="p">&gt;</span> <span class="n">OnUnsubscribeAsync</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">IEventSubscription</span><span class="p">,</span> <span class="n">IResponse</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="n">Task</span><span class="p">&gt;</span> <span class="n">OnPublishAsync</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="upgrade-to-fluent-validation-v85">Upgrade to Fluent Validation v8.5</h3> <p>ServiceStack&#x2019;s interned version of Fluent Validation has been updated to its <a href="https://github.com/JeremySkinner/FluentValidation/releases">latest v8.5 Release</a>.</p> <p>Interestingly this is the first time a Sharp Script was used to <a href="https://gist.github.com/gistlyn/8b409d00eff942279d3532975fa66965">partially automate the update</a>.
The productivity of the <a href="https://sharpscript.net/docs/sharp-scripts">real-time feedback in Sharp Scripts</a> crosses the threshold for it being faster to automate in-frequent one-off tasks like this than performing the update manually.</p> <h3 id="service-plugin-apis">Service Plugin APIs</h3> <p>The new Plugin APIs in the <code class="highlighter-rouge">Service</code> base class lets you avoid singleton access to <code class="highlighter-rouge">HostContext.GetPlugin&lt;T&gt;()</code> within your Service implementation:</p> <ul> <li><code class="highlighter-rouge">T GetPlugin&lt;T&gt;()</code> - returns <code class="highlighter-rouge">null</code> when plugin not registered</li> <li><code class="highlighter-rouge">T AssertPlugin&lt;T&gt;()</code> - throw if plugin not registered</li>
</ul> <h3 id="authfeature">AuthFeature</h3> <p>Historically ServiceStack included a more formal <code class="highlighter-rouge">/authenticate</code> alias that could be used instead of the shorter <code class="highlighter-rouge">/auth</code> route for accessing its Authentication services. But only the <code class="highlighter-rouge">/auth</code> route was documented and the longer alias didn&#x2019;t see much usage except when it appeared in the Services metadata which presented a potential source of confusion as it included were duplicated routes for Auth.</p> <p>We&#x2019;ve decided to remove the <code class="highlighter-rouge">/authenticate</code> alias by default, you can use <code class="highlighter-rouge">AddAuthenticateAliasRoutes()</code> to re-add it when registering the <code class="highlighter-rouge">AuthFeature</code> plugin, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Plugins</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">AuthFeature</span><span class="p">(...)</span> <span class="p">{</span> <span class="p">...</span>
<span class="p">}.</span><span class="nf">AddAuthenticateAliasRoutes</span><span class="p">());</span>
</code></pre></div></div> <p>External Redirects used in the <code class="highlighter-rouge">?continue</code> params of <code class="highlighter-rouge">/auth</code> requests are disabled by default, they can be re-enabled with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">new</span> <span class="nf">AuthFeature</span><span class="p">(...)</span> <span class="p">{</span> <span class="n">ValidateRedirectLinks</span> <span class="p">=</span> <span class="n">AuthFeature</span><span class="p">.</span><span class="n">AllowAllRedirects</span> <span class="p">}</span>
</code></pre></div></div> <h2 id="ormlite">OrmLite</h2> <p>New OrmLite Packages have been published that makes use of Microsoft&#x2019;s alternative <code class="highlighter-rouge">Microsoft.Data.SQLite</code> and <code class="highlighter-rouge">Microsoft.Data.SqlClient</code> ADO.NET Data providers:</p> <ul> <li><strong>ServiceStack.OrmLite.Sqlite.Data</strong> - Sqlite provider that uses <code class="highlighter-rouge">Microsoft.Data.SQLite</code></li> <li><strong>ServiceStack.OrmLite.SqlServer.Data</strong> - SqlServer provider that uses <code class="highlighter-rouge">Microsoft.Data.SqlClient</code></li> <li><strong>ServiceStack.OrmLite.SqlServer.Data.Core</strong> - Use <code class="highlighter-rouge">Microsoft.Data.SqlClient</code> on <a href="/templates-corefx">ASP.NET Core on .NET Framework</a></li>
</ul> <p>They&#x2019;re source-code compatible with OrmLite&#x2019;s existing <strong>OrmLite.Sqlite</strong> and <strong>OrmLite.SqlServer</strong> packages where App&#x2019;s will be able to easily switch to these new packages by adding the <code class="highlighter-rouge">.Data</code> suffix to their existing OrmLite NuGet package references.</p> <h3 id="getschematable">GetSchemaTable</h3> <p>ADO.NET&#x2019;s <code class="highlighter-rouge">IDataReader.GetSchemaTable()</code> for retrieving schema info on a query, can now be accessed from OrmLite with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DataTable</span> <span class="n">schema</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">GetSchemaTable</span><span class="p">(</span><span class="s">&quot;SELECT * from Table&quot;</span><span class="p">);</span>
</code></pre></div></div> <p>Although as this returns an unstructured dump of attributes in a <code class="highlighter-rouge">DataTable</code> we&#x2019;ve also provided APIs to return the results a typed
<a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite/ColumnSchema.cs">ColumnSchema</a> POCO:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ColumnSchema</span><span class="p">[]</span> <span class="n">schema</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">GetTableColumns</span><span class="p">&lt;</span><span class="n">Table</span><span class="p">&gt;();</span>
<span class="n">ColumnSchema</span><span class="p">[]</span> <span class="n">schema</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">GetTableColumns</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Table</span><span class="p">));</span>
<span class="n">ColumnSchema</span><span class="p">[]</span> <span class="n">schema</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">GetTableColumns</span><span class="p">(</span><span class="s">&quot;SELECT * from Table&quot;</span><span class="p">);</span>
</code></pre></div></div> <blockquote> <p><code class="highlighter-rouge">async</code> equivalents available for all new APIs</p>
</blockquote> <h4 id="db-script-methods">DB Script Methods</h4> <p>As this Table Schema information is useful when accessing databases in <code class="highlighter-rouge">#Script</code> with <a href="https://sharpscript.net/docs/db-scripts">DB Scripts</a>,
this information is also available from:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Table&apos;</span><span class="p">.</span><span class="nx">dbColumnNames</span><span class="p">()</span>
<span class="s1">&apos;Table&apos;</span><span class="p">.</span><span class="nx">dbColumns</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">map</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">it</span><span class="p">.</span><span class="nx">ColumnName</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">it</span><span class="p">.</span><span class="nx">DataTypeName</span><span class="p">}</span><span class="s2">`</span> <span class="o">|&gt;</span> <span class="nx">joinln</span>
<span class="s1">&apos;select * from Table&apos;</span><span class="p">.</span><span class="nx">dbDesc</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">map</span> <span class="o">=&gt;</span> <span class="s2">`</span><span class="p">${</span><span class="nx">it</span><span class="p">.</span><span class="nx">ColumnName</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">it</span><span class="p">.</span><span class="nx">DataTypeName</span><span class="p">}</span><span class="s2">`</span> <span class="o">|&gt;</span> <span class="nx">joinln</span>
</code></pre></div></div> <h3 id="servicestacktext">ServiceStack.Text</h3> <p>The <a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/src/ServiceStack.Text/MemoryProvider.cs">MemoryProvider</a> abstraction is used to take advantage of .NET Core&#x2019;s more performant and low allocation APIs whilst still being able to support
.NET Framework from the same code-base. New APIs added in this release include:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MemoryProvider</span>
<span class="p">{</span> <span class="k">abstract</span> <span class="n">Task</span> <span class="nf">WriteAsync</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">,</span> <span class="n">ReadOnlySpan</span><span class="p">&lt;</span><span class="kt">char</span><span class="p">&gt;</span> <span class="k">value</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">token</span><span class="p">=</span><span class="k">default</span><span class="p">);</span> <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">,</span> <span class="n">ReadOnlyMemory</span><span class="p">&lt;</span><span class="kt">char</span><span class="p">&gt;</span> <span class="k">value</span><span class="p">);</span> <span class="k">public</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Write</span><span class="p">(</span><span class="n">Stream</span> <span class="n">stream</span><span class="p">,</span> <span class="n">ReadOnlyMemory</span><span class="p">&lt;</span><span class="kt">byte</span><span class="p">&gt;</span> <span class="k">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="auto-mapping">Auto Mapping</h3> <p><a href="/auto-mapping">Auto Mapping</a> now makes usage of implicit casts defined on the target Type as well, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">xname</span> <span class="p">=</span> <span class="s">&quot;Text&quot;</span><span class="p">.</span><span class="n">ConvertTo</span><span class="p">&lt;</span><span class="n">XName</span><span class="p">&gt;();</span> <span class="c1">//uses implicit string cast in XName</span>
</code></pre></div></div> <ul> <li>New <code class="highlighter-rouge">Env.IsNetCore3</code> can be used to detect if running on .NET Core 3.x</li> <li><code class="highlighter-rouge">min()</code> and <code class="highlighter-rouge">max()</code> APIs added to <code class="highlighter-rouge">DynamicNumber</code></li>
</ul> <h2 id="script">#Script</h2> <p>We&#x2019;ve seen great reception of <a href="/releases/v5.6#gist-desktop-apps">Gist Desktop Apps</a> from the last v5.6 release with a nice shoutout from <a href="https://twitter.com/jongalloway">Jon Galloway</a> in the <a href="https://www.youtube.com/watch?v=a2lq4yEfJpk&amp;feature=youtu.be&amp;t=1529">ASP.NET Community August Stand up</a>, a featured <a href="https://www.hanselman.com/blog/SharpScriptFromServiceStackLetsYouRunNETAppsDirectlyFromAGitHubGist.aspx">blog post</a>
from <a href="https://twitter.com/shanselman">Scott Hanselman</a> as well features in Hacker News and Reddit.</p> <p>We&#x2019;ve since further enhanced <code class="highlighter-rouge">#Script</code> capabilities in this release making it more functional then ever, broadening its appeal in its growing list of use-cases.</p> <h3 id="1st-class-script-code-and-lisp-language-support">1st class #Script Code and Lisp Language support!</h3> <p>In addition to enhanced capabilities, it also gains support for multiple languages with <a href="https://sharpscript.net/scode/">#Script code</a> now implemented as a first-class language as well entirely new support for <a href="https://sharpscript.net/lisp/">Lisp</a>! - one of the smallest and most powerful languages in existence whose dynamism and extensibility makes it particularly well suited for a range of explanatory programming tasks that can now be harnessed in .NET Core and .NET Framework Apps.</p> <p>You can interactively explore and compare each of <code class="highlighter-rouge">#Script</code> languages in <strong>C#&#x2019;s 101 LINQ Examples</strong>:</p> <h3 id="transition-to-js-pipeline-operator-syntax">Transition to JS Pipeline Operator Syntax</h3> <p>First we want to announce our intention to move to use JavaScript&#x2019;s proposed <code class="highlighter-rouge">|&gt;</code> <a href="https://github.com/tc39/proposal-pipeline-operator">Pipeline Operator syntax</a>
that&#x2019;s now moved to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Pipeline_operator">stage 1</a> proposal
where it&#x2019;s become clear that they&#x2019;ve chosen to use F#&#x2019;s pipe forward <code class="highlighter-rouge">|&gt;</code> operator for its syntax. It&#x2019;s currently only at <strong>Stage 1</strong> so could still be years before it&#x2019;s adopted in browsers as there&#x2019;s still open questions about its exact semantics, but a version of it is currently available as a <a href="https://babeljs.io/blog/2018/07/19/whats-happening-with-the-pipeline-proposal">babel plugin</a> and in Firefox under an
<a href="https://github.com/tc39/proposal-pipeline-operator#implementations">experimental <code class="highlighter-rouge">--enable-pipeline-operator</code></a> flag.</p> <p>We&#x2019;d also like to transition to use the new <code class="highlighter-rouge">|&gt;</code> syntax for future benefits in improved familiarity for JS developers as well as
the source-code compatibility benefits from code portability to compatibility with JS tools, language services and syntax highlighters.</p> <p>As the existing <code class="highlighter-rouge">|</code> operator has been fundamental in existing <code class="highlighter-rouge">#Script</code> code bases we want to transition to the new syntax with the least disruption possible by supporting both syntaxes in parallel over multiple releases so existing code-bases can transition at their own pace, which just involves replacing existing usages of <code class="highlighter-rouge">|</code> to use <code class="highlighter-rouge">|&gt;</code>, e.g:</p> <div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">{{</span> <span class="s1">&apos;shout&apos;</span> <span class="err">|</span> <span class="nv">upper</span> <span class="err">|</span> <span class="nv">substring</span><span class="err">(</span><span class="nv">2</span><span class="err">)</span> <span class="err">|</span> <span class="nv">padRight</span><span class="err">(</span><span class="nv">6</span><span class="err">,</span> <span class="s1">&apos;_&apos;</span><span class="err">)</span> <span class="err">|</span> <span class="nv">repeat</span><span class="err">(</span><span class="nv">3</span><span class="err">)</span> <span class="k">}}</span> //to <span class="k">{{</span> <span class="s1">&apos;shout&apos;</span> <span class="err">|&gt;</span> <span class="nv">upper</span> <span class="err">|&gt;</span> <span class="nv">substring</span><span class="err">(</span><span class="nv">2</span><span class="err">)</span> <span class="err">|&gt;</span> <span class="nv">padRight</span><span class="err">(</span><span class="nv">6</span><span class="err">,</span> <span class="s1">&apos;_&apos;</span><span class="err">)</span> <span class="err">|&gt;</span> <span class="nv">repeat</span><span class="err">(</span><span class="nv">3</span><span class="err">)</span> <span class="k">}}</span>
</code></pre></div></div> <p>When ready you can enforce that only the new <code class="highlighter-rouge">|&gt;</code> syntax is used by disallowing <code class="highlighter-rouge">|</code> usage with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ScriptConfig</span><span class="p">.</span><span class="n">AllowUnixPipeSyntax</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</code></pre></div></div> <p>F#&#x2019;s <code class="highlighter-rouge">|&gt;</code> pipe forward operator has now been <a href="https://github.com/tc39/proposal-pipeline-operator">implemented in multiple languages</a> which works as expected when pipe forwarding to a function with a single argument:</p> <p>But the semantics of how it&#x2019;s applied when forwarding to functions with multiple arguments varies such that <code class="highlighter-rouge">a |&gt; f(b)</code> desugars to:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="c1">// Elixir first argument</span>
<span class="nx">f</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="c1">// F# last argument</span>
<span class="nx">f</span><span class="p">(</span><span class="nx">b</span><span class="p">)(</span><span class="nx">a</span><span class="p">)</span> <span class="c1">// JS proposal</span>
</code></pre></div></div> <p><code class="highlighter-rouge">#Script</code> like Elixir passes it as the first argument which in our opinion is the most intuitive behavior that better supports
calling overloaded functions with different parameter counts.</p> <h3 id="scripting-net">Scripting .NET!</h3> <p>By default the only functionality and objects <code class="highlighter-rouge">#Script</code> has access to is what&#x2019;s pre-configured within a new <code class="highlighter-rouge">ScriptContext</code> <a href="https://sharpscript.net/docs/sandbox">sandbox</a> which has access to <a href="https://sharpscript.net/docs/default-scripts">Default Scripts</a>, <a href="https://sharpscript.net/docs/html-scripts">HTML Scripts</a> and default <a href="https://sharpscript.net/docs/blocks">Script Blocks</a>. <code class="highlighter-rouge">#Script</code> can&#x2019;t call methods on instances or have any other way to invoke a method unless it&#x2019;s explicitly registered.</p> <p>To enable additional functionality, the <code class="highlighter-rouge">ScriptContext</code> that executes your script can be extended with additional:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">Args</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Global Arguments available to all Scripts, Pages, Partials, etc</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Methods</span> <span class="n">ScriptBlocks</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Script Blocks </span> <span class="n">FilterTransformers</span> <span class="p">=</span> <span class="p">{</span> <span class="p">..</span> <span class="p">},</span> <span class="c1">// Additional Stream Transformers</span> <span class="n">PageFormats</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Text Document Formats</span> <span class="n">Plugins</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Encapsulated Features e.g. Markdown, Protected or ServiceStack Features</span> <span class="n">ScanTypes</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Auto register Methods, Blocks and Code Page Types</span> <span class="n">ScanAssemblies</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Auto register all Methods, Blocks and Code Page Types in Assembly</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>Although being able to Script .NET Types directly gives your Scripts greater capabilities and opens it up to a lot more use-cases that&#x2019;s especially useful in predominantly #Script-heavy contexts like <a href="https://sharpscript.net//docs/sharp-apps">Sharp Apps</a> and <a href="https://sharpscript.net//docs/sharp-scripts">Shell Scripts</a> giving them maximum power that would otherwise require the usage of <a href="https://sharpscript.net//docs/sharp-apps#plugins">Plugins</a>.</p> <p>We can visualize the different scriptability options from the diagram below where
by default scripts are limited to functionality <a href="https://sharpscript.net/docs/introduction#net-usage">defined within their ScriptContext</a>, whether to <a href="https://sharpscript.net/docs/script-net#script-assemblies-and-types">limit access to specific Types and Assemblies</a> or whether to lift the escape hatch
and <a href="https://sharpscript.net/docs/script-net#allowscriptingofalltypes">allow scripting of any .NET Types</a>.</p> <p><img src="https://sharpscript.net/assets/img/sandbox.svg" alt></p> <p>The new .NET Scripting support is only available to Script&#x2019;s executed within <strong>trusted contexts</strong> that are registered with <a href="https://sharpscript.net/docs/protected-scripts">Protected Scripts</a>. The different ways to allow scripting of .NET Types include:</p> <h4 id="script-assemblies-and-types">Script Assemblies and Types</h4> <p>Using <code class="highlighter-rouge">ScriptTypes</code> to limit scriptability to <strong>only specific Types</strong>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProtectedScripts</span><span class="p">()</span> <span class="p">},</span> <span class="n">ScriptTypes</span> <span class="p">=</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyType</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyType2</span><span class="p">),</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>Or you can use <code class="highlighter-rouge">ScriptAssemblies</code> to allow scripting of <strong>all Types within an Assembly</strong>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProtectedScripts</span><span class="p">()</span> <span class="p">},</span> <span class="n">ScriptAssemblies</span> <span class="p">=</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyType</span><span class="p">).</span><span class="n">Assembly</span><span class="p">,</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <h4 id="allowscriptingofalltypes">AllowScriptingOfAllTypes</h4> <p>To give your Scripts maximum accessibility where they&#x2019;re able to pierce the well-defined <a href="https://sharpscript.net/docs/sandbox">ScriptContext sandbox</a>,
you can set <code class="highlighter-rouge">AllowScriptingOfAllTypes</code> to allow scripting of <strong>all .NET Types</strong> available in loaded assemblies:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProtectedScripts</span><span class="p">()</span> <span class="p">},</span> <span class="n">AllowScriptingOfAllTypes</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">ScriptNamespaces</span> <span class="p">=</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">MyType</span><span class="p">).</span><span class="n">Namespace</span><span class="p">,</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p><code class="highlighter-rouge">ScriptNamespaces</code> is used to include additional Lookup namespaces for resolving Types akin to C# <code class="highlighter-rouge">using</code> statements.</p> <p>Using <code class="highlighter-rouge">AllowScriptingOfAllTypes</code> also allows access to both public and <strong>non-public</strong> Types.</p> <h2 id="scripting-net-apis">Scripting .NET APIs</h2> <p>The following <a href="https://sharpscript.net/docs/protected-scripts">Protected Scripts</a> are all that&#x2019;s needed to create new instances, call methods and populate instances of .NET Types, including generic types and generic methods.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Resolve Types</span>
<span class="n">Type</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span> <span class="n">typeName</span><span class="p">);</span> <span class="c1">// Call Methods</span>
<span class="kt">object</span> <span class="nf">call</span><span class="p">(</span><span class="kt">object</span> <span class="n">instance</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">);</span>
<span class="kt">object</span> <span class="nf">call</span><span class="p">(</span><span class="kt">object</span> <span class="n">instance</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">args</span><span class="p">);</span>
<span class="n">Delegate</span> <span class="nf">Function</span><span class="p">(</span><span class="kt">string</span> <span class="n">qualifiedMethodName</span><span class="p">);</span> <span class="c1">// alias F(string)</span> <span class="c1">// Create Instances</span>
<span class="kt">object</span> <span class="k">new</span><span class="p">(</span><span class="kt">string</span> <span class="n">typeName</span><span class="p">);</span>
<span class="kt">object</span> <span class="k">new</span><span class="p">(</span><span class="kt">string</span> <span class="n">typeName</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">constructorArgs</span><span class="p">);</span>
<span class="kt">object</span> <span class="nf">createInstance</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">);</span>
<span class="kt">object</span> <span class="nf">createInstance</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">constructorArgs</span><span class="p">);</span>
<span class="n">ObjectActivator</span> <span class="nf">Constructor</span><span class="p">(</span><span class="kt">string</span> <span class="n">qualifiedConstructorName</span><span class="p">);</span> <span class="c1">// alias C(string)</span> <span class="c1">// Populate Instance</span>
<span class="kt">object</span> <span class="k">set</span><span class="p">(</span><span class="kt">object</span> <span class="n">instance</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">args</span><span class="p">);</span>
</code></pre></div></div> <blockquote> <p>Note: only a Type&#x2019;s <strong>public</strong> members can be accessed from <code class="highlighter-rouge">#Script</code></p>
</blockquote> <h3 id="type-resolution">Type Resolution</h3> <p>If you&#x2019;ve registered Types using either <code class="highlighter-rouge">ScriptTypes</code> or <code class="highlighter-rouge">ScriptAssemblies</code> than you&#x2019;ll be able to reference the Type using
<strong>just the Type Name</strong>, unless multiple Types of the same name are registered in which case the <code class="highlighter-rouge">typeof()</code> will return the <strong>first Type</strong>
registered, all other subsequent Types with the same Name will need to be referenced with their <strong>Full Name</strong>.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typeof</span><span class="p">(</span><span class="s1">&apos;MyType&apos;</span><span class="p">)</span>
<span class="k">typeof</span><span class="p">(</span><span class="s1">&apos;My.Namespace.MyType&apos;</span><span class="p">)</span>
</code></pre></div></div> <p>When <code class="highlighter-rouge">AllowScriptingOfAllTypes=true</code> is enabled, you can use <code class="highlighter-rouge">ScriptNamespaces</code> to add Lookup Namespaces for resolving Types, which for #Script Pages, Sharp Apps and Sharp Scripts are pre-configured with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="c1">//...</span> <span class="n">ScriptNamespaces</span> <span class="p">=</span> <span class="p">{</span> <span class="s">&quot;System&quot;</span><span class="p">,</span> <span class="s">&quot;System.Collections.Generic&quot;</span><span class="p">,</span> <span class="s">&quot;ServiceStack&quot;</span><span class="p">,</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>All other Types (other than <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/built-in-types-table">.NET built-in types</a>) not registered in <code class="highlighter-rouge">ScriptTypes</code>, <code class="highlighter-rouge">ScriptAssemblies</code> or have their namespace defined in <code class="highlighter-rouge">ScriptNamespaces</code> will need to be referenced using
their <strong>Full Type Name</strong>. This same Type resolution applies for all references of Types in <code class="highlighter-rouge">#Script</code>.</p> <h4 id="examples-configuration">Examples Configuration</h4> <p>The examples below assumes a <code class="highlighter-rouge">ScriptContext</code> configured with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProtectedScripts</span><span class="p">()</span> <span class="p">},</span> <span class="n">AllowScriptingOfAllTypes</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">ScriptNamespaces</span> <span class="p">=</span> <span class="p">{</span> <span class="s">&quot;System&quot;</span><span class="p">,</span> <span class="s">&quot;System.Collections.Generic&quot;</span><span class="p">,</span> <span class="p">},</span> <span class="n">ScriptTypes</span> <span class="p">=</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Ints</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Adder</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">StaticLog</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">InstanceLog</span><span class="p">),</span> <span class="k">typeof</span><span class="p">(</span><span class="n">GenericStaticLog</span><span class="p">&lt;&gt;),</span> <span class="p">},</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>With the types for the above classes defined in <a href="https://github.com/ServiceStack/sharpscript/blob/master/src/ScriptTypes.cs">ScriptTypes.cs</a>.
This is the definition of the <code class="highlighter-rouge">Adder</code> class that&#x2019;s referenced frequently in the examples below:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Adder</span>
<span class="p">{</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">String</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="kt">double</span> <span class="n">Double</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="k">public</span> <span class="nf">Adder</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">String</span> <span class="p">=</span> <span class="n">str</span><span class="p">;</span> <span class="k">public</span> <span class="nf">Adder</span><span class="p">(</span><span class="kt">double</span> <span class="n">num</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Double</span> <span class="p">=</span> <span class="n">num</span><span class="p">;</span> <span class="k">public</span> <span class="kt">string</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">string</span> <span class="n">str</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">String</span> <span class="p">+=</span> <span class="n">str</span><span class="p">;</span> <span class="k">public</span> <span class="kt">double</span> <span class="nf">Add</span><span class="p">(</span><span class="kt">double</span> <span class="n">num</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Double</span> <span class="p">+=</span> <span class="n">num</span><span class="p">;</span> <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">()</span> <span class="p">=&gt;</span> <span class="n">String</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="s">$&quot;string: </span><span class="p">{</span><span class="n">String</span><span class="p">}</span><span class="s">&quot;</span> <span class="p">:</span> <span class="s">$&quot;double: </span><span class="p">{</span><span class="n">Double</span><span class="p">}</span><span class="s">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="creating-instances">Creating Instances</h3> <p>There are 3 different APIs for creating instances of Types:</p> <ul> <li><code class="highlighter-rouge">new</code> - create instances from Type <strong>name</strong> with specified List of arguments</li> <li><code class="highlighter-rouge">createInstance</code> - create instance of <strong>Type</strong> with specified List of arguments</li> <li><code class="highlighter-rouge">Constructor</code> - create a Constructor <strong>delegate</strong> that can create instances via method invocation</li>
</ul> <p>Built-in .NET Types and Types in <code class="highlighter-rouge">ScriptTypes</code>, <code class="highlighter-rouge">ScriptAssemblies</code> or <code class="highlighter-rouge">ScriptNamespaces</code> can be created using their Type Name, including generic Types:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;int&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="s1">&apos;DateTime&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="s1">&apos;Dictionary&lt;string,DateTime&gt;&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
</code></pre></div></div> <p>Otherwise new instances of Types can be created using their <strong>full Type Name</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;System.Int32&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
<span class="s1">&apos;System.Text.StringBuilder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span>
</code></pre></div></div> <p>A list of arguments can be passed to the <code class="highlighter-rouge">new</code> method to call the constructor with the specified arguments:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Ints&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
<span class="s1">&apos;KeyValuePair&lt;string,int&gt;&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="s1">&apos;A&apos;</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div> <h4 id="constructor-resolution">Constructor Resolution</h4> <p><code class="highlighter-rouge">#Script</code> will use the constructor that matches the same number of specified arguments, when needed it uses
<a href="/auto-mapping">ServiceStack&#x2019;s Auto Mapping</a> to convert instances when their Types don&#x2019;t match, e.g:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Ints&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span>
<span class="s1">&apos;KeyValuePair&lt;char,double&gt;&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="s1">&apos;A&apos;</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div> <p>However if there are multiple constructors with the same number of arguments, it will only use the constructor where all its argument Types
match with the supplied arguments. Attempting to create an instance of the <code class="highlighter-rouge">Adder</code> class which only has constructors for <code class="highlighter-rouge">string</code> or
<code class="highlighter-rouge">double</code> will fail with an <strong>Ambiguous Match Exception</strong> when trying to create it with an <code class="highlighter-rouge">int</code>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="c1">// FAIL: Ambiguous Constructor</span>
</code></pre></div></div> <p>In this case you&#x2019;ll need to convert the arguments so its Types matches one of the available constructors:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
<span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="nx">intArg</span><span class="p">.</span><span class="nx">toDouble</span><span class="p">()])</span>
<span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="s1">&apos;A&apos;</span><span class="p">])</span>
<span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="s2">`</span><span class="p">${</span><span class="nx">instance</span><span class="p">}</span><span class="s2">`</span><span class="p">])</span> <span class="c1">// or &apos;Adder&apos;.new([instance.toString()]) </span>
</code></pre></div></div> <h4 id="constructor-function">Constructor function</h4> <p>Alternatively you can use the <code class="highlighter-rouge">Constructor</code> method to specify the constructor you want by specifying the argument types of the constructor you want to use, which will return a delegate that lets you call a method to create instances using that Type&#x2019;s constructor:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Constructor</span><span class="p">(</span><span class="s1">&apos;Adder(double)&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">doubleAdder</span>
<span class="nx">Constructor</span><span class="p">(</span><span class="s1">&apos;Adder(string)&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">stringAdder</span>
</code></pre></div></div> <p>In this case you will be able to create instances of <code class="highlighter-rouge">Adder</code> using an <code class="highlighter-rouge">int</code> argument as the built-in automapping will convert it to
the Argument Type of the Constructor you&#x2019;ve chosen:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">doubleAdder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">stringAdder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// equivalent to:</span>
<span class="nx">Constructor</span><span class="p">(</span><span class="s1">&apos;Adder(double)&apos;</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">Constructor</span><span class="p">(</span><span class="s1">&apos;Adder(string)&apos;</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <p>As the Constructor Function returns a delegate you will be able to invoke it like a normal method where it can also be invoked as an extension method or inside a filter expression:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">Constructor</span><span class="p">(</span><span class="err">&apos;</span><span class="nf">Uri</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="err">&apos;</span><span class="p">)</span> <span class="p">|&gt;</span> <span class="n">to</span> <span class="p">=&gt;</span> <span class="n">url</span> <span class="nf">url</span><span class="p">(</span><span class="err">&apos;</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org&apos;)</span>
<span class="err">&apos;</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org&apos;.url()</span>
<span class="err">&apos;</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org&apos; |&gt; url</span> <span class="c1">// equivalent to:</span>
<span class="err">&apos;</span><span class="n">Uri</span><span class="err">&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="err">&apos;</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org&apos;])</span>
<span class="nf">Constructor</span><span class="p">(</span><span class="err">&apos;</span><span class="nf">Uri</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="err">&apos;</span><span class="p">)(</span><span class="err">&apos;</span><span class="n">http</span><span class="p">:</span><span class="c1">//example.org&apos;)</span>
</code></pre></div></div> <h4 id="c-alias">C() alias</h4> <p>To reduce syntax noise when needing to create a lot of constructors you can use the much shorter alias <code class="highlighter-rouge">C</code> instead of <code class="highlighter-rouge">Constructor</code>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">C</span><span class="p">(</span><span class="s1">&apos;Uri(string)&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">url</span>
<span class="nx">C</span><span class="p">(</span><span class="s1">&apos;Adder(double)&apos;</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <h4 id="createinstance">createInstance</h4> <p>The <code class="highlighter-rouge">createInstance</code> is like <code class="highlighter-rouge">new</code> except it&#x2019;s used to create instances from a <code class="highlighter-rouge">Type</code> instead of its <code class="highlighter-rouge">string</code> Type Name:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typeof</span><span class="p">(</span><span class="s1">&apos;Ints&apos;</span><span class="p">).</span><span class="nx">createInstance</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="k">typeof</span><span class="p">(</span><span class="s1">&apos;Adder&apos;</span><span class="p">).</span><span class="nx">createInstance</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
<span class="k">typeof</span><span class="p">(</span><span class="s1">&apos;KeyValuePair&lt;string,int&gt;&apos;</span><span class="p">).</span><span class="nx">createInstance</span><span class="p">([</span><span class="s1">&apos;A&apos;</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></div> <h4 id="set">set</h4> <p>Once you&#x2019;ve created instance you can further populate it using the <code class="highlighter-rouge">set</code> method which will let you populate <strong>public properties</strong>
with a JS Object literal, performing any auto-mapping conversions as needed:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Ints&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]).</span><span class="kd">set</span><span class="p">({</span> <span class="na">C</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="na">D</span><span class="p">:</span><span class="mf">4.0</span> <span class="p">})</span>
<span class="nx">Constructor</span><span class="p">(</span><span class="s1">&apos;Ints(int,int)&apos;</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">).</span><span class="kd">set</span><span class="p">({</span> <span class="na">C</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="na">D</span><span class="p">:</span><span class="mf">4.0</span> <span class="p">})</span>
</code></pre></div></div> <p>As <code class="highlighter-rouge">set</code> returns the instance, it can be used within a chained expression:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">instance</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span> <span class="na">C</span><span class="p">:</span><span class="mi">3</span> <span class="p">}).</span><span class="kd">set</span><span class="p">({</span> <span class="na">D</span><span class="p">:</span><span class="mf">4.0</span> <span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="s1">&apos;GetTotal&apos;</span><span class="p">)</span>
</code></pre></div></div> <h3 id="calling-methods">Calling Methods</h3> <p>Use the <code class="highlighter-rouge">call</code> and <code class="highlighter-rouge">Function</code> APIs to call methods on .NET Types:</p> <ul> <li><code class="highlighter-rouge">call</code> - invoke a method on an instance</li> <li><code class="highlighter-rouge">Function</code> - create a Function <strong>delegate</strong> that can invoke methods via normal method invocation</li>
</ul> <h4 id="call">call</h4> <p>In its most simplest form you can invoke an instance method that doesn&#x2019;t have any arguments using just its name:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Ints&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">ints</span>
<span class="nx">ints</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&apos;GetMethod&apos;</span><span class="p">)</span>
</code></pre></div></div> <p>Any arguments can be specified in an arguments list:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Adder&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">adder3</span>
<span class="nx">adder3</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&apos;Add&apos;</span><span class="p">,[</span><span class="mf">3.0</span><span class="p">])</span> <span class="c1">//= 6.0</span>
</code></pre></div></div> <h4 id="method-resolution">Method Resolution</h4> <p>The same Resolution rules in <strong>Constructor Resolution</strong> also applies when calling methods where any <strong>ambiguous methods</strong> needs to be
called with arguments containing the <strong>exact types</strong> (as above), or you can specify the argument types of the method you want to call,
in which case it will let you use the built-in Auto Mapping to call a method expecting a <code class="highlighter-rouge">double</code> with an <code class="highlighter-rouge">int</code> argument:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">adder3</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&apos;Add(double)&apos;</span><span class="p">,[</span><span class="mi">3</span><span class="p">])</span>
</code></pre></div></div> <h4 id="generic-methods">Generic Methods</h4> <p>You can call generic methods by specifying the Generic Type in the method name:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;Ints&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]).</span><span class="nx">call</span><span class="p">(</span><span class="s1">&apos;GenericMethod&lt;string&gt;&apos;</span><span class="p">,[</span><span class="s1">&apos;A&apos;</span><span class="p">])</span>
</code></pre></div></div> <p><code class="highlighter-rouge">call</code> only invokes instance methods, to call static methods you&#x2019;ll need to use <code class="highlighter-rouge">Function</code>.</p> <h3 id="function">Function</h3> <p>Function is a universal accessor for .NET Types where it can create a cached <strong>delegate</strong> to access Instance, Static and Generic Static Types - Including Nested Types (aka Inner Classes), Instance, Static and Generic Methods of those Types as well as their Instance and Static Properties, Fields and Constants.</p> <p>As a simple example we&#x2019;ll use <code class="highlighter-rouge">Function</code> to create a delegate to call .NET&#x2019;s <code class="highlighter-rouge">System.Console.WriteLine(string)</code> static method:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;Console.WriteLine(string)&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">writeln</span>
</code></pre></div></div> <p>Which lets you call it like a regular Script method:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">writeln</span><span class="p">(</span><span class="s1">&apos;A&apos;</span><span class="p">)</span>
<span class="s1">&apos;A&apos;</span><span class="p">.</span><span class="nx">writeln</span><span class="p">()</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;Console.WriteLine(string)&apos;</span><span class="p">)(</span><span class="s1">&apos;A&apos;</span><span class="p">)</span>
</code></pre></div></div> <p>All Examples below uses classes defined in <a href="https://github.com/ServiceStack/sharpscript/blob/master/src/ScriptTypes.cs">ScriptTypes.cs</a>.</p> <h4 id="instance-methods">Instance Methods</h4> <p><code class="highlighter-rouge">Function</code> create delegates that lets you genericize the different types of method invocations in .NET, including instance methods, generic methods and <code class="highlighter-rouge">void</code> Action methods on an <strong>instance</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">&apos;InstanceLog&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">([</span><span class="s1">&apos;A&apos;</span><span class="p">])</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">o</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;InstanceLog.Log&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">log</span> <span class="c1">// instance void method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;InstanceLog.AllLogs&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">allLogs</span> <span class="c1">// instance method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;InstanceLog.Log&lt;int&gt;&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">genericLog</span> <span class="c1">// instance generic method</span> <span class="nx">o</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&apos;B&apos;</span><span class="p">)</span>
<span class="nx">log</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="s1">&apos;C&apos;</span><span class="p">)</span>
<span class="nx">o</span><span class="p">.</span><span class="nx">genericLog</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">o</span> <span class="o">|</span> <span class="nx">genericLog</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="nx">o</span><span class="p">.</span><span class="nx">allLogs</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">snapshotLogs</span>
</code></pre></div></div> <h4 id="static-type-methods">Static Type Methods</h4> <p>As well as calling static methods and static <code class="highlighter-rouge">void</code> Action methods on a <strong>static Type</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;StaticLog.Clear&apos;</span><span class="p">)()</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;StaticLog.Log&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">log</span> <span class="c1">// static void method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;StaticLog.AllLogs&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">allLogs</span> <span class="c1">// static method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;StaticLog.Log&lt;int&gt;&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">genericLog</span> <span class="c1">// static generic method</span> <span class="nx">log</span><span class="p">(</span><span class="s1">&apos;A&apos;</span><span class="p">)</span>
<span class="s1">&apos;B&apos;</span><span class="p">.</span><span class="nx">log</span><span class="p">()</span>
<span class="nx">genericLog</span><span class="p">(</span><span class="s1">&apos;C&apos;</span><span class="p">)</span>
<span class="nx">allLogs</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">snapshotLogs</span>
</code></pre></div></div> <h4 id="generic-static-type-methods">Generic Static Type Methods</h4> <p>Including calling generic static methods on a <strong>generic static Type</strong>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;GenericStaticLog&lt;string&gt;.Clear()&apos;</span><span class="p">)()</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;GenericStaticLog&lt;string&gt;.Log(string)&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">log</span> <span class="c1">// generic type static void method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;GenericStaticLog&lt;string&gt;.AllLogs&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">allLogs</span> <span class="c1">// generic type static method</span>
<span class="nb">Function</span><span class="p">(</span><span class="s1">&apos;GenericStaticLog&lt;string&gt;.Log&lt;int&gt;&apos;</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">genericLog</span> <span class="c1">// generic type generic static method</span> <span class="nx">log</span><span class="p">(</span><span class="s1">&apos;A&apos;</span><span class="p">)</span>
<span class="s1">&apos;B&apos;</span><span class="p">.</span><span class="nx">log</span><span class="p">()</span>
<span class="nx">genericLog</span><span class="p">(</span><span class="s1">&apos;C&apos;</span><span class="p">)</span>
<span class="nx">allLogs</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">snapshotLogs</span>
</code></pre></div></div> <h4 id="f-alias">F() alias</h4> <p>You can use the shorter <code class="highlighter-rouge">F()</code> alias to reduce syntax noise when writing #Script that heavily interops directly with .NET Classes.</p> <h4 id="instance-and-static-properties-fields-and-constants">Instance and Static Properties, Fields and Constants</h4> <p>In addition to being able to create Delegates that genericize access to .NET Methods, it can also be used to create a delegate
for accessing Instance and Static Properties, Fields and Constants including members of Inner Classes, e.g:</p> <p>Each of the members of the following Type definition:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">StaticLog</span>
<span class="p">{</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Prop</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Prop&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Field</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Field&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Const</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Const&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">InstanceProp</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&quot;StaticLog.InstanceProp&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">InstanceField</span> <span class="p">=</span> <span class="s">&quot;StaticLog.InstanceField&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">Inner1</span> <span class="p">{</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Prop1</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Prop1&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Field1</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Field1&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Const1</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Const1&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">InstanceProp1</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.InstanceProp1&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">InstanceField1</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.InstanceField1&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Inner2</span> <span class="p">{</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Prop2</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Inner2.Prop2&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">Field2</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Inner2.Field2&quot;</span><span class="p">;</span> <span class="k">public</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Const2</span> <span class="p">=</span> <span class="s">&quot;StaticLog.Inner1.Inner2.Const2&quot;</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Can be accessed the same way, where you can use <code class="highlighter-rouge">Function</code> to create a zero-argument delegate for static members that can be immediately invoked, or a 1 argument Delegate for instance members.</p> <p>Examples below uses Function&#x2019;s shorter <code class="highlighter-rouge">F()</code> alias:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Prop&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Field&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Const&apos;</span><span class="p">)()</span> <span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Prop1&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Field1&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Const1&apos;</span><span class="p">)()</span> <span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Inner2.Prop2&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Inner2.Field2&apos;</span><span class="p">)()</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.Inner2.Const2&apos;</span><span class="p">)()</span> <span class="s1">&apos;StaticLog&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">o</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.InstanceProp&apos;</span><span class="p">)(</span><span class="nx">o</span><span class="p">)</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.InstanceField&apos;</span><span class="p">)(</span><span class="nx">o</span><span class="p">)</span> <span class="s1">&apos;StaticLog.Inner1&apos;</span><span class="p">.</span><span class="k">new</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="nx">to</span> <span class="o">=&gt;</span> <span class="nx">o</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.InstanceProp1&apos;</span><span class="p">)(</span><span class="nx">o</span><span class="p">)</span>
<span class="nx">F</span><span class="p">(</span><span class="s1">&apos;StaticLog.Inner1.InstanceField1&apos;</span><span class="p">)(</span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></div> <h2 id="script-code">#Script Code</h2> <p>The initial support for <code class="highlighter-rouge">code</code> statements was implemented using a <a href="https://sharpscript.net/docs/transformers#code-transformation">simple pre-processor</a> that wrapped each line within a template expression - a technique inspired by CoffeeScript who used input source code transformation to reduce implementation burden.</p> <p>However the naivety of this approach showed itself when implementing smarter <a href="https://sharpscript.net/docs/blocks">Script Blocks</a> whose body you&#x2019;d want precise control over depending on the type of functionality it provides and the context from where it&#x2019;s used.</p> <p>For the new <a href="https://sharpscript.net/docs/blocks#csv">CSV</a> and <a href="https://sharpscript.net/docs/blocks#keyvalues">keyvalues</a> Script Blocks
used in <a href="https://sharpscript.net/usecases/live-documents">Live Documents</a> you&#x2019;ll always want to ensure the body is captured in unstructured free-text, e.g:</p> <p><a href="https://sharpscript.net/docs/blocks#csv"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/csv-block.png" alt></a></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{{#keyvalues monthlyRevenues &apos;:&apos;}}
    Salary:         4000
    App Royalties:  200
{{/keyvalues}}
</code></pre></div></div> <p>Likewise when used in <code class="highlighter-rouge">code</code> statements:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#keyvalues monthlyExpenses
    Rent            1000
    Internet        50
    Mobile          50
    Food            400
    Misc            200
/keyvalues
</code></pre></div></div> <p>But for blocks like <a href="https://sharpscript.net/docs/blocks#capture">capture</a> which captures dynamically generated output, it&#x2019;s preferred the body be expressed using templates:</p> <div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">{{#</span><span class="nn">capture</span> <span class="nv">out</span><span class="k">}}</span> <span class="nt">&lt;ul&gt;</span> <span class="k">{{#</span><span class="nn">each</span> <span class="nv">range</span><span class="err">(</span><span class="nv">3</span><span class="err">)</span><span class="k">}}</span> <span class="nt">&lt;li&gt;</span><span class="k">{{</span><span class="nv">it</span><span class="k">}}</span><span class="nt">&lt;/li&gt;</span> <span class="k">{{/</span><span class="nn">each</span><span class="k">}}</span> <span class="nt">&lt;/ul&gt;</span>
<span class="k">{{/</span><span class="nn">capture</span><span class="k">}}</span>
</code></pre></div></div> <p>Even when used from within <code class="highlighter-rouge">code</code> statements:</p> <div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#capture out <span class="nt">&lt;ul&gt;</span> <span class="k">{{#</span><span class="nn">each</span> <span class="nv">range</span><span class="err">(</span><span class="nv">3</span><span class="err">)</span><span class="k">}}</span> <span class="nt">&lt;li&gt;</span><span class="k">{{</span><span class="nv">it</span><span class="k">}}</span><span class="nt">&lt;/li&gt;</span> <span class="k">{{/</span><span class="nn">each</span><span class="k">}}</span> <span class="nt">&lt;/ul&gt;</span>
/capture
</code></pre></div></div> <p>Whilst the new <a href="https://sharpscript.net/docs/blocks#function">function blocks</a> body should always be defined using <code class="highlighter-rouge">code</code> statement block:</p> <div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#function fib(num) #if num <span class="nt">&lt;</span><span class="err">=</span> <span class="na">1</span> <span class="na">return</span><span class="err">(</span><span class="na">num</span><span class="err">)</span> <span class="err">/</span><span class="na">if</span> <span class="na">return</span> <span class="err">(</span><span class="na">fib</span><span class="err">(</span><span class="na">num-1</span><span class="err">)</span> <span class="err">+</span> <span class="na">fib</span><span class="err">(</span><span class="na">num-2</span><span class="err">))</span>
<span class="err">/</span><span class="na">function</span>
</code></pre></div></div> <p>Likewise when defined in &#x201C;template&#x201D; mode:</p> <div class="language-hbs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">{{#</span><span class="nn">function</span> <span class="nv">fib</span><span class="err">(</span><span class="nv">num</span><span class="err">)</span> <span class="k">}}</span> #if num <span class="nt">&lt;</span><span class="err">=</span> <span class="na">1</span> <span class="na">return</span><span class="err">(</span><span class="na">num</span><span class="err">)</span> <span class="err">/</span><span class="na">if</span> <span class="na">return</span> <span class="err">(</span><span class="na">fib</span><span class="err">(</span><span class="na">num-1</span><span class="err">)</span> <span class="err">+</span> <span class="na">fib</span><span class="err">(</span><span class="na">num-2</span><span class="err">))</span>
<span class="k">{{/</span><span class="nn">function</span><span class="k">}}</span>
</code></pre></div></div> <p>None of this was possible with our previous naive implementation. In Razor terms, this is akin to trying to support using Tag libraries from within a C# Statement blocks:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@{ <span class="nt">&lt;environment</span> <span class="na">names=</span><span class="s">&quot;Staging,Production&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;strong&gt;</span>HostingEnvironment.EnvironmentName is Staging or Production<span class="nt">&lt;/strong&gt;</span> <span class="nt">&lt;/environment&gt;</span>    
}
</code></pre></div></div> <p>The easiest solution would be to not support it and only allow script blocks when in &#x201C;Template Mode&#x201D;.</p> <p>But as <a href="https://sharpscript.net/docs/blocks">Script Blocks</a> are a powerful tool for defining nearly any kind of DSL
and <code class="highlighter-rouge">code</code> statement blocks being preferred for all other use-cases that doesn&#x2019;t involve generating text output, we decided
to implement it properly, with <code class="highlighter-rouge">code</code> statement blocks being implemented as a first-class language and script blocks
being able to specify how their <a href="https://sharpscript.net/docs/blocks#user-content-script-block-body">body should be parsed</a>.</p> <p>As a first-class language we can also offer the same language services as <code class="highlighter-rouge">#Script</code> templates:</p> <h3 id="executing-script-code-in-net">Executing #Script Code in .NET</h3> <p>To capture rendered output from <code class="highlighter-rouge">code</code> blocks you can use the new <code class="highlighter-rouge">RenderCode*</code> APIs:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// render code statements</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderCode</span><span class="p">(</span><span class="s">&quot;now |&gt; dateFormat(&apos;HH:mm:ss&apos;)&quot;</span><span class="p">);</span> <span class="c1">// async</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderCodeAsync</span><span class="p">(</span><span class="s">&quot;now |&gt; dateFormat(&apos;HH:mm:ss&apos;)&quot;</span><span class="p">);</span> 
</code></pre></div></div> <p>These APIs match the high-level APIs for rendering normal <code class="highlighter-rouge">#Script</code>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderScript</span><span class="p">(</span><span class="s">&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;</span><span class="p">);</span> <span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderScriptAsync</span><span class="p">(</span><span class="s">&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;</span><span class="p">);</span>
</code></pre></div></div> <h3 id="finer-grained-control">Finer grained control</h3> <p>The high-level APIs above wraps the finer-grained functionality below which works by rendering a <code class="highlighter-rouge">SharpPage</code> configured with the <code class="highlighter-rouge">code</code> language in a <code class="highlighter-rouge">PageResult</code> that all languages use:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScriptContext</span><span class="p">().</span><span class="nf">Init</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">dynamicPage</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">CodeSharpPage</span><span class="p">(</span><span class="s">&quot;now |&gt; dateFormat(&apos;HH:mm:ss&apos;)&quot;</span><span class="p">);</span> <span class="c1">// render code</span>
<span class="c1">//var dynamicPage = context.SharpScriptPage(&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;); // render #Script</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PageResult</span><span class="p">(</span><span class="n">dynamicPage</span><span class="p">).</span><span class="nf">RenderScript</span><span class="p">();</span> <span class="c1">//async</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nf">PageResult</span><span class="p">(</span><span class="n">dynamicPage</span><span class="p">).</span><span class="nf">RenderScriptAsync</span><span class="p">();</span>
</code></pre></div></div> <p>To instead capture the return value of a script block you can use the new <code class="highlighter-rouge">EvaluateCode</code> APIs, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">EvaluateCode</span><span class="p">(</span><span class="s">&quot;return (1 + 1)&quot;</span><span class="p">);</span> <span class="c1">//= 2</span>
</code></pre></div></div> <p>The generic overloads below utilizes ServiceStack&#x2019;s <a href="/auto-mapping">Auto Mapping utils</a> to convert the return value into your preferred type, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateCode</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;(</span><span class="s">&quot;return (1 + 1)&quot;</span><span class="p">);</span> <span class="c1">//= 2.0</span>
<span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateCode</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">&quot;return (1 + 1)&quot;</span><span class="p">);</span> <span class="c1">//= &quot;2&quot;</span>
</code></pre></div></div> <p>Which can also be used for more powerful conversions like converting an Object Dictionary into your preferred POCO:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateCode</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="s">&quot;`select * from customer where id=@id` |&gt; dbSingle({id}) |&gt;return&quot;</span> <span class="p">,</span> <span class="k">new</span> <span class="n">ObjectDictionary</span> <span class="p">{</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>
</code></pre></div></div> <h3 id="code-scripts">Code Scripts</h3> <p>The same functionality in Sharp Scripts is also available in #Script Code, except instead of using the <code class="highlighter-rouge">*.ss</code> file extension for executing <code class="highlighter-rouge">#Script</code> you&#x2019;d use the <code class="highlighter-rouge">*.sc</code> file extension which will allow you to use the web and app dotnet tools to watch or run code scripts:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ web run code.sc
$ web watch code.sc
</code></pre></div></div> <h3 id="watched-code-scripts">Watched code scripts</h3> <p>Here&#x2019;s a quick demo showcasing the same functionality in <a href="https://sharpscript.net/docs/sharp-scripts">Sharp Scripts</a> is also available in <code class="highlighter-rouge">*.sc</code> scripts which provides instant feedback whilst you develop in real-time:</p> <blockquote> <p>YouTube: <a href="https://youtu.be/TQPOZ0kVpw4">youtu.be/TQPOZ0kVpw4</a></p>
</blockquote> <p><a href="https://youtu.be/TQPOZ0kVpw4"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/code-sc.gif" alt></a></p> <p>When you&#x2019;ve re-designed your library to support multiple languages, the next one becomes much easier to add :) But still being mindful of library size, we&#x2019;d only want to include support for small and powerful languages - and there&#x2019;s few with a better power to weight ratio than Lisp!</p> <h2 id="introducing-script-lisp">Introducing #Script Lisp!</h2> <p><code class="highlighter-rouge">#Script</code> is itself designed as a small, expressive and wrist-friendly dynamic scripting language that for maximum familiarity
is modelled after the world&#x2019;s most popular and ubiquitous scripting Language, JavaScript. Its minimal syntax was inspired by other small but powerful languages which heavily utilizes functions instead of adopting a larger language grammar defining different bespoke syntax for language constructs.</p> <p>Small Languages like Smalltalk, despite being one of the most influential languages in history, is famous for its minimal
<a href="https://en.wikipedia.org/wiki/Smalltalk#Syntax">syntax that fits on a post card</a>. A language with arguably better power to size ratio is <a href="https://en.wikipedia.org/wiki/Lisp_%28programming_language%29">Lisp</a> which the inventor of
Smalltalk, Alan Kay has credited it as being
the <a href="https://en.wikiquote.org/wiki/Lisp_%28programming_language%29">greatest single programming language ever designed</a>
after realizing:</p> <blockquote> <p>&#x201C;the half page of code on the bottom of page 13&#x2026; was Lisp in itself. These were <a href="http://www.michaelnielsen.org/ddi/lisp-as-the-maxwells-equations-of-software/">&#x201C;Maxwell&#x2019;s Equations of Software!&#x201D;</a></p>
</blockquote> <p><a href="http://languagelog.ldc.upenn.edu/myl/llog/jmc.pdf">Lisp&#x2019;s unprecedented elegance and simplicity</a> spawned a <a href="https://en.wikipedia.org/wiki/List_of_Lisp-family_programming_languages">myriad of dialects</a>,
some noteworthy implementations illustrating the beauty of its small size and expressive power is <a href="http://norvig.com/lispy.html">lispy</a> by
by <a href="http://norvig.com">Peter Norvig</a> (Director of Google Research) that implements a Lisp interpreter in just <strong>117 lines of Python 3 code</strong> (inc. a REPL).</p> <p>Another compact dialect is <a href="https://github.com/zick/ZickStandardLisp">Zick Standard Lisp</a> which <a href="https://github.com/zick">@zick</a> has implemented in <strong>42 different languages</strong> including a <a href="https://github.com/zick/ZickStandardLisp/blob/master/lisp.lsp">recursive Lisp evaluator in Lisp</a>
implemented in only <strong>66 lines of code</strong>.</p> <p>A more complete Lisp implementation in C# is the elegant <a href="https://github.com/nukata/lisp-in-cs">Nukata Lisp</a> by <a href="https://github.com/nukata">SUZUKI Hisao</a> which is a Common Lisp-like <a href="https://stackoverflow.com/q/4578574/85785">Lisp-1</a> dialect with tail call optimization and partially hygienic macros, although
has some notable limitations including a <a href="https://github.com/nukata/lisp-in-cs/blob/d4258ec4b5681b0854a0d464b708df9ae26bbe3c/lisp.cs#L1216-L1391">small standard library</a>, only uses the <code class="highlighter-rouge">double</code> numeric type and doesn&#x2019;t contain .NET Scripting support.</p> <h3 id="script-lisp-overview">Script Lisp Overview</h3> <p><a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Common/Script/ScriptLanguage.Lisp.cs">ScriptLisp</a> is an
enhanced version of <a href="https://github.com/nukata/lisp-in-cs">Nukata Lisp</a> with a number of new features
that reuses <code class="highlighter-rouge">#Script</code> existing scripting capabilities to provide seamless integration with both the rest of <code class="highlighter-rouge">#Script</code>
(see <a href="http://localhost:5000/docs/syntax#language-blocks-and-expressions">Language Blocks an Expressions</a>)
and .NET including <a href="https://sharpscript.net/docs/script-net">Scripting of .NET Types</a>, support for all .NET numeric types and access to its comprehensive library of over <strong>1000+</strong> <a href="https://sharpscript.net/docs/methods">Script Methods</a> - optimally designed for accessing .NET functionality from a dynamic language.</p> <p>To improve compatibility with existing Common Lisp source code it also implements most of the <a href="http://jtra.cz/stuff/lisp/sclr/">Simplified Common Lisp Reference</a>
as well as all missing functions required to implement C# LINQ 101 Examples in Lisp:</p> <p>To improve readability and familiarity it also adopts a number of <strong>Clojure</strong> syntax for defining a <a href="https://clojure.org/guides/learn/syntax#_literal_collections">data list and map</a> literals, <a href="https://clojure.org/guides/learn/functions#_anonymous_function_syntax">anonymous functions</a>, syntax in <a href="https://clojure.org/guides/learn/functions#_java_interop">Java Interop</a> for .NET Interop,
<a href="https://clojure.org/guides/learn/hashed_colls#_field_accessors">keyword syntax for indexing collections</a> and accessing index accessors
and Clojure&#x2019;s popular shorter aliases for <code class="highlighter-rouge">fn</code>, <code class="highlighter-rouge">def</code>, <code class="highlighter-rouge">defn</code> - improving source-code compatibility with Clojure.</p> <h3 id="lisp-repl">Lisp REPL</h3> <p>In addition to being a 1st class language option in <code class="highlighter-rouge">#Script</code>, Lisp&#x2019;s dynamism and extensibility makes it particularly well suited for explanatory programming whose access via a REPL is now built into the latest <a href="/web-tool">web</a> and <a href="/netcore-windows-desktop">app</a> dotnet tools which can be quickly installed in any Windows, macOS or Linux OS (with <a href="https://dotnet.microsoft.com/download/dotnet-core/3.0">.NET Core</a>) with:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ dotnet tool install -g web
</code></pre></div></div> <p>Or if you have a previous version installed, update to the latest version with:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ dotnet tool update -g web
</code></pre></div></div> <p>Where you&#x2019;ll then be able to bring up an instant Lisp REPL with:</p> <p>The quick demo below shows the kind of exploratory programming available where you can query the <code class="highlighter-rouge">scriptMethods</code> available, query an objects <code class="highlighter-rouge">props</code>, query the Lisp interpreter&#x2019;s global <code class="highlighter-rouge">symbols</code> table containing all its global state including all defined lisp functions, macros and variables:</p> <blockquote> <p>YouTube: <a href="https://youtu.be/RR7yk6ReNnQ">youtu.be/RR7yk6ReNnQ</a></p>
</blockquote> <p><a href="https://youtu.be/RR7yk6ReNnQ"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/web-lisp.gif" alt></a></p> <h3 id="annotated-repl-walk-through">Annotated REPL Walk through</h3> <p>Here&#x2019;s an annotated version of the demo below which explains what each of the different expressions is doing.</p> <p>Just like <a href="https://sharpscript.net/docs/sharp-scripts">Sharp Scripts</a> and <a href="https://sharpscript.net/docs/sharp-apps">Sharp Apps</a> the Lisp REPL runs within the <a href="https://sharpscript.net/docs/sharp-pages">#Script Pages</a> ScriptContext <a href="https://sharpscript.net/docs/sandbox">sandbox</a> that when run from a Sharp App folder, starts a .NET Core App Server that simulates a fully configured .NET Core App. In this case it&#x2019;s running in the <a href="https://github.com/sharp-apps/redis">redis Sharp App</a> directory where it was able to access its static web assets
as well as its redis-server connection configured in its <a href="https://github.com/sharp-apps/redis/blob/master/app.settings">app.settings</a>.</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">; quick lisp test!</span>
<span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">; List of ScriptMethodInfo that the ScriptContext running this Lisp Interpreter has access to</span>
<span class="nv">scriptMethods</span> <span class="c1">; first script method</span>
<span class="p">(</span><span class="ss">:0</span> <span class="nv">scriptMethods</span><span class="p">)</span> <span class="c1">; show public properties of ScriptMethodInfo </span>
<span class="p">(</span><span class="nv">props</span> <span class="p">(</span><span class="ss">:0</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; show 1 property per line</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">props</span> <span class="p">(</span><span class="ss">:0</span> <span class="nv">scriptMethods</span><span class="p">)))</span> <span class="c1">; show both Property Type and Name</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">propTypes</span> <span class="p">(</span><span class="ss">:0</span> <span class="nv">scriptMethods</span><span class="p">)))</span> <span class="c1">; view the Names of all avaialble script methods</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Name</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; view all script methods starting with &apos;a&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;a*&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Name</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; view all script methods starting with &apos;env&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;env*&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Name</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; print environment info about this machine seperated by spaces</span>
<span class="p">(</span><span class="nv">printlns</span> <span class="nv">envOSVersion</span> <span class="nv">envMachineName</span> <span class="nv">envFrameworkDescription</span> <span class="nv">envLogicalDrives</span><span class="p">)</span> <span class="c1">; expand logical drives</span>
<span class="p">(</span><span class="nv">printlns</span> <span class="nv">envOSVersion</span> <span class="nv">envMachineName</span> <span class="nv">envFrameworkDescription</span> <span class="s">&quot;- drives:&quot;</span> <span class="p">(</span><span class="nv">join</span> <span class="nv">envLogicalDrives</span> <span class="s">&quot; &quot;</span><span class="p">))</span> <span class="c1">; view all current global symbols defined in this Lisp interpreter</span>
<span class="nv">symbols</span> <span class="c1">; view all symbols starting with &apos;c&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;c*&quot;</span> <span class="nv">symbols</span><span class="p">)</span> <span class="c1">; see how many symbols are defined in this interpreter</span>
<span class="p">(</span><span class="nb">count</span> <span class="nv">symbols</span><span class="p">)</span> <span class="c1">; see how many script methods there are available</span>
<span class="p">(</span><span class="nb">count</span> <span class="nv">scriptMethods</span><span class="p">)</span> <span class="c1">; view the method signature for all script methods starting with &apos;all&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;all*&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Signature</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; count all files accessible from the configured ScriptContext</span>
<span class="p">(</span><span class="nb">count</span> <span class="nv">allFiles</span><span class="p">)</span> <span class="c1">; view the public properties of the first IVirtualFile</span>
<span class="p">(</span><span class="nv">props</span> <span class="p">(</span><span class="ss">:0</span> <span class="nv">allFiles</span><span class="p">))</span> <span class="c1">; display the VirtualPath of all available files</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="nv">allFiles</span><span class="p">))</span> <span class="c1">; display the method signature for all script methods starting with &apos;findFiles&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;findFiles*&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Signature</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; see how many .html files are available to this App</span>
<span class="p">(</span><span class="nb">count</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">))</span> <span class="c1">; see how many .js files are available to this App</span>
<span class="p">(</span><span class="nb">count</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.js&quot;</span><span class="p">))</span> <span class="c1">; show the VirtualPath of all .html files</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">)))</span> <span class="c1">; view the VirtualPath&apos;s of the 1st and 2nd .html files</span>
<span class="p">(</span><span class="ss">:0</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="ss">:1</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">)))</span> <span class="c1">; view the text file contents of the 1st and 2nd .html files</span>
<span class="p">(</span><span class="nv">fileTextContents</span> <span class="p">(</span><span class="ss">:0</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">fileTextContents</span> <span class="p">(</span><span class="ss">:1</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="s">&quot;*.html&quot;</span><span class="p">))))</span> <span class="c1">; display the method signatures of all script methods starting with &apos;redis&apos;</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;redis*&quot;</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Signature</span> <span class="nv">scriptMethods</span><span class="p">))</span> <span class="c1">; search for all Redis Keys starting with &apos;urn:&apos; in the redis-server instances this App is configured with</span>
<span class="p">(</span><span class="nv">redisSearchKeys</span> <span class="s">&quot;urn:*&quot;</span><span class="p">)</span> <span class="c1">; display the first redis search entry</span>
<span class="p">(</span><span class="ss">:0</span> <span class="p">(</span><span class="nv">redisSearchKeys</span> <span class="s">&quot;urn:*&quot;</span><span class="p">))</span> <span class="c1">; display the key names of all redis keys starting with &apos;urn:&apos;</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">:id</span> <span class="p">(</span><span class="nv">redisSearchKeys</span> <span class="s">&quot;urn:*&quot;</span><span class="p">)))</span> <span class="c1">; find out the redis-server data type of the &apos;urn:tags&apos; key</span>
<span class="p">(</span><span class="nv">redisCall</span> <span class="s">&quot;TYPE urn:tags&quot;</span><span class="p">)</span> <span class="c1">; view all tags in the &apos;urn:tags&apos; sorted set</span>
<span class="p">(</span><span class="nv">redisCall</span> <span class="s">&quot;ZRANGE urn:tags 0 -1&quot;</span><span class="p">)</span> <span class="c1">; view the string contents of the &apos;urn:question:1&apos; key</span>
<span class="p">(</span><span class="nv">redisCall</span> <span class="s">&quot;GET urn:question:1&quot;</span><span class="p">)</span> <span class="c1">; parse the json contents of question 1 and display its tag names</span>
<span class="p">(</span><span class="ss">:Tags</span> <span class="p">(</span><span class="nv">parseJson</span> <span class="p">(</span><span class="nv">redisCall</span> <span class="s">&quot;GET urn:question:1&quot;</span><span class="p">)))</span> <span class="c1">; extract the 2nd tag of question 1</span>
<span class="p">(</span><span class="ss">:1</span> <span class="p">(</span><span class="ss">:Tags</span> <span class="p">(</span><span class="nv">parseJson</span> <span class="p">(</span><span class="nv">redisCall</span> <span class="s">&quot;GET urn:question:1&quot;</span><span class="p">))))</span> <span class="c1">; clear the Console screen</span>
<span class="nv">clear</span> <span class="c1">; exit the Lisp REPL</span>
<span class="nv">quit</span>
</code></pre></div></div> <h4 id="enable-features-and-access-resources-with-appsettings">Enable features and access resources with app.settings</h4> <p>You can configure the Lisp REPL with any of the resources and features that <a href="https://sharpscript.net/docs/sharp-apps">Sharp Apps</a> and <a href="https://sharpscript.net/docs/gist-desktop-apps">Gist Desktop Apps</a> have access to, by creating a plain text <code class="highlighter-rouge">app.settings</code> file with all the features and resources you want the Lisp REPL to have access to, e.g. this <a href="https://sharpscript.net/docs/sharp-apps#pure-cloud-apps">Pure Cloud App app.settings</a>
allows the Lisp REPL to use <a href="https://sharpscript.net/docs/db-scripts">Database Scripts</a> against a AWS PostgreSQL RDS server and query remote <a href="/virtual-file-system">S3 Virtual Files</a> using <a href="https://sharpscript.net/docs/protected-scripts#virtual-file-system-apis">Virtual File System APIs</a>:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Note: values prefixed with &apos;$&apos; are resolved from Environment Variables
name AWS S3 PostgreSQL Web App
db postgres
db.connection $AWS_RDS_POSTGRES
files s3
files.config {AccessKey:$AWS_S3_ACCESS_KEY,SecretKey:$AWS_S3_SECRET_KEY,Region:us-east-1,Bucket:rockwind}
</code></pre></div></div> <p>See the <a href="https://sharpscript.net/docs/sharp-apps#registering-servicestack-plugins">plugins app.settings</a> for examples of how to load and configure <a href="/plugins">ServiceStack Plugins</a>.</p> <h3 id="lisp-repl-tcp-server">Lisp REPL TCP Server</h3> <p>In addition to launching a Lisp REPL from the Console above, you can also open a Lisp REPL into any ServiceStack App configured with the <code class="highlighter-rouge">LispReplTcpServer</code> ServiceStack plugin. This effectively opens a <strong>&#x201C;programmable gateway&#x201D;</strong> into any ServiceStack App where it&#x2019;s able to perform live queries, access IOC dependencies, invoke internal Server functions and query
the state of a running Server which like the <a href="/debugging#debug-inspector">Debug Inspector</a> can provide invaluable insight when diagnosing issues on a remote server.</p> <p>To see it in action we&#x2019;ll enable it one of our production Apps <a href="https://techstacks.io">techstacks.io</a> which as it&#x2019;s a Vuetify SPA App is only configured with an empty <code class="highlighter-rouge">SharpPagesFeature</code> as it doesn&#x2019;t use any server-side scripting features.</p> <p>We&#x2019;ll enable it in <code class="highlighter-rouge">DebugMode</code> where we can enable by setting <code class="highlighter-rouge">DebugMode</code> in our App&#x2019;s <code class="highlighter-rouge">appsettings.Production.json</code> which will launch a TCP Socket Server which by default is configured to listen to the <strong>loopback</strong> IP on port <code class="highlighter-rouge">5005</code>.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">Config</span><span class="p">.</span><span class="n">DebugMode</span><span class="p">)</span>
<span class="p">{</span> <span class="n">Plugins</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">LispReplTcpServer</span> <span class="p">{</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">DbScripts</span><span class="p">()</span> <span class="p">},</span> <span class="n">ScriptNamespaces</span> <span class="p">=</span> <span class="p">{</span> <span class="k">nameof</span><span class="p">(</span><span class="n">TechStacks</span><span class="p">),</span> <span class="s">$&quot;</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">TechStacks</span><span class="p">)}</span><span class="s">.</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">ServiceInterface</span><span class="p">)}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">$&quot;</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">TechStacks</span><span class="p">)}</span><span class="s">.</span><span class="p">{</span><span class="k">nameof</span><span class="p">(</span><span class="n">ServiceModel</span><span class="p">)}</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">},</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <blockquote> <p><a href="https://sharpscript.net/docs/script-net#type-resolution">ScriptNamespaces</a> behaves like C#&#x2019;s <code class="highlighter-rouge">using Namespace;</code> statement letting you reference Types by <code class="highlighter-rouge">Name</code> instead of its fully-qualified Namespace.</p>
</blockquote> <p>Whilst you can now connect to it with basic <code class="highlighter-rouge">telnet</code>, it&#x2019;s a much nicer experience to use it with the <a href="https://linux.die.net/man/1/rlwrap">rlwrap</a>
readline wrap utility which provides an enhanced experience with line editing, persistent history and completion.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get install rlwrap
</code></pre></div></div> <p>Then you can open a TCP Connection to connect to a new Lisp REPL with:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ rlwrap telnet localhost 5005
</code></pre></div></div> <p>Where you now have full scriptability of the running server as allowed by <a href="https://sharpscript.net/docs/sharp-pages">#Script Pages</a> <code class="highlighter-rouge">SharpPagesFeature</code> which
allows <a href="https://sharpscript.net/docs/script-net#allowscriptingofalltypes">scripting of all .NET Types</a> by default.</p> <h4 id="techstacks-tcp-lisp-repl-demo">TechStacks TCP Lisp REPL Demo</h4> <p>In this demo we&#x2019;ll explore some of the possibilities of scripting the live <a href="https://techstacks.io">techstacks.io</a> Server where we can <code class="highlighter-rouge">resolve</code> IOC dependencies to send out tweets using its registered <code class="highlighter-rouge">ITwitterUpdates</code> dependency, view the source and load a remote <a href="https://gist.github.com/gistlyn/3624b0373904cfb2fc7bb3c2cb9dc1a3">parse-rss</a> lisp function into the new Lisp interpreter attached to the TCP connection, use it to parse <a href="https://news.ycombinator.com/rss">Hacker News RSS Feed</a> into a .NET Collection where it can be more easily queried using its built-in functions
which is used to construct an email body with <strong>HN&#x2019;s current Top 5 links</strong>.</p> <p>It then uses <a href="https://sharpscript.net/docs/db-scripts">DB Scripts</a> to explore its configured AWS RDS PostgreSQL RDBMS, listing its DB tables and viewing its column names and definitions before retrieving the Email addresses of all <strong>Admin</strong> users, sending them each an email with HN&#x2019;s Top 5 Links by publishing <strong>5x</strong> <code class="highlighter-rouge">SendEmail</code> Request DTOs using the <a href="https://sharpscript.net/docs/servicestack-scripts#publishmessage">publishMessage</a> ServiceStack Script to where they&#x2019;re processed in the background by its configured <a href="/messaging">MQ Server</a> that uses it to execute the <code class="highlighter-rouge">SendEmail</code> ServiceStack Service where it uses its configured AWS SES SMTP Server to finally send out the Emails:</p> <blockquote> <p>YouTube: <a href="https://youtu.be/HO523cFkDfk">youtu.be/HO523cFkDfk</a></p>
</blockquote> <p><a href="https://youtu.be/HO523cFkDfk"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-tcp-repl.gif" alt></a></p> <h3 id="password-protection">Password Protection</h3> <p>Since TCP Server effectively opens your remote Server up to being scripted you&#x2019;ll want to ensure the TCP Server is only accessible
within a trusted network, effectively treating it the same as <a href="https://redis.io/topics/security">Redis Security Model</a>.</p> <p>A secure approach would be to leave the default of only binding to <code class="highlighter-rouge">IPAddress.Loopback</code> so only trusted users with SSH access will be able to access it, which they&#x2019;ll still be able to access remotely via <code class="highlighter-rouge">Local PC &gt; ssh &gt; telnet 127.0.0.1 5005</code>.</p> <p>Just like <a href="https://redis.io/commands/auth">Redis AUTH</a> you can also add password protection for an additional layer of Security:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Plugins</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">LispReplTcpServer</span> <span class="p">{</span> <span class="n">RequireAuthSecret</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="p">...</span>
<span class="p">});</span>
</code></pre></div></div> <p>Which will only allow access to users with the <a href="/debugging#authsecret">configured AuthSecret</a>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">SetConfig</span><span class="p">(</span><span class="k">new</span> <span class="n">HostConfig</span> <span class="p">{</span> <span class="n">AdminAuthSecret</span> <span class="p">=</span> <span class="s">&quot;secretz&quot;</span> <span class="p">});</span>
</code></pre></div></div> <h4 id="annotated-lisp-tcp-repl-transcript">Annotated Lisp TCP REPL Transcript</h4> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">; resolve `ITwitterUpdates` IOC dependency and assign it to `twitter`</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">twitter</span> <span class="p">(</span><span class="nv">resolve</span> <span class="s">&quot;ITwitterUpdates&quot;</span><span class="p">))</span> <span class="c1">; view its concrete Type Name</span>
<span class="p">(</span><span class="nv">typeName</span> <span class="nv">twitter</span><span class="p">)</span> <span class="c1">; view its method names </span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">methods</span> <span class="nv">twitter</span><span class="p">))</span> <span class="c1">; view its method signatures </span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">methodTypes</span> <span class="nv">twitter</span><span class="p">))</span> <span class="c1">; use it to send tweet from its @webstacks account</span>
<span class="p">(</span><span class="o">.</span><span class="nv">Tweet</span> <span class="nv">twitter</span> <span class="s">&quot;Who&apos;s using #Script Lisp? https://sharpscript.net/lisp&quot;</span><span class="p">)</span> <span class="c1">; view all available scripts in #Script Lisp Library Index gist.github.com/3624b0373904cfb2fc7bb3c2cb9dc1a3</span>
<span class="p">(</span><span class="nv">gistindex</span><span class="p">)</span> <span class="c1">; view the source code of the `parse-rss` library</span>
<span class="p">(</span><span class="nv">load-src</span> <span class="s">&quot;index:parse-rss&quot;</span><span class="p">)</span> <span class="c1">; assign the XML contents of HN&apos;s RSS feed to `xml`</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">xml</span> <span class="p">(</span><span class="nv">urlContents</span> <span class="s">&quot;https://news.ycombinator.com/rss&quot;</span><span class="p">))</span> <span class="c1">; preview its first 1000 chars</span>
<span class="p">(</span><span class="nv">subString</span> <span class="nv">xml</span> <span class="mi">0</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1">; use `parse-rss` to parse the RSS feed into a .NET Collection and assign it to `rss`</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">rss</span> <span class="p">(</span><span class="nv">parse-rss</span> <span class="nv">xml</span><span class="p">))</span> <span class="c1">; view the `title`, `description` and the first `item` in the RSS feed:</span>
<span class="p">(</span><span class="ss">:title</span> <span class="nv">rss</span><span class="p">)</span>
<span class="p">(</span><span class="ss">:description</span> <span class="nv">rss</span><span class="p">)</span>
<span class="p">(</span><span class="ss">:0</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">))</span> <span class="c1">; view the links of all RSS feed items</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">:link</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">)))</span> <span class="c1">; view the links and titles of the top 5 news items</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">:link</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">5</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">:title</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">5</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">))))</span> <span class="c1">; construct a plain-text numbered list of the top 5 HN Links and assign it to `body`</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">map-index</span> <span class="o">#(</span><span class="nv">str</span> <span class="nv">%2</span> <span class="p">(</span><span class="ss">:title</span> <span class="nv">%1</span><span class="p">))</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">5</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">map-index</span> <span class="o">#(</span><span class="nv">str</span> <span class="p">(</span><span class="nv">padLeft</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">%2</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="s">&quot;. &quot;</span> <span class="p">(</span><span class="ss">:title</span> <span class="nv">%1</span><span class="p">))</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">5</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">))))</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">body</span> <span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">map-index</span> <span class="o">#(</span><span class="nv">str</span> <span class="p">(</span><span class="nv">padLeft</span> <span class="p">(</span><span class="nb">1+</span> <span class="nv">%2</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="s">&quot;. &quot;</span> <span class="p">(</span><span class="ss">:title</span> <span class="nv">%1</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span> <span class="p">(</span><span class="ss">:link</span> <span class="nv">%1</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">5</span> <span class="p">(</span><span class="ss">:items</span> <span class="nv">rss</span><span class="p">)))))</span> <span class="c1">; view all TechStacks PostgreSQL AWS RDS tables</span>
<span class="p">(</span><span class="nv">dbTableNames</span><span class="p">)</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="nv">dbTableNames</span><span class="p">)</span> <span class="c1">; view the column names and definitions of the `technology` table</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">dbColumnNames</span> <span class="s">&quot;technology&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nv">dbColumns</span> <span class="s">&quot;technology&quot;</span><span class="p">))</span> <span class="c1">; search for all `user` tables</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;*user*&quot;</span> <span class="p">(</span><span class="nv">dbTableNames</span><span class="p">))</span> <span class="c1">; view how many Admin Users with Emails there are</span>
<span class="p">(</span><span class="nv">dbScalar</span> <span class="s">&quot;select count(email) from custom_user_auth where roles like &apos;%Admin%&apos;&quot;</span><span class="p">)</span> <span class="c1">; assign the Admin Users email to the `emails` list</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">emails</span> <span class="p">(</span><span class="nb">map</span> <span class="ss">:email</span> <span class="p">(</span><span class="nv">dbSelect</span> <span class="s">&quot;select email from custom_user_auth where roles like &apos;%Admin%&apos;&quot;</span><span class="p">)))</span> <span class="c1">; search for all `operation` script methods</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;*operation*&quot;</span> <span class="nv">scriptMethods</span><span class="p">)</span> <span class="c1">; search for all `email` Request DTOs</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;*email*&quot;</span> <span class="nv">metaAllOperationNames</span><span class="p">)</span> <span class="c1">; view the properties available on the `SendEmail` Request DTO</span>
<span class="p">(</span><span class="nv">props</span> <span class="p">(</span><span class="nv">SendEmail.</span><span class="p">))</span> <span class="c1">; search for all `publish` script methods that can publish messages</span>
<span class="p">(</span><span class="nv">globln</span> <span class="s">&quot;publish*&quot;</span> <span class="nv">scriptMethods</span><span class="p">)</span> <span class="c1">; create and publish 5x `SendEmail` Request DTOs for processing by TechStacks configured MQ Server</span>
<span class="p">(</span><span class="nv">doseq</span> <span class="p">(</span><span class="nv">to</span> <span class="nv">emails</span><span class="p">)</span> <span class="p">(</span><span class="nv">publishMessage</span> <span class="s">&quot;SendEmail&quot;</span> <span class="nv">{</span> <span class="ss">:To</span> <span class="nv">to</span> <span class="ss">:Subject</span> <span class="s">&quot;Top 5 HN Links&quot;</span> <span class="ss">:Body</span> <span class="nv">body</span> <span class="nv">}</span><span class="p">))</span>
</code></pre></div></div> <h3 id="run-and-watch-lisp-scripts">Run and watch Lisp Scripts</h3> <p>The same <a href="https://sharpscript.net/docs/sharp-scripts">Sharp Scripts</a> functionality for <code class="highlighter-rouge">#Script</code> is also available to Lisp scripts where you can use the <code class="highlighter-rouge">web</code> and <code class="highlighter-rouge">app</code>
dotnet tools to <strong>run</strong> and <strong>watch</strong> stand-alone Lisp scripts with the <code class="highlighter-rouge">.l</code> file extension, e.g:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ web run lisp.l
$ web watch lisp.l
</code></pre></div></div> <p>To clarify the behavioural differences between the Lisp REPL&#x2019;s above which uses the <strong>same Lisp interpreter</strong> to maintain state changes across each command, the <code class="highlighter-rouge">watch</code> Script is run with a <strong>new Lisp Interpreter</strong> which starts with a <strong>fresh</strong> copy of the Global symbols table so any state changes after each <code class="highlighter-rouge">Ctrl+S</code> save point is discarded.</p> <h3 id="watch-lisp-scripts">Watch <code class="highlighter-rouge">lisp</code> scripts</h3> <p>This quick demo illustrates the same functionality in <a href="https://sharpscript.net/docs/sharp-scripts">Sharp Scripts</a> is also available in <code class="highlighter-rouge">lisp</code> scripts where it provides instant feedback whilst you develop in real-time:</p> <blockquote> <p>YouTube: <a href="https://youtu.be/rIgEP8ssikY">youtu.be/rIgEP8ssikY</a></p>
</blockquote> <p><a href="https://youtu.be/rIgEP8ssikY"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-l.gif" alt></a></p> <h3 id="annotated-lisp-watch-script">Annotated Lisp watch script</h3> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">;&lt;!--</span>
<span class="c1">; db sqlite</span>
<span class="c1">; db.connection northwind.sqlite</span>
<span class="c1">; files s3</span>
<span class="c1">; files.config {AccessKey:$AWS_S3_ACCESS_KEY,SecretKey:$AWS_S3_SECRET_KEY,Region:us-east-1,Bucket:rockwind}</span>
<span class="c1">;--&gt;</span> <span class="c1">; delete remove.txt file</span>
<span class="p">(</span><span class="nv">sh</span> <span class="p">(</span><span class="nv">str</span> <span class="p">(</span><span class="k">if</span> <span class="nv">isWin</span> <span class="s">&quot;del&quot;</span> <span class="s">&quot;rm&quot;</span><span class="p">)</span> <span class="s">&quot; remove.txt&quot;</span><span class="p">))</span> <span class="c1">; View all `northwind.sqlite` RDBMS Tables</span>
<span class="p">(</span><span class="nv">textDump</span> <span class="p">(</span><span class="nv">dbTableNames</span><span class="p">)</span> <span class="nv">{</span> <span class="ss">:caption</span> <span class="s">&quot;Northwind&quot;</span> <span class="nv">}</span> <span class="p">)</span> <span class="c1">; Display first `customer` row in Single Row View showing all Table Columns</span>
<span class="p">(</span><span class="nv">textDump</span> <span class="p">(</span><span class="nv">dbSelect</span> <span class="s">&quot;select * from customer limit 1&quot;</span><span class="p">))</span> <span class="c1">; Display all Customers in London</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">city</span> <span class="s">&quot;London&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">textDump</span> <span class="p">(</span><span class="nv">dbSelect</span> <span class="s">&quot;select Id, CompanyName, ContactName from customer where city = @city&quot;</span> <span class="nv">{</span> <span class="ss">:city</span> <span class="nv">city</span> <span class="nv">}</span> <span class="p">))</span> <span class="c1">; View all root files and folders in configured S3 Virtual File Provider</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">#(</span><span class="nv">str</span> <span class="p">(</span><span class="o">.</span><span class="nv">Name</span> <span class="nv">%</span><span class="p">)</span> <span class="s">&quot;/&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">allRootDirectories</span> <span class="nv">vfsContent</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">Name</span> <span class="p">(</span><span class="nv">allRootFiles</span> <span class="nv">vfsContent</span><span class="p">)))</span> <span class="c1">; Show first 10 *.png files in S3 VFS Provider</span>
<span class="p">(</span><span class="nv">def</span> <span class="nv">pattern</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">first</span> <span class="nv">ARGV</span><span class="p">)</span> <span class="s">&quot;*.png&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="nv">joinln</span> <span class="p">(</span><span class="nb">map</span> <span class="o">.</span><span class="nv">VirtualPath</span> <span class="p">(</span><span class="nv">take</span> <span class="mi">10</span> <span class="p">(</span><span class="nv">findFiles</span> <span class="nv">vfsContent</span> <span class="nv">pattern</span><span class="p">))))</span>
</code></pre></div></div> <h4 id="page-arguments">Page Arguments</h4> <p>You can also use the same syntax for declaring any <code class="highlighter-rouge">app.settings</code> page arguments used in <code class="highlighter-rouge">#Script</code> and <code class="highlighter-rouge">code</code> Scripts:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--
db sqlite
db.connection northwind.sqlite
--&gt;</span>
</code></pre></div></div> <p>But for compatibility with any Lisp syntax highlighters and code editors they can also be prefixed with a <code class="highlighter-rouge">;</code> line comment as seen above.</p> <h2 id="executing-lisp-in-net">Executing Lisp in .NET</h2> <p>Lisp like all <code class="highlighter-rouge">#Script</code> languages are executed within a <code class="highlighter-rouge">ScriptContext</code> that defines all functionality available to them, i.e:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">Args</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Global Arguments available to all Scripts, Pages, Partials, etc</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Methods</span> <span class="n">ScriptBlocks</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Script Blocks </span> <span class="n">FilterTransformers</span> <span class="p">=</span> <span class="p">{</span> <span class="p">..</span> <span class="p">},</span> <span class="c1">// Additional Stream Transformers</span> <span class="n">PageFormats</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Additional Text Document Formats</span> <span class="n">Plugins</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Encapsulated Features e.g. Markdown, Protected or ServiceStack Features</span> <span class="n">ScanTypes</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Auto register Methods, Blocks and Code Page Types</span> <span class="n">ScanAssemblies</span> <span class="p">=</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span> <span class="c1">// Auto register all Methods, Blocks and Code Page Types in Assembly</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>To render <code class="highlighter-rouge">lisp</code> you&#x2019;ll first need to register the Lisp Language with the <code class="highlighter-rouge">ScriptContext</code> you&#x2019;re using:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptLanguages</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ScriptLisp</span><span class="p">.</span><span class="n">Language</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>Then use <code class="highlighter-rouge">RenderLisp</code> (i.e. instead of <code class="highlighter-rouge">RenderScript</code>) to render Lisp code, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// render lisp</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderLisp</span><span class="p">(</span><span class="s">&quot;(dateFormat now \&quot;HH:mm:ss\&quot;)&quot;</span><span class="p">);</span> <span class="c1">// async</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderLispAsync</span><span class="p">(</span><span class="s">&quot;(dateFormat now \&quot;HH:mm:ss\&quot;)&quot;</span><span class="p">);</span> 
</code></pre></div></div> <p>These APIs match the high-level APIs for rendering normal <code class="highlighter-rouge">#Script</code>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderScript</span><span class="p">(</span><span class="s">&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;</span><span class="p">);</span> <span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">RenderScriptAsync</span><span class="p">(</span><span class="s">&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;</span><span class="p">);</span>
</code></pre></div></div> <h3 id="finer-grained-control-1">Finer grained control</h3> <p>The high-level APIs above wraps the finer-grained functionality below which works by rendering a <code class="highlighter-rouge">SharpPage</code> configured with the <code class="highlighter-rouge">lisp</code> language in a <code class="highlighter-rouge">PageResult</code> that all languages use:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptLanguages</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ScriptLisp</span><span class="p">.</span><span class="n">Language</span> <span class="p">}</span>
<span class="p">}.</span><span class="nf">Init</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">dynamicPage</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">LispSharpPage</span><span class="p">(</span><span class="s">&quot;(dateFormat now \&quot;HH:mm:ss\&quot;)&quot;</span><span class="p">);</span> <span class="c1">// render lisp</span>
<span class="c1">//var dynamicPage = context.SharpScriptPage(&quot;{{ now |&gt; dateFormat(&apos;HH:mm:ss&apos;) }}&quot;); // render #Script</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PageResult</span><span class="p">(</span><span class="n">dynamicPage</span><span class="p">).</span><span class="nf">RenderScript</span><span class="p">();</span> <span class="c1">//async</span>
<span class="kt">var</span> <span class="n">output</span> <span class="p">=</span> <span class="k">await</span> <span class="k">new</span> <span class="nf">PageResult</span><span class="p">(</span><span class="n">dynamicPage</span><span class="p">).</span><span class="nf">RenderScriptAsync</span><span class="p">();</span>
</code></pre></div></div> <h3 id="evaluating-lisp-script-results">Evaluating Lisp Script Results</h3> <p>If you instead wanted to access return values instead of its rendered output, use the <code class="highlighter-rouge">EvaluateLisp()</code> APIs:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">EvaluateLisp</span><span class="p">(</span><span class="s">&quot;(return (+ 1 1))&quot;</span><span class="p">);</span> <span class="c1">//= 2</span>
</code></pre></div></div> <p>The generic overloads below utilizes ServiceStack&#x2019;s <a href="/auto-mapping">Auto Mapping utils</a> to convert the return value into your preferred type, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateLisp</span><span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;(</span><span class="s">&quot;(return (+ 1 1))&quot;</span><span class="p">);</span> <span class="c1">//= 2.0</span>
<span class="kt">string</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateLisp</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">&quot;(return (+ 1 1))&quot;</span><span class="p">);</span> <span class="c1">//= &quot;2&quot;</span>
</code></pre></div></div> <p>Which can also be used for more powerful conversions like converting an Object Dictionary into your preferred POCO:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">EvaluateLisp</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span> <span class="s">&quot;(return (dbSingle \&quot;select * from customer where id=@id\&quot; { :id id }))&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="n">ObjectDictionary</span> <span class="p">{</span> <span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>
</code></pre></div></div> <h2 id="net-interop">.NET Interop</h2> <p>The syntax for .NET Interop is inspired directly from Clojure&#x2019;s syntax used for <a href="https://clojure.org/reference/java_interop">Java Interop</a>.
See <a href="https://sharpscript.net/docs/script-net#type-resolution">Scripting .NET Type Resolution</a> for how to configure Types and imported Namespaces you want your Lisp scripts to have access to.</p> <h3 id="member-access">Member Access</h3> <p>The <code class="highlighter-rouge">&apos;.&apos;</code> prefix if for accessing an instance members which can be used for retrieving a properties public properties, fields and
invoking instance methods, e.g:</p> <ul> <li><strong>(.Property instance)</strong></li> <li><strong>(.Field instance)</strong></li> <li><strong>(.Method instance &#x2026;args)</strong></li>
</ul> <h3 id="indexer-access">Indexer Access</h3> <p>Use <code class="highlighter-rouge">&apos;:&apos;</code> prefix for accessing a Types indexer or for indexing collections, e.g:</p> <ul> <li><strong>(:key indexer)</strong></li> <li><strong>(:&#x201D;string key&#x201D; dictionary)</strong></li> <li><strong>(:n list)</strong></li> <li><strong>(:n array)</strong></li> <li><strong>(:n enumerable)</strong></li> <li><strong>(:n indexer)</strong></li>
</ul> <p>It can also be used to access an instance public Properties and Fields:</p> <ul> <li><strong>(:Property instance)</strong></li> <li><strong>(:Field instance)</strong></li>
</ul> <p>However for readability we recommend using <code class="highlighter-rouge">&apos;.&apos;</code> prefix above to convey instance member access.</p> <h3 id="constructor-access">Constructor Access</h3> <p>Use <code class="highlighter-rouge">&apos;.&apos;</code> <strong>suffix</strong> for creating instances of Types:</p> <ul> <li><strong>(Type. &#x2026;args)</strong></li> <li><strong>(Namespace.Type. &#x2026;args)</strong></li>
</ul> <p>You can also create instances using the <a href="https://sharpscript.net/docs/script-net#creating-instances">new script method</a>, which as it accepts a <code class="highlighter-rouge">string</code> Type Name can be used to create generic classes with multiple generic args, e.g:</p> <ul> <li><strong>(new &#x201C;Type&#x201D; &#x2026;args)</strong></li> <li><strong>(new &#x201C;Type&lt;T1,T2,T3&gt;&#x201D; &#x2026;args)</strong></li>
</ul> <h3 id="static-member-access">Static Member Access</h3> <p>Use the <code class="highlighter-rouge">&apos;/&apos;</code> separator to access a Type&#x2019;s static members or to invoke its static methods, e.g:</p> <ul> <li><strong>(StaticType/Property)</strong></li> <li><strong>(StaticType/Field)</strong></li> <li><strong>(StaticType/Const)</strong></li> <li><strong>(StaticType/Method &#x2026;args)</strong></li>
</ul> <p>Use <code class="highlighter-rouge">&apos;.&apos;</code> dot notation for specifying the fully-qualified Type name or to reference its Inner classes, e.g:</p> <ul> <li><strong>(Namespace.StaticType/Member)</strong></li> <li><strong>(Namespace.StaticType.InnerType/Member)</strong></li>
</ul> <h3 id="script-methods">Script Methods</h3> <p>Use <code class="highlighter-rouge">&apos;/&apos;</code> prefix to reference any Script Method registered in your <code class="highlighter-rouge">ScriptContext</code>:</p> <p>Script Methods without arguments can be referenced as an <a href="https://sharpscript.net/docs/default-scripts#as-bindings">argument binding</a> that when referenced as an argument (i.e. without brackets) are implicitly evaluated, in-effect making them a calculated property:</p> <p>While a <code class="highlighter-rouge">&apos;/&apos;</code> prefix indicates a reference to a <a href="https://sharpscript.net/docs/methods">script method</a>, for readability it can be excluded as when there&#x2019;s no existing symbol defined in the Lisp interpreter&#x2019;s symbol table it will fallback to referencing a script method:</p> <ul> <li><strong>(scriptMethod &#x2026;args)</strong></li> <li><strong>methodAsBinding</strong></li>
</ul> <p>This does mean that when there exists a <code class="highlighter-rouge">symbol</code> of the same name defined you will need to use the <code class="highlighter-rouge">&apos;/&apos;</code> prefix to reference a script method.</p> <h3 id="generic-types">Generic Types</h3> <p>All references above support referencing generic types and methods with a single generic Type argument, e.g:</p> <ul> <li><strong>(StaticType/Method&lt;T&gt;)</strong></li> <li><strong>(GenericStaticType&lt;T&gt;/Member)</strong></li> <li><strong>(GenericStaticType&lt;T&gt;/Method&lt;T&gt;)</strong></li> <li><strong>(GenericType&lt;T&gt;.)</strong></li>
</ul> <p>As <code class="highlighter-rouge">&apos;,&apos;</code> is one of Lisp&#x2019;s few syntax tokens (<a href="http://www.lispworks.com/documentation/HyperSpec/Body/02_df.htm">unquoting</a>) it prevents them
from being able to use them to specify multiple generic arguments.</p> <p>Instead you&#x2019;ll need to use the <a href="https://sharpscript.net/docs/script-net#creating-instances">Constructor function</a> for referencing constructors with multiple generic
arguments where you&#x2019;ll also need to specify the types of the exact constructor you want to call, e.g:</p> <ul> <li><strong>(/C &#x201C;Tuple&lt;String,int&gt;(String,int)&#x201D;)</strong></li>
</ul> <p>The difference between the <code class="highlighter-rouge">/C</code> script method constructor function and Lisp&#x2019;s <code class="highlighter-rouge">C</code> function is that the script method only returns a reference
to the constructor which you&#x2019;ll need to invoke with arguments to create an instance:</p> <ul> <li><strong>((/C &#x201C;Tuple&lt;String,int&gt;(String,int)&#x201D;) &#x201C;A&#x201D; 1)</strong></li>
</ul> <p>Whilst Lisp&#x2019;s <code class="highlighter-rouge">C</code> function will auto-invoke the constructor function with the supplied arguments in a single expression:</p> <ul> <li><strong>(C &#x201C;Tuple&lt;String,int&gt;(String,int)&#x201D; &#x201C;A&#x201D; 1)</strong></li>
</ul> <p>Likewise when needing to invoke generic methods with multiple generic args you&#x2019;ll need to use <a href="https://sharpscript.net/docs/script-net#function">Function</a>:</p> <ul> <li><strong>((/F &#x201C;Tuple.Create&lt;String,int&gt;(String,int)&#x201D;) &#x201C;A&#x201D; 1)</strong></li>
</ul> <p>Or Script Lisp&#x2019;s <code class="highlighter-rouge">F</code> function for invoking a function reference in a single expression:</p> <ul> <li><strong>(F &#x201C;Tuple.Create&lt;String,int&gt;(String,int)&#x201D; &#x201C;A&#x201D; 1)</strong></li>
</ul> <p>For more examples and information see <a href="https://sharpscript.net/docs/script-net">Scripting .NET Types</a>.</p> <h3 id="property-setters">Property Setters</h3> <p>You can populate multiple properties on an instance using the <a href="https://sharpscript.net/docs/script-net#user-content-set">set script method</a>, e.g:</p> <ul> <li><strong>(set instance { :Prop arg &#x2026; })</strong></li>
</ul> <p>Alternatively properties can be set individually with:</p> <h3 id="lisp-lists-vs-net-collections">Lisp Lists vs .NET Collections</h3> <p>A potential source of friction when interoperating with .NET is that Lisp Lists are <a href="https://cs.gmu.edu/~sean/lisp/cons/">Cons Cells</a>
so that a code or data list in Lisp, i.e:</p> <p>Is implemented as a Linked List of Cons cells:</p> <p>Which is what Lisp&#x2019;s core functions expect to operate on, namely:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>car cdr caar cadr cdar cddr caaar caadr cadar caddr cdaar cdadr cddar cdddr append mapcar consp cons?
listp list? memq member assq assoc nreverse last nconc dolist dotimes mapcan mapc nthcdr nbutlast 
</code></pre></div></div> <p>These core Lisp functions can&#x2019;t be used against .NET collections directly, instead you can use <code class="highlighter-rouge">(to-cons collection)</code> to convert a .NET <code class="highlighter-rouge">IEnumerable</code> collection into a cons list, e.g:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(cdr (to-cons netEnumerable))
</code></pre></div></div> <p>Should you need to do the inverse you can use <code class="highlighter-rouge">(to-list cons-list)</code> to convert a cons list to a .NET List, e.g:</p> <p>We&#x2019;ve made Script Lisp&#x2019;s cons <code class="highlighter-rouge">Cell</code> an <code class="highlighter-rouge">IEnumerable</code> so that <strong>all other built-in Lisp functions</strong> can operate on both cons cells and .NET Collections where instead of iterating a list with <code class="highlighter-rouge">(do-list)</code> you can use <code class="highlighter-rouge">(do-seq)</code> to iterate
both .NET Collections and cons cells, e.g:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(do-seq (x collection) (println x) )
</code></pre></div></div> <h3 id="annotated-net-interop-example">Annotated .NET Interop Example</h3> <p>To see what this looks like in action here&#x2019;s an annotated simple real-world example that heavily utilizes .NET interop:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">; define function and assign to `parse-rss` value in Lisp interpreters symbols table</span>
<span class="p">(</span><span class="nv">defn</span> <span class="nv">parse-rss</span> <span class="nv">[xml]</span> <span class="c1">; define local variables used within this scope</span> <span class="p">(</span><span class="k">let</span> <span class="p">(</span> <span class="p">(</span><span class="nv">to</span><span class="p">)</span> <span class="p">(</span><span class="nv">doc</span><span class="p">)</span> <span class="p">(</span><span class="nv">channel</span><span class="p">)</span> <span class="p">(</span><span class="nv">items</span><span class="p">)</span> <span class="p">(</span><span class="nv">el</span><span class="p">)</span> <span class="p">)</span> <span class="c1">; use XDocument.Parse() to parse xml string argument containing xml and assign to `doc`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">doc</span> <span class="p">(</span><span class="nv">System.Xml.Linq.XDocument/Parse</span> <span class="nv">xml</span><span class="p">))</span> <span class="c1">; create empty ObjectDictionary (wrapper for Dictionary&lt;string,object&gt;) and assign to `to`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">to</span> <span class="p">(</span><span class="nv">ObjectDictionary.</span><span class="p">))</span> <span class="c1">; create empty List of ObjectDictionary and assign to `items`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">items</span> <span class="p">(</span><span class="nv">List&lt;ObjectDictionary&gt;.</span><span class="p">))</span> <span class="c1">; descend into first &lt;channel&gt; XML element and assign to `channel`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">channel</span> <span class="p">(</span><span class="nb">first</span> <span class="p">(</span><span class="o">.</span><span class="nv">Descendants</span> <span class="nv">doc</span> <span class="s">&quot;channel&quot;</span><span class="p">)))</span> <span class="c1">; use `XLinqExtensions.FirstElement()` extension method to assign channels first XML element to `el`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">el</span> <span class="p">(</span><span class="nv">XLinqExtensions/FirstElement</span> <span class="nv">channel</span><span class="p">))</span> <span class="c1">; iterate through all elements up to the first &lt;item&gt; and add them as top-level entries in `to`</span> <span class="p">(</span><span class="nv">while</span> <span class="p">(</span><span class="nv">not=</span> <span class="p">(</span><span class="o">.</span><span class="nv">LocalName</span> <span class="p">(</span><span class="o">.</span><span class="nv">Name</span> <span class="nv">el</span><span class="p">))</span> <span class="s">&quot;item&quot;</span><span class="p">)</span> <span class="c1">; add current XML element name and value entry to `to`</span> <span class="p">(</span><span class="o">.</span><span class="nv">Add</span> <span class="nv">to</span> <span class="p">(</span><span class="o">.</span><span class="nv">LocalName</span> <span class="p">(</span><span class="o">.</span><span class="nv">Name</span> <span class="nv">el</span><span class="p">))</span> <span class="p">(</span><span class="o">.</span><span class="nv">Value</span> <span class="nv">el</span><span class="p">))</span> <span class="c1">; move to next element using `XLinqExtensions.NextElement()` extension method</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">el</span> <span class="p">(</span><span class="nv">XLinqExtensions/NextElement</span> <span class="nv">el</span><span class="p">)))</span> <span class="c1">; add all rss &lt;item&gt;&apos;s to `items` list</span> <span class="c1">; iterate through all `channel` child &lt;item&gt; XML elements</span> <span class="p">(</span><span class="nv">doseq</span> <span class="p">(</span><span class="nv">elItem</span> <span class="p">(</span><span class="o">.</span><span class="nv">Descendants</span> <span class="nv">channel</span> <span class="s">&quot;item&quot;</span><span class="p">))</span> <span class="c1">; create empty ObjectDictionary and assign to `item`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">item</span> <span class="p">(</span><span class="nv">ObjectDictionary.</span><span class="p">))</span> <span class="c1">; use `XLinqExtensions.FirstElement()` to assign &lt;item&gt; first XML element to `el`</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">el</span> <span class="p">(</span><span class="nv">XLinqExtensions/FirstElement</span> <span class="nv">elItem</span><span class="p">))</span> <span class="p">(</span><span class="nv">while</span> <span class="nv">el</span> <span class="c1">; add current XML element name and value entry to `item`</span> <span class="p">(</span><span class="o">.</span><span class="nv">Add</span> <span class="nv">item</span> <span class="p">(</span><span class="o">.</span><span class="nv">LocalName</span> <span class="p">(</span><span class="o">.</span><span class="nv">Name</span> <span class="nv">el</span><span class="p">))</span> <span class="p">(</span><span class="o">.</span><span class="nv">Value</span> <span class="nv">el</span><span class="p">))</span> <span class="c1">; move to next element using `XLinqExtensions.NextElement()` extension method</span> <span class="p">(</span><span class="nv">def</span> <span class="nv">el</span> <span class="p">(</span><span class="nv">XLinqExtensions/NextElement</span> <span class="nv">el</span><span class="p">)))</span> <span class="c1">; add `item` ObjectDictionary to `items` List</span> <span class="p">(</span><span class="o">.</span><span class="nv">Add</span> <span class="nv">items</span> <span class="nv">item</span><span class="p">))</span> <span class="c1">; add `items` ObjectDictionary List to `to` at key `items`</span> <span class="p">(</span><span class="o">.</span><span class="nv">Add</span> <span class="nv">to</span> <span class="s">&quot;items&quot;</span> <span class="nv">items</span><span class="p">)</span> <span class="c1">; return `to` ObjectDictionary</span> <span class="nv">to</span> <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div> <p>For comparison, this would be the equivalent implementation in C#:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="n">ObjectDictionary</span> <span class="nf">ParseRss</span><span class="p">(</span><span class="kt">string</span> <span class="n">xml</span><span class="p">)</span>
<span class="p">{</span> <span class="kt">var</span> <span class="n">to</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ObjectDictionary</span><span class="p">();</span> <span class="kt">var</span> <span class="n">items</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ObjectDictionary</span><span class="p">&gt;();</span> <span class="kt">var</span> <span class="n">doc</span> <span class="p">=</span> <span class="n">XDocument</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">xml</span><span class="p">);</span> <span class="kt">var</span> <span class="n">channel</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="nf">Descendants</span><span class="p">(</span><span class="s">&quot;channel&quot;</span><span class="p">).</span><span class="nf">First</span><span class="p">();</span> <span class="kt">var</span> <span class="n">el</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">FirstElement</span><span class="p">();</span> <span class="k">while</span> <span class="p">(</span><span class="n">el</span><span class="p">.</span><span class="n">Name</span> <span class="p">!=</span> <span class="s">&quot;item&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">to</span><span class="p">[</span><span class="n">el</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">LocalName</span><span class="p">]</span> <span class="p">=</span> <span class="n">el</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span> <span class="n">el</span> <span class="p">=</span> <span class="n">el</span><span class="p">.</span><span class="nf">NextElement</span><span class="p">();</span> <span class="p">}</span> <span class="kt">var</span> <span class="n">elItems</span> <span class="p">=</span> <span class="n">channel</span><span class="p">.</span><span class="nf">Descendants</span><span class="p">(</span><span class="s">&quot;item&quot;</span><span class="p">);</span> <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">elItem</span> <span class="k">in</span> <span class="n">elItems</span><span class="p">)</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">item</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ObjectDictionary</span><span class="p">();</span> <span class="n">el</span> <span class="p">=</span> <span class="n">elItem</span><span class="p">.</span><span class="nf">FirstElement</span><span class="p">();</span> <span class="k">while</span> <span class="p">(</span><span class="n">el</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span><span class="p">[</span><span class="n">el</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">LocalName</span><span class="p">]</span> <span class="p">=</span> <span class="n">el</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span> <span class="n">el</span> <span class="p">=</span> <span class="n">el</span><span class="p">.</span><span class="nf">NextElement</span><span class="p">();</span> <span class="p">}</span> <span class="n">items</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span> <span class="p">}</span> <span class="n">to</span><span class="p">[</span><span class="s">&quot;items&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">items</span><span class="p">;</span> <span class="k">return</span> <span class="n">to</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="importing-global-scripts">Importing Global Scripts</h3> <p>Importing scripts in Lisp is essentially a 2-stage process of parsing Lisp source code into an <a href="https://en.wikipedia.org/wiki/S-expression">SExpression</a>, (basically Lisp&#x2019;s AST of tokenized elements captured in a <a href="https://cs.gmu.edu/~sean/lisp/cons/">2-field Cons Cell</a>) then evaluating it in a Lisp interpreter where any defined symbols are captured in its Symbols table.</p> <p>Lisp Script captures its &#x201C;standard library&#x201D; in a Global Interpreter which serves as the starting template for all other Lisp Interpreters which starts with a copy of the Global symbols table which you can further populate with your own common functions using <code class="highlighter-rouge">Lisp.Import()</code>, e.g:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Lisp</span><span class="p">.</span><span class="nf">Import</span><span class="p">(</span><span class="s">@&quot;
(defun fib (n) (if (&lt; n 2) 1 (+ (fib (- n 1)) (fib (- n 2)) )))&quot;</span><span class="p">);</span>
</code></pre></div></div> <h3 id="loading-scripts">Loading Scripts</h3> <p>Loading scripts within a Lisp script works similarly except they&#x2019;re only loaded into that Lisp interpreters symbol table, a new one
of which is created in each new <code class="highlighter-rouge">PageResult</code>.</p> <p>Scripts loaded locally are loaded from the <code class="highlighter-rouge">ScriptContext</code> configured <a href="/virtual-file-system">Virtual Files Provider</a> which for <a href="https://sharpscript.net/docs/sharp-pages">#Script Pages</a> <code class="highlighter-rouge">SharpPagesFeature</code> is configured to use the App&#x2019;s cascading virtual file sources.</p> <p>A new <code class="highlighter-rouge">ScriptContext</code> starts with an empty <a href="/virtual-file-system#virtual-file-systems-available">MemoryVirtualFiles</a>
which you can write files to with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ScriptContext</span> <span class="p">{</span> <span class="n">ScriptLanguages</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ScriptLisp</span><span class="p">.</span><span class="n">Language</span> <span class="p">},</span> <span class="n">ScriptMethods</span> <span class="p">=</span> <span class="p">{</span> <span class="k">new</span> <span class="nf">ProtectedScripts</span><span class="p">()</span> <span class="p">},</span>
<span class="p">};</span>
<span class="n">context</span><span class="p">.</span><span class="n">VirtualFiles</span><span class="p">.</span><span class="nf">WriteFile</span><span class="p">(</span><span class="s">&quot;lib1.l&quot;</span><span class="p">,</span> <span class="s">&quot;(defn lib-calc [a b] (+ a b))&quot;</span><span class="p">);</span>
<span class="n">context</span><span class="p">.</span><span class="n">VirtualFiles</span><span class="p">.</span><span class="nf">WriteFile</span><span class="p">(</span><span class="s">&quot;/dir/lib2.l&quot;</span><span class="p">,</span> <span class="s">&quot;(defn lib-calc [a b] (* a b))&quot;</span><span class="p">);</span>
<span class="n">context</span><span class="p">.</span><span class="nf">Init</span><span class="p">();</span>
</code></pre></div></div> <p>You can load these scripts by symbol name where it assumes a <code class="highlighter-rouge">.l</code> extension, by quoting the argument so Lisp doesn&#x2019;t try to evaluate it as an argument, e.g:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="ss">&apos;lib1</span><span class="p">)</span> <span class="p">(</span><span class="nv">lib-calc</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;= 9</span>
</code></pre></div></div> <p>Alternatively you can specify the virtual path to the script. You can load multiple scripts with the same definitions,
in Lisp this just updates the value assigned to the symbol name with the latest definition, e.g:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="s">&quot;lib1.l&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">lib-calc</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;= 9</span> <span class="p">(</span><span class="nb">load</span> <span class="s">&quot;/dir/lib2.l&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">lib-calc</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">;= 20</span>
</code></pre></div></div> <h3 id="import-scripts-from-urls">Import Scripts from URLs</h3> <p>Inspired by <a href="https://deno.land">Deno</a> you can also import remote scripts from URLs, e.g:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="s">&quot;https://example.org/lib.l&quot;</span><span class="p">)</span>
</code></pre></div></div> <h3 id="locally-cached">Locally Cached</h3> <p>Like <a href="https://deno.land/manual.html">Deno</a> all remote resources are cached after first use so after it&#x2019;s loaded once it only loads the locally cached
version of the script (where it will still work in an airplane without an internet connection). This cache is maintained under a <code class="highlighter-rouge">.lisp</code> folder at your configured Virtual Files provider (that can be deleted to clear any caches).</p> <p>For Sharp Scripts or Apps using the <code class="highlighter-rouge">web</code> or <code class="highlighter-rouge">app</code> dotnet tools it&#x2019;s stored in its own cache folder that can be cleared with:</p> <h3 id="import-scripts-from-gists">Import Scripts from Gists</h3> <p>There&#x2019;s also first-class support for gists which you can reference with <code class="highlighter-rouge">gist:&lt;gist-id&gt;</code>, e.g:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="s">&quot;gist:2f14d629ba1852ee55865607f1fa2c3e&quot;</span><span class="p">)</span>
</code></pre></div></div> <p>This will load all gist files in gist order, if you only to load a single file from a gist you can specify it with:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="s">&quot;gist:2f14d629ba1852ee55865607f1fa2c3e/lib1.l&quot;</span><span class="p">)</span>
</code></pre></div></div> <h3 id="script-lisp-library-index">Script Lisp Library Index</h3> <p>To provide human readable names to remote Lisp Scripts and a discoverable catalog where anyone can share their own scripts,
you reference gists by name listed in the <a href="https://gist.github.com/gistlyn/3624b0373904cfb2fc7bb3c2cb9dc1a3">#Script Lisp Library Index</a>
which is itself a self-documenting machine and human readable gist of named links to external gists maintained by their respective authors.</p> <p>Index library references can be loaded using the format <code class="highlighter-rouge">index:&lt;name&gt;</code>, e.g:</p> <p>Which also support being able to reference individual gist files:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">load</span> <span class="s">&quot;index:lib-calc/lib1.l&quot;</span><span class="p">)</span>
</code></pre></div></div> <p>If you&#x2019;d like to share your own Lisp Scripts with everyone and publish your library to the index, just add a link
to your gist with your preferred name in the <a href="https://gist.github.com/gistlyn/3624b0373904cfb2fc7bb3c2cb9dc1a3">Gist Index Comments</a>.</p> <h3 id="viewing-script-source-code">Viewing Script Source Code</h3> <p>You can view the source code of any load script references with <code class="highlighter-rouge">load-src</code>, e.g:</p> <div class="language-common-lisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nv">load-src</span> <span class="ss">&apos;lib</span><span class="p">)</span>
<span class="p">(</span><span class="nv">load-src</span> <span class="s">&quot;/dir/lib2.l&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">load-src</span> <span class="s">&quot;https://example.org/lib.l&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">load-src</span> <span class="s">&quot;gist:2f14d629ba1852ee55865607f1fa2c3e/lib1.l&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">load-src</span> <span class="s">&quot;index:lib-calc&quot;</span><span class="p">)</span>
</code></pre></div></div> <h3 id="disable-remote-imports">Disable Remote Imports</h3> <p>Should you wish, you can prevent anyone from loading remote scripts with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Lisp</span><span class="p">.</span><span class="n">AllowLoadingRemoteScripts</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</code></pre></div></div> <h3 id="script-pages-integration">#Script Pages Integration</h3> <p>Whilst Lisp is a small, powerfully expressive functional dynamic language it&#x2019;s not great for use as a templating language. Whilst there have been <a href="https://www.cliki.net/HTML%20generator">several attempts to create a HTML DSL in Lisp</a>, nothing is better
than having <strong>no syntax</strong> which is the default <strong>Template mode</strong> for <code class="highlighter-rouge">#Script</code> where it will emit everything that&#x2019;s not in a Template or Language Expression as verbatim text.</p> <p>A nice USP of Script Lisp is that you&#x2019;re never forced into going &#x201C;full Lisp&#x201D;, you can utilize <code class="highlighter-rouge">#Script</code> template expressions and
<a href="https://sharpscript.net/docs/blocks">Script Blocks</a> handlebars syntax that provides the ideal DSL for usage in a Template Language for generating HTML
and utilize your preferred <code class="highlighter-rouge">Lisp</code> or <a href="/scode/">Code</a> Script Languages for any computational logic you want included in your page
using <a href="https://sharpscript.net/docs/syntax#language-blocks-and-expressions">Language Blocks and Expressions</a>.</p> <h4 id="implementation">Implementation</h4> <p>Despite being implemented in different languages a <code class="highlighter-rouge">#Script</code> page containing multiple languages, e.g:</p> <p><a href="https://sharpscript.net/lisp/#implementation"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/linq01-langs.png" alt></a></p> <p>Still only produces a <strong>single page AST</strong>, where when first loaded <code class="highlighter-rouge">#Script</code> parses the page contents as a contiguous
<code class="highlighter-rouge">ReadOnlyMemory&lt;char&gt;</code> where page slices of any <a href="https://sharpscript.net/docs/syntax#language-blocks-and-expressions">Language Blocks and Expressions</a> on the page are delegated to the <code class="highlighter-rouge">ScriptContext</code> registered <code class="highlighter-rouge">ScriptLanguages</code> for parsing which returns a fragment which is
added to the pages AST:</p> <p><a href="/assets/img/multi-langs.svg"><img src="/assets/img/multi-langs.svg" alt></a></p> <p>When executing the page, each language is responsible for rendering its own fragments which all write directly to the pages <code class="highlighter-rouge">OutputStream</code>
to generate the pages output.</p> <p>The multi-languages support in <code class="highlighter-rouge">#Script</code> is designed to be extensible where everything about the language is encapsulated within its
<code class="highlighter-rouge">ScriptLanguage</code> implementation so that if you omit its registration:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var context = new ScriptContext {
//    ScriptLanguages = { ScriptLisp.Language }
}.Init();
</code></pre></div></div> <p>Any language expressions and language blocks referencing it become inert and its source code emitted as plain-text.</p> <h3 id="lisp-argument-scopes">Lisp Argument Scopes</h3> <p>One differentiator between Lisp and <a href="/scode/">Code</a> languages is that <code class="highlighter-rouge">code</code> utilizes the containing page current scope
for all its argument references where as Lisp stores all its definitions within the Lisp interpreter symbol table
attached to the <code class="highlighter-rouge">PageResult</code>, so whilst Lisp scripts can access arguments within the pages scope, in order for the outer page to access any Lisp symbols they need to be exported, e.g:</p> <p><a href="https://sharpscript.net/lisp/#lisp-argument-scopes"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-arg-scopes.png" alt></a></p> <h3 id="exporting-lisp-functions">Exporting Lisp Functions</h3> <p>Lisp functions can also be exported for usage in the rest of the page by calling <code class="highlighter-rouge">(to-delegate lispFn)</code> to convert it into a .NET Delegate, e.g:</p> <p><a href="https://sharpscript.net/lisp/#exporting-lisp-functions"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-export-fns.png" alt></a></p> <p>Although an easier way to define functions in Lisp is to use the <a href="https://sharpscript.net/docs/blocks#defn">defn Script Block</a> which wraps
this in a convenient syntax:</p> <p><a href="https://sharpscript.net/lisp/#exporting-lisp-functions"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-defn-block.png" alt></a></p> <h3 id="controlling-lisp-output">Controlling Lisp output</h3> <p>One of Lisp&#x2019;s famous traits is <strong>everything is an expression</strong> which is typically desired within a language, but may not be what you want when generating output. E.g traditionally Lisp uses <a href="http://www.lispworks.com/documentation/HyperSpec/Body/s_setq.htm">setq</a>
to set a variable which also returns its value that <code class="highlighter-rouge">#Script</code> will emit as it automatically emits all statement return values.</p> <p>You could use <code class="highlighter-rouge">def</code> which is an alias for <code class="highlighter-rouge">setq</code> which returns <code class="highlighter-rouge">null</code>, other options include wrapping all statements within an empty <code class="highlighter-rouge">let</code>
expression where only the last expression is returned, or you could use a <a href="https://sharpscript.net/docs/syntax#language-block-modifiers">Language Block Modifier</a>
to ignore the entire <code class="highlighter-rouge">lisp</code> block output and only export the result you want to be able to control precisely where to emit it:</p> <p><a href="https://sharpscript.net/lisp/#controlling-lisp-output"><img src="https://raw.githubusercontent.com/ServiceStack/docs/master/docs/images/sharpscript/lisp-control-output.png" alt></a></p> <blockquote> <p>can use either &#x2018;q&#x2019;, &#x2018;quiet&#x2019; or &#x2018;mute&#x2019; block modifier to ignore output</p>
</blockquote> <p>Another way to generate output from Lisp is to use its built-in print functions below:</p> <ul> <li><strong>(print &#x2026;args)</strong> - write all arguments to the <code class="highlighter-rouge">OutputStream</code></li> <li><strong>(println &#x2026;args)</strong> - write all arguments to the <code class="highlighter-rouge">OutputStream</code> followed by a <strong>new line</strong></li> <li><strong>(printlns &#x2026;args)</strong> - write all arguments to the <code class="highlighter-rouge">OutputStream</code> with a <code class="highlighter-rouge">&apos; &apos;</code> <strong>space delimiter</strong> followed by a <strong>new line</strong></li> <li><strong>(pr &#x2026;args)</strong> - same as <code class="highlighter-rouge">print</code> but <strong>HTML encode</strong> all arguments</li> <li><strong>(prn &#x2026;args)</strong> - same as <code class="highlighter-rouge">println</code> but <strong>HTML encode</strong> all arguments</li>
</ul> <h2 id="learn-script-lisp">Learn #Script Lisp</h2> <p>A great resource for learning Script Lisp is seeing it in action by seeing how to implement <strong>C#&#x2019;s 101 LINQ Examples in Lisp</strong>:</p> <h3 id="explore-apis-in-real-time">Explore APIs in real-time</h3> <p>We can also take advantage of Lisp&#x2019;s dynamism and interactivity to explore APIs in real-time, a great way to do this is via
a <a href="#run-and-watch-lisp-scripts">watched Lisp script</a> on the side where it provides instant feedback after each <code class="highlighter-rouge">Ctrl+S</code> save point
or a active <a href="#lisp-repl">Lisp REPL</a>.</p> <ul> <li><strong>symbols</strong> - List all symbols in Lisp interpreter - most symbols are named after <a href="http://www.lispworks.com/documentation/HyperSpec/Front/X_AllSym.htm">standard Lisp</a>
or <a href="https://clojure.org/api/cheatsheet">clojure functions</a></li> <li><strong>(symbol-type symbol)</strong> - Display the Symbol&#x2019;s Value Type</li> <li><strong>scriptMethods</strong> - List all available Script Method Names registered in <code class="highlighter-rouge">ScriptContext</code></li> <li><strong>scriptMethodTypes</strong> - List all available Script Method Type information</li> <li><strong>(joinln collection)</strong> - Display the string output of each item in the collection on a separate line</li> <li><strong>(globln pattern collection)</strong> - Only display lines matching the glob pattern</li> <li><strong>(typeName instance)</strong> - View the instance Type Name</li> <li><strong>(props instance)</strong> - Display the Property names of an Instance public properties</li> <li><strong>(fields instance)</strong> - Display the Field names of an Instance public fields</li> <li><strong>(methods instance)</strong> - Display the Method names of an Instance public methods</li> <li><strong>(propTypes instance)</strong> - Get the PropertyInfo[] of an Instance public properties</li> <li><strong>(fieldTypes instance)</strong> - Get the FieldInfo[] of an Instance public fields</li> <li><strong>(methodTypes instance)</strong> - Get the Script Method Infos of an Instance public methods</li> <li><strong>(staticProps instance)</strong> - Display the Property names of an Instance public static properties</li> <li><strong>(staticFields instance)</strong> - Display the Field names of an Instance public static fields</li> <li><strong>(staticMethods instance)</strong> - Display the Method names of an Instance public static methods</li> <li><strong>(staticPropTypes instance)</strong> - Get the PropertyInfo[] of an Instance public static properties</li> <li><strong>(staticFieldTypes instance)</strong> - Get the FieldInfo[] of an Instance public static fields</li> <li><strong>(staticMethodTypes instance)</strong> - Get the Script Method Infos of an Instance public static methods</li>
</ul> <p>You can view the <a href="https://sharpscript.net/docs/scripts-reference">Scripts API Reference</a> and <a href="https://sharpscript.net/docs/default-scripts">Scripts Documentation</a>
on this website to interactively explore the available APIs, we&#x2019;ll work on providing further interactive documentation
for the built-in Lisp functions, in the mean-time the best resource are <a href="https://github.com/ServiceStack/ServiceStack/blob/32185f14aaf93d768dda5673381aa0d2fdbe34b4/src/ServiceStack.Common/Script/ScriptLanguage.Lisp.cs#L3106-L3508">their implementation</a>.</p> <p>For reference, here&#x2019;s are a quick list of all built-in Lisp symbols:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- % * *gensym-counter* *version* / /= _append _nreverse + &lt; &lt;= = &gt; &gt;= 1- 1+ 1st 2nd 3rd abs all? and any? 
append apply assoc assoc-key assoc-value assq atom atom? average butlast C caaar caadr caar cadar caddr 
cadr car cdaar cdadr cdar cddar cdddr cddr cdr ceiling cons cons? consp cos count debug dec decf def 
defmacro defn defun dispose dolist doseq doseq-while dotimes dump dump-inline elt empty? end? endp 
enumerator enumeratorCurrent enumeratorNext eq eql equal error even? every every? exit exp expt F f++ 
false filter filter-index first flatmap flatten floor gensym glob globln group-by htmldump identity if 
inc incf instance? intern isqrt it last length let letrec list list? listp load load-src logand logior 
logxor lower-case make-symbol map mapc mapcan mapcar map-index map-where max member memq min mod nbutlast 
nconc new new-map next not not= nreverse nth nthcdr null number? odd? or order-by pop pr prin1 princ 
print println printlns prn prs push push-end random range reduce remove remove-if rest return reverse 
round rplaca rplacd second seq? setcar setcdr set-difference sets sin skip skip-while some some? sort 
sort-by sqrt str string string? string-downcase string-upcase subseq sum symbol-name symbol-type t take 
take-while tan terpri textdump third to-array to-cons to-delegate to-dictionary to-list true truncate 
union unless upper-case when where where-index while zero? zerop zip zip-where
</code></pre></div></div> <p>Common Lisp by convention uses a <code class="highlighter-rouge">*p</code> suffix for <strong>predicate</strong> functions but we prefer Clojure&#x2019;s (and Ruby&#x2019;s)
more readable <code class="highlighter-rouge">*?</code> suffix convention, for source-code compatibility we include both for <a href="http://jtra.cz/stuff/lisp/sclr/index.html">core Lisp predicts</a> and just <code class="highlighter-rouge">*?</code> for others.</p> <h2 id="happy-hacking">Happy Hacking!</h2> <p>We hope you enjoy the enhancments to <code class="highlighter-rouge">#Script</code> in this release and can&#x2019;t wait to see what you do with it.
Any Questions or Feedback about this release is welcome on the <a href="https://forums.servicestack.net/">Customer Forums</a>.</p> </div>
</div>
    </div>
    <footer>
        <div>created by buildstarted &copy; 2019 <a href="/about">about</a></div>
        <div>Share this page on social media: copy and paste this url https://linksfor.dev/</div>
    </footer>
    
    <script>
        (function() {
            var COLLECT_URL = "https://dna.buildstarted.com/t";
            var SITE_ID = "linksfor.devs";
            var GLOBAL_VAR_NAME = "__DNA__";

            window[GLOBAL_VAR_NAME] = {};

            window[GLOBAL_VAR_NAME].sendPageView = function() {
                var path = location.pathname;
                var referrer = document.referrer;

                var url = COLLECT_URL + "?siteid=" + SITE_ID + "&p=" + encodeURIComponent(path) + "&r=" + encodeURIComponent(referrer);

                try { fetch(url, { method: "GET" }); } catch (e) {}
            };

            window[GLOBAL_VAR_NAME].sendPageView();
        })();
    </script>
</body>
</html>